!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,(function(){return(()=>{var e,t,n,o={72099:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,'#floorManagerPanel {\n  /* Spinner Circle Rotation */\n}\n#floorManagerPanel .icon::before {\n  content: "\\2713";\n  margin-left: 12px;\n  color: deepskyblue;\n}\n#floorManagerPanel .itemList:hover {\n  background-color: #4a555b;\n}\n#floorManagerPanel .itemChecked {\n  color: deepskyblue;\n}\n#floorManagerPanel .sp {\n  width: 32px;\n  height: 32px;\n  clear: both;\n  margin: 20px auto;\n}\n#floorManagerPanel .sp-circle {\n  border: 2px rgba(255, 255, 255, 0.5) solid;\n  border-top: 2px black solid;\n  border-radius: 50%;\n  -webkit-animation: spCircRot 0.6s infinite linear;\n  animation: spCircRot 0.6s infinite linear;\n}\n@-webkit-keyframes spCircRot {\n  from {\n    -webkit-transform: rotate(0deg);\n  }\n  to {\n    -webkit-transform: rotate(359deg);\n  }\n}\n#floorManager .wedo-floor-manager {\n  font-size: 26px !important;\n  transform: translate(0px, 0px);\n}\n.not-ready {\n  color: #7f7f7f;\n}\n.wedofont {\n  font-size: 18px !important;\n}\n.wedo-switch {\n  margin: 0;\n  padding: 0;\n  color: rgba(0, 0, 0, 0.65);\n  font-size: 14px;\n  font-variant: tabular-nums;\n  line-height: 1.5;\n  list-style: none;\n  font-feature-settings: "tnum";\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n  min-width: 44px;\n  height: 22px;\n  line-height: 20px;\n  vertical-align: middle;\n  background-color: rgba(0, 0, 0, 0.25);\n  border: 1px solid transparent;\n  border-radius: 100px;\n  cursor: pointer;\n  transition: all 0.36s;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  transform: translateY(-1px);\n}\n.wedo-switch .wedo-switch-inner {\n  display: block;\n  margin-right: 6px;\n  margin-left: 24px;\n  color: #fff;\n  font-size: 12px;\n}\n.wedo-switch:focus {\n  outline: 0;\n  box-shadow: 0 0 0 2px rgb(24 144 12.75%);\n}\n.wedo-switch-checked {\n  background-color: #1890ff;\n}\n.wedo-switch-checked .wedo-switch-inner {\n  margin-right: 24px;\n  margin-left: 6px;\n}\n.wedo-switch::after {\n  position: absolute;\n  top: 1px;\n  left: 1px;\n  width: 18px;\n  height: 18px;\n  background-color: #fff;\n  border-radius: 18px;\n  cursor: pointer;\n  transition: all 0.36s cubic-bezier(0.78, 0.14, 0.15, 0.86);\n  content: " ";\n  box-shadow: 0 2px 4px 0 rgb(0 35 0.55%);\n}\n.wedo-switch-checked::after {\n  left: 100%;\n  margin-left: -1px;\n  transform: translateX(-100%);\n}\n',""]),e.exports=t},55185:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ViewingExtensionFloorManager:()=>o});var o={};n.r(o),n.d(o,{ViewingExtensionFloorManager:()=>u});var i=n(30808),r=n(87872),l=n(94069),a=(n(26651),n(36194)),s=n(45301),d=n(14100);const c=window.myGlobalParams.baseApi,p=[{name:"import-elevation-from-excel",headers:{"Content-Type":"multipart/form-data"},baseURL:c},{name:"get-elevation-from-db",headers:{"Content-Type":"application/x-www-form-urlencoded"},baseURL:c}];n(22023),n(91403);class u extends i.Z{constructor(e,t={}){super(e,t),this.viewer=e,this.models=e.impl.modelQueue().getModels(),this.clientId=e.config.wedoConfig.clientId,this.options=t,this.toolBarId="wdkitsTools-1",this.btnId="floorManager",this.className="wedo-floor-manager-btn",this.iconName="wedofont wedo-floor-manager",this.name="楼层管理",this.disabledTxt="模型加载中……",this.tooiTip="楼层管理",this.fixFooterObj={},this.boxSliderStep={step:2,topInstanceStep:0,bottomInstanceStep:0},this.levelData=[],this.loadAnimation=null,this.currentCutPlan,this.upPlan=0,this.downPlan=0,this.firstLoad=!0}static get ExtensionId(){return"VE.Floor.Manager"}load(){return l.Z.checkModels(this.viewer,this.models)?(this.btnClickEvts=[{key:u.ExtensionId,fun:this.buttonBindEvents.bind(this)}],!0):((0,s.y)("楼层管理拓展 暂时只支持Revit 3D模型！"),!1)}unload(){if(super.unload(),this.viewer&&this.simplePanel&&(this.simplePanel.setVisible(!1),this.viewer.removePanel(this.simplePanel),this.simplePanel.uninitialize()),this.buttons){let e=this.viewer.getToolbar();this.buttons.forEach((t=>{e&&t.removeFromParent(),t=null}))}return!0}onToolbarCreated(){this.viewer.impl.is2d?this.unload():this.createButton()}createButton(){let e=this;const{buttons:t}=l.Z.createToolBarAndButtons(e.viewer,e.toolBarId,[{id:e.btnId,className:e.className,iconName:e.iconName,name:e.name}],((t,n)=>e.buttonBindEvents()));e.buttons=t;var n=e.viewer.toolbar.getControl(e.toolBarId),o=e.disabledTxt;n&&n._controls.forEach((function(t){t._id===e.btnId&&(t.container.classList.add("not-ready"),t.setToolTip(o))})),e.checkGeometryLoaded.call(e,e.initializeExtension.bind(e))}buttonBindEvents(){let e=this,t=e.buttons;t.forEach(((n,o)=>{if(e.button=n,n._id===e.btnId&&!e.button.container.classList.contains("not-ready"))if(e.active){e.simplePanel.setVisible(!1),e.active=!1,n.removeClass("active"),e.clearAllCutplan();let t=e.panelWidth?e.panelWidth:e.simplePanel.container.offsetWidth;e.setSliderHandlePosition(t,0,!0)}else e.active=!0,n.addClass("active"),e.simplePanel||e.createPanel(t),e.simplePanel.setVisible(!0)}))}checkGeometryLoaded(e){var t=this.viewer,n=function(){var o=setInterval((()=>{t.model&&t.model.isLoadDone()&&(t.removeEventListener(Autodesk.Viewing.MODEL_UNLOADED_EVENT,n),clearInterval(o),e())}),100)};this.getLevel(),t.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,n)}initializeExtension(){let e=this;e.buttons.forEach((t=>{t.container.classList.remove("not-ready"),t.setToolTip(e.tooiTip)}))}localGetElevationFromDb(){let e=this,t=new URLSearchParams;t.append("clientId",e.clientId);let n=e.models.map((t=>{let n=t.getPropertyDb().svf.basePath;return n.substring(n.indexOf(e.clientId)+e.clientId.length+1,n.indexOf("/output")<=0?n.length:n.indexOf("/output"))}));return t.append("files",n),new Promise(((n,o)=>{(function(e){const t={method:"POST",url:"model-elevation/get-elevation-from-db",dataOrParams:e,name:"get-elevation-from-db",isToken:!0};return new Promise(((e,n)=>{(0,d.Z)(p,t).then((t=>e(t))).catch((e=>n(e)))}))})(t).then((t=>{t.data.data.length>0?(e.levelData=t.data.data,n(!0)):(e.levelData=e.levelDataFromModels,n(!1))})).catch((e=>{console.error(e),o(!1)}))}))}reload(e){return super.reload(e),!0}getLevel(){this.dataProcessingDevelopment=this.viewer.getExtension("VE.Data.Processing.Development"),this.dataProcessingDevelopment?this.update(this.dataProcessingDevelopment):this.viewer.loadExtension("VE.Data.Processing.Development",{}).then((e=>{this.update(e)}))}update(e){let t=this;e.on("dataProcessingDevelopmentUpdate",(e=>{t.localGetElevationFromDb().then((n=>{if(!n){let n=[];e.forEach(((e,t)=>n.push(...e.floorList)));let o={};n=n.reduce(((e,t)=>(!o[t.value]&&(o[t.value]=e.push(t)),e)),[]),t.levelData=n,t.levelDataFromModels=JSON.parse(JSON.stringify(n)),t.simplePanel&&t.creatContent()}}))}))}setPlanesFromFloor(e){let t=this;if(0===e.length)this.viewer.setCutPlanes([]);else{let o,i=[],r=[],l=Math.min(...e)-.3,a=[...new Set(t.levelData.map((e=>Number(e.value))))].sort(((e,t)=>e-t));for(let t=0;t<e.length;t++){if(o=a.findIndex((n=>Number(n.toFixed(3))===e[t])),-1===o)return;o===a.length-1?i.push(Number((e[t]+10).toFixed(3))):i.push(Number(a[o+1].toFixed(3)))}Math.max(...i)<0?r.push(new THREE.Vector4(0,0,1,Math.abs(Math.max(...i)))):r.push(new THREE.Vector4(0,0,1,-Math.abs(Math.max(...i)))),r.push(new THREE.Vector4(0,0,-1,l)),r.push(new THREE.Vector4(0,1,0,-999)),r.push(new THREE.Vector4(0,-1,0,-999)),r.push(new THREE.Vector4(1,0,0,-999)),r.push(new THREE.Vector4(-1,0,0,-999));var n=t.currentPlan?JSON.parse(JSON.stringify(t.currentPlan)):[{x:0,y:0,z:1,w:0},{x:0,y:0,z:-1,w:0},{x:0,y:1,z:0,w:0},{x:0,y:-1,z:0,w:0},{x:1,y:0,z:0,w:0},{x:-1,y:0,z:0,w:0}];t.currentPlan=r,t._createTween(n,JSON.parse(JSON.stringify(r)))}}_createTween(e,t){let n=this;!t||t.length<=0||(new a.Z.Tween(e).to(t,300).onUpdate((function(e){var t=[];e.forEach((e=>{t.push(new THREE.Vector4(e.x,e.y,e.z,e.w))})),n.viewer.setCutPlanes(t),n.topFloorShow&&n.showAllMOdel()})).onComplete((()=>{a.Z.removeAll(),n.showHideModel()})).start(),requestAnimationFrame((function e(t){requestAnimationFrame(e),a.Z.update(t)})))}downMoveCut(e){if(this.currentPlan&&0!==e&&this.levelData.length>0){let t=[],n=this;this.currentPlan.map((o=>{-1===o.z&&(o=new THREE.Vector4(0,0,-1,o.w+(e-n.boxSliderStep.step/2)),n.downPlan=o),n.upPlan&&1===o.z&&(o=n.upPlan),t.push(o)})),n.viewer.setCutPlanes(t)}}upMoveCut(e){if(this.currentPlan&&0!==e&&this.levelData.length>0){let t=[],n=this;this.currentPlan.map((o=>{1===o.z&&(o=o.w>0?new THREE.Vector4(0,0,1,Math.abs(o.w)-(e-n.boxSliderStep.step/2)):new THREE.Vector4(0,0,1,-(Math.abs(o.w)+(e-n.boxSliderStep.step/2))),n.upPlan=o),n.downPlan&&-1===o.z&&(o=n.downPlan),t.push(o)})),n.viewer.setCutPlanes(t)}}createPanel(e){let t=this;const n=t.viewer.container,o=t.contentBox=document.createElement("div");o.appendChild(t.createLoadAnimation());const i=t.simplePanel=new l.m(t.viewer,n,"floorManagerPanel",t.name,o,"0","0",t.creatFixEleOnFooter());i.closer.addEventListener("click",(()=>{t.active=!1,e[0].removeClass("active"),t.clearAllCutplan()}),!1),i.setFixFooterHeight(130),t.simplePanel.footerInstance.resizeCallback=(e,n)=>{t.setSliderHandlePosition(e,n)},t.creatContent()}setSliderHandlePosition(e,t,n){n&&(this.upPlan=this.downPlan=0,this.bottomSliderPositionLeftPercent=this.topSliderPositionLeftPercent=.5);let o=this.simplePanel.container.style.minWidth;o=Number(o.substring(0,o.indexOf("px"))),e<o&&(e=o),this.panelWidth=e;let i=this.simplePanel.fixFooter.getElementsByClassName("top-slider-handle")[0],r=this.simplePanel.fixFooter.getElementsByClassName("bottom-slider-handle")[0];(0===this.topSliderPositionLeftPercent||this.topSliderPositionLeftPercent)&&(i.style.left=this.fixFooterObj.topSliderRailMarginLeft+this.fixFooterObj.topSliderRailPaddingLeft+this.topSliderPositionLeftPercent*(e-(this.fixFooterObj.topSliderRailMarginLeft+this.fixFooterObj.topSliderRailMarginRight+this.fixFooterObj.topSliderRailPaddingLeft+this.fixFooterObj.topSliderRailPaddingRight)-this.fixFooterObj.topSliderHandleOffsetWidth)+"px",this.boxSliderStep.topInstanceStep=Math.abs(this.topSliderPositionLeftPercent-.5)*this.boxSliderStep.step),(0===this.bottomSliderPositionLeftPercent||this.bottomSliderPositionLeftPercent)&&(r.style.left=this.fixFooterObj.bottomSliderRailMarginLeft+this.fixFooterObj.bottomSliderRailPaddingLeft+this.bottomSliderPositionLeftPercent*(e-(this.fixFooterObj.bottomSliderRailMarginLeft+this.fixFooterObj.bottomSliderRailMarginRight+this.fixFooterObj.bottomSliderRailPaddingLeft+this.fixFooterObj.bottomSliderRailPaddingRight)-this.fixFooterObj.bottomSliderHandleOffsetWidth)+"px",this.boxSliderStep.bottomInstanceStep=Math.abs(this.bottomSliderPositionLeftPercent-.5)*this.boxSliderStep.step)}createLoadAnimation(){const e=this.loadAnimation=document.createElement("div");return e.setAttribute("class","sp sp-circle"),e.style.display="block",e}creatContent(){let e=this;e.contentBox.innerHTML="",e.contentBox.appendChild(e.createLoadAnimation()),e.contentBox.appendChild(e.createItemList(e.levelData)),e.firstLoad&&tooltip(".wedo__tooltip",{transition:!0,time:200},void 0,void 0),e.firstLoad=!1}hideFixFooter(e){this.bottomFixFooterContol&&(this.bottomFixFooterContol.style.display=e?"block":"none")}createItemList(e){const t=document.createElement("div");if(t.style.height="height: calc(100% - 65px)",!e||e.length<=0){const e=document.createElement("span");return e.innerHTML=l.Z.createEmptyIco(80,80),e.style.margin="15px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.backgroundPosition="top left",e.style.backgroundSize="auto auto",t.appendChild(e),this.loadAnimation.style.display="none",this.hideFixFooter(!1),t.appendChild(this.createImportOutport()),t}this.hideFixFooter(!0);for(const n of e){const e=document.createElement("div");e.setAttribute("class","itemList"),e.style.width="100%",e.style.display="flex",e.style.flexDirection="column",e.style.boxSizing="content-box",e.setAttribute("id",n.value);const o=document.createElement("div");o.setAttribute("class","listItem"),o.setAttribute("title",n.name),o.style.backgroundColor="rgba(0,0,0,0)",o.style.color="#f3f7fb",o.style.display="flex",o.style.justifyContent="space-between",o.style.textAlign="left",o.style.lineHeight="35px",o.style.borderStyle="none",o.style.fontFamily="'ArtifaktElement', 'Helvetica Neue', 'Segoe UI Semilight', sans-serif'",o.style.padding="0 15px",o.style.cursor="pointer";const i=document.createElement("div");i.setAttribute("class","textContainer"),i.style.maskSmage="linear-gradient(to left, transparent, black 1em)",i.style.whiteSpace="nowrap",i.style.overflow="hidden",i.style.width="100%",i.style.boxSizing="content-box",i.innerHTML=`<span class="">${n.name}</span>`,o.appendChild(i);const r=document.createElement("span");r.setAttribute("class","icon"),r.style.width="24px",r.style.display="none",o.appendChild(r),e.appendChild(o),o.onclick=e=>{const n=e.currentTarget.parentElement,o=e.currentTarget.parentElement.parentElement.children;for(const e of o){const t=e.querySelectorAll("span");this.isSingleMode?e===n?t[0].classList.contains("itemChecked")||(t[0].classList.add("itemChecked"),t[1].style.display=""):(t[0].classList.remove("itemChecked"),t[1].style.display="none"):e===n&&(t[0].classList.contains("itemChecked")?(t[0].classList.remove("itemChecked"),t[1].style.display="none"):(t[0].classList.add("itemChecked"),t[1].style.display=""))}const i=t.getElementsByClassName("itemChecked");let r=[];for(const e of i)r.push(e.innerHTML);let l=[];for(const e of this.levelData)r.includes(e.name)&&l.push(e.value);this.setPlanesFromFloor(l)},t.appendChild(e)}return this.loadAnimation.style.display="none",this.itemListDoc=t,t}creatFixEleOnFooter(){const e=document.createElement("div");e.setAttribute("class","bottom-fix-footer outter"),e.style.height="130px";const t=this.bottomFixFooterContol=document.createElement("div"),n=document.createElement("div");n.style.width="100%",n.style.marginTop="10px";const o=document.createElement("div");o.innerHTML="顶剖面控制杆：",o.style.marginLeft="15px";const i=document.createElement("div");i.setAttribute("class","top-slider-rail"),i.style.position="relative",i.style.minWidth="10px",i.style.marginLeft="50px",i.style.marginRight="50px",i.style.height="2px",i.style.backgroundColor="#d9e1e9",i.style.borderRadius="2px",i.style.transition="background-color .3s";const r=this.topSliderHandleDiv=document.createElement("div");r.style.height="10px",r.setAttribute("class","top-slider-handle"),r.style.position="relative",r.style.width="14px",r.style.height="14px",r.style.margin="-8px 0px 0px 0px",r.style.padding="0px",r.style.left="calc(50% - 7px)",r.style.backgroundColor="#1dc6f2",r.style.borderRadius="50%",r.style.boxShadow="0",r.style.cursor="pointer",r.style.transition="border-color .3s,box-shadow .6s,transform .3s cubic-bezier(.18,.89,.32,1.28),-webkit-box-shadow .6s,-webkit-transform .3s topSliderHandleDiv.style.cubic-bezier(.18,.89,.32,1.28)",n.appendChild(i),n.appendChild(r);const l=document.createElement("div");l.style.marginTop="10px";const a=document.createElement("div");a.innerHTML="底剖面控制杆：",a.style.marginTop="10px",a.style.marginLeft="15px";const s=document.createElement("div");s.setAttribute("class","bottom-slider-rail"),s.style.position="relative",s.style.minWidth="10px",s.style.marginLeft="50px",s.style.marginRight="50px",s.style.height="2px",s.style.backgroundColor="#d9e1e9",s.style.borderRadius="2px",s.style.transition="background-color .3s";const d=this.bottomSliderHandleDiv=document.createElement("div");return d.setAttribute("class","bottom-slider-handle"),d.style.height="10px",d.style.position="relative",d.style.width="14px",d.style.height="14px",d.style.margin="-8px 0px 0px 0px",d.style.padding="0px",d.style.left="calc(50% - 7px)",d.style.backgroundColor="#1dc6f2",d.style.borderRadius="50%",d.style.boxShadow="0",d.style.cursor="pointer",d.style.transition="border-color .3s,box-shadow .6s,transform .3s cubic-bezier(.18,.89,.32,1.28),-webkit-box-shadow .6s,-webkit-transform .3s bottomSliderHandleDiv.style.cubic-bezier(.18,.89,.32,1.28)",l.appendChild(s),l.appendChild(d),t.appendChild(o),t.appendChild(n),r.addEventListener("mousedown",(e=>{this.myMousedown(event,t,i,r)})),t.appendChild(a),t.appendChild(l),d.addEventListener("mousedown",(e=>{this.myMousedown(event,t,s,d)})),t.appendChild(this.createImportOutport()),e.appendChild(t),e}myMousedown(e,t,n,o){let i=this;t.addEventListener("mousemove",d),t.addEventListener("mouseup",(function e(n){t.removeEventListener("mousemove",d),t.removeEventListener("mouseup",e),void 0!==o.releaseCapture&&o.releaseCapture()}));let r=e||window.event,a=r.pageX||r.clientX+(document.body.scrollLeft||document.documentElement.scrollLeft),s=(r.pageY||(r.clientY,document.body.scrollTop||document.documentElement.scrollTop),a-o.offsetLeft);function d(e){let r,a,d,c,p,u=e||window.event,h=u.pageX||u.clientX+(document.body.scrollLeft||document.documentElement.scrollLeft),f=(u.pageY||(u.clientY,document.body.scrollTop||document.documentElement.scrollTop),h-s);r=Number(l.Z.getStyle(n,"marginLeft").substr(0,l.Z.getStyle(n,"marginLeft").indexOf("px"))),a=Number(l.Z.getStyle(n,"paddingLeft").substr(0,l.Z.getStyle(n,"paddingLeft").indexOf("px"))),d=Number(l.Z.getStyle(n,"marginLeft").substr(0,l.Z.getStyle(n,"marginLeft").indexOf("px"))),c=Number(l.Z.getStyle(n,"paddingLeft").substr(0,l.Z.getStyle(n,"paddingLeft").indexOf("px"))),p=o.offsetWidth;const m=o.classList.contains("top-slider-handle");m?(i.fixFooterObj.topSliderRailMarginLeft=r,i.fixFooterObj.topSliderRailMarginRight=d,i.fixFooterObj.topSliderRailPaddingLeft=a,i.fixFooterObj.topSliderRailPaddingRight=c,i.fixFooterObj.topSliderHandleOffsetWidth=p):(i.fixFooterObj.bottomSliderRailMarginLeft=r,i.fixFooterObj.bottomSliderRailMarginRight=d,i.fixFooterObj.bottomSliderRailPaddingLeft=a,i.fixFooterObj.bottomSliderRailPaddingRight=c,i.fixFooterObj.bottomSliderHandleOffsetWidth=p),f<r+a?f=r+a:f>t.offsetWidth-o.offsetWidth-d-c&&(f=t.offsetWidth-o.offsetWidth-d-c),o.style.left=f+"px",o.style.top="0px";let b=(f-50)/(i.simplePanel.container.offsetWidth-(r+a+d+c)-p);if(m){i.topSliderPositionLeftPercent=b;let e=Math.abs(b)*i.boxSliderStep.step;i.upMoveCut(e)}else{i.bottomSliderPositionLeftPercent=b;let e=Math.abs(b)*i.boxSliderStep.step;i.downMoveCut(e)}}o.offsetTop,void 0!==o.setCapture&&o.setCapture()}localImportElevationFromExcel(e){let t=this,n=t.clientId,o=new FormData;o.append("clientId",n),o.append("files",t.models.map((e=>{let t=e.getPropertyDb().svf.basePath;return t.substring(t.indexOf(n)+n.length+1,t.indexOf("/output")<=0?t.length:t.indexOf("/output"))}))),o.append("file",e[0]),function(e){const t={method:"POST",url:"model-elevation/import-elevation-from-excel",dataOrParams:e,name:"import-elevation-from-excel",isToken:!0};return new Promise(((e,n)=>{(0,d.Z)(p,t).then((t=>e(t))).catch((e=>n(e)))}))}(o).then((e=>{l.Z.viewerGlobalLoading(!1),0!==e.data.data.length&&(t.levelData=e.data.data.sort(((e,t)=>t.value-e.value))),t.creatContent(),t.hideFixFooter(!0),l.Z.viewerGlobalLoading(!1)})).catch((e=>{t.levelData=[],l.Z.viewerGlobalLoading(!1)}))}createImportOutport(){let e=this;const t=document.createElement("div");t.style.margin="10px",t.style.textAlign="right";const n=document.createElement("span");n.innerHTML='\n        <span class="wedo__tooltip" data-tip="单/多选" data-direction="top">\n            <button type="button" class="wedo-switch wedo-switch-checked">\n                <span class="wedo-switch-inner">多</span>\n                <div class="wedo-click-animating-node">\n                </div>\n            </button>\n        </span>\n        ',n.style.cursor="pointer",n.style.color="#fff",n.style.marginRight="10px",n.style.verticalAlign="middle",n.addEventListener("click",(()=>{e.isSingleMode?(n.firstElementChild.firstElementChild.classList.add("wedo-switch-checked"),n.firstElementChild.firstElementChild.firstElementChild.innerHTML="多",e.isSingleMode=!1):(n.firstElementChild.firstElementChild.classList.remove("wedo-switch-checked"),n.firstElementChild.firstElementChild.firstElementChild.innerHTML="单",e.isSingleMode=!0)})),t.appendChild(n);const o=document.createElement("a");o.innerHTML='\n        <span class="wedo__tooltip" data-tip="导入标高" data-direction="top">\n        <span class="wedofont wedo-cloud-upload"></span>\n        </span>\n        ',o.style.cursor="pointer",o.style.color="#fff",o.style.verticalAlign="middle";const i=document.createElement("input");i.setAttribute("type","file"),i.style.display="none",i.onchange=t=>{l.Z.viewerGlobalLoading(!0),e.localImportElevationFromExcel(i.files)},o.onclick=e=>{i.click()},o.onmouseover=function(){o.style.color="#fe7300"},o.onmouseout=function(){o.style.color="#fff"},t.appendChild(o);const r=document.createElement("span");r.innerHTML='\n        <span class="wedo__tooltip" data-tip="刷新" data-direction="top">\n        <span class="wedofont wedo-reload"></span>\n        </span>\n        ',r.style.cursor="pointer",r.style.color="#fff",r.style.marginLeft="10px",r.style.verticalAlign="middle",r.addEventListener("click",(()=>{e.contentBox.innerHTML="",e.contentBox.appendChild(e.createLoadAnimation()),e.localGetElevationFromDb().then((()=>{e.creatContent()}))})),t.appendChild(r);const a=document.createElement("span");a.setAttribute("download",""),a.innerHTML='\n        <span class="wedo__tooltip" data-tip="模板下载" data-direction="top">\n        <span class="wedofont wedo-cloud-download"></span>\n        </span>\n        ',a.style.marginLeft="10px",a.style.cursor="pointer",a.style.color="#fff",a.style.textDecoration="none",a.style.verticalAlign="middle",a.onclick=e=>{l.Z.viewerGlobalLoading(!0),new Promise(((e,t)=>{c?e(c+"/model-elevation/download-elevation-excel-temp"):t()})).then((e=>{window.open(e,"_blank"),l.Z.viewerGlobalLoading(!1)}))},a.onmouseover=function(){a.style.color="#fe7300"},a.onmouseout=function(){a.style.color="#fff"},t.appendChild(a);const s=document.createElement("span");return s.innerHTML='\n        <span class="wedo__tooltip" data-tip="隐藏/显示 顶部楼板/天花板" data-direction="top">\n        <span class="wedofont wedo-border-top"></span>\n        </span>\n        ',s.style.cursor="pointer",s.style.color="#fff",s.style.marginLeft="10px",s.style.verticalAlign="middle",s.addEventListener("click",(()=>{e.showHideModel()})),t.appendChild(s),t}showHideModel(){let e=this;!e.currentPlan||e.currentPlan.length<=0||(e.topFloorShow&&e.showAllMOdel(),e.floorBoxCenterMap().then((()=>{e.topFloorShow=!0;var t=-e.currentPlan[0].w;e.floorBoxCenterMapDatas.forEach((n=>{var o=[];n.res.forEach((n=>{e.isRangeIn(n.zl,t+.5,t-.5)&&o.push(n.key)})),o.forEach((t=>{e.viewer.impl.visibilityManager.hide(t,n.model)}))}))})))}showAllMOdel(){this.topFloorShow&&(this.viewer.showAll(),this.topFloorShow=!1)}isRangeIn(e,t,n){var o=parseFloat(e);return o<=t&&o>=n}floorBoxCenterMap(){let e=this,t=this.models,n=[];function o(t,n,o,i){0===t&&(e.floorBoxCenterMapDatas.push({model:o,res:n}),i())}return e.floorBoxCenterMapDatas=[],t.map((e=>{let t=new Promise(((t,n)=>{e.getPropertyDb().executeUserFunction((0,r.CY)(),{condition:"类别",value:["楼板","天花板","屋顶"]}).then((function(n){var i=Array.from(new Set(n)),r=i.length;if(0===r)t();else{var a=[];i.forEach((n=>{l.Z.getWorldBoundingBox(e,n).then((i=>{const{min:l,max:s}=i,d=(l.z+s.z)/2;a.push({key:n,zl:d}),o(--r,a,e,t)})).catch((n=>{console.error("这部分dbid不是一个实体",n),o(--r,a,e,t)}))}))}}))})).catch((e=>console.error(e)));n.push(t)})),Promise.all(n)}clearAllCutplan(){let e=this;if(e.setPlanesFromFloor([]),e.itemListDoc){let t=e.itemListDoc.getElementsByTagName("span");for(const e of t)e.classList.contains("itemChecked")?e.classList.remove("itemChecked"):e.classList.contains("icon")&&(e.style.display="none")}}}Autodesk.Viewing.theExtensionManager.registerExtension(u.ExtensionId,u)},22023:(e,t,n)=>{var o=n(93379),i=n(72099);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);var r=o(i,{insert:"head",singleton:!1});if(!i.locals||e.hot.invalidate){var l=i.locals;e.hot.accept(72099,(function(){"string"==typeof(i=(i=n(72099)).__esModule?i.default:i)&&(i=[[e.id,i,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(l,i.locals)?(l=i.locals,r(i)):e.hot.invalidate()}))}e.hot.dispose((function(){r()})),e.exports=i.locals||{}}},i={};function r(e){var t=i[e];if(void 0!==t){if(void 0!==t.error)throw t.error;return t.exports}var n=i[e]={id:e,loaded:!1,exports:{}};try{var l={id:e,module:n,factory:o[e],require:r};r.i.forEach((function(e){e(l)})),n=l.module,l.factory.call(n.exports,n,n.exports,l.require)}catch(e){throw n.error=e,e}return n.loaded=!0,n.exports}r.m=o,r.c=i,r.i=[],e=[],r.O=(t,n,o,i)=>{if(!n){var l=1/0;for(d=0;d<e.length;d++){for(var[n,o,i]=e[d],a=!0,s=0;s<n.length;s++)(!1&i||l>=i)&&Object.keys(r.O).every((e=>r.O[e](n[s])))?n.splice(s--,1):(a=!1,i<l&&(l=i));a&&(e.splice(d--,1),t=o())}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,o,i]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.hu=e=>e+"."+r.h()+".hot-update.js",r.hmrF=()=>"FloorManager."+r.h()+".hot-update.json",r.h=()=>"7152d5a9c66f2a2ebb99",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="wd-viewer:",r.l=(e,o,i,l)=>{if(t[e])t[e].push(o);else{var a,s;if(void 0!==i)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var p=d[c];if(p.getAttribute("src")==e||p.getAttribute("data-webpack")==n+i){a=p;break}}a||(s=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",n+i),a.src=e),t[e]=[o];var u=(n,o)=>{a.onerror=a.onload=null,clearTimeout(h);var i=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(o))),n)return n(o)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),s&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.j=466,(()=>{var e,t,n,o,i={},l=r.c,a=[],s=[],d="idle";function c(e){d=e;for(var t=0;t<s.length;t++)s[t].call(null,e)}function p(e){if(0===t.length)return e();var n=t;return t=[],Promise.all(n).then((function(){return p(e)}))}function u(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return c("check"),r.hmrM().then((function(o){if(!o)return c(m()?"ready":"idle"),null;c("prepare");var i=[];return t=[],n=[],Promise.all(Object.keys(r.hmrC).reduce((function(e,t){return r.hmrC[t](o.c,o.r,o.m,e,n,i),e}),[])).then((function(){return p((function(){return e?f(e):(c("ready"),i)}))}))}))}function h(e){return"ready"!==d?Promise.resolve().then((function(){throw new Error("apply() is only allowed in ready status")})):f(e)}function f(e){e=e||{},m();var t=n.map((function(t){return t(e)}));n=void 0;var i,r=t.map((function(e){return e.error})).filter(Boolean);if(r.length>0)return c("abort"),Promise.resolve().then((function(){throw r[0]}));c("dispose"),t.forEach((function(e){e.dispose&&e.dispose()})),c("apply");var l=function(e){i||(i=e)},a=[];return t.forEach((function(e){if(e.apply){var t=e.apply(l);if(t)for(var n=0;n<t.length;n++)a.push(t[n])}})),i?(c("fail"),Promise.resolve().then((function(){throw i}))):o?f(e).then((function(e){return a.forEach((function(t){e.indexOf(t)<0&&e.push(t)})),e})):(c("idle"),Promise.resolve(a))}function m(){if(o)return n||(n=[]),Object.keys(r.hmrI).forEach((function(e){o.forEach((function(t){r.hmrI[e](t,n)}))})),o=void 0,!0}r.hmrD=i,r.i.push((function(f){var m,b,v,g,y=f.module,x=function(n,o){var i=l[o];if(!i)return n;var r=function(t){if(i.hot.active){if(l[t]){var r=l[t].parents;-1===r.indexOf(o)&&r.push(o)}else a=[o],e=t;-1===i.children.indexOf(t)&&i.children.push(t)}else console.warn("[HMR] unexpected require("+t+") from disposed module "+o),a=[];return n(t)},s=function(e){return{configurable:!0,enumerable:!0,get:function(){return n[e]},set:function(t){n[e]=t}}};for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&"e"!==u&&Object.defineProperty(r,u,s(u));return r.e=function(e){return function(e){switch(d){case"ready":return c("prepare"),t.push(e),p((function(){c("ready")})),e;case"prepare":return t.push(e),e;default:return e}}(n.e(e))},r}(f.require,f.id);y.hot=(m=f.id,b=y,g={_acceptedDependencies:{},_acceptedErrorHandlers:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:v=e!==m,_requireSelf:function(){a=b.parents.slice(),e=v?void 0:m,r(m)},active:!0,accept:function(e,t,n){if(void 0===e)g._selfAccepted=!0;else if("function"==typeof e)g._selfAccepted=e;else if("object"==typeof e&&null!==e)for(var o=0;o<e.length;o++)g._acceptedDependencies[e[o]]=t||function(){},g._acceptedErrorHandlers[e[o]]=n;else g._acceptedDependencies[e]=t||function(){},g._acceptedErrorHandlers[e]=n},decline:function(e){if(void 0===e)g._selfDeclined=!0;else if("object"==typeof e&&null!==e)for(var t=0;t<e.length;t++)g._declinedDependencies[e[t]]=!0;else g._declinedDependencies[e]=!0},dispose:function(e){g._disposeHandlers.push(e)},addDisposeHandler:function(e){g._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=g._disposeHandlers.indexOf(e);t>=0&&g._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,d){case"idle":n=[],Object.keys(r.hmrI).forEach((function(e){r.hmrI[e](m,n)})),c("ready");break;case"ready":Object.keys(r.hmrI).forEach((function(e){r.hmrI[e](m,n)}));break;case"prepare":case"check":case"dispose":case"apply":(o=o||[]).push(m)}},check:u,apply:h,status:function(e){if(!e)return d;s.push(e)},addStatusHandler:function(e){s.push(e)},removeStatusHandler:function(e){var t=s.indexOf(e);t>=0&&s.splice(t,1)},data:i[m]},e=void 0,g),y.parents=a,y.children=[],a=[],f.require=x})),r.hmrC={},r.hmrI={}})(),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e,t,n,o,i={466:0},l={};function a(e){return new Promise(((t,n)=>{l[e]=t;var o=r.p+r.hu(e),i=new Error;r.l(o,(t=>{if(l[e]){l[e]=void 0;var o=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;i.message="Loading hot update chunk "+e+" failed.\n("+o+": "+r+")",i.name="ChunkLoadError",i.type=o,i.request=r,n(i)}}))}))}function s(l){function a(e){for(var t=[e],n={},o=t.map((function(e){return{chain:[e],id:e}}));o.length>0;){var i=o.pop(),l=i.id,a=i.chain,d=r.c[l];if(d&&(!d.hot._selfAccepted||d.hot._selfInvalidated)){if(d.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:l};if(d.hot._main)return{type:"unaccepted",chain:a,moduleId:l};for(var c=0;c<d.parents.length;c++){var p=d.parents[c],u=r.c[p];if(u){if(u.hot._declinedDependencies[l])return{type:"declined",chain:a.concat([p]),moduleId:l,parentId:p};-1===t.indexOf(p)&&(u.hot._acceptedDependencies[l]?(n[p]||(n[p]=[]),s(n[p],[l])):(delete n[p],t.push(p),o.push({chain:a.concat([p]),id:p})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];-1===e.indexOf(o)&&e.push(o)}}r.f&&delete r.f.jsonpHmr,e=void 0;var d={},c=[],p={},u=function(e){console.warn("[HMR] unexpected require("+e.id+") to disposed module")};for(var h in t)if(r.o(t,h)){var f,m=t[h],b=!1,v=!1,g=!1,y="";switch((f=m?a(h):{type:"disposed",moduleId:h}).chain&&(y="\nUpdate propagation: "+f.chain.join(" -> ")),f.type){case"self-declined":l.onDeclined&&l.onDeclined(f),l.ignoreDeclined||(b=new Error("Aborted because of self decline: "+f.moduleId+y));break;case"declined":l.onDeclined&&l.onDeclined(f),l.ignoreDeclined||(b=new Error("Aborted because of declined dependency: "+f.moduleId+" in "+f.parentId+y));break;case"unaccepted":l.onUnaccepted&&l.onUnaccepted(f),l.ignoreUnaccepted||(b=new Error("Aborted because "+h+" is not accepted"+y));break;case"accepted":l.onAccepted&&l.onAccepted(f),v=!0;break;case"disposed":l.onDisposed&&l.onDisposed(f),g=!0;break;default:throw new Error("Unexception type "+f.type)}if(b)return{error:b};if(v)for(h in p[h]=m,s(c,f.outdatedModules),f.outdatedDependencies)r.o(f.outdatedDependencies,h)&&(d[h]||(d[h]=[]),s(d[h],f.outdatedDependencies[h]));g&&(s(c,[f.moduleId]),p[h]=u)}t=void 0;for(var x,w=[],E=0;E<c.length;E++){var P=c[E],L=r.c[P];L&&(L.hot._selfAccepted||L.hot._main)&&p[P]!==u&&!L.hot._selfInvalidated&&w.push({module:P,require:L.hot._requireSelf,errorHandler:L.hot._selfAccepted})}return{dispose:function(){var e;n.forEach((function(e){delete i[e]})),n=void 0;for(var t,o=c.slice();o.length>0;){var l=o.pop(),a=r.c[l];if(a){var s={},p=a.hot._disposeHandlers;for(E=0;E<p.length;E++)p[E].call(null,s);for(r.hmrD[l]=s,a.hot.active=!1,delete r.c[l],delete d[l],E=0;E<a.children.length;E++){var u=r.c[a.children[E]];u&&(e=u.parents.indexOf(l))>=0&&u.parents.splice(e,1)}}}for(var h in d)if(r.o(d,h)&&(a=r.c[h]))for(x=d[h],E=0;E<x.length;E++)t=x[E],(e=a.children.indexOf(t))>=0&&a.children.splice(e,1)},apply:function(e){for(var t in p)r.o(p,t)&&(r.m[t]=p[t]);for(var n=0;n<o.length;n++)o[n](r);for(var i in d)if(r.o(d,i)){var a=r.c[i];if(a){x=d[i];for(var s=[],u=[],h=[],f=0;f<x.length;f++){var m=x[f],b=a.hot._acceptedDependencies[m],v=a.hot._acceptedErrorHandlers[m];if(b){if(-1!==s.indexOf(b))continue;s.push(b),u.push(v),h.push(m)}}for(var g=0;g<s.length;g++)try{s[g].call(null,x)}catch(t){if("function"==typeof u[g])try{u[g](t,{moduleId:i,dependencyId:h[g]})}catch(n){l.onErrored&&l.onErrored({type:"accept-error-handler-errored",moduleId:i,dependencyId:h[g],error:n,originalError:t}),l.ignoreErrored||(e(n),e(t))}else l.onErrored&&l.onErrored({type:"accept-errored",moduleId:i,dependencyId:h[g],error:t}),l.ignoreErrored||e(t)}}}for(var y=0;y<w.length;y++){var E=w[y],P=E.module;try{E.require(P)}catch(t){if("function"==typeof E.errorHandler)try{E.errorHandler(t,{moduleId:P,module:r.c[P]})}catch(n){l.onErrored&&l.onErrored({type:"self-accept-error-handler-errored",moduleId:P,error:n,originalError:t}),l.ignoreErrored||(e(n),e(t))}else l.onErrored&&l.onErrored({type:"self-accept-errored",moduleId:P,error:t}),l.ignoreErrored||e(t)}}return c}}}self.webpackHotUpdatewd_viewer=(e,n,i)=>{for(var a in n)r.o(n,a)&&(t[a]=n[a]);i&&o.push(i),l[e]&&(l[e](),l[e]=void 0)},r.hmrI.jsonp=function(e,i){t||(t={},o=[],n=[],i.push(s)),r.o(t,e)||(t[e]=r.m[e])},r.hmrC.jsonp=function(l,d,c,p,u,h){u.push(s),e={},n=d,t=c.reduce((function(e,t){return e[t]=!1,e}),{}),o=[],l.forEach((function(t){r.o(i,t)&&void 0!==i[t]&&(p.push(a(t)),e[t]=!0)})),r.f&&(r.f.jsonpHmr=function(t,n){e&&!r.o(e,t)&&r.o(i,t)&&void 0!==i[t]&&(n.push(a(t)),e[t]=!0)})},r.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(r.p+r.hmrF()).then((e=>{if(404!==e.status){if(!e.ok)throw new Error("Failed to fetch update manifest "+e.statusText);return e.json()}}))},r.O.j=e=>0===i[e];var d=(e,t)=>{var n,o,[l,a,s]=t,d=0;for(n in a)r.o(a,n)&&(r.m[n]=a[n]);if(s)var c=s(r);for(e&&e(t);d<l.length;d++)o=l[d],r.o(i,o)&&i[o]&&i[o][0](),i[l[d]]=0;return r.O(c)},c=self.webpackChunkwd_viewer=self.webpackChunkwd_viewer||[];c.forEach(d.bind(null,0)),c.push=d.bind(null,c.push.bind(c))})();var l=r.O(void 0,[839],(()=>r(55185)));return r.O(l)})()}));