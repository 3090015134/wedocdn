!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,(function(){return(()=>{var e,t,n,o={8851:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,".marker-save-modal .ant-divider-vertical {\n  position: relative;\n  top: -0.06em;\n  display: inline-block;\n  width: 2px !important;\n  height: 6em !important;\n  margin: 0 8px;\n  vertical-align: middle;\n  color: rgba(0, 0, 0, 0.5) !important;\n}\n.marker-save-modal .img-container .img-com1 {\n  cursor: pointer;\n  position: relative;\n  display: table-cell !important;\n}\n.marker-save-modal .img-container .img-com1 .img-com2 {\n  background: rgba(0, 0, 0, 0.5);\n  text-align: center;\n  margin-left: 3px;\n  position: absolute;\n  bottom: 3px;\n  width: 144px;\n  z-index: 1;\n  display: none;\n  height: 18px;\n  line-height: 18px;\n}\n.marker-save-modal .img-container .img-com1 .img-com2 .img-span {\n  text-align: center;\n  bottom: 3px;\n  z-index: 1;\n  height: 18px;\n  line-height: 18px;\n  margin: 0px 5px;\n  cursor: pointer !important;\n}\n.marker-save-modal .img-container .img-com1:hover .img-com2 {\n  z-index: 2;\n  display: block;\n}\n.marker-save-modal .img-container .zhui-jia-jie-tu {\n  float: right;\n  text-align: center;\n  vertical-align: middle;\n  cursor: pointer;\n}\n.marker-save-modal .img-container .zhui-jia-jie-tu:hover {\n  color: #00cc66;\n}\n.add-screenshot-full-modal .ant-modal {\n  top: 10px;\n}\n.add-screenshot-full-modal .ant-modal-content {\n  display: flex;\n  flex-direction: column;\n}\n.add-screenshot-full-modal .ant-modal-content .ant-modal-header .ant-modal-title {\n  color: red;\n  font-weight: bolder;\n  text-align: center;\n  font-size: x-large;\n}\n.add-screenshot-full-modal .ant-modal-body {\n  flex: 1;\n  margin: 0;\n  padding: 0;\n  position: relative;\n  overflow: hidden;\n  overflow-y: auto;\n  min-height: calc(100vh - 448px);\n}\n.add-screenshot-full-modal .ant-modal-body #addScreViewer {\n  min-height: calc(100vh - 103px);\n}\n",""]),e.exports=t},43410:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,'/******************** 一级图标样式 ************************/\n/* 标注图标样式 */\n/* .icon-fc-freehand {\n  background: url(../../public/static/img/marker/images/model-annotation.svg)\n    no-repeat;\n} */\n.adsk-button-icon.wedofont.wedo-model-annotation {\n  font-size: 26px !important;\n}\n.adsk-button-icon.wedo-model-annotation {\n  font-size: 26px !important;\n}\n.markup-not-ready .wedofont {\n  color: #7f7f7f !important;\n}\n#markupComment .wedofont {\n  font-size: 26px !important;\n}\n#hideShowMarkers .wedofont {\n  font-size: 26px !important;\n}\n/******************* 二级图标样式 ***********************/\n/* 标注样式 */\n.dr-toolbar-center {\n  left: 50%;\n  transform: translateX(-50%);\n  opacity: 0.8;\n  box-shadow: 0 3px 5px rgba(0, 0, 0, 0.5);\n  border-radius: 5px;\n  white-space: nowrap;\n  background: #222;\n  position: absolute;\n  z-index: 10;\n}\n.design-review-container path:hover {\n  stroke: #ff0;\n}\n.design-review-container g[type="Text"]:hover text {\n  fill: #ff0;\n}\n.design-review-container g[type="Text"]:hover rect {\n  stroke: #ff0;\n}\n.dr-disabled-element {\n  height: 100%;\n  width: 100%;\n  background-color: #6c6c6c;\n  opacity: 0.5;\n}\n.dr-toolbar {\n  bottom: 10px;\n  transform: translateX(-68%);\n}\n.dr-toolbar * {\n  box-sizing: border-box !important;\n  font-family: Helvetica Neue, Helvetica, Arial, sans-serif;\n}\n.dr-toolbar-button {\n  display: inline-block;\n  padding: 15px;\n  width: 50px;\n  height: 50px;\n  font-size: 18px;\n  color: #e5e5e5;\n  position: relative;\n  cursor: pointer;\n}\n.dr-toolbar-button:before {\n  display: block;\n  width: 100%;\n  text-align: center;\n  padding-top: 1.5px;\n  padding-left: 1px;\n}\n.dr-toolbar-button .dr-toolbar-title {\n  display: none;\n  font-size: small;\n  padding: 4px;\n  bottom: 105%;\n  opacity: 1 !important;\n  z-index: 1000;\n  color: #ccc !important;\n  line-height: 1;\n}\n.dr-toolbar-button:hover > .dr-toolbar-title {\n  display: block;\n}\n.dr-toolbar-button.wedo-xiankuan1,\n.dr-toolbar-button .wedo-xiankuan2,\n.dr-toolbar-button .wedo-xiankuan3,\n.dr-toolbar-button .wedo-xiankuan4,\n.dr-toolbar-button .wedo-xiankuan5,\n.dr-toolbar-button .wedo-xiankuan6 {\n  height: 18px;\n  margin: 4px 0px;\n  width: 100%;\n  min-width: 50px;\n  display: block;\n  line-height: 1 !important;\n  font-style: normal;\n  font-weight: 400;\n  font-variant: normal;\n  text-transform: none;\n  -webkit-font-smoothing: antialiased;\n}\n.dr-toolbar-button.wedo-xiankuan1:before,\n.dr-toolbar-button .wedo-xiankuan2:before,\n.dr-toolbar-button .wedo-xiankuan3:before,\n.dr-toolbar-button .wedo-xiankuan4:before,\n.dr-toolbar-button .wedo-xiankuan5:before,\n.dr-toolbar-button .wedo-xiankuan6:before {\n  position: absolute;\n  z-index: 2;\n  top: 1px;\n}\n.dr-toolbar-button.wedo-xiankuan1 .dr-toolbar-bgSupporter,\n.dr-toolbar-button .wedo-xiankuan2 .dr-toolbar-bgSupporter,\n.dr-toolbar-button .wedo-xiankuan3 .dr-toolbar-bgSupporter,\n.dr-toolbar-button .wedo-xiankuan4 .dr-toolbar-bgSupporter,\n.dr-toolbar-button .wedo-xiankuan5 .dr-toolbar-bgSupporter,\n.dr-toolbar-button .wedo-xiankuan6 .dr-toolbar-bgSupporter {\n  border-radius: 4px;\n  border: none;\n  height: 100%;\n  width: 100%;\n  background-color: #000;\n  left: 50%;\n  transform: translateX(-50%);\n}\n.dr-toolbar-button .dr-toolbar-toggler:checked ~ .dr-toolbar-bgSupporter {\n  display: block;\n}\n.dr-toolbar-combo {\n  border-right: 1px solid #626262;\n  display: inline-block;\n  padding: 0 5px 0 3px;\n  vertical-align: top;\n}\n.dr-toolbar-combo .wedofont {\n  line-height: 50px;\n  padding: 0;\n  font-size: 20px !important;\n}\n.wedo-delete {\n  line-height: 50px;\n  padding: 0;\n  font-size: 20px !important;\n}\n.dr-toolbar-button[disabled="true"] {\n  color: #666 !important;\n}\n.dr-toolbar-control-buttons {\n  display: inline-block;\n  left: 102%;\n  top: 0;\n  opacity: 0.8;\n  box-shadow: 0 3px 5px rgba(0, 0, 0, 0.5);\n  border-radius: 5px;\n  white-space: nowrap;\n  background: #222;\n  position: absolute;\n  padding: 0 10px;\n}\n.dr-toolbar-textbutton {\n  width: auto;\n  font-size: 13px;\n  height: 30px;\n  margin: 10px 0;\n  line-height: 30px;\n  padding: 0 15px;\n  color: #f2f2f2;\n  font-weight: 600;\n  border-radius: 5px;\n}\n.dr-markup-save {\n  background-color: #05a7df;\n}\n.dr-toolbar-expand {\n  position: absolute;\n  right: 4px;\n  top: 5px;\n  font-size: 10px;\n  color: #ccc !important;\n}\n.dr-toolbar-subgroup {\n  bottom: 120%;\n  opacity: 1 !important;\n  padding: 8px 15px 9px;\n}\n.dr-toolbar-subgroup.dr-toolbar-arrow_box:after,\n.dr-toolbar-subgroup .dr-toolbar-arrow_box:before {\n  top: 100%;\n  left: 50%;\n  border: solid transparent;\n  content: " ";\n  height: 0;\n  width: 0;\n  position: absolute;\n  pointer-events: none;\n  border-color: #222 transparent transparent;\n  opacity: 0.8;\n  border-width: 7px;\n  margin-left: -7px;\n}\n.wedo-arrow .dr-toolbar-subgroup,\n.wedo-dian-yinxianbiaozhu .dr-toolbar-subgroup,\n.wedo-rectangle .dr-toolbar-subgroup {\n  padding: 0 3px !important;\n}\ninput:checked ~ .dr-toolbar-title {\n  display: none !important;\n}\n.dr-toolbar-toggler,\n.dr-toolbar-toggler ~ .dr-toolbar-subgroup {\n  display: none;\n}\n.dr-toolbar-toggler:checked ~ .dr-toolbar-subgroup {\n  display: block;\n}\n.dr-toolbar-toggler:checked ~ .dr-toolbar-expand-down {\n  display: block;\n}\n.dr-toolbar-toggler:checked ~ .dr-toolbar-expand-up,\n.dr-toolbar-toggler ~ .dr-toolbar-expand-down {\n  display: none;\n}\n.dr-slider-group {\n  border-bottom: 1px solid #737373;\n  padding-bottom: 22px;\n}\n.dr-sliderlabels {\n  position: relative;\n  pointer-events: none;\n}\n.dr-sliderlabel {\n  position: absolute;\n  font-size: 9px;\n  top: 18px;\n  transform: translateX(-50%);\n  color: #737373;\n  font-weight: 600;\n  pointer-events: none;\n}\n.wedo-caret-down,\n.wedo-caret-up {\n  position: absolute;\n  right: 6px;\n  top: 33%;\n  font-size: 10px !important;\n  transform: translateY(-50%);\n}\n.wedo-caret-up:before {\n  font-size: 8px !important;\n}\n.wedo-caret-down:before {\n  font-size: 8px !important;\n}\n.dr-toolbar-group {\n  line-height: 1;\n}\n.dr-toolbar-group > .dr-toolbar-bgSupporter {\n  width: 81%;\n}\n.dr-toolbar-group:before {\n  margin-left: -5px;\n}\n.dr-toolbar-bgSupporter {\n  position: absolute;\n  top: 15%;\n  left: 10%;\n  width: 80%;\n  height: 70%;\n  border: 1px solid #4e4e4e;\n  display: none;\n  border-radius: 2px;\n  background-color: #000;\n  z-index: -1;\n}\n.dr-grid {\n  width: 278px;\n}\n.dr-grid td:nth-child(2n) {\n  padding-left: 20px;\n}\n.dr-toolbar-header {\n  cursor: pointer;\n  color: #737373 !important;\n  text-align: left;\n  padding: 12px 0 2px;\n  font-size: 12px !important;\n  font-weight: 500;\n}\n.dr-toolbar-header.wedo-text-style {\n  margin-left: 10px;\n}\n.dr-block .dr-toolbar-header:first-child {\n  padding-top: 6px;\n}\n.dr-block .dr-toolbar-expanded {\n  width: auto;\n}\n.markup-icon-other:before {\n  position: absolute;\n  z-index: 2;\n  left: 0;\n  font-size: 14px;\n  top: 7px;\n}\n.markup-icon-other .dr-toolbar-bgSupporter {\n  border-radius: 2px;\n  border: 1px solid #626262;\n  height: 70%;\n  width: 79%;\n  background-color: #000;\n}\n.dr-background-group:before {\n  padding-top: 0;\n  padding-left: 0;\n  font-size: 16px;\n  border: 2px solid #626262;\n}\n.dr-toolbar-expanded {\n  position: relative;\n}\n.dr-toolbar-expanded .dr-toolbar-expanded {\n  display: inline-block;\n  width: auto;\n}\n.dr-toolbar-expanded > .dr-toolbar-bgSupporter {\n  left: 0;\n}\n.dr-toolbar-expanded + .dr-toolbar-expanded > .dr-toolbar-bgSupporter {\n  border-bottom: 1px solid #575758;\n}\n.dr-toolbar-expanded:nth-child(2n) {\n  padding-top: 10px;\n}\n.markup-icon-color,\n.markup-icon-other {\n  padding: 5px;\n  width: 33px;\n  height: 34px;\n}\n.markup-icon-color:before,\n.markup-icon-other:before {\n  padding-left: 0;\n  margin-top: 1px;\n}\n.dr-bottom-border {\n  border-bottom: 1px solid #ccc;\n}\n.dr-trigger-element {\n  display: block;\n}\n.markup-icon-color {\n  margin: 0 auto;\n}\n.markup-icon-color .dr-toolbar-bgSupporter {\n  width: 65%;\n  height: 65%;\n  left: 18%;\n  top: 18%;\n  border: 2px solid #fff;\n}\n.dr-toolbar-tail {\n  border-right: 1px solid #4d4d4d;\n}\n.dr-slider-labels-parent {\n  position: relative;\n  max-width: 100%;\n  width: 75%;\n  margin: 10px 0;\n  height: 10px;\n  color: #757677;\n}\n.dr-slider-value-target {\n  position: absolute;\n  right: -60px;\n  top: -27px;\n}\n.dr-slider-value-target:before {\n  font-size: 18px;\n}\n.dr-slider-label {\n  font-size: 9px;\n  font-weight: 700;\n  display: inline-block;\n  text-align: center;\n}\n.dr-slider-labels-parent .dr-slider-label:first-child,\n.dr-slider-labels-parent .dr-slider-label:nth-child(2) {\n  text-align: left;\n}\n.dr-slider-parent {\n  position: relative;\n  height: 30px;\n  width: 200px;\n}\n.dr-slider {\n  display: block;\n  width: 100%;\n  max-width: 100%;\n  margin: 0;\n  cursor: pointer;\n}\n.dr-slider:focus {\n  outline: none;\n}\n.dr-slider,\n.dr-slider-progress {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n}\n.dr-slider-progress {\n  width: 93%;\n  height: 5px;\n  background-color: red;\n}\n.dr-sliderelement {\n  position: absolute;\n  left: 0;\n  top: 0;\n  overflow: visible;\n  z-index: 100;\n  cursor: pointer;\n}\n.dr-slidershell {\n  border: 0;\n  position: relative;\n  left: 0;\n  top: 0;\n  overflow: visible;\n  margin-top: 10px;\n}\n.dr-slidershell input[type="range"]::-ms-track {\n  width: 100%;\n  height: 100%;\n  -webkit-appearance: none;\n  margin: 0;\n  padding: 0;\n  border: 0;\n  background: transparent;\n  color: transparent;\n  overflow: visible;\n}\n.dr-slidershell input[type="range"]::-moz-range-track {\n  width: 100%;\n  height: 100%;\n  -moz-appearance: none;\n  margin: 0;\n  padding: 0;\n  border: 0;\n  background: transparent;\n  color: transparent;\n  overflow: visible;\n}\n.dr-slidershell input[type="range"] {\n  width: 100%;\n  height: 100%;\n  -webkit-appearance: none;\n  margin: 0;\n  padding: 0;\n  border: 0;\n  background: transparent;\n  color: transparent;\n  overflow: visible;\n}\n.dr-slidershell input[type="range"].slidervertical {\n  -webkit-appearance: slider-vertical;\n  writing-mode: bt-lr;\n  opacity: 0.01;\n}\n.dr-slidershell input[type="range"]:focus {\n  outline: none;\n}\n.dr-slidershell input[type="range"]:focus::-webkit-slider-runnable-track {\n  background: transparent;\n  border: transparent;\n}\n.dr-slidershell input[type="range"]::-ms-thumb {\n  width: 40px;\n  height: 40px;\n  border-radius: 0;\n  border: 0;\n  background: transparent;\n}\n.dr-slidershell input[type="range"]::-moz-range-thumb {\n  width: 40px;\n  height: 40px;\n  border-radius: 0;\n  border: 0;\n  background: transparent;\n}\n.dr-slidershell input[type="range"]::-webkit-slider-thumb {\n  width: 40px;\n  height: 40px;\n  border-radius: 0;\n  border: 0;\n  background: transparent;\n  -webkit-appearance: none;\n}\n.dr-slidershell input[type="range"]::-ms-tooltip {\n  display: none;\n}\n.dr-slidertrack {\n  width: 100%;\n  background-color: #000;\n}\n.dr-sliderfill,\n.dr-slidertrack {\n  border-radius: 4px;\n  position: absolute;\n}\n.dr-sliderfill {\n  opacity: 1;\n  pointer-events: none;\n  background: #05a7df;\n  z-index: 8;\n}\n.dr-sliderthumb {\n  width: 10px;\n  height: 10px;\n  background-color: #ededed;\n  border-radius: 10px;\n  left: 0;\n  top: 0;\n  z-index: 9;\n}\n.dr-sliderthumb,\n.dr-slidervalue {\n  position: absolute;\n  border: 0;\n  padding: 0;\n  margin: 0;\n  text-align: center;\n  pointer-events: none;\n}\n.dr-slidervalue {\n  width: 18px;\n  height: 18px;\n  line-height: 40px;\n  color: #fff;\n  font-family: helvetica, sans-serif;\n  font-size: 18px;\n  right: -36px;\n  top: -5px;\n  background-color: red;\n}\n.dr-slidershell input[type="range"]::-ms-fill-lower,\n.dr-slidershell input[type="range"]::-ms-fill-upper {\n  background: transparent;\n  border: 0;\n}\n.adsk-viewing-viewer .design-review-container *,\n.adsk-viewing-viewer .design-review-view-container * {\n  text-rendering: auto !important;\n}\n.marker-pin {\n  position: absolute;\n  height: 43px;\n  width: 36px;\n  z-index: 4;\n}\n.marker-pin .marker-pin-marker {\n  background: rgba(255, 51, 0, 0.6);\n  -webkit-box-shadow: 0 0 15px 2px rgb(0 0 0%);\n  -moz-box-shadow: 0 0 15px 2px rgba(0, 0, 0, 0.1);\n  box-shadow: 0 0 15px 2px rgb(0 0 0%);\n  font-size: 12px;\n  width: 28px;\n  height: 28px;\n  border-radius: 50% 50% 50% 0;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: rotate(-45deg);\n  margin: -17px 0 0 -14px;\n  cursor: pointer;\n  transition: background-color 0.5s ease;\n}\n.marker-pin .marker-pin-text {\n  opacity: 0.4;\n  position: absolute;\n  font-size: 17px;\n  line-height: 18.33px;\n  font-weight: 700;\n  color: #fff;\n  text-align: center;\n  pointer-events: none;\n  padding: 0 !important;\n  height: 20px !important;\n  width: 20px !important;\n  left: 22% !important;\n  top: 20% !important;\n  background-size: cover !important;\n}\n.markupClose {\n  position: absolute;\n  bottom: 10px;\n  font-size: 40px;\n  background-color: #4a4a4a;\n  color: #ebebeb;\n  width: 50px;\n  left: 50%;\n  line-height: 38px;\n  text-align: center;\n  cursor: pointer;\n  padding: 6px;\n  margin: 4px;\n  border: 1px solid rgba(34, 34, 34, 0);\n  border-radius: 4px;\n}\n/* .viewer-pin-point-loading {\n    background: url(https://pstatic.autodesk360.com/static/g/static/8.66.0.9d3c73a4e/assets/bf91c434100520e85da0ed968467c834.gif)\n      no-repeat;\n  } */\n',""]),e.exports=t},90927:(e,t,n)=>{"use strict";n.d(t,{qm:()=>r,dj:()=>s,dI:()=>l});var o=n(14100);const i=window.myGlobalParams.baseApi,a=[{name:"get-markup-list",headers:{"Content-Type":"application/x-www-form-urlencoded"},baseURL:i},{name:"get-markup-one",headers:{"Content-Type":"application/x-www-form-urlencoded"},baseURL:i},{name:"get-svg-dom-str",headers:{"Content-Type":"application/x-www-form-urlencoded"},baseURL:i},{name:"del-markup",headers:{"Content-Type":"application/x-www-form-urlencoded"},baseURL:i},{name:"save-markup",headers:{"Content-Type":"multipart/form-data"},baseURL:i},{name:"markup-svg-png-upload",headers:{"Content-Type":"multipart/form-data"},baseURL:i},{name:"change-markup-state",headers:{"Content-Type":"multipart/form-data"},baseURL:i},{name:"save-comment",headers:{"Content-Type":"multipart/form-data"},baseURL:i},{name:"get-comment-replys",headers:{"Content-Type":"application/x-www-form-urlencoded"},baseURL:i},{name:"search-markup-list",headers:{"Content-Type":"application/x-www-form-urlencoded"},baseURL:i}];function r(e){const t={method:"GET",url:"modelMarkup/get-markup-list",dataOrParams:e,name:"get-markup-list",isToken:!1};return new Promise(((e,n)=>{(0,o.Z)(a,t).then((t=>e(t))).catch((e=>n(e)))}))}function s(e){const t={method:"POST",url:"/modelMarkup/save-markup",dataOrParams:e,name:"save-markup",isToken:!1};return new Promise(((e,n)=>{(0,o.Z)(a,t).then((t=>e(t))).catch((e=>n(e)))}))}function l(e){const t={method:"POST",url:"/modelMarkup/markup-svg-png-upload",dataOrParams:e,name:"markup-svg-png-upload",isToken:!1};return new Promise(((e,n)=>{(0,o.Z)(a,t).then((t=>e(t))).catch((e=>n(e)))}))}},28278:(e,t,n)=>{"use strict";n.r(t);var o=function(){};o.extend=function(e,t){var n=o.prototype.extend;o._prototyping=!0;var i=new this;n.call(i,e),i.base=function(){},delete o._prototyping;var a=i.constructor,r=i.constructor=function(){if(!o._prototyping)if(this._constructing||this.constructor==r)this._constructing=!0,a.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],i)};return r.ancestor=this,r.extend=this.extend,r.forEach=this.forEach,r.implement=this.implement,r.prototype=i,r.toString=this.toString,r.valueOf=function(e){return"object"==e?r:a.valueOf()},n.call(r,t),"function"==typeof r.init&&r.init(),r},o.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var i=t.valueOf();(t=function(){var e=this.base||o.prototype.base;this.base=n;var t=i.apply(this,arguments);return this.base=e,t}).valueOf=function(e){return"object"==e?t:i},t.toString=o.toString}this[e]=t}else if(e){var a=o.prototype.extend;o._prototyping||"function"==typeof this||(a=this.extend||a);for(var r={toSource:null},s=["constructor","toString","valueOf"],l=o._prototyping?0:1;c=s[l++];)e[c]!=r[c]&&a.call(this,c,e[c]);for(var c in e)r[c]||a.call(this,c,e[c])}return this},on:function(e){var t=this;for(var n in t._handlers=t._handlers||{},e)t._handlers[n]=t._handlers[n]||[],t._handlers[n].push(e[n])},off:function(e,t){var n=this._handlers||{};if(e&&!t)delete n[e];else if(e||t){if(e&&t){var o=n[e];if(Array.isArray(o)){var i=o.indexOf(t);i>-1&&o.splice(i,1)}}}else delete this._handlers},emit:function(e){var t=this,n=t._handlers||{},o=n[e],i=Array.prototype.slice.call(arguments,1);Array.isArray(o)&&o.forEach((function(e){try{e.apply(t,i)}catch(e){console.log(e)}}))},set:function(e,t){this[e]=t,this.emit("change",e,t)},get:function(e){return this[e]}};var i={About:"marker设计工具",Version:"5",CONSTANTS:{PERSPECTIVE_MODE_SCALE:1e3,BROWSER_PREFIXES:["-ms-","-webkit-","-moz-","-o-",""],CROSS_BROWSER_STYLE_KEY:"-cb-",SVGNS:"http://www.w3.org/2000/svg",EDIT_LAYER_CLASS:"design-review-container",VIEW_LAYER_CLASS:"design-review-view-container",HOVER_DELAY:1e3,EDIT_LAYER_NAME:"svgElement",GROUP_ELEMENT_NAME:"groupElement",GROUP_CONNECTOR_ELEMENT_NAME:"groupConnectorsElement",RESPONDENT_ELEMENTS_GROUP:"visibleElements",SELECTOR_BOX_CLASSNAME:"designReview-selector-box",SELECTOR_BOX_CP_CLASSNAME:"selector-drag-point",IGNORE_CLICKS:"ignore-clicks-elements",LABEL_RESIZE:"LABEL_RESIZE",SAVE_OR_DIE:"SAVE_OR_DIE"},EVENT_NAMES:{EVENT_ENTER_EDIT_MODE:"EVENT_MARKUP_CORE_ENTER_EDIT_MODE",EVENT_LEAVE_EDIT_MODE:"EVENT_MARKUP_CORE_LEAVE_EDIT_MODE",EVENT_SELECTION_CHANGED:"EVENT_MARKUP_SELECTION_CHANGED",EVENT_SET_EDIT_LAYER_ATTRIBUTE:"EVENT_SET_EDIT_LAYER_ATTRIBUTE",EVENT_DRAG_START:"dragstart",EVENT_DRAGGING:"drag",EVENT_DRAG_END:"dragend",EVENT_SELECT:"select",EVENT_CLICK:"click",EVENT_DOUBLECLICK:"dblclick",MOUSE_MOVE:"mousemove",EVENT_HOVER_START:"hoverStart",EVENT_HOVER_END:"hoverEnd",EVENT_UNSELECT:"unselect",EVENT_EDIT_LAYER_RESIZE:"editlayer-resize"},Base:{Shape:null,Adaptor:null},Helpers:{Class:o=o.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var o in e)void 0===this.prototype[o]&&t.call(n,e[o],o,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}})},Extras:{},Shapes:{},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}};const a=i=i.Helpers.Class.extend(i),r={all_shortcuts:{},add:function(e,t,n){var o={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(n)for(var i in o)void 0===n[i]&&(n[i]=o[i]);else n=o;var a=n.target;"string"==typeof n.target&&(a=document.getElementById(n.target)),e=e.toLowerCase();var r=function(o){var i;if(o=o||window.event,n.disable_in_input&&(o.target?i=o.target:o.srcElement&&(i=o.srcElement),3==i.nodeType&&(i=i.parentNode),"INPUT"==i.tagName||"TEXTAREA"==i.tagName))return;let a,r;o.keyCode?a=o.keyCode:o.which&&(a=o.which);var s=String.fromCharCode(a).toLowerCase();188==a&&(s=","),190==a&&(s=".");var l=e.split("+"),c=0,d={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},p={esc:27,escape:27,tab:9,space:32,return:13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,break:19,insert:45,home:36,delete:46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},u={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};o.ctrlKey&&(u.ctrl.pressed=!0),o.shiftKey&&(u.shift.pressed=!0),o.altKey&&(u.alt.pressed=!0),o.metaKey&&(u.meta.pressed=!0);for(var h=0;r=l[h],h<l.length;h++)"ctrl"==r||"control"==r?(c++,u.ctrl.wanted=!0):"shift"==r?(c++,u.shift.wanted=!0):"alt"==r?(c++,u.alt.wanted=!0):"meta"==r?(c++,u.meta.wanted=!0):r.length>1?p[r]==a&&c++:n.keycode?n.keycode==a&&c++:(s==r||d[s]&&o.shiftKey&&(s=d[s])==r)&&c++;return c!=l.length||u.ctrl.pressed!=u.ctrl.wanted||u.shift.pressed!=u.shift.wanted||u.alt.pressed!=u.alt.wanted||u.meta.pressed!=u.meta.wanted||(t(o),n.propagate)?void 0:(o.cancelBubble=!0,o.returnValue=!1,o.stopPropagation&&(o.stopPropagation(),o.preventDefault()),!1)};this.all_shortcuts[e]={callback:r,target:a,event:n.type},a.addEventListener?a.addEventListener(n.type,r,!1):a.attachEvent?a.attachEvent("on"+n.type,r):a["on"+n.type]=r},remove:function(e){e=e.toLowerCase();var t=this.all_shortcuts[e];if(delete this.all_shortcuts[e],t){var n=t.event,o=t.target,i=t.callback;o.detachEvent?o.detachEvent("on"+n,i):o.removeEventListener?o.removeEventListener(n,i,!1):o["on"+n]=!1}}};a.prototype.Helpers.Class;var s=a.extend({constructor:function(e){var t=this,n=t.Helpers.Class.extend();t.attributesStore=new n,t.initialize(e)},setEditLayer:function(e){this[this.CONSTANTS.EDIT_LAYER_NAME_SHAPE]=e},eStart:function(){var e=this;e.editModeStart.apply(e,Array.prototype.slice.call(arguments,0))},eEnd:function(){var e=this;e.editModeEnd.apply(e,Array.prototype.slice.call(arguments,0))},screenToWorld:function(e){return e},worldToScreen:function(e){return e},screenSizeToWorld:function(e){return{height:e.height,width:e.width}},worldSizeToWorld:function(e){return{height:e.height,width:e.width}},editModeStart:function(){return!0},editModeEnd:function(){return!0},vlLoaded:function(){var e=this;"function"==typeof e.viewLayerLoaded&&e.viewLayerLoaded.apply(e,Array.prototype.slice.call(arguments,0))},vlUnloaded:function(){var e=this;"function"==typeof e.viewLayerUnloaded&&e.viewLayerUnloaded.apply(e,Array.prototype.slice.call(arguments,0))},save:function(e){},destroy:function(){},parseSVG:function(){}});a.prototype.Base.Adapter=s;const l=s;var c=l.extend({initialize:function(e){var t=this;t.About="Adaptor for Wedo Markup",t.viewer=e.viewer,t.options=e.options||{},t.__PRIVATE__svg_position_events_set=t.__PRIVATE__svg_position_events()},clientToViewport:function(e,t,n){return n.impl.clientToViewport(e,t)},clientToWorld:function(e,t,n,o){var i=this.clientToViewport(e,t,o);return i.z=n,i.unproject(o.impl.camera),i},clientToMarkups:function(e,t){var n=this,o=n.viewer,i=o.model,a=o.impl,r=n.CONSTANTS.PERSPECTIVE_MODE_SCALE,s=a.camera,l=new THREE.Vector3(e,t,0);if(s.isPerspective){var c=a.canvas.getBoundingClientRect();l.x=(l.x-.5*c.width)/(.5*c.height)*r,l.y=-(l.y-.5*c.height)/(.5*c.height)*r}else{l=n.clientToWorld(l.x,l.y,0,o);var d=i.getData().globalOffset;d&&l.add(d),l.add(s.position),l.applyMatrix4(s.matrixWorldInverse),l.z=0}return l},worldToViewport:function(e,t){var n=new THREE.Vector3;return n.x=e.x,n.y=e.y,n.z=e.z,n.project(t.impl.camera),n},viewportToClient:function(e,t,n){return n.impl.viewportToClient(e,t)},worldToClient:function(e,t,n){var o=this.worldToViewport(e,t),i=this.viewportToClient(o.x,o.y,t);return i.z=0,n&&(i.x=Math.floor(i.x)+.5,i.y=Math.floor(i.y)+.5),i},markupsToClient:function(e,t){var n=this,o=n.viewer,i=o.model,a=o.impl,r=n.CONSTANTS.PERSPECTIVE_MODE_SCALE,s=a.camera,l=new THREE.Vector3(e,t,0);if(s.isPerspective){var c=a.canvas.getBoundingClientRect();l.x=l.x/r*(.5*c.height)+.5*c.width,l.y=-l.y/r*(.5*c.height)+.5*c.height}else{l.applyMatrix4(s.matrixWorld),l.sub(s.position);var d=i.getData().globalOffset;d&&l.sub(d),(l=n.worldToClient(l,o,!1)).z=0}return l},__PRIVATE__viewboxCalculator:function(e,t){var n=this.clientToMarkups(0,0),o=this.clientToMarkups(t,e),i=Math.min(n.x,o.x),a=Math.min(n.y,o.y),r=[i,a,Math.max(n.x,o.x)-i,Math.max(n.y,o.y)-a].join(" ");if("NaN NaN NaN NaN"!==r)return r},__PRIVATE__svg_position_events:function(){var e=this,t=e.viewer,n=Autodesk.Viewing;function o(o){var i=o?"removeEventListener":"addEventListener";t[i](n.EXPLODE_CHANGE_EVENT,e.__PRIVATE__getViewbox_instance),t[i](n.CAMERA_CHANGE_EVENT,e.__PRIVATE__getViewbox_instance)}return e.__PRIVATE__getViewbox_instance=e.svgOperations.bind(e),o(),{cancel:function(){o(!0)}}},disableNavigation:function(e){var t=this,n=t.viewer;t.__PRIVATE__navigation_lock_settings=JSON.parse(JSON.stringify(n.getNavigationLockSettings()));var o=JSON.parse(JSON.stringify(t.__PRIVATE__navigation_lock_settings));n.setActiveNavigationTool("pan"),o.pan=!0,e||(o.zoom=!0),n.setNavigationLockSettings(o),n.setNavigationLock(!0),n.toolbar&&n.toolbar.setDisplay("none")},enableNavigation:function(){var e=this,t=e.viewer;e.__PRIVATE__navigation_lock_settings&&(t.toolbar&&t.toolbar.setDisplay("block"),t.setNavigationLockSettings(e.__PRIVATE__navigation_lock_settings),t.setNavigationLock(!1))},svgOperations:function(e){var t=this,n=(e=e||{target:t.viewer}).camera||e.target.impl.camera,o=e.height||n.clientHeight,i=e.width||n.clientWidth,a=t.__PRIVATE__viewboxCalculator.call(t,o,i);a&&(t.attributesStore.set("viewBox",a),t.attributesStore.set("width",i),t.attributesStore.set("height",o));var r=t.screenSizeToWorld({height:0,width:5}).width,s=t.screenSizeToWorld({height:0,width:12}).width,l={"stroke-width":{xsmall:.5*r,small:r,medium:1.5*r,xmedium:2*r,large:2.5*r,xlarge:3*r},"font-size":{small:s,medium:1.5*s,large:3*s}};t.attributesStore.set("styleReferences",l)},viewLayerLoaded:function(){var e=this.viewer;e&&e.model&&this.disableNavigation(!0)},viewLayerUnloaded:function(){var e=this.viewer;e&&e.model&&this.enableNavigation()},editModeStart:function(){var e=this;e.editMode=!0,e.svgOperations(),e.viewer.toolbar.setVisible(!1),e.viewer.model&&!e.viewer.model.is2d()&&e.designReviewInstance.unloadViewLayers(),e.disableNavigation(),e.userInstance&&"function"==typeof e.userInstance.editModeStart&&e.userInstance.editModeStart()},editModeEnd:function(){var e=this;e.editMode&&(e.editMode=!1,e.enableNavigation(),e.userInstance&&"function"==typeof e.userInstance.editModeEnd&&e.userInstance.editModeEnd())},screenToWorld:function(e){return this.clientToMarkups(e.x,e.y)},worldToScreen:function(e){return this.markupsToClient(e.x,e.y)},screenSizeToWorld:function(e){var t=e.height,n=e.width,o=this.clientToMarkups(0,0),i=this.clientToMarkups(n,t);return{width:Math.abs(i.x-o.x),height:Math.abs(i.y-o.y)}},worldSizeToScreen:function(e){var t=e.height,n=e.width,o=this.markupsToClient(0,0),i=this.markupsToClient(n,t);return{width:Math.abs(i.x-o.x),height:Math.abs(i.y-o.y)}},destroy:function(){var e=this;e.editModeEnd(),e.__PRIVATE__svg_position_events_set&&e.__PRIVATE__svg_position_events_set.cancel(),e.enableNavigation()},getBackgroundImage:function(){var e=this.viewer;return new Promise((function(t,n){var o=new Image;o.addEventListener("load",(function(){var n=document.createElement("canvas"),i=e.container.getBoundingClientRect();n.width=i.width,n.height=i.height;var a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),a.drawImage(o,0,0,n.width,n.height),t(n.toDataURL("image/png"))})),e.getScreenShot(e.container.clientWidth,e.container.clientHeight,(function(e){o.src=e}))}))},save:function(e,{visible:t,confirmLoading:n,message:o}){var i=this,a=e.markup,r=e.boundingBoxes,s=e.toolsUsed;r.forEach((function(e){s[e.type]=0}));var l=i.generatePoints3d(r);i.userInstance&&"function"==typeof i.userInstance.save&&i.userInstance.save({markup:a,point:l,tools:s,asImage:e.asImage,othersInfos:e.othersInfos},{visible:t,confirmLoading:n,message:o})},hitTest:function(e,t,n){var o;if(e.model.is2d()){var i=e.impl.intersectGround(t,n),a=e.model.getData(),r={fragId:-1,intersectPoint:new THREE.Vector3};if(i){i.z=0;var s=e.model.getData().bbox;(a.hidePaper||s.containsPoint(i))&&(r.intersectPoint.copy(i),o=r)}}else o=e.impl.hitTest(t,n,!1);return o},generatePoint:function(e){var t=this,n=t.viewer,o=e.metadata,i=e.boundingBox,a=[o.position];return a.push.apply(a,i),a.map((function(e){var o=t.worldToScreen(e),i=n.clientToWorld(o.x,o.y,!0),a=t.hitTest(n,o.x,o.y,!0);if(n.model.is2d(),a)return a.point=i,a})).filter((function(e){return e}))[0]},generatePoints3d:function(e){var t=this,n={points:[],mainPoint:null};return e.forEach((function(e){var o=t.generatePoint(e);o&&n.points.push(o.intersectPoint)})),n.mainPoint=n.points[n.points.length-1],n},parseSVG:function(e){var t=this,n=t.viewer,o=n.impl.camera,i=function(e,i){var a=t.clientToWorld(e,i,0,n),r=n.model.getData().globalOffset;return r&&a.sub(r),a.add(o.position),a.applyMatrix4(o.matrixWorldInverse),a.z=0,a},a=function(){for(var e=document.getElementsByTagName("clipPath"),t=e.length,n=0,o=0;o<t;++o){var i=e[o].id;-1!==i.indexOf("markup-clipper-")&&(i=i.replace("markup-clipper-",""),n=Math.max(n,i))}return n+1}(),r=function(e){if("markup_element"===e.tagName&&"label"===e.getAttribute("type")){var t=e.parentNode.parentNode.childNodes[1].childNodes[0],n="markup-clipper-"+a++,o="url(#"+n+")";t.setAttribute("id",n),t.parentNode.setAttribute("clip-path",o)}else for(var i=e.childNodes,s=i.length,l=0;l<s;++l)r(i[l])},s=function(e){var t=null;try{t=(new DOMParser).parseFromString(e,"text/xml").firstChild}catch(e){t=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return t}(e);if(!s)return!1;var l,c="data-model-version",d=s.querySelector("["+c+"]"),p=parseFloat(d&&d.getAttribute(c)||4),u={x:0,y:0},h=n.model.getData().globalOffset;if(p<2&&h){var f=i(0,0).sub((0,0,(l=t.clientToWorld(0,0,0,n)).add(o.position).applyMatrix4(o.matrixWorldInverse),l.z=0,l));u.x+=f.x,u.y+=f.y}if(p<4&&h&&!o.isPerspective){var g=t.clientToMarkups(0,0).sub(i(0,0));u.x+=g.x,u.y+=g.y}var m=null;p<4&&o.isPerspective&&(m=t.CONSTANTS.PERSPECTIVE_MODE_SCALE),p>=3&&r(s);var v=function(e){if(e.getElementsByTagName)for(var t=e.getElementsByTagName("metadata"),n=0;n<t.length;++n){var o=t[n];o.parentNode&&o.parentNode.removeChild(o)}var i=e.children||e.childNodes;if(i)for(n=0;n<i.length;++n)v(i[n])};v(s);for(var y=document.createElementNS(t.CONSTANTS.SVGNS,"g"),_=s.childNodes;_.length;){var E=_[0],S=E.getAttribute("transform")||"";0===u.x&&0===u.y||(S="translate("+u.x+", "+u.y+") "+S),m&&(S="scale("+m+", "+m+") "+S),(u||m)&&E.setAttribute("transform",S),y.appendChild(E),E.setAttribute("pointer-events","none")}return y}});l.prototype.Extras.lmvAdapter=c;var d=a.extend({constructor:function(e){var t=this,n=t.Helpers.Class.extend();t.styleStore=new n,t.__PRIVATE__appendedToScreen=[],t.designReviewInstance=e.designReviewInstance,t.screenContainer=t.designReviewInstance.container,t.initialize(e),t.designReviewInstance.setStyle(t.collectedStyle,t.styleMapping)},collectedStyle:{"fill-color":"#ff284f","fill-opacity":0,"stroke-color":"#ff284f","stroke-opacity":1,"stroke-width":"@small","font-color":"#ff284f","font-size":"@medium","font-decoration":"normal","font-style":"normal","font-weight":"normal","font-family":"Helvetica Neue"},styleMapping:{"font-decoration":"text-decoration","fill-color":"fill","stroke-color":"stroke","fill-opacity":"fill-opacity","stroke-opacity":"stroke-opacity","stroke-width":"stroke-width","font-size":"font-size","font-style":"font-style","font-weight":"font-weight","font-family":"font-family"},eStart:function(){var e=this;e.editModeStart.apply(e,Array.prototype.slice.call(arguments,0))},eEnd:function(){var e=this;e.detachAllAttachedToScreen(),e.editModeEnd.apply(e,Array.prototype.slice.call(arguments,0))},appendToScreen:function(e){this.__PRIVATE__appendedToScreen.push(e),e.classList.add("design-review-pe-none"),this.screenContainer.appendChild(e)},detachFromScreen:function(e){try{this.screenContainer.removeChild(e)}catch(e){}},detachAllAttachedToScreen:function(){var e=this;e.__PRIVATE__appendedToScreen.forEach((function(t){t.parentNode&&e.detachFromScreen(t)})),e.__PRIVATE__appendedToScreen=[]},setShape:function(e){this.designReviewInstance.activateShape(e)},setStyle:function(e,t){this.collectedStyle[e]=t,this.updateStyle()},getStyleValue:function(){var e=this;return e.designReviewInstance.getStyleValue.apply(e.designReviewInstance,arguments)},executeAction:function(e){this.designReviewInstance.editMode&&this.designReviewInstance.executeAction(e)},editModeStart:function(){return!0},editModeEnd:function(){return!0},updateStyle:function(){var e=JSON.parse(JSON.stringify(this.collectedStyle));this.designReviewInstance.updateStyle(e)},currentState:function(){},activeShape:function(){},loadStyleFor:function(){}});a.prototype.Base.Toolbar=d;const p=d,u={controlButtons:[{type:"button",title:"关闭",action:"action:cancel",class:["dr-markup-cancel"]},{type:"button",title:"保存",action:"action:save",class:["dr-markup-save"]}],Triggers:[[{class:["wedofont","wedo-draw-comments"],title:"自由绘制",type:"trigger",selected:!0,id:"Pencil",category:"shape",style:{lineHeight:"50px",padding:"0px"},action:"shape:Pencil"},{type:"group",class:["wedofont","wedo-arrow"],title:"直线工具",category:"group",children:[{class:["wedofont","wedo-arrow"],title:"箭头",type:"trigger",id:"Arrow",category:"shape",action:"shape:Arrow"},{class:["wedofont","wedo-zhixian"],title:"直线",type:"trigger",id:"Line",category:"shape",action:"shape:Line"}],id:"Open"},{type:"group",class:["wedofont","wedo-rectangle"],title:"画框工具",category:"group",children:[{class:["wedofont","wedo-rectangle"],title:"矩形",type:"trigger",id:"Rectangle",category:"shape",action:"shape:Rectangle"},{class:["wedofont","wedo-icon-round-no"],title:"圆形",type:"trigger",id:"Ellipse",category:"shape",action:"shape:ellipse"},{class:["wedofont","wedo-yunxian"],title:"云线",type:"trigger",id:"Cloud",category:"shape",action:"shape:Cloud"},{class:["wedofont","wedo-zidingyiyunxian"],title:"自定义云线",type:"trigger",id:"polyCloud",category:"shape",action:"shape:polyCloud"},{class:["wedofont","wedo-duoduanxian"],title:["多段线"],type:"trigger",id:"Polygon",category:"shape",action:"shape:Polygon"}],id:"Closed"},{type:"group",class:["wedofont","wedo-dian-yinxianbiaozhu"],title:"引线标注",category:"group",children:[{class:["wedofont","wedo-dian-yinxianbiaozhu"],title:"点-引线标注",id:"pointCallout",type:"trigger",category:"shape",action:"shape:pointCallout"},{class:["wedofont","wedo-juxing-yinxianbiaozhu"],title:"矩形-引线标注",id:"rectangleCallout",type:"trigger",category:"shape",action:"shape:rectangleCallout"},{class:["wedofont","wedo-yuan-yinxianbiaozhu"],title:"圆-引线标注",id:"circleCallout",type:"trigger",category:"shape",action:"shape:circleCallout"},{class:["wedofont","wedo-yunxian-yinxianbiaozhu"],title:"云线-引线标注",id:"cloudCallout",type:"trigger",category:"shape",action:"shape:cloudCallout"},{class:["wedofont","wedo-yunxian-yinxianbiaozhu"],title:"自定义云线-引线标注",id:"polycloudCallout",type:"trigger",category:"shape",action:"shape:polycloudCallout"},{class:["wedofont","wedo-duoduanxian-yinxianbiaozhu"],title:"多段线-引线标注",id:"polygonCallout",type:"trigger",category:"shape",action:"shape:polygonCallout"}],id:"Callouts"},{id:"background",type:"group",title:"填充色",class:["wedofont","wedo-fangkuai"],hideForShapes:["Pencil","Arrow","Line"],category:"group",style:{color:"@fill-color"},children:[{id:"background-opacity",type:"slider",title:"透明度",category:"background-opacity",class:[],config:{min:0,value:.01,max:1,step:.05},style:{"background-color":"@fill-color"},action:"style:fill-opacity:@"},{id:"background-color",type:"expanded",title:"背景颜色",category:"background-color",class:[],children:[{class:["wedofont","wedo-fangkuai"],type:"trigger",selected:!0,id:"__bg__red",category:"background-color",style:{color:"#ff284f"},action:"style:fill-color:#ff284f"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__bg__orange",category:"background-color",style:{color:"#ff9700"},action:"style:fill-color:#ff9700"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__bg__yellow",category:"background-color",style:{color:"#ffda00"},action:"style:fill-color:#ffda00"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__bg__blue",category:"background-color",style:{color:"#0071fe"},action:"style:fill-color:#0071fe"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__bg__tblue",category:"background-color",style:{color:"#67dfff"},action:"style:fill-color:#67dfff"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__bg__green",category:"background-color",style:{color:"#3ae128"},action:"style:fill-color:#3ae128"}]}]},{id:"stroke",type:"group",style:{color:"@stroke-color"},title:"线样式",class:["wedofont","wedo-xianxing"],hideForShapes:[],category:"group",grid:[[0],[1,2]],children:[{id:"stroke-width",type:"expanded",title:"线宽度",category:"style",class:[],children:[{class:["wedofont","wedo-xiankuan1"],type:"trigger",id:"__stroke__width__1",category:"stroke-width",style:{color:"@stroke-color"},action:"style:stroke-width:@xsmall"},{class:["wedofont","wedo-xiankuan2"],type:"trigger",id:"__stroke__width__2",category:"stroke-width",style:{color:"@stroke-color"},action:"style:stroke-width:@small"},{class:["wedofont","wedo-xiankuan3"],type:"trigger",id:"__stroke__width__3",category:"stroke-width",selected:!0,style:{color:"@stroke-color"},action:"style:stroke-width:@medium"},{class:["wedofont","wedo-xiankuan4"],type:"trigger",id:"__stroke__width__4",category:"stroke-width",selected:!0,style:{color:"@stroke-color"},action:"style:stroke-width:@xmedium"},{class:["wedofont","wedo-xiankuan5"],type:"trigger",id:"__stroke__width__5",category:"stroke-width",style:{color:"@stroke-color"},action:"style:stroke-width:@large"},{class:["wedofont","wedo-xiankuan6"],type:"trigger",id:"__stroke__width__6",category:"stroke-width",style:{color:"@stroke-color"},action:"style:stroke-width:@xlarge"}]},{id:"stroke-opacity",type:"slider",title:"透明度",category:"stroke-opacity",class:[],config:{min:0,value:1,max:1,step:.05},style:{"background-color":"@stroke-color"},action:"style:stroke-opacity:@"},{id:"stroke-color",type:"expanded",title:"线颜色",category:"style",class:[],children:[{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__stroke__red",category:"style",selected:!0,style:{color:"#ff284f",lineHeight:"50px",padding:"0px"},action:"style:stroke-color:#ff284f"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__stroke__orange",category:"style",style:{color:"#ff9700",lineHeight:"50px",padding:"0px"},action:"style:stroke-color:#ff9700"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__stroke__yellow",category:"style",style:{color:"#ffda00",lineHeight:"50px",padding:"0px"},action:"style:stroke-color:#ffda00"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__stroke__blue",category:"style",style:{color:"#0071fe",lineHeight:"50px",padding:"0px"},action:"style:stroke-color:#0071fe"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__stroke__tblue",category:"style",style:{color:"#67dfff",lineHeight:"50px",padding:"0px"},action:"style:stroke-color:#67dfff"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__stroke__green",category:"style",style:{color:"#3ae128",lineHeight:"50px",padding:"0px"},action:"style:stroke-color:#3ae128"}]}]}],[{class:["wedofont","wedo-text"],title:"文字",type:"trigger",id:"Text",category:"shape",action:"shape:Text"},{id:"font",type:"group",title:"文字样式",class:["wedofont","wedo-icon_wenzi"],showForShapes:["Text"],category:"group",style:{color:"@stroke-color"},children:[{id:"font-size-others",type:"expanded",category:"group",style:{"border-bottom":"1px solid #6C6C6C"},children:[{id:"text-width",type:"expanded",title:"文字大小",category:"style",class:["wedo-text-style"],style:{"margin-bottom":"5px"},tailNode:!0,children:[{class:["wedofont","wedo-text","text-small"],type:"trigger",id:"__text_width__3",category:"text-width",style:{color:"@font-color",lineHeight:"50px",padding:"0px"},action:"style:font-size:@small"},{class:["wedofont","wedo-text","text-medium"],type:"trigger",id:"__text_width__2",category:"text-width",selected:!0,style:{color:"@font-color",lineHeight:"50px",padding:"0px"},action:"style:font-size:@medium"},{class:["wedofont","wedo-text","text-large"],type:"trigger",id:"__text_width__1",category:"text-width",style:{color:"@font-color",lineHeight:"50px",padding:"0px"},action:"style:font-size:@large"}]},{id:"text-style",type:"expanded",title:"文字样式",category:"style",class:["wedo-text-style"],style:{"margin-bottom":"5px"},children:[{class:["wedofont","wedo-cuti"],type:"trigger",id:"__text_style__bold",category:"text-style-bold",toggle:!0,style:{color:"@font-color",lineHeight:"50px",padding:"0px"},defaultAction:"style:font-weight:normal",action:"style:font-weight:bold"},{class:["wedofont","wedo-xieti"],type:"trigger",id:"__text_style__italic",category:"text-style-italic",toggle:!0,defaultAction:"style:font-style:normal",style:{color:"@font-color",lineHeight:"50px",padding:"0px"},action:"style:font-style:italic"},{class:["wedofont","wedo-underline"],type:"trigger",id:"__text_style__underline",category:"text-style-underline",toggle:!0,defaultAction:"style:font-decoration:normal",style:{color:"@font-color",lineHeight:"50px",padding:"0px"},action:"style:font-decoration:underline"}]}]},{id:"font-color",type:"expanded",title:"文字颜色",category:"style",class:["wedo-text-style"],children:[{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__text_color__red",category:"font-color",style:{color:"#ff284f",lineHeight:"50px",padding:"0px"},selected:!0,action:"style:font-color:#ff284f"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__text_color__orange",category:"font-color",style:{color:"#ff9700",lineHeight:"50px",padding:"0px"},action:"style:font-color:#ff9700"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__text_color__yellow",category:"font-color",style:{color:"#ffda00",lineHeight:"50px",padding:"0px"},action:"style:font-color:#ffda00"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__text_color__blue",category:"font-color",style:{color:"#0071fe",lineHeight:"50px",padding:"0px"},action:"style:font-color:#0071fe"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__text_color__tblue",category:"font-color",style:{color:"#67dfff",lineHeight:"50px",padding:"0px"},action:"style:font-color:#67dfff"},{class:["wedofont","wedo-fangkuai"],type:"trigger",id:"__text_color__green",category:"font-color",style:{color:"#3ae128",lineHeight:"50px",padding:"0px"},action:"style:font-color:#3ae128"}]}]}],[{class:["wedofont","wedo-jianqie"],title:"剪切",type:"trigger",id:"Cut",category:"action",action:"action:cut",enabled:"hasSelection"},{class:["wedofont","wedo-fuzhi"],title:"复制",type:"trigger",id:"Copy",category:"action",action:"action:copy",enabled:"hasSelection"},{class:["wedofont","wedo-niantie"],title:"粘贴",type:"trigger",id:"Paste",category:"action",action:"action:paste",enabled:"hasClipboard"}],[{class:["wedofont","wedo-undo"],title:"返回上一步",type:"trigger",id:"Undo",category:"action",action:"action:undo",enabled:"hasUndo"},{class:["wedofont","wedo-redo"],title:"返回下一步",type:"trigger",id:"Redo",category:"action",action:"action:redo",enabled:"hasRedo"}],{class:["wedofont","wedo-delete"],title:"删除",type:"trigger",id:"Delete",category:"action",action:"action:delete",enabled:"hasSelection"}]};var h=p.extend({initialize:function(e){var t=this;t.About="markers plugin of wedo plugins",t.options=e.options||{},t.toolbarConfig=u},attachToolbar:function(){var e=this,t=e.toolbarConfig.Triggers,n=e.toolbarConfig.controlButtons,o=document.createElement("div");o.classList.add("dr-toolbar","dr-toolbar-center");var i=function(e,t){if(t.title){var n=document.createElement("div");if(n.classList.add("dr-toolbar-header"),t.class&&t.class[0])for(const e of t.class)n.classList.add(e);n.innerHTML=t.title,e.insertBefore(n,e.firstChild)}},a=function(e,t,n){if(t.children){e.classList.add("dr-toolbar-parent");var o=e;return"expanded"!==t.type&&(o=document.createElement("div"),n||o.classList.add("dr-toolbar-subgroup","dr-toolbar-center","dr-toolbar-arrow_box"),e.appendChild(o)),t.children.forEach((function(e){o.appendChild(d[e.type](e))})),o}},r=function(e){var t=document.createElement("div");t.classList.add("dr-toolbar-expand","dr-toolbar-expand-up","wedofont","wedo-caret-up"),e.appendChild(t);var n=document.createElement("div");n.classList.add("dr-toolbar-expand","dr-toolbar-expand-down","wedofont","wedo-caret-down"),e.appendChild(n)},s=function(e){var t=document.createElement("div");return t.classList.add("dr-toolbar-bgSupporter"),e.appendChild(t),t},l=function(e,t){var n=e.group?null:s(t);if(e.style)for(var o in e.style){var i=e.style[o];if(i.indexOf&&0===i.indexOf("@")){var a=t.getAttribute("subscribing")||"";a+=o+":"+i.substring(1)+";",t.setAttribute("subscribing",a)}else t.style[o]=i,n&&(n.style[o]=i)}},c=function(e,t,n){var o=document.createElement("label");if(o.classList.add.apply(o.classList,e.class),t?o.classList.add("dr-trigger-element"):(o.classList.add("dr-toolbar-button"),function(e,t){var n=t.id;if("action"!==t.category){e.setAttribute("for",n);var o=document.createElement("input");if(o.type=t.toggle?"checkbox":"radio",o.id=n,o.checked=!!t.selected,o.name=t.category.toLowerCase()+"-expander",o.classList.add("dr-toolbar-toggler"),"group"===t.type){var i=function(t){if(t.target===e&&!t.target.getAttribute("disabled")){var n=o.checked;setTimeout((function(){o.checked=!n}),200)}};e.addEventListener("mousedown",i),e.addEventListener("touchstart",i)}e.appendChild(o)}else e.classList.add("dr-toolbar-action")}(o,e)),n||l(e,o),e.action&&o.setAttribute("action",e.action),e.tailNode&&o.classList.add("dr-toolbar-tail"),e.toggle&&o.setAttribute("defaultAction",e.defaultAction),e.title){var i=document.createElement("span");i.innerHTML=e.title,i.classList.add("dr-toolbar-title","dr-toolbar-center"),o.appendChild(i)}return e.enabled&&o.setAttribute("enabled",e.enabled),e.hideForShapes&&o.setAttribute("hideForShapes",e.hideForShapes.join(":")),e.showForShapes&&o.setAttribute("showForShapes",e.showForShapes.join(":")),o},d={group:function(e){var t=c(e);if(t.classList.add("dr-toolbar-group"),e.grid){var n=JSON.parse(JSON.stringify(e)),o=document.createElement("div");n.children=[],(o=a(o,n)).classList.add("dr-block-parent");var i=document.createElement("table");i.classList.add("dr-grid");var s=document.createElement("tr");i.appendChild(s),e.grid.forEach((function(t){n.children=[],t.forEach((function(t){n.children.push(e.children[t])}));var o=document.createElement("td");a(o,n,!0).classList.add("dr-block"),s.appendChild(o)})),o.appendChild(i),r(t),t.appendChild(o)}else a(t,e),r(t);return e.tailNode&&t.classList.add("dr-toolbar-tail"),t},trigger:c,expanded:function(e){var t=c(e,!0);t.classList.add("dr-toolbar-group","dr-toolbar-expanded");var n=a(t,e);return n&&(s(n),i(n,e),e.tailNode&&n.classList.add("dr-toolbar-tail")),t},slider:function(e){var t=c(e,!0,!0);t.classList.add("dr-toolbar-group","dr-toolbar-expanded","dr-slider-group");var n=document.createElement("div");n.setAttribute("action",e.action),n.classList.add("dr-slidershell"),n.appendChild(document.createElement("div")).classList.add("dr-sliderfill"),n.appendChild(document.createElement("div")).classList.add("dr-slidertrack"),n.appendChild(document.createElement("div")).classList.add("dr-sliderthumb");var o=n.appendChild(document.createElement("div"));o.classList.add("dr-slidervalue"),l(e,o);var a=n.appendChild(document.createElement("input"));a.setAttribute("type","range"),a.classList.add("dr-sliderelement");var r=n.appendChild(document.createElement("div"));r.classList.add("dr-sliderlabels");var s={0:4,100:100};[0,25,50,75,100].forEach((function(e){var t=document.createElement("span");t.classList.add("dr-sliderlabel"),t.style.left=(s[e]||e)+"%",t.innerHTML=e+"%",r.appendChild(t)}));var d=e.config;if(d)for(var p in d)a.setAttribute(p,d[p]);t.appendChild(n);var u=function(){var e,t,n,o,i,a,r,s,l,c;e=this.sliderelement.value,n=(t=this.groupElement).querySelector(".dr-sliderthumb"),o=t.querySelector(".dr-slidershell"),i=t.querySelector(".dr-slidertrack"),a=t.querySelector(".dr-sliderfill"),r=t.querySelector(".dr-slidervalue"),c=155*(l=e/((s=t.querySelector(".dr-sliderelement")).max-s.min)),r&&(r.style.opacity=l+.2>1?1:l+.2,r.style.right="-25px",r.style.top="-5px"),n.style.top="0px",n.style.left=c+"px",a.style.top="2px",a.style.left="0px",a.style.width=c+5+"px",a.style.height="6px",o.style.height="25px",o.style.width="165px",i.style.height="6px",i.style.width="161px",i.style.left="0px",i.style.top="2px"}.bind({groupElement:t,sliderelement:a});return a.addEventListener("input",u),a.addEventListener("change",u),u(),document.createElement("div").classList.add(),i(t,e),t}};t.forEach((function(e){if(Array.isArray(e)){var t=o.appendChild(document.createElement("div"));t.classList.add("dr-toolbar-combo"),e.forEach((function(e){var n=d[e.type](e);t.appendChild(n)}))}else{var n=d[e.type](e);o.appendChild(n)}}));var p=document.createElement("div");p.classList.add("dr-toolbar-control-buttons"),n.forEach((function(e){var t=document.createElement("div");p.appendChild(t),t.innerHTML=e.title,t.classList.add.apply(t.classList,e.class),t.setAttribute("action",e.action),t.classList.add("dr-toolbar-button","dr-toolbar-textbutton","dr-toolbar-action")})),o.appendChild(p),e.appendToScreen(o),e.toolbarElement=o;for(var u=e.toolbarElement.querySelectorAll("label[action] input:checked"),h=0;h<u.length;h++)e.changeHandler(u[h]);e.attachListeners()},parseAction:function(e,t){var n=this;if(e||t){t=t||e.getAttribute("action");var o=e.querySelector("input");if(o&&!o.checked&&["checkbox","radio"].indexOf(o.getAttribute("type"))>-1&&(t=e.getAttribute("defaultAction")),"true"!==e.getAttribute("disabled")&&t){try{t=t.split(":")}catch(e){t=null,console.error(e)}if(!t)return;switch(t[0]){case"shape":n.setShape(t[1]);break;case"style":var i=t[2];"@"===i&&(i=o.value),n.setStyle(t[1],i),n.updateStyleSubscribers();break;case"action":n.executeAction(t[1])}}}},updateStyleSubscribers:function(){for(var e=this,t=e.toolbarElement.querySelectorAll("[subscribing]"),n=0;n<t.length;n++)!function(t){var n=t.getAttribute("subscribing");n&&(n=n.split(";")).forEach((function(n){if(2===(n=n.split(":")).length){var o=e.getStyleValue(n[1]);o&&(t.style[n[0]]=o)}}))}(t[n])},changeHandler:function(e){var t=e.parentNode;this.parseAction(t)},attachListeners:function(){var e=this,t=e.toolbarElement,n=function(t){!e.ignoreChanges&&e.changeHandler(t.target)};t.addEventListener("change",n),t.addEventListener("input",n),t.addEventListener("click",(function(t){var n=t.target;n.classList.contains("dr-toolbar-action")&&e.parseAction(n)}))},loadStyle:function(e){var t=this;t.ignoreChanges=!0;for(var n=t.toolbarElement,o=n.querySelectorAll('[action*="style"] input'),i=0;i<o.length;i++)o[i].checked=!1;for(i in e){var a="["+('action="style:'+i+":"+e[i]+'"] input'),r=n.querySelectorAll(a);0===r.length&&(r=n.querySelectorAll('[action="style:'+i+':@"] input'));for(var s=0;s<r.length;s++)if(["radio","checkbox"].indexOf(r[s].getAttribute("type"))>-1)r[s].checked=!0;else{r[s].value=+e[i];var l=document.createEvent("HTMLEvents");l.initEvent("change",!1,!0),r[s].dispatchEvent(l)}t.collectedStyle[i]=e[i]}t.ignoreChanges=!1,t.updateStyleSubscribers()},currentState:function(e){this.data=e;for(var t=this.toolbarElement.querySelectorAll("[enabled]"),n=0;n<t.length;n++){var o=t[n].getAttribute("enabled");t[n].setAttribute("disabled",!e[o])}},attachKeyboardEvents:function(){var e=this;document,r.add("esc",(function(){if(e.toolbarElement)for(var t=e.toolbarElement.querySelectorAll('[name="group-expander"]'),n=0;n<t.length;n++)t[n].checked=!1}))},detachKeyboardEvents:function(){r.remove("esc")},editModeStart:function(){return this.attachToolbar(),this.attachKeyboardEvents(),!0},editModeEnd:function(){return this.detachKeyboardEvents(),!0},loadStyleFor:function(e){for(var t=function(e,t){var n=e.querySelectorAll("input");t?e.removeAttribute("disabled"):e.setAttribute("disabled",!0);for(var o=0;o<n.length;o++)t?n[o].removeAttribute("disabled"):n[o].setAttribute("disabled",!0)},n=this.toolbarElement.querySelectorAll("[showForShapes]"),o=0;o<n.length;o++){var i=(n[o].getAttribute("showForShapes")||"").split(":");t(n[o],i.indexOf(e)>-1)}var a=this.toolbarElement.querySelectorAll("[hideForShapes]");for(o=0;o<a.length;o++)i=(a[o].getAttribute("hideForShapes")||"").split(":"),t(a[o],-1===i.indexOf(e))},activeShape:function(e){var t=this;t.ignoreChanges=!0;var n=t.toolbarElement.querySelectorAll('label[action="shape:'+e+'"] input');if(n.length>0)for(var o=0;o<n.length;o++)n[o].checked=!0;t.ignoreChanges=!1}});p.prototype.Extras.defaultToolbar=h;var f=a.extend({constructor:function(e){var t=this;t.config=e,t.shape=e.shape,t.designReviewInstance=e.designReviewInstance,t.Adapter=t.designReviewInstance.Adapter,t.container=e.container,t.___PRIVATE__transformMetadata(),t.__PRIVATE__Active=!1,t.__PRIVATE__Resizing=!1,t.disabledDirections=e.immuneResize,t.handles={}},activate:function(){var e=this;e.__PRIVATE__Active||(e.__PRIVATE__Active=!0,e.__PRIVATE__attachShapeSelectionListeners())},deactivate:function(){var e=this;e.__PRIVATE__Active&&(e.__PRIVATE__detachShapeSelectionListeners(),e.stopResize(),e.__PRIVATE__Active=!1)},deleteHandler:function(e){8===e.which&&this.shape.detach()},startResize:function(){var e=this;e.__PRIVATE__Active&&!e.shape.__disabled__navigation__&&(e.__PRIVATE__Resizing=!0,e.__PRIVATE__createSelectorBox(),e.__PRIVATE__createControlPoints(),e.shape.resizerActivated())},stopResize:function(){var e=this;e.__PRIVATE__Active&&(e.__PRIVATE__Resizing=!1,e.__PRIVATE__removeSelectorBox(),e.__PRIVATE__removeControlPoints(),e.shape.resizerDeactivated())},storeMetadata:function(){this.metadata=JSON.parse(JSON.stringify(this.shape.metadata))},refresh:function(){var e=this;e.___PRIVATE__transformMetadata(),e.__PRIVATE__Active&&(e.__PRIVATE__createSelectorBox(),e.__PRIVATE__createControlPoints())},___PRIVATE__transformMetadata:function(){var e=this;e.storeMetadata();var t=e.metadata,n=e.Adapter.worldSizeToScreen({width:t.width,height:t.height}),o=2*e.margin,i=n.width+o,a=n.height+o,r=e.Adapter.worldToScreen(t.position),s=-t.rotation;e.transformedMetadata={width:i,height:a,position:r,rotation:s}},__PRIVATE_Edit:function(){var e=this;if(e.__PRIVATE__Resizing)try{e.stopResize(),e.shape.resumeEdit()}catch(e){}else e.startResize()},__PRIVATE__attachShapeSelectionListeners:function(){var e=this,t=e.CPEventsHandlers();e.__PRIVATE__selectionHandlers=t,e.__PRIVATE__boundsResizerData=[];var n=e.EVENT_NAMES;t[n.EVENT_SELECT]=e.startResize.bind(e),t[n.EVENT_UNSELECT]=e.stopResize.bind(e),[e.shape[e.shape.configuration.hitArea]].forEach((function(n){if("text"!==n.nodeName){var o=new e.Base.Events(n);n.style.pointerEvents="visible",o.on(t),o.turnOn(),e.__PRIVATE__boundsResizerData.push([n,o])}}))},__PRIVATE__detachShapeSelectionListeners:function(){var e=this,t=e.__PRIVATE__boundsResizerData,n=e.__PRIVATE__selectionHandlers;t.forEach((function(e){for(var t in e[1].turnOff(),e[0].style.pointerEvents="auto",n)e[1].off(t,n[t])})),delete e.__PRIVATE__boundsResizerData,delete e.__PRIVATE__selectionHandlers},setPointerEvents:function(e,t){e.style.pointerEvents=t?"auto":"none"},__PRIVATE__createSelectionLayer:function(){var e=this,t=document.createElement("div");e.Helpers.DOMHelpers.Style(t,{position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"hidden"}),e.setPointerEvents(t,!1),e.selectionLayer=t},toTranslate3d:function(e,t){return"translate3d("+e+"px, "+t+"px, 0)"},__PRIVATE__createSelectorBox:function(){var e=this,t=e.selectorBox;t||((t=document.createElement("div")).classList.add(e.CONSTANTS.SELECTOR_BOX_CLASSNAME),e.selectorBox=t,t.setAttribute("alias",e.shape._guid),t.setAttribute("direction","move"),e.setPointerEvents(t,!0),e.__PRIVATE__attachCPEvents());var n=e.transformedMetadata,o=n.position,i=n.rotation,a=n.height,r=n.width,s=e.toTranslate3d(o.x,o.y)+" rotate("+i+"deg)",l=r/2+"px "+a/2+"px",c=e.CONSTANTS.CROSS_BROWSER_STYLE_KEY;e.Helpers.DOMHelpers.Style(t,{position:"absolute",border:e.borderWidth+"px solid "+e.borderColor,"z-index":1,cursor:"move",left:-r/2+"px",top:-a/2+"px","box-sizing":"border-box",width:r+"px",height:a+"px",transform:c+s,"transform-origin":c+l}),!t.parentNode&&e.__PRIVATE__Resizing&&(e.container.appendChild(e.selectorBox),e.__PRIVATE__attachCPEvents(),t.Events.turnOn())},__PRIVATE__removeSelectorBox:function(){var e=this.selectorBox;e&&e.parentNode&&(e.Events.turnOff(),e.parentNode.removeChild(e))},__PRIVATE__createControlPoints:function(){var e=this;e.selectorBox,e.handles,e.directions.forEach((function(t){-1===e.disabledDirections.indexOf(t)&&e.__PRIVATE__createControlPoint(t)}))},__PRIVATE__removeControlPoints:function(){var e=this,t=(e.selectorBox,e.handles);e.directions.forEach((function(n){var o=t[n];o&&o.parentNode&&e.__PRIVATE__Resizing&&o.parentNode.removeChild(o)}))},__PRIVATE__createControlPoint:function(e){var t=this,n=t.controlPointWidth+"px",o=t.handles[e];if(!o){(o=document.createElement("div")).setAttribute("alias",t.shape._guid);var i=t.CONSTANTS.CROSS_BROWSER_STYLE_KEY,a=t.cursorName(e)||"move",r={position:"absolute",width:n,height:n,background:t.background,border:t.borderWidth+"px solid "+t.borderColor,cursor:a,"box-sizing":"border-box","border-radius":"4px"};o.classList.add(t.CONSTANTS.SELECTOR_BOX_CP_CLASSNAME),o.setAttribute("direction",e);var s=t.controlPointWidth/2,l=t.borderWidth/2,c=-t.controlPointWidth-l;switch(e){case"n":r.top=-l+"px",r.left="calc(50% - "+s+"px)",r.position="relative",r.transform=i+"translate3d(0, -50%, 0)",r.margin=0;break;case"s":r.top="calc(100% - "+(3*s-l)+"px)",r.left="calc(50% - "+s+"px)",r.position="relative",r.margin=0;break;case"w":r.left=-l+"px",r.top="50%",r.transform=i+"translate3d(-50%, -50%, 0)";break;case"e":r.right=-s-l+"px",r.top="50%",r.transform=i+"translate3d(0, -50%, 0)";break;case"nw":r.transform=i+"translate3d(-50%, 0, 0)",r.top=-s+"px",r.left=-l+"px";break;case"ne":r.top=-l+"px",r.right=c+"px",r.transform=i+"translate3d(-50%, -50%, 0)";break;case"sw":r.bottom=c+"px",r.left=0,r.transform=i+"translate3d(-50%, -50%, 0)";break;case"se":r.bottom=c+"px",r.right=c+"px",r.transform=i+"translate3d(-50%, -50%, 0)";break;case"rotation":r.top="-50px",r.left="50%",r["border-radius"]=s+"px",r["box-sizing"]="border-box",r.transform=i+"translate3d(-50%, 0px, 0px)"}t.Helpers.DOMHelpers.Style(o,r),t.handles[e]=o}o.parentNode||t.selectorBox.appendChild(o)},__PRIVATE__getMousePosition:function(e){var t=this.container.getBoundingClientRect(),n=e.pageX,o=e.pageY,i=e.touches;if(i&&0===i.length&&(i=e.changedTouches),i){if(0===i.length)return;n=i[0].clientX,o=i[0].clientY}return{x:n-t.left,y:o-t.top}},emitResize:function(e){var t=this;t.shape.updateMetadata({previous:t.previousMetadata,metadata:t.metadata,changes:e})},__PRIVATE__revertMetadataTransform:function(e){var t=this,n=t.transformedMetadata;if(t.previousMetadata=JSON.parse(JSON.stringify(t.metadata)),e.rotation&&(t.metadata.rotation=-n.rotation),e.position){var o=t.Adapter.screenToWorld(n.position);t.metadata.position=o}if(e.height||e.width){var i=2*t.margin,a=t.Adapter.screenSizeToWorld({height:n.height-i,width:n.width-i});t.metadata.width=0===a.width?1:a.width,t.metadata.height=0===a.height?1:a.height;var r=t.Adapter.worldSizeToScreen({height:t.metadata.height,width:t.metadata.width});t.transformedMetadata.height=r.height+2*t.margin,t.transformedMetadata.width=r.width+2*t.margin}},getAngleBetweenPoints:function(e,t){var n=180/Math.PI;return(e.x===t.x&&e.y===t.y?Math.PI/2:Math.atan2(t.y-e.y,t.x-e.x))*n-90},__PRIVATE__createControlPoint_dragStart:function(e){var t=this,n=e.target.getAttribute("direction");t.__PRIVATE__activeCP=n||"move",t.__PRIVATE__initialMouse=t.__PRIVATE__getMousePosition(e),t.__PRIVATE__initialStartMeatadata=JSON.parse(JSON.stringify(t.transformedMetadata)),t.__PRIVATE__metadata=JSON.parse(JSON.stringify(t.metadata)),t.__PRIVATE__Resizing=!0,t.shape.resizeStarted()},__PRIVATE__createControlPoint_drag:function(e){var t=this,n=t.__PRIVATE__activeCP;if(n){if(t.__PRIVATE__activeCP===n){var o=t.__PRIVATE__getMousePosition(e),i=t.__PRIVATE__initialMouse,a=t.__PRIVATE__initialStartMeatadata,r=a.position,s=o.x-i.x,l=o.y-i.y,c={rotation:!1,height:!1,width:!1,position:!1};if("move"===n)t.transformedMetadata.position.x=a.position.x+s,t.transformedMetadata.position.y=a.position.y+l,c.position=!0;else if("rotation"===n){var d=a.position;t.transformedMetadata.rotation=t.getAngleBetweenPoints(o,d),c.rotation=!0,c.position=!0}else{var p={x:o.x-i.x,y:o.y-i.y},u=new THREE.Vector3(p.x,p.y,0),h=a.rotation*Math.PI/180,f=(new THREE.Matrix4).makeRotationZ(-h);p=u.applyMatrix4(f);var g=r.x,m=r.y,v=a.width,y=a.height,_=new THREE.Vector3,E={n:function(){y-=p.y,_.y=p.y},s:function(){y+=p.y,_.y=p.y},w:function(){v-=p.x,_.x=p.x},e:function(){v+=p.x,_.x=p.x}};n.split("").forEach((function(e){E[e]()}));var S=(new THREE.Matrix4).makeRotationZ(h),b=_.applyMatrix4(S);t.transformedMetadata.position={x:g+.5*b.x,y:m+.5*b.y},t.transformedMetadata.width=v,t.transformedMetadata.height=y,c.height=!0,c.width=!0,c.position=!0}t.__PRIVATE__revertMetadataTransform(c),t.emitResize(c)}t.__PRIVATE__createSelectorBox()}},__PRIVATE__createControlPoint_dragEnd:function(e){var t=this;t.__PRIVATE__activeCP=null,t.__PRIVATE__Resizing=!1,t.shape.resizeEnded()},__PRIVATE_passEvents:function(e){var t=this;return function(n){t[e].apply(t,Array.prototype.slice.call(arguments,0))}},CPEventsHandlers:function(){var e=this,t=e.EVENT_NAMES,n={};return n[t.EVENT_DRAG_START]=e.__PRIVATE_passEvents("__PRIVATE__createControlPoint_dragStart"),n[t.EVENT_DRAGGING]=e.__PRIVATE_passEvents("__PRIVATE__createControlPoint_drag"),n[t.EVENT_DRAG_END]=e.__PRIVATE_passEvents("__PRIVATE__createControlPoint_dragEnd"),n[t.EVENT_CLICK]=e.__PRIVATE_passEvents("__PRIVATE_Edit"),n},__PRIVATE__attachCPEvents:function(e){var t=this,n=t.selectorBox;n.Events=new t.Base.Events(n),n.eventsHandlers=t.CPEventsHandlers(),n.Events.on(n.eventsHandlers)},cursorName:function(e){var t;switch(e){case"n":case"s":t="ns-resize";break;case"w":case"e":t="ew-resize";break;case"ne":case"sw":t="nesw-resize";break;case"nw":case"se":t="nwse-resize"}return t},borderColor:"rgba(90, 171, 171, 0.9)",background:"rgba(237, 237, 237, 1.00)",borderWidth:2,margin:15,controlPointWidth:16,directions:["n","s","w","e","nw","ne","sw","se","rotation"]});a.prototype.Helpers.boundsResizer=f;var g=a.extend({Style:function(e,t){var n,o=this.CONSTANTS,i={},a=e.getAttribute("style")||"";for(n in(a=a.split(";")).forEach((function(e){2===(e=e.split(":")).length&&(i[e[0].trim()]=i[e[1].trim()])})),t){var r=t[n],s=!1;(""+r).indexOf(o.CROSS_BROWSER_STYLE_KEY)>-1&&(s=!0,r=r.split(o.CROSS_BROWSER_STYLE_KEY)[1]),s?o.BROWSER_PREFIXES.forEach((function(e){i[e+n]=r})):i[n]=r}var l=[];for(n in i)l.push([n,i[n]].join(":"));e.setAttribute("style",l.join(";"))},Attibutes:function(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))},lineBreaks:function(e){var t=e.getAttribute("wrap");e.setAttribute("wrap","off");var n=e.cloneNode();n.value=e.value,n.style.visibility="hidden",e.parentNode.appendChild(n);var o=n.value;n.value="";var i=n.scrollWidth;function a(e,t,o){var r,s;if(void 0===t)t=0,o=-1,r=64;else if(-1===o)r=2*t;else{if(o-t<=1)return Math.max(2,o);r=t+(o-t)/2}if(s=e.substr(0,r),n.value=s,n.scrollWidth>i)o=r;else{if(r>=e.length)return null;t=r}return a(e,t,o)}for(var r,s=0,l="";s<o.length;){var c=a(o.substr(s));if(null===c){l+=o.substr(s);break}var d=c-1;for(r=d-1;r>=0;r--){var p=o.charAt(s+r);if(" "===p||"-"===p||"+"===p){d=r+1;break}}l+=o.substr(s,d)+"\n",s+=d}n.value=l,n.parentNode.removeChild(n),e.setAttribute("wrap",t);var u=n.value.split(/\n/g);return u.map((function(e){return e||" "}))},svgElement:function(e){var t=this,n=(e=e||{}).elementType||"rect",o=e.DOMElement,i=e.element;return i||(i=o?document.createElement(n):document.createElementNS(t.CONSTANTS.SVGNS,n)),e.attributes&&t.Attibutes(i,e.attributes),e.style&&t.Style(i,e.style),e.parent&&e.parent.appendChild(i),i}});a.prototype.Helpers.DOMHelpers=new g,a.prototype.Helpers.DOMHelpers;var m=a.extend({constructor:function(e){this.element=e,this.__PRIVATE__clicks=0},__PRIVATE__dragstart:function(e){var t=this,n=t.__PRIVATE__sameGroupNodes(e.target,t.element);if((n||e.target.isSameNode(t.element))&&(t.__PRIVATE__mousedown=!0),n)t.SELECT_EVENT_FIRED||(t.emit(t.EVENT_NAMES.EVENT_SELECT,e),t.SELECT_EVENT_FIRED=!0);else{for(var o=document.querySelectorAll(".design-review-pe-none"),i=!1,a=0;a<o.length;a++)if(o[a].contains(e.target)){i=!0;break}t.SELECT_EVENT_FIRED&&!i&&(t.emit(t.EVENT_NAMES.EVENT_UNSELECT,e),t.SELECT_EVENT_FIRED=!1)}},__PRIVATE__dragging:function(e){var t=this;t.emit(t.EVENT_NAMES.MOUSE_MOVE,e),t.__PRIVATE__mousedown&&(t.__PRIVATE__dragevent_fired_flag||(t.emit(t.EVENT_NAMES.EVENT_DRAG_START,e),t.__PRIVATE__dragevent_fired_flag=!0),t.__PRIVATE__mousemove=!0,t.emit(t.EVENT_NAMES.EVENT_DRAGGING,e),t.__PRIVATE__dragging_fired_flag=!0)},__PRIVATE__dragend:function(e){var t=this;t.__PRIVATE__mousedown=!1,setTimeout((function(){t.__PRIVATE__dragevent_fired_flag=!1,t.__PRIVATE__dragging_fired_flag=!1}),500),t.__PRIVATE__mousemove&&t.__PRIVATE__dragevent_fired_flag&&(t.__PRIVATE__mousemove=!1,t.emit(t.EVENT_NAMES.EVENT_DRAG_END,e))},__PRIVATE__click:function(e){var t=this;t.__PRIVATE__dragging_fired_flag||t.emit(t.EVENT_NAMES.EVENT_CLICK,e)},__PRIVATE__documentClick:function(e){},__PRIVATE__dblClick:function(e){this.emit(this.EVENT_NAMES.EVENT_DOUBLECLICK,e)},__PRIVATE__sameGroupNodes:function(e,t){var n=e.getAttribute("alias")||e.getAttribute("guid"),o=t.getAttribute("alias")||t.getAttribute("guid");return n&&n===o},__PRIVATE__mouseover:function(e){var t=this;t.__PRIVATE_hoverTimer=setTimeout((function(){t.emit(t.EVENT_NAMES.EVENT_HOVER_START,e),t.__PRIVATE__hover_event_triggered_flag=!0}),t.CONSTANTS.HOVER_DELAY)},__PRIVATE__mouseout:function(e){var t=this;window.clearTimeout(t.__PRIVATE_hoverTimer),t.__PRIVATE__hover_event_triggered_flag&&(t.emit(t.EVENT_NAMES.EVENT_HOVER_END,e),t.__PRIVATE__hover_event_triggered_flag=!1)},__PRIVATE__attachEvents:function(){var e=this,t=e.element,n=e.__PRIVATE__dragstart.bind(e),o=e.__PRIVATE__dragging.bind(e),i=e.__PRIVATE__dragend.bind(e),a=e.__PRIVATE__click.bind(e),r=e.__PRIVATE__mouseover.bind(e),s=e.__PRIVATE__mouseout.bind(e),l=e.__PRIVATE__documentClick.bind(e),c=e.__PRIVATE__dblClick.bind(e);function d(e){var d=e?"removeEventListener":"addEventListener";document[d]("mousedown",n,!1),t[d]("click",a,!1),t[d]("dblclick",c,!1),document[d]("click",l,!1),document[d]("mousemove",o,!1),document[d]("mouseup",i,!1),t[d]("mouseover",r,!1),t[d]("mouseout",s,!1),document[d]("touchstart",n,!1),t[d]("click",a,!1),t[d]("dblclick",c,!1),document[d]("click",l,!1),document[d]("touchmove",o,!1),document[d]("touchend",i,!1)}return d(),{cancel:function(){d(!0)}}},turnOn:function(){this.__PRIVATE__attachedEvents=this.__PRIVATE__attachEvents()},turnOff:function(){this.__PRIVATE__attachedEvents.cancel()}});a.prototype.Base.Events=m;const v=m;var y=a.extend({constructor:function(e){var t=this,n=(e=e||{}).svgElement,o=e.designReviewInstance,i=e.belongsToGroup,a=e.connectFrom;t._guid=t.uuid(),t.designReviewInstance=o,t.Adapter=t.designReviewInstance.Adapter,t[t.CONSTANTS.EDIT_LAYER_NAME]=n,t.emptyMedatada(),t.belongsToGroup=i,t.connectFrom=a||[],t.connecterLines=[],t.connecterLinesMap={},t.connectedTo=[],t[t.configuration.elementsStore]=[],t[t.configuration.transferSizeElements]=[],t[t.configuration.screenReferenceBBox]=null,t[t.configuration.extraInformation]={},t.__PRIVATE__appendedToScreen=[]},emptyMedatada:function(){this.metadata={height:1,width:1,rotation:0,position:{}},this.metadataCalculated=!1},__PRIVATE__addGuid:function(e){var t=this;e.forEach((function(e){e.setAttribute("guid",t._guid)}))},appendConnectors:function(){var e=this,t=e.connectFrom;t.length>0&&t.forEach((function(t){if(!e.connecterLinesMap[t._guid]){var n=e.parentInstance.getConnectorInstace();e.connecterLines.push(n),e.connecterLinesMap[t._guid]=n,t.connectedFrom=t.connectedFrom||[],t.connectedFrom.push(e)}}))},start:function(e,t){var n=this;n[n.CONSTANTS.GROUP_ELEMENT_NAME]=document.createElementNS(n.CONSTANTS.SVGNS,"g"),n.screenContainer=n[n.CONSTANTS.EDIT_LAYER_NAME].parentNode,n[n.CONSTANTS.GROUP_ELEMENT_NAME].setAttribute("type",n.configuration.name),console.log(n._guid),n.editMode=!0,n.setup(n[n.CONSTANTS.GROUP_ELEMENT_NAME]),n.applyStyle(),n.setTransform(),n.__PRIVATE__addGuid([n[n.CONSTANTS.GROUP_ELEMENT_NAME]]),n.__PRIVATE__addGuid(n[n.configuration.elementsStore]),e&&(n.parentNode=e),t&&(n.parentInstance=t);var o=n.parentNode||n[n.CONSTANTS.EDIT_LAYER_NAME];o.appendChild(n[n.CONSTANTS.GROUP_ELEMENT_NAME]),n.targetNode=o,n.connectingElement||n.designReviewInstance.createStarted(n)},stop:function(){var e=this;e.editMode=!1,e.designReviewInstance.creationDone(e),e.parentInstance&&e.parentInstance.creationDone(e)},storeExistence:function(e,t){var n=this,o={guid:n._guid,args:[]},i=n.designReviewInstance.createHistoryAction(e,o),a=n.designReviewInstance.createHistoryAction(t,o);n.addHistory({undo:i,redo:a})},storeEdit:function(){var e=this,t=e.preserveData(!0),n=e.previousState||{},o=0===Object.keys(n).length,i={guid:e._guid,args:[!0]},a=e.designReviewInstance.createHistoryAction("receivedEnough",e.clone(i)),r=[],s=[];o?e.belongsToGroup||(i.args=[!0],r.push(e.designReviewInstance.createHistoryAction("detach",e.clone(i)))):(i.args=[n],r.push(e.designReviewInstance.createHistoryAction("restoreData",e.clone(i))),r.push(a)),o?e.belongsToGroup||(i.args=[!0],s.push(e.designReviewInstance.createHistoryAction("recover",e.clone(i)))):(i.args=[t],s.push(e.designReviewInstance.createHistoryAction("restoreData",e.clone(i))),s.push(a));var l=function(e){return function(){this.forEach((function(e){e()}))}.bind(e)};r.length>0&&s.length>0&&e.addHistory({undo:l(r),redo:l(s)})},addHistory:function(e){this.designReviewInstance.History.add(e)},setupResizer:function(){var e=this;e.configuration.dontResize||e.dontResize||(e.boundsResizer?(e.boundsResizer.deactivate(),delete e.boundsResizer,e.setupResizer()):(e.boundsResizer=new e.Helpers.boundsResizer({designReviewInstance:e.designReviewInstance,shape:e,container:e.screenContainer,immuneResize:e.blockResize||e.configuration.immuneResize||[]}),e.boundsResizer.activate()))},adjustResizer:function(){var e=this.boundsResizer;e&&e.refresh()},resizeStarted:function(){var e=this;e.metadataBeforeResizeStart=e.clone(e.metadata)},__fakeChanges:{height:!0,width:!0,position:!0,rotation:!0},resizeEnded:function(){var e=this;e.configuration.keepRereshing&&e.configuration.retrieveDimensions();var t=e.metadataBeforeResizeStart,n=e.clone(e.metadata),o=e.__fakeChanges,i=e.designReviewInstance.createHistoryAction("updateMetadata",{guid:e._guid,args:[{metadata:t,previous:n,changes:o,external:!0}]}),a=e.designReviewInstance.createHistoryAction("updateMetadata",{guid:e._guid,args:[{metadata:n,previous:t,changes:o,external:!0}]});e.addHistory({undo:i,redo:a})},xsetupMetadata:function(){var e=this,t=e[e.configuration.locationStore],n=function(e,t){var n=e.map((function(e){return e[t]}));return Math.min.apply(null,n)},o=function(e,t){var n=e.map((function(e){return e[t]}));return Math.max.apply(null,n)},i=n(t,"x"),a=n(t,"y"),r=o(t,"x")-i,s=o(t,"y")-a,l={x:i+.5*r,y:a+.5*s};t=t.map((function(e){return{x:e.x-l.x,y:e.y-l.y}}));var c={width:r,height:s,position:l,rotation:0};e[e.configuration.locationStore]=t,e.metadata=c},getGroupBoundingBox:function(){var e=this,t=e.captureMetadataFrom||e[e.CONSTANTS.GROUP_ELEMENT_NAME],n=e[e.CONSTANTS.EDIT_LAYER_NAME],o=t.getBoundingClientRect(),i=n.getBoundingClientRect(),a=[{x:o.left,y:o.top},{x:o.left+o.width/2,y:o.top},{x:o.right,y:o.top},{x:o.right,y:o.top+o.height/2},{x:o.right,y:o.bottom},{x:o.right-o.width/2,y:o.bottom},{x:o.left,y:o.bottom},{x:o.left,y:o.bottom-o.height/2}];return a.map((function(t){return e.Adapter.screenToWorld({x:t.x-i.left,y:t.y-i.top})}))},getMetadata:function(){var e,t,n=this,o=n[n.configuration.locationStore]||[],i=n.getGroupBoundingBox(),a=i,r=function(e,t){var n=e.map((function(e){return e[t]}));return Math.min.apply(null,n)},s=function(e,t){var n=e.map((function(e){return e[t]}));return Math.max.apply(null,n)},l=r(i,"x"),c=r(i,"y");return{metadata:{width:t=s(i,"x")-l,height:e=s(i,"y")-c,position:{x:l+.5*t,y:c+.5*e},rotation:0},boundingDirections:a,locations:o}},setupMetadata:function(){var e=this,t=e.getMetadata();e.metadataCalculated=!0,e.metadata=t.metadata,e.boundingDirections=t.boundingDirections.map((function(t){return e.getRelativePosition(t)})),e[e.configuration.locationStore]=t.locations.map((function(t){return e.getRelativePosition(t)}))},updateDimensions:function(){var e=this,t=e.getMetadata();e.metadata.height=t.metadata.height,e.metadata.width=t.metadata.width},getRelativePosition:function(e){var t=this.metadata.position;return{x:e.x-t.x,y:e.y-t.y}},getNonRelativePosition:function(e){var t=this.metadata.position;return{x:e.x+t.x,y:e.y+t.y}},clone:function(e){return JSON.parse(JSON.stringify(e))},resizerActivated:function(){this.designReviewInstance.select(this._guid)},resizerDeactivated:function(){this.designReviewInstance.deselect(this._guid)},select:function(){var e=this;e.boundsResizer&&!e.selected&&(e.boundsResizer.startResize(),e.selected=!0)},deselect:function(){var e=this;e.boundsResizer&&e.selected&&(e.selected=!1,e.boundsResizer.stopResize())},updateMetadata:function(e){var t=this;t.lastChanges=t.clone(e.changes||{}),t.previousMetadata=t.clone(e.previous),t.metadata=t.clone(e.metadata),t.applyMetadata(),external&&t.adjustResizer(),t.updateConnect(),Array.isArray(t.connectedFrom)&&t.connectedFrom.forEach((function(e){!e.editMode&&e.updateConnect()}))},removeTransform:function(e){(e=e||this[this.configuration.elementsStore]).forEach((function(e){e.removeAttribute("transform")}))},setTransform:function(e){var t=this;e=e||t[t.configuration.elementsStore];var n=t.getTransform();e.forEach((function(e){var t=n,o=e.nodeName.toUpperCase();["TEXT","RECT"].indexOf(o)>-1&&(t+=" scale(1, -1)"),e.setAttribute("transform",t)}))},applyMetadata:function(e){var t=this,n=t[t.configuration.locationStore];t.lastChanges=e||t.lastChanges||{position:!0,rotation:!0,height:!1,width:!1},(t.lastChanges.height||t.lastChanges.width)&&(t.tuneDimensions(),t.redraw(n)),(t.lastChanges.rotation||t.lastChanges.position)&&t.setTransform();var o=t[t.configuration.transferSizeElements];Array.isArray(o)&&o.forEach((function(e){e.setAttribute("height",t.metadata.height),e.setAttribute("width",t.metadata.width)}))},tuneDimensions:function(){var e=this,t=e.configuration.locationStore,n=e.metadata,o=n.width,i=n.height;o=0===o?1:o,i=0===i?1:i;var a=parseFloat(o/e.previousMetadata.width),r=parseFloat(i/e.previousMetadata.height);1===a&&1===r||(e[t]=e[t].map((function(e){return{x:parseFloat(a*e.x),y:parseFloat(r*e.y)}})),e.boundingDirections=e.boundingDirections.map((function(e){return{x:parseFloat(a*e.x),y:parseFloat(r*e.y)}})))},redraw:function(e){var t=this,n=t.configuration.locationStore;e=e||t[n],t.draw(e,!!t[t.configuration.locationStore])},receivedEnough:function(e){var t=this;t.stop(),t.setTransform(),t.setupMetadata(),t.previousState&&t.previousState.metadata&&(t.metadata.rotation=t.previousState.metadata.rotation,t.setTransform()),t.applyMetadata(),t.redraw(),t.boundsResizer&&t.boundsResizer.activate(),t.setupResizer(),e||t.storeEdit(),t.updateConnect(),delete t.previousState,t.belongsToGroup||t.connectingElement||t.resizerActivated()},input:function(e){var t=this;if(t.editMode){var n=t.filter(e,!!t.previousState,t.metadata),o=!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then,i=function(e){var t=this;if(t.editMode){var n=t[t.configuration.locationStore];e&&(t.redraw(e),Array.isArray(n)&&t.editMode&&(t.detachAllAttachedToScreen(),0===n.length?(t.stop(!0),t.designReviewInstance.removeShapeByid(t._guid)):(t.receivedEnough(),t.updateConnect())))}}.bind(t),a=function(t){console.log(this.configuration.name,this,e,t)}.bind(t);if(o?(t.waitingForPromise=!0,n.then(i,a)):i(n),!t.previousState){var r=e.dragstart||e.clicks[0]||e.mouselocation;t.connectablePosition&&(r=t.connectablePosition(e)),r&&t.updateConnect(r)}}},preserveData:function(e){var t=this,n={},o=t.configuration.locationStore,i=t.configuration.extraInformation;if(n[o]=t[o],n[i]=t[i],n.metadata=t.metadata,(n=t.clone(n))[o])return n[o]=n[o].map((function(e){return t.getNonRelativePosition(e)})),e||(t.previousState=n),n},restoreData:function(e){var t=this,n=t.configuration.locationStore,o=t.configuration.extraInformation;t[n]=e[n],t[o]=e[o]},clearData:function(){var e=this,t=e.configuration.locationStore,n=e.configuration.extraInformation;delete e[t],delete e[n],e.emptyMedatada(),delete e.lastChanges},resumeEdit:function(){var e=this,t=(e.parentInstance||{editMode:!1}).editMode;e.configuration.editable&&!t&&(e.deselect(),e.preserveData(),e.clearData(),e.editMode=!0,e.boundsResizer&&e.boundsResizer.deactivate(),e.designReviewInstance.activateShape(e))},drawLine:function(e,t,n){e.setAttribute("d",this.toSVGPath([t,n]))},detachConnectors:function(){var e=this;e.connectFrom.forEach((function(t){e.connecterLinesMap[t._guid].detach(!0)}))},recoverConnectors:function(){var e=this;e.connectFrom.forEach((function(t){e.connecterLinesMap[t._guid].recover(!0)}))},updateConnect:function(e){var t=this;if(t.connectFrom.length>0){t.appendConnectors(),t.boundingDirections=t.boundingDirections||[];var n=[e];t.boundingDirections.length>0&&(n=t.boundingDirections.map((function(e){return t.getNonRelativePosition(e)}))),n[0]||t.detachConnectors(),t.connectFrom.forEach((function(e){e.connectedTo=e.connectedTo||[],0===e.connectedTo.filter((function(e){return e._guid===t._guid})).length&&e.connectedTo.push(t);var o=e.configuration.userCenterForConnecting,i=t.connecterLinesMap[e._guid];if(e.detached)i.detach();else{var a=e[e.configuration.hitArea],r=[],s={},l=e.boundingDirections;if(o)l=[e.metadata.position];else if("path"===a.nodeName.toLowerCase())try{l=[];for(var c=a.getTotalLength(),d=c/8,p=0;p<c;p+=d)l.push(a.getPointAtLength(p))}catch(t){l=e.boundingDirections}n.forEach((function(i,a){a%2==0&&1!==n.length||l.forEach((function(n,a){if(a%2!=0||o){o||(n=e.getNonRelativePosition(n));var l=t.distance(n.x,n.y,i.x,i.y);r.push(l),s[l]=[n,i]}}))})),t.updateConnectorsStyle();var u=Math.min.apply(null,r),h=s[u];h&&(h=[h[1],h[0]],i.removeTransform(),i.clearData(),i.detached,i.redraw(h),i[i.configuration.locationStore]=h,i.receivedEnough(!0))}}))}},updateConnectorsStyle:function(){var e=this;e.connectFrom.forEach((function(t){var n=e.connecterLinesMap[t._guid];n.style["stroke-width"]=t.getStyleValue("stroke-width")/2,n.style["stroke-color"]=t.getStyleValue("stroke-color"),n.applyStyle()}))},arrowPath:function(e,t){var n=this,o=e.x,i=e.y,a=t.x,r=t.y,s=[],l=+n.getStyleValue("stroke-width"),c=n.distance(o,i,t.x,t.y),d=Math.atan2(r-i,a-o);return a=(t=n.findNewPoint(o,i,d,c-1.5*l)).x,r=t.y,s.push("M",o,i,"L",a,r),s.push("L",a-l*Math.cos(d-Math.PI/7),r-l*Math.sin(d-Math.PI/7)),s.push("L",a-l*Math.cos(d+Math.PI/7),r-l*Math.sin(d+Math.PI/7)),s.push("L",a,r),s.push("L",a-l*Math.cos(d-Math.PI/7),r-l*Math.sin(d-Math.PI/7)),s.join(" ")},getTransform:function(e){if(!this.metadataCalculated)return"";var t=this.metadata,n=t.rotation;return"translate("+(e=e||t.position).x+", "+e.y+") rotate("+n+")"},toSVGPath:function(e,t){for(var n=[],o=0;o<e.length;o++){var i=0===o?"M":"L";n.push(i+e[o].x+" "+e[o].y+" ")}return n.join("")+(t?"z":"")},detach:function(e,t){var n=this;if(!n.parentInstance||t){var o=n[n.CONSTANTS.GROUP_ELEMENT_NAME];o.setAttribute("__deleted__",!0),n.Helpers.DOMHelpers.Style(o,{display:"none"}),n.detached=!0,n.boundsResizer&&n.boundsResizer.deactivate(),n.detachConnectors(),e||n.storeExistence("recover","detach")}else n.parentInstance.detach()},recover:function(e){var t=this,n=t[t.CONSTANTS.GROUP_ELEMENT_NAME];n.removeAttribute("__deleted__",!1),t.Helpers.DOMHelpers.Style(n,{display:""}),t.detached=!1,t.boundsResizer&&t.boundsResizer.activate(),t.recoverConnectors(),t.updateConnect(),Array.isArray(t.connectedFrom)&&t.connectedFrom.forEach((function(e){e.updateConnect()})),e||t.storeExistence("detach","recover")},saveOrDie:function(){var e=this;if(e.editMode&&e.saveNow)try{e.saveNow()}catch(e){}},destroy:function(){var e=this,t=e[e.CONSTANTS.GROUP_ELEMENT_NAME];t&&t.parentNode.removeChild(t);var n=e.boundsResizer;n&&(n.deactivate(),e.boundsResizer=null),e.detachAllAttachedToScreen()},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},movePoint:function(e,t,n){return{x:Math.round(Math.cos(t*Math.PI/180)*n+e.x),y:Math.round(Math.sin(t*Math.PI/180)*n+e.y)}},cloneShape:function(){var e=this,t=e.configuration.name,n=e.designReviewInstance.createShapeOfType(t);n.connectFrom=e.connectFrom.slice(0),n.belongsToGroup=e.belongsToGroup,n.start(e.parentNode,e.parentInstance);var o=e.preserveData(!0);n.restoreData(o);var i=n.configuration.locationStore,a=e.metadata;return n[i]=n[i].map((function(t){return e.movePoint(t,a.width/2,-a.height/2)})),n.redraw(),n.receivedEnough(),n.__cloned__=!0,e.selected&&n.select(),Array.isArray(e.connectedTo)&&e.connectedTo.forEach((function(e){e.connectFrom.push(n),e.updateConnect()})),n.parentInstance&&n.parentInstance.shapeObjects.push(n),n},screenPoint:function(e){return this.Adapter.worldToScreen(e)},worldPoint:function(e){return this.Adapter.screenToWorld(e)},screenSize:function(e){return this.Adapter.worldSizeToScreen(e)},worldSize:function(e){return this.Adapter.screenSizeToWorld(e)},appendToScreen:function(e){this.__PRIVATE__appendedToScreen.push(e),this.screenContainer.appendChild(e)},detachFromScreen:function(e){try{this.screenContainer.removeChild(e)}catch(e){}},detachAllAttachedToScreen:function(){var e=this;e.__PRIVATE__appendedToScreen.forEach((function(t){t.parentNode&&e.detachFromScreen(t)})),e.__PRIVATE__appendedToScreen=[]},distance:function(e,t,n,o){return Math.sqrt((e-n)*(e-n)+(t-o)*(t-o))},getAngle:function(e,t,n,o){return Math.atan2(o-t,n-e)},findNewPoint:function(e,t,n,o){var i={};return i.x=Math.round(Math.cos(n)*o+e),i.y=Math.round(Math.sin(n)*o+t),i},styleHistory:function(){var e=this,t=e.style,n=e.previousStyle;if(0!==Object.keys(n).length){var o={guid:e._guid,args:[]};o.args=[n,!0];var i=e.designReviewInstance.createHistoryAction("updateStyle",e.clone(o));o.args=[t,!0];var a=e.designReviewInstance.createHistoryAction("updateStyle",e.clone(o));e.addHistory({undo:i,redo:a})}},setStyle:function(e,t){var n=this;n.previousStyle=n.clone(n.style||{}),n.style=n.clone(e),n.editMode||t||n.styleHistory()},setStyleMapping:function(e){this.styleMapping=e},setStyleReferences:function(e){this.styleReferences=e},updateStyle:function(e,t){var n=this;n.setStyle(e,t),n.applyStyle(),Array.isArray(n.connectedTo)&&n.connectedTo.forEach((function(e){e.updateConnectorsStyle()}))},getStyleValue:function(e,t){var n=(t=t||this.style)[e];if(n&&"@"===n[0])try{var o=this.styleReferences||{};n=o[e]?o[e][n.substring(1)]:null}catch(e){n=null}return n},convertHex:function(e,t){return e=e.replace("#",""),"rgba("+parseInt(e.substring(0,2),16)+","+parseInt(e.substring(2,4),16)+","+parseInt(e.substring(4,6),16)+","+t+")"},applyStyle:function(){var e=this,t=e.clone(e.style),n=e.configuration.immuneStyle||[],o=t["stroke-opacity"]||1;n.indexOf("stroke-opacity")>-1&&(o=1);var i=t["fill-opacity"]||0;n.indexOf("fill-opacity")>-1&&(i=1),t["fill-color"]=e.convertHex(t["fill-color"],i),t["stroke-color"]=e.convertHex(t["stroke-color"],o),delete t["stroke-opacity"],delete t["fill-opacity"];var a=e[e.configuration.elementsStore],r=e.styleMapping;a.forEach((function(o){var i=null,a=null,s="text"===o.nodeName;a=n.slice(0),s&&((i=JSON.parse(JSON.stringify(t)))["fill-color"]=e.style["font-color"],delete i["stroke-width"],delete i["stroke-color"],a.indexOf("stroke-color"));var l=i||t,c=a||n;for(var d in l)if(-1===c.indexOf(d)){var p=e.getStyleValue(d,l);p&&o.setAttribute(r[d],p)}})),e.editMode||e.reCalculate(),e.onStyleChange&&e.onStyleChange()},reCalculate:function(){var e=this;e.redraw();var t=e.getMetadata().metadata,n=e.metadata;t.rotation=n.rotation,e.applyMetadata(),e.adjustResizer()},loadStyleFor:function(){return this.configuration.name},rotatePoint:function(e,t,n,o,i){return i=i*Math.PI/180,{x:Math.cos(i)*(e-n)-Math.sin(i)*(t-o)+n,y:Math.sin(i)*(e-n)+Math.cos(i)*(t-o)+o}},exportMetadata:function(){var e=this,t=e.clone(e.metadata),n=t.position,o=e.boundingDirections.map((function(o){return o=e.getNonRelativePosition(o),0!==t.rotation?e.rotatePoint(o.x,o.y,n.x,n.y,t.rotation):o})),i=e[e.configuration.locationStore].map((function(o){return o=e.getNonRelativePosition(o),0!==t.rotation?e.rotatePoint(o.x,o.y,n.x,n.y,t.rotation):o}));return{type:e.configuration.name,metadata:e.metadata,boundingBox:o,locations:i}},export:function(){var e=this,t=e[e.CONSTANTS.GROUP_ELEMENT_NAME],n=e.metadata,o=e[e.configuration.locationStore],i=e[e.configuration.extraInformation],a=e.style,r={xmlns:"http://www.w3.org/1999/xhtml",type:e.configuration.name,id:e._guid},s=function(e){var t=[];return e.forEach((function(e){t.push(e.x,e.y)})),t.join(" ")};for(var l in a)r[l]=(e.getStyleValue(l)+"").split("\n").join("&#10;");for(l in n)r[l]=n[l];for(l in i)r[l]=(i[l]+"").split("\n").join("&#10;");r.position=s([n.position]),r.size=n.width+" "+n.height,r.locations=s(o),r.head=s([o[0]]),r.tail=s([o[o.length-1]]),e.connectingElement||e.connectFrom.length>0&&(r.connectFrom=e.connectFrom.map((function(t){return[e.connecterLinesMap[t._guid]._guid,t._guid].join(" ")})).join("  ")),r.connectingElement&&(r.connectingElement=!0);var c=e.CONSTANTS.SVGNS,d=document.createElementNS(c,"metadata"),p=document.createElementNS(c,"markup_element");for(l in r)p.setAttribute(l,r[l]);d.appendChild(p);var u=t.cloneNode(!0),h=u.children||u.childNodes;for(l=0;l<h.length;l++)h[l].style.pointerEvents="none";return u.insertBefore(d,u.firstChild),u}});a.prototype.Base.Shape=y;const _=y;var E=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,n.setAttribute("fill","none"),t[t.configuration.hitArea]=n},draw:function(e){this.pathElement.setAttributeNS(null,"d",this.toSVGPath(e))},filter:function(e){var t=null;return e.dragstart&&(t=e.dragmovements),e.dragstart&&e.dragend&&(this[this.configuration.locationStore]=t),t},configuration:{input:{options:{smoothen:!0}},name:"Pencil",immuneStyle:["fill-color","fill-opacity","font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-freehand"],title:["Freehand draw"],order:0,group:"normal"}}});a.prototype.Shapes[E.prototype.configuration.name]=E;var S=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},getEclipsePath:function(e,t){var n=.5*(t.x-e.x),o=.5*(t.y-e.y),i=["M",e.x,e.y+o];return i.push("a",Math.abs(n),Math.abs(o),0,1,1,2*n,0),i.push("a",Math.abs(n),Math.abs(o),0,1,1,2*-n,0),i.push("z"),i.join(" ")},draw:function(e){var t=e[0],n=e[1];this.pathElement.setAttributeNS(null,"d",this.getEclipsePath(t,n))},filter:function(e){var t=null;return e.dragstart&&(t=[e.dragstart],e.dragend?(t.push(e.dragend),this[this.configuration.locationStore]=t):t.push(e.mouselocation)),t},configuration:{input:{options:{}},name:"ellipse",immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-circle"],title:["Ellipse"],order:0,group:"normal"}}});a.prototype.Shapes[S.prototype.configuration.name]=S;var b=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,n.setAttribute("fill","none"),t[t.configuration.hitArea]=n},draw:function(e){var t=e[0],n=e[1];this.pathElement.setAttributeNS(null,"d",this.arrowPath(t,n))},filter:function(e){var t=null;return(e.dragstart||e.clicks.length>0)&&(t=[e.dragstart||e.clicks[0]],e.dragend||e.clicks[1]?(t.push(e.dragend||e.clicks[1]),this[this.configuration.locationStore]=t):t.push(e.mouselocation)),t},configuration:{input:{options:{}},name:"Arrow",immuneStyle:["fill-color","fill-opacity","font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-arrowtool"],title:["Arrow"],order:1,group:"open"}}});a.prototype.Shapes[b.prototype.configuration.name]=b;var w=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,n.setAttribute("fill","none"),t[t.configuration.hitArea]=n},linePath:function(e){return this.toSVGPath(e)},draw:function(e){this.pathElement.setAttributeNS(null,"d",this.linePath(e))},filter:function(e){var t=null;return(e.dragstart||e.clicks.length>0)&&(t=[e.dragstart||e.clicks[0]],e.dragend||e.clicks[1]?(t.push(e.dragend||e.clicks[1]),this[this.configuration.locationStore]=t):t.push(e.mouselocation)),t},configuration:{input:{options:{}},name:"Line",immuneStyle:["fill-color","fill-opacity","font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-line"],title:["Line"],order:0,group:"normal"}}});a.prototype.Shapes[w.prototype.configuration.name]=w;var T=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},rectanglePath:function(e,t){var n=t.x-e.x,o=t.y-e.y;return["M",e.x,e.y,"L",e.x+n,e.y,"L",e.x+n,e.y+o,"L",e.x,e.y+o,"L",e.x,e.y+"z"].join(" ")},draw:function(e){var t=e[0],n=e[1];this.pathElement.setAttributeNS(null,"d",this.rectanglePath(t,n))},filter:function(e){var t=null;return e.dragstart&&(t=[e.dragstart],e.dragend?(t.push(e.dragend),this[this.configuration.locationStore]=t):t.push(e.mouselocation)),t},configuration:{input:{options:{}},name:"Rectangle",immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-rectangle"],title:["Rectangle"],order:0,group:"normal"}}});a.prototype.Shapes[T.prototype.configuration.name]=T;var x=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},cloudPath:function(e,t,n){var o=7*n,i=Math.min(e.x,t.x),a=Math.min(e.y,t.y),r=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y),l=Math.round(r/o);l=0===l?1:l;for(var c=Math.round(s/o),d=r/l,p=s/(c=0===c?1:c),u=i+d/2,h=["M",u,a],f=1;f<l;f++)u+=d,h.push("A"),h.push(d/2),h.push(d/2),h.push("0 0 1"),h.push(u),h.push(a);for(u=a+p/2,h.push("A"),h.push(p/2.8),h.push(p/2.8),h.push("0 0 1"),h.push(i+r),h.push(u),f=1;f<c;f++)u+=p,h.push("A"),h.push(p/2),h.push(p/2),h.push("0 0 1"),h.push(i+r),h.push(u);for(u=i+r-d/2,h.push("A"),h.push(p/2.8),h.push(p/2.8),h.push("0 0 1"),h.push(u),h.push(a+s),f=1;f<l;f++)u-=d,h.push("A"),h.push(d/2),h.push(d/2),h.push("0 0 1"),h.push(u),h.push(a+s);for(u=a+s-p/2,h.push("A"),h.push(p/2.8),h.push(p/2.8),h.push("0 0 1"),h.push(i),h.push(u),f=1;f<c;f++)u-=p,h.push("A"),h.push(p/2),h.push(p/2),h.push("0 0 1"),h.push(i),h.push(u);return h.push("A"),h.push(p/2.8),h.push(p/2.8),h.push("0 0 1"),h.push(i+d/2),h.push(a),h.push("Z"),h.join(" ")},draw:function(e){var t=this,n=e[0],o=e[1];t.pathElement.setAttributeNS(null,"d",t.cloudPath(n,o,t.getStyleValue("stroke-width")))},filter:function(e){var t=null;return e.dragstart&&(t=[e.dragstart],e.dragend?(t.push(e.dragend),this[this.configuration.locationStore]=t):t.push(e.mouselocation)),t},configuration:{input:{options:{}},name:"Cloud",immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-cloud2"],title:["Cloud"],order:0,group:"normal"}}});a.prototype.Shapes[x.prototype.configuration.name]=x;var A=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},getPath:function(e,t,n){function o(e,t,n){var o=e.bodyRadius,i=e.bodyDiameter,a=.05*i,r=3.5*o/3,s=new THREE.Vector3(a,t*-r),l=new THREE.Vector3(i-a,t*-r),c=new THREE.Vector3(i,0),d=Math.acos(e.vecAB.x)*(e.vecAB.y<0?-1:1),p=(new THREE.Matrix4).makeRotationZ(d);s.applyMatrix4(p),l.applyMatrix4(p),c.applyMatrix4(p);for(var u=e.bodyCount,h=0;h<u;++h)n.push("c"),n.push(s.x),n.push(s.y),n.push(l.x),n.push(l.y),n.push(c.x),n.push(c.y)}function i(e,t,n,o){t&&(o.push("M"),o.push(e.pointA.x),o.push(e.pointA.y));var i=1===n?e.large:!e.large;return 0!==e.radius&&(o.push("a"),o.push(e.radius),o.push(e.radius),o.push(0),o.push(i?1:0),o.push(1===n?1:0),o.push(e.pointB.x-e.pointA.x),o.push(e.pointB.y-e.pointA.y)),o}var a=3.5*t,r=function(e){switch(e.length){case 0:case 1:return 1;case 2:return e[0].y>e[1].y?1:-1;default:var t=e[0],n=e[1],o=e[2];return(n.x-t.x)*(n.y+t.y)+(o.x-n.x)*(o.y+n.y)<0?1:-1}}(e),s=[],l=function(e,t){for(var n=e.length,o=[],i=n-(t?0:1),a=0;a<i;++a){var r=e[a],s=e[(a+1)%n],l=s.x-r.x,c=s.y-r.y,d=Math.sqrt(l*l+c*c);o.push({index:a,pointA:new THREE.Vector3(r.x,r.y,0),pointB:new THREE.Vector3(s.x,s.y,0),vecAB:new THREE.Vector3(l/d,c/d,0),vecBA:new THREE.Vector3(-l/d,-c/d,0),length:d})}return o}(e,n),c=function(e,t,n){for(var o=[],i=e.length,a=0;a<i;++a){var r=e[0!==a?a-1:i-1],s=e[a],l=r.vecBA.clone().cross(s.vecAB).z<0;r.length<t||s.length<t||0===a&&!n?o.push({pointA:s.pointA.clone(),pointB:s.pointA.clone(),radius:0,large:!1}):o.push({pointA:s.pointA.clone().add(r.vecBA.clone().multiplyScalar(t)),pointB:s.pointA.clone().add(s.vecAB.clone().multiplyScalar(t)),radius:t,large:l})}return o}(l,a,n),d=c.length;!function(e,t,n){for(var o=2*n,i=e.length,a=0;a<i;++a){var r=e[a],s=t[a],l=t[(a+1)%i];r.bodyA=r.vecAB.clone().multiplyScalar(s.radius).add(r.pointA),r.bodyB=r.vecBA.clone().multiplyScalar(l.radius).add(r.pointB),r.body=r.bodyB.clone().sub(r.bodyA).length(),r.bodyCount=Math.round(r.body/o),r.bodyDiameter=o+(r.body-o*r.bodyCount)/r.bodyCount,r.bodyRadius=.5*r.bodyDiameter}}(l,c,a);for(var p=0;p<d;++p)i(c[p],0===p,r,s),o(l[p],r,s);return n&&s.push("z"),s.join(" ")},WIP_cloudPath:function(e,t,n){var o=this,i=6*t,a=[],r=null;return a.push("M",e[0].x,e[0].y),e.forEach((function(t,n){var s=i,l=e[n+1];if(l){var c=[t.x,t.y,l.x,l.y],d=o.distance.apply(o,c);if(0!==d){var p=o.getAngle.apply(o,c);r=t;var u=d/s;d<2*s?s=d-s>.38*s?d/2:d:s+=(d-(u-=u%1)*s)/u,u=d/s;for(var h=s/2,f=0;f<u;f++)r=o.findNewPoint(r.x,r.y,p,s),f===u-1&&(h=s/2),a.push("A",h,h,"0 0 0",r.x,r.y)}}})),a.join(" ")+(n?"z":"")},draw:function(e,t){var n=this;n.pathElement.setAttributeNS(null,"d",n.getPath(e,n.getStyleValue("stroke-width"),t)),n.refreshDimensions=!0},filter:function(e){if(0!==e.clicks.length){var t=this,n=e.clicks.slice(0),o=!1,i=e.mouselocation,a=e.doubleclick,r=n[0],s=i,l=t.distance(r.x,r.y,s.x,s.y);if(a&&n.length>0)n.push(i),n.push(r),o=!0;else{var c=n[n.length-1],d=Math.abs(t.distance(r.x,r.y,c.x,c.y)),p=t.getStyleValue("stroke-width");d<3*p&&n.length>2?(n[n.length-1]=r,o=!0):Math.abs(l)<p?n.push(r):n.push(i)}return o&&(t[t.configuration.locationStore]=n),n}},configuration:{input:{options:{}},name:"polyCloud",immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-polycloud"],title:["Custom Cloud"],order:0,group:"normal"}}});a.prototype.Shapes[A.prototype.configuration.name]=A;var C=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},polyLine:function(e,t){return this.toSVGPath(e,t)},draw:function(e,t){var n=this;n.pathElement.setAttributeNS(null,"d",n.polyLine(e,t)),n.refreshDimensions=!0},filter:function(e){if(0!==e.clicks.length){var t=this,n=e.clicks.slice(0),o=!1,i=e.mouselocation,a=e.doubleclick,r=n[0],s=i,l=t.distance(r.x,r.y,s.x,s.y);if(a&&n.length>0)n.push(i),n.push(r),o=!0;else{var c=n[n.length-1],d=Math.abs(t.distance(r.x,r.y,c.x,c.y)),p=t.getStyleValue("stroke-width");d<3*p&&n.length>2?(n[n.length-1]=r,o=!0):Math.abs(l)<p?n.push(r):n.push(i)}return o&&(t[t.configuration.locationStore]=n),n}},configuration:{input:{options:{}},name:"Polygon",immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-polyline"],title:["Polygon"],order:0,group:"normal"}}});a.prototype.Shapes[C.prototype.configuration.name]=C;var I=_.extend({setup:function(e){var t=this,n=(t.configuration.style,t.Helpers.DOMHelpers),o=t._guid,i=n.svgElement({parent:e}),a=n.svgElement({elementType:"text",attributes:{"alignment-baseline":"middle"},style:{"pointer-events":"none"},parent:e}),r=n.svgElement({elementType:"clipPath",parent:e,attributes:{id:o}}),s=n.svgElement({parent:r,attributes:{guid:o}});t.clipRect=s,t.textElement=a,t.backgroundElement=i,e.setAttribute("clip-path","url(#"+o+")"),t[t.configuration.elementsStore].push(a,i,s),t[t.configuration.transferSizeElements].push(i,s),t[t.configuration.hitArea]=i;var l=t.createTextArea();t.cursorTextarea=l},draw:function(e,t){var n=this,o=e[0],i=n.textareaStyle,a=n[n.configuration.elementsStore][0],r=n.configuration.extraInformation,s=n.getStyleValue("font-size"),l=n.getLineHeight(s),c=n.previousState,d=n.createTextArea(c?c.metadata:void 0),p=d.querySelector("textarea");n.appendToScreen(d);var u=n[r];p.value=u.text,n.adjustHeight(p);var h=n.Helpers.DOMHelpers.lineBreaks(p),f=n.worldSize({height:p.offsetHeight+p.scrollTop,width:p.offsetWidth+p.scrollLeft}),g=f.height,m=f.width;d.parentNode.removeChild(d);var v=parseInt(i.padding,10)||0,y=parseInt(i.border,10)||0,_=n.worldSize({height:v,width:y});v=_.height,y=_.width,a.innerHTML="";var E=Math.ceil(g/l);new Array(E+1).join(",").split(""),u.textLines=h.join("&#10;"),h.forEach((function(e,t){var i={x:o.x+v+y,y:o.y-l*(t+1)},r=n.Helpers.DOMHelpers.svgElement({elementType:"tspan"});r.textContent=e,r.setAttribute("x",i.x),r.setAttribute("y",-i.y),a.appendChild(r)})),g=Math.max.apply(null,[h.length*l,a.getBBox().height+2*(v+y),l]),n[n.configuration.elementsStore].slice(1).forEach((function(e){e.setAttribute("x",o.x),e.setAttribute("y",-o.y),e.setAttribute("height",g),e.setAttribute("width",m)}))},textareaStyle:{border:1,padding:8},getLineHeight:function(e){return e+.3*e},adjustHeight:function(e,t){if(e.scrollHeight!==e.clientHeight){var n=this.textareaStyle,o=e.scrollHeight+2*(n.padding+n.border),i=e.getBoundingClientRect();t&&i.top+o>document.body.clientHeight?(e.style.height=i.height+"px",e.style.overflowY="auto"):(e.style.height="auto",e.style.overflowY="hidden",e.style.height=o+"px")}},applyTextareaStyle:function(e,t,n){var o=this,i=(o._guid,o.getStyleValue("font-size")),a=o.screenSize({height:i,width:i}),r=o.textareaStyle;i=a.height;var s=o.getLineHeight(i),l=(r.padding,r.border,10*i),c=2*s;if(e||o.metadataCalculated){e=e||o.metadata;var d=o.screenSize({height:e.height,width:e.width});l=d.width,c=d.height}t.ownerDocument.body.contains(t)&&(l=t.clientWidth,c=t.clientHeight);var p={outline:"none",padding:r.padding+"px",color:o.getStyleValue("font-color"),display:"block",height:c+"px",width:l+"px",border:"none","box-sizing":"border-box","font-style":o.getStyleValue("font-style"),"font-weight":o.getStyleValue("font-weight"),"text-decoration":o.getStyleValue("font-decoration"),"background-color":o.convertHex(o.getStyleValue("fill-color"),o.getStyleValue("fill-opacity")),"overflow-y":"hidden","font-size":i+"px","line-height":s+"px","font-family":o.getStyleValue("font-family")};o.Helpers.DOMHelpers.Style(t,p);var u={height:c+"px",width:l+"px",border:r.border+"px solid "+o.getStyleValue("stroke-color"),opacity:o.getStyleValue("fill-opacity"),"pointer-events":"none",position:"absolute",top:0,left:0};o.Helpers.DOMHelpers.Style(n,u)},createTextArea:function(e){var t=this,n={class:t.CONSTANTS.IGNORE_CLICKS},o=t.Helpers.DOMHelpers.svgElement({DOMElement:!0,elementType:"textarea",attributes:n}),i=t.Helpers.DOMHelpers.svgElement({DOMElement:!0,elementType:"div",attributes:{class:"dr-text-shape-bg"}}),a=t.Helpers.DOMHelpers.svgElement({DOMElement:!0,elementType:"div",style:{position:"absolute",height:"auto",width:"auto",border:"1px solid "+t.getStyleValue("stroke-color"),background:"white"}});return t.applyTextareaStyle(e,o,i),a.appendChild(o),a.appendChild(i),a},textareaMetadata:function(e){var t=window.getComputedStyle(e),n=e.offsetHeight+e.scrollTop,o=e.offsetWidth+e.scrollLeft,i=parseInt(t.left,10),a=parseInt(t.top,10),r=[{x:i,y:a},{x:i+o,y:a+n}];return e.style.height=n+"px",e.style.width=o+"px",r},filter:function(e,t,n){var o=this,i=!1,a=o.previousState;a&&(i=!0,a[o.configuration.locationStore]);var r=e.clicks.slice(0);!i&&1===r.length&&e.dragstart&&(r=[o.clone(e.dragstart),r[0]]),!i&&0===r.length&&e.dragstart&&(r=[o.clone(e.dragstart)]);var s=i?0:1,l=o.configuration.extraInformation;o.configuration.locationStore,o[l]=o[l]||{text:""};var c=r[0];i&&(c=o.getGroupBoundingBox()[0],o.insertTextAtPoint=c);var d=o.cursorTextarea;if(r.length===s)return o.detachFromScreen(d),o.resolver?void 0:new Promise((function(e,t){o.resolver=e,o.rejecter=t,o.textCollector=o.createTextArea(i?a.metadata:null);var n=o.textCollector.querySelector("textarea"),r=o.screenPoint(c);o.textCollector.style.left=r.x+"px",o.textCollector.style.top=r.y+"px",a&&(n.value=a[l].text),o.appendToScreen(o.textCollector),n.addEventListener("keyup",(function(){o.adjustHeight(this,!0)})),setTimeout((function(){n.focus()}),100)}));if(r.length>s)o.saveNow();else if(o.belongsToGroup&&o.appendToScreen(d),e.mouselocation){var p=o.screenPoint(e.mouselocation);d.style.pointerEvents="none",d.style.left=p.x+"px",d.style.top=p.y+"px"}},saveNow:function(){var e=this,t=e.cursorTextarea;t&&e.detachFromScreen(t);var n=e.configuration.extraInformation,o=e.configuration.locationStore;if(e[n]=e[n]||{text:""},e.resolver){var i=e.textCollector.querySelector("textarea").value.trim();e[n].text=i,e.insertTextAtPoint;var a=e.textareaMetadata(e.textCollector);e[o]=a.map((function(t){return e.worldPoint(t)})),e.resolver(e[o]),delete e.textCollector,delete e.resolver,delete e.rejecter}},onStyleChange:function(){var e=this,t=e.cursorTextarea;t&&e.applyTextareaStyle(null,t.querySelector("textarea"),t.querySelector("div"));var n=e.textCollector;n&&e.applyTextareaStyle(null,n.querySelector("textarea"),n.querySelector("div"))},connectablePosition:function(e){if(!this[this.textCollector])return e.clicks[0]||e.dragstart||e.mouselocation},configuration:{input:{options:{}},name:"Text",immuneStyle:[],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",transferSizeElements:"transformSizeElements",screenReferenceBBox:"screenReferenceBBox",extraInformation:"extraInformation",editable:!0,triggerAppearance:{class:["markup-icon-texttool"],title:["Text"],order:0,group:"normal"},resizeType:a.prototype.CONSTANTS.LABEL_RESIZE}});a.prototype.Shapes[I.prototype.configuration.name]=I;var k=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},arrowPath:function(e,t,n){var o=e.x,i=e.y,a=t.x,r=t.y,s=[],l=20,c=Math.atan2(r-i,a-o);return!n&&s.push("M",o,i),s.push("L",a,r),s.push("L",a-l*Math.cos(c-Math.PI/7),r-l*Math.sin(c-Math.PI/7)),s.push("L",a-l*Math.cos(c+Math.PI/7),r-l*Math.sin(c+Math.PI/7)),s.push("L",a,r),s.push("L",a-l*Math.cos(c-Math.PI/7),r-l*Math.sin(c-Math.PI/7)),s.join(" ")},polyArrow:function(e){var t=this,n="";if(2===e.length)n=t.arrowPath(e[0],e[1]);else{n=t.toSVGPath(e.slice(0,-1));var o=e.slice(-2);n+=t.arrowPath(o[0],o[1],!0)}return n},draw:function(e,t){var n=this;n.pathElement.setAttributeNS(null,"d",n.polyArrow(e,t)),n.refreshDimensions=!0},filter:function(e){if(0!==e.clicks.length){var t=e.clicks.slice(0),n=!1,o=e.mouselocation,i=e.doubleclick;return t[0],i&&t.length>0?(t.push(o),n=!0):t.push(o),n&&(this[this.configuration.locationStore]=t),t}},configuration:{input:{options:{}},name:"steppedArrow",immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-subdirectory_arrow_right"],title:["Stepped Arrow"],order:0,group:"normal"}}});a.prototype.Shapes[k.prototype.configuration.name]=k;var N=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},starPoints:function(e,t){for(var n=.5*(t.x-e.x),o=.5*(t.y-e.y),i=Math.max(Math.abs(n),Math.abs(o)),a=e.x,r=e.y,s=1.5*i,l=2.3*i,c=[],d=Math.PI/7,p=0;p<14;p++){var u=0==(1&p)?s:l,h=a+Math.cos(p*d)*u,f=r+Math.sin(p*d)*u;c.push({x:h,y:f})}return c},draw:function(e){this.pathElement.setAttribute("d",this.toSVGPath(e,!0))},filter:function(e){var t=this,n=null;if(e.dragstart){n=[e.dragstart],e.dragend?n.push(e.dragend):n.push(e.mouselocation);var o=t.starPoints(n[0],n[1]);return e.dragend&&(t[t.configuration.locationStore]=o),o}return null},configuration:{input:{options:{}},name:"Star",immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:["markup-icon-star"],title:["Star"],order:0,group:"normal"},resizeType:a.prototype.CONSTANTS.LABEL_RESIZE}});a.prototype.Shapes[N.prototype.configuration.name]=N;var M=_.extend({setup:function(e){var t=this,n=document.createElementNS(t.CONSTANTS.SVGNS,"path");t[t.configuration.elementsStore].push(n),e.appendChild(n),t.pathElement=n,t[t.configuration.hitArea]=n},getCirclePath:function(e,t){var n=.5*t;return"M "+e.x+" "+(e.y+n)+" a "+n+","+n+" 0 1,1 "+t+",0 a "+n+","+n+" 0 1,1 "+-t+",0"},draw:function(e){var t=this,n=e[0];t.pathElement.setAttributeNS(null,"d",t.getCirclePath(n,t.getStyleValue("stroke-width")))},filter:function(e){var t=this,n=[];return e.dragstart?n=[e.dragstart]:e.clicks.length>0&&(n=e.clicks.slice(0)),n.length>0&&(t[t.configuration.locationStore]=[n[0]]),t[t.configuration.locationStore]},configuration:{input:{options:{}},name:"Dot",hidden:!0,userCenterForConnecting:!0,immuneStyle:["font-family","font-size","font-style","font-weight","font-decoration"],immuneResize:["n","s","w","e","nw","ne","sw","se","rotation"],elementsStore:"visibleElements",locationStore:"locationStore",hitArea:"hitArea",triggerAppearance:{class:[],title:["Circle"],order:0,group:"normal"}}});a.prototype.Shapes[M.prototype.configuration.name]=M;var R=a.extend({constructor:function(e){var t=this;t.element=e.element,t.Adapter=e.Adapter,t.domListeners=new v(t.element),t.designReviewInstance=e.designReviewInstance,t.callback=e.callback||function(){},t.clickFilter=e.clickFilter||function(){},t.flush(!0),t.updateOptions(e.options),t.attachEvents(),t.domListeners.turnOn()},updateOptions:function(e){var t=this;t.options=e||{smoothen:!1,smoothBufferSize:10},t.buffer=[],t.bufferSize=t.options.smoothBufferSize||10},__PRIVATE_passEvents:function(e){var t=this;return function(n){var o=t.element.getBoundingClientRect(),i=n.pageX,a=n.pageY,r=n.touches;if(r&&0===r.length&&(r=n.changedTouches),r){if(0===r.length)return;i=r[0].clientX,a=r[0].clientY}var s={x:i-o.left,y:a-o.top},l=t.Adapter.screenToWorld(s);n.mousePosition=l,l.timestamp=Date.now(),t[e].apply(t,Array.prototype.slice.call(arguments,0))}},attachEvents:function(){var e=this,t=e.EVENT_NAMES,n={};n[t.EVENT_DRAG_START]=e.__PRIVATE_passEvents("dragstart"),n[t.EVENT_DRAGGING]=e.__PRIVATE_passEvents("drag"),n[t.MOUSE_MOVE]=e.__PRIVATE_passEvents("mousemove"),n[t.EVENT_DRAG_END]=e.__PRIVATE_passEvents("dragend"),n[t.EVENT_CLICK]=e.__PRIVATE_passEvents("click"),n[t.EVENT_DOUBLECLICK]=e.__PRIVATE_passEvents("doubleclick"),e.eventsHandlers=n,e.domListeners.on(e.eventsHandlers)},flush:function(e){this.captured={happened:{},data:{clicks:[],dragstart:null,dragmovements:[],dragend:null,doubleclick:null,mouselocation:null}},!e&&this.triggerCallback()},amendPath:function(){var e=this,t=e.getAveragePoint(0),n=e.buffer;if(t){e.captured.data.dragmovements.push(t),e.bufferPositions=[];for(var o=2;o<n.length;o+=2)t=e.getAveragePoint(o),e.bufferPositions.push(t)}},appendToBuffer:function(e){var t=this.buffer,n=this.bufferSize;for(t.push(e);t.length>n;)t.shift()},getAveragePoint:function(e){var t=this.buffer,n=this.bufferSize,o=t.length;if(o%2==1||o>=n){var i,a,r=0,s=0,l=0;for(a=e;a<o;a++)l++,r+=(i=t[a]).x,s+=i.y;return{x:r/l,y:s/l}}return null},dragstart:function(e){var t=this,n=t.captured.data,o=e.mousePosition;n.dragstart=o,t.options.smoothen&&t.appendToBuffer(o),t.triggerCallback()},drag:function(e){var t=this,n=t.captured.data,o=e.mousePosition;t.options.smoothen?(t.appendToBuffer(o),t.amendPath()):n.dragmovements.push(o),t.triggerCallback()},mousemove:function(e){var t=this,n=t.captured.data;n.dragstart&&t.drag(e),n.mouselocation=e.mousePosition,t.triggerCallback()},dragend:function(e){this.captured.data.dragend=e.mousePosition,this.triggerCallback()},doubleclick:function(e){var t=this.captured.data;t.clicks.splice(t.clicks.length-2),t.doubleclick=e.mousePosition,this.triggerCallback()},click:function(e){var t=this,n=t.captured.data,o=!0;t.clickFilter&&(o=t.clickFilter(e)),o&&(n.clicks.push(e.mousePosition),t.triggerCallback())},detachEvents:function(){var e=this;e.domListeners&&(e.domListeners.off(e.eventsHandlers),e.domListeners.turnOff(),e.domListeners=null)},triggerCallback:function(){var e=this,t=JSON.parse(JSON.stringify(e.captured.data));e.options&&e.options.smoothen&&t.dragmovements.push.apply(t.dragmovements,e.bufferPositions||[]),t.flush=e.flush.bind(e),e.callback(t)},destroy:function(){this.detachEvents()}});a.prototype.Base.Input=R;var O=a.extend({constructor:function(e){var t=this,n=(e=e||{}).svgElement,o=e.designReviewInstance;t._guid=t.uuid(),t.designReviewInstance=o,t.Adapter=t.designReviewInstance.Adapter,t[t.CONSTANTS.EDIT_LAYER_NAME]=n,t.connectingElements=[],t[t.CONSTANTS.GROUP_ELEMENT_NAME]=document.createElementNS(t.CONSTANTS.SVGNS,"g"),t.shapeObjects=[],t.isGroup=!0},__PRIVATE__addGuid:function(e){var t=this;e.forEach((function(e){e.setAttribute("guid",t._guid)}))},start:function(){var e=this;e.editMode=!0,e.__PRIVATE__addGuid([e[e.CONSTANTS.GROUP_ELEMENT_NAME]]),e[e.CONSTANTS.EDIT_LAYER_NAME].appendChild(e[e.CONSTANTS.GROUP_ELEMENT_NAME]),e.invokeShape()},creationDone:function(e){var t=this;t.flushInput&&t.flushInput(),t.invokeShape()},input:function(e){var t=this.getCurrentEditing();t&&(this.flushInput=e.flush,t.input.call(t,e,!!t.previousState,t.metadata))},getConnectorInstace:function(){var e=this,t=e.designReviewInstance.createShapeOfType(e.connectorShape,{belongsToGroup:!0});return e.connectingElements.push(t),t.dontResize=!0,t.connectingElement=!0,t.start(),t[t.CONSTANTS.GROUP_ELEMENT_NAME].style.pointerEvents="none",t},invokeShape:function(){var e=this,t=e.designReviewInstance,n=e.shapeNames,o=e.shapeObjects.length,i=n[o];if(i){var a={belongsToGroup:!0},r=e.shapeObjects[o-1];r&&(a.connectFrom=[r],a.connectShape=e.connectorShape,a.connectorShapeConfig={belongsToGroup:!0});var s=t.createShapeOfType(i,a);s.configuration.immuneResize=s.configuration.immuneResize||[],s.blockResize=s.configuration.immuneResize.slice(0),s.blockResize.push("rotation"),e.shapeObjects.push(s),s.start(e[e.CONSTANTS.GROUP_ELEMENT_NAME],e)}else e.editMode&&e.stop()},stop:function(e){var t=this;t.editMode=!1,t.designReviewInstance.creationDone(t);var n={guid:t._guid,args:[]};if(!e){var o=t.designReviewInstance.createHistoryAction("detach",n),i=t.designReviewInstance.createHistoryAction("recover",n);t.addHistory({undo:o,redo:i})}},destroy:function(){var e=this;e.shapeObjects.forEach((function(e){e.destroy()}));var t=e[e.CONSTANTS.GROUP_ELEMENT_NAME];t&&t.parentNode&&t.parentNode.removeChild(t)},detach:function(){var e=this;e.shapeObjects.forEach((function(e){e.detach(!0,!0)}));var t=e[e.CONSTANTS.GROUP_ELEMENT_NAME];t.setAttribute("__deleted__",!0),e.Helpers.DOMHelpers.Style(t,{display:"none"}),e.storeExistence("recover","detach"),e.detached=!0},recover:function(){var e=this;e.shapeObjects.forEach((function(e){e.recover(!0)})),e.connectingElements.forEach((function(e){e.recover(!0)}));var t=e[e.CONSTANTS.GROUP_ELEMENT_NAME];t.setAttribute("__deleted__",!1),e.Helpers.DOMHelpers.Style(t,{display:""}),e.detached=!0},storeExistence:function(e,t){var n=this,o={guid:n._guid,args:[]},i=n.designReviewInstance.createHistoryAction(e,o),a=n.designReviewInstance.createHistoryAction(t,o);n.addHistory({undo:i,redo:a})},addHistory:function(e){this.designReviewInstance.History.add(e)},group:!0,getCurrentEditing:function(){return this.shapeObjects.slice(-1)[0]},saveOrDie:function(){var e=this.getCurrentEditing();e&&e.saveOrDie()},setStyle:function(e){var t=this,n=t.getCurrentEditing();n&&n.setStyle.apply(n,arguments)},getStyleValue:function(){var e=this,t=e.getCurrentEditing();if(t)return t.getStyleValue.apply(t,arguments)},setStyleMapping:function(e){var t=this,n=t.getCurrentEditing();n&&n.setStyleMapping.apply(n,arguments)},setStyleReferences:function(e){var t=this,n=t.getCurrentEditing();n&&n.setStyleReferences.apply(n,arguments)},updateStyle:function(e){var t=this,n=t.getCurrentEditing();n&&n.updateStyle.apply(n,arguments)},loadStyleFor:function(){return this.getCurrentEditing().configuration.name},exportMetadata:function(){var e=[];return this.shapeObjects.forEach((function(t){e.push(t.exportMetadata())})),e},export:function(){var e=this,t=e[e.CONSTANTS.GROUP_ELEMENT_NAME],n=e.shapeObjects,o=e.connectingElements,i={xmlns:"http://www.w3.org/1999/xhtml",type:e.configuration.name,id:e._guid,group:!0,shapes:e.shapeNames.join(" "),connectingShape:e.connectorShape,shapeIdentifiers:n.map((function(e){return e._guid})).join(" "),connectorsIdentifiers:o.map((function(e){return e._guid})).join(" ")},a=e.CONSTANTS.SVGNS,r=document.createElementNS(a,"metadata"),s=document.createElementNS(a,"markup_element");for(var l in i)s.setAttribute(l,i[l]);r.appendChild(s);var c=t.cloneNode();return c.insertBefore(r,c.firstChild),n.forEach((function(e){var t=e.export();t&&c.appendChild(t)})),o.forEach((function(e){var t=e.export();t&&c.appendChild(t)})),c}});a.prototype.Base.Group=O;const P=O;var V=P.extend({shapeNames:["Rectangle","Text"],connectorShape:"Line",configuration:{name:"rectangleCallout",triggerAppearance:{class:[],title:["Rectangle Callout"],order:0,group:"callout"}}});a.prototype.Shapes[V.prototype.configuration.name]=V;var L=P.extend({shapeNames:["Dot","Text"],connectorShape:"Line",configuration:{name:"pointCallout",triggerAppearance:{class:[],title:["Point Callout"],order:0,group:"callout"}}});a.prototype.Shapes[L.prototype.configuration.name]=L;var D=P.extend({shapeNames:["ellipse","Text"],connectorShape:"Line",configuration:{name:"circleCallout",triggerAppearance:{class:[],title:["Ellipse Callout"],order:0,group:"callout"}}});a.prototype.Shapes[D.prototype.configuration.name]=D;var z=P.extend({shapeNames:["Cloud","Text"],connectorShape:"Line",configuration:{name:"cloudCallout",triggerAppearance:{class:[],title:["Cloud Callout"],order:0,group:"callout"}}});a.prototype.Shapes[z.prototype.configuration.name]=z;var H=P.extend({shapeNames:["polyCloud","Text"],connectorShape:"Line",configuration:{name:"polycloudCallout",triggerAppearance:{class:[],title:["Polycloud Callout"],order:0,group:"normal"}}});a.prototype.Shapes[H.prototype.configuration.name]=H;var B=P.extend({shapeNames:["Polygon","Text"],connectorShape:"Line",configuration:{name:"polygonCallout",triggerAppearance:{class:[],title:["Polygon Callout"],order:0,group:"callout"}}});a.prototype.Shapes[B.prototype.configuration.name]=B;var G=P.extend({shapeNames:["Star","Text"],connectorShape:"Line",configuration:{name:"starCallout",triggerAppearance:{class:[],title:["Star Callout"],order:0,group:"callout"}}});a.prototype.Shapes[G.prototype.configuration.name]=G;a.prototype.Base.drHistory=function(){var e,t,n=[],o=-1,i=0,a=!1;return t=function(e,t){return e&&"function"==typeof e[t]?(a=!0,e[t](),a=!1,this):this},{add:function(t){return a||(n.splice(o+1,n.length-o),n.push(t),i&&n.length>i&&(0,s=-(i+1),(r=n).splice(0,!s||1+s-0+(!(s<0^!0)&&(s<0||-1)*r.length)),r.length),o=n.length-1,e&&e()),this;var r,s},setCallback:function(t){e=t},undo:function(){var i=n[o];return i?(t(i,"undo"),o-=1,e&&e(),this):this},redo:function(){var i=n[o+1];return i?(t(i,"redo"),o+=1,e&&e(),this):this},clear:function(){var t=n.length;n=[],o=-1,e&&t>0&&e()},hasUndo:function(){return-1!==o},hasRedo:function(){return o<n.length-1},getCommands:function(){return n},getIndex:function(){return o},setLimit:function(e){i=e}}};var U=n(79331),j=n(417),F=n(11204),Z=n(61446),K=n(2262),W=n(66252);function X(e){return{components:{SearchOutlined:F.Z},inject:["go"],setup(){const t=(0,K.qj)({searchText:"",searchedColumn:""}),n=(0,K.iH)([]),o=(0,K.iH)([]),i=(0,K.iH)(),a=(0,K.iH)(!0),r=(0,K.iH)(!1),s=(0,K.iH)([]),l=[{title:"文件名",dataIndex:"name",key:"name",slots:{filterDropdown:"filterDropdown",filterIcon:"filterIcon",customRender:"nameRender"},onFilter:(e,t)=>t.name.toString().toLowerCase().includes(e.toLowerCase()),onFilterDropdownVisibleChange:e=>{e&&setTimeout((()=>{console.log(i.value),i.value.focus()}),0)}},{title:"是否轻量化",dataIndex:"isTranslate",key:"isTranslate",slots:{customRender:"isTranslateRender"}}],c=(e,t)=>{n.value=e||[],o.value=t||[]},d=(0,W.Fl)((()=>({selectedRowKeys:(0,K.SU)(n),onChange:c,hideDefaultSelections:!0,getCheckboxProps:e=>({disabled:!e.isTranslate||"false"===e.isTranslate||e.isDir,name:e.name}),selections:[{key:"ReverseElection",text:"反选",onSelect:()=>{var e=[],t=[];s.value.forEach((o=>{n.value.includes(o.id)||o.isDir||!o.isTranslate||(e.push(o.id),t.push(o))})),n.value=t,c(e,t)}}]})));return(0,W.bv)((()=>{e.emit("getCustomFiles"),e.on("setCustomFiles",(e=>{s.value=e,a.value=!1}),{allowDuplicateKey:!1})})),{data:s,columns:l,searchText:"",searchInput:i,searchedColumn:"",rowSelection:d,selectedRowKeys:n,loading:a,selectedData:o,goLoading:r,selectedDataChange:e=>{o.value=o.value.filter((t=>t.id.toString()!==e.currentTarget.parentNode.dataset.id.toString())),n.value=n.value.filter((t=>t.toString()!==e.currentTarget.parentNode.dataset.id.toString()))},handleSearch:(e,n,o)=>{n(),t.searchText=e[0],t.searchedColumn=o},handleReset:e=>{e(),t.searchText=""},rowClick:(t,n)=>({style:{cursor:"pointer"},onClick:n=>{t.isDir&&"true"===t.isDir.toString()&&(a.value=!0,t.isDir&&e.emit("getCustomFiles",t))}})}},methods:{goViewer(){this.goLoading=!0;var e=[];this.selectedData.forEach((t=>{e.push(t.svfUrl)})),e.length>0?this.go(Array.from(new Set(e))):Z.Z.info("请先选择文件！"),this.goLoading=!1}},template:'\n    <div style="margin: 10px 24px;">\n        <span>已选择：</span>\n        <span v-for="it in selectedData" :key="it">\n            <a-tag closable @close="selectedDataChange" :data-id="it[\'id\']" color="cyan">{{it[\'name\']}}</a-tag>\n        </span>\n    </div>\n    <a-table :data-source="data" :columns="columns" :row-selection="rowSelection" :pagination="false" size="small" :loading="loading" :customRow="rowClick" :rowKey="record => record.id" :scroll="{ y: 500 }">\n        <template #filterDropdown="{ setSelectedKeys, selectedKeys, confirm, clearFilters, column }">\n            <div style="padding: 8px">\n                <a-input ref="searchInput" :placeholder=\'"搜索" + column.title\' :value="selectedKeys[0]" style="width: 188px; margin-bottom: 8px; display: block"\n                    @change="(e) => setSelectedKeys(e.target.value ? [e.target.value] : [])"\n                    @pressEnter="handleSearch(selectedKeys, confirm, column.dataIndex)"\n                />\n                <a-button type="primary" size="small" style="width: 90px; margin-right: 8px" @click="handleSearch(selectedKeys, confirm, column.dataIndex)">\n                    <template #icon><SearchOutlined /></template>搜索\n                </a-button>\n                <a-button size="small" style="width: 90px" @click="handleReset(clearFilters)">重置</a-button>\n            </div>\n        </template>\n        <template #filterIcon="filtered">\n            <search-outlined :style="{ color: filtered ? \'#108ee9\' : undefined }" />\n        </template>\n        <template #nameRender="{ text, record }">\n            <template v-if="record.isDir">\n                <span class="wedofont wedo-folder-fill" style="color: #ffe589"></span>\n            </template>\n            <template v-else>\n                <span class="wedofont wedo-file-text" style="color: #989899"></span>\n            </template>\n            {{ text }}\n        </template>\n        <template #isTranslateRender="{ text, record }">\n            <template v-if="record.isTranslate || record.isTranslate=== \'true\'">\n                <span class="wedofont wedo-check-circle-fill" style="color: #19be6b"></span>\n            </template>\n            <template v-else>\n                <span class="wedofont wedo-close-circle-fill" style="color: #ed3f14"></span>\n            </template>\n        </template>\n    </a-table>\n    <div style="text-align: right; margin: 15px">\n        <a-button type="primary" @click="goViewer" :loading="goLoading">选好了，去追加</a-button>\n    </div>\n',name:"TableModal"}}var q=n(36929);n(55419);class Y{constructor(e){this.addSreenshotViewer=null,this.params=e,this.copyFileNames=JSON.parse(JSON.stringify(e.models)),this.modelLoadOptions={isAEC:!0,skipPropertyDb:!1,modelSpace:!0,placementTransform:new THREE.Matrix4,applyScaling:"m",globalOffset:{x:0,y:0,z:0}},this.init()}init(e){const t=window.Autodesk,n=(window.THREE,this.noToolbar=this.params.noToolbar),o=this.params.customCallback,i=e||this.params.models,a=document.getElementById("addScreViewer");let r,s,l;r={env:"Local",offline:"true",useADP:!1},s={extensions:["VE.Model.Annotation"],disabledExtensions:{},memory:{limit:32768}},l=this.modelLoadOptions,t.Viewing.Initializer(r,(e=>{this.addSreenshotViewer=n?new Autodesk.Viewing.Viewer3D(a,s):new Autodesk.Viewing.GuiViewer3D(a,s),this.addSreenshotViewer.start("")>0?console.error("Failed to create a Viewer: WebGL not supported."):(console.log("Initialization complete, loading a model next..."),i.length<=0?this.params.customCallback instanceof Function&&this.params.customCallback(this):this.wDLoadModel(i,!1,null,l,o),this.addSreenshotViewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,function e(){this.addSreenshotViewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e.bind(this)),this.addSreenshotViewer.toolbar.setVisible(!1)}.bind(this)))}))}onSuccessCallback(e,t,n,o,i){t.shift(),this.wDLoadModel(t,n,null,o,i)}onErrorCallback(e){console.error(e)}async wDLoadModel(e,t=!1,n,o,i){if(o||this.modelLoadOptions,e.length>0){if(t){let e=this.addSreenshotViewer.config;this.addSreenshotViewer.config.extensions=n||this.initExtensins||Object.keys(this.addSreenshotViewer.getLoadedExtensions()),this.addSreenshotViewer.tearDown(),this.addSreenshotViewer.setUp(e)}if(".json"===e[0].substr(e[0].lastIndexOf("."))){const n=decodeURIComponent(e[0]);Autodesk.Viewing.Document.load(n,(n=>{n.downloadAecModelData();const a=n.getRoot().getDefaultGeometry();o.keepCurrentModels=!0,this.addSreenshotViewer.loadDocumentNode(n,a,o).then((n=>{this.onSuccessCallback(n,e,t,o,i)}),(e=>{this.onErrorCallback(e)}))}))}else{if(this.addSreenshotViewer.loadModel(e[0],o,(n=>{this.onSuccessCallback(n,e,t,o,i)}),(e=>{this.onErrorCallback(e)}))>0)return void console.error("Failed to create a Viewer: WebGL not supported.");console.log("Initialization complete, loading a model next...")}}else{(0,q.Z)(this.addSreenshotViewer);let e=this.addSreenshotViewer.impl.modelQueue().getModels().length;console.log("模型个数："+e);let t=setInterval((()=>{e>=1?this.addSreenshotViewer.impl.modelQueue().getModels()[e-1].isLoadDone()&&e--:(clearInterval(t),i instanceof Function&&i(this))}),300)}}destroy(){this.addSreenshotViewer.tearDown(),this.addSreenshotViewer=null}}var J=n(74324),$=n(90927),Q=n(94069);function ee(e,t){return n(37494),{components:{TableModal:X(e),LoadingOutlined:J.Z},provide(){return{go:e=>{this.initViewer(e)}}},setup(){const n=(0,U.iH)(!0),o=(0,U.iH)(!1),i=(0,U.iH)(!1),a=(0,U.iH)([]),r=(0,U.iH)([]),s=(0,U.iH)([]),l=(0,U.iH)([]),c=(0,U.iH)([]),d=(0,U.iH)([]),p=(0,U.qj)({}),u=(0,U.iH)([]),h=(0,U.iH)(!1),f=(0,U.iH)(),g=()=>{e.off("setCustomProblemCategories"),e.off("setCustomProfessionals"),e.off("setCustomMsg2persons"),e.off("go-save-other-markers"),e.off("setCustomUserInfos")},m=()=>{a.value=[],g()},v=t=>{"array"===Q.Z.dataType(t)&&(t=t[0]);const o=t.id;let i=[],{probCategories:r,profeName:s,noticePersons:l,authorId:c,authorName:d}=t.othersInfos;a.value.forEach((e=>{e&&e.files&&i.push(((e,t,n,o)=>new Promise(((i,a)=>{var r,s,l,c,d;(r=t.markup.markup,s=t.asImage,l=new File([r],"wedo_svg_"+new Date+".svg",{type:"image/svg+xml"}),c=((e,t)=>{for(var n=e.split(","),o=n[0].match(/:(.*?);/)[1],i=atob(n[1]),a=i.length,r=new Uint8Array(a);a--;)r[a]=i.charCodeAt(a);return new File([r],t,{type:o})})(s,"wedo_snapshot_"+new Date+".png"),d=new FormData,d.append("clientId",window.clientId),d.append("clientSecret",window.clientId),d.append("svg",l),d.append("containSvgPng",c),new Promise(((e,t)=>{(0,$.dI)(d).then((t=>{e(t)})).catch((e=>{console.error(e),t(e)}))}))).then((r=>{var s=r.data.data;const{probCategories:l,profeName:c,noticePersons:d,authorId:p,authorName:u}=o;let h=new FormData;h.append("clientId",window.clientId),h.append("themeId",e),h.append("files",n),h.append("id",s.id),h.append("commentString",JSON.stringify(t.markup)),h.append("probCategories",l),h.append("profeName",c),h.append("noticePersons",d),h.append("authorId",p),h.append("authorName",u),(0,$.dj)(h).then((e=>{i(e.data.data)})).catch((e=>{console.error(e),a(e)}))}))})))(o,e,e.files,{probCategories:r,profeName:s,noticePersons:l,authorId:c,authorName:d}))})),Promise.all(i).then((t=>{h.value=!1,n.value=!1,console.log("副数据保存成功"),e.emit("refreshComments",{themeId:o}),Z.Z.success("批注成功！"),m()})).catch((e=>{console.error(e)}))},y=({img:e,markupData:t,models:r,e:s})=>{if(n.value=!0,o.value=!1,i.value=!1,e){var l=[];r.forEach((e=>{var t=e.myData.urn;if(t.includes(window.clientId)){var n=t.split("/");l.push(n[n.indexOf(window.clientId)+1])}else l.push(t)})),a.value.push({asImage:e,markup:t,files:l})}s.destroy(),f.value=null,s=null},_=(0,U.h)(J.Z,{style:{fontSize:"24px"},spin:!0});return(0,U.bv)((()=>{a.value=[{asImage:t.asImage,markup:t}],e.on("setCustomProblemCategories",(e=>{"array"!==Q.Z.dataType(e)&&(console.error("数据格式不对"),Z.Z.error(`当前用户信息需要一个数组，但是传入的却是一个${Q.Z.dataType(e)}`)),s.value=e}),{allowDuplicateKey:!1}),e.on("setCustomProfessionals",(e=>{"array"!==Q.Z.dataType(e)&&(console.error("数据格式不对"),Z.Z.error(`当前用户信息需要一个数组，但是传入的却是一个${Q.Z.dataType(e)}`)),c.value=e}),{allowDuplicateKey:!1}),e.on("setCustomMsg2persons",(e=>{"array"!==Q.Z.dataType(e)&&(console.error("数据格式不对"),Z.Z.error(`当前用户信息需要一个数组，但是传入的却是一个${Q.Z.dataType(e)}`)),u.value=e}),{allowDuplicateKey:!1}),e.on("go-save-other-markers",(e=>{"array"!==Q.Z.dataType(e)&&(console.error("数据格式不对"),Z.Z.error(`当前用户信息需要一个数组，但是传入的却是一个${Q.Z.dataType(e)}`)),v(e)}),{allowDuplicateKey:!1}),e.on("setCustomUserInfos",(e=>{"object"!==Q.Z.dataType(e)&&(console.error("数据格式不对"),Z.Z.error(`当前用户信息需要一个对象，但是传入的却是一个${Q.Z.dataType(e)}`)),Object.keys(e).forEach((t=>{p[t]=e[t]}))}),{allowDuplicateKey:!1})})),(0,U.se)((()=>{g()})),{visible:n,addScreVisible:o,imgs:a,currentCategorie:r,pCategories:s,currentprofessional:l,professionals:c,currentMsg2person:d,msg2persons:u,currentAccount:p,confirmLoading:h,tableShow:i,addSreenshotViewer:f,categoriesChange:(e,t)=>{},msg2personChange:(e,t)=>{},handleOk:()=>{h.value=!0,e.emit("getCustomUserInfos");const o=setInterval((()=>{var i,a,f,g,m;p.id&&p.name&&(clearInterval(o),i=JSON.stringify(s.value.filter((e=>r.value.includes(e.id))).map((e=>e.name))),a=JSON.stringify(c.value.filter((e=>l.value.includes(e.id))).map((e=>e.name))),f=JSON.stringify(u.value.filter((e=>d.value.includes(e.id))).map((e=>e))),g=p.id,m=p.name,t.othersInfos={probCategories:i,profeName:a,noticePersons:f,authorId:g,authorName:m},e.Adapter.save(t,{visible:n,confirmLoading:h,message:Z.Z}))}),100)},handleCancle:m,delImg:e=>{!e||e.files?a.value=a.value.filter((t=>e.asImage!==t.asImage)):Z.Z.warning("主视图批注不能删除！")},addScreenshot:()=>{n.value=!1,o.value=!0,i.value=!0},addScreCancle:()=>{n.value=!0,o.value=!1,i.value=!1},initViewer:e=>{i.value=!1,f.value=new Y({models:e,noToolbar:!1,customCallback:e=>{(e=>{e.addSreenshotViewer.getExtension("VE.Model.Annotation",(t=>{t.buttonBindEvents(),t.on("finish",((t,n,o)=>{y({img:t,markupData:n,models:o,e})}),{allowDuplicateKey:!1}),t.on("cancle",(()=>{y({img:void 0,markupData:void 0,models:void 0,e})}),{allowDuplicateKey:!1})}))})(e)}})},professionalChange:(e,t)=>{},indicator:_}},template:'\n    <div class="marker-save-modal-div">\n        <a-modal :destroyOnClose="true" class="marker-save-modal" title="保存·审阅批注" :maskClosable="false" v-model:visible="visible" :confirm-loading="confirmLoading" cancelText="取消" okText="保存" @cancel="handleCancle" @ok="handleOk">\n            <div>\n                <div>\n                    <span>问题类别：</span>\n                    \x3c!---<a-tooltip color="rgba(54,59,62,.8)" title="添加新的问题类别">\n                        <span class="wedofont wedo-plus-circle-fill" style="float:right;text-align:center;vertical-align:middle;height:20px;margin-top:-3px;"></span>\n                    </a-tooltip>--\x3e\n                </div>\n                <a-select mode="multiple" v-model:value="currentCategorie" style="width: 100%" placeholder="请选择问题类别" @change="categoriesChange" @dropdownVisibleChange="getProblemCategories">\n                    <a-select-option :disabled="true" v-if="pCategories.length<=0" style="text-align: center;"><a-spin :indicator="indicator" size="small" /></a-select-option>\n                    <a-select-option v-else v-for="i in pCategories" :key="i[\'id\']">{{ i[\'name\'] }}</a-select-option>\n                </a-select>\n            </div>\n            <div>\n                <span>专业：</span>\n                <a-select mode="multiple" v-model:value="currentprofessional" style="width: 100%" placeholder="请选择专业" @change="professionalChange" @dropdownVisibleChange="getProfessionals">\n                    <a-select-option :disabled="true" v-if="professionals.length<=0" style="text-align: center;"><a-spin :indicator="indicator" size="small" /></a-select-option>\n                    <a-select-option v-else v-for="i in professionals" :key="i[\'id\']">{{ i[\'name\'] }}</a-select-option>\n                </a-select>\n            </div>\n            <div>\n                <span>@：</span>\n                <a-select mode="multiple" v-model:value="currentMsg2person" style="width: 100%" placeholder="请选择需要@的人员" @change="msg2personChange" @dropdownVisibleChange="getMsg2persons">\n                    <a-select-option :disabled="true" v-if="msg2persons.length<=0" style="text-align: center;"><a-spin :indicator="indicator" size="small" /></a-select-option>\n                    <a-select-option v-else v-for="i in msg2persons" :key="i[\'id\']">{{ i[\'name\'] + \' \' + i[\'mobilePhone\'] + \' \' + i[\'company\'] }}</a-select-option>\n                </a-select>\n            </div>\n            <a-divider style="margin: 12px 0;background: #e3e8ee;" />\n            <div class="img-container">\n                <a-image-preview-group>\n                    <div class="img-com1" v-for="it in imgs">\n                        <span class="img-com2">\n                            <span @click="delImg(it)" class="wedofont wedo-delete img-span" style="color:#ff3300"></span>\n                            \x3c!--<span @click="delImg" class="wedofont wedo-show img-span" style="color:#00cc66"></span>--\x3e\n                        </span>\n                        <a-image :src="it[\'asImage\']" :width="150" style="padding:3px"></a-image>\n                    </div>\n                </a-image-preview-group>\n                <a-tooltip color="rgba(54,59,62,.8)" title="追加截图">\n                    <span class="wedofont wedo-plus-circle-fill zhui-jia-jie-tu" @click="addScreenshot"></span>\n                </a-tooltip>\n            </div>\n        </a-modal>\n        <a-modal :keyboard="false" v-model:visible="addScreVisible" title="追加截图" width="94%" wrapClassName="add-screenshot-full-modal" :footer="null" centered :maskClosable="false" @cancel="addScreCancle">\n            <div v-show="tableShow" class="body-contents">\n                <TableModal></TableModal>\n            </div>\n            <div v-show="!tableShow" id="addScreViewer"></div>\n        </a-modal>\n    </div>\n',mounted(){},methods:{getProblemCategories(t){t&&e.emit("getCustomProblemCategories")},getProfessionals(t){t&&e.emit("getCustomProfessionals")},getMsg2persons(t){t&&e.emit("getCustomMsg2persons")}}}}var te=a.extend({constructor:function(e){var t=this;t.container=e.container,t.Adapter=e.Adapter,t.Adapter.designReviewInstance=t,t.shapeObjects=[],t.History=new t.Base.drHistory,t.History.setCallback(t.toggleStore.bind(t)),t.Toolbar=new e.Toolbar({designReviewInstance:t}),t.createdShapes=[],t.__PRIVATE__plusViewLayer(),t.__PRIVATE__listenAdapterChanges(),t.clipboardData=null,t.currentShape=null,t.on=e.on,t.off=e.off,t.emit=e.emit,t._events=e._events,t._onece_events=e._onece_events},uninitialize:function(){this.__PRIVATE__ignoreAdapterChanges()},__PRIVATE__createSVGElement:function(){var e=this.CONSTANTS,t=document.createElementNS(e.SVGNS,"svg");return this.Helpers.DOMHelpers.Style(t,{position:"absolute",left:0,top:0,transform:e.CROSS_BROWSER_STYLE_KEY+"scale(1, -1)",cursor:"crosshair"}),t},__PRIVATE__plusViewLayer:function(){var e=this;e.viewLayerSVG=e.__PRIVATE__createSVGElement(),e.viewLayerSVG.classList.add(e.CONSTANTS.VIEW_LAYER_CLASS),e.viewLayerSVG.style.pointerEvents="none",e.container.appendChild(e.viewLayerSVG)},loadViewLayer:function(e,t){var n=this;if(n.viewLayers=n.viewLayers||{},n.viewLayerSVG){var o=n.Adapter.parseSVG(t);n.viewLayers[e]&&n.unloadViewLayer(e),n.viewLayers[e]=o,n.viewLayerSVG.appendChild(o),n.Adapter.vlLoaded(e,o)}},unloadViewLayer:function(e){var t=this;t.viewLayers=t.viewLayers||{};var n=t.viewLayers[e];n&&t.viewLayerSVG&&(t.viewLayerSVG.removeChild(n),delete t.viewLayers[e],t.Adapter.vlUnloaded(e))},unloadViewLayers:function(){var e=this;e.viewLayers=e.viewLayers||{},Object.keys(e.viewLayers).forEach(e.unloadViewLayer.bind(e))},highlightLayer:function(e){},clearHighlight:function(e){},blurViewLayer:function(e,t){var n=this;n.viewLayers=n.viewLayers||{};var o=n.viewLayers[e];if(o)for(var i=o.querySelectorAll("*"),a=0;a<i.length;a++)i[a].style.opacity=t?.5:1},__PRIVATE__removeViewLayer:function(){var e=this;e.viewLayerSVG&&(e.viewLayerSVG.parentNode.removeChild(e.viewLayerSVG),delete e.viewLayerSVG)},__PRIVATE__plusEditLayer:function(){var e=this;e.svg=e.__PRIVATE__createSVGElement(),e.svg.classList.add(e.CONSTANTS.EDIT_LAYER_CLASS),e.container.appendChild(e.svg)},__PRIVATE__removeEditLayer:function(){this.svg.parentNode.removeChild(this.svg)},__PRIVATE_elAttribute:function(e,t){var n=this;["viewBox","height","width"].indexOf(e)>-1?(n.emit(n.EVENT_NAMES.EVENT_EDIT_LAYER_RESIZE),n.svg&&(n.__PRIVATE__adjustShapeResizers(),n.svg.setAttribute(e,t)),n.viewLayerSVG.setAttribute(e,t)):"styleReferences"===e&&n.setStyleReferences(t)},__PRIVATE__adjustShapeResizers:function(){(this.shapeObjects||[]).forEach((function(e){try{e.adjustResizer()}catch(e){}}))},__PRIVATE_getAdapterAttributes:function(){return this.Adapter.attributesStore},__PRIVATE__listenAdapterChanges:function(){var e=this,t=e.__PRIVATE_getAdapterAttributes();t.on({change:function(n){var o=t.get(n);e.__PRIVATE_elAttribute(n,o)}})},__PRIVATE__ignoreAdapterChanges:function(){this.__PRIVATE_getAdapterAttributes().off("change")},__PRIVATE__canCountClick:function(e){return!this.deselecting},__PRIVATE__setupInput:function(){var e=this;e.Input=new e.Base.Input({element:e.svg,Adapter:e.Adapter,callback:e.__PRIVATE__feedShape.bind(e),designReviewInstance:e,clickFilter:e.__PRIVATE__canCountClick.bind(e)})},__PRIVATE__removeInput:function(){this.Input&&this.Input.destroy()},__PRIVATE__updateInput:function(){var e=this.Input;try{e.updateOptions(this.currentShape.configuration.input.options)}catch(e){}},__PRIVATE__feedShape:function(e){this.currentShape&&this.currentShape.input(e)},attachWindowEvents:function(){var e=this,t={type:"keydown",propagate:!0,disable_in_input:!0,target:document};r.add("Backspace",e.mainAction.bind(e,"delete"),t),r.add("Delete",e.mainAction.bind(e,"delete"),t),r.add("esc",e.mainAction.bind(e,"deselect"),t),r.add("Space",e.shapeAction.bind(e,"resumeEdit"),t),r.add("Enter",e.shapeAction.bind(e,"resumeEdit"),t),r.add("Meta+Z",e.History.undo,t),r.add("Ctrl+Z",e.History.undo,t),r.add("Ctrl+Y",e.History.redo,t),r.add("Ctrl+R",e.History.redo,t),r.add("Meta+C",e.mainAction.bind(e,"copy"),t),r.add("Ctrl+C",e.mainAction.bind(e,"copy"),t),r.add("Meta+X",e.mainAction.bind(e,"cut"),t),r.add("Ctrl+X",e.mainAction.bind(e,"cut"),t),r.add("Meta+V",e.mainAction.bind(e,"paste"),t),r.add("Ctrl+V",e.mainAction.bind(e,"paste"),t),r.add("Shift+S",e.mainAction.bind(e,"save"),t),r.add("Shift+X",e.mainAction.bind(e,"editModeEnd"),t)},mainAction:function(e){try{this[e]()}catch(e){}},shapeAction:function(e){var t=this.getSelectedShape().shape;t&&t[e]&&t[e]()},detachWindowEvents:function(){r.remove("Backspace"),r.remove("Delete"),r.remove("esc"),r.remove("Space"),r.remove("Enter"),r.remove("Meta+Z"),r.remove("Ctrl+Z"),r.remove("Meta+R"),r.remove("Ctrl+R"),r.remove("Meta+C"),r.remove("Ctrl+C"),r.remove("Meta+X"),r.remove("Ctrl+X"),r.remove("Meta+V"),r.remove("Ctrl+V"),r.remove("Shift+S"),r.remove("Shift+X")},editModeStart:function(){var e=this;e.editMode=!0,e.__PRIVATE__plusEditLayer(),e.Adapter.setEditLayer(e.svg),e.__PRIVATE__setupInput(),e.attachWindowEvents(),e.Adapter.eStart(),e.buildUI()},editModeEnd:function(){var e=this;e.editMode&&(e.deselect(),e.currentShape.destroy(),e.editMode=!1,e.__PRIVATE__removeEditLayer(),e.__PRIVATE__removeInput(),e.detachWindowEvents(),e.Adapter.eEnd(),delete e.clipboardData,delete e.shapeObjects,e.shapeObjects=[],delete e.currentShape,e.History.clear(),e.destroyUI(),e.shapeObjects.forEach((function(e){try{e.destroy()}catch(e){}})))},registerShape:function(e){var t=this,n=e.prototype.configuration.name;t.Shapes=t.Shapes||{},t.Shapes[n]=e},createShapeOfType:function(e,t){var n=this;if(n.isShapeRegistered(e)){var o=n.svg,i=n.Shapes[e],a={svgElement:o,designReviewInstance:n};return t=t||{},Object.keys(t).forEach((function(e){a[e]=t[e]})),(i=new i(a)).group||(i.setStyle(n.defaultStyle),i.setStyleMapping(n.styleMapping),i.setStyleReferences(n.styleReferences)),n.shapeObjects.push(i),n.shapeObjects[n.shapeObjects.length-1]}},isShapeRegistered:function(e){return!!this.Shapes[e]},activateShape:function(e,t){var n=this,o=null;t||n.deselect(),e.configuration&&(e=(o=e).configuration.name);var i=n.currentShape;return o||t||n.isShapeRegistered(e)&&(!i||i.configuration.name!==e)?(n.svg,n.currentShape=o||n.createShapeOfType(e),n.Input.flush(),o||n.currentShape.start(),n.__PRIVATE__updateInput(),i&&i.editMode&&-1===n.createdShapes.indexOf(i._guid)&&(i.saveOrDie(),setTimeout((function(){i.editMode&&i.destroy()}),100)),!0):(console.log("形状不可用或相同的形状正在运行"),!1)},triggerSelection:function(e){var t=this;t.selectedShapeId=e._guid,e.select(),t.Toolbar.loadStyle(e.style),t.toggleStore()},select:function(e){var t=this,n=t.getShapeById(e).shape,o=n&&n.configuration.name,i=t.getSelectedShape().shape,a=!1;if(i&&n){if(i._guid===e)return;i.deselect(),t.triggerSelection(n),i.configuration.name===o&&(a=!0)}else if(n&&(t.triggerSelection(n),o===t.currentShape.configuration.name))return;(a=a||n.belongsToGroup)||t.activateShape(n.configuration.name,!0)},deselect:function(e){var t=this;if(e=e||t.selectedShapeId,t.selectedShapeId===e){var n=t.getShapeById(e);n.index>-1&&n.shape.deselect(),t.selectedShapeId=null,t.Toolbar.loadStyle(t.defaultStyle),t.toggleStore(),t.deselecting=!0,setTimeout((function(){t.deselecting=!1}),10)}},getSelectedShape:function(){var e=this.selectedShapeId;return this.getShapeById(e)},getShapeById:function(e){var t,n=-1,o=this.shapeObjects;if(o)for(var i=0;i<o.length;i++)o[i]._guid===e&&(n=i,t=o[i]);return{index:n,shape:t}},removeShapeByid:function(e){var t=this,n=t.getShapeById(e||t.currentShape._guid);n.index>-1&&(t.shapeObjects.splice(n.index,1),n.shape.destroy(),n.shape=null)},isShapeEditing:function(e){return-1===this.createdShapes.indexOf(e)},toggleStore:function(){var e=this,t={hasClipboard:!!e.clipBoardData,hasUndo:e.History.hasUndo(),hasRedo:e.History.hasRedo(),hasSelection:!!e.getShapeById(e.selectedShapeId).shape},n=e.currentShape,o=null,i=e.getSelectedShape().shape;return i?o=i.loadStyleFor():n&&(o=n.loadStyleFor()),e.Toolbar&&(e.Toolbar.currentState(t),n&&e.Toolbar.activeShape(n.configuration.name),e.Toolbar.loadStyleFor(o)),t},cut:function(e,t){var n=this,o=n.getShapeById(e||n.selectedShapeId);o.shape&&(n.clipBoardData=o.shape,n.clipBoardType="cut",t||o.shape.detach(),n.toggleStore())},copy:function(e){this.cut(e,!0),this.clipBoardType="copy"},paste:function(){var e=this;e.clipBoardData&&e.clone(e.clipBoardData._guid),"cut"===e.clipBoardType&&(e.clipBoardData=null),e.toggleStore()},clone:function(e){var t=this,n=t.getShapeById(e||t.selectedShapeId);if(n.shape){var o=n.shape.cloneShape();t.copy(o._guid)}},delete:function(e){var t=this,n=t.getShapeById(e||t.selectedShapeId);n.shape&&(n.shape.detach(),t.toggleStore())},save:function(){var e=this;let t=document.getElementsByClassName("dr-markup-save")[0];t.innerHTML='<div class="loader" style="display:inline-table">\n                                    <svg viewBox="25 25 50 50" class="circular">\n                                        <circle cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10" class="path">\n                                        </circle>\n                                    </svg>\n                                </div>',e.shapeObjects.forEach((function(e){if(e.editMode&&e.saveOrDie&&!e.detached)try{e.saveOrDie()}catch(e){}})),e.export().then((function(n){t.innerHTML="保存";const o=ee(e,n),i=e.app=(0,U.ri)(o);i.config.productionTip=!1,i.use(j.ZP),i.mount("#container-wedo-modal"),e.shapeObjects.forEach((function(t){!t.belongsToGroup&&!t.detached&&e.createdShapes.indexOf(t._guid)>-1&&t.detach(!1,!0)}))}))},setStyle:function(e,t){var n=this;n.defaultStyle=e,n.styleMapping=t,n.toggleStore()},setStyleMapping:function(e){this.currentShape.setStyleMapping(e)},setStyleReferences:function(e){this.styleReferences=e},executeAction:function(e){var t=this;switch(e){case"undo":t.History.undo();break;case"redo":t.History.redo();break;case"cut":case"copy":case"paste":case"save":case"delete":t[e]();break;case"cancel":t.editModeEnd()}t.toggleStore()},updateStyle:function(e){var t=this,n=t.currentShape,o=t.getSelectedShape().shape;o?o.updateStyle(e):(n&&n.updateStyle(e),t.defaultStyle=e)},getStyleValue:function(){var e=this,t=e.currentShape,n=e.getSelectedShape().shape,o=n||t;if(o)return o.getStyleValue.apply(o,arguments)},createStarted:function(){this.toggleStore()},creationDone:function(e){var t=this,n=(e._guid,t.currentShape),o=!1;if(-1===t.createdShapes.indexOf(e._guid)?t.createdShapes.push(e._guid):o=!0,n._guid===e._guid){var i=null;e.belongsToGroup?o&&(i=e.parentInstance.configuration.name):i=n.configuration.name,t.activateShape(i,!0)}t.toggleStore()},createHistoryAction:function(e,t){return function(e,t){var n=t.args,o=t.guid,i=this.shapeObjects.filter((function(e){return e._guid===o}))[0];if(i){var a=Array.isArray(n)?"apply":"call";i[e][a](i,n)}this.toggleStore()}.bind(this,e,t)},buildUI:function(){this.Toolbar.eStart(),this.toggleStore()},destroyUI:function(){this.Toolbar.eEnd()},exportImage:function(e){var t=this,n=function(e,t,n,o,i,a,r,s){var l;e.save(),l=s?r*Math.PI/180:2*Math.PI-r*Math.PI/180,e.translate(n+i/2,o+a/2),e.rotate(l),s&&e.scale(-1,1),e.drawImage(t,-i/2,-a/2,i,a),e.restore()};return new Promise((function(o,i){t.Adapter.getBackgroundImage().then((function(i){var a=document.createElement("canvas"),r={width:parseInt(t.svg.getAttribute("width")),height:parseInt(t.svg.getAttribute("height"))},s=r.height,l=r.width;a.setAttribute("width",l),a.setAttribute("height",s);var c=a.getContext("2d");c.imageSmoothingEnabled=!1;var d=new Image;d.onload=function(){n(c,d,0,0,l,s,0,!1);var t=new Image;t.onload=function(){n(c,t,0,0,l,s,180,!0),o(a.toDataURL("image/png"))},t.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(e)},d.src=i}))}))},getToolsUsed:function(){var e={};return(this.shapeObjects||[]).forEach((function(t){if(!t.belongsToGroup&&!t.detached){var n=t.configuration.name;e[n]=0}})),Object.keys(e)},export:function(){var e=this;return new Promise((function(t,n){var o=e.getToolsUsed(),i=e.svg.cloneNode(),a=e.CONSTANTS.SVGNS,r=document.createElementNS(a,"metadata"),s=document.createElementNS(a,"markup_document"),l=[];r.appendChild(s),s.setAttribute("data-model-version",e.Version),s.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),i.appendChild(r),e.shapeObjects.forEach((function(t){if(!t.belongsToGroup&&!t.detached&&e.createdShapes.indexOf(t._guid)>-1){t.editMode;var n=t.exportMetadata();n=Array.isArray(n)?n:[n],Array.prototype.push.apply(l,n);var o=t.export();o&&i.appendChild(o)}})),i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var c=new XMLSerializer,d=c.serializeToString(i);i.removeAttribute("style"),e.exportImage(c.serializeToString(i)).then((function(e){t({markup:d,boundingBoxes:l,asImage:e,toolsUsed:o,exportSVG:i})}))}))},destroy:function(){var e=this;e.editModeEnd(),e.__PRIVATE__removeViewLayer(),e.Adapter.destroy()}});a.prototype.designReview=te;const ne=new a;var oe=n(85235);const ie=function(){function e(e,t,n){if(n=n||{},!oe.Z.genericUtils.isViewer3dInstance(e))return!1;var o=oe.Z.configUtils.eventMappings;oe.Z.genericUtils.setProperties(this,{viewer:e,messageTitle:t,eventMappings:o,container:e.container,raycaster:new THREE.Raycaster,selectedNodeOffset:new THREE.Vector3,selectedPositions:[],selectedNodes:[],selectedFragmentId:-1,selectedNodeId:-1,gizmoInvalidColor:n.gizmoInvalidColor||"#FF0000",gizmoSuccessColor:n.gizmoSuccessColor||"#49C1E4",gizmoCollision:{fragmentId:-1,point:new THREE.Vector3},editMode:!1,hasSelection:!1}),e.setActiveNavigationTool("")}var t=Autodesk.Viewing,n={},o={constructor:e};function i(e){this.dispatchEvent(e)}var a=function(){var e=this,t=oe.Z.markerUtils.createEditFrame(e.messageTitle,e.unintializeSelection.bind(e));e.editFrameDiv=t,e.container.appendChild(e.editFrameDiv)},r=function(){var e=this.editFrameDiv;oe.Z.genericUtils.isHTMLElement(e)&&e.parentNode&&e.parentNode.removeChild(e)};function s(e){var t=oe.Z.markerUtils.getMousePosition(e);this.canvasX=t.x,this.canvasY=t.y}function l(){var e,t,n="notAllowedEditFrame",o=this,i=o.editFrameDiv,a=o.canvasX,r=o.canvasY,s=o.viewer;(t=oe.Z.markerUtils.hitTest(s,a,r))?(e=o.gizmoSuccessColor,i.classList.remove(n)):(e=o.gizmoInvalidColor,i.classList.add(n));var l=i.querySelector(".pin-stright-line"),c=i.querySelector(".pin-hr-line"),d="translate("+a+"px, 0px)",p="translate(0px, "+r+"px)";return c||(c=oe.Z.genericUtils.makeDivWithMetadata("pin-hr-line",{},{},{height:"0.5px",width:"100%"}),i.appendChild(c)),c.style.transform=p,c.style.backgroundColor=e,l||(l=oe.Z.genericUtils.makeDivWithMetadata("pin-stright-line",{},{},{height:"100%",width:"0.5px"}),i.appendChild(l)),l.style.transform=d,l.style.backgroundColor=e,t}function c(){for(var e=this.editFrameDiv.querySelectorAll(".pin-stright-line,.pin-hr-line"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])}var d,p=!1,u=!1,h=0,f=null,g={mousemove:function(e){p&&(u=!0,console.log("roting true")),s.call(this,e),l.call(this)},mouseout:function(){var e=this;e.canvasX=e.canvasY=-1e5,l.call(e)},mousedown:function(){console.log("mouse down true"),p=!0},mouseup:function(){var e=this.editFrameDiv;p&&e&&setTimeout((function(){p=!1}),100)},click:function(e){var t=this;if(p=!1,u)return console.log("roating false"),void(u=!1);if(d)d=!1;else{s.call(t,e);var n=l.call(t),o=t.viewer,i=t.selectedPositions.slice(0);if(n){var a={selectedNodeOffset:oe.Z.markerUtils.worldToNodeOffset(n.intersectPoint,n.fragId,o),selectedNodeId:n.dbId};oe.Z.genericUtils.ctrlOrShiftKey(e)?i.push(a):i=[a]}else i=[];t.setSelection(i)}},clickRecognizer:function(e){var t=this;if(p=!1,u)return u=!1,void clearTimeout(f);null===f&&(f=setTimeout((function(){h=0,f=null,g.click.call(t,e)}),250)),1===h&&(clearTimeout(f),f=null,h=-1),h++},keydown:function(e){e.keyCode===t.KeyCode.ESCAPE&&this.editMode&&this.unintializeSelection()}},m=function(){var e=this;i.call(e,{type:e.eventMappings.SAVE_SELECTION,target:e})};function v(){var e=this,o=e.viewer,i=o.canvas,a=g.mousemove.bind(e),r=g.mouseout.bind(e),s=g.keydown.bind(e),l=g.mousedown.bind(e),c=g.clickRecognizer.bind(e),d=oe.Z.configUtils,p=d.buttonsMap,u=d.eventMappings,h=E.bind(e),f=n.buttons[p.markersSaveButton],v=n.buttons[p.markersCancelButton],y=m.bind(e),_=e.unintializeSelection.bind(e),S=function(e){e&&e.target&&(e.target.content=""),this.setSelection([])}.bind(e);function b(n){var d=n?"removeEventListener":"addEventListener";f&&f[d](u.CLICK_EVENT,y),v&&v[d](u.CLICK_EVENT,_),e[d](u.TEXTBOX_CANCEL,_),e[d](u.TEXTBOX_SUBMIT,y),e[d](u.TEXTBOX_CLEAR,S),o[d](t.VIEWER_RESIZE_EVENT,h),i[d]("click",c),i[d]("mousemove",a),i[d]("mouseout",r),i[d]("mousedown",l),window[d]("keyup",s)}return b(),{cancel:function(){b(!0)}}}function y(){var e=this.viewer,o=e.getToolbar(!0),i=oe.Z.configUtils.buttonsMap.operatingModeGroup,a=null,r=t.UI,s=oe.Z.configUtils,l=e.toolbar.getControl(i);(a=l)||(t.TOOLBAR[name]=i,a=new r.ControlGroup(t.TOOLBAR[name])),n.buttons={};var c=s.operationControls,d=[s.buttonsMap.markersCancelButton];this.buttonsOrder=d,d.forEach((function(e){var t=c[e],o=new r.Button(e);t.name&&o.setToolTip(t.title),o.setIcon(t.icon),n.buttons[e]=o,a.addControl(o)})),o.addControl(a,{}),n.toolbarGroup=a}function _(){var e=this.viewer;n.addedEvents&&n.addedEvents.cancel(),n.toolbarGroup&&(e.toolbar.removeControl(n.toolbarGroup._id),delete n.toolbarGroup,delete n.markersCombo,delete n.buttons)}function E(e){oe.Z.lmvUtils.hideToolsForPnOTools(this.viewer,e)}var S=function(){var e=this,t=e.viewer;t.clearSelection(),e.selectedPositions=[],E.call(e,!0),oe.Z.lmvUtils.CAMNodesDisplay(t,!1)};function b(){var e=this,t=e.viewer;delete e.nodeVisibilityTable,e.selectedPositions=[],_.call(e),c.call(e),E.call(e,!1),oe.Z.lmvUtils.CAMNodesDisplay(t,!0)}return o.initializeSelection=function(){var e=this;e.editMode=!0,a.call(e),S.call(e),y.call(e),e.bindedEvents=v.call(e),i.call(e,{type:e.eventMappings.POINT_SELECTION_START_EDIT_MODE,target:e})},o.unintializeSelection=function(){var e=this;e.editMode=!1,e.bindedEvents&&e.bindedEvents.cancel(),r.call(e),b.call(e),i.call(e,{type:e.eventMappings.POINT_SELECTION_LEAVE_EDIT_MODE,target:e})},o.setSelection=function(e){var t=this;return!!Array.isArray(e)&&(t.selectedPositions=e,i.call(t,{type:t.eventMappings.POINT_SELECTION_SELECTION_CHANGED,target:t,data:t.selectedPositions}),!0)},e.prototype=o,t.EventDispatcher.prototype.apply(e.prototype),e}(),ae=function(){function e(e){var t=this;if(!oe.Z.genericUtils.isViewer3dInstance(e))return!1;t.viewer=e,t.container=e.container,t.eventMappings=oe.Z.configUtils.eventMappings}var t=Autodesk.Viewing,n={},o={constructor:e};function i(e){this.dispatchEvent(e)}var a=function(){},r=function(){},s=function(e){e.keyCode===t.KeyCode.ESCAPE&&this.editMode&&this.unintializeSelection()},l=function(){var e=this;i.call(e,{type:e.eventMappings.SAVE_SELECTION,target:e})},c=null,d=function(){var e=this,t=e.viewer;g.call(e),c&&(window.clearTimeout(c),c=null),c=setTimeout((function(){oe.Z.lmvUtils.getScreenShot(t).then((function(t){e.setSelection(t)}),(function(){console.error("Unable to get snapShot")}))}),100)};function p(){var e=this,o=e.viewer,i=s.bind(e),a=oe.Z.configUtils,r=a.buttonsMap,c=a.eventMappings,p=n.buttons[r.markersSaveButton],u=n.buttons[r.markersCancelButton],h=l.bind(e),f=e.unintializeSelection.bind(e),g=d.bind(e);function m(n){var a=n?"removeEventListener":"addEventListener";p[a](c.CLICK_EVENT,h),u[a](c.CLICK_EVENT,f),e[a](c.TEXTBOX_CANCEL,f),e[a](c.TEXTBOX_CLEAR,f),e[a](c.TEXTBOX_SUBMIT,h),o[a](t.CAMERA_CHANGE_EVENT,g),o[a](t.VIEWER_RESIZE_EVENT,g),o[a](t.EXPLODE_CHANGE_EVENT,g),o[a](t.SELECTION_CHANGED_EVENT,g),window[a]("keydown",i)}return m(),{cancel:function(){m(!0)}}}function u(){var e=this.viewer,o=e.getToolbar(!0),i=oe.Z.configUtils.buttonsMap.operatingModeGroup,a=null,r=t.UI,s=oe.Z.configUtils,l=e.toolbar.getControl(i);(a=l)||(t.TOOLBAR[name]=i,a=new r.ControlGroup(t.TOOLBAR[name])),n.buttons={};var c=s.operationControls;[s.buttonsMap.markersSaveButton,s.buttonsMap.markersCancelButton].forEach((function(e){var t=c[e],o=new r.Button(e);t.name&&o.setToolTip(t.title),o.setIcon(t.icon),n.buttons[e]=o,a.addControl(o)})),o.addControl(a,{}),n.toolbarGroup=a}function h(){var e=this.viewer;n.addedEvents&&n.addedEvents.cancel(),n.toolbarGroup&&(e.toolbar.removeControl(n.toolbarGroup._id),delete n.toolbarGroup,delete n.markersCombo,delete n.buttons)}function f(e){for(var t=document.querySelectorAll("#wdkitsTools-1, #MCTools"),n=0;n<t.length;n++)t[n].style.display=e?"none":""}function g(){f(!0)}function m(){f(!1)}var v=function(){var e=this;u.call(e),d.call(e),g.call(e)};function y(){h.call(this)}return o.initializeSelection=function(){var e=this;e.editMode=!0,a.call(e),v.call(e),e.bindedEvents=p.call(e),i.call(e,{type:e.eventMappings.SNAPSHOT_SELECTION_START_EDIT_MODE,target:e})},o.unintializeSelection=function(e){var t=this;e&&e.target&&(e.target.content=""),t.editMode=!1,t.bindedEvents&&t.bindedEvents.cancel(),r.call(t),y.call(t),m.call(t),i.call(t,{type:t.eventMappings.SNAPSHOT_SELECTION_LEAVE_EDIT_MODE,target:t})},o.setSelection=function(e){var t=this;return t.selectedSnap=e,i.call(t,{type:t.eventMappings.SNAPSHOT_SELECTION_SELECTION_CHANGED,target:t,data:t.selectedSnap}),!0},e.prototype=o,t.EventDispatcher.prototype.apply(e.prototype),e}(),re=function(){function e(e){var t=this;if(!oe.Z.genericUtils.isViewer3dInstance(e))return!1;t.viewer=e,t.container=e.container,t.eventMappings=oe.Z.configUtils.eventMappings}var t=Autodesk.Viewing,n={},o={constructor:e};function i(e){this.dispatchEvent(e)}var a=function(){},r=function(){},s=function(e){e.keyCode===t.KeyCode.ESCAPE&&this.editMode&&this.unintializeSelection()},l=function(){var e=this;i.call(e,{type:e.eventMappings.SAVE_SELECTION,target:e})},c=null,d=function(){var e=this,t=e.viewer;e.ignoreState?console.log("Ignoring State"):(c&&window.clearTimeout(c),c=setTimeout((function(){oe.Z.lmvUtils.getScreenShot(t).then((function(t){e.setSelection(t)}),(function(){console.error("Unable to get snapShot")}))}),0))};function p(){var e=this,o=e.viewer,i=s.bind(e),a=oe.Z.configUtils,r=a.buttonsMap,c=a.eventMappings,p=n[r.operatingModeGroup].buttons,u=p[r.markersSaveButton],h=p[r.markersCancelButton],f=l.bind(e),g=e.unintializeSelection.bind(e),m=d.bind(e);function v(n){var a=n?"removeEventListener":"addEventListener";u[a](c.CLICK_EVENT,f),h[a](c.CLICK_EVENT,g),e[a](c.TEXTBOX_CANCEL,g),e[a](c.TEXTBOX_SUBMIT,f),o[a](t.CAMERA_CHANGE_EVENT,m),o[a](t.VIEWER_RESIZE_EVENT,m),o[a](t.EXPLODE_CHANGE_EVENT,m),o[a](t.SELECTION_CHANGED_EVENT,m),window[a]("keydown",i)}return v(),{cancel:function(){v(!0)}}}function u(e,o,i,a){var r=this.viewer,s=r.getToolbar(!0),l=null,c=t.UI,d=r.toolbar.getControl(e);(l=d)||(t.TOOLBAR[name]=e,l=new c.ControlGroup(t.TOOLBAR[name])),n[e]=n[e]||{};var p=n[e];p.buttons={},a.forEach((function(e){var t=i[e],n=new c.Button(e);t.name&&n.setToolTip(t.title),n.setIcon(t.icon),p.buttons[e]=n,l.addControl(n)})),s.addControl(l,{index:o}),p.toolbarGroup=l}function h(e){var t=this.viewer,o=n[e];o&&(o.addedEvents&&o.addedEvents.cancel(),t.toolbar.removeControl(o.toolbarGroup._id),delete n[e])}function f(){var e=oe.Z.configUtils,t=e.buttonsMap;u.call(this,t.operatingModeGroup,void 0,e.operationControls,[t.markersSaveButton,t.markersCancelButton])}function g(){h.call(this,oe.Z.configUtils.buttonsMap.operatingModeGroup)}var m=function(){f.call(this),d.call(this)};function v(){g.call(this)}return o.initializeSelection=function(){var e=this;e.editMode=!0,a.call(e),m.call(e),e.bindedEvents=p.call(e),i.call(e,{type:e.eventMappings.ANIMATION_SELECTION_START_EDIT_MODE,target:e})},o.unintializeSelection=function(){var e=this;e.editMode=!1,e.bindedEvents&&e.bindedEvents.cancel(),r.call(e),v.call(e),i.call(e,{type:e.eventMappings.ANIMATION_SELECTION_LEAVE_EDIT_MODE,target:e})},o.setSelection=function(e){var t=this;return t.selectedStates=t.selectedStates||[],t.selectedSnap=t.selectedSnap||[],t.selectedStates.push(t.viewer.viewerState.getState({seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!0,cutplanes:!0})),t.selectedSnap.push(e),i.call(t,{type:t.eventMappings.ANIMATION_SELECTION_SELECTION_CHANGED,target:t,data:{snaps:t.selectedSnap,states:t.selectedStates}}),!0},e.prototype=o,t.EventDispatcher.prototype.apply(e.prototype),e}(),se=function(){function e(e,t,n){if(!oe.Z.genericUtils.isViewer3dInstance(e))return!1;oe.Z.genericUtils.setProperties(this,{viewer:e,messageTitle:t,eventMappings:oe.Z.configUtils.eventMappings,container:e.container,raycaster:new THREE.Raycaster,selectedNodeId:[],editMode:!1,allowMultipleObjects:n}),e.setActiveNavigationTool("")}var t=Autodesk.Viewing,n={},o={constructor:e},i=function(){var e=this,t=oe.Z.markerUtils.createEditFrame(e.messageTitle,e.unintializeSelection.bind(e));e.editFrameDiv=t},a=function(){var e=this.editFrameDiv;oe.Z.genericUtils.isHTMLElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},r=function(e){e.keyCode===t.KeyCode.ESCAPE&&this.editMode&&this.unintializeSelection()};function s(e){this.dispatchEvent(e)}var l=function(e){this.setSelection(e.nodeArray)},c=function(){var e=this;s.call(e,{type:e.eventMappings.SAVE_SELECTION,target:e})};function d(){var e=this,o=e.editFrameDiv,i=e.viewer,a=r.bind(e),s=oe.Z.configUtils,d=s.buttonsMap,p=s.eventMappings,u=n.buttons[d.markersSaveButton],f=n.buttons[d.markersCancelButton],g=c.bind(e),m=e.unintializeSelection.bind(e),v=function(e){e&&e.target&&(e.target.content=""),this.viewer.impl.selector.clearSelection(),this.setSelection([])}.bind(e),y=h.bind(e),_=l.bind(e);function E(n){var r=n?"removeEventListener":"addEventListener";u&&u[r](p.CLICK_EVENT,g),f&&f[r](p.CLICK_EVENT,m),e[r](p.TEXTBOX_CANCEL,m),e[r](p.TEXTBOX_SUBMIT,g),e[r](p.TEXTBOX_CLEAR,v),i[r](t.SELECTION_CHANGED_EVENT,_),i[r](t.VIEWER_RESIZE_EVENT,y),o[r](p.KEY_DOWN,a),window[r](p.KEY_DOWN,a)}return E(),{cancel:function(){E(!0)}}}function p(){var e=this.viewer,o=e.getToolbar(!0),i=oe.Z.configUtils.buttonsMap.operatingModeGroup,a=null,r=t.UI,s=e.toolbar.getControl(i);(a=s)||(t.TOOLBAR[name]=i,a=new r.ControlGroup(t.TOOLBAR[name])),n.buttons={};var l=oe.Z.configUtils,c=l.operationControls,d=[l.buttonsMap.markersCancelButton];this.buttonsOrder=d,d.forEach((function(e){var t=c[e],o=new r.Button(e);t.name&&o.setToolTip(t.title),o.setIcon(t.icon),n.buttons[e]=o,a.addControl(o)})),o.addControl(a,{}),n.toolbarGroup=a}function u(){var e=this.viewer;n.addedEvents&&n.addedEvents.cancel(),n.toolbarGroup&&(e.toolbar.removeControl(n.toolbarGroup._id),delete n.toolbarGroup,delete n.markersCombo,delete n.buttons)}function h(e){oe.Z.lmvUtils.hideToolsForPnOTools(this.viewer,e)}function f(){var e=this,t=e.viewer;e.selectedNodeId=[],t.clearSelection(),oe.Z.lmvUtils.dismissHudMessage(),h.call(e,!0),oe.Z.lmvUtils.CAMNodesDisplay(t,!1)}function g(){var e=this,t=e.viewer;e.selectedNodeId=[],u.call(e),oe.Z.markerUtils.showToolsAndPanels(t),t.impl.selector.clearSelection(),h.call(e,!1),oe.Z.lmvUtils.CAMNodesDisplay(t,!0)}return o.initializeSelection=function(){var e=this;e.editMode=!0,i.call(e),f.call(e),p.call(e),n.bindedEvents=d.call(e),s.call(e,{type:e.eventMappings.OBJECT_SELECTION_START_EDIT_MODE,target:e})},o.unintializeSelection=function(){var e=this;e.editMode=!1,n.bindedEvents&&n.bindedEvents.cancel(),u.call(e),a.call(e),g.call(e),s.call(e,{type:e.eventMappings.OBJECT_SELECTION_LEAVE_EDIT_MODE,target:e})},o.setSelection=function(e){var t=this;return!!Array.isArray(e)&&(t.selectedNodeId=e,s.call(t,{type:t.eventMappings.OBJECT_SELECTION_SELECTION_CHANGED,target:t,data:t.viewer.impl.selector.getSelection()}),!0)},o.referSelectedNodes=function(e){},e.prototype=o,t.EventDispatcher.prototype.apply(e.prototype),e}();var le=n(89928);const ce=function(){function e(e,t){var n=this;if(t=t||{},!oe.Z.genericUtils.isViewer3dInstance(e))return!1;n.viewer=e,n.eventMappings=oe.Z.configUtils.eventMappings,n.saveButtonText=t.saveButtonText||"Save",n.cancelButtonText=t.cancelButtonText||"Cancel",e.setActiveNavigationTool(""),n.drAdapter=e.drAdapter,n.drAdapter.userInstance=n,n.drInstance=e.drInstance}var t=Autodesk.Viewing,n={constructor:e};function o(e){this.dispatchEvent(e)}var i=function(){var e=this.viewer;oe.Z.lmvUtils.CAMNodesDisplay(e,!1)},a=function(){var e=this.viewer;oe.Z.lmvUtils.CAMNodesDisplay(e,!0),e.canvas&&e.setActiveNavigationTool()};return n.editModeStart=function(){},n.editModeEnd=function(){this.unintializeSelection()},n.initializeSelection=function(){var e=this;i.call(e),e.editMode=!0,e.drInstance.editModeStart(),o.call(e,{type:e.eventMappings.MARKUP_CREATION_START_EDIT_MODE,target:e})},n.unintializeSelection=function(e){var t=this;a.call(t),t.editMode=!1,e=e||{},t.drInstance.editModeEnd(),o.call(t,{type:t.eventMappings.MARKUP_CREATION_LEAVE_EDIT_MODE,target:t,data:e})},n.getToolsUsed=function(){return this.drInstance.getToolsUsed()},n.get3DPointOffset=function(e){var t=this.viewer;if(e){var n=t.worldToClient(e),o=oe.Z.markerUtils.hitTest(t,n.x,n.y);return{selectedNodeOffset:oe.Z.markerUtils.worldToNodeOffset(o.intersectPoint,o.fragId,t),selectedNodeId:o.dbId}}},n.save=function(e,{visible:t,confirmLoading:n,message:i}){var a=this,r={type:a.eventMappings.SAVE_SELECTION,target:a,data:{markup:e.markup,positions:[a.get3DPointOffset(e.point.mainPoint)],action:"save",markupTypesUsed:e.tools,snap:e.asImage,othersInfos:e.othersInfos}};a.selectedPositions=r.data.positions,o.call(a,r)},n.snap=function(){var e=this.viewer;return new Promise((function(t,n){var o=new Image;o.addEventListener("load",(function(){var n=document.createElement("canvas"),i=e.container.getBoundingClientRect();n.width=i.width,n.height=i.height;var a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),a.drawImage(o,0,0,n.width,n.height),t(n.toDataURL())})),oe.Z.lmvUtils.getScreenShot(e,!0).then((function(e){o.src=e}))}))},e.prototype=n,t.EventDispatcher.prototype.apply(e.prototype),e}();var de=n(7369),pe=le.Z,ue=ce,he=Autodesk.Viewing,fe=oe.Z.configUtils.extensionName,ge=!1,me=function(){function e(e){"app"===e.initializer&&this.fetchComments(e.comments,!0)}function t(e){this.expandComment({id:e.id,expand:!0})}function o(e){this.expandComment({id:e.id,expand:!1})}function i(){var n=this,i=e.bind(this),a=t.bind(this),r=o.bind(this);function s(e){var t=e?"removeEventListener":"addEventListener";n.commentsAdaptor[t]("refresh-comments",i),n.commentsAdaptor[t]("expand-comment",a),n.commentsAdaptor[t]("collapse-comment",r)}return s(),{cancel:function(){s(!0)}}}function a(e,t){if(n(61327),ge)return!0;var o=this;if(o.viewer=e,o.commentsAdaptor=de.J,o._sdk=window.wdkitsSdk,o.on=o._sdk.on,o.off=o._sdk.off,o.emit=o._sdk.emit,o._events=o._sdk._events,o._onece_events=o._sdk._onece_events,o.models=e.impl.modelQueue().getModels(),o.clientId=e.config.wedoConfig.clientId,o.clientSecret=e.config.wedoConfig.clientSecret,(t=t||{}).toolbarGroup=t.toolbarGroup||"markerTools",t.toolbarPositionIndex=t.toolbarPositionIndex||1,t.toolbarTitle=t.toolbarTitle||"Comments",t.controlsMetadata=t.controlsMetadata||{},o.commentsAdaptor=t.commentsAdaptor||de.J,!o.commentsAdaptor)return!1;o.commentsAdaptor.Utils=oe.Z,o.commentsAdaptor.MarkerExtension=o;var i=t.controlsMetadata;return Object.keys(i).forEach((function(e){oe.Z.genericUtils.mergeObjects(oe.Z.configUtils.controlsMetadata[e],i[e])})),o.options=t,o.comments=[],o.Utils=oe.Z,o.eventMappings=oe.Z.configUtils.eventMappings,o.btnClickEvts=[],!0}var r={constructor:a},s=Autodesk.Viewing,l={},c="ui-control-comment";function d(e){var t=this;t.dispatchEvent?t.dispatchEvent(e):t.fireEvent&&t.fireEvent(e.type,e.data)}function p(e,t){var n=this,o=function(e){t.dispatchEvent(e)}.bind(n);function i(t){var i=t?"removeEventListener":"addEventListener",a=n.eventMappings;e[i](a.TEXTBOX_CANCEL,o),e[i](a.TEXTBOX_SUBMIT,o),e[i](a.TEXTBOX_CLEAR,o)}return i(),{cancel:function(){i(!0)}}}function u(){var e=this.objectSelectedMapping;e&&(e._listens.cancel(),e.uninitialize(),delete this.objectSelectedMapping)}function h(){var e=this;return new Promise((function(t,n){var o=e.objectSelectedMapping;if(o){var i=(o.export().text||"").trim();if(i.length>0){var a=o.transformText(i);oe.Z.payloadUtils.makeObjectCommentPayload.call(e,a).then((function(o){e.objectSelectedMapping.getSnap().then((function(a){e.uninitializeObjectSelection(),e.commentsAdaptor.addComment(o.body,a,o,void 0,{source:"canvas",originalText:i}).then((function(e){t(e)}),(function(e){n(e)}))}),(function(){n("Unable to get screenshot")}))}),(function(e){n(e)}))}else n("Text entered is Empty")}}))}r.uiControlComment=c;var f={objectSelectionStart:function(e){d.call(this,e)},objectSelectionChanged:function(e){var t=this,n=e.data||[],o={};t.objectSelectedMapping?t.objectSelectedMapping.setNodes(n):(o.editable=!0,o.commentType="objects",o.commentTool=t.viewerSelector,o.selectedNodes=n,o.commentsAdaptor=t.commentsAdaptor,t.objectSelectedMapping=new pe(t.viewer,o),t.objectSelectedMapping._listens=p.call(t,t.objectSelectedMapping,t.viewerSelector),t.objectSelectedMapping.initialize(),d.call(t,e))},objectSelectionEnd:function(e){this.uninitializeObjectSelection(e)},objectSelectionSave:function(e){var t=this,n=t.objectSelectedMapping;n&&n.setSaving(!0),h.call(t).then((function(e){t.fetchComments(e||[])}),(function(e){n.setSaving(!1),n.setCommentingFailed(!0),console.error(e)}))}};function g(){var e=this,t=f.objectSelectionStart.bind(e),n=f.objectSelectionChanged.bind(e),o=f.objectSelectionEnd.bind(e),i=f.objectSelectionSave.bind(e);function a(a){var r=a?"removeEventListener":"addEventListener",s=e.viewerSelector,l=e.eventMappings;s[r](l.OBJECT_SELECTION_START_EDIT_MODE,t),s[r](l.OBJECT_SELECTION_SELECTION_CHANGED,n),s[r](l.OBJECT_SELECTION_LEAVE_EDIT_MODE,o),s[r](l.SAVE_SELECTION,i)}return a(),{cancel:function(){a(!0)}}}function m(){var e=this.pointSelectedMapping;e&&(e._listens.cancel(),e.uninitialize(),delete this.pointSelectedMapping)}function v(){var e=this;return new Promise((function(t,n){if(e.pointSelectedMapping){var o=(e.pointSelectedMapping.export().text||"").trim();if(o.length>0){var i=e.pointSelectedMapping.transformText(o);oe.Z.payloadUtils.makePointCommentPayload.call(e).then((function(a){e.pointSelectedMapping.getSnap().then((function(r){a.body=i,e.uninitializePointSelection(),e.commentsAdaptor.addComment(i,r,a,void 0,{source:"canvas",originalText:o}).then((function(e){t(e)}),(function(e){n(e)}))}),(function(){n("Unable to get screenshot")}))}),(function(e){n(e)}))}else n("Text entered is Empty")}}))}r.initializeObjectSelection=function(){var e=this,t=e.viewer,n=e.options,o=t.getSelection();R.call(e,{data:{comment:{},expanded:!0,hideOthers:!0}});var i=new se(t,n.objectToolTitleTranslation,!0);e.viewerSelector=i,e.viewerSelectorEvents=g.call(e),e.viewerSelector.initializeSelection(),Array.isArray(o)&&(1===o.length?t.select(o):e.viewer.clearSelection())},r.uninitializeObjectSelection=function(e){var t=this;u.call(t);var n=t.viewerSelector;n&&(t.viewerSelectorEvents.cancel(),n.unintializeSelection(),delete t.viewerSelector),t.viewer.clearSelection(),R.call(t,{data:{comment:{},expanded:!0,hideOthers:!1}}),t.commentsAdaptor.fireEvent("endCommentsEditMode",{commentType:"objects",data:e?e.data:{}}),e&&d.call(t,e)};var y={pointSelectionStart:function(e){d.call(this,e)},pointSelectionChanged:function(e){var t=this,n=e.data||[],o={};t.pointSelectedMapping?t.pointSelectedMapping.setNodes(n):(o.commentType="points",o.commentTool=t.pinSelector,o.selectedNodes=n,o.commentsAdaptor=t.commentsAdaptor,t.pointSelectedMapping=new pe(t.viewer,o),t.pointSelectedMapping._listens=p.call(t,t.pointSelectedMapping,t.pinSelector),t.pointSelectedMapping.initialize(),d.call(t,e))},pointSelectionEnd:function(e){this.uninitializePointSelection(e)},pointSelectionSave:function(e){var t=this,n=t.pointSelectedMapping;n&&n.setSaving(!0),v.call(t).then((function(e){t.fetchComments(e||[])}),(function(e){n.setCommentingFailed(!0),n.setSaving(!1),console.error(e)}))}};function _(){var e=this,t=y.pointSelectionStart.bind(e),n=y.pointSelectionChanged.bind(e),o=y.pointSelectionEnd.bind(e),i=y.pointSelectionSave.bind(e);function a(a){var r=a?"removeEventListener":"addEventListener",s=e.pinSelector,l=e.eventMappings;s[r](l.POINT_SELECTION_START_EDIT_MODE,t),s[r](l.POINT_SELECTION_SELECTION_CHANGED,n),s[r](l.POINT_SELECTION_LEAVE_EDIT_MODE,o),s[r](l.SAVE_SELECTION,i)}return a(),{cancel:function(){a(!0)}}}function E(){var e=this.snapshotSelectedMapping;e&&(e._listens.cancel(),e.uninitialize(),delete this.snapshotSelectedMapping)}function S(e){var t=this;return new Promise((function(n,o){if(t.snapshotSelectedMapping){var i=(t.snapshotSelectedMapping.export().text||"").trim();i.length>0?oe.Z.payloadUtils.makeSnapshotCommentPayload.call(t).then((function(a){a.body=i,t.uninitializeSnapshotSelection(),t.commentsAdaptor.addComment(i,e.target.selectedSnap,a,void 0,{source:"canvas"}).then((function(e){n(e)}),(function(e){o(e)}))}),(function(e){o(e)})):o("Text entered is Empty")}}))}r.initializePointSelection=function(){var e=this,t=e.viewer,n=e.options;R.call(e,{data:{comment:{},expanded:!0,hideOthers:!0}});var o=new ie(t,n.pinToolTitleTranslation);e.pinSelector=o,e.pinSelectorEvents=_.call(e),e.pinSelector.initializeSelection()},r.uninitializePointSelection=function(e){var t=this;m.call(t);var n=t.pinSelector;n&&(t.pinSelectorEvents.cancel(),n.unintializeSelection(),delete t.pinSelector),R.call(t,{data:{comment:{},expanded:!0,hideOthers:!1}}),e&&d.call(t,e)};var b={snapshotSelectionStart:function(e){d.call(this,e)},snapshotSelectionChanged:function(e){var t=this,n=e.data,o={commentType:"snapshot",selectedSnap:n},i=t.snapshotSelectedMapping;i?i.setSnapshot(n):(o.editable=!0,o.commentTool=t.snapshotSelector,o.commentsAdaptor=t.commentsAdaptor,t.snapshotSelectedMapping=new pe(t.viewer,o),t.snapshotSelectedMapping._listens=p.call(t,t.snapshotSelectedMapping,t.snapshotSelector),t.snapshotSelectedMapping.initialize(),d.call(t,e))},snapshotSelectionEnd:function(e){this.uninitializeSnapshotSelection(e)},snapshotSelectionSave:function(e){var t=this,n=t.snapshotSelectedMapping;if(!n)return!1;n.setSaving(!0),S.call(t,e).then((function(e){t.fetchComments(e||[])}),(function(e){n.setCommentingFailed(!0),n.setSaving(!1),console.error(e)}))}};function w(){var e=this,t=b.snapshotSelectionStart.bind(e),n=b.snapshotSelectionChanged.bind(e),o=b.snapshotSelectionEnd.bind(e),i=b.snapshotSelectionSave.bind(e);function a(a){var r=a?"removeEventListener":"addEventListener",s=e.snapshotSelector,l=e.eventMappings;s[r](l.SNAPSHOT_SELECTION_START_EDIT_MODE,t),s[r](l.SNAPSHOT_SELECTION_SELECTION_CHANGED,n),s[r](l.SNAPSHOT_SELECTION_LEAVE_EDIT_MODE,o),s[r](l.SAVE_SELECTION,i)}return a(),{cancel:function(){a(!0)}}}function T(e){var t=this,n=e.data.markup;return new Promise((function(o,i){var a=e.data,r=a.markup,s=a.othersInfos;t.markupCreator&&r&&oe.Z.payloadUtils.makeMarkupCommentPayload.call(t).then((function(l){l.body="";var c=a.snap;l.attachment=[{url:c}],l.markup=r,t.options.dontCloseBeforeSave||t.uninitializeMarkupCreation(e),t.commentsAdaptor.addComment("",c,l,{content:"data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(r)))},{source:"canvas"}).then((function(i){t.options.dontCloseBeforeSave&&t.uninitializeMarkupCreation(e),i.forEach((e=>{e.exportSVG=n,e.othersInfos=s})),o(i)}),(function(e){i(e)}))}),(function(e){i(e)}))}))}r.initializeSnapshotSelection=function(){var e=this,t=e.viewer;R.call(e,{data:{comment:{},expanded:!0,hideOthers:!0}});var n=new ae(t);e.snapshotSelector=n,e.snapshotSelectorEvents=w.call(e),e.snapshotSelector.initializeSelection(),e.commentsAdaptor.fireEvent("startCommentsEditMode",{commentType:"snapshot"})},r.uninitializeSnapshotSelection=function(e){var t=this;E.call(t);var n=t.snapshotSelector;n&&(t.snapshotSelectorEvents.cancel(),n.unintializeSelection(),delete t.snapshotSelector),R.call(t,{data:{comment:{},expanded:!0,hideOthers:!1}}),e&&d.call(t,e),t.commentsAdaptor.fireEvent("endCommentsEditMode",{commentType:"snapshot",data:e?e.data:{}})};var x={markupCreationStart:function(e){d.call(this,e)},markupCreationEnd:function(e){this.uninitializeMarkupCreation(e)},markupCreationSave:function(e){var t=this;if(!t.markupCreator)return!1;T.call(t,e).then((function(e,n){t.fetchComments(e||[])}),(function(e){console.error(e)}))}};function A(){var e=this,t=x.markupCreationStart.bind(e),n=x.markupCreationEnd.bind(e),o=x.markupCreationSave.bind(e);function i(i){var a=i?"removeEventListener":"addEventListener",r=e.markupCreator,s=e.eventMappings;r[a](s.MARKUP_CREATION_START_EDIT_MODE,t),r[a](s.MARKUP_CREATION_LEAVE_EDIT_MODE,n),r[a](s.SAVE_SELECTION,o)}return i(),{cancel:function(){i(!0)}}}function C(){var e=this.animationSelectedMapping;e&&(e._listens.cancel(),e.uninitialize(),e.destroy(),delete this.animationSelectedMapping)}function I(e){var t=this;return new Promise((function(e,n){if(t.animationSelectedMapping){var o=t.animationTool,i=(t.animationSelectedMapping.export().text||"").trim();i.length>0?oe.Z.payloadUtils.makeViewerStateCommentPayload.call(t).then((function(a){a.body=i,t.commentsAdaptor.addComment(i,o.selectedSnap.slice(-1).pop(),a,void 0,{source:"canvas"}).then((function(t){e(t)}),(function(e){n(e)}))}),(function(e){n(e)})):n("文字不能为空！")}}))}r.initializeMarkupCreation=function(){var e=this,t=e.viewer;R.call(e,{data:{comment:{},expanded:!0,hideOthers:!0}});var n=new ue(t,e.options);e.markupCreator=n,e.markupCreatorEvents=A.call(e),e.markupCreator.initializeSelection()},r.uninitializeMarkupCreation=function(e){var t=this,n=t.markupCreator;e||n.getToolsUsed(),n&&(t.markupCreatorEvents.cancel(),n.unintializeSelection(),delete t.markupCreator),R.call(t,{data:{comment:{},expanded:!0,hideOthers:!1}}),e&&d.call(t.viewer,e)};var k={animationSelectionStart:function(e){d.call(this,e)},animationSelectionChanged:function(e){var t=this,n=e.data.snaps,o=e.data.states,i={type:"snap"},a=t.animationSelectedMapping;a&&(i=a.export()),n.length>0&&(i.editable=!0,i.animation=!0,a||(i.imageData=n,i.stages=o,i.commentsAdaptor=t.commentsAdaptor,a=t.animationSelectedMapping=new pe(t.viewer,[],i,t.animationTool),t.animationSelectedMapping._listens=p.call(t,t.animationSelectedMapping,t.animationTool),t.animationSelectedMapping.initialize()),a.setScreenshot(n,o)),d.call(t,e)},animationSelectionEnd:function(e){C.call(this),d.call(this,e)},animationSelectionSave:function(e){var t=this;t.animationSelectedMapping&&t.animationSelectedMapping.setSaving(!0),I.call(t,e).then((function(e){C.call(t),t.uninitializeAnimationSelection(),t.fetchComments(e||[])}),(function(e){console.error(e)}))}};function N(){var e=this,t=k.animationSelectionStart.bind(e),n=k.animationSelectionChanged.bind(e),o=k.animationSelectionEnd.bind(e),i=k.animationSelectionSave.bind(e);function a(a){var r=a?"removeEventListener":"addEventListener",s=e.animationTool,l=e.eventMappings;s[r](l.ANIMATION_SELECTION_START_EDIT_MODE,t),s[r](l.ANIMATION_SELECTION_SELECTION_CHANGED,n),s[r](l.ANIMATION_SELECTION_LEAVE_EDIT_MODE,o),s[r](l.SAVE_SELECTION,i)}return a(),{cancel:function(){a(!0)}}}function M(e){return e.id||(e.id=Date.now()),e.id}function R(e){var t=this,n=e.data,o=n.comment,i=n.expanded;t.displayMarkers(!n.hideOthers),t.blurMarkups(n.hideOthers),t.expandComment({id:o.id||c,expand:i,skipEvents:!0,source:"canvas"})}function O(e){var t=this,n=t.viewer,o=function(){setTimeout((function(){function t(){e(n.model.is2d())}var o=n.model.getData();o&&o.isLeaflet?(n._externalIdMappings={},t()):n.model.getInstanceTree()?n.model.getExternalIdMapping((function(e){n._externalIdMappings=e,t()}),(function(){n._externalIdMappings={},t()})):(n._externalIdMappings={},t())}),100)},i=t.unload.bind(t);function a(e){var a=e?"removeEventListener":"addEventListener",r=0;n[a](s.GEOMETRY_LOADED_EVENT,(()=>{++r===t.models.length&&o()})),n[a](s.MODEL_UNLOADED_EVENT,i)}return n.model&&n.model.isLoadDone()&&o(),a(),{cancel:function(){a(!0)}}}function P(e){var t,n,o=this,a={data:{name:fe}};(n=(t=o).viewer.toolbar.getControl("wdkitsTools-1"))&&(Object.keys(t._markup_tooltips||{}).forEach((function(e){n.getControl(e).container.classList.remove("markup-not-ready"),n.getControl(e).setToolTip(t._markup_tooltips[e])})),delete t._markup_tooltips),l.addedEvents=B.call(o),o.adaptorEvents=i.call(o),a.type=o.eventMappings.EXTENSION_LOADED_FOR_GEOMETRY,d.call(o.viewer,a),a.type="extension-loaded"}function V(e,t){e.setToolTip(t.title),e.setIcon(t.icon),e.container.firstChild.classList.add("wedofont")}function L(){var e=this,t=e.viewer,n=t.getToolbar(!0),o=e.options.name||"wdkitsTools-1",i=null,a=s.UI,r=e.options,c=t.toolbar.getControl(o);(i=c)||(s.TOOLBAR.name=o,i=new a.RadioButtonGroup(s.TOOLBAR.name)),l.buttons={};var d=oe.Z.configUtils.controlsMetadata;oe.Z.configUtils.controlsOrder.forEach((function(e,n){var o,s="ComboButton",c=e,p=!0,u=e.buttons||[];u.length<=1?(s="Button",c=d[u[0]]||e,p=!1,o=oe.Z.configUtils.buttonsMap[u[0]]):o="wedo-markup-comment";var h=o||c.name,f=new a[s](h);l.buttons[h]=f;var g=!0;if(p){var m=0;f.setToolTip("审阅批注"),f.setIcon("wedofont"),f.container.getElementsByClassName("wedofont")[0].classList.add("wedo-model-annotation"),u.forEach((function(e){var n=d[e];if((n.filter||function(){return!0})(t,r)){var o=new a.Button(e);if(n.states){var i=n.states[n.defaultState]||{};i.title&&o.setToolTip(i.title),o.setIcon(i.icon)}else n.title&&o.setToolTip(n.title),o.setIcon(n.icon);o.container.firstChild.classList.add("wedofont"),l.buttons[e]=o,f.addControl(o),m+=1}})),(g=m>0)||delete l.buttons[h]}else if(c.states){var v=c.states[c.defaultState]||{};V(f,v)}else V(f,c);g&&i.addControl(f)})),n.addControl(i,{index:r.toolbarPositionIndex}),l.toolbarGroup=i}r.initializeAnimationSelection=function(){var e=this,t=e.viewer;R.call(e,{data:{comment:{},expanded:!0}});var n=new re(t);e.animationTool=n,e.animationSelectorEvents=N.call(e),e.animationTool.initializeSelection()},r.uninitializeAnimationSelection=function(){var e=this.animationTool;e&&(this.animationSelectorEvents.cancel(),e.unintializeSelection())},r.commentTypes=["objects","animation","points","snapshot","measure","markup"],r.filterComments=function(e){const t=this,n=t.commentsAdaptor.getCurrentLoadedVersion();return e.filter((function(e){const o=e.commentString||e.lmvPosition,i=t.commentTypes.indexOf(o.commentType)>-1,a=(t.commentsAdaptor.getLoadedGeometry({},t.viewer),t.viewer.model&&t.viewer.model.getDocumentNode(),o.guid?o.guid:o.layoutName);return i&&a&&n===e.version}))},r.categorize=function(e){e.forEach((function(e){var t=e.commentString;if(!t.commentType){var n=t.tags;t.markup||e.markup?t.commentType="markup":((n=n||[]).filter((function(e){return"nodeOffset"===e.name})).length>0?t.commentType="points":t.objectSet&&t.objectSet[0].id.length>0&&(t.commentType="objects"),t.commentType||(t.commentType="snapshot"))}}))},r.deleteComment=function(e){var t,n,o=this,i=e.data,a=e.target,r=a.commentType,s=o.commentsAdaptor;i.parent?(t={parent:i.parent,id:i.reply,commentType:r},n="deleteReplyComment"):(t={id:i.reply,commentType:r},n="deleteComment"),a.setDeleting(!0),s[n](t,{source:"canvas"}).then((function(e){a.setDeleting(!1),o.fetchComments(e||[])}),(function(e){e&&console.error(e),a.setSaving(!1)}))},r.postReplyComment=function(e){var t=this,n=e.target,o=n.export().text.trim(),i=t.commentsAdaptor,a=n.comment;if(0!==o.length){n.setSaving(!0);var r=n.transformText(o);i.addReplyComment(r,a,{source:"canvas",originalText:o}).then((function(e){n.setSaving(!1),t.fetchComments(e||[])}),(function(e){console.error(e),n.setSaving(!1)}))}},r.fetchComments=function(e,t){var n=this;new Promise((function(t,o){if(e){let i=new FormData;i.append("clientId",n.clientId),i.append("themeId","");let a=n.models.map((e=>{let t=e.getPropertyDb().svf.basePath;return t.substring(t.indexOf(n.clientId)+n.clientId.length+1,t.indexOf("/output")<=0?t.length:t.indexOf("/output"))}));i.append("id",JSON.parse(e[0].commentString).markupId),i.append("files",a),i.append("commentString",e[0].commentString),i.append("probCategories",e[0].othersInfos.probCategories),i.append("profeName",e[0].othersInfos.profeName),i.append("noticePersons",e[0].othersInfos.noticePersons),i.append("authorId",e[0].othersInfos.authorId),i.append("authorName",e[0].othersInfos.authorName),(0,$.dj)(i).then((o=>{var i=e[0].othersInfos;e=o.data.data,Array.isArray(e)||(e=[e]),e[0].othersInfos=i,t(e),n.emit("go-save-other-markers",e),console.log("主数据保存成功")})).catch((e=>{console.error(e),o(e)}))}else n.commentsAdaptor.getComments(n.clientId,n.models).then((function(e){e&&!Array.isArray(e)?e=[e]:e||(e=[]),n.originalComments=e,t(e)}),(function(){o("从数据库中读取批注信息错误！")}))})).then((function(e){e=e.map((function(e){return"string"==typeof e.commentString&&(e.commentString=JSON.parse(e.commentString)),e.version=n.commentsAdaptor.getVersionFromComment(e),e})),n.categorize(e),e=n.filterComments(e),e=n.parseComments(e);var t=n.comments||[],o=n.addedComment=oe.Z.genericUtils.generateDifference(t,e,M);n.comments=e,console.log(o);var i=[];e.forEach((function(e){"markup"===e.commentString.commentType&&i.push(n.commentsAdaptor.getMarkupContent(e))})),Promise.all(i).then((function(){}),(function(){return 1})).then((function(){}))}),(function(){console.error("从互联网获取批注错误")}))},r.convertPointsXY=function(e){var t=this.viewer,n=t.model;return e.map((function(e){var o=oe.Z.lmvUtils.getFragmentId(n,e.selectedNodeId),i=oe.Z.markerUtils.nodeOffsetToWorld(e.selectedNodeOffset,o,t);return t.worldToClient(i)}))},r.parseComments=function(e){var t=this;return e.map((function(e){var n=e.commentString.commentType||"";return e.replies=e.replies||[],+e.replyCount>0&&(Array.isArray(e.replies)||(e.replies=[e.replies]),e.replies=t.parseComments(e.replies)),t.commentTypes.indexOf(n)>-1&&(e=oe.Z.payloadUtils.parsers[n](e,t.viewer)),e}))};var D,z=!1;function H(){this.emit("show-markup-list")}function B(){var e=this,t=e.initializePointSelection.bind(e),n=e.initializeObjectSelection.bind(e),o=e.initializeSnapshotSelection.bind(e),i=e.initializeMarkupCreation.bind(e),a=H.bind(e),r=oe.Z.configUtils.buttonsMap,s=l.buttons[r.pinComment],c=l.buttons[r.objectComment],d=l.buttons[r.snapshotComment],p=l.buttons[r.markupComment],u=l.buttons[r.hideShowMarkers];function h(r){var l=r?"removeEventListener":"addEventListener";s&&s[l](e.eventMappings.CLICK_EVENT,t),c&&c[l](e.eventMappings.CLICK_EVENT,n),d&&d[l](e.eventMappings.CLICK_EVENT,o),p&&p[l](e.eventMappings.CLICK_EVENT,i)&&e.btnClickEvts.push({key:"markup",fun:i}),u&&u[l](e.eventMappings.CLICK_EVENT,a)&&e.btnClickEvts.push({key:"hideShowMarkup",fun:i})}return h(),{cancel:function(){h(!0)}}}function G(){var e=this.viewer;l.addedEvents&&l.addedEvents.cancel(),l.toolbarGroup&&(e.toolbar&&e.toolbar.removeControl(l.toolbarGroup._id),delete l.toolbarGroup,delete l.buttons)}return r.MARKER_VISIBILITY=function(){return z},r.load=function(){var e=this,t=e.viewer,n={data:{name:fe}};return t.drAdapter=new ne.Extras.lmvAdapter({viewer:t}),e.unload(),t.drInstance=new ne.designReview({container:t.container,Adapter:t.drAdapter,Toolbar:ne.Extras.defaultToolbar,on:e.on,off:e.off,emit:e.emit,_events:e._events}),t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,(()=>{L.call(e);var t=e.viewer.toolbar.getControl("wdkitsTools-1");t&&(e._markup_tooltips={},t._controls.forEach((function(n){var o=n._id;e._markup_tooltips[o]=t.getControl(o).getToolTip(),t.getControl(o).setToolTip("模型加载中……"),t.getControl(o).container.classList.add("markup-not-ready")}))),D=O.call(e,P.bind(e)),n.type=e.eventMappings.EXTENSION_LOADED,d.call(e.viewer,n),e.btnClickEvts.push({key:"markup",fun:e.initializeMarkupCreation.bind(e)}),e.btnClickEvts.push({key:"hideShowMarkup",fun:H.bind(e)})})),!0},r.extensionLoaded=function(){return ge},r.unload=function(){var e=this,t=e.viewer;if(ge=!1,t.drAdapter&&t.drInstance&&(t.drInstance.destroy(),t.drAdapter.destroy()),e.commentsAdaptor){G.call(e),D&&(D.cancel(),D=null),e.adaptorEvents&&e.adaptorEvents.cancel(),e.uninitializeEdits(),e.destroyMarkers();var n={data:{name:fe}};n.type=e.eventMappings.EXTENSION_UNLOADED_FOR_GEOMETRY,d.call(e.viewer,n),n.type="extension-unloaded",d.call(e.commentsAdaptor,n)}return!0},r.getState=function(){},r.restoreState=function(){},r.uninitializeEdits=function(){var e=this;e.pinSelector&&(m.call(e),e.uninitializePointSelection()),e.viewerSelector&&(u.call(e),e.uninitializeObjectSelection()),e.markupCreator&&e.uninitializeMarkupCreation(),e.snapshotSelectedMapping&&e.uninitializeSnapshotSelection()},r.destroyMarkers=function(){if(l){var e=l.commentsMap||{};Object.keys(e).forEach((function(t){e[t].uninitialize(),delete e[t]}))}},r.expandComment=function(e){var t,n=this,o=e.id,i=e.expand,a=e.skipEvents,r=l.commentsMap||{},s={data:{comment:(r[o]||{}).comment,expand:i,source:e.source},type:i?"expanded-comment":"collapsed-comment"};!function(){if(o===c||r[o]){n.expandedComment=o,n.uninitializeEdits();var e=r[o];for(var l in r)l!==o&&o&&(r[l].expand(!1,a),r[l].partialExpand(!1,a),r[l].blurMarkup(i));e&&(r[o].expand(i,a),r[o]._tempExpanded=!0,i&&r[o].blurMarkup(!1)),t=!0}else t=!(o===c||!r[o]);t&&s.data.comment&&d.call(n.commentsAdaptor,s)}()},r.blurMarkups=function(e){if(e=!!e,l){var t=l.commentsMap||{};for(var n in t)t[n].blurMarkup(e)}},r.displayMarkers=function(e){var t=(z=e=!!e)?"on":"off";if(l){var n=l.commentsMap||{};for(var o in n)n[o].display(z)}var i=oe.Z.configUtils.buttonsMap;l.buttons&&V(l.buttons[i.hideShowMarkers],oe.Z.configUtils.controlsMetadata[i.hideShowMarkers].states[t])},a.prototype=r,s.EventDispatcher.prototype.apply(a.prototype),a}();he.theExtensionManager.registerExtension(fe,me)},37494:(e,t,n)=>{var o=n(93379),i=n(8851);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);var a=o(i,{insert:"head",singleton:!1});if(!i.locals||e.hot.invalidate){var r=i.locals;e.hot.accept(8851,(function(){"string"==typeof(i=(i=n(8851)).__esModule?i.default:i)&&(i=[[e.id,i,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(r,i.locals)?(r=i.locals,a(i)):e.hot.invalidate()}))}e.hot.dispose((function(){a()})),e.exports=i.locals||{}},61327:(e,t,n)=>{var o=n(93379),i=n(43410);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);var a=o(i,{insert:"head",singleton:!1});if(!i.locals||e.hot.invalidate){var r=i.locals;e.hot.accept(43410,(function(){"string"==typeof(i=(i=n(43410)).__esModule?i.default:i)&&(i=[[e.id,i,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(r,i.locals)?(r=i.locals,a(i)):e.hot.invalidate()}))}e.hot.dispose((function(){a()})),e.exports=i.locals||{}}},i={};function a(e){var t=i[e];if(void 0!==t){if(void 0!==t.error)throw t.error;return t.exports}var n=i[e]={id:e,loaded:!1,exports:{}};try{var r={id:e,module:n,factory:o[e],require:a};a.i.forEach((function(e){e(r)})),n=r.module,r.factory.call(n.exports,n,n.exports,r.require)}catch(e){throw n.error=e,e}return n.loaded=!0,n.exports}a.m=o,a.c=i,a.i=[],e=[],a.O=(t,n,o,i)=>{if(!n){var r=1/0;for(c=0;c<e.length;c++){for(var[n,o,i]=e[c],s=!0,l=0;l<n.length;l++)(!1&i||r>=i)&&Object.keys(a.O).every((e=>a.O[e](n[l])))?n.splice(l--,1):(s=!1,i<r&&(r=i));s&&(e.splice(c--,1),t=o())}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,o,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.hu=e=>e+"."+a.h()+".hot-update.js",a.hmrF=()=>"Marker."+a.h()+".hot-update.json",a.h=()=>"7152d5a9c66f2a2ebb99",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="wd-viewer:",a.l=(e,o,i,r)=>{if(t[e])t[e].push(o);else{var s,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var p=c[d];if(p.getAttribute("src")==e||p.getAttribute("data-webpack")==n+i){s=p;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",n+i),s.src=e),t[e]=[o];var u=(n,o)=>{s.onerror=s.onload=null,clearTimeout(h);var i=t[e];if(delete t[e],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(o))),n)return n(o)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=u.bind(null,s.onerror),s.onload=u.bind(null,s.onload),l&&document.head.appendChild(s)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=109,(()=>{var e,t,n,o,i={},r=a.c,s=[],l=[],c="idle";function d(e){c=e;for(var t=0;t<l.length;t++)l[t].call(null,e)}function p(e){if(0===t.length)return e();var n=t;return t=[],Promise.all(n).then((function(){return p(e)}))}function u(e){if("idle"!==c)throw new Error("check() is only allowed in idle status");return d("check"),a.hmrM().then((function(o){if(!o)return d(g()?"ready":"idle"),null;d("prepare");var i=[];return t=[],n=[],Promise.all(Object.keys(a.hmrC).reduce((function(e,t){return a.hmrC[t](o.c,o.r,o.m,e,n,i),e}),[])).then((function(){return p((function(){return e?f(e):(d("ready"),i)}))}))}))}function h(e){return"ready"!==c?Promise.resolve().then((function(){throw new Error("apply() is only allowed in ready status")})):f(e)}function f(e){e=e||{},g();var t=n.map((function(t){return t(e)}));n=void 0;var i,a=t.map((function(e){return e.error})).filter(Boolean);if(a.length>0)return d("abort"),Promise.resolve().then((function(){throw a[0]}));d("dispose"),t.forEach((function(e){e.dispose&&e.dispose()})),d("apply");var r=function(e){i||(i=e)},s=[];return t.forEach((function(e){if(e.apply){var t=e.apply(r);if(t)for(var n=0;n<t.length;n++)s.push(t[n])}})),i?(d("fail"),Promise.resolve().then((function(){throw i}))):o?f(e).then((function(e){return s.forEach((function(t){e.indexOf(t)<0&&e.push(t)})),e})):(d("idle"),Promise.resolve(s))}function g(){if(o)return n||(n=[]),Object.keys(a.hmrI).forEach((function(e){o.forEach((function(t){a.hmrI[e](t,n)}))})),o=void 0,!0}a.hmrD=i,a.i.push((function(f){var g,m,v,y,_=f.module,E=function(n,o){var i=r[o];if(!i)return n;var a=function(t){if(i.hot.active){if(r[t]){var a=r[t].parents;-1===a.indexOf(o)&&a.push(o)}else s=[o],e=t;-1===i.children.indexOf(t)&&i.children.push(t)}else console.warn("[HMR] unexpected require("+t+") from disposed module "+o),s=[];return n(t)},l=function(e){return{configurable:!0,enumerable:!0,get:function(){return n[e]},set:function(t){n[e]=t}}};for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&"e"!==u&&Object.defineProperty(a,u,l(u));return a.e=function(e){return function(e){switch(c){case"ready":return d("prepare"),t.push(e),p((function(){d("ready")})),e;case"prepare":return t.push(e),e;default:return e}}(n.e(e))},a}(f.require,f.id);_.hot=(g=f.id,m=_,y={_acceptedDependencies:{},_acceptedErrorHandlers:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:v=e!==g,_requireSelf:function(){s=m.parents.slice(),e=v?void 0:g,a(g)},active:!0,accept:function(e,t,n){if(void 0===e)y._selfAccepted=!0;else if("function"==typeof e)y._selfAccepted=e;else if("object"==typeof e&&null!==e)for(var o=0;o<e.length;o++)y._acceptedDependencies[e[o]]=t||function(){},y._acceptedErrorHandlers[e[o]]=n;else y._acceptedDependencies[e]=t||function(){},y._acceptedErrorHandlers[e]=n},decline:function(e){if(void 0===e)y._selfDeclined=!0;else if("object"==typeof e&&null!==e)for(var t=0;t<e.length;t++)y._declinedDependencies[e[t]]=!0;else y._declinedDependencies[e]=!0},dispose:function(e){y._disposeHandlers.push(e)},addDisposeHandler:function(e){y._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=y._disposeHandlers.indexOf(e);t>=0&&y._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,c){case"idle":n=[],Object.keys(a.hmrI).forEach((function(e){a.hmrI[e](g,n)})),d("ready");break;case"ready":Object.keys(a.hmrI).forEach((function(e){a.hmrI[e](g,n)}));break;case"prepare":case"check":case"dispose":case"apply":(o=o||[]).push(g)}},check:u,apply:h,status:function(e){if(!e)return c;l.push(e)},addStatusHandler:function(e){l.push(e)},removeStatusHandler:function(e){var t=l.indexOf(e);t>=0&&l.splice(t,1)},data:i[g]},e=void 0,y),_.parents=s,_.children=[],s=[],f.require=E})),a.hmrC={},a.hmrI={}})(),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e,t,n,o,i={109:0},r={};function s(e){return new Promise(((t,n)=>{r[e]=t;var o=a.p+a.hu(e),i=new Error;a.l(o,(t=>{if(r[e]){r[e]=void 0;var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;i.message="Loading hot update chunk "+e+" failed.\n("+o+": "+a+")",i.name="ChunkLoadError",i.type=o,i.request=a,n(i)}}))}))}function l(r){function s(e){for(var t=[e],n={},o=t.map((function(e){return{chain:[e],id:e}}));o.length>0;){var i=o.pop(),r=i.id,s=i.chain,c=a.c[r];if(c&&(!c.hot._selfAccepted||c.hot._selfInvalidated)){if(c.hot._selfDeclined)return{type:"self-declined",chain:s,moduleId:r};if(c.hot._main)return{type:"unaccepted",chain:s,moduleId:r};for(var d=0;d<c.parents.length;d++){var p=c.parents[d],u=a.c[p];if(u){if(u.hot._declinedDependencies[r])return{type:"declined",chain:s.concat([p]),moduleId:r,parentId:p};-1===t.indexOf(p)&&(u.hot._acceptedDependencies[r]?(n[p]||(n[p]=[]),l(n[p],[r])):(delete n[p],t.push(p),o.push({chain:s.concat([p]),id:p})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];-1===e.indexOf(o)&&e.push(o)}}a.f&&delete a.f.jsonpHmr,e=void 0;var c={},d=[],p={},u=function(e){console.warn("[HMR] unexpected require("+e.id+") to disposed module")};for(var h in t)if(a.o(t,h)){var f,g=t[h],m=!1,v=!1,y=!1,_="";switch((f=g?s(h):{type:"disposed",moduleId:h}).chain&&(_="\nUpdate propagation: "+f.chain.join(" -> ")),f.type){case"self-declined":r.onDeclined&&r.onDeclined(f),r.ignoreDeclined||(m=new Error("Aborted because of self decline: "+f.moduleId+_));break;case"declined":r.onDeclined&&r.onDeclined(f),r.ignoreDeclined||(m=new Error("Aborted because of declined dependency: "+f.moduleId+" in "+f.parentId+_));break;case"unaccepted":r.onUnaccepted&&r.onUnaccepted(f),r.ignoreUnaccepted||(m=new Error("Aborted because "+h+" is not accepted"+_));break;case"accepted":r.onAccepted&&r.onAccepted(f),v=!0;break;case"disposed":r.onDisposed&&r.onDisposed(f),y=!0;break;default:throw new Error("Unexception type "+f.type)}if(m)return{error:m};if(v)for(h in p[h]=g,l(d,f.outdatedModules),f.outdatedDependencies)a.o(f.outdatedDependencies,h)&&(c[h]||(c[h]=[]),l(c[h],f.outdatedDependencies[h]));y&&(l(d,[f.moduleId]),p[h]=u)}t=void 0;for(var E,S=[],b=0;b<d.length;b++){var w=d[b],T=a.c[w];T&&(T.hot._selfAccepted||T.hot._main)&&p[w]!==u&&!T.hot._selfInvalidated&&S.push({module:w,require:T.hot._requireSelf,errorHandler:T.hot._selfAccepted})}return{dispose:function(){var e;n.forEach((function(e){delete i[e]})),n=void 0;for(var t,o=d.slice();o.length>0;){var r=o.pop(),s=a.c[r];if(s){var l={},p=s.hot._disposeHandlers;for(b=0;b<p.length;b++)p[b].call(null,l);for(a.hmrD[r]=l,s.hot.active=!1,delete a.c[r],delete c[r],b=0;b<s.children.length;b++){var u=a.c[s.children[b]];u&&(e=u.parents.indexOf(r))>=0&&u.parents.splice(e,1)}}}for(var h in c)if(a.o(c,h)&&(s=a.c[h]))for(E=c[h],b=0;b<E.length;b++)t=E[b],(e=s.children.indexOf(t))>=0&&s.children.splice(e,1)},apply:function(e){for(var t in p)a.o(p,t)&&(a.m[t]=p[t]);for(var n=0;n<o.length;n++)o[n](a);for(var i in c)if(a.o(c,i)){var s=a.c[i];if(s){E=c[i];for(var l=[],u=[],h=[],f=0;f<E.length;f++){var g=E[f],m=s.hot._acceptedDependencies[g],v=s.hot._acceptedErrorHandlers[g];if(m){if(-1!==l.indexOf(m))continue;l.push(m),u.push(v),h.push(g)}}for(var y=0;y<l.length;y++)try{l[y].call(null,E)}catch(t){if("function"==typeof u[y])try{u[y](t,{moduleId:i,dependencyId:h[y]})}catch(n){r.onErrored&&r.onErrored({type:"accept-error-handler-errored",moduleId:i,dependencyId:h[y],error:n,originalError:t}),r.ignoreErrored||(e(n),e(t))}else r.onErrored&&r.onErrored({type:"accept-errored",moduleId:i,dependencyId:h[y],error:t}),r.ignoreErrored||e(t)}}}for(var _=0;_<S.length;_++){var b=S[_],w=b.module;try{b.require(w)}catch(t){if("function"==typeof b.errorHandler)try{b.errorHandler(t,{moduleId:w,module:a.c[w]})}catch(n){r.onErrored&&r.onErrored({type:"self-accept-error-handler-errored",moduleId:w,error:n,originalError:t}),r.ignoreErrored||(e(n),e(t))}else r.onErrored&&r.onErrored({type:"self-accept-errored",moduleId:w,error:t}),r.ignoreErrored||e(t)}}return d}}}self.webpackHotUpdatewd_viewer=(e,n,i)=>{for(var s in n)a.o(n,s)&&(t[s]=n[s]);i&&o.push(i),r[e]&&(r[e](),r[e]=void 0)},a.hmrI.jsonp=function(e,i){t||(t={},o=[],n=[],i.push(l)),a.o(t,e)||(t[e]=a.m[e])},a.hmrC.jsonp=function(r,c,d,p,u,h){u.push(l),e={},n=c,t=d.reduce((function(e,t){return e[t]=!1,e}),{}),o=[],r.forEach((function(t){a.o(i,t)&&void 0!==i[t]&&(p.push(s(t)),e[t]=!0)})),a.f&&(a.f.jsonpHmr=function(t,n){e&&!a.o(e,t)&&a.o(i,t)&&void 0!==i[t]&&(n.push(s(t)),e[t]=!0)})},a.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(a.p+a.hmrF()).then((e=>{if(404!==e.status){if(!e.ok)throw new Error("Failed to fetch update manifest "+e.statusText);return e.json()}}))},a.O.j=e=>0===i[e];var c=(e,t)=>{var n,o,[r,s,l]=t,c=0;for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(l)var d=l(a);for(e&&e(t);c<r.length;c++)o=r[c],a.o(i,o)&&i[o]&&i[o][0](),i[r[c]]=0;return a.O(d)},d=self.webpackChunkwd_viewer=self.webpackChunkwd_viewer||[];d.forEach(c.bind(null,0)),d.push=c.bind(null,d.push.bind(d))})();var r=a.O(void 0,[839],(()=>a(28278)));return a.O(r)})()}));