/*! For license information please see VisualClusters.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(function(){return(()=>{var e,t,n,r={20662:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,'#visualClusters .icon::before {\n  content: "\\2713";\n  margin-left: 12px;\n  color: deepskyblue;\n}\n#visualClusters .itemList:hover {\n  background-color: #4a555b;\n}\n#visualClusters .itemChecked {\n  color: deepskyblue;\n}\n.sp {\n  width: 32px;\n  height: 32px;\n  clear: both;\n  margin: 20px auto;\n}\n/* Spinner Circle Rotation */\n.sp-circle {\n  border: 2px rgba(255, 255, 255, 0.5) solid;\n  border-top: 2px black solid;\n  border-radius: 50%;\n  -webkit-animation: spCircRot 0.6s infinite linear;\n  animation: spCircRot 0.6s infinite linear;\n}\n@-webkit-keyframes spCircRot {\n  from {\n    -webkit-transform: rotate(0deg);\n  }\n  to {\n    -webkit-transform: rotate(359deg);\n  }\n}\n',""]),e.exports=t},35143:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VisualClusters2:()=>r});var r={};n.r(r);var i=n(94069);n(59622),Autodesk.Extensions.VisualClusters=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./extensions/VisualClusters/VisualClusters.js")}({"./extensions/VisualClusters/AnimController.js":function(e,t,n){n.r(t),n.d(t,"default",(function(){return o}));var r=n("./extensions/VisualClusters/AnimState.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentState=new r.SceneAnimState,this.states={},this.startState=new r.SceneAnimState,this.viewer=t,this.animControl=null}var t,n;return t=e,(n=[{key:"animateTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;this.stopAnim();var r=this.states[t],i=function(t){t=Autodesk.Viewing.Private.smootherStep(t),e.currentState.lerp(e.startState,r,t),e.currentState.apply(e.viewer)};return this.startState.copyFrom(this.currentState),Autodesk.Viewing.Private.fadeValue(0,1,n,i)}},{key:"stopAnim",value:function(){this.animControl&&this.animControl.isRunning&&(this.animControl.stop(),this.animControl=null)}},{key:"registerState",value:function(e,t){this.states[e]=t,this.currentState.createObjectAnimStates(t)}},{key:"setState",value:function(e){var t=this.states[e];t?this.currentState.copyFrom(t):this.currentState.resetTransforms(),this.currentState.apply(this.viewer)}},{key:"reset",value:function(){this.stopAnim(),this.currentState.resetTransforms(),this.currentState.apply(this.viewer),this.currentState=new r.SceneAnimState,this.states={},this.startState=new r.SceneAnimState}}])&&i(t.prototype,n),e}()},"./extensions/VisualClusters/AnimState.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.r(t),n.d(t,"ObjectAnimState",(function(){return u})),n.d(t,"ModelAnimState",(function(){return c})),n.d(t,"SceneAnimState",(function(){return d}));var a=new THREE.Matrix4,s=new THREE.Vector3,l=function(e,t,n){var r=n||new THREE.Vector3,i=a.makeRotationFromQuaternion(e),o=t.clone().applyMatrix4(i);return r.copy(t).sub(o)},u=function(){function e(t){r(this,e),this.dbId=t,this.move=new THREE.Vector3(0,0,0),this.scale=new THREE.Vector3(1,1,1),this.rot=new THREE.Quaternion,this.rotCenter=new THREE.Vector3(0,0,0)}return o(e,[{key:"apply",value:function(e){var t=this,n=e.getFragmentList(),r=e.getInstanceTree(),i=l(this.rot,this.rotCenter,s).add(this.move);r.enumNodeFragments(this.dbId,(function(e){n.updateAnimTransform(e,t.scale,t.rot,i)}))}},{key:"lerp",value:function(t,n,r){t=t||e.Identity,n=n||e.Identity,this.move.lerpVectors(t.move,n.move,r),this.scale.lerpVectors(t.scale,n.scale,r),this.rotCenter.lerpVectors(t.rotCenter,n.rotCenter,r),THREE.Quaternion.slerp(t.rot,n.rot,this.rot,r)}},{key:"copyFrom",value:function(e){this.dbId=e.dbId,this.move.copy(e.move),this.scale.copy(e.scale),this.rot.copy(e.rot),this.rotCenter.copy(e.rotCenter)}},{key:"resetTransform",value:function(){this.move.set(0,0,0),this.scale.set(1,1,1),this.rot.set(0,0,0,1),this.rotCenter.set(0,0,0)}},{key:"setRotationCenter",value:function(e,t){if(t){var n=l(this.rot,this.rotCenter),r=l(this.rot,e);this.move.add(n).sub(r)}this.rotCenter.copy(e)}}]),e}();u.Identity=new u(-1);var c=function(){function e(t){r(this,e),this.model=t,this.animStates=[]}return o(e,[{key:"apply",value:function(){for(var e in this.animStates)this.animStates[e].apply(this.model);this.model.visibleBoundsDirty=!0}},{key:"setAnimState",value:function(e,t){this.animStates[e]=t}},{key:"getAnimState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.animStates[e];return!n&&t&&(n=new u(e),this.setAnimState(e,n)),n}},{key:"createObjctAnimStates",value:function(e){for(var t in e.animStates){var n=e.animStates[t].dbId;this.getAnimState(n,!0)}}},{key:"prepareLerp",value:function(e,t){this.createObjectAnimStates(e),this.createObjectAnimStates(t)}},{key:"lerp",value:function(e,t,n){for(var r in this.animStates){var i=e&&e.animStates[r],o=t&&t.animStates[r];this.animStates[r].lerp(i,o,n)}}},{key:"copyFrom",value:function(e){for(var t in this.model=e.model,e.animStates){var n=e.animStates[t];this.getAnimState(t,!0).copyFrom(n)}for(var r in this.animStates)e.animStates[r]||delete this.animStates[r]}},{key:"resetTransforms",value:function(){for(var e in this.model.getFragmentList(),this.animStates)this.animStates[e].resetTransform()}}]),e}(),d=function(){function e(t){var n=this;r(this,e),this.animStates=[],t&&t.forEach((function(e){return n.animStates[e.id]=new c(e)}))}return o(e,[{key:"apply",value:function(e){for(var t in this.animStates)this.animStates[t].apply();e.impl.invalidate(!0,!0,!0)}},{key:"setAnimState",value:function(e,t,n){this.animStates[e].setAnimState(t,n)}},{key:"createObjectAnimStates",value:function(e){for(var t in e.animStates){var n=e.animStates[t],r=this.animStates[t];r||(r=new c(n.model),this.animStates[t]=r),r.createObjctAnimStates(n)}}},{key:"prepareLerp",value:function(e,t){this.createObjctAnimStates(e),this.createObjctAnimStates(t)}},{key:"lerp",value:function(e,t,n){for(var r in this.animStates){var i=e&&e.animStates[r],o=t&&t.animStates[r];this.animStates[r].lerp(i,o,n)}}},{key:"copyFrom",value:function(e){for(var t in e.animStates){var n=e.animStates[t],r=this.animStates[t];r||(r=new c(n.model),this.animStates[t]=r),r.copyFrom(n)}for(var i in this.animStates)e.animStates[i]||delete this.animStates[i]}},{key:"resetTransforms",value:function(){for(var e in this.animStates)this.animStates[e].resetTransforms()}}]),e}()},"./extensions/VisualClusters/Cluster.js":function(e,t,n){function r(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}n.r(t),n.d(t,"buildClustersFromAttribute",(function(){return d})),n.d(t,"Cluster",(function(){return s})),n.d(t,"createShapeId",(function(){return a})),n.d(t,"hasVisibleFragments",(function(){return l})),n.d(t,"show",(function(){return c}));var i,o,a=function(e,t){return{modelId:e,dbId:t}},s=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.shapeIds=[]},l=function(e,t){var n=e.getInstanceTree(),r=e.getFragmentList(),i=e.myData.fragments.visibilityFlags,o=!0;return n.enumNodeFragments(t,(function(e){var t=i&&i[e]===Autodesk.Viewing.Private.MeshFlags.MESH_NOTLOADED,n=!r.isFragVisible(e);if(!t&&!n)return o=!1,!0})),!o},u=function(e){return Array.from(new Set(e))},c=function(e,t,n){e?(n.loader.viewer3DImpl.visibilityManager.aggregateIsolate([]),n.loader.viewer3DImpl.layers.showAllLayers(),n.loader.viewer3DImpl.setDisplayEdges(!0)):(n.loader.viewer3DImpl.visibilityManager.toggleVisibility(t,n),n.loader.viewer3DImpl.fadeMaterial.opacity=0,n.loader.viewer3DImpl.setGhostingBrightness(!1),n.loader.viewer3DImpl.setDisplayEdges(!1))},d=(i=regeneratorRuntime.mark((function e(t){var n,r,i,o,d,f,p,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=m.length>1&&void 0!==m[1]?m[1]:["类别","类型","族名称"],r=m.length>2&&void 0!==m[2]&&m[2],i={},o=[];var v=[];for(d=function(e){var d=t[e];d.productList=[];var h=[],f=d.getData().instanceTree,p=void 0;if(r){var m=Object.keys(f.nodeAccess.dbIdToIndex);p=m.map((function(e){return parseInt(e,10)}))}else p=(p=d.myData.fragments.fragId2dbId).filter((function(e){return l(d,e)})),p=u(p);var y={ignoreHidden:!1,propFilter:n instanceof Array?n:[n]};o.push(new Promise((function(e,t){d.getBulkProperties2(p,y,(function(t){for(var n=function(e){var n,o=!1,u=!1,p=t[e];if(p.properties[2])if(-1===p.properties[2].displayValue.indexOf("_")&&-1===p.properties[2].displayValue.indexOf("-"))n=p.properties[0].displayValue;else if(p.properties[2].displayValue.indexOf("_")>=0&&p.properties[2].displayValue.indexOf("-")>=0){var m=Math.min(p.properties[2].displayValue.indexOf("_"),p.properties[2].displayValue.indexOf("-"));n=p.properties[2].displayValue.substr(0,m)}else m=Math.max(p.properties[2].displayValue.indexOf("_"),p.properties[2].displayValue.indexOf("-")),n=p.properties[2].displayValue.substr(0,m);else n=p.properties[0].displayValue;"结构框架"===n&&(n="结构梁"),n=n.replaceAll(" ","");var y=p.properties[1].displayValue;if(-1!==v.indexOf(y)?(u=!0,c(!1,p.dbId,d)):v.push(y),h.includes(n)){var g=d.productList[h.indexOf(n)];if(g.typeArr.includes(y))o=!0,u?g.detail[g.typeArr.indexOf(y)].num=++g.detail[g.typeArr.indexOf(y)].num:c(!1,p.dbId,d);else{var b={type:y,num:1,price:null,dbid:p.dbId,model:d.id};g.typeArr.push(y),g.detail.push(b)}}else{h.push(n);var x={category:n,detail:[],typeArr:[]};b={type:y,num:1,price:null,dbid:p.dbId,model:d.id},x.detail.push(b),x.typeArr.push(y),d.productList.push(x)}var E=i[n];E||(E=new s(n),i[n]=E),r?f.enumNodeChildren(p.dbId,(function(e){!l(d,e)||o||u||E.shapeIds.push(a(d.id,e))}),!0):o||u||E.shapeIds.push(a(d.id,p.dbId))},o=0;o<t.length;o++)n(o);e()}))})))},f=0;f<t.length;f++)d(f);return e.next=8,Promise.all(o);case 8:return p=Object.values(i),e.abrupt("return",p);case 10:case"end":return h(!1),e.stop()}}),e)})),o=function(){var e=this,t=arguments;return new Promise((function(n,o){var a=i.apply(e,t);function s(e){r(a,n,o,s,l,"next",e)}function l(e){r(a,n,o,s,l,"throw",e)}s(void 0)}))},function(e){return o.apply(this,arguments)});function h(e){var t=document.getElementsByClassName("mySp");if(!t.length)return console.log(t),void console.error("spinner元素不存在！");t[0].style.display=e?"block":"none"}},"./extensions/VisualClusters/ClusterGizmo.js":function(e,t,n){n.r(t),n.d(t,"ClusterGizmo",(function(){return u})),n.d(t,"ClusterGizmoController",(function(){return c}));var r=n("./extensions/VisualClusters/Label3D.js");function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var l=Autodesk.Viewing.Private,u=function(){function e(t,n,r){var i=this;o(this,e),this.viewer=t;var a=function(e){var t=new THREE.MeshPhongMaterial({color:16777215,transparent:!0,opacity:1,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1});return t.packedNormals=false,t.name="ClusterGizmoMaterial_"+t.id,e.addHDRMaterial(t.name,t),t}(t.impl.matman());this.mesh=function(e,t){var n=function(){for(var e=-.5,t=.5,n=Float32Array.from([e,e,0,e,t,0,t,e,0,t,t,0]),r=Uint16Array.from([0,3,1,0,2,3]),i=Uint16Array.from([0,1,1,3,3,2,2,0]),o=new Float32Array(24),a=0;a<4;a++){var s=3*a,l=6*a;o[l]=n[s],o[l+1]=n[s+1],o[l+2]=n[s+2]}for(var u=0;u<4;u++){var c=6*u+3;o[c]=0,o[c+1]=0,o[c+2]=1}var d=new THREE.BufferGeometry;d.vbstride=6,d.vb=o,d.ib=r,d.iblines=i;var h=new THREE.BufferAttribute(void 0,3);h.itemOffset=0,d.attributes.position=h;var f=new THREE.BufferAttribute(void 0,3);f.itemOffset=3,f.bytesPerItem=6,f.normalize=!0,d.attributes.normal=f;var p=new THREE.BufferAttribute(void 0,1);p.bytesPerItem=2,d.attributes.index=p;var m=new THREE.BufferAttribute(void 0,1);return m.bytesPerItem=2,d.addAttribute("indexlines",m),d.attributesKeys=Object.keys(d.attributes),d}(),r=new THREE.Mesh(n,t);return e.center(r.position),e.size(r.scale),r.position.z=e.min.z,r.boundingBox=e.clone(),r.boundingBox.max.z=e.min.z,r}(n,a),this.mesh.name=r,this.viewer.impl.scene.add(this.mesh),this.opacityParam=new l.AnimatedParam(0,(function(e){i.mesh.material.opacity=e,i.mesh.material.edgeOpacity=.5*e,i.viewer.impl.invalidate(!0,!0)}),1),this.opacityParam.fadeTo(1)}return s(e,[{key:"dtor",value:function(){var e,t;this.viewer.impl.scene.remove(this.mesh),this.viewer.impl.invalidate(!0,!0),e=this.mesh,t=this.viewer.impl.matman(),e.geometry.dispose(),e.material.dispose(),t.removeMaterial(e.material.name),this.mesh=null,this.viewer=null}},{key:"dispose",value:function(){var e=this;this.opacityParam.fadeTo(0,(function(){return e.dtor()}))}}]),e}(),c=function(){function e(t){o(this,e),this.viewer=t,this.models=t.impl.modelQueue().getModels(),this.gizmos=[],this.labels=[],this._events={},this.simplePanel=null,this.selecteBind=this.selecteBind.bind(this),this.mvc=!1,this.itemEle=null,this.isLister=!0,this.fadeInDelay=1.8,this.timerId=null}return s(e,[{key:"createGizmos",value:function(e){for(var t=this,n=e.clusterLayouts,i=function(e){var i=n[e],o=i.getBBox(),a=new u(t.viewer,o,i.cluster.name);t.gizmos.push(a);var s=o.center();s.z=o.min.z;var c=t.getLabelText(i),d=new r.Label3D(t.viewer,s,c);t.labels.push(d),d.setWorldBox(a.mesh.boundingBox,75),d.container.style.pointerEvents="auto",d.container.addEventListener("click",(function(e){t.viewer.impl.disableSelection(!0);var n=t.viewer.impl.camera,r=a.mesh.boundingBox,i=r.center(),o=r.size(),s=n.clone();s.target.copy(i);var u=n.position.distanceTo(i),c=Math.max(o.x,o.y,o.z);c=Math.min(c,u);var d=n.position.clone().sub(i).normalize();s.position.set(i.x+d.x*c,i.y+d.y*c,i.z+d.z*c),l.flyToView(t.viewer,s,1.5),e.stopPropagation(),t.createPanel(e.target.textContent),t.viewer.impl.disableSelection(!1)}))},o=0;o<n.length;o++)i(o)}},{key:"createPanel",value:function(e){var t=this;const n=this.viewer.container;var r=void 0;if(t.simplePanel){r=t.simplePanel;var o=document.getElementById("visual-clusters-contents-id");o.innerHTML=null,t.mvc=!1,t.setContents(o,e),t.setTitle(e)}else{t.mvc=!0;var a=t.createContents(e);r=t.simplePanel=t.simplePanel?t.simplePanel:new i.m(t.viewer,n,"visualClusters",e,a,"0","0",void 0)}t.simplePanel.setVisible(!0),r.closer.addEventListener("click",(()=>{t.simplePanel.setVisible(!1),t.mvc=!1,t.viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,t.selecteBind)}),!1)}},{key:"createContents",value:function(e){var t=document.createElement("div");return t.style.height="height: calc(100% - 65px)",t.setAttribute("id","visual-clusters-contents-id"),this.setContents(t,e)}},{key:"setContents",value:function(e,t){let n=this;e.appendChild(this.createLoadAnimation());let r=t.substr(0,t.indexOf("(")),i=[];this.models.forEach((e=>{const t=e.productList;for(const e in t)if(t.hasOwnProperty(e)){const n=t[e];n.category===r&&i.push(...n.detail)}}));let o=[],a=[];for(const e of i){var s=a.indexOf(e.type);-1===s?(o.push(e),a.push(e.type)):o[s].num+=1}var l=document.createElement("div");for(const e in o)if(o.hasOwnProperty(e)){const t=o[e],i=document.createElement("div");i.setAttribute("class","itemList"),i.style.width="100%",i.style.display="flex",i.style.flexDirection="column",i.style.boxSizing="content-box",i.setAttribute("id",t.type);const a=document.createElement("div");a.setAttribute("class","listItem"),a.setAttribute("title",t.type),a.setAttribute("data-dbid",t.dbid),a.setAttribute("data-modelid",t.model),a.style.backgroundColor="rgba(0,0,0,0)",a.style.color="#f3f7fb",a.style.display="flex",a.style.justifyContent="space-between",a.style.textAlign="left",a.style.lineHeight="35px",a.style.borderStyle="none",a.style.fontFamily="'ArtifaktElement', 'Helvetica Neue', 'Segoe UI Semilight', 'sans-serif'",a.style.padding="0 15px",a.style.cursor="pointer";const s=document.createElement("div");s.setAttribute("class","textContainer"),s.style.maskSmage="linear-gradient(to left, transparent, black 1em)",s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.width="100%",s.style.boxSizing="content-box",s.innerHTML=`<span class="">${t.type+" (x "+t.num+")"}</span>`,a.appendChild(s);const u=document.createElement("span");u.setAttribute("class","icon"),u.style.width="24px",u.style.display="none",a.appendChild(u),i.appendChild(a),i.appendChild(a),a.onclick=e=>{n.emit("typeItemClick",{category:r,type:t.type,event:e});var i=null!==e.currentTarget.getAttribute("data-dbid")?Number(e.currentTarget.getAttribute("data-dbid")):null,o=null!==e.currentTarget.getAttribute("data-modelid")?Number(e.currentTarget.getAttribute("data-modelid")):null;n.selectDbid([i],o);const a=e.currentTarget.parentElement,s=e.currentTarget.parentElement.parentElement.children;n.selectItem(a,s)},l.appendChild(i)}return n.itemEle=l,e.appendChild(l),n.loadAnimation.style.display="none",(n.mvc||null!==n.simplePanel)&&n.viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,n.selecteBind),e}},{key:"selecteBind",value:function(){var e=this;if(e.isLister){var t=e.itemEle,n=e.viewer.getAggregateSelection();if(0!==n.length)for(let i=0;i<t.children.length;i++){const o=t.children[i];var r=null!==o.firstElementChild.getAttribute("data-dbid")?Number(o.firstElementChild.getAttribute("data-dbid")):null;if(r&&r===n[0].selection[0]){e.selectItem(o,t.children);break}}else e.selectItem(null,t.children)}}},{key:"selectItem",value:function(e,t){for(const n of t){const t=n.querySelectorAll("span");n===e?t[0].classList.contains("itemChecked")||(t[0].classList.add("itemChecked"),t[1].style.display=""):(t[0].classList.remove("itemChecked"),t[1].style.display="none")}}},{key:"selectDbid",value:function(e,t){this.isLister=!1;const n=this.models.filter((e=>e.id===t));this.viewer.impl.selector.setSelection(e,n[0]),this.isLister=!0}},{key:"createLoadAnimation",value:function(){const e=this.loadAnimation=document.createElement("div");return e.setAttribute("class","sp sp-circle"),e.style.display="block",e}},{key:"setTitle",value:function(e){document.getElementById("visualClusters").firstElementChild.textContent=e}},{key:"getLabelText",value:function(e){var t=e.cluster.name,n="Revit ";return t.startsWith(n)&&(t=t.substring(n.length)),t}},{key:"disposeGizmos",value:function(){this.gizmos.forEach((function(e){return e.dispose()})),this.labels.forEach((function(e){return e.dispose()})),this.gizmos.length=0,this.labels.length=0}},{key:"cancelTimer",value:function(){this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)}},{key:"onLayoutChanged",value:function(e){var t=this;this.cancelTimer(),this.disposeGizmos(),e&&(this.timerId=window.setTimeout((function(){return t.createGizmos(e)}),1e3*this.fadeInDelay))}},{key:"reset",value:function(){this.gizmos.forEach((function(e){return e.dtor()})),this.labels.forEach((function(e){return e.dtor()})),this.gizmos.length=0,this.labels.length=0}}]),e}()},"./extensions/VisualClusters/ClusterLayout.js":function(e,t,n){n.r(t),n.d(t,"ClusterRowLayout",(function(){return c})),n.d(t,"ClusterSetLayout",(function(){return d}));var r=n("./extensions/VisualClusters/AnimState.js"),i=n("./extensions/VisualClusters/ShapeBoxes.js");function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.d(t,"ShapeBoxes",(function(){return i.default}));var l=new THREE.Box3,u=function(e,t){var n=new THREE.Vector3(0,0,1);t.rot.setFromAxisAngle(n,THREE.Math.degToRad(90));var r=(new THREE.Matrix4).makeRotationFromQuaternion(t.rot),i=l.copy(e).applyMatrix4(r);t.move.sub(i.min).add(e.min)},c=function(){function e(t){o(this,e),this.position=new THREE.Vector3(0,0,0),this.cluster=t,this.positions=[],this.rotated=[],this.size=new THREE.Vector3(0,0,0)}return s(e,[{key:"getBBox",value:function(e){var t=e||new THREE.Box3;return t.min.copy(this.position),t.max.copy(this.position).add(this.size),t}},{key:"apply",value:function(e,t,n,i){for(var o=new THREE.Vector3,a=new THREE.Box3,s=new THREE.Vector3,l=0;l<this.cluster.shapeIds.length;l++){var c=this.cluster.shapeIds[l],d=new r.ObjectAnimState(c.dbId);o.copy(this.positions[l]).add(this.position).add(t);var h=n.getShapeBox(c,a),f=h.min;if(d.move.subVectors(o,f),i){i.getShapeRotation(c,d.rot);var p=n.getUnrotatedShapeBox(c,a).center(s);d.setRotationCenter(p,!0)}this.rotated[l]&&(h=n.getShapeBox(c,h),u(h,d)),e.setAnimState(c.modelId,c.dbId,d)}}}]),e}(),d=function(){function e(t,n){o(this,e),this.position=new THREE.Vector3(0,0,0),this.clusterLayouts=t||[],this.rotationAlignment=n}return s(e,[{key:"apply",value:function(e,t){var n=this;this.clusterLayouts.forEach((function(r){return r.apply(e,n.position,t,n.rotationAlignment)}))}},{key:"createSceneState",value:function(e){var t=new i.default(e,this.rotationAlignment),n=new r.SceneAnimState(e);return this.apply(n,t),n}}]),e}()},"./extensions/VisualClusters/Label3D.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"worldToCanvas",(function(){return s})),n.d(t,"Label3D",(function(){return c}));var o=Autodesk.Viewing,a=Autodesk.Viewing.Private,s=function(e,t,n){var r=n||new THREE.Vector3,i=e.impl.camera,o=e.navigation.getScreenViewport(),a=new THREE.Matrix4;return a.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),r.copy(t),r.applyProjection(a),r.x=Math.round((r.x+1)/2*o.width),r.y=Math.round((1-r.y)/2*o.height),r},l=new THREE.Vector3,u=new THREE.Vector3,c=function(){function e(t,n){var i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"<Empty>";r(this,e),this.viewer=t,this.models=t.impl.modelQueue().getModels(),this.pos3D=n,this.pos2D=new THREE.Vector3,this.cameraChangeCb=this.update.bind(this),this.viewer.addEventListener(o.CAMERA_CHANGE_EVENT,this.cameraChangeCb);var l=t.canvasWrap.ownerDocument;this.container=l.createElement("div"),t.canvasWrap.appendChild(this.container);var u=function(e){i.container.style.opacity=e};if(this.opacityParam=new a.AnimatedParam(0,u,.5),this.opacityParam.fadeTo(1),this.container.style.left="0px",this.container.style.top="0px",this.container.style.position="absolute",this.textDiv=null,s){let e=0,t=[];this.models.forEach((n=>{let r=n.productList;for(let n=0;n<r.length;n++){const i=r[n];i.category===s&&(t.push(...i.typeArr),e+=i.typeArr.length)}})),this.setText(s+"(x "+Array.from(new Set(t)).length+")")}this.worldBox=null,this.minPixels=0,this.setVisible(!0)}var t,n;return t=e,(n=[{key:"shouldBeHidden",value:function(){return!!this.worldBox&&(e=this.viewer,t=this.worldBox.min,n=this.worldBox.max,r=s(e,t,l),o=(i=s(e,n,u)).x-r.x,a=i.y-r.y,Math.sqrt(o*o+a*a)<this.minPixels);var e,t,n,r,i,o,a}},{key:"setWorldBox",value:function(e,t){this.worldBox=e,this.minPixels=t,this.update()}},{key:"initTextLabel",value:function(){var e=this.viewer.container.ownerDocument;this.textDiv=e.createElement("div"),this.container.appendChild(this.textDiv),this.container.classList.add("measure-length"),this.container.classList.add("visible"),this.textDiv.classList.add("measure-length-text")}},{key:"setText",value:function(e){this.textDiv||this.initTextLabel(),this.textDiv.textContent=e}},{key:"dtor",value:function(){this.container.remove(),this.viewer.removeEventListener(o.cameraChangeCb)}},{key:"update",value:function(){var e=s(this.viewer,this.pos3D,this.pos2D),t=e.x,n=e.y;this.container.style.transform="translate(calc(".concat(t,"px - 50%), calc(").concat(n,"px - 50%))");var r=!this.visible||this.shouldBeHidden();this.opacityParam.fadeTo(r?0:1)}},{key:"setVisible",value:function(e){this.visible=e,this.update()}},{key:"dispose",value:function(){var e=this;this.setVisible(!1),window.setTimeout((function(){return e.dtor()}),1e3*this.opacityParam.animTime)}}])&&i(t.prototype,n),e}()},"./extensions/VisualClusters/RotationAlignment.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.r(t),n.d(t,"getBoxCorner",(function(){return a})),n.d(t,"getAngleToXAxis",(function(){return u})),n.d(t,"collectFragBoxAxes",(function(){return c})),n.d(t,"findAlignmentRotation",(function(){return d})),n.d(t,"computeObjectAlignment",(function(){return h})),n.d(t,"getRotatedFragmentBox",(function(){return m})),n.d(t,"computeTransformedObjectBox",(function(){return v})),n.d(t,"RotationAlignment",(function(){return y}));var a=function(e,t){return new THREE.Vector3(1&t?e.min.x:e.max.x,2&t?e.min.y:e.max.y,4&t?e.min.z:e.max.z)},s=Uint32Array.from([0,1,0,2,0,4]),l=function(){function e(){r(this,e),this.vertices=[],this.tmpPoint=new THREE.Vector3}return o(e,[{key:"addBox",value:function(e,t){if(!e.empty())for(var n=0;n<8;n++){var r=a(e,n).applyMatrix4(t);this.vertices.push(r)}}},{key:"getAxis",value:function(e,t){var n=8*Math.floor(e/3),r=2*e%s.length;t.indexA=n+s[r],t.indexB=n+s[r+1]}},{key:"getAxisCount",value:function(){return this.vertices.length/8*3}},{key:"getBoundingRect",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=this.vertices[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,l=this.tmpPoint.copy(s).applyMatrix4(t);e.expandByPoint(l)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}}]),e}(),u=function(e){return-Math.atan2(e.y,e.x)},c=function(e,t){var n=new l,r=e.getGeometryList(),i=e.getFragmentList(),o=new THREE.Box3,a=new THREE.Matrix4;return e.getInstanceTree().enumNodeFragments(t,(function(e){var t=i.getGeometryId(e);r.getModelBox(t,o),i.getOriginalWorldMatrix(e,a),n.addBox(o,a)})),n},d=function(e){for(var t=new THREE.Vector2,n=new THREE.Quaternion,r=new THREE.Matrix4,i=new THREE.Vector3(0,0,1),o=new THREE.Box2,a=1/0,s=null,l=new THREE.Vector2,c={indexA:0,indexB:0},d=null,h=null,f=e.getAxisCount(),p=0;p<f;p++){e.getAxis(p,c),d=e.vertices[c.indexA],h=e.vertices[c.indexB],t.set(h.x-d.x,h.y-d.y);var m=u(t);n.setFromAxisAngle(i,m),r.makeRotationFromQuaternion(n),e.getBoundingRect(o,r);var v=o.max.x-o.min.x,y=o.max.y-o.min.y,g=v*y;g<a&&(l.set(v,y),a=g,s=m)}return l.x>l.y&&(s+=THREE.Math.degToRad(90)),n.setFromAxisAngle(i,s),n},h=function(e,t){var n=c(e,t);return d(n)},f=new THREE.Matrix4,p=new THREE.Matrix4,m=function(e,t,n,r){var i=r||new THREE.Box3,o=e.getFragmentList(),a=e.getGeometryList(),s=f;o.getOriginalWorldMatrix(t,s);var l=p.copy(n).multiply(s),u=o.getGeometryId(t);return a.getModelBox(u,i),i.empty()||i.applyMatrix4(l),i},v=function(e,t,n){var r=new THREE.Box3,i=new THREE.Box3;return e.getInstanceTree().enumNodeFragments(t,(function(t){var o=m(e,t,n,i);r.union(o)})),r},y=function(){function e(t){var n=this;r(this,e),this.modelsById=[],t.forEach((function(e){return n.modelsById[e.id]=e})),this.rotations=[],this.boxes=[],this.rotMatrix=new THREE.Matrix4}return o(e,[{key:"_addToCache",value:function(e,t,n,r){var i=this.rotations[e],o=this.boxes[e];this.rotations[e]||(i=[],o=[],this.rotations[e]=i,this.boxes[e]=o),i[t]=n,o[t]=r}},{key:"_computeAlignmentAndBox",value:function(e,t){if(!this._isInCache(e,t)){var n=this.modelsById[e],r=h(n,t);this.rotMatrix.makeRotationFromQuaternion(r);var i=v(n,t,this.rotMatrix);return this._addToCache(e,t,r,i),i}}},{key:"_isInCache",value:function(e,t){var n=this.boxes[e];return Boolean(n&&n[t])}},{key:"getAlignedBox",value:function(e,t){var n=e.modelId,r=e.dbId,i=t||new THREE.Box3;this._computeAlignmentAndBox(n,r);var o=this.boxes[n][r];return i.copy(o)}},{key:"getShapeRotation",value:function(e,t){var n=e.modelId,r=e.dbId,i=t||new THREE.Quaternion;this._computeAlignmentAndBox(n,r);var o=this.rotations[n][r];return i.copy(o)}}]),e}()},"./extensions/VisualClusters/RowLayoutBuilder.js":function(e,t,n){n.r(t),n.d(t,"createClusterSetLayout",(function(){return l}));var r=n("./extensions/VisualClusters/ClusterLayout.js"),i=function(e,t,n,i){var s=i?function(e,n){return a(e,n,t)}:function(e,n){return o(e,n,t)};e.shapeIds.sort(s);var l=function(e,t,n,r){for(var i=new THREE.Vector3,o=new THREE.Vector2,a=0;a<e.shapeIds.length;a++){var s=e.shapeIds[a];i=t.getShapeSize(s,i);var l=r?Math.min(i.x,i.y):i.x,u=r?Math.max(i.x,i.y):i.y;o.x+=l,o.y=Math.max(o.y,u),o.z=Math.max(o.z,i.z)}return o.x+=(e.shapeIds.length-1)*n,o}(e,t,n,i),u=Math.sqrt(l.x/l.y),c=l.x/u;return function(e,t,n,i,o){for(var a=e.shapeIds,s=new r.ClusterRowLayout(e),l=new THREE.Vector3(0,0,0),u=new THREE.Vector3,c=0,d=0;d<a.length;d++){var h=a[d];s.positions[d]=l.clone(),u=t.getShapeSize(h,u),s.rotated[d]=o&&u.x>u.y;var f=o?Math.min(u.x,u.y):u.x,p=o?Math.max(u.x,u.y):u.y;c=Math.max(c,p),s.size.x=Math.max(s.size.x,l.x+f),s.size.y=Math.max(s.size.y,l.y+p),s.size.z=Math.max(s.size.z,u.z),l.x+=f+i,l.x>=n&&(l.x=0,l.y+=c+i,c=0)}return s}(e,t,c,n,i)},o=function(e,t,n){var r=n.getShapeSize(e),i=n.getShapeSize(t);return r.y!=i.y?r.y-i.y:r.x!=i.x?r.x-i.x:0},a=function(e,t,n){var r=n.getShapeSize(e),i=n.getShapeSize(t),o=Math.max(r.x,r.y),a=Math.max(i.x,i.y);if(o<a)return-1;if(o>a)return 1;var s=Math.min(r.x,r.y),l=Math.min(i.x,i.y);return s>l?-1:s<l?1:t-e},s=function(e,t,n){for(var r={shapeIds:new Int32Array(e.length)},o=0;o<e.length;o++)r.shapeIds[o]=o;var a=i(r,{getShapeSize:function(t,n){n=n||new THREE.Vector3;var r=e[t];return n.copy(r.size),n}},t,!1),s=n.center();s.x-=.5*a.size.x,s.y=n.min.y+1.1*(n.max.y-n.min.y);for(var l=0;l<r.shapeIds.length;l++){var u=a.positions[l],c=r.shapeIds[l];e[c].position.copy(u).add(s)}},l=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{spacing:1,clusterSpacing:10,stackClusters:!0},a=!n,l=e.map((function(e){return i(e,t,o.spacing,a)}));return s(l,o.clusterSpacing,t.sceneBox),new r.ClusterSetLayout(l,n)}},"./extensions/VisualClusters/ShapeBoxes.js":function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"default",(function(){return i})),n("./extensions/VisualClusters/RotationAlignment.js");var i=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modelsById=[],t.forEach((function(e){return r.modelsById[e.id]=e})),this.tmpFloat6=new Float32Array(6),this.tmpBox=new THREE.Box3,this.sceneBox=function(e){for(var t=new THREE.Box3,n=0;n<e.length;n++){var r=e[n].getBoundingBox();t.union(r)}return t}(t),this.rotationAlignment=n}var t,n;return t=e,(n=[{key:"getUnrotatedShapeBox",value:function(e,t){var n=t||new THREE.Box3,r=e.modelId,i=e.dbId;this.modelsById[r].getInstanceTree().getNodeBox(i,this.tmpFloat6);var o=this.tmpFloat6;return n.min.set(o[0],o[1],o[2]),n.max.set(o[3],o[4],o[5]),n}},{key:"getShapeBox",value:function(e,t){return this.rotationAlignment?this.rotationAlignment.getAlignedBox(e,t):this.getUnrotatedShapeBox(e,t)}},{key:"getShapeSize",value:function(e,t){var n=t||new THREE.Vector3,r=this.getShapeBox(e,this.tmpBox);return r.empty()?n.set(0,0,0):r.size(n),n}}])&&r(t.prototype,n),e}()},"./extensions/VisualClusters/VisualClusters.js":function(e,t,n){n.r(t),n.d(t,"default",(function(){return S}));var r=n("./extensions/VisualClusters/Cluster.js"),i=n("./extensions/VisualClusters/RowLayoutBuilder.js"),o=n("./extensions/VisualClusters/AnimController.js"),a=n("./extensions/VisualClusters/ShapeBoxes.js"),s=n("./extensions/VisualClusters/AnimState.js"),l=n("./extensions/VisualClusters/Label3D.js"),u=n("./extensions/VisualClusters/ClusterGizmo.js"),c=n("./extensions/VisualClusters/RotationAlignment.js");function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){v(o,r,i,a,s,"next",e)}function s(e){v(o,r,i,a,s,"throw",e)}a(void 0)}))}}var g,b=Autodesk.Viewing,x=b.UI,E=AutodeskNamespace("Autodesk.Viewing.Extensions.VisualClusters"),w="ByCategory",A=(g=y(regeneratorRuntime.mark((function e(t,n){var o,s,l,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(e){return e.is3d()&&Boolean(e.getInstanceTree())},t=t.filter(o),e.next=4,Object(r.buildClustersFromAttribute)(t);case 4:return s=e.sent,l=function(e){return"地形"!==e.name&&"房间"!==e.name&&"Revit <Sketch>"!==e.name},s=s.filter(l),u=n?new c.RotationAlignment(t):null,d=new a.default(t,u),e.abrupt("return",Object(i.createClusterSetLayout)(s,d,u));case 10:case"end":return e.stop()}}),e)}))),function(e,t){return g.apply(this,arguments)}),S=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?p(e):t}(this,f(t).call(this,e,n))).layoutActive=!1,r.layoutTimeStamp=0,r.animController=new o.default(r.viewer),r.gizmoController=new u.ClusterGizmoController(r.viewer),r.onModelAddedCb=r.onModelAdded.bind(p(r)),r.onModelRemovedCb=r.onModelRemoved.bind(p(r)),r.dbLoadedCb=r.onDbLoaded.bind(p(r)),r.models=e.impl.modelQueue().getModels(),r._events={},r.on=r.on,r.models=r.viewer.impl.modelQueue().getModels(),r}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,e),n=t,(i=[{key:"load",value:function(){return this.viewer.addEventListener(b.MODEL_ADDED_EVENT,this.onModelAddedCb),this.viewer.addEventListener(b.MODEL_REMOVED_EVENT,this.onModelRemovedCb),this.viewer.addEventListener(b.OBJECT_TREE_CREATED_EVENT,this.dbLoadedCb),this.gizmoController.on=this.on,this.gizmoController.off=this.off,this.gizmoController.emit=this.emit,this.btnClickEvts=[{key:"VE.VisualClusters",fun:this.buttonBindEvents.bind(this)}],!0}},{key:"on",value:function(e,t){return e.split(" ").forEach((e=>{this._events[e]=this._events[e]||[],this._events[e].push(t)})),this}},{key:"off",value:function(e,t){if(void 0!==e)return e.split(" ").forEach((e=>{e in this._events&&(t?this._events[e].splice(this._events[e].indexOf(t),1):this._events[e]=[])})),this;this._events={}}},{key:"emit",value:function(e){if(void 0===this._events[e])return null;for(var t=this._events[e].slice(),n=0;n<t.length;++n){var r=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==r)return r}}},{key:"unload",value:function(){return this.viewer.removeEventListener(b.MODEL_ADDED_EVENT,this.onModelAddedCb),this.viewer.removeEventListener(b.MODEL_REMOVED_EVENT,this.onModelRemovedCb),this.viewer.removeEventListener(b.OBJECT_TREE_CREATED_EVENT,this.onDbLoaded),this.animController.reset(),this._destroyUI(),!0}},{key:"reset",value:function(){this.animController.reset(),this.gizmoController.reset(),this.layoutActive=!1,this.updateButton()}},{key:"onModelAdded",value:function(){this.updateButton()}},{key:"onModelRemoved",value:function(){this.updateButton(),!this.viewer.getVisibleModels().length&&this.reset()}},{key:"onDbLoaded",value:function(){this.updateButton()}},{key:"onToolbarCreated",value:function(){var e=this;this.clusterButton=new x.Button("toolbar-clusterTool"),this.clusterButton.icon.innerHTML='\n                <span class="wedofont wedo-fenjie" style="font-size: 24px !important;"></span>        \n                ';var t=this.viewer.getToolbar&&this.viewer.getToolbar();if(t){var n="wdkitsTools-1",r=t.getControl(n)?t.getControl(n):new b.UI.ControlGroup(n);r&&r.addControl(this.clusterButton),this.viewer.toolbar.addControl(r)}this.clusterButton.onClick=function(){e.buttonBindEvents()},this.updateButton()}},{key:"buttonBindEvents",value:function(){var e=this;e.clustersLoading(!e.layoutActive),e.setLayoutActive(!e.layoutActive),e.layoutActive||e.models.forEach((e=>{delete e.productList,Object(r.show)(!0,void 0,e)}))}},{key:"clustersLoading",value:function(e){var t=document.getElementsByClassName("mySp");if(t.length<=0){const e=this.spinnerDom=document.createElement("div");e.setAttribute("class","mySp");const t=document.createElement("div");t.setAttribute("class","sp sp-circle"),t.style.width="100px",t.style.height="100px",t.style.zIndex=99,t.style.position="absolute",t.style.top="calc(50% - 50px)",t.style.left="calc(50% - 50px)",e.appendChild(t);const n=document.createElement("span");n.innerText="分析中……",n.style.position="absolute",n.style.top="calc(50% + 85px)",n.style.left="calc(50% - 38px)",n.style.textAlign="center",n.style.fontSize="18px",n.style.color="#fff",e.append(n),document.getElementsByClassName("adsk-viewing-viewer")[0].appendChild(e)}else this.spinnerDom=t[0];this.spinnerDom.style.display=e?"block":"none"}},{key:"_destroyUI",value:function(){if(this.clusterButton){var e=this.viewer.getToolbar&&this.viewer.getToolbar(),t=e&&e.getControl(b.TOOLBAR.MODELTOOLSID);t&&t.removeControl(this.clusterButton),this.clusterButton=null}}},{key:"setLayoutActive",value:function(e){if(this.layoutActive!==e){if(this.layoutActive=e,this.updateButton(),!e)return this.animController.animateTo(null),void this.gizmoController.onLayoutChanged(null);this.applyLayout()}}},{key:"getProductList",value:function(){}},{key:"applyLayout",value:(a=y(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.viewer.getVisibleModels(),this.layoutTimeStamp++,n=this.layoutTimeStamp,e.next=5,A(t,!0);case 5:if(r=e.sent,this.layoutActive&&n===this.layoutTimeStamp){e.next=8;break}return e.abrupt("return");case 8:this.sceneLayout=r,this.sceneAnimState=r.createSceneState(t),this.animController.registerState(w,this.sceneAnimState),this.animController.animateTo(w),this.gizmoController.onLayoutChanged(this.sceneLayout);case 13:case"end":return this.emit("productList",t),e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updateButton",value:function(){if(this.clusterButton){var e=this.viewer.getVisibleModels(),t=e.some((function(e){return e.is3d()}));if(this.clusterButton.setVisible(t),t){var n=function(e){return e.getPropertyDb()&&!e.getPropertyDb().isLoadDone()},r=e.some(n),i=e.some((function(e){return!n(e)&&!e.getInstanceTree()})),o=r||i,a="产品列表";o&&(a=r?"数据加载中……":"只有数据库可用时，才能使用该功能！"),this.clusterButton.setToolTip(a),o?this.clusterButton.setState(x.Button.State.DISABLED):this.clusterButton.setState(this.layoutActive?x.Button.State.ACTIVE:x.Button.State.INACTIVE),this.gizmoController.simplePanel&&this.gizmoController.simplePanel.setVisible(!1)}}}}])&&h(n.prototype,i),t}(b.Extension);b.theExtensionManager.registerExtension("VE.VisualClusters",S),E.buildClustersFromAttribute=r.buildClustersFromAttribute,E.Cluster=r.Cluster,E.createShapeId=r.createShapeId,E.createClusterSetLayout=i.createClusterSetLayout,E.ShapeBoxes=a.default,E.AnimConstroller=o.default,E.hasVisibleFragments=r.hasVisibleFragments,E.ObjectAnimState=s.ObjectAnimState,E.ModelAnimState=s.ModelAnimState,E.SceneAnimState=s.SceneAnimState,E.Label3D=l.Label3D,E.getBoxCorner=c.getBoxCorner,E.findAlignmentRotation=c.findAlignmentRotation,E.computeObjectAlignment=c.computeObjectAlignment,E.RotationAlignment=c.RotationAlignment}})},59622:(e,t,n)=>{var r=n(93379),i=n(20662);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);var o=r(i,{insert:"head",singleton:!1});if(!i.locals||e.hot.invalidate){var a=i.locals;e.hot.accept(20662,(function(){"string"==typeof(i=(i=n(20662)).__esModule?i.default:i)&&(i=[[e.id,i,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(a,i.locals)?(a=i.locals,o(i)):e.hot.invalidate()}))}e.hot.dispose((function(){o()})),e.exports=i.locals||{}}},i={};function o(e){var t=i[e];if(void 0!==t){if(void 0!==t.error)throw t.error;return t.exports}var n=i[e]={id:e,loaded:!1,exports:{}};try{var a={id:e,module:n,factory:r[e],require:o};o.i.forEach((function(e){e(a)})),n=a.module,a.factory.call(n.exports,n,n.exports,a.require)}catch(e){throw n.error=e,e}return n.loaded=!0,n.exports}o.m=r,o.c=i,o.i=[],e=[],o.O=(t,n,r,i)=>{if(!n){var a=1/0;for(u=0;u<e.length;u++){for(var[n,r,i]=e[u],s=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(s=!1,i<a&&(a=i));s&&(e.splice(u--,1),t=r())}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[n,r,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.hu=e=>e+"."+o.h()+".hot-update.js",o.hmrF=()=>"VisualClusters."+o.h()+".hot-update.json",o.h=()=>"7152d5a9c66f2a2ebb99",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="wd-viewer:",o.l=(e,r,i,a)=>{if(t[e])t[e].push(r);else{var s,l;if(void 0!==i)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==n+i){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",n+i),s.src=e),t[e]=[r];var h=(n,r)=>{s.onerror=s.onload=null,clearTimeout(f);var i=t[e];if(delete t[e],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(r))),n)return n(r)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=102,(()=>{var e,t,n,r,i={},a=o.c,s=[],l=[],u="idle";function c(e){u=e;for(var t=0;t<l.length;t++)l[t].call(null,e)}function d(e){if(0===t.length)return e();var n=t;return t=[],Promise.all(n).then((function(){return d(e)}))}function h(e){if("idle"!==u)throw new Error("check() is only allowed in idle status");return c("check"),o.hmrM().then((function(r){if(!r)return c(m()?"ready":"idle"),null;c("prepare");var i=[];return t=[],n=[],Promise.all(Object.keys(o.hmrC).reduce((function(e,t){return o.hmrC[t](r.c,r.r,r.m,e,n,i),e}),[])).then((function(){return d((function(){return e?p(e):(c("ready"),i)}))}))}))}function f(e){return"ready"!==u?Promise.resolve().then((function(){throw new Error("apply() is only allowed in ready status")})):p(e)}function p(e){e=e||{},m();var t=n.map((function(t){return t(e)}));n=void 0;var i,o=t.map((function(e){return e.error})).filter(Boolean);if(o.length>0)return c("abort"),Promise.resolve().then((function(){throw o[0]}));c("dispose"),t.forEach((function(e){e.dispose&&e.dispose()})),c("apply");var a=function(e){i||(i=e)},s=[];return t.forEach((function(e){if(e.apply){var t=e.apply(a);if(t)for(var n=0;n<t.length;n++)s.push(t[n])}})),i?(c("fail"),Promise.resolve().then((function(){throw i}))):r?p(e).then((function(e){return s.forEach((function(t){e.indexOf(t)<0&&e.push(t)})),e})):(c("idle"),Promise.resolve(s))}function m(){if(r)return n||(n=[]),Object.keys(o.hmrI).forEach((function(e){r.forEach((function(t){o.hmrI[e](t,n)}))})),r=void 0,!0}o.hmrD=i,o.i.push((function(p){var m,v,y,g,b=p.module,x=function(n,r){var i=a[r];if(!i)return n;var o=function(t){if(i.hot.active){if(a[t]){var o=a[t].parents;-1===o.indexOf(r)&&o.push(r)}else s=[r],e=t;-1===i.children.indexOf(t)&&i.children.push(t)}else console.warn("[HMR] unexpected require("+t+") from disposed module "+r),s=[];return n(t)},l=function(e){return{configurable:!0,enumerable:!0,get:function(){return n[e]},set:function(t){n[e]=t}}};for(var h in n)Object.prototype.hasOwnProperty.call(n,h)&&"e"!==h&&Object.defineProperty(o,h,l(h));return o.e=function(e){return function(e){switch(u){case"ready":return c("prepare"),t.push(e),d((function(){c("ready")})),e;case"prepare":return t.push(e),e;default:return e}}(n.e(e))},o}(p.require,p.id);b.hot=(m=p.id,v=b,g={_acceptedDependencies:{},_acceptedErrorHandlers:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:y=e!==m,_requireSelf:function(){s=v.parents.slice(),e=y?void 0:m,o(m)},active:!0,accept:function(e,t,n){if(void 0===e)g._selfAccepted=!0;else if("function"==typeof e)g._selfAccepted=e;else if("object"==typeof e&&null!==e)for(var r=0;r<e.length;r++)g._acceptedDependencies[e[r]]=t||function(){},g._acceptedErrorHandlers[e[r]]=n;else g._acceptedDependencies[e]=t||function(){},g._acceptedErrorHandlers[e]=n},decline:function(e){if(void 0===e)g._selfDeclined=!0;else if("object"==typeof e&&null!==e)for(var t=0;t<e.length;t++)g._declinedDependencies[e[t]]=!0;else g._declinedDependencies[e]=!0},dispose:function(e){g._disposeHandlers.push(e)},addDisposeHandler:function(e){g._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=g._disposeHandlers.indexOf(e);t>=0&&g._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,u){case"idle":n=[],Object.keys(o.hmrI).forEach((function(e){o.hmrI[e](m,n)})),c("ready");break;case"ready":Object.keys(o.hmrI).forEach((function(e){o.hmrI[e](m,n)}));break;case"prepare":case"check":case"dispose":case"apply":(r=r||[]).push(m)}},check:h,apply:f,status:function(e){if(!e)return u;l.push(e)},addStatusHandler:function(e){l.push(e)},removeStatusHandler:function(e){var t=l.indexOf(e);t>=0&&l.splice(t,1)},data:i[m]},e=void 0,g),b.parents=s,b.children=[],s=[],p.require=x})),o.hmrC={},o.hmrI={}})(),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e,t,n,r,i={102:0},a={};function s(e){return new Promise(((t,n)=>{a[e]=t;var r=o.p+o.hu(e),i=new Error;o.l(r,(t=>{if(a[e]){a[e]=void 0;var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;i.message="Loading hot update chunk "+e+" failed.\n("+r+": "+o+")",i.name="ChunkLoadError",i.type=r,i.request=o,n(i)}}))}))}function l(a){function s(e){for(var t=[e],n={},r=t.map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),a=i.id,s=i.chain,u=o.c[a];if(u&&(!u.hot._selfAccepted||u.hot._selfInvalidated)){if(u.hot._selfDeclined)return{type:"self-declined",chain:s,moduleId:a};if(u.hot._main)return{type:"unaccepted",chain:s,moduleId:a};for(var c=0;c<u.parents.length;c++){var d=u.parents[c],h=o.c[d];if(h){if(h.hot._declinedDependencies[a])return{type:"declined",chain:s.concat([d]),moduleId:a,parentId:d};-1===t.indexOf(d)&&(h.hot._acceptedDependencies[a]?(n[d]||(n[d]=[]),l(n[d],[a])):(delete n[d],t.push(d),r.push({chain:s.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}o.f&&delete o.f.jsonpHmr,e=void 0;var u={},c=[],d={},h=function(e){console.warn("[HMR] unexpected require("+e.id+") to disposed module")};for(var f in t)if(o.o(t,f)){var p,m=t[f],v=!1,y=!1,g=!1,b="";switch((p=m?s(f):{type:"disposed",moduleId:f}).chain&&(b="\nUpdate propagation: "+p.chain.join(" -> ")),p.type){case"self-declined":a.onDeclined&&a.onDeclined(p),a.ignoreDeclined||(v=new Error("Aborted because of self decline: "+p.moduleId+b));break;case"declined":a.onDeclined&&a.onDeclined(p),a.ignoreDeclined||(v=new Error("Aborted because of declined dependency: "+p.moduleId+" in "+p.parentId+b));break;case"unaccepted":a.onUnaccepted&&a.onUnaccepted(p),a.ignoreUnaccepted||(v=new Error("Aborted because "+f+" is not accepted"+b));break;case"accepted":a.onAccepted&&a.onAccepted(p),y=!0;break;case"disposed":a.onDisposed&&a.onDisposed(p),g=!0;break;default:throw new Error("Unexception type "+p.type)}if(v)return{error:v};if(y)for(f in d[f]=m,l(c,p.outdatedModules),p.outdatedDependencies)o.o(p.outdatedDependencies,f)&&(u[f]||(u[f]=[]),l(u[f],p.outdatedDependencies[f]));g&&(l(c,[p.moduleId]),d[f]=h)}t=void 0;for(var x,E=[],w=0;w<c.length;w++){var A=c[w],S=o.c[A];S&&(S.hot._selfAccepted||S.hot._main)&&d[A]!==h&&!S.hot._selfInvalidated&&E.push({module:A,require:S.hot._requireSelf,errorHandler:S.hot._selfAccepted})}return{dispose:function(){var e;n.forEach((function(e){delete i[e]})),n=void 0;for(var t,r=c.slice();r.length>0;){var a=r.pop(),s=o.c[a];if(s){var l={},d=s.hot._disposeHandlers;for(w=0;w<d.length;w++)d[w].call(null,l);for(o.hmrD[a]=l,s.hot.active=!1,delete o.c[a],delete u[a],w=0;w<s.children.length;w++){var h=o.c[s.children[w]];h&&(e=h.parents.indexOf(a))>=0&&h.parents.splice(e,1)}}}for(var f in u)if(o.o(u,f)&&(s=o.c[f]))for(x=u[f],w=0;w<x.length;w++)t=x[w],(e=s.children.indexOf(t))>=0&&s.children.splice(e,1)},apply:function(e){for(var t in d)o.o(d,t)&&(o.m[t]=d[t]);for(var n=0;n<r.length;n++)r[n](o);for(var i in u)if(o.o(u,i)){var s=o.c[i];if(s){x=u[i];for(var l=[],h=[],f=[],p=0;p<x.length;p++){var m=x[p],v=s.hot._acceptedDependencies[m],y=s.hot._acceptedErrorHandlers[m];if(v){if(-1!==l.indexOf(v))continue;l.push(v),h.push(y),f.push(m)}}for(var g=0;g<l.length;g++)try{l[g].call(null,x)}catch(t){if("function"==typeof h[g])try{h[g](t,{moduleId:i,dependencyId:f[g]})}catch(n){a.onErrored&&a.onErrored({type:"accept-error-handler-errored",moduleId:i,dependencyId:f[g],error:n,originalError:t}),a.ignoreErrored||(e(n),e(t))}else a.onErrored&&a.onErrored({type:"accept-errored",moduleId:i,dependencyId:f[g],error:t}),a.ignoreErrored||e(t)}}}for(var b=0;b<E.length;b++){var w=E[b],A=w.module;try{w.require(A)}catch(t){if("function"==typeof w.errorHandler)try{w.errorHandler(t,{moduleId:A,module:o.c[A]})}catch(n){a.onErrored&&a.onErrored({type:"self-accept-error-handler-errored",moduleId:A,error:n,originalError:t}),a.ignoreErrored||(e(n),e(t))}else a.onErrored&&a.onErrored({type:"self-accept-errored",moduleId:A,error:t}),a.ignoreErrored||e(t)}}return c}}}self.webpackHotUpdatewd_viewer=(e,n,i)=>{for(var s in n)o.o(n,s)&&(t[s]=n[s]);i&&r.push(i),a[e]&&(a[e](),a[e]=void 0)},o.hmrI.jsonp=function(e,i){t||(t={},r=[],n=[],i.push(l)),o.o(t,e)||(t[e]=o.m[e])},o.hmrC.jsonp=function(a,u,c,d,h,f){h.push(l),e={},n=u,t=c.reduce((function(e,t){return e[t]=!1,e}),{}),r=[],a.forEach((function(t){o.o(i,t)&&void 0!==i[t]&&(d.push(s(t)),e[t]=!0)})),o.f&&(o.f.jsonpHmr=function(t,n){e&&!o.o(e,t)&&o.o(i,t)&&void 0!==i[t]&&(n.push(s(t)),e[t]=!0)})},o.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(o.p+o.hmrF()).then((e=>{if(404!==e.status){if(!e.ok)throw new Error("Failed to fetch update manifest "+e.statusText);return e.json()}}))},o.O.j=e=>0===i[e];var u=(e,t)=>{var n,r,[a,s,l]=t,u=0;for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(l)var c=l(o);for(e&&e(t);u<a.length;u++)r=a[u],o.o(i,r)&&i[r]&&i[r][0](),i[a[u]]=0;return o.O(c)},c=self.webpackChunkwd_viewer=self.webpackChunkwd_viewer||[];c.forEach(u.bind(null,0)),c.push=u.bind(null,c.push.bind(c))})();var a=o.O(void 0,[839],(()=>o(35143)));return o.O(a)})()}));