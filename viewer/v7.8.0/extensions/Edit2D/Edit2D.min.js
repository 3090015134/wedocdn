/*!
 * LMV v7.8.0
 * 
 * Copyright 2019 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Edit2D=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=454)}({1:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var o=(s=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=n.sources.map((function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"}));return[i].concat(r).concat([o]).join("\n")}var s;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&n[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),t.push(s))}},t}},12:function(e,t,i){"use strict";var n=i(6),o=0,r=1,s=7,a=new THREE.Vector2,l=new THREE.Box2;function h(e){this.segTypes=[],this.segData=[],this.hasCurves=!1,this.bbox=new THREE.Box2,this.precisionTolerance=e}h.prototype.setTessParams=function(e){this.tessParams=e},h.prototype.closePath=function(){this.segTypes.length&&this.segTypes[this.segTypes.length-1]===s||this.segTypes.push(s)},h.prototype.moveTo=function(e,t){this.segTypes.push(o),this.segData.push(e,t),this.bbox.expandByPoint(a.set(e,t))},h.prototype.lineTo=function(e,t){this.segTypes.push(r),this.segData.push(e,t),this.bbox.expandByPoint(a.set(e,t))},h.prototype.arc=function(e,t,i,n,o,r){this.hasCurves=!0,this.segTypes.push(2),this.segData.push(e,t,i,n,o,r),this.bbox.expandByPoint(a.set(e,t))},h.prototype.arcTo=function(e,t,i,n,o){this.hasCurves=!0,this.segTypes.push(3),this.segData.push(e,t,i,n,o),this.bbox.expandByPoint(a.set(e,t)),this.bbox.expandByPoint(a.set(i,n))},h.prototype.quadraticCurveTo=function(e,t,i,n){this.hasCurves=!0,this.segTypes.push(4),this.segData.push(e,t,i,n),this.bbox.expandByPoint(a.set(e,t)),this.bbox.expandByPoint(a.set(i,n))},h.prototype.bezierCurveTo=function(e,t,i,n,o,r){this.hasCurves=!0,this.segTypes.push(5),this.segData.push(e,t,i,n,o,r),this.bbox.expandByPoint(a.set(e,t)),this.bbox.expandByPoint(a.set(i,n)),this.bbox.expandByPoint(a.set(o,r))},h.prototype.flatten=function(e){for(var t=new h(this.precisionTolerance),i=0,a=0,l=0,u=a,c=l,p=this.segTypes,d=this.segData,f=this.bbox.size().length(),y=0;y<p.length;y++){switch(p[y]){case o:e&&(a===u&&l===c||t.closePath()),u=a=d[i++],c=l=d[i++],t.moveTo(a,l);break;case s:t.closePath();break;case r:var v=d[i++],g=d[i++];v===a&&g===l||(t.lineTo(v,g),a=v,l=g);break;case 4:var m=d[i++],b=d[i++];v=d[i++],g=d[i++];Object(n.c)(t,a,l,m,b,v,g,f,this.tessParams),a=v,l=g;break;case 5:m=d[i++],b=d[i++];var x=d[i++],S=d[i++];v=d[i++],g=d[i++];Object(n.b)(t,a,l,m,b,x,S,v,g,f,this.tessParams),a=v,l=g;break;case 2:console.warn("not implemented: arc"),i+=6;break;case 3:console.warn("not implemented: arcto"),i+=4}}return e&&(a===u&&l===c||t.closePath()),t},h.prototype.stroke=function(e,t,i,n,a,l,h,u){if(l&&l.isAABBContain(this.bbox)===c)return;var p,d=this;(h||this.hasCurves)&&(d=this.flatten(!1)),h&&(p=e.getCurrentTransform());for(var f=0,y=0,v=0,g=0,m=0,b=d.segTypes,x=d.segData,S=0;S<b.length;S++){var k=b[S];switch(k){case o:g=y=x[f++],m=v=x[f++];break;case s:case r:var w=k===s?g:x[f++],E=k===s?m:x[f++];w===y&&E===v||(e.flushBuffer(4),h?e.currentVbb.addSegment(e.tx(y,v,p),e.ty(y,v,p),e.tx(w,E,p),e.ty(w,E,p),0,t,i,n,a,e.currentVpId||0,u):e.currentVbb.addSegment(y,v,w,E,0,t,i,n,a,e.currentVpId||0,u),y=w,v=E);break;default:console.error("Path must be flattened before rendering")}}},h.prototype.isAABB=function(){var e=this.segTypes;if(6!==e.length&&5!==e.length)return!1;if(e[0]!==o)return!1;if(6===e.length&&e[5]!==s)return!1;if(5===e.length&&e[4]!==s&&e[4]!==r)return!1;for(var t=1;t<e.length-1;t++)if(e[t]!==r)return!1;var i=this.segData,n=i[2]-i[0],a=i[3]-i[1],l=i[6]-i[4],h=i[7]-i[5],u=Math.sqrt(n*n+a*a),c=Math.sqrt(l*l+h*h);if(Math.abs(u-c)>1e-10)return!1;var p=(n/=u)*(l/=c)+(a/=u)*(h/=c);if(Math.abs(1+p)>.001)return!1;var d=i[4]-i[2],f=i[5]-i[3],y=i[8]-i[6],v=i[9]-i[7],g=Math.sqrt(d*d+f*f),m=Math.sqrt(y*y+v*v);return!(Math.abs(g-m)>1e-10)&&(p=(d/=g)*(y/=m)+(f/=g)*(v/=m),!(Math.abs(1+p)>.001)&&(p=n*d+a*f,!(Math.abs(p)>.001)&&!(Math.abs(n)>1e-10&&Math.abs(a))))};var u=1,c=2,p=4;function d(e,t,i){if(e.containsBox(t))return u;var n=i;return void 0===n&&(n=.001/e.size().length()),t.min.x-e.max.x>n?c:t.min.y-e.min.y>n?c:t.max.x-e.max.x<-n?c:t.max.y-e.max.y<-n?c:t.min.x-e.min.x<-n?p:t.min.y-e.min.y<-n?p:t.max.x-e.max.x>n?p:t.max.y-e.max.y>n?p:u}function f(e){if(!e.segTypes.length)return null;var t,i=Autodesk.Viewing.Extensions.CompGeom.ContourSet,n=Autodesk.Viewing.Extensions.CompGeom.UniquePointList,a=new i,l=new n(e.bbox),h=e.segTypes,u=e.segData,c=0,p=[];function d(e){if(e.length){var t=!1,i=e[0]===e[e.length-1];i&&e.length<=3&&(t=!0),i||console.log("Unexpected non-closed polygon contour"),t||a.addContour(e,!0)}}for(var f=0;f<h.length;f++){switch(h[f]){case o:d(p),t=l.findOrAddPoint(u[c],u[c+1]),c+=2,p=[t];break;case s:p[0]!==p[p.length-1]&&p.push(p[0]),d(p),p=[];break;case r:t=l.findOrAddPoint(u[c],u[c+1]),c+=2,t!==p[p.length-1]&&p.push(t);break;default:console.warn("Path must be flattened before triangulating.")}}return d(p),a.triangulate(),a}function y(e,t,i){var n=Autodesk.Viewing.Extensions.CompGeom.DCEL;i||(i="AND");var o=new n(e.bbox.clone().union(t.bbox),Math.min(e.precisionTolerance,t.precisionTolerance));e._addToDCEL(o,1),t._addToDCEL(o,2);var r=f(e),s=f(t);if(!r)return s;if(!s)return r;if(!r.contours.length)return"AND"===i?r:s;if(!s.contours.length)return"AND"===i?s:r;var a=r.polygon,l=s.polygon,h={pointInPolygon:function(){switch(i){case"AND":return function(e,t){return a.pointInPolygon(e,t)&&l.pointInPolygon(e,t)};case"XOR":return function(e,t){return a.quadTreeEdges.pointInPolygon(e,t)^l.quadTreeEdges.pointInPolygon(e,t)};case"OR":return function(e,t){return a.pointInPolygon(e,t)||l.pointInPolygon(e,t)};default:return}}()};return o.finalize(!0,h),o.closedAreas}function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,i){return t&&v(e.prototype,t),i&&v(e,i),e}h.prototype.isAABBContain=function(e){return this.isAABB()?d(this.bbox,e,this.precisionTolerance):p},h.prototype._addToDCEL=function(e,t,i){for(var n=this.segTypes,a=this.segData,l=0,h=0,u=0,c=0,p=0,d=0;d<n.length;d++){switch(n[d]){case o:c===h&&p===u||e.addDirectedEdge(c,p,h,u,i,t),c=h=a[l++],p=u=a[l++];break;case s:e.addDirectedEdge(c,p,h,u,i,t);break;case r:var f=a[l++],y=a[l++];e.addDirectedEdge(c,p,f,y,i,t),c=f,p=y}}c===h&&p===u||e.addDirectedEdge(c,p,h,u,i,t)},h.prototype.cacheTriangulation=function(){var e;this.flattened=this.flatten(!0);var t=(e=f(this.flattened))?e.polygon:null;this.polygon=[t],t&&(this.flattened.polygon=this.polygon)},h.prototype.clip=function(e,t){var i,n=this,o=n.bbox,r=!1;if(e.isAABB()){var s=d(e.bbox,o,this.precisionTolerance);s===c?r=!0:s===u&&(i=n)}else if(n.isAABB()){var a=d(o,e.bbox,this.precisionTolerance);a===c?r=!0:a===u&&(i=e)}if(r)return null;if(i)return i;if(!r&&!i){console.log("Complex clipped clip.");for(var l=y(e,n,"AND"),p=new h(this.precisionTolerance),f=0;f<l.length;f++)for(var v=l[f],g=0;g<v.contours.length;g++){for(var m=v.contours[g],b=0;b<m.length;b++){var x=m[b].x,S=m[b].y;0===b?p.lineTo(x,S):p.moveTo(x,S)}p.closePath()}return p}},h.prototype.fill=function(e,t,i,n,o,r){var s,a=this.flattened||this.flatten(!0);o&&(s=o.flattened||o.flatten(!0),o.flattened=s);var h,p,v,g=a.polygon,m=this.bbox;r&&(h=e.getCurrentTransform(),m=e.transformBox(m,h,l));var b,x,S=!1,k=!1;r&&s&&(k=d(s.bbox,m,this.precisionTolerance)!==c);if(!k&&s){if(s.isAABB()){var w=d(s.bbox,m,this.precisionTolerance);w===c?S=!0:w===u&&(g||(p=f(a)).triangulationFailed||(v=a))}else if(a.isAABB()){var E=d(m,s.bbox,this.precisionTolerance);E===c?S=!0:E===u&&(g||(p=f(s)),p&&!p.triangulationFailed&&(v=s))}S||v||(p=y(s,a,"AND"))}else g||(p=f(a)),p&&p.triangulationFailed&&(b=a,x=new(0,Autodesk.Viewing.Extensions.CompGeom.DCEL)(b.bbox),b._addToDCEL(x,1,!1),x.finalize(!0),p=x.closedAreas),v=a;if(p&&(g=Array.isArray(p)?p.map((function(e){return e.polygon})):[p.polygon]),!S&&g){for(var P=0;P<g.length;P++){var T=g[P];if(T&&T.indices&&T.indices.length){for(var C=T.pts,L=[],A=0;A<C.length;A++){var V=C[A].x,_=C[A].y;r?L.push(e.tx(V,_,h),e.ty(V,_,h)):L.push(V,_)}e.addPolyTriangle(L,T.indices,t,i,n,!v),v&&v.stroke(e,-.5,t,i,n,null,r)}}!1}},i.d(t,"a",(function(){return V}));var m=Autodesk.Viewing,b=m.Private,x=b.VertexBufferBuilder,S=m.getGlobal().document;var k=new Array(6),w=new THREE.Vector2,E=new THREE.Box2,P=new THREE.Vector3,T=new THREE.Quaternion,C=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Matrix4,V=function(){function e(t,i,o,r,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var h,u,c=S.createElement("canvas"),p=c.getContext("2d");if(c.height=t.height,c.width=t.width,this.canvasContext=p,this.viewport=t,this.toPageUnits=i,this.meshCallback=o,1==t.clipToViewport){var d=t.offsetX||0,f=t.offsetY||0;this.bounds=new THREE.Vector4(d*i,f*i,(t.width+d)*i,(t.height+f)*i)}this.currentMeshIndex=0,this.imageNumber=0,this.currentVbb=new x(!1),this._curPath=null,this._curClip=null,this.first=!0,this.states=[],this.glyphCache={},this.usingTextLayer=s,this.precisionTolerance=.1,this.dbId=-1,this.consecutiveIds=!1,m.isMobileDevice()&&Object(n.a)(void 0,.1),this.fontEngine=r,this.lineStyle=0,this.isScreenSpace=!1,h=p,u=this,["fillRect","strokeRect","clearRect","beginPath","closePath","moveTo","lineTo","arc","arcTo","quadraticCurveTo","bezierCurveTo","rect","fill","stroke","clip","strokeText","fillText","drawImage","save","restore","setLineDash","beginMarkedContent","beginMarkedContentProps","endMarkedContent","setCurrentOperatorIndex"].forEach((function(e){h["_original"+e]=h[e],h[e]=u[e].bind(u)})),this.layers={},this.defaultLayerId=0,this.currentLayerId=this.defaultLayerId,this.sequencedDbId=-1,this.taggedId=null,this.defaultVPId=0,this.currentVpId=this.defaultVPId,this.viewports=[this.createViewPortData((new THREE.Matrix4).elements)],this.viewportMap={},this.ocgStack=[],this.idRemap=[],this.idIndexMap={},this.msdfRender=!0,this.fontAtlas=a,this.pdfRefMap=l||{}}return g(e,null,[{key:"isRef",value:function(e){return null!=e&&"number"==typeof e.num&&"number"==typeof e.gen}},{key:"refKey",value:function(e){return"".concat(e.num,"-").concat(e.gen)}}]),g(e,[{key:"updateDBId",value:function(){null!=this.taggedId?null!=this.idIndexMap[this.taggedId]?this.dbId=this.idIndexMap[this.taggedId]:(this.sequencedDbId++,this.dbId=this.sequencedDbId,this.idRemap[this.dbId]=this.taggedId,this.idIndexMap[this.taggedId]=this.dbId):(this.consecutiveIds&&(this.sequencedDbId++,this.dbId=this.sequencedDbId),this.idRemap[this.dbId]=this.dbId)}},{key:"save",value:function(){this.states.push({clip:this._curClip,consecutiveIds:this.consecutiveIds,dbId:this.dbId,lineDashedDef:this.lineDashedDef,lineStyle:this.lineStyle}),this.canvasContext._originalsave()}},{key:"restore",value:function(){var e=this.states.pop();e&&(this._curClip=e.clip,this.consecutiveIds=e.consecutiveIds,this.dbId=e.dbId,this.lineDashedDef=e.lineDashedDef,this.lineStyle=e.lineStyle),this.canvasContext._originalrestore()}},{key:"flushBuffer",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.currentVbb.vcount||t){var n=t;if((n=n||this.currentVbb.isFull(e))&&this.currentVbb.vcount){var o=this.currentVbb.toMesh();o.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,useInstancing:this.currentVbb.useInstancing,isScreenSpace:!this.currentImage,hasLineStyles:this.currentVbb.hasLineStyles,msdfFontTexture:!!i,viewportBounds:this.bounds},this.currentImage&&(o.material.image=this.currentImage,o.material.image.name=this.currentImage.cacheKey||this.imageNumber++,o.material.opacity=this.canvasContext.globalAlpha,this.currentImage=null),this.meshCallback(o,this.currentMeshIndex++),this.currentVbb.reset(0),this.currentVbb.expandStride()}}}},{key:"addPolyTriangle",value:function(e,t,i,n,o,r){var s=this,a=null,l=this.currentVpId,h=-.5;function u(e,t){if(e>t){var i=e;e=t,t=i}if(a[e]){var n=a[e],o=n.lastIndexOf(t);-1==o?n.push(t):n[o]=-1}else a[e]=[t]}function c(t,r){if(t>r){var u=t;t=r,r=u}var c=a[t];c&&(-1!=c.indexOf(r)&&(s.flushBuffer(4),s.currentVbb.addSegment(e[2*t],e[2*t+1],e[2*r],e[2*r+1],s.currentLayerId,h,i,n,o,l,s.lineStyle)))}if(r){a=new Array(e.length/2);for(var p=0,d=t.length;p<d;p+=3){var f=t[p],y=t[p+1],v=t[p+2];u(f,y),u(y,v),u(v,f)}}if(this.currentVbb.useInstancing){var g=t.length;for(p=0;p<g;p+=3){f=t[p],y=t[p+1],v=t[p+2];this.flushBuffer(4),this.currentVbb.addTriangleGeom(e[2*f],e[2*f+1],e[2*y],e[2*y+1],e[2*v],e[2*v+1],i,n,o,l),r&&(c(f,y),c(y,v),c(v,f))}}else{g=e.length/2;this.flushBuffer(g);var m=this.currentVbb,b=m.vcount;for(p=0;p<g;++p){var x=e[2*p],S=e[2*p+1];m.addVertexPolytriangle(x,S,i,n,o,l)}m.addIndices(t,b),r&&function(){for(var t=0,r=a.length;t<r;t++){var u=a[t];if(u)for(var c=0;c<u.length;c++){var p=u[c];-1!=p&&(s.flushBuffer(4),s.currentVbb.addSegment(e[2*t],e[2*t+1],e[2*p],e[2*p+1],s.currentLayerId,h,i,n,o,l,s.lineStyle))}}}()}}},{key:"getFillColor",value:function(){if("string"!=typeof this.canvasContext.fillStyle)return console.warn("Unsupported fill style."),0;var e=parseInt(this.canvasContext.fillStyle.slice(1),16);return 255*this.canvasContext.globalAlpha<<24|(255&e)<<16|65280&e|e>>16&255}},{key:"getStrokeColor",value:function(){var e=this.canvasContext;if(this.lastStrokeStyle===e.strokeStyle&&e.globalAlpha===this.lastAlpha)return this.lastRgb;var t=parseInt(e.strokeStyle.slice(1),16),i=255*e.globalAlpha<<24|(255&t)<<16|65280&t|t>>16&255;return this.lastRgb=i,this.lastStrokeStyle=e.strokeStyle,this.lastAlpha=e.globalAlpha,i}},{key:"getCurrentTransform",value:function(){var e=this.canvasContext.mozCurrentTransform;if(this.isFontChar){var t=this.invXform,i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5];return k[0]=t[0]*i+t[2]*n,k[1]=t[1]*i+t[3]*n,k[2]=t[0]*o+t[2]*r,k[3]=t[1]*o+t[3]*r,k[4]=t[0]*s+t[2]*a+t[4],k[5]=t[1]*s+t[3]*a+t[5],k}return e}},{key:"tx",value:function(e,t,i){return(e*(i=i||this.getCurrentTransform())[0]+t*i[2]+i[4])*(this.isFontChar?1:this.toPageUnits)}},{key:"ty",value:function(e,t,i){return(e*(i=i||this.getCurrentTransform())[1]+t*i[3]+i[5])*(this.isFontChar?1:this.toPageUnits)}},{key:"scaleValue",value:function(e,t){return t=t||this.getCurrentTransform(),this.toPageUnits*Math.sqrt(Math.abs(t[0]*t[3]-t[1]*t[2]))*e}},{key:"transformBox",value:function(e,t,i){return t=t||this.getCurrentTransform(),E.makeEmpty(),w.set(this.tx(e.min.x,e.min.y,t),this.ty(e.min.x,e.min.y,t)),E.expandByPoint(w),w.set(this.tx(e.max.x,e.min.y,t),this.ty(e.max.x,e.min.y,t)),E.expandByPoint(w),w.set(this.tx(e.max.x,e.max.y,t),this.ty(e.max.x,e.max.y,t)),E.expandByPoint(w),w.set(this.tx(e.min.x,e.max.y,t),this.ty(e.min.x,e.max.y,t)),E.expandByPoint(w),i?(i.copy(E),i):E.clone()}},{key:"fillRect",value:function(e,t,i,n){this.updateDBId();var o=this.getCurrentTransform(),r=[this.tx(e,t,o),this.ty(e,t,o),this.tx(e+i,t,o),this.ty(e+i,t,o),this.tx(e+i,t+n,o),this.ty(e+i,t+n,o),this.tx(e,t+n,o),this.ty(e,t+n,o)],s=this.getFillColor(),a=this.first?-1:this.dbId;this.addPolyTriangle(r,[0,1,2,0,2,3],s,a,this.currentLayerId,!1),this.first=!1}},{key:"strokeRect",value:function(e,t,i,n){console.log("strokeRect")}},{key:"clearRect",value:function(e,t,i,n){console.log("clearRect")}},{key:"_beginTextChar",value:function(e,t,i,n,o){!0!==this.usingTextLayer?(this.isFontChar=!0,this.invXform=this.canvasContext.mozCurrentTransformInverse,this.hashKey=e.charCodeAt(0)+"/"+n.loadedName+"/"+o,this.cachedGlyph=this.glyphCache[this.hashKey],this.cachedGlyph?this.skipPath=!0:this.skipPath=!1):this.skipPath=!0}},{key:"drawMSDFText",value:function(e,t,i,n,o){var r=n.name;if(this.fontAtlas&&this.fontAtlas.charsMap&&this.fontAtlas.charsMap[r]){var s=this.fontAtlas.charsMap[r][e.charCodeAt(0)];if(null==s)return!1;this.currentVbb.isFull(4)&&this.flushBuffer(0,!0);var a=this.fontAtlas.chars[s];if(a.page>0)return!1;for(var l=this.fontAtlas.common[a.common],h=o/this.fontAtlas.info[a.info].size,u=a.width*(h+0),c=a.inverseYAxis?-1:1,p=a.height*(h+i)*c,d=a.txoffset*(h+0),f=a.tyoffset*(h+i)*-c,y=[d,f,d,f+p,d+u,f+p,d+u,f],v=[],g=0;g<y.length;g+=2)v.push(this.tx(y[g],y[g+1])),v.push(this.ty(y[g],y[g+1]));if(a.inverseYAxis)var m=[a.x/l.scaleW,1-a.y/l.scaleH,a.x/l.scaleW,1-(a.y+a.height)/l.scaleH,(a.x+a.width)/l.scaleW,1-(a.y+a.height)/l.scaleH,(a.x+a.width)/l.scaleW,1-a.y/l.scaleH];else m=[a.x/l.scaleW,1-(a.y+a.height)/l.scaleH,a.x/l.scaleW,1-a.y/l.scaleH,(a.x+a.width)/l.scaleW,1-a.y/l.scaleH,(a.x+a.width)/l.scaleW,1-(a.y+a.height)/l.scaleH];for(var b=this.currentVbb.vcount,x=y.length/2,S=0;S<x;S++)this.currentVbb.addVertexMSDFPolytriangle(v[2*S],v[2*S+1],m[2*S],m[2*S+1],this.getFillColor(),this.dbId,this.currentLayerId,0);return this.currentVbb.addIndices([0,2,1,0,2,3],b),this.currentImage=this.fontAtlas.pages[a.page],!0}return!1}},{key:"beginPath",value:function(e,t,i,n,o){this.updateDBId(),"string"==typeof e&&n&&o?this.fontAtlas&&this.drawMSDFText(e,t,i,n,o)?this.skipPath=!0:(this._beginTextChar(e,t,i,n,o),this.skipPath=!1):(this.skipPath=!1,this.isFontChar=!1,this.cachedGlyph=null),this.skipPath?this._curPath=null:(this._curPath=new h(this.isFontChar?1e-4:this.precisionTolerance),this._curPath.setTessParams(this.tessParams))}},{key:"closePath",value:function(){this.skipPath||(this._curPath.closePath(),this.cachedGlyph=null)}},{key:"moveTo",value:function(e,t){if(!this.skipPath){this._curPath||this.beginPath();var i=this.getCurrentTransform();this._curPath.moveTo(this.tx(e,t,i),this.ty(e,t,i))}}},{key:"lineTo",value:function(e,t){if(!this.skipPath){var i=this.getCurrentTransform();this._curPath.lineTo(this.tx(e,t,i),this.ty(e,t,i))}}},{key:"arc",value:function(e,t,i,n,o,r){this.skipPath||this._curPath.arc(e,t,i,n,o,r)}},{key:"arcTo",value:function(e,t,i,n,o){if(!this.skipPath){var r=this.getCurrentTransform();this._curPath.arcTo(this.tx(e,t,r),this.ty(e,t,r),this.tx(i,n,r),this.ty(i,n,r),this.scaleValue(o,r))}}},{key:"quadraticCurveTo",value:function(e,t,i,n){if(!this.skipPath){var o=this.getCurrentTransform();this._curPath.quadraticCurveTo(this.tx(e,t,o),this.ty(e,t,o),this.tx(i,n,o),this.ty(i,n,o))}}},{key:"bezierCurveTo",value:function(e,t,i,n,o,r){if(!this.skipPath){var s=this.getCurrentTransform();this._curPath.bezierCurveTo(this.tx(e,t,s),this.ty(e,t,s),this.tx(i,n,s),this.ty(i,n,s),this.tx(o,r,s),this.ty(o,r,s))}}},{key:"rect",value:function(e,t,i,n){if(!this.skipPath){var o=this.getCurrentTransform();this._curPath||this.beginPath(),this._curPath.moveTo(this.tx(e,t,o),this.ty(e,t,o)),this._curPath.lineTo(this.tx(e+i,t,o),this.ty(e+i,t,o)),this._curPath.lineTo(this.tx(e+i,t+n,o),this.ty(e+i,t+n,o)),this._curPath.lineTo(this.tx(e+i,t,o),this.ty(e+i,t,o)),this._curPath.closePath()}}},{key:"fill",value:function(){this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.cacheTriangulation()),this.isFontChar=!1,this.cachedGlyph?this.cachedGlyph.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!0):this._curPath&&this._curPath.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!1),this.skipPath=!1}},{key:"stroke",value:function(){this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.cacheTriangulation()),this.updateLineDashStyle(),this.isFontChar=!1;var e=this.isScreenSpace?-1:1;this.cachedGlyph?this.cachedGlyph.stroke(this,e*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!0,this.lineStyle):this._curPath&&this._curPath.stroke(this,e*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!1,this.lineStyle),this.skipPath=!1}},{key:"clip",value:function(e,t){void 0!==t&&void 0!==e?(this._curClip=e,console.log("Probably unsupported use case")):(this._curClip?this._curClip=this._curClip.clip(this._curPath,e):this._curClip=this._curPath,this._curPath=null)}},{key:"strokeText",value:function(e,t,i,n,o,r){var s=this.canvasContext;s.save(),s.translate(t,i),this.fontEngine.drawText(this,e,0,0,o,r),this.stroke(),s.restore()}},{key:"fillText",value:function(e,t,i,n,o,r){var s=this.canvasContext;s.save(),s.translate(t,i),this.fontEngine.drawText(this,e,0,0,o,r),this.fill(),s.restore()}},{key:"drawImage",value:function(e,t,i,n,o,r,s,a,l){if(0!==e.width&&0!==e.height)if(void 0===r&&(r=t,s=i,a=n,l=o),void 0===a&&(a=e.width,l=e.height),a){var h=this.getCurrentTransform(),u=this.tx(r+a/2,s+l/2),c=this.ty(r+a/2,s+l/2);A.elements[0]=h[0],A.elements[1]=h[1],A.elements[4]=h[2],A.elements[5]=h[3],A.elements[12]=h[4],A.elements[13]=h[5],A.decompose(P,T,C);var p=a*C.x*this.toPageUnits,d=-l*C.y*this.toPageUnits,f=Math.sqrt(1-T.w*T.w);L.set(T.x/f,T.y/f,T.z/f);var y=2*Math.acos(Math.max(Math.min(1,T.w),-1));T.z<0&&(y=-y),y<0&&(y+=2*Math.PI),this.flushBuffer(0,!0),this.currentVbb.addTexturedQuad(u,c,p,d,y,4294902015,0,this.currentLayerId,0),this.currentImage=e,this.flushBuffer(0,!0,!1)}else console.warn("Zero size image, skipping");else console.warn("Zero size image, skipping")}},{key:"_processProperties",value:function(t){for(var i in e.isRef(t)&&(t=this.pdfRefMap[e.refKey(t)]),t)e.isRef(t[i])&&(t[i]=this.pdfRefMap[e.refKey(t[i])]);return t}},{key:"beginMarkedContent",value:function(e){e&&(e=this._processProperties(e));var t=e.name||e.DBID;isNaN(t)?this.taggedId=null:this.taggedId=parseInt(t),null!=this.taggedId&&this.dbId!=this.taggedId&&this.updateDBId(),e.VP&&(this.currentVpId=this.viewports.length,this.viewports.push(this.createViewPortData(JSON.parse(e.VP),e.UNITS))),this.ocgStack.push({taggedId:this.taggedId,viewPortId:this.currentVpId})}},{key:"beginMarkedContentProps",value:function(e,t){if(t&&(t=this._processProperties(t)),"OC"===e){var i=t.ocgId,n=this.layers[i];null==n&&(n=this.defaultLayerId),this.currentLayerId=n,this.ocgStack.push({layerId:this.currentLayerId})}else isNaN(e)||(this.taggedId=parseInt(e),this.dbId!=this.taggedId&&this.updateDBId()),t?(t.VP&&(this.currentVpId=this.viewports.length,this.viewports.push(this.createViewPortData(JSON.parse(t.VP),t.UNITS))),this.ocgStack.push({viewPortId:this.currentVpId,taggedId:this.taggedId})):this.ocgStack.push({})}},{key:"endMarkedContent",value:function(){var e=this.ocgStack.pop(),t=this.taggedId;if(e&&(null!=e.taggedId&&(this.taggedId=null),e.layerId&&(this.currentLayerId=this.defaultLayerId),e.viewPortId&&(this.currentVpId=this.defaultVPId)),this.ocgStack.length>0){var i=this.ocgStack[this.ocgStack.length-1];null!=i.taggedId&&(this.taggedId=i.taggedId),null!=i.currentLayerId&&(this.currentLayerId=i.currentLayerId),null!=i.viewPortId&&(this.currentVpId=i.viewPortId)}else this.currentLayerId=this.defaultLayerId,this.taggedId=null,this.currentVpId=this.defaultVPId;t!=this.taggedId&&this.updateDBId()}},{key:"setLineStyleParam",value:function(e){if(!this.lineStyleInitialized){for(var t=b.LineStyleDefs.length,i=1,n=0;n<b.LineStyleDefs.length;n++)i=Math.max(b.LineStyleDefs[n].def.length,i);var o=b.createLinePatternTextureData(Math.max(e.width,i),e.height+t+1),r=o.tex,s=o.pw,a=o.lineStyleTex;this.lineStyleIndex=0,this.lineStylePw=s,this.lineStyleTexData=r,this.lineStyleTexture=a,this.lineStyleIndexMap={};for(n=0;n<b.LineStyleDefs.length;n++)this.addNewDashedLineStyle(b.LineStyleDefs[n],96);this.lineStyle=0,this.lineStyleInitialized=!0}}},{key:"addNewDashedLineStyle",value:function(e,t){var i=e.def.join("/");if(null!=this.lineStyleIndexMap[i])return this.lineStyleIndexMap[i];b.createLinePatternForDef(e,this.lineStyleTexData,this.lineStyleIndex,this.lineStylePw,t);var n=this.lineStyleIndex;return this.lineStyleIndexMap[i]=n,this.lineStyleIndex++,n}},{key:"setLineDash",value:function(e){this.lineStyleInitialized||this.setLineStyleParam({width:5,height:4}),this.lineDashedDef=e}},{key:"updateLineDashStyle",value:function(){var e=this.lineDashedDef;if(e)if(e.length>0){for(var t=this.getCurrentTransform(),i=[],n=0;n<e.length;n++){var o=(e[n]*t[0]+e[n]*t[2])*this.toPageUnits;o=parseFloat(o.toFixed(6)),i.push(o)}this.lineStyle=this.addNewDashedLineStyle({def:i},96/72/this.toPageUnits)}else this.lineStyle=0}},{key:"setCircleInfo",value:function(e){this.circleInfo=e}},{key:"setCurrentOperatorIndex",value:function(e){if(this.circleInfo&&this.circleInfo[e]){var t=this.getCurrentTransform(),i=this.tx(this.circleInfo[e][0],this.circleInfo[e][1],t),n=this.ty(this.circleInfo[e][0],this.circleInfo[e][1],t),o=this.currentVbb.addVertexLine(i,n,0,1e-4,0,0,1,this.dbId,this.currentLayerId,this.currentVpId);this.currentVbb.finalizeQuad(o)}}},{key:"setTessParams",value:function(e){this.tessParams=e}},{key:"finish",value:function(){this.flushBuffer(0,!0),this.fontAtlas=null}},{key:"createViewPortData",value:function(e,t){return{units:t||"feet and inches",transform:e,geom_metrics:this.initGeomMetrics()}}},{key:"initGeomMetrics",value:function(){return{arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]}}}]),e}()},2:function(e,t,i){var n,o,r={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,i){if("function"==typeof e)return e();if(void 0===t[e]){var n=a.call(this,e,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),h=null,u=0,c=[],p=i(3);function d(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=r[n.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](n.parts[s]);for(;s<n.parts.length;s++)o.parts.push(b(n.parts[s],t))}else{var a=[];for(s=0;s<n.parts.length;s++)a.push(b(n.parts[s],t));r[n.id]={id:n.id,refs:1,parts:a}}}}function f(e,t){for(var i=[],n={},o=0;o<e.length;o++){var r=e[o],s=t.base?r[0]+t.base:r[0],a={css:r[1],media:r[2],sourceMap:r[3]};n[s]?n[s].parts.push(a):i.push(n[s]={id:s,parts:[a]})}return i}function y(e,t){var i=l(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),c.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,i);i.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=c.indexOf(e);t>=0&&c.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=function(){0;return i.nc}();n&&(e.attrs.nonce=n)}return m(t,e.attrs),y(e,t),t}function m(e,t){Object.keys(t).forEach((function(i){e.setAttribute(i,t[i])}))}function b(e,t){var i,n,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var s=u++;i=h||(h=g(t)),n=k.bind(null,i,s,!1),o=k.bind(null,i,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),y(e,t),t}(t),n=E.bind(null,i,t),o=function(){v(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(t),n=w.bind(null,i),o=function(){v(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=f(e,t);return d(i,t),function(e){for(var n=[],o=0;o<i.length;o++){var s=i[o];(a=r[s.id]).refs--,n.push(a)}e&&d(f(e,t),t);for(o=0;o<n.length;o++){var a;if(0===(a=n[o]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete r[a.id]}}}};var x,S=(x=[],function(e,t){return x[e]=t,x.filter(Boolean).join("\n")});function k(e,t,i,n){var o=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=S(t,o);else{var r=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function w(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function E(e,t,i){var n=i.css,o=i.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(n=p(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([n],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},266:function(e,t,i){var n=i(267);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,o);n.locals&&(e.exports=n.locals)},267:function(e,t,i){(e.exports=i(1)(!1)).push([e.i,".adsk-viewing-viewer .edge-gizmo:hover{background-color:lime}.adsk-viewing-viewer .edge-gizmo{position:absolute;background-color:#009bff;box-shadow:0px 1px 3px 1px rgba(0,0,0,0.25);border-radius:8px;cursor:move;z-index:1;-webkit-tap-highlight-color:rgba(0,0,0,0)}.adsk-viewing-viewer .edge-gizmo.selected{background-color:lime}.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover{border-color:lime}.adsk-viewing-viewer .vertex-gizmo{display:inline-block;position:absolute;width:7px;height:7px;left:-2px;top:-2px;background-color:#009bff;border-style:solid;border-width:2px;border-color:#FFFFFF;border-radius:100px;box-shadow:0 2px 5px 0 #182A3D;z-index:1;cursor:move}.adsk-viewing-viewer .vertex-gizmo.selected{border-color:lime}.adsk-viewing-viewer .edge-move-gizmo{width:20px;height:6px}\n",""])},3:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,n=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?i+r:n+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},454:function(e,t,i){"use strict";i.r(t);var n=i(12);i(6);function o(e){e.mozCurrentTransform||(e._originalSave=e.save,e._originalRestore=e.restore,e._originalRotate=e.rotate,e._originalScale=e.scale,e._originalTranslate=e.translate,e._originalTransform=e.transform,e._originalSetTransform=e.setTransform,e._transformMatrix=e._transformMatrix||[1,0,0,1,0,0],e._transformStack=[],Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){var e=this._transformMatrix,t=e[0],i=e[1],n=e[2],o=e[3],r=e[4],s=e[5],a=t*o-i*n,l=i*n-t*o;return[o/a,i/l,n/l,t/a,(o*r-n*s)/l,(i*r-t*s)/a]}}),e.save=function(){var e=this._transformMatrix;this._transformStack.push(e),this._transformMatrix=e.slice(0,6),this._originalSave()},e.restore=function(){var e=this._transformStack.pop();e&&(this._transformMatrix=e,this._originalRestore())},e.translate=function(e,t){var i=this._transformMatrix;i[4]=i[0]*e+i[2]*t+i[4],i[5]=i[1]*e+i[3]*t+i[5],this._originalTranslate(e,t)},e.scale=function(e,t){var i=this._transformMatrix;i[0]=i[0]*e,i[1]=i[1]*e,i[2]=i[2]*t,i[3]=i[3]*t,this._originalScale(e,t)},e.transform=function(t,i,n,o,r,s){var a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*i,a[1]*t+a[3]*i,a[0]*n+a[2]*o,a[1]*n+a[3]*o,a[0]*r+a[2]*s+a[4],a[1]*r+a[3]*s+a[5]],e._originalTransform(t,i,n,o,r,s)},e.setTransform=function(t,i,n,o,r,s){this._transformMatrix=[t,i,n,o,r,s],e._originalSetTransform(t,i,n,o,r,s)},e.rotate=function(e){var t=Math.cos(e),i=Math.sin(e),n=this._transformMatrix;this._transformMatrix=[n[0]*t+n[2]*i,n[1]*t+n[3]*i,n[0]*-i+n[2]*t,n[1]*-i+n[3]*t,n[4],n[5]],this._originalRotate(e)})}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=1,a=Autodesk.Viewing,l=function(){function e(t,i,r){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=new THREE.Scene,this.shapes=[],this.canvasGizmos=[],this.id=s++;this.viewport={width:t,height:i};this.context=new n.a(this.viewport,1,this._processMesh.bind(this),null),this.viewer=r,this.setGlobalManager(r.globalManager),this.autoUpdate=!0,this.toPageUnits=1,this.styleModifiers=[],o(this.context.canvasContext),this.onCameraChange=function(){return a.updateCanvasGizmos()},this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.context.setTessParams({numIterations:100,minSegLenFraction:.01})}var t,i,a;return t=e,(i=[{key:"dtor",value:function(){this._clearScene(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange)}},{key:"addShape",value:function(e){this.shapes.push(e),this._onModified()}},{key:"removeShape",value:function(e){var t=this.shapes.indexOf(e);return-1!==t&&(this.shapes.splice(t,1),this._onModified(),!0)}},{key:"clear",value:function(){this.shapes.length=0,this._onModified()}},{key:"update",value:function(){this._clearScene();for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e],i=this._getOverrideStyle(t);t.draw(this.context,i)}this.context.flushBuffer(0,!0),this.viewer.impl.invalidate(!1,!1,!0),this.updateCanvasGizmos()}},{key:"updateCanvasGizmos",value:function(){for(var e=0;e<this.canvasGizmos.length;e++)this.canvasGizmos[e].update()}},{key:"addCanvasGizmo",value:function(e){this.canvasGizmos.push(e)}},{key:"removeCanvasGizmo",value:function(e){var t=this.canvasGizmos.indexOf(e);return-1!==t&&(this.canvasGizmos.splice(t,1),!0)}},{key:"getViewport",value:function(){return this.viewport}},{key:"hitTest",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.shapes.length-1;n>=0;n--){var o=this.shapes[n],r=this.getLineHitRadius(o,i);if(o.hitTest(e,t,r))return o}}},{key:"getLineHitRadius",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=this.getUnitsPerPixel(),n=(e.style.isScreenSpace?i:1)*e.style.lineWidth;return Math.max(n,t*i)}},{key:"addStyleModifier",value:function(e){this.styleModifiers.push(e),this._onModified()}},{key:"removeStyleModifier",value:function(e){var t=this.styleModifiers.indexOf(e);return-1!=t&&(this.styleModifiers.splice(t,1),this._onModified(),!0)}},{key:"layerToCanvas",value:function(e,t){var i=this.viewer.impl.worldToClient(new THREE.Vector3(e,t,0));return new THREE.Vector2(i.x,i.y)}},{key:"getPixelsPerUnit",value:function(){if(!this.viewer.model)return console.warn("Accessing EditLayer.getPixelsPerUnit is impossible when no model is loaded."),1;var e=this.viewer.impl.camera,t=this.viewer.impl.getVisibleBounds(),i=this.getWindow();return this.viewer.impl.getPixelsPerUnit(e,t)/i.devicePixelRatio}},{key:"getUnitsPerPixel",value:function(){return 1/this.getPixelsPerUnit()}},{key:"canvasToLayer",value:function(e,t){var i=this.viewer.impl.intersectGround(e,t);return new THREE.Vector2(i.x,i.y)}},{key:"enumShapes",value:function(e,t){for(var i=0;i<this.shapes.length;i++){var n=this.shapes[i];n.updateBBox(),e.isIntersectionBox(n.bbox)&&t(n)}}},{key:"enumMeshes",value:function(e,t){for(var i=0;i<this.scene.children.length;i++){var n=this.scene.children[i],o=n.geometry.boundingBox;e.isIntersectionBox(o)&&t(n)}}},{key:"findShapeById",value:function(e){return this.shapes.find((function(t){return t.id==e}))}},{key:"_processMesh",value:function(e){var t={mesh:e,is2d:!0,packId:"0",meshIndex:0};Autodesk.Viewing.Private.BufferGeometryUtils.meshToGeometry(t);var i=t.geometry,n=this.viewer.impl.getMaterials(),o=n.create2DMaterial(null,e.material),r=n.findMaterial(null,o),s=new THREE.Mesh(i,r);this.scene.children.push(s)}},{key:"_onModified",value:function(){this.autoUpdate&&this.update()}},{key:"_getOverrideStyle",value:function(e){for(var t=e.style,i=0;i<this.styleModifiers.length;i++)t=(0,this.styleModifiers[i])(e,t)||t;return t}},{key:"_clearScene",value:function(){for(var e=this.scene.children,t=0;t<e.length;t++)e[t].geometry.dispose();this.scene.children.length=0}}])&&r(t.prototype,i),a&&r(t,a),e}();a.GlobalManagerMixin.call(l.prototype);var h,u=function(e,t,i){var n=(e.x-t.x)*i.x+(e.y-t.y)*i.y;e.set(t.x+n*i.x,t.y+n*i.y)},c=(h=new THREE.Vector2,function(e,t,i){return u(h.copy(e),t,i),e.distanceTo(h)}),p=function(e,t,i){return Math.abs(e-t)<i},d={getEdgeDirection:function(e,t,i){return(i=i||new THREE.Vector2).copy(t).sub(e).normalize()},projectToLine:u,pointLineDistance:c,intersectLines:function(e,t,i,n,o){var r=n.y*t.x-n.x*t.y;if(Math.abs(r)<1e-8)return!1;var s=e.x-i.x,a=e.y-i.y,l=n.x*a-n.y*s;return o&&(o.x=e.x+l/r*t.x,o.y=e.y+l/r*t.y),!0},rotateAround:function(e,t,i){var n=Math.cos(t),o=Math.sin(t);i&&e.sub(i);var r=e.x,s=e.y;return e.x=r*n-s*o,e.y=r*o+s*n,i&&e.add(i),e},angleBetweenDirections:function(e,t){var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i+=2*Math.PI),i},getEdgeCenter:function(e,t,i){return(i=i||new THREE.Vector2).set(.5*(e.x+t.x),.5*(e.y+t.y))},getEdgeLength:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},turnLeft:function(e){var t=e.x;return e.x=-e.y,e.y=t,e},isPointOnEdge:function(e,t,i,n){var o=i.x-t.x,r=i.y-t.y,s=Math.sqrt(o*o+r*r),a={v1:t,dx:o,dy:r,length:s,length2:s*s};return Autodesk.Extensions.CompGeom.pointOnLine(e.x,e.y,a,!0,n)},pointDelta:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={x:t.x-e.x,y:t.y-e.y};if(i){var o=Math.pow(10,i);n.x=Math.round(n.x*o)/o,n.y=Math.round(n.y*o)/o}if(n.x||n.y)return n},edgeIsDegenerated:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10;return e.distanceToSquared(t)<i},mirrorPointOnPoint:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(i=i||new THREE.Vector2).x=t.x-(e.x-t.x),i.y=t.y-(e.y-t.y),i},fuzzyEqual:p,collinear:function(e,t,i,n,o){var r=p(t.x,n.x,o)&&p(t.y,n.y,o),s=p(t.x,-n.x,o)&&p(t.y,-n.y,o);if(!r&&!s)return!1;var a=i.x-e.x,l=i.y-e.y,h=a*t.x+l*t.y;return Math.abs(h)<o}};function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t,i){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t,i){return t&&k(e.prototype,t),i&&k(e,i),e}var E=1,P=Autodesk.Viewing,T=new DOMParser,C=function(e,t,i){return"rgb("+e+","+t+","+i+")"},L=Math.pow(10,4),A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||null===t)return e;var i=4===t?L:Math.pow(10,t);return Math.round(e*i)/i},V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,e),this.lineColor=t.lineColor||t.color||"rgb(0,0,64)",this.lineAlpha=void 0!==t.lineAlpha?t.lineAlpha:void 0!==t.alpha?t.alpha:1,this.lineWidth=void 0!==t.lineWidth?t.lineWidth:3,this.fillColor=t.fillColor||t.color||"rgb(0,0,64)",this.fillAlpha=void 0!==t.fillAlpha?t.fillAlpha:void 0!==t.alpha?t.alpha:.2,this.lineStyle=t.lineStyle||0,this.isScreenSpace=void 0===t.isScreenSpace||t.isScreenSpace}return w(e,[{key:"setFillColor",value:function(e,t,i){this.fillColor=C(e,t,i)}},{key:"setLineColor",value:function(e,t,i){this.lineColor=C(e,t,i)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.lineColor=e.lineColor,this.lineAlpha=e.lineAlpha,this.lineWidth=e.lineWidth,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.lineStyle=e.lineStyle,this.isScreenSpace=e.isScreenSpace,this}}]),e}();V.toColor=C;var _=new V,I=function(e,t){t.makeEmpty();for(var i=0;i<e.length;i++)t.expandByPoint(e[i])},M=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.clone();S(this,e),this.style=t,this.id=E++,this.bbox=new THREE.Box2,this.bboxDirty=!0,this.name=this.id.toString()}return w(e,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.style=e.style.clone(),this}},{key:"toSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.toSVGPath(e,t);if(i)return'<svg xmlns="http://www.w3.org/2000/svg"><path d="'.concat(i.join(" "),'"/></svg>')}},{key:"toSVGPath",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.error("Must be implemented by derived class.")}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}}],[{key:"fromSVG",value:function(e){if(e){var t=T.parseFromString(e,"application/xml").firstChild;if(!t)throw"svg node was not found";if("svg"!==t.nodeName)throw"Function does only support svg";if(1!==t.childNodes.length)throw"Function does only support svg with a single element: path, circle";var i=t.firstChild;if("circle"===i.nodeName)return B._fromDOMNode(i);if("path"===i.nodeName)return R._fromDOMNode(i);throw"Unsupported svg node type: ".concat(i.nodeName)}}}]),e}();P.GlobalManagerMixin.call(M.prototype);var D=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.clone();return S(this,t),(e=y(this,m(t).call(this,n))).points=i,e}return b(t,e),w(t,[{key:"isPolygon",value:function(){return this instanceof z}},{key:"isPolyline",value:function(){return this instanceof G}},{key:"isPath",value:function(){return this instanceof R}},{key:"addPoint",value:function(e,t){var i={x:e,y:t};return this.points.push(i),this.modified(),i}},{key:"getPoint",value:function(e,t){return(t=t||new THREE.Vector2).copy(this.points[e])}},{key:"removePoint",value:function(e){this.points.splice(e,1)}},{key:"updatePoint",value:function(e,t,i){var n=this.points[e];n.x=t,n.y=i,this.modified()}},{key:"insertPoint",value:function(e,t){this.points.splice(e,0,t)}},{key:"clear",value:function(){this.points.length=0,this.modified()}},{key:"enumEdges",value:function(e){for(var t=this.isPolygon()?this.length:this.length-1,i=0;i<t;i++){var n=i,o=(i+1)%this.length;if(e(this.getPoint(n),this.getPoint(o),n,o))return}}},{key:"findEdgeIndex",value:function(e,t){var i=-1;return this.enumEdges((function(n,o,r){var s=d.isPointOnEdge(e,n,o,t);return s&&(i=r),s})),i}},{key:"move",value:function(e,t){for(var i=0;i<this.points.length;i++)this.points[i].x+=e,this.points[i].y+=t;return this.modified(),this}},{key:"copy",value:function(e){return g(m(t.prototype),"copy",this).call(this,e),this.points=e.points.map((function(e){return{x:e.x,y:e.y}})),this.modified(),this}},{key:"toSVGPath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.length){var i=0,n=function(n,o,r,s){if(!r)return n.push("M ".concat(A(o.x,t),",").concat(A(o.y,t))),n;var a,l,h=s[i],u=d.pointDelta(h,o,t);return u?(Math.abs(u.x)<=e?(a="V",l=A(o.y,t)):Math.abs(u.y)<=e?(a="H",l=A(o.x,t)):(a="L",l="".concat(A(o.x,t),",").concat(A(o.y,t))),n.push("".concat(a," ").concat(l)),i=r,n):n},o=this.points.reduce(n,[]);return this.isPolygon()&&o.push("Z"),o}}},{key:"computeBBox",value:function(){I(this.points,this.bbox)}},{key:"nextIndex",value:function(e){return(e+1)%this.length}},{key:"prevIndex",value:function(e){return(e+this.length-1)%this.length}},{key:"edgeIndexValid",value:function(e){var t=this.getEdgeCount();return e>=0&&e<t}},{key:"getEdge",value:function(e,t,i){var n=e,o=this.nextIndex(e);this.getPoint(n,t),this.getPoint(o,i)}},{key:"getEdgeCount",value:function(){return this.isPolygon()?this.length:this.length-1}},{key:"getLength",value:function(e){for(var t=new THREE.Vector2,i=new THREE.Vector2,n=0,o=0;o<this.getEdgeCount();o++)this.getEdge(o,t,i),e&&e.apply(t),e&&e.apply(i),n+=t.distanceTo(i);return n}},{key:"length",get:function(){return this.points.length}}]),t}(M),z=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.clone();return S(this,t),y(this,m(t).call(this,e,i))}return b(t,e),w(t,[{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n+=1)e.lineTo(this.points[n].x,this.points[n].y);e.closePath();var o=e.canvasContext;o.fillStyle=i.fillColor,o.globalAlpha=i.fillAlpha,e.fill(),o.strokeStyle=i.lineColor,o.globalAlpha=i.lineAlpha,o.lineWidth=i.lineWidth;var r=this.getWindow();i.isScreenSpace&&(o.lineWidth*=r.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"hitTest",value:function(e,t){for(var i=new Autodesk.Extensions.CompGeom.ComplexPolygon(this.points),n=[],o=0;o<this.length;o++)n.push(o);return i.pointInContour(e,t,n)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"getArea",value:function(e){if(this.points.length<3)return 0;var t=0;return this.enumEdges((function(i,n){e&&e.apply(i),e&&e.apply(n),t+=i.x*n.y-n.x*i.y})),Math.abs(.5*t)}}]),t}(D),G=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.clone();return S(this,t),y(this,m(t).call(this,e,i))}return b(t,e),w(t,[{key:"makeLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!==this.length?(this.clear(),this.addPoint(e,t),this.addPoint(i,n)):(this.updatePoint(0,e,t),this.updatePoint(1,i,n)),this}},{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)e.lineTo(this.points[n].x,this.points[n].y);var o=e.canvasContext;o.strokeStyle=i.lineColor,o.globalAlpha=i.lineAlpha,o.lineWidth=i.lineWidth;var r=this.getWindow();i.isScreenSpace&&(o.lineWidth*=r.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"computeBBox",value:function(){I(this.points,this.bbox)}},{key:"hitTest",value:function(e,t,i){return-1!==this.findEdgeIndex({x:e,y:t},i)}}]),t}(D),O=1,R=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.clone();return S(this,t),y(this,m(t).call(this,e,i))}return b(t,e),w(t,[{key:"updatePoint",value:function(e,t,i){var n=this.points[e],o=t-n.x,r=i-n.y;if(this.isBezierArc(e)&&(n.cp1x+=o,n.cp1y+=r),this.length>1){var s=this.prevIndex(e);if(this.isBezierArc(s)){var a=this.points[s];a.cp2x+=o,a.cp2y+=r}}n.x=t,n.y=i,this.modified()}},{key:"setBezierArc",value:function(e,t,i,n,o){var r=this.points[e];r.arcType=O,r.cp1x=t,r.cp1y=i,r.cp2x=n,r.cp2y=o}},{key:"isBezierArc",value:function(e){return this.points[e].arcType===O}},{key:"getControlPoint",value:function(e,t,i){var n=i||new THREE.Vector2,o=this.points[e];return 1===t?(n.x=o.cp1x,n.y=o.cp1y):(n.x=o.cp2x,n.y=o.cp2y),n}},{key:"updateControlPoint",value:function(e,t,i,n){var o=this.points[e];1===t?(o.cp1x=i,o.cp1y=n):(o.cp2x=i,o.cp2y=n),this.modified()}},{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n+=1){var o=this.points[n-1],r=this.points[n];o.arcType===O?e.bezierCurveTo(o.cp1x,o.cp1y,o.cp2x,o.cp2y,r.x,r.y):e.lineTo(r.x,r.y)}var s=this.points[this.points.length-1],a=this.points[0];s.arcType===O?e.bezierCurveTo(s.cp1x,s.cp1y,s.cp2x,s.cp2y,a.x,a.y):e.lineTo(a.x,a.y),e.closePath();var l=e.canvasContext;l.fillStyle=i.fillColor,l.globalAlpha=i.fillAlpha,e.fill(),l.strokeStyle=i.lineColor,l.globalAlpha=i.lineAlpha,l.lineWidth=i.lineWidth,i.isScreenSpace&&(l.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"hitTest",value:function(e,t){for(var i=new Autodesk.Extensions.CompGeom.ComplexPolygon(this.points),n=[],o=0;o<this.length;o++)n.push(o);return i.pointInContour(e,t,n)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){g(m(t.prototype),"copy",this).call(this,e);for(var i=0;i<e.points.length;i++)if(e.isBezierArc(i)){var n=e.points[i],o=this.points[i];o.arcType=n.arcType,o.cp1x=n.cp1x,o.cp1y=n.cp1y,o.cp2x=n.cp2x,o.cp2y=n.cp2y}return this}},{key:"toSVGPath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.length)return[];var i=[];i.push("M ".concat(A(this.points[0].x,t),",").concat(A(this.points[0].y,t)));for(var n=1;n<this.points.length;n+=1){var o=this.points[n-1],r=this.points[n],s=void 0;if(o.arcType===O)s="C ".concat(A(o.cp1x,t),",").concat(A(o.cp1y,t),",").concat(A(o.cp2x,t),",").concat(A(o.cp2y,t),",").concat(A(r.x,t),",").concat(A(r.y,t));else{var a=d.pointDelta(o,r,t);if(!a)continue;s=Math.abs(a.x)<=e?"V ".concat(A(r.y,t)):Math.abs(a.y)<=e?"H ".concat(A(r.x,t)):"L ".concat(A(r.x,t),",").concat(A(r.y,t))}i.push(s)}var l=this.points[this.points.length-1];if(l.arcType===O){var h=this.points[0],u="C ".concat(A(l.cp1x,t),",").concat(A(l.cp1y,t),",").concat(A(l.cp2x,t),",").concat(A(l.cp2y,t),",").concat(A(h.x,t),",").concat(A(h.y,t));i.push(u)}return i.push("Z"),i}},{key:"move",value:function(e,i){g(m(t.prototype),"move",this).call(this,e,i);for(var n=0;n<this.points.length;n++)if(this.isBezierArc(n)){var o=this.points[n];o.cp1x+=e,o.cp1y+=i,o.cp2x+=e,o.cp2y+=i}return this.modified(),this}}],[{key:"_fromDOMNode",value:function(e){var i=e.getAttribute("d");if(i){var n=t._parsePath(i),o=n.points,r=n.isPolygon;return o.find((function(e){return void 0!==e.arcType}))?new t(o):r?new z(o):new G(o)}}},{key:"_parsePath",value:function(e){for(var t,i=e.split(/ (?=[a-zA-Z])/gi),n={x:0,y:0},o=[],r=!1,s=0;s<i.length;s++){var a=i[s];if(!"MLHVCZ".contains(a[0]))throw'"'.concat(a[0],'" is not a supported or invalid glyph: ').concat(a);var l=a.substring(1);switch(a[0]){case"M":case"L":var h=l.split(",");t={x:parseFloat(h[0]),y:parseFloat(h[1])},"M"===a[0]&&o.shift();break;case"H":t={x:parseFloat(l),y:n.y};break;case"V":t={x:n.x,y:parseFloat(l)};break;case"C":var u=l.split(",");t={x:parseFloat(u[4]),y:parseFloat(u[5])},n.arcType=O,n.cp1x=parseFloat(u[0]),n.cp1y=parseFloat(u[1]),n.cp2x=parseFloat(u[2]),n.cp2y=parseFloat(u[3]);break;case"Z":r=!0;continue}n=t,o.push(t)}return d.pointDelta(o[0],o[o.length-1],0)||o.pop(),{points:o,isPolygon:r}}}]),t}(D),B=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.clone(),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return S(this,t),(e=y(this,m(t).call(this,r))).polygon=new z([],r),e.polygon.id=e.id,e.centerX=i,e.centerY=n,e.radius=o,e.tessSegments=s,e.needsUpdate=!0,e}return b(t,e),w(t,[{key:"draw",value:function(e,t){this.polygon.points.length=0;for(var i=360/this.tessSegments,n=0;n<360;n+=i){var o=n*Math.PI/180,r=this.radius*Math.cos(o),s=this.radius*Math.sin(o);this.polygon.addPoint(this.centerX+r,this.centerY+s)}this.needsUpdate=!1,this.polygon.draw(e,t)}},{key:"setCenter",value:function(e,t){this.centerX=e,this.centerY=t,this.modified()}},{key:"move",value:function(e,t){this.centerX+=e,this.centerY+=t,this.modified()}},{key:"hitTest",value:function(e,t){var i=e-this.centerX,n=t-this.centerY;return i*i+n*n<this.radius*this.radius}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){return g(m(t.prototype),"copy",this).call(this,e),this.polygon=e.polygon.clone(),this.centerX=e.centerX,this.centerY=e.centerY,this.radius=e.radius,this.tessSegments=e.tessSegments,this.modified(),this}},{key:"toSVG",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return'<svg xmlns="http://www.w3.org/2000/svg"><circle cx="'.concat(A(this.centerX,e),'" cy="').concat(A(this.centerY,e),'" r="').concat(A(this.radius,e),'"/></svg>')}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}],[{key:"_fromDOMNode",value:function(e){if(!e.hasAttributes||!e.hasAttributes())throw"No attributes available on the <circle/> node";for(var i=new t,n=e.attributes.length-1;n>=0;n--){var o=e.attributes[n];switch(o.name){case"cx":i.centerX=parseFloat(o.value);break;case"cy":i.centerY=parseFloat(o.value);break;case"r":i.radius=parseFloat(o.value)}}return i}}]),t}(M),H=function(e){function t(e){var i;return S(this,t),(i=y(this,m(t).call(this))).shape=e,Object.defineProperty(v(i),"bbox",{get:function(){return i.shape.bbox},set:function(e){i.shape.bbox=e}}),Object.defineProperty(v(i),"id",{get:function(){return i.shape.id},set:function(e){i.shape.id=e}}),Object.defineProperty(v(i),"bboxDirty",{get:function(){return i.shape.bboxDirty},set:function(e){i.shape.bboxDirty=e}}),Object.defineProperty(v(i),"name",{get:function(){return i.shape.name},set:function(e){i.shape.name=e}}),i}return b(t,e),w(t,[{key:"draw",value:function(){var e;return(e=this.shape).draw.apply(e,arguments)}},{key:"hitTest",value:function(){var e;return(e=this.shape).hitTest.apply(e,arguments)}},{key:"move",value:function(){var e;return(e=this.shape).move.apply(e,arguments)}},{key:"modified",value:function(){var e;return(e=this.shape).modified.apply(e,arguments)}},{key:"computeBBox",value:function(){var e;return(e=this.shape).computeBBox.apply(e,arguments)}},{key:"updateBBox",value:function(){var e;return(e=this.shape).updateBBox.apply(e,arguments)}},{key:"clone",value:function(){return new t(this.shape.clone())}},{key:"copy",value:function(e){this.shape.copy(e.shape)}}]),t}(M);function j(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var N=Autodesk.Viewing,U=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),N.EventDispatcher.prototype.apply(this),this.stack=[],this.current=0}var t,i,n;return t=e,(i=[{key:"run",value:function(t){this.stack.length=this.current,this.dispatchEvent({type:e.BEFORE_ACTION,action:t}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t}),this.stack.push(t),this.current=this.stack.length}},{key:"undo",value:function(){if(!this.current)return!1;this.current--;var t=this.stack[this.current];return this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!0}),t.undo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!0}),t.layer.update(),!0}},{key:"redo",value:function(){var t=this.stack[this.current];return!!t&&(this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!1}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!1}),this.current++,t.layer.update(),!0)}},{key:"clear",value:function(){this.stack.length=0,this.current=0}}])&&j(t.prototype,i),n&&j(t,n),e}();function F(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}U.BEFORE_ACTION="beforeAction",U.AFTER_ACTION="afterAction";var K=Autodesk.Viewing,W=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),K.EventDispatcher.prototype.apply(this),this.isSelected={},this.tmpStyle=new V,this.modifier=function(e,t){if(n.isSelected[e.id])return n.tmpStyle.copy(t),n.tmpStyle.fillAlpha=Math.min(n.tmpStyle.fillAlpha+.3,1),n.tmpStyle.lineWidth*=1.5,n.tmpStyle},this.layer=t,this.layer.addStyleModifier(this.modifier),this.undoStack=i,this.onActionCb=function(e){return n.onAction(e)},this.undoStack.addEventListener(U.AFTER_ACTION,this.onActionCb)}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.layer.removeStyleModifier(this.modifier),this.undoStack.removeEventListener(U.AFTER_ACTION,this.onActionCb)}},{key:"setSelection",value:function(e){e=e||[];var t=!1;if(this.getSelectedShapes().length!=e.length)t=!0;else for(var i=0;i<e.length;i++){var n=e[i];this.isSelected[n.id]||(t=!0)}if(t){this.isSelected={};for(var o=0;o<e.length;o++){var r=e[o];this.isSelected[r.id]=r}this.modified()}}},{key:"empty",value:function(){return!Object.keys(this.isSelected).length}},{key:"selectOnly",value:function(e){this.setSelection(e&&[e])}},{key:"clear",value:function(){this.setSelection([])}},{key:"getSelectedShapes",value:function(){return Object.values(this.isSelected)}},{key:"getSelectedIds",value:function(){return Object.keys(this.isSelected)}},{key:"modified",value:function(){this.layer.update(),this.dispatchEvent({type:e.Events.SELECTION_CHANGED})}},{key:"onAction",value:function(){if(!this.empty()){var e=this.getSelectedShapes();if(1!=e.length){var t={};this.layer.shapes.forEach((function(e){return t[e.id]=!0})),e=e.filter((function(e){return t[e.id]})),this.setSelection(e)}else this.layer.findShapeById(e[0].id)||this.clear()}}}])&&F(t.prototype,i),n&&F(t,n),e}();function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t){return!t||"object"!==Y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ee(e,t,i){return t&&J(e.prototype,t),i&&J(e,i),e}W.Events={SELECTION_CHANGED:"selectionChanged"};var te=function(){function e(t){$(this,e),this.layer=t}return ee(e,[{key:"undo",value:function(){throw new Error("Abstract method invoked")}},{key:"redo",value:function(){throw new Error("Abstract method invoked")}}]),e}(),ie={Action:te,AddShape:function(e){function t(e,i){var n;return $(this,t),(n=X(this,q(t).call(this,e))).shape=i,n}return Z(t,e),ee(t,[{key:"undo",value:function(){this.layer.removeShape(this.shape)}},{key:"redo",value:function(){this.layer.addShape(this.shape)}}]),t}(te),AddShapes:function(e){function t(e,i){var n;return $(this,t),(n=X(this,q(t).call(this,e))).shapes=i,n}return Z(t,e),ee(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}}]),t}(te),MoveShape:function(e){function t(e,i,n,o){var r;return $(this,t),(r=X(this,q(t).call(this,e))).shape=i,r.delta={x:n,y:o},r.beforeState=r.shape.clone(),r.afterState=r.shape.clone(),r.afterState.move(n,o),r}return Z(t,e),ee(t,[{key:"undo",value:function(){this.shape.copy(this.beforeState)}},{key:"redo",value:function(){this.shape.copy(this.afterState)}}]),t}(te),RemoveShape:function(e){function t(e,i){var n;return $(this,t),(n=X(this,q(t).call(this,e))).shape=i,n}return Z(t,e),ee(t,[{key:"undo",value:function(){this.layer.addShape(this.shape)}},{key:"redo",value:function(){this.layer.removeShape(this.shape)}}]),t}(te),RemoveShapes:function(e){function t(e,i){var n;return $(this,t),(n=X(this,q(t).call(this,e))).shapes=i,n}return Z(t,e),ee(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}}]),t}(te),AddVertex:function(e){function t(e,i,n,o){var r;return $(this,t),(r=X(this,q(t).call(this,e))).poly=i,r.vIndex=n,r.point=o.clone(),r}return Z(t,e),ee(t,[{key:"undo",value:function(){this.poly.removePoint(this.vIndex)}},{key:"redo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}}]),t}(te),MoveVertex:function(e){function t(e,i,n,o){var r;return $(this,t),(r=X(this,q(t).call(this,e))).poly=i,r.vIndex=n,r.posBefore=i.getPoint(n),r.posAfter=o.clone(),r}return Z(t,e),ee(t,[{key:"undo",value:function(){this.poly.updatePoint(this.vIndex,this.posBefore.x,this.posBefore.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.vIndex,this.posAfter.x,this.posAfter.y)}}]),t}(te),RemoveVertex:function(e){function t(e,i,n){var o;return $(this,t),(o=X(this,q(t).call(this,e))).poly=i,o.vIndex=n,o.point=i.getPoint(n),o}return Z(t,e),ee(t,[{key:"undo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}},{key:"redo",value:function(){this.poly.removePoint(this.vIndex)}}]),t}(te),MoveEdge:function(e){function t(e,i,n,o,r){var s;$(this,t),(s=X(this,q(t).call(this,e))).poly=i,s.ia=n,s.ib=(n+1)%i.length;var a=i.getPoint(s.ia),l=i.getPoint(s.ib);return s.edgeBefore={a:a,b:l},s.edgeAfter={a:o.clone(),b:r.clone()},s}return Z(t,e),ee(t,[{key:"undo",value:function(){this.poly.updatePoint(this.ia,this.edgeBefore.a.x,this.edgeBefore.a.y),this.poly.updatePoint(this.ib,this.edgeBefore.b.x,this.edgeBefore.b.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.ia,this.edgeAfter.a.x,this.edgeAfter.a.y),this.poly.updatePoint(this.ib,this.edgeAfter.b.x,this.edgeAfter.b.y)}}]),t}(te)};function ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e,t,i){return t&&oe(e.prototype,t),i&&oe(e,i),e}var se=function(){function e(t,i){ne(this,e),this.a=t.clone(),this.b=i.clone(),this.dir=d.getEdgeDirection(t,i)}return re(e,[{key:"intersect",value:function(e,t){return d.intersectLines(this.a,this.dir,e.a,e.dir,t)}},{key:"snapToLine",value:function(e){d.projectToLine(e,this.a,this.dir)}},{key:"isUsable",value:function(e,t){return d.pointLineDistance(e,this.a,this.dir)<t}},{key:"isEqual",value:function(e,t){return d.collinear(this.a,this.dir,e.a,e.dir,t)}}]),e}(),ae=function(e,t,i){(t||i)&&(i?t?t.intersect(i,e):i.snapToLine(e):t.snapToLine(e))},le=function(e,t){return t=(t+e.length)%e.length,e.getPoint(t)},he=function(e,t){var i=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,r=[];return e.enumEdges((function(e,s,a,l){a!=t&&l!=t&&(d.edgeIsDegenerated(e,s)||function(e,t){r.push(new se(e,t)),i=d.turnLeft(d.getEdgeDirection(e,t,i)),n=d.getEdgeCenter(e,t,n),o.copy(e).add(i),r.push(new se(e,o)),o.copy(n).add(i),r.push(new se(n,o)),o.copy(t).add(i),r.push(new se(t,o))}(e,s))})),r},ue=function(e,t,i,n,o){var r=new THREE.Vector2;return i.intersect(e,r)?r.distanceTo(n)>o?t:t?Math.abs(i.dir.dot(e.dir))>Math.abs(i.dir.dot(t.dir))?e:t:e:t},ce=new THREE.Vector2(1,0),pe=Autodesk.Viewing,de=function(){function e(t){ne(this,e),this.poly=null,this.vIndex=-1,this.snapAngles=[0,45,90,135,180,225,270,315,360],this.snapAngleTolerance=2,this.snapRadius=10,this.gizmoLayer=t,this.setGlobalManager(t.globalManager),this.movedPoint=new THREE.Vector2,this.prevPoint=new THREE.Vector2,this.prevPoint2=new THREE.Vector2,this.edgeDir=new THREE.Vector2,this.alignAxis=new THREE.Vector2,this.edgeSnapLines=[],this.snapLine1=null,this.snapLine2=null,this.snapLineExt=null,this.snapLineStyle=new V({lineColor:"rgb(255, 0, 0)",lineWidth:1,lineStyle:10}),this.snapLineGizmos=[],this.snapLineGizmosUsed=0}return re(e,[{key:"onSetGlobalManager",value:function(e){this.globalManager=e,this.snapLineGizmos.forEach((function(t){return t.setGloblaManager(e)}))}},{key:"acquireSnapLineGizmo",value:function(){var e=this.snapLineGizmos[this.snapLineGizmosUsed];return e||((e=new G([],this.snapLineStyle)).setGlobalManager(this.globalManager),this.snapLineGizmos[this.snapLineGizmosUsed]=e),this.snapLineGizmosUsed++,e}},{key:"clearSnappingGizmos",value:function(){var e=this;this.snapLineGizmos.forEach((function(t){return e.gizmoLayer.removeShape(t)})),this.snapLineGizmosUsed=0}},{key:"startSnapping",value:function(e,t){this.poly=e,this.vIndex=t,this.edgeSnapLines=he(e,t)}},{key:"stopSnapping",value:function(){this.poly=null,this.vIndex=-1,this.snapLine1=null,this.snapLine2=null,this.clearSnappingGizmos()}},{key:"clearSnappingResult",value:function(){this.snapLine1=null,this.snapLine2=null}},{key:"getPrevSnapLine",value:function(e){var t=le(this.poly,this.vIndex-1),i=le(this.poly,this.vIndex-2),n=d.getEdgeDirection(i,t);return this.computeAngleSnapLine(e,t,n)}},{key:"getNextSnapLine",value:function(e){if(this.poly.isPolyline()&&this.vIndex>=this.poly.length-2)return null;var t=le(this.poly,this.vIndex+1),i=le(this.poly,this.vIndex+2),n=d.getEdgeDirection(t,i,n);return this.computeAngleSnapLine(e,t,n)}},{key:"snapToAngle",value:function(e,t){var i=this;if(this.snapLine1=null,this.snapLine2=null,this.snapLineExt=t&&new se(t.a,t.b),this.active&&!(this.poly.length<=1)){var n=le(this.poly,this.vIndex-1);if(2==this.poly.length){var o=this.computeAngleSnapLine(e,n,ce);return o&&this.snapLineExt?this.snapLine1=ue(o,null,this.snapLineExt,e,a):this.snapLine1=o,void ae(e,this.snapLine1,this.snapLineExt)}var r=this.getPrevSnapLine(e),s=this.getNextSnapLine(e),a=this.snapRadius*this.gizmoLayer.getUnitsPerPixel(),l=function(t){return!!t&&(i.snapLineExt?Boolean(ue(t,null,i.snapLineExt,e,a)):t.isUsable(e,a))},h=this.edgeSnapLines.filter(l);if(r=l(r)&&r,s=l(s)&&s,this.snapLine1=r||s||h[0],this.snapLine1){if(this.snapLineExt)return ae(e,this.snapLine1,this.snapLineExt);if(r&&s&&(this.snapLine2=ue(s,null,this.snapLine1,e,a)),!this.snapLine2)for(var u=0;u<h.length;u++){var c=h[u];this.snapLine2=ue(c,this.snapLine2,this.snapLine1,e,a)}return ae(e,this.snapLine1,this.snapLine2)}}}},{key:"isSnapped",value:function(){return Boolean(this.snapLine1||this.snapLine2)}},{key:"updateSnapLineGizmos",value:function(e){var t=this;if(this.clearSnappingGizmos(),this.poly){var i=[],n=function(t){return t&&t.isUsable(e,1e-4)};if(2==this.poly.length){var o=le(this.poly,this.vIndex-1),r=this.computeAngleSnapLine(e,o,ce);r&&n(r)&&i.push(r)}else{i=this.edgeSnapLines.filter(n);var s=this.getPrevSnapLine(e),a=this.getNextSnapLine(e);n(s)&&i.push(s),n(a)&&i.push(a)}i=i.filter((function(e,t){for(var n=!1,o=0;o<t;o++){var r=i[o];if(e.isEqual(r,1e-4)){n=!0;break}}return!n}));for(var l=this.gizmoLayer.viewport.width,h=this.gizmoLayer.viewport.height,u=Math.sqrt(l*l+h*h),c=function(e,i){if(e){var n=e.a;i.makeLine(n.x-u*e.dir.x,n.y-u*e.dir.y,n.x+u*e.dir.x,n.y+u*e.dir.y),t.gizmoLayer.addShape(i)}},p=0;p<i.length;p++){c(i[p],this.acquireSnapLineGizmo())}}}},{key:"dtor",value:function(){this.clearSnapping()}},{key:"computeAngleSnapLine",value:function(e,t,i){if(d.edgeIsDegenerated(t,e))return null;for(var n=e.clone().sub(t),o=THREE.Math.radToDeg(d.angleBetweenDirections(n,i)),r=-1,s=0;s<this.snapAngles.length;s++){var a=this.snapAngles[s];if(Math.abs(a-o)<this.snapAngleTolerance){r=s;break}}if(-1==r)return null;var l=THREE.Math.degToRad(this.snapAngles[r]),h=d.rotateAround(i.clone(),l),u=t.distanceTo(e),c=h.multiplyScalar(u).add(t);return new se(t,c)}},{key:"active",get:function(){return this.poly}}]),e}();function fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ve(e,t,i){return t&&ye(e.prototype,t),i&&ye(e,i),e}pe.GlobalManagerMixin.call(de.prototype);var ge={Line:1,CircularArc:2,EllipticalArc:3},me=function(e,t,i,n,o){return{type:ge.Line,x1:e,y1:t,x2:i,y2:n,vpId:o}},be=function(e,t,i,n,o,r){return{type:ge.CirularArc,cx:e,cy:t,start:i,end:n,radius:o,vpId:r}},xe=function(e,t,i,n,o,r,s,a){return{type:ge.EllipticalArc,cx:e,cy:t,start:i,end:n,major:o,minor:r,tilt:s,vpId:a}},Se=function(e,t){switch(e.type){case ge.Line:t.onLineSegment(e.x1,e.y1,e.x2,e.y2,e.vpId);break;case ge.CirularArc:t.onCircularArc(e.cx,e.cy,e.start,e.end,e.radius,e.vpId);break;case ge.EllipticalArc:t.onEllipticalArc(e.cx,e.cy,e.tart,e.end,e.major,e.minor,e.tilt,e.vpId)}},ke=function(){function e(){fe(this,e),this.boundsCb=new Autodesk.Viewing.Private.BoundsCallback(new THREE.Box2),this.queryBox=new THREE.Box2,this.tmpPoint=new THREE.Vector2}return ve(e,[{key:"getSegmentBox",value:function(e){return this.boundsCb.bounds.makeEmpty(),Se(e,this.boundsCb),this.boundsCb.bounds}},{key:"getQueryBox",value:function(e,t,i,n){return this.queryBox.min.set(e,t),this.queryBox.max.set(i,n),this.queryBox}},{key:"intersectsBox",value:function(e,t,i,n,o){var r=this.getQueryBox(t,i,n,o),s=this.getSegmentBox(e);return r.isIntersectionBox(s)}},{key:"getPoint",value:function(e,t){var i=this.getSegmentBox(e).center(this.tmpPoint);t.x=i.x,t.y=i.y}}]),e}(),we=function(){function e(){fe(this,e)}return ve(e,[{key:"buildFromModel",value:function(e){var t=e.getBoundingBox();this.tree=new Autodesk.Extensions.CompGeom.QuadTree(t.min.x,t.min.y,t.max.x,t.max.y,0,new ke);for(var i=e.getFragmentList(),n=i.getCount(),o=0;o<n;o++){var r=i.getGeometry(o);this.addGeometry(r)}}},{key:"addGeometry",value:function(e){var t=this,i={onLineSegment:function(){return t.tree.addItem(me.apply(void 0,arguments))},onCircularArc:function(){return t.tree.addItem(be.apply(void 0,arguments))},onEllipticalArc:function(){return t.tree.addItem(xe.apply(void 0,arguments))}};new Autodesk.Viewing.Private.VertexBufferReader(e).enumGeoms(null,i)}},{key:"enumSegments",value:function(e,t,i,n,o){this.tree.enumInBox(e,t,i,n,(function(e){return Se(e,o)}))}}]),e}();function Ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pe=Autodesk.Viewing.MeasureCommon.SnapType,Te=Autodesk.Viewing,Ce=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.setGlobalManager(t.globalManager),this.layer=i,this.gizmoLayer=n,this.sheetSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.layerSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.angleSnapper=new de(n),this.snapBox=new THREE.Box2,this.sheetSnapper.activate(),this.layerSnapper.activate(),this.onCameraChangeCb=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb),this.initSegmentTrees()}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.sheetSnapper.deactivate(),this.layerSnapper.deactivate(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb)}},{key:"onCameraChange",value:function(){this.updateSnapperIndicators()}},{key:"initSegmentTrees",value:function(){var e=this;this.viewer.getVisibleModels().forEach((function(t){var i=!(!t.myData||!t.myData.isLeaflet);t.is2d()&&!i&&!t.segmentTree&&t.isLoadDone()&&(t.segmentTree=new we(e.viewer.impl.use2dInstancing),t.segmentTree.buildFromModel(t))}))}},{key:"updateSnapperIndicators",value:function(){this.sheetSnapper.isSnapped()?this.sheetSnapper.indicator.render():this.layerSnapper.indicator.render()}},{key:"getSnapPosition",value:function(e,t,i){var n=this._getSnapPosition(e,t,i);return this.angleSnapper.updateSnapLineGizmos(n),this.updateSnapperIndicators(),n}},{key:"clearSnappingGizmos",value:function(){this.angleSnapper.clearSnappingGizmos(),this.sheetSnapper.clearSnapped(),this.sheetSnapper.indicator&&this.sheetSnapper.indicator.clearOverlays(),this.layerSnapper.clearSnapped(),this.layerSnapper.indicator&&this.layerSnapper.indicator.clearOverlays()}},{key:"startAngleSnapping",value:function(e,t){this.angleSnapper.startSnapping(e,t)}},{key:"stopAngleSnapping",value:function(){this.angleSnapper.stopSnapping()}},{key:"_getSnapPosition",value:function(e,t,i){this.angleSnapper.clearSnappingResult(),this.sheetSnapper.clearSnapped(),this.layerSnapper.clearSnapped();var n=this.layer.canvasToLayer(e,t),o=this._getGeomSnapPosition(e,t,i),r=this._getGeomSnapLine();if(o&&!r)return o;if(this.angleSnapper.snapToAngle(n,r),r&&!this.angleSnapper.isSnapped())return o;if(r&&this.angleSnapper.isSnapped()){var s=this._getGeomSnapResult();s.geomType=Pe.SNAP_INTERSECTION,s.snapPoint=n.clone(),s.geomVertex=s.snapPoint}return n}},{key:"_getGeomSnapPosition",value:function(e,t,i){var n=this.layer.canvasToLayer(e,t),o=this._getSheetSnapPosition(e,t),r=this._getEditLayerSnapPosition(e,t,i);return o||r?r?o?THREE.Vector2.prototype.distanceToSquared.call(o,n)<THREE.Vector2.prototype.distanceToSquared.call(r,n)?(this.layerSnapper.clearSnapped(),o):(this.sheetSnapper.clearSnapped(),r):r:o:null}},{key:"_getGeomSnapResult",value:function(){var e=this.sheetSnapper.isSnapped(),t=this.layerSnapper.isSnapped();return e||t?(e?this.sheetSnapper:this.layerSnapper).getSnapResult():null}},{key:"_getGeomSnapLine",value:function(){var e=this._getGeomSnapResult();if(!e)return null;if(e.geomEdge){var t=e.geomEdge.vertices;return{a:t[0],b:t[1]}}return null}},{key:"_getEditLayerSnapPosition",value:function(e,t,i){var n=this.viewer.impl.intersectGround(e,t),o=this.layerSnapper.setDetectRadius(n);this.snapBox.min.set(n.x-o,n.y-o),this.snapBox.max.set(n.x+o,n.y+o);var r={};this.layer.enumShapes(this.snapBox,(function(e){i&&!i(e)||(r[e.id]=!0)}));var s=[];if(this.layer.enumMeshes(this.snapBox,(function(e){return s.push(e)})),this.layerSnapper.clearSnapped(),this.layerSnapper.snapping2DOverlay(n,s,(function(e){return Boolean(r[e])})),this.layerSnapper.isSnapped()){var a=this.layerSnapper.getSnapResult();return Autodesk.Viewing.MeasureCommon.getSnapResultPosition(a,this.viewer)}}},{key:"_getSheetSnapPosition",value:function(e,t){var i=this;this.initSegmentTrees();var n=this.viewer.impl.intersectGround(e,t);if(this.sheetSnapper.snapping2DWithSegmentEnum(n,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=i.viewer.getVisibleModels();o.forEach((function(e){var i;e.is2d()&&e.segmentTree&&(i=e.segmentTree).enumSegments.apply(i,t)}))})),this.sheetSnapper.isSnapped()){var o=this.sheetSnapper.getSnapResult(),r=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(o,this.viewer);return(new THREE.Vector2).copy(r)}}}])&&Ee(t.prototype,i),n&&Ee(t,n),e}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function De(e,t,i){return t&&Me(e.prototype,t),i&&Me(e,i),e}Te.GlobalManagerMixin.call(Ce.prototype);var ze=function(){function e(){Ie(this,e)}return De(e,[{key:"apply",value:function(e){}}]),e}(),Ge=function(e){function t(e){var i;return Ie(this,t),(i=Ae(this,Ve(t).call(this))).viewer=e,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(t,e),De(t,[{key:"apply",value:function(e){var t=this.viewer.model;if(t){var i=function(e){var t=e.getData().viewports;if(!t)return-1;for(var i=-1,n=-1,o=0;o<t.length;o++){var r=t[o];if(r.transform){var s=r.geom_metrics.db_ids;s>n&&(i=o,n=s)}}return i}(t);t.pageToModel(e,null,i)}}}]),t}(ze);function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t,i){return(Re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=He(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function Be(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function je(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ne(e,t)}function Ne(e,t){return(Ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ke(e,t,i){return t&&Fe(e.prototype,t),i&&Fe(e,i),e}var We=Autodesk.Viewing.Private,Ye=function(){function e(){Ue(this,e),this.measureTransform=null}return Ke(e,[{key:"lengthToString",value:function(e){console.error("Not implemented")}},{key:"areaToString",value:function(e){console.error("Not implemented")}}]),e}(),Xe=2,qe="inch",Ze=function(e){function t(e){var i;return Ue(this,t),(i=Be(this,He(t).call(this,e))).measureTransform=new Ge(e),i}return je(t,e),Ke(t,[{key:"updateConfig",value:function(){var e=this.config,t=this.viewer.model;e.layerUnits=t?t.getUnitString():qe;var i=this.viewer.getExtension("Autodesk.Measure"),n=i&&i.sharedMeasureConfig;n?(e.displayUnits=n.units,e.precision=n.precision,e.scaleFactor=n.calibrationFactor):(e.displayUnits=this.config.layerUnits,e.precision=Xe,e.scaleFactor=1)}},{key:"lengthToString",value:function(e){return this.updateConfig(),Re(He(t.prototype),"lengthToString",this).call(this,e)}},{key:"areaToString",value:function(e){return this.updateConfig(),Re(He(t.prototype),"areaToString",this).call(this,e)}}]),t}(function(e){function t(e){var i;return Ue(this,t),(i=Be(this,He(t).call(this))).viewer=e,i.config={layerUnits:qe,displayUnits:qe,precision:Xe,scaleFactor:1},i}return je(t,e),Ke(t,[{key:"lengthToString",value:function(e){var t=this.config;return e=We.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e),We.formatValueWithUnits(e,t.displayUnits,3,t.precision)}},{key:"areaToString",value:function(e){var t=this.config;e=We.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e,"square");var i=t.displayUnits?"".concat(t.displayUnits,"^2"):null;return We.formatValueWithUnits(e,i,3,t.precision)}}]),t}(Ye));function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t,i){return($e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tt(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function Je(e,t){return!t||"object"!==Qe(t)&&"function"!=typeof t?et(e):t}function et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function it(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ot(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function st(e,t,i){return t&&rt(e.prototype,t),i&&rt(e,i),e}var at=function(e){return e.toString()+"px"},lt={Left:1,Center:2,Right:3},ht={Top:1,Center:2,Bottom:3},ut=Autodesk.Viewing,ct=function(){function e(){ot(this,e)}return st(e,[{key:"update",value:function(){}}]),e}();ut.GlobalManagerMixin.call(ct.prototype);var pt=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];ot(this,t),(i=Je(this,tt(t).call(this))).layer=e,i.setGlobalManager(e.globalManager),i.layerPos=new THREE.Vector2,i.canvasPos=new THREE.Vector2;var o=i.getDocument();return i.container=o.createElement("div"),i.container.style.position="absolute",i.container.style.transformOrigin="50% 50%",i.visible=!1,i.alignX=lt.Center,i.alignY=ht.Center,i.angle=0,n&&i.setVisible(!0,!1),i.isUnderMouse=!1,i.container.addEventListener("mouseenter",(function(){return i.isUnderMouse=!0})),i.container.addEventListener("mouseleave",(function(){return i.isUnderMouse=!1})),i}return it(t,e),st(t,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setVisible",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e!=this.visible&&(e?(this.layer.viewer.canvasWrap.appendChild(this.container),this.layer.addCanvasGizmo(this),t&&this.update()):(this.layer.viewer.canvasWrap.removeChild(this.container),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"setAlignX",value:function(e){this.alignX=e,this.update()}},{key:"setAlignY",value:function(e){this.alignY=e,this.update()}},{key:"setRotation",value:function(e){this.angle=e,this.update()}},{key:"update",value:function(){this.canvasPos.copy(this.layer.layerToCanvas(this.layerPos.x,this.layerPos.y));var e,t,i=this.canvasPos,n=this.container.style;switch(n.left=at(i.x),n.top=at(i.y),this.alignX){case lt.Left:e="0%";break;case lt.Center:e="-50%";break;case lt.Right:e="-100%"}switch(this.alignY){case ht.Top:t="0%";break;case ht.Center:t="-50%";break;case ht.Bottom:t="-100%"}n.transform="translate(".concat(e,", ").concat(t,") rotate(").concat(this.angle,"deg)")}},{key:"setPosition",value:function(e,t){this.layerPos.set(e,t),this.update()}},{key:"setClassEnabled",value:function(e,t){t?this.container.classList.add(e):this.container.classList.remove(e)}},{key:"setSelected",value:function(e){this.setClassEnabled("selected",e)}},{key:"isSelected",value:function(){return this.container.classList.contains("selected")}},{key:"setHoverEnabled",value:function(e){this.setClassEnabled("enable-hover",e)}},{key:"setName",value:function(e){this.name=e,this.container.id=e||""}}]),t}(ct),dt=function(e){e.container.classList.add("measure-length"),e.container.classList.add("visible");var t=e.getDocument();e.textDiv=t.createElement("div"),e.textDiv.classList.add("measure-length-text"),e.container.appendChild(e.textDiv),e.setText=function(e){this.textDiv.textContent=e}.bind(e)},ft=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ot(this,t),n=Je(this,tt(t).call(this,i,o)),dt(et(n)),n.shape=e,n.valueValid=!0,n.update(),n}return it(t,e),st(t,[{key:"update",value:function(){if(this.shape&&this.valueValid){if(this.container.style.visibility="visible",this.shape.isPolyline()){var e=this.shape.getEdgeCount(),i=Math.floor(e/2);if(this.shape.edgeIndexValid(i)){var n=new THREE.Vector2,o=new THREE.Vector2;this.shape.getEdge(i,n,o),this.layerPos.set(.5*(n.x+o.x),.5*(n.y+o.y))}}else this.shape.computeBBox(),this.shape.bbox.center(this.layerPos);$e(tt(t.prototype),"update",this).call(this)}else this.container.style.visibility="hidden"}},{key:"setShape",value:function(e){this.shape=e,this.update()}}]),t}(pt),yt=function(e){function t(e,i,n){var o,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return ot(this,t),(o=Je(this,tt(t).call(this,e,i,r))).unitHandler=n,o}return it(t,e),st(t,[{key:"update",value:function(){var e=this.shape&&this.shape.getLength&&this.shape.getLength(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var i=this.unitHandler.lengthToString(e);this.setText(i)}$e(tt(t.prototype),"update",this).call(this)}}]),t}(ft),vt=function(e){function t(e,i,n){var o,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return ot(this,t),(o=Je(this,tt(t).call(this,e,i,r))).unitHandler=n,o}return it(t,e),st(t,[{key:"update",value:function(){var e=this.shape&&this.shape.getArea&&this.shape.getArea(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var i=this.unitHandler.areaToString(e);this.setText(i)}$e(tt(t.prototype),"update",this).call(this)}}]),t}(ft),gt=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ot(this,t),(i=Je(this,tt(t).call(this,e,n))).posA=new THREE.Vector2,i.posB=new THREE.Vector2,i.posValid=!1,i.edgeDir=new THREE.Vector2,i.poly=null,i.edgeIndex=0,i.container.classList.add("edge-gizmo"),i.maxRelativeLength=void 0,i}return it(t,e),st(t,[{key:"attachToEdge",value:function(e,t){this.poly=e,this.edgeIndex=t,this.update()}},{key:"detachFromEdge",value:function(){this.poly=null,this.edgeIndex=-1,this.posValid=!1,this.update()}},{key:"update",value:function(){this.poly&&this.poly.edgeIndexValid(this.edgeIndex)&&(this.poly.getEdge(this.edgeIndex,this.posA,this.posB),this.posValid=!0);var e=this._shouldBeShown();this.container.style.visibility=e?"visible":"hidden",e&&(this.layerPos.set(.5*(this.posA.x+this.posB.x),.5*(this.posA.y+this.posB.y)),this._updateRotation(),$e(tt(t.prototype),"update",this).call(this))}},{key:"_shouldBeShown",value:function(){if(!this.posValid)return!1;if(this.maxRelativeLength){var e=this.layer.layerToCanvas(this.posA.x,this.posA.y),t=this.layer.layerToCanvas(this.posB.x,this.posB.y),i=e.distanceTo(t)*this.maxRelativeLength,n=this.getWindow();return parseFloat(n.getComputedStyle(this.container).width)<i}return!0}},{key:"_updateRotation",value:function(){var e=d.getEdgeDirection(this.posA,this.posB,this.edgeDir),t=Math.atan2(e.y,e.x);e.x<0&&(t+=Math.PI),this.angle=-THREE.Math.radToDeg(t)}}]),t}(pt),mt=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ot(this,t),(n=Je(this,tt(t).call(this,e,o))).setName(i),n.container.classList.add("edge-move-gizmo"),n.maxRelativeLength=.3,n}return it(t,e),t}(gt),bt=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ot(this,t),i=Je(this,tt(t).call(this,e,n)),dt(et(i)),i.maxRelativeLength=1,i}return it(t,e),t}(gt),xt=function(e){function t(e,i,n,o){var r;return ot(this,t),(r=Je(this,tt(t).call(this,e,!0))).setPosition(i,n),r.setName(o),r.container.classList.add("vertex-gizmo"),r}return it(t,e),t}(pt),St=function(e,t){e.updateBBox();var i=e.bbox,n=i.max.x-i.min.x;return n*t.getPixelsPerUnit()*n},kt=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return ot(this,t),(e=Je(this,tt(t).call(this))).minWidth=i,e}return it(t,e),st(t,[{key:"accepts",value:function(e,t,i){var n=St(e,i);return Boolean(t)&&n>=this.minWidth}}]),t}(function(){function e(){ot(this,e)}return st(e,[{key:"accepts",value:function(e,t){return!0}}]),e}()),wt=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return ot(this,t),(e=Je(this,tt(t).call(this))).rangeStart=i,e.rangeEnd=n,e}return it(t,e),st(t,[{key:"apply",value:function(e,t,i){var n=(St(t,i)-this.rangeStart)/(this.rangeEnd-this.rangeStart),o=THREE.Math.clamp(n,0,1);e.container.style.opacity=o}}]),t}(function(){function e(){ot(this,e)}return st(e,[{key:"apply",value:function(e,t,i,n){}}]),e}()),Et=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kt,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new wt;ot(this,e),this.layer=t,this.shapeToLabelText=i,this.labels=[],this.labelsUsed=0,this.layer.addCanvasGizmo(this),this.visible=!0,this.layer.update(),this.filter=n,this.styleRule=o}return st(e,[{key:"setTextRule",value:function(e){this.shapeToLabelText=e,this.update()}},{key:"setVisible",value:function(e){e!==this.visible&&(e?(this.layer.addCanvasGizmo(this),this.update()):(this.clearLabels(),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"dtor",value:function(){this.setVisible(!1)}},{key:"clearLabels",value:function(){for(var e=0;e<this.labelsUsed;e++)this.labels[e].setShape(null),this.labels[e].setVisible(!1);this.labelsUsed=0}},{key:"acquireLabel",value:function(){return this.labelsUsed===this.labels.length&&this.labels.push(new ft(null,this.layer)),this.labels[this.labelsUsed++]}},{key:"update",value:function(){this.clearLabels();for(var e=this.layer.shapes,t=0;t<e.length;t++){var i=e[t],n=this.shapeToLabelText(i);if(!this.filter||this.filter.accepts(i,n,this.layer)){var o=this.acquireLabel();o.setShape(i),o.setText(n),o.setVisible(!0),this.styleRule&&this.styleRule.apply(o,i,this.layer)}}}}]),e}();function Pt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Tt=function(e,t){return"TangentGizmo-$vertexIndex-$sideIndex"},Ct={None:-1,Start:0,End:1},Lt=function(){function e(t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path=t,this.gizmoLayer=o,this.layer=n,this.index=i,this.line=new G,this.lineVisible=!1,this.line.style.isScreenSpace=!0,this.line.style.lineColor="rgb(255, 0, 255)",this.line.style.lineWidth=1,this.line.style.lineStyle=10,this.line.style.lineAlpha=1,this.vertexGizmo1=new xt(this.gizmoLayer,0,0,Tt(i,1)),this.vertexGizmo2=new xt(this.gizmoLayer,0,0,Tt(i,2)),this.vertexGizmo1.setVisible(!1),this.vertexGizmo2.setVisible(!1),this.pStart=new THREE.Vector2,this.pEnd=new THREE.Vector2,this.layer.addCanvasGizmo(this),this.dragIndex=Ct.None,this.lastDragPos=new THREE.Vector2,this.dragOffset=new THREE.Vector2(0,0),this.update()}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.setVisible(!1),this.layer.removeCanvasGizmo(this)}},{key:"setVisible",value:function(e){this.vertexGizmo1.setVisible(e),this.vertexGizmo2.setVisible(e),e!==this.lineVisible&&(e?this.gizmoLayer.addShape(this.line):this.gizmoLayer.removeShape(this.line)),this.lineVisible=e}},{key:"update",value:function(){var e=this.path.prevIndex(this.index),t=this.path.isBezierArc(e),i=this.path.isBezierArc(this.index);if(t||i){var n=this.path.points[this.index];if(i)this.pEnd.set(n.cp1x,n.cp1y),d.mirrorPointOnPoint(this.pEnd,n,this.pStart);else{var o=this.path.points[e];this.pStart.set(o.cp2x,o.cp2y),d.mirrorPointOnPoint(this.pStart,n,this.pEnd)}this.vertexGizmo1.setPosition(this.pStart.x,this.pStart.y),this.vertexGizmo2.setPosition(this.pEnd.x,this.pEnd.y),this.line.makeLine(this.pStart.x,this.pStart.y,this.pEnd.x,this.pEnd.y),this.gizmoLayer.update(),this.setVisible(!0)}else this.setVisible(!1)}},{key:"setTangentEndPoints",value:function(e,t){var i=this.path.prevIndex(this.index);this.path.isBezierArc(i)&&this.path.updateControlPoint(i,2,e.x,e.y),this.path.isBezierArc(this.index)&&this.path.updateControlPoint(this.index,1,t.x,t.y),this.update()}},{key:"onStartVertexMoved",value:function(e){var t=this.path.getPoint(this.index),i=d.mirrorPointOnPoint(e,t);this.setTangentEndPoints(e,i)}},{key:"onEndVertexMoved",value:function(e){var t=this.path.getPoint(this.index),i=d.mirrorPointOnPoint(e,t);this.setTangentEndPoints(i,e)}},{key:"startDrag",value:function(e,t,i){this.dragIndex=i;var n=i===Ct.Start?this.pStart:this.pEnd,o=this.layer.layerToCanvas(n.x,n.y);this.dragOffset.set(o.x-e,o.y-t),this.lastDragPos.copy(n)}},{key:"endDrag",value:function(e,t){this.moveDrag(e,t),this.dragIndex=Ct.None}},{key:"moveDrag",value:function(e,t){var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.layer.canvasToLayer(i,n);this.dragIndex===Ct.Start?this.onStartVertexMoved(o):this.dragIndex===Ct.End&&this.onEndVertexMoved(o),this.layer.update()}},{key:"onButtonDown",value:function(e,t){var i=this.vertexGizmo1.isUnderMouse,n=this.vertexGizmo2.isUnderMouse;if(!i&&!n)return!1;var o=i?Ct.Start:Ct.End;return this.startDrag(e,t,o),!0}},{key:"isDragging",value:function(){return this.dragIndex!==Ct.None}}])&&Pt(t.prototype,i),n&&Pt(t,n),e}();function At(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Vt=Autodesk.Viewing,_t=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.shape=null,this.dragStartPoint=new THREE.Vector2,this.backupShape=null,this.keyMap={CancelEdit:Vt.KeyCode.ESCAPE},this.lastMousePos=new THREE.Vector2}var t,i,n;return t=e,(i=[{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"Edit2_MoveTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.layer.hitTest(i.x,i.y);return n&&this.startDrag(n,i),this.shape?this.selection.selectOnly(this.shape):this.selection.clear(),Boolean(this.shape)}}},{key:"startDrag",value:function(e,t){this.shape=e,this.dragStartPoint.copy(t),this.backupShape=e.clone()}},{key:"moveDrag",value:function(e){var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;this.shape.copy(this.backupShape),this.shape.move(t,i),this.layer.update()}},{key:"resetDragging",value:function(){this.shape=null,this.backupShape=null}},{key:"endDrag",value:function(e){if(this.shape){this.shape.copy(this.backupShape);var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;return this.undoStack.run(new ie.MoveShape(this.layer,this.shape,t,i)),!!this.shape&&(this.shape=null,!0)}}},{key:"cancelDrag",value:function(){this.isDragging()&&(this.shape.copy(this.backupShape),this.layer.update(),this.resetDragging())}},{key:"isDragging",value:function(){return Boolean(this.shape)}},{key:"handleMouseMove",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.lastMousePos.copy(t),!!this.shape&&(this.moveDrag(t),!0)}},{key:"handleButtonUp",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.endDrag(i)}}},{key:"handleKeyDown",value:function(e,t){t===this.keyMap.CancelEdit&&this.cancelDrag()}},{key:"getCursor",value:function(){return this.shape?"move":this.layer.hitTest(this.lastMousePos.x,this.lastMousePos.y)?"move":void 0}}])&&At(t.prototype,i),n&&At(t,n),e}();function It(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Mt=Autodesk.Viewing,Dt=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.layer=t.layer,this.gizmoLayer=t.gizmoLayer,this.snapper=t.snapper,this.selection=t.selection,this.undoStack=t.undoStack,this.unitHandler=t.unitHandler,this.nameSuffix="_".concat(t.toolSetName),this.ignoreDragging=!1,this.ignoreActions=!1,this.onActionCb=function(e){i.ignoreActions||i.handleExternalAction(e)},this.suppressSnapping=!1,this.keyMap={SnapKey:Mt.KeyCode.SHIFT,PanKey:Mt.KeyCode.SPACE},this.selection&&(this.selectionCb=function(){i.active&&i.onSelectionChanged&&i.onSelectionChanged()},this.selection.addEventListener(W.Events.SELECTION_CHANGED,this.selectionCb)),this.active=!1,this.canvasPos=new THREE.Vector2,this.keyState={ctrl:!1,shift:!1,alt:!1}}var t,i,n;return t=e,(i=[{key:"getSnapPosition",value:function(e,t){var i=this;return this.snapper&&!this.suppressSnapping?this.snapper.getSnapPosition(e,t,(function(e){return i.snappingFilter(e)})):(this.snapper.clearSnappingGizmos(),this.layer.canvasToLayer(e,t))}},{key:"dtor",value:function(){this.selectionCb&&this.selection.removeEventListener(W.Events.SELECTION_CHANGED,this.selectionCb)}},{key:"getNames",value:function(){return[this.getName()]}},{key:"handleKeyDown",value:function(e,t){if(this.keyState[t]=!0,t!==this.keyMap.SnapKey||this.suppressSnapping||(this.suppressSnapping=!0,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===Mt.KeyCode.BACKSPACE)return!0;t===this.keyMap.PanKey&&(this.ignoreDragging=!0)}},{key:"handleKeyUp",value:function(e,t){this.keyState[t]=!1,t===this.keyMap.SnapKey&&this.suppressSnapping&&(this.suppressSnapping=!1,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===this.keyMap.PanKey&&(this.ignoreDragging=!1)}},{key:"handleExternalAction",value:function(e){}},{key:"runAction",value:function(e){this.ignoreActions=!0,this.undoStack.run(e),this.ignoreActions=!1}},{key:"activate",value:function(){this.active=!0,this.undoStack.addEventListener(U.AFTER_ACTION,this.onActionCb)}},{key:"deactivate",value:function(){this.active=!1,this.undoStack.removeEventListener(U.AFTER_ACTION,this.onActionCb),this.snapper&&this.snapper.clearSnappingGizmos()}},{key:"register",value:function(){}},{key:"mapKey",value:function(e,t){for(var i in t){var n=t[i];if(e.keyCode==n)return i;if(Array.isArray(n)&&n.includes(e.keyCode))return i}return null}},{key:"snappingFilter",value:function(){return!0}},{key:"trackMousePos",value:function(e){this.canvasPos.set(e.canvasX,e.canvasY)}},{key:"handleMouseMove",value:function(e){this.trackMousePos(e)}},{key:"handleSingleClick",value:function(e){this.trackMousePos(e)}},{key:"handleDoubleClick",value:function(e){this.trackMousePos(e)}},{key:"handleButtonUp",value:function(e){this.trackMousePos(e)}},{key:"handleButtonDown",value:function(e){this.trackMousePos(e)}}])&&It(t.prototype,i),n&&It(t,n),e}();function zt(e){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e,t){return(Bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Mt.GlobalManagerMixin.call(Dt.prototype);var Ht=Autodesk.Viewing,jt=function(e){function t(e){var i,n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=!(o=Ot(t).call(this,e))||"object"!==zt(o)&&"function"!=typeof o?Rt(n):o,Autodesk.Viewing.EventDispatcher.prototype.apply(Rt(i)),i.style=r,i.rect=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.areaLabel=new vt(null,i.layer,e.unitHandler,!1),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bt(e,t)}(t,e),i=t,(n=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_RectangleTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){return 0==t&&(this.dragCanceled?(this.dragCanceled=!1,!0):(this.handleMouseMove(e),this.endDrag()))}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.rect&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.rect=new z([e.clone(),e.clone(),e.clone(),e.clone()],this.style.clone()),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.rect)}},{key:"updateRect",value:function(e){if(this.isDragging()){var t=this.startPoint,i=this.endPoint;if(e){var n=i.x-t.x,o=i.y-t.y,r=Math.max(Math.abs(n),Math.abs(o)),s=Math.sign(n),a=Math.sign(o);this.rect.updatePoint(1,t.x+r*s,t.y),this.rect.updatePoint(2,t.x+r*s,t.y+r*a),this.rect.updatePoint(3,t.x,t.y+r*a)}else this.rect.updatePoint(1,i.x,t.y),this.rect.updatePoint(2,i.x,i.y),this.rect.updatePoint(3,t.x,i.y);this.gizmoLayer.update(),this.areaLabel.setShape(this.rect)}}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateRect(t)}},{key:"endDrag",value:function(){if(!this.rect)return!1;var e=this.endPoint.x-this.startPoint.x,t=this.endPoint.y-this.startPoint.y,i=Math.abs(e)>1e-10&&Math.abs(t)>1e-10;return this.gizmoLayer.removeShape(this.rect),i&&this.undoStack.run(new ie.AddShape(this.layer,this.rect)),this.rect=null,this.areaLabel.setShape(null),!0}},{key:"cancelDrag",value:function(){this.rect&&(this.gizmoLayer.removeShape(this.rect),this.rect=null,this.dragCanceled=!0,this.areaLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.rect)}},{key:"handleKeyDown",value:function(e,t){t==Ht.KeyCode.SHIFT&&this.updateRect(!0)}},{key:"handleKeyUp",value:function(e,t){t==Ht.KeyCode.SHIFT&&this.updateRect(!1)}}])&&Gt(i.prototype,n),o&&Gt(i,o),t}(Dt);function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ut(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ft(e,t){return!t||"object"!==Nt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wt(e,t){return(Wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yt=Autodesk.Viewing,Xt=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Ft(this,Kt(t).call(this,e))).style=n,i.line=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.lengthLabel=new yt(null,i.layer,e.unitHandler,!1),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wt(e,t)}(t,e),i=t,(n=[{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_LineTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){if(0==t)return this.handleMouseMove(e),this.dragCanceled?(this.dragCanceled=!1,!0):this.endDrag()}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.line&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.line=new G([e.clone(),e.clone()],this.style.clone()),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.line)}},{key:"updateLine",value:function(){this.isDragging()&&(this.line.updatePoint(1,this.endPoint.x,this.endPoint.y),this.gizmoLayer.update(),this.lengthLabel.setShape(this.line))}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateLine()}},{key:"endDrag",value:function(){return!!this.line&&(this.gizmoLayer.removeShape(this.line),!d.edgeIsDegenerated(this.startPoint,this.endPoint)&&this.undoStack.run(new ie.AddShape(this.layer,this.line)),this.line=null,this.lengthLabel.setShape(null),!0)}},{key:"cancelDrag",value:function(){this.line&&(this.gizmoLayer.removeShape(this.line),this.line=null,this.dragCanceled=!0,this.lengthLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.line)}},{key:"handleKeyDown",value:function(e,t){t==Yt.KeyCode.SHIFT&&this.updateLine(!0)}},{key:"handleKeyUp",value:function(e,t){t==Yt.KeyCode.SHIFT&&this.updateLine(!1)}}])&&Ut(i.prototype,n),o&&Ut(i,o),t}(Dt);function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $t(e,t,i){return($t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Jt(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function Jt(e){return(Jt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ei(e,t){return(ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ti={Polyline:1,Polygon:2},ii=Autodesk.Viewing,ni=new V,oi=function(e){function t(e){var i,n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ti.Polygon,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(i=!(o=Jt(t).call(this,e))||"object"!==qt(o)&&"function"!=typeof o?Qt(n):o).lineRectTool=r===ti.Polygon?new jt(e,s):new Xt(e,s),Autodesk.Viewing.EventDispatcher.prototype.apply(Qt(i)),i.vertexGizmos=[],i.poly=void 0,i.style=s,i.edgePreviewStyle=new V({lineWidth:2,isScreenSpace:!0,lineStyle:11}),i.mode=r,i.lastClickX=void 0,i.lastClickY=void 0,i.keyMap.CANCEL_EDIT=ii.KeyCode.ESCAPE,i.keyMap.REMOVE_LAST_VERTEX=ii.KeyCode.BACKSPACE,i.keyMap.FINISH_EDIT=[ii.KeyCode.ENTER,ii.KeyCode.c],i.fillGizmo=null,i.outlineGizmo=null,i.edgePreviewGizmo=null,i.mousePos=new THREE.Vector2,i.areaLabel=new vt(null,i.gizmoLayer,i.unitHandler,!1),i.lengthLabel=new bt(i.gizmoLayer,!1),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ei(e,t)}(t,e),i=t,(n=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"deactivate",value:function(){$t(Jt(t.prototype),"deactivate",this).call(this),this.cancelEdit()}},{key:"isPolygon",value:function(){return this.poly instanceof z}},{key:"setStyles",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.lineColor===ni.lineColor&&t||(this.style.lineColor=e.lineColor),e.lineAlpha===ni.lineAlpha&&t||(this.style.lineAlpha=e.lineAlpha),e.lineWidth===ni.lineWidth&&t||(this.style.lineWidth=e.lineWidth,this.lineRectTool.style.lineWidth=e.lineWidth,this.edgePreviewStyle.lineWidth=2*e.lineWidth/3),e.lineStyle===ni.lineStyle&&t||(this.style.lineStyle=e.lineStyle,this.lineRectTool.style.lineStyle=e.lineStyle),e.fillColor===ni.fillColor&&t||(this.style.fillColor=e.fillColor),e.fillAlpha===ni.fillAlpha&&t||(this.style.fillAlpha=e.fillAlpha)}},{key:"initGizmos",value:function(){this.isPolygon()&&(this.fillGizmo=new z([],this.style.clone()),this.fillGizmo.style.lineAlpha=0,this.gizmoLayer.addShape(this.fillGizmo)),this.outlineGizmo=new G([],this.style.clone()),this.gizmoLayer.addShape(this.outlineGizmo),this.edgePreviewGizmo=new G([],this.edgePreviewStyle),this.edgePreviewGizmo.style.lineColor=this.poly.style.lineColor,this.gizmoLayer.addShape(this.edgePreviewGizmo),this.areaLabel.setShape(this.fillGizmo),this.poly&&this.poly.isPolyline()&&this.lengthLabel.attachToEdge(this.edgePreviewGizmo,0)}},{key:"clearGizmos",value:function(){this.fillGizmo&&(this.gizmoLayer.removeShape(this.fillGizmo),this.fillGizmo=null),this.areaLabel.setShape(null),this.lengthLabel.detachFromEdge(),this.outlineGizmo&&(this.gizmoLayer.removeShape(this.outlineGizmo),this.outlineGizmo=null),this.edgePreviewGizmo&&(this.gizmoLayer.removeShape(this.edgePreviewGizmo),this.edgePreviewGizmo=null);for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"polyModified",value:function(){this.updateGizmos();var e=this.poly.clone();e.addPoint(this.mousePos.x,this.mousePos.y),this.snapper.startAngleSnapping(e,this.poly.length)}},{key:"updateGizmos",value:function(){if(this.fillGizmo){this.fillGizmo.clear();for(var e=0;e<this.poly.length;e++){var t=this.poly.getPoint(e);this.fillGizmo.addPoint(t.x,t.y)}this.fillGizmo.addPoint(this.mousePos.x,this.mousePos.y)}if(this.outlineGizmo.clear(),this.poly.length>=2)for(var i=0;i<this.poly.length;i++){var n=this.poly.getPoint(i);this.outlineGizmo.addPoint(n.x,n.y)}if(this.edgePreviewGizmo.clear(),this.poly.length>=1){var o=this.poly.getPoint(this.poly.length-1);this.edgePreviewGizmo.addPoint(o.x,o.y),this.edgePreviewGizmo.addPoint(this.mousePos.x,this.mousePos.y),this.updateLengthLabel()}this.gizmoLayer.update()}},{key:"updateLengthLabel",value:function(){if(this.poly&&this.poly.isPolyline()){var e=this.unitHandler.measureTransform,t=this.poly.getLength(e)+this.edgePreviewGizmo.getLength(e),i=this.unitHandler.lengthToString(t);this.lengthLabel.setText(i)}}},{key:"getName",value:function(){return(this.mode===ti.Polygon?"Edit2_PolygonTool":"Edit2_PolylineTool")+this.nameSuffix}},{key:"handleMouseMove",value:function(e){return $t(Jt(t.prototype),"handleMouseMove",this).call(this,e),e.buttons?this.lineRectTool.handleMouseMove(e):(this.onHover(e.canvasX,e.canvasY),!1)}},{key:"onHover",value:function(e,t){if(this.poly){var i=this.layer.canvasToLayer(e,t),n=this.poly.length>=3&&this.vertexGizmos[0].isUnderMouse;this.setStartVertexHighlighted(n),n?(this.snapper.clearSnappingGizmos(),i.copy(this.vertexGizmos[0].layerPos)):i=this.getSnapPosition(e,t),this.mousePos.copy(i),this.edgePreviewGizmo.updatePoint(1,i.x,i.y),this.fillGizmo&&this.fillGizmo.updatePoint(this.fillGizmo.length-1,i.x,i.y),this.gizmoLayer.update(),this.updateLengthLabel()}else this.getSnapPosition(e,t)}},{key:"handleStartVertexClicked",value:function(e){if(this.poly||!(this.poly.length<3)){if(this.poly.isPolyline()){var t=this.poly.getPoint(0);this.addVertex(t.x,t.y)}this.finishPolygon(),e.stopPropagation()}}},{key:"handleSingleClick",value:function(e,i){return $t(Jt(t.prototype),"handleSingleClick",this).call(this,e,i),0!=!i&&(this.vertexGizmos.length>0&&e.canvasX===this.lastClickX&&e.canvasY===this.lastClickY||(this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.mousePos.copy(this.getSnapPosition(e.canvasX,e.canvasY)),this.poly||this.startPoly(this.mousePos.x,this.mousePos.y),this.addVertex(this.mousePos.x,this.mousePos.y),!0))}},{key:"handleButtonDown",value:function(e,t){return!this.ignoreDragging&&!this.poly&&(this.selection.clear(),this.lineRectTool.handleButtonDown(e,t))}},{key:"handleButtonUp",value:function(e,t){return this.lineRectTool.handleButtonUp(e,t)}},{key:"handleDoubleClick",value:function(e,i){return $t(Jt(t.prototype),"handleDoubleClick",this).call(this,e,i),0!=!i&&(this.finishPolygon(),!0)}},{key:"startPoly",value:function(e,t){this.mode===ti.Polygon?this.poly=new z([],this.style.clone()):this.poly=new G([],this.style.clone()),this.initGizmos()}},{key:"addVertex",value:function(e,t){var i=this;this.poly.addPoint(e,t);var n="PolygonTool_vertexGizmo_"+this.vertexGizmos.length,o=new xt(this.gizmoLayer,e,t,n);this.vertexGizmos.push(o),1===this.vertexGizmos.length&&o.container.addEventListener("click",(function(e){return i.handleStartVertexClicked(e)})),this.polyModified()}},{key:"removeLastVertex",value:function(){this.poly&&this.poly.length&&(this.poly.length<=1?this.cancelEdit():(this.poly.removePoint(this.poly.length-1),this.vertexGizmos[this.vertexGizmos.length-1].dtor(),this.vertexGizmos.pop(),this.polyModified()))}},{key:"finishPolygon",value:function(){this.clearGizmos(),this.snapper.stopAngleSnapping(),this.runAction(new ie.AddShape(this.layer,this.poly)),this.dispatchEvent({type:t.POLYGON_ADDED,polygon:this.poly}),this.poly=null}},{key:"cancelEdit",value:function(){this.lineRectTool.isDragging()&&this.lineRectTool.cancelDrag(),this.poly&&(this.gizmoLayer.removeShape(this.poly),this.poly=null),this.clearGizmos(),this.snapper.stopAngleSnapping()}},{key:"handleFinishKey",value:function(e){return!(!this.poly||this.isPolygon()&&this.poly.length<3||(this.finishPolygon(),0))}},{key:"handleKeyDown",value:function(e,i){var n=$t(Jt(t.prototype),"handleKeyDown",this).call(this,e,i);switch(n=this.lineRectTool.handleKeyDown(e,i)||n,this.mapKey(e,this.keyMap)){case"CANCEL_EDIT":this.cancelEdit(),n=!0;break;case"REMOVE_LAST_VERTEX":this.removeLastVertex(),n=!0;break;case"FINISH_EDIT":n=this.handleFinishKey(e)}return n}},{key:"handleKeyUp",value:function(e,i){$t(Jt(t.prototype),"handleKeyUp",this).call(this,e,i),this.lineRectTool.handleKeyUp(e,i)}},{key:"onSnappingToggled",value:function(e,t){this.onHover(e,t)}},{key:"mouseOnStartVertex",value:function(e){return!!this.vertexGizmos[0]&&(this.layer.canvasToLayer(e.canvasX,e.canvasY),this.vertexGizmos[0].isUnderMouse)}},{key:"setStartVertexHighlighted",value:function(e){this.vertexGizmos[0]&&this.vertexGizmos[0].setSelected(e)}},{key:"getCursor",value:function(){return"crosshair"}}])&&Zt(i.prototype,n),o&&Zt(i,o),t}(Dt);function ri(e){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function si(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ai(e,t){return!t||"object"!==ri(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function li(e,t,i){return(li="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hi(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function hi(e){return(hi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ui(e,t){return(ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}oi.POLYGON_ADDED="polygonAdded",oi.Mode=ti;var ci=Autodesk.Viewing,pi=function(e){return"PolygonEditTool_vertexGizmo_"+e.toString()},di=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.name=pi(t),i.update(!1)}},fi=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=ai(this,hi(t).call(this,e))).moveTool=new _t(e),i.poly=null,i.lastDragPoint=new THREE.Vector2,i.vertexGizmos=[],i.draggedVertex=-1,i.dragVertexStartPos=new THREE.Vector2,i.dragEdgeStartPos={a:new THREE.Vector2,b:new THREE.Vector2},i.draggedEdge=-1,i.draggedEdgeNormal=new THREE.Vector2,i.selectedVertex=-1,i.dragOffset=new THREE.Vector2(0,0),i.edgeGizmo=new G,i.edgeGizmoShown=!1,i.keyMap.DeleteSelectedVertex=ci.KeyCode.BACKSPACE,i.keyMap.CancelEdit=ci.KeyCode.ESCAPE,i.mousePos=new THREE.Vector2,i.areaLabel=new vt(null,i.layer,e.unitHandler,!1),i.lengthLabel=new yt(null,i.layer,e.unitHandler,!1),i.edgeGizmos=[],i.tangentGizmos=[],i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ui(e,t)}(t,e),i=t,(n=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_PolygonEditTool"+this.nameSuffix}},{key:"deactivate",value:function(){li(hi(t.prototype),"deactivate",this).call(this),this.reset()}},{key:"createVertexGizmos",value:function(){for(var e=0;e<this.poly.points.length;e++){var t=this.poly.points[e],i=new xt(this.gizmoLayer,t.x,t.y,pi(e),this.poly.style);this.vertexGizmos.push(i),i.setHoverEnabled(!0)}}},{key:"updateVertexGizmos",value:function(){var e=this.poly?this.poly.length:0,t=new THREE.Vector2;if(e==this.vertexGizmos.length)for(var i=0;i<e;i++)this.poly.getPoint(i,t),this.vertexGizmos[i].setPosition(t.x,t.y);else this.clearVertexGizmos(),this.createVertexGizmos()}},{key:"clearVertexGizmos",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"clearEdgeGizmos",value:function(){for(var e=0;e<this.edgeGizmos.length;e++)this.edgeGizmos[e].dtor();this.edgeGizmos.length=0}},{key:"createEdgeGizmos",value:function(){this.clearEdgeGizmos();for(var e=this.poly?this.poly.getEdgeCount():0,t=0;t<e;t++){var i=new mt(this.layer,"PolygonEditTool_edgeGizmo_"+t.toString());i.attachToEdge(this.poly,t),this.edgeGizmos.push(i)}}},{key:"updateVertexHighlighting",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].setSelected(e===this.selectedVertex)}},{key:"setSelectedVertex",value:function(e){this.selectedVertex=this.poly?e:-1,this.updateVertexHighlighting()}},{key:"getVertexIndex",value:function(e,t){for(var i=0;i<this.vertexGizmos.length;i++)if(this.vertexGizmos[i].isUnderMouse)return i;return-1}},{key:"getEdgeIndex",value:function(e,t){for(var i=0;i<this.edgeGizmos.length;i++)if(this.edgeGizmos[i].isUnderMouse)return i;return-1}},{key:"reset",value:function(){this.poly&&(this.clearVertexGizmos(),this.clearEdgeGizmos(),this.clearTangentGizmos(),this.areaLabel.setShape(null),this.lengthLabel.setShape(null),this.poly=null,this.draggedVertex=-1,this.selectedVertex=-1,this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(e){this.reset(),e&&(this.poly=e,this.createVertexGizmos(),this.createEdgeGizmos(),this.createTangentGizmos());var t=e&&e.isPolygon()?e:null;this.areaLabel.setShape(t);var i=e&&e.isPolyline()?e:null;this.lengthLabel.setShape(i)}},{key:"insertPoint",value:function(e,t){this.runAction(new ie.AddVertex(this.layer,this.poly,e,t));var i=new xt(this.gizmoLayer,t.x,t.y,void 0,this.poly.style);this.vertexGizmos.splice(e,0,i),di(this.vertexGizmos),this.createEdgeGizmos(),this.createTangentGizmos(),this.layer.update()}},{key:"removePoint",value:function(e){var t=this.poly.isPolygon()?3:2;if(this.poly.length<=t)return this.runAction(new ie.RemoveShape(this.layer,this.poly)),void this.reset();this.runAction(new ie.RemoveVertex(this.layer,this.poly,e));var i=this.vertexGizmos.splice(e,1)[0];di(this.vertexGizmos),this.createEdgeGizmos(),this.createTangentGizmos(),i.dtor(),this.selectedVertex===e&&this.setSelectedVertex(-1),this.layer.update()}},{key:"startDragVertex",value:function(e,t){this.snapper.startAngleSnapping(this.poly.clone(),t),this.draggedVertex=t;var i=this.poly.points[this.draggedVertex],n=this.layer.layerToCanvas(i.x,i.y);this.dragOffset.set(n.x-e.canvasX,n.y-e.canvasY),this.setSelectedVertex(this.draggedVertex),this.lastDragPoint.copy(i),this.dragVertexStartPos.copy(i)}},{key:"moveDragVertex",value:function(e,t){var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.getSnapPosition(i,n),r=o.x-this.lastDragPoint.x,s=o.y-this.lastDragPoint.y,a=this.poly.points[this.draggedVertex];this.poly.updatePoint(this.draggedVertex,a.x+r,a.y+s),this.vertexGizmos[this.draggedVertex].setPosition(a.x,a.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(o)}},{key:"restoreDragVertex",value:function(){this.poly.updatePoint(this.draggedVertex,this.dragVertexStartPos.x,this.dragVertexStartPos.y)}},{key:"endDragVertex",value:function(){this.restoreDragVertex();var e=this.dragVertexStartPos,t=this.lastDragPoint,i=.5*this.layer.getUnitsPerPixel();e.distanceTo(t)>i&&this.runAction(new ie.MoveVertex(this.layer,this.poly,this.draggedVertex,t)),this.draggedVertex=-1,this.snapper.clearSnappingGizmos()}},{key:"startDragEdge",value:function(e,t){this.setSelectedEdge(t),this.draggedEdgeNormal=function(e,t,i){var n=t,o=(t+1)%e.length,r=e.getPoint(n),s=e.getPoint(o);i.subVectors(s,r).normalize();var a=i.x;return i.x=-i.y,i.y=a,i}(this.poly,t,this.draggedEdgeNormal),this.lastDragPoint.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY));var i=this.draggedEdge,n=(this.draggedEdge+1)%this.poly.length;this.dragEdgeStartPos.a.copy(this.poly.getPoint(i)),this.dragEdgeStartPos.b.copy(this.poly.getPoint(n))}},{key:"moveDragEdge",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY),i=t.clone().sub(this.lastDragPoint),n=this.poly.prevIndex(this.draggedEdge),o=this.poly.nextIndex(this.draggedEdge),r=new THREE.Vector2,s=new THREE.Vector2,a=new THREE.Vector2,l=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector2;this.poly.getEdge(n,r,s),this.poly.getEdge(this.draggedEdge,a,l),this.poly.getEdge(o,h,u),a.add(i),l.add(i);var c=d.getEdgeDirection(r,s),p=d.getEdgeDirection(a,l),f=d.getEdgeDirection(h,u),y=new THREE.Vector2,v=new THREE.Vector2;if(d.intersectLines(r,c,a,p,y)&&d.intersectLines(h,f,a,p,v)){var g=this.draggedEdge,m=this.poly.nextIndex(g);this.poly.updatePoint(g,y.x,y.y),this.poly.updatePoint(m,v.x,v.y),this.vertexGizmos[g].setPosition(y.x,y.y),this.vertexGizmos[m].setPosition(v.x,v.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(t),this.updateEdgeGizmo()}}},{key:"restoreDragEdge",value:function(){var e=this.dragEdgeStartPos.a,t=this.dragEdgeStartPos.b,i=this.draggedEdge,n=this.poly.nextIndex(i);this.poly.updatePoint(i,e.x,e.y),this.poly.updatePoint(n,t.x,t.y)}},{key:"endDragEdge",value:function(){var e=this.draggedEdge,t=this.poly.nextIndex(e),i=this.poly.getPoint(e),n=this.poly.getPoint(t);this.restoreDragEdge(),this.runAction(new ie.MoveEdge(this.layer,this.poly,e,i,n)),this.setSelectedEdge(-1)}},{key:"edgeMovePossible",value:function(){return this.poly&&this.poly.length>2}},{key:"handleButtonDown",value:function(e,i){if(this.ignoreDragging)return!1;if(li(hi(t.prototype),"handleButtonDown",this).call(this,e,i),0==!i)return!1;var n=this.layer.canvasToLayer(e.canvasX,e.canvasY);this.mousePos.copy(n);var o=this.getVertexIndex(n.x,n.y);if(-1!=o)return this.startDragVertex(e,o),!0;var r=-1;if(e.ctrlKey){var s=17*this.layer.getUnitsPerPixel(),a=this.poly?this.poly.findEdgeIndex(this.mousePos,s):-1;if(-1!==a)return r=a+1,this.insertPoint(r,n),this.startDragVertex(e,r),!0}this.setSelectedVertex(-1);for(var l=0;l<this.tangentGizmos.length;l++)if(this.tangentGizmos[l].onButtonDown(e.canvasX,e.canvasY))return!0;var h=this.getEdgeIndex(n.x,n.y);if(this.edgeMovePossible()&&-1!==h)return this.startDragEdge(e,h),!0;if(this.poly){var u=this.layer.getLineHitRadius(this.poly);if(this.poly.hitTest(n.x,n.y,u))return this.moveTool.startDrag(this.poly,n),!0}var c=this.layer.hitTest(n.x,n.y);return c instanceof z||c instanceof G||c instanceof R||(c=null),this.selection.selectOnly(c),Boolean(this.poly)}},{key:"handleSingleClick",value:function(e){return li(hi(t.prototype),"handleSingleClick",this).call(this,e),Boolean(this.poly)}},{key:"handleMouseMove",value:function(e){if(li(hi(t.prototype),"handleMouseMove",this).call(this,e),this.mousePos.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY)),this.updateMouseOverHighlights(),!this.poly)return!1;if(-1!=this.draggedVertex)return this.moveDragVertex(e.canvasX,e.canvasY),!0;-1!=this.draggedEdge&&this.moveDragEdge(e),this.moveTool.isDragging()&&(this.moveTool.moveDrag(this.mousePos),this.updateVertexGizmos());var i=this.findDraggedTangentGizmo();return i&&i.moveDrag(e.canvasX,e.canvasY),!1}},{key:"handleButtonUp",value:function(e,i){if(li(hi(t.prototype),"handleButtonUp",this).call(this,e,i),-1!==this.draggedVertex)return this.endDragVertex(),!0;if(-1!==this.draggedEdge)return this.endDragEdge(),!0;if(this.moveTool.isDragging()){var n=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.ignoreActions=!0,this.moveTool.endDrag(n),this.ignoreActions=!1,this.updateVertexGizmos(),!0}var o=this.findDraggedTangentGizmo();return o&&o.endDrag(e.canvasX,e.canvasY),!this.ignoreDragging&&this.poly&&0==i}},{key:"snappingFilter",value:function(e){return e!==this.poly}},{key:"onSelectionChanged",value:function(){var e=this.selection.getSelectedShapes()[0];e instanceof D?this.setEditPoly(e):this.setEditPoly(null)}},{key:"handleKeyDown",value:function(e,i){var n=li(hi(t.prototype),"handleKeyDown",this).call(this,e,i);return i===this.keyMap.DeleteSelectedVertex&&this.poly&&-1!==this.selectedVertex&&(this.removePoint(this.selectedVertex),n=!0),i===this.keyMap.CancelEdit?(this.cancelDrag(),!0):n}},{key:"onSnappingToggled",value:function(e,t){-1!==this.draggedVertex&&this.moveDragVertex(e,t)}},{key:"cancelDrag",value:function(){var e=!1;-1!==this.draggedVertex&&(this.restoreDragVertex(),this.draggedVertex=-1,e=!0),-1!==this.draggedEdge&&(this.restoreDragEdge(),this.draggedEdge=-1,e=!0),this.moveTool.isDragging()&&(this.moveTool.cancelDrag(),this.updateVertexGizmos()),e&&(this.layer.update(),this.updateVertexGizmos()),this.snapper.clearSnappingGizmos()}},{key:"handleExternalAction",value:function(){this.poly&&(Boolean(this.layer.findShapeById(this.poly.id))||this.reset(),this.updateVertexGizmos(),this.cancelDrag(),this.snapper.clearSnappingGizmos())}},{key:"updateEdgeGizmo",value:function(){var e=this.getEdgeIndex(this.mousePos.x,this.mousePos.y),t=-1!=this.getVertexIndex(this.mousePos.x,this.mousePos.y)||-1!=this.draggedVertex,i=this.edgeMovePossible(),n=this.poly&&-1!=this.draggedEdge,o=n||i&&-1!=e&&!t;if(o&&!this.edgeGizmoShown?(this.gizmoLayer.addShape(this.edgeGizmo),this.edgeGizmoShown=!0):!o&&this.edgeGizmoShown&&(this.gizmoLayer.removeShape(this.edgeGizmo),this.edgeGizmoShown=!1),o){var r=n?this.draggedEdge:e,s=new THREE.Vector2,a=new THREE.Vector2;this.poly.getEdge(r,s,a),this.edgeGizmo.makeLine(s.x,s.y,a.x,a.y),this.edgeGizmo.style.lineWidth=this.poly.style.lineWidth,this.edgeGizmo.style.isScreenSpace=this.poly.style.isScreenSpace,n?(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=1):(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=.5),this.gizmoLayer.update()}}},{key:"setSelectedEdge",value:function(e){this.draggedEdge=e,this.updateEdgeGizmo();for(var t=0;t<this.edgeGizmos.length;t++)this.edgeGizmos[t].setSelected(t==this.draggedEdge)}},{key:"updateMouseOverHighlights",value:function(){this.updateEdgeGizmo()}},{key:"getCursor",value:function(){if(this.poly){var e=this.mousePos;if(this.moveTool.isDragging())return"move";if(-1!=this.draggedVertex||-1!=this.draggedEdge)return"move";if(this.keyState[ci.KeyCode.CONTROL]){var t=17*this.layer.getUnitsPerPixel();if(-1!==(this.poly?this.poly.findEdgeIndex(this.mousePos,t):-1))return"copy"}var i=this.layer.getLineHitRadius(this.poly);return this.poly.hitTest(e.x,e.y,i)?"move":void 0}}},{key:"clearTangentGizmos",value:function(){this.tangentGizmos.forEach((function(e){return e.dtor()})),this.tangentGizmos.length=0}},{key:"createTangentGizmos",value:function(){if(this.clearTangentGizmos(),this.poly&&this.poly.isPath())for(var e=0;e<this.poly.points.length;e++)this.tangentGizmos.push(new Lt(this.poly,e,this.layer,this.gizmoLayer))}},{key:"findDraggedTangentGizmo",value:function(){return this.tangentGizmos.find((function(e){return e.isDragging()}))}}])&&si(i.prototype,n),o&&si(i,o),t}(Dt);function yi(e){return(yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gi(e){return(gi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bi(e,t){return(bi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var xi=function(e){function t(e){var i,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=!(o=gi(t).call(this,e))||"object"!==yi(o)&&"function"!=typeof o?mi(n):o,Autodesk.Viewing.EventDispatcher.prototype.apply(mi(i)),i.symbol=new B(0,0,.2,new V({fillAlpha:1,lineWidth:.01,fillColor:"rgb(255, 255, 0)"})),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bi(e,t)}(t,e),i=t,(n=[{key:"getName",value:function(){return"Edit2_InsertSymbolTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"setSymbol",value:function(e){this.symbol=e}},{key:"handleMouseMove",value:function(e){}},{key:"handleSingleClick",value:function(e){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.symbol.clone();return n.move(i.x,i.y),this.undoStack.run(new ie.AddShape(this.layer,n)),this.dispatchEvent({type:t.SYMBOL_INSERTED,symbol:n}),!0}},{key:"handleDoubleClick",value:function(){return!0}},{key:"getCursor",value:function(){return"crosshair"}}])&&vi(i.prototype,n),o&&vi(i,o),t}(Dt);function Si(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}xi.SYMBOL_INSERTED="symbolInserted";var ki=Autodesk.Viewing,wi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.undoStack=t}var t,i,n;return t=e,(i=[{key:"handleKeyDown",value:function(e,t){if(t!==ki.KeyCode.z||!e.ctrlKey)return!1;e.shiftKey?this.undoStack.redo():this.undoStack.undo()}},{key:"getName",value:function(){return"Edit2_UndoTool"}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&Si(t.prototype,i),n&&Si(t,n),e}();function Ei(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pi=Autodesk.Viewing,Ti=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.viewer=t.viewer,this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.clipBoard=[],this.pasteCounter=0}var t,i,n;return t=e,(i=[{key:"copy",value:function(){this.clipBoard.length=0;var e=this.selection.getSelectedShapes();this.originalShapes=e,this.clipBoard=e.slice(),this.pasteCounter=0}},{key:"paste",value:function(){this.pasteCounter++;var t=30*this.pasteCounter*this.layer.getUnitsPerPixel(),i=[],n={type:e.BEFORE_PASTE,originalShapes:this.originalShapes,veto:!1};if(this.dispatchEvent(n),!n.veto){for(var o=0;o<this.clipBoard.length;o++){var r=this.clipBoard[o].clone();r.move(t,t),i.push(r)}this.selection.setSelection(i),this.undoStack.run(new ie.AddShapes(this.layer,i)),this.dispatchEvent({type:e.AFTER_PASTE,originalShapes:this.originalShapes,shapes:i})}}},{key:"delete",value:function(){var e=this.selection.getSelectedShapes();this.undoStack.run(new ie.RemoveShapes(this.layer,e)),this.selection.clear()}},{key:"handleKeyDown",value:function(e,t){if(!this.selection.empty()){if(t===Pi.KeyCode.DELETE)return this.delete(),!0;if(e.ctrlKey&&t===Pi.KeyCode.c)return this.copy(),!0}if(0!==this.clipBoard.length&&e.ctrlKey&&t===Pi.KeyCode.v)return this.paste(),!0}},{key:"getName",value:function(){return"Edit2_CopyTool"+this.nameSuffix}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&Ei(t.prototype,i),n&&Ei(t,n),e}();Ti.BEFORE_PASTE="BEFORE_PASTE",Ti.AFTER_PASTE="AFTER_PASTE";i(266);function Ci(e){return(Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Li(e,t,i,n,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,o)}function Ai(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vi(e){return(Vi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ii(e,t){return(Ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"default",(function(){return Oi}));var Di=AutodeskNamespace("Autodesk.Edit2D"),zi=Autodesk.Viewing,Gi=function e(t,i){Mi(this,e),this.name=t,this.autoReactivate=i,this.context=null,this.tools={}},Oi=function(e){function t(e,i){var n,o,r;return Mi(this,t),o=this,(n=!(r=Vi(t).call(this,e,i))||"object"!==Ci(r)&&"function"!=typeof r?_i(o):r).undoStack=new U,n._registeredTools=new Map,n._boundOnModelAdded=n._onModelAdded.bind(_i(n)),n._boundOnModelRemoved=n._onModelRemoved.bind(_i(n)),n._boundOnSelectionChanged=n._onSelectionChanged.bind(_i(n)),n}var i,n,o,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ii(e,t)}(t,e),i=t,(n=[{key:"load",value:(r=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.viewer.impl.createOverlayScene("Edit2D"),e.next=3,this.viewer.loadExtension("Autodesk.Snapping");case 3:this.viewer.addEventListener(zi.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.addEventListener(zi.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),this.undoTool=new wi(this.undoStack),this.viewer.toolController.registerTool(this.undoTool),this.viewer.toolController.activateTool(this.undoTool.getName());case 8:case"end":return e.stop()}}),e,this)})),s=function(){var e=this,t=arguments;return new Promise((function(i,n){var o=r.apply(e,t);function s(e){Li(o,i,n,s,a,"next",e)}function a(e){Li(o,i,n,s,a,"throw",e)}s(void 0)}))},function(){return s.apply(this,arguments)})},{key:"unload",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this._registeredTools.keys()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.unregisterTools(r)}}catch(e){t=!0,i=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}return this.viewer.toolController.deregisterTool(this.undoTool),this.undoTool=null,this.viewer.removeEventListener(zi.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.removeEventListener(zi.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),!0}},{key:"_onModelAdded",value:function(){var e=this;if(1===this.viewer.getVisibleModels().length){var t=!0,i=!1,n=void 0;try{for(var o,r=this._registeredTools.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.autoReactivate&&s.toolsToReactivate.forEach((function(t){return e.viewer.toolController.activateTool(t)}))}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}},{key:"_onModelRemoved",value:function(){if(0===this.viewer.getVisibleModels().length){var e=this.viewer.toolController,t=!0,i=!1,n=void 0;try{for(var o,r=this._registeredTools.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.autoReactivate&&(s.toolsToReactivate=Object.values(s.tools).map((function(e){return e.getNames()})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(t){return e.isToolActivated(t)})),s.toolsToReactivate.forEach((function(t){return e.deactivateTool(t)})))}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}},{key:"_onSelectionChanged",value:function(e){var t=e.target,i=!0,n=!1,o=void 0;try{for(var r,s=this._registeredTools.values()[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t===a.context.selection||t.empty()||a.context.selection.clear()}}catch(e){n=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw o}}}},{key:"registerDefaultTools",value:function(){this.defaultContext=this.registerTools("default")}},{key:"registerTools",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._registeredTools.get(e);if(i)return console.warn("Edit 2D tools are already registered for tool set '".concat(e,"'")),i.context;i=new Gi(e,t),this._registeredTools.set(e,i);var n=i.context=new Ri(this,e);n.selection.addEventListener(W.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),i.tools.polygonTool=new oi(n,oi.Mode.Polygon),i.tools.polylineTool=new oi(n,oi.Mode.Polyline),i.tools.moveTool=new _t(n),i.tools.polygonEditTool=new fi(n),i.tools.insertSymbolTool=new xi(n),i.tools.copyTool=new Ti(n);var o=this.viewer.toolController;return o.registerTool(i.tools.polygonTool),o.registerTool(i.tools.polylineTool),o.registerTool(i.tools.moveTool),o.registerTool(i.tools.polygonEditTool),o.registerTool(i.tools.insertSymbolTool),o.registerTool(i.tools.copyTool),o.activateTool(i.tools.copyTool.getName()),n}},{key:"unregisterDefaultTools",value:function(){this.unregisterTools("default"),this.defaultContext=null}},{key:"unregisterTools",value:function(e){var t=this._registeredTools.get(e);if(t){var i=this.viewer.toolController;i.deregisterTool(t.tools.polygonTool),i.deregisterTool(t.tools.polylineTool),i.deregisterTool(t.tools.moveTool),i.deregisterTool(t.tools.polygonEditTool),i.deregisterTool(t.tools.insertSymbolTool),i.deregisterTool(t.tools.copyTool),t.context.selection.removeEventListener(W.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),this._registeredTools.delete(e)}}},{key:"createLayer",value:function(){var e=this.viewer.model;e&&e.is2d()||console.error("A 2D model is needed to adjust viewport");var t=e.getBoundingBox(),i=t.max.x-t.min.x,n=t.max.y-t.min.y,o=new l(i,n,this.viewer);return this.viewer.impl.overlayScenes.Edit2D.scene.add(o.scene),o}},{key:"defaultTools",get:function(){var e=this._registeredTools.get("default");return e&&e.tools}}])&&Ai(i.prototype,n),o&&Ai(i,o),t}(zi.Extension),Ri=function e(t,i){var n=this;Mi(this,e),this.toolSetName=i,this.viewer=t.viewer,this.layer=t.createLayer(),this.gizmoLayer=t.createLayer(),this.undoStack=t.undoStack,this.selection=new W(this.layer,this.undoStack),this.snapper=new Ce(this.viewer,this.layer,this.gizmoLayer),this.unitHandler=new Ze(this.viewer);this.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,(function(){n.layer.updateCanvasGizmos(),n.gizmoLayer.updateCanvasGizmos()}))};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Edit2D",Oi),Di.Shape=M,Di.Polygon=z,Di.Polyline=G,Di.PolyBase=D,Di.Path=R,Di.Circle=B,Di.Style=V,Di.PolygonTool=oi,Di.Selection=W,Di.MoveTool=_t,Di.PolygonEditTool=fi,Di.InsertSymbolTool=xi,Di.Math2D=d,Di.VertexGizmo=xt,Di.RectangleTool=jt,Di.LineTool=Xt,Di.CopyTool=Ti,Di.Actions=ie,Di.UndoStack=U,Di.UndoTool=wi,Di.Edit2DContext=Ri,Di.CanvasGizmo=pt,Di.CanvasGizmoBase=ct,Di.ShapeLabel=ft,Di.AlignX=lt,Di.AlignY=ht,Di.AreaLabel=vt,Di.EdgeLabel=bt,Di.UnitHandler=Ye,Di.DefaultUnitHandler=Ze,Di.ShapeLabelRule=Et,Di.ShapeWrapper=H,Di.SegmentTree=we,Di.TangentGizmo=Lt,Di.MeasureTransform=ze,Di.DefaultMeasureTransform=Ge},6:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return s}));var n={numIterations:100,minSegLenFraction:.05};function o(e,t){e&&(n.numIterations=e),t&&(n.minSegLenFraction=t)}function r(e,t,i,o,r,s,a,l,h,u,c){c=c||n;for(var p=(u=u||1/c.minSegLenFraction)*c.minSegLenFraction,d=1/c.numIterations,f=d*d*d,y=3*d,v=y*d,g=v+v,m=6*f,b=t-2*o+s,x=i-2*r+a,S=3*(o-s)-t+l,k=3*(r-a)-i+h,w=t,E=i,P=(o-t)*y+b*v+S*f,T=(r-i)*y+x*v+k*f,C=b*g+S*m,L=x*g+k*m,A=S*m,V=k*m,_=0,I=0|1/d-.5,M=0;M<I;M++)w+=P,E+=T,P+=C,T+=L,L+=V,C+=A,(_+=Math.sqrt(P*P+T*T))>=p&&(e.lineTo(w,E),_=0);e.lineTo(l,h)}function s(e,t,i,o,r,s,a,l,h){h=h||n;for(var u=(l=l||1/h.minSegLenFraction)*h.minSegLenFraction,c=1/h.numIterations,p=c*c,d=t-2*o+s,f=i-2*r+a,y=t,v=i,g=2*(o-t)*c+d*p,m=2*(r-i)*c+f*p,b=2*d*p,x=2*f*p,S=0,k=0|1/c-.5,w=0;w<k;w++)y+=g,v+=m,g+=b,m+=x,(S+=Math.sqrt(g*g+m*m))>=u&&(e.lineTo(y,v),S=0);e.lineTo(s,a)}}});
//# sourceMappingURL=Edit2D.min.js.map