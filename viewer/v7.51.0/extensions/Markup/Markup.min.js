/*!
 * LMV v7.51.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Markup=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=782)}({12:function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},2:function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var o=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),s=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[i].concat(s).concat([o]).join("\n")}var r;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var s=this[o][0];"number"==typeof s&&(n[s]=!0)}for(o=0;o<t.length;o++){var r=t[o];"number"==typeof r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},3:function(t,e,i){var n,o,s={},r=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},h=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),u=null,l=0,c=[],d=i(5);function p(t,e){for(var i=0;i<t.length;i++){var n=t[i],o=s[n.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](n.parts[r]);for(;r<n.parts.length;r++)o.parts.push(x(n.parts[r],e))}else{var a=[];for(r=0;r<n.parts.length;r++)a.push(x(n.parts[r],e));s[n.id]={id:n.id,refs:1,parts:a}}}}function f(t,e){for(var i=[],n={},o=0;o<t.length;o++){var s=t[o],r=e.base?s[0]+e.base:s[0],a={css:s[1],media:s[2],sourceMap:s[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function y(t,e){var i=h(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),c.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=h(t.insertAt.before,i);i.insertBefore(e,o)}}function v(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=c.indexOf(t);e>=0&&c.splice(e,1)}function g(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return m(e,t.attrs),y(t,e),e}function m(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function x(t,e){var i,n,o,s;if(e.transform&&t.css){if(!(s="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=s}if(e.singleton){var r=l++;i=u||(u=g(e)),n=b.bind(null,i,r,!1),o=b.bind(null,i,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),y(t,e),e}(e),n=E.bind(null,i,e),o=function(){v(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(e),n=w.bind(null,i),o=function(){v(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=f(t,e);return p(i,e),function(t){for(var n=[],o=0;o<i.length;o++){var r=i[o];(a=s[r.id]).refs--,n.push(a)}t&&p(f(t,e),e);for(o=0;o<n.length;o++){var a;if(0===(a=n[o]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete s[a.id]}}}};var M,k=(M=[],function(t,e){return M[t]=e,M.filter(Boolean).join("\n")});function b(t,e,i,n){var o=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=k(e,o);else{var s=document.createTextNode(o),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(s,r[e]):t.appendChild(s)}}function w(t,e){var i=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function E(t,e,i){var n=i.css,o=i.sourceMap,s=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||s)&&(n=d(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var r=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}},5:function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var o,s=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?t:(o=0===s.indexOf("//")?s:0===s.indexOf("/")?i+s:n+s.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},51:function(t,e,i){"use strict";(function(t){var i=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some((function(t,n){return t[0]===e&&(i=n,!0)})),i}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,n=this.__entries__;i<n.length;i++){var o=n[i];t.call(e,o[1],o[0])}},e}()}(),n="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,o=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),s="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(o):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var r=["top","right","bottom","left","width","height","size","weight"],a="undefined"!=typeof MutationObserver,h=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,n=!1,o=0;function r(){i&&(i=!1,t()),n&&h()}function a(){s(r)}function h(){var t=Date.now();if(i){if(t-o<2)return;n=!0}else i=!0,n=!1,setTimeout(a,e);o=t}return h}(this.refresh.bind(this),20)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){n&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),a?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){n&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e;r.some((function(t){return!!~i.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),u=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var o=n[i];Object.defineProperty(t,o,{value:e[o],enumerable:!1,writable:!1,configurable:!0})}return t},l=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||o},c=g(0,0,0,0);function d(t){return parseFloat(t)||0}function p(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce((function(e,i){return e+d(t["border-"+i+"-width"])}),0)}function f(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return c;var n=l(t).getComputedStyle(t),o=function(t){for(var e={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var o=n[i],s=t["padding-"+o];e[o]=d(s)}return e}(n),s=o.left+o.right,r=o.top+o.bottom,a=d(n.width),h=d(n.height);if("border-box"===n.boxSizing&&(Math.round(a+s)!==e&&(a-=p(n,"left","right")+s),Math.round(h+r)!==i&&(h-=p(n,"top","bottom")+r)),!function(t){return t===l(t).document.documentElement}(t)){var u=Math.round(a+s)-e,f=Math.round(h+r)-i;1!==Math.abs(u)&&(a-=u),1!==Math.abs(f)&&(h-=f)}return g(o.left,o.top,a,h)}var y="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof l(t).SVGGraphicsElement}:function(t){return t instanceof l(t).SVGElement&&"function"==typeof t.getBBox};function v(t){return n?y(t)?function(t){var e=t.getBBox();return g(0,0,e.width,e.height)}(t):f(t):c}function g(t,e,i,n){return{x:t,y:e,width:i,height:n}}var m=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=g(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=v(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),x=function(t,e){var i,n,o,s,r,a,h,l=(n=(i=e).x,o=i.y,s=i.width,r=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),u(h,{x:n,y:o,width:s,height:r,top:o,right:n+s,bottom:r+o,left:n}),h);u(this,{target:t,contentRect:l})},M=function(){function t(t,e,n){if(this.activeObservations_=[],this.observations_=new i,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=n}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new m(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new x(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),k="undefined"!=typeof WeakMap?new WeakMap:new i,b=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=h.getInstance(),n=new M(e,i,this);k.set(this,n)};["observe","unobserve","disconnect"].forEach((function(t){b.prototype[t]=function(){var e;return(e=k.get(this))[t].apply(e,arguments)}}));var w=void 0!==o.ResizeObserver?o.ResizeObserver:b;e.a=w}).call(this,i(12))},564:function(t,e,i){var n=i(565);"string"==typeof n&&(n=[[t.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(3)(n,o);n.locals&&(t.exports=n.locals)},565:function(t,e,i){(t.exports=i(2)(!1)).push([t.i,'.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after{content:"";position:absolute;top:-15px;bottom:-15px;left:-15px;right:-15px}.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after{top:0;bottom:0px}.adsk-viewing-viewer .selector-box{position:absolute;border:1px dashed #0696D7;background:rgba(6,150,215,0.05);z-index:1;cursor:move;box-sizing:border-box}.adsk-viewing-viewer .selector-drag-point,.adsk-viewing-viewer .selector-rotate-point{position:absolute;height:8px;width:8px;border-radius:8px;background:#FFFFFF;border-color:rgba(107,120,127,0.7);border-width:1px;border-style:solid}.adsk-viewing-viewer .selector-rotate-point{top:calc(100% + 22px);left:calc(50% + 1px);transform:translate3d(-50%, 0px, 0px)}.adsk-viewing-viewer .selector-drag-point.selected,.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge){background:#0696D7;border-color:#0696D7}.adsk-viewing-viewer .rotation-bridge{position:absolute;background-color:rgba(0,0,0,0);height:30px;width:0px;top:100%;left:calc(50% + 1px);border:unset;border-left:1px dashed #0696D7}.adsk-viewing-viewer .selector-drag-point.sdp-handle-n{top:-6px;left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-s{top:calc(100% - 14px);left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-w{left:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-e{right:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw{top:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne{top:-6px;right:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw{bottom:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-se{bottom:-6px;right:-6px}\n',""])},566:function(t,e,i){var n=i(567);"string"==typeof n&&(n=[[t.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(3)(n,o);n.locals&&(t.exports=n.locals)},567:function(t,e,i){(t.exports=i(2)(!1)).push([t.i,'.adsk-icon-markup:before{content:"a"}.lmv-markup-gui-toolbar{position:absolute;top:0;margin:5px 5px;color:#000000}.lmv-markup-gui-toolbar-content>*{margin:0 2px}.lmv-markup-gui-style-options{display:inline-block}\n',""])},782:function(t,e,i){"use strict";i.r(e),i.d(e,"Core",(function(){return bs})),i.d(e,"Gui",(function(){return Ss}));var n={};i.r(n),i.d(n,"MARKUP_TYPE_ARROW",(function(){return a})),i.d(n,"MARKUP_TYPE_TEXT",(function(){return h})),i.d(n,"MARKUP_TYPE_RECTANGLE",(function(){return u})),i.d(n,"MARKUP_TYPE_CIRCLE",(function(){return l})),i.d(n,"MARKUP_TYPE_CLOUD",(function(){return c})),i.d(n,"MARKUP_TYPE_FREEHAND",(function(){return d})),i.d(n,"MARKUP_TYPE_HIGHLIGHT",(function(){return p})),i.d(n,"MARKUP_TYPE_POLYLINE",(function(){return f})),i.d(n,"MARKUP_TYPE_POLYCLOUD",(function(){return y})),i.d(n,"MARKUP_TYPE_CALLOUT",(function(){return v})),i.d(n,"MARKUP_TYPE_DIMENSION",(function(){return g})),i.d(n,"MARKUP_TYPE_STAMP",(function(){return m}));var o={};i.r(o),i.d(o,"createStyle",(function(){return M})),i.d(o,"copyStyle",(function(){return k})),i.d(o,"isStyleEqual",(function(){return b})),i.d(o,"cloneStyle",(function(){return w})),i.d(o,"getStyleDefaultValues",(function(){return E}));var s={};i.r(s),i.d(s,"EVENT_EDITMODE_CHANGED",(function(){return T})),i.d(s,"EVENT_EDITMODE_ENTER",(function(){return S})),i.d(s,"EVENT_EDITMODE_LEAVE",(function(){return A})),i.d(s,"EVENT_MARKUP_SELECTED",(function(){return C})),i.d(s,"EVENT_MARKUP_DRAGGING",(function(){return I})),i.d(s,"EVENT_MARKUP_ENTER_EDITION",(function(){return z})),i.d(s,"EVENT_MARKUP_CANCEL_EDITION",(function(){return P})),i.d(s,"EVENT_MARKUP_DELETE_EDITION",(function(){return D})),i.d(s,"EVENT_HISTORY_CHANGED",(function(){return R})),i.d(s,"EVENT_EDITMODE_CREATION_BEGIN",(function(){return L})),i.d(s,"EVENT_EDITMODE_CREATION_END",(function(){return H})),i.d(s,"EVENT_MARKUP_DESELECT",(function(){return _})),i.d(s,"EVENT_EDITFRAME_EDITION_START",(function(){return N})),i.d(s,"EVENT_EDITFRAME_EDITION_END",(function(){return O}));var r={};i.r(r),i.d(r,"MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS",(function(){return dn})),i.d(r,"MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS",(function(){return pn})),i.d(r,"MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS",(function(){return fn})),i.d(r,"EDIT_FRAME_DEFAULT_MARGIN",(function(){return yn})),i.d(r,"isTouchDevice",(function(){return vn})),i.d(r,"createSvgElement",(function(){return gn})),i.d(r,"setSvgParentAttributes",(function(){return mn})),i.d(r,"createMarkupGroupSvg",(function(){return xn})),i.d(r,"createMarkupPathSvg",(function(){return Mn})),i.d(r,"setAttributeToMarkupSvg",(function(){return kn})),i.d(r,"updateMarkupPathSvgHitarea",(function(){return bn})),i.d(r,"createMarkupTextSvg",(function(){return wn})),i.d(r,"setMarkupTextSvgTransform",(function(){return En})),i.d(r,"updateMarkupTextSvgHitarea",(function(){return Tn})),i.d(r,"updateMarkupTextSvgBackground",(function(){return Sn})),i.d(r,"updateMarkupTextSvgClipper",(function(){return An})),i.d(r,"addSvgMetadata",(function(){return Cn})),i.d(r,"addMarkupMetadata",(function(){return In})),i.d(r,"removeAllMetadata",(function(){return zn})),i.d(r,"transferChildNodes",(function(){return Pn})),i.d(r,"getUniqueID",(function(){return Dn})),i.d(r,"svgNodeToString",(function(){return Rn})),i.d(r,"stringToSvgNode",(function(){return Ln})),i.d(r,"addTraitEventDispatcher",(function(){return Hn})),i.d(r,"removeTraitEventDispatcher",(function(){return _n})),i.d(r,"worldToClient",(function(){return Nn})),i.d(r,"clientToWorld",(function(){return On})),i.d(r,"clientToViewport",(function(){return Vn})),i.d(r,"viewportToClient",(function(){return Bn})),i.d(r,"worldToViewport",(function(){return Fn})),i.d(r,"metersToModel",(function(){return jn})),i.d(r,"radiansToDegrees",(function(){return Un})),i.d(r,"degreesToRadians",(function(){return Gn})),i.d(r,"sign",(function(){return Wn})),i.d(r,"areMarkupsPointsInClientRange",(function(){return Kn})),i.d(r,"hideLmvUi",(function(){return Yn})),i.d(r,"restoreLmvUi",(function(){return Xn})),i.d(r,"hideLmvPanels",(function(){return qn})),i.d(r,"showLmvToolsAndPanels",(function(){return Zn})),i.d(r,"hideLmvToolsAndPanels",(function(){return Jn})),i.d(r,"dismissLmvHudMessage",(function(){return $n})),i.d(r,"getStrokeWidth",(function(){return Qn})),i.d(r,"createMarkupFromSVG",(function(){return to})),i.d(r,"composeRGBAString",(function(){return eo})),i.d(r,"checkLineSegment",(function(){return io})),i.d(r,"checkPolygon",(function(){return no})),i.d(r,"createStyleSheet",(function(){return oo})),i.d(r,"addRuleToStyleSheet",(function(){return so})),i.d(r,"measureTextLines",(function(){return ro})),i.d(r,"createArcTo",(function(){return ao})),i.d(r,"createEllipsePath",(function(){return ho})),i.d(r,"createRectanglePath",(function(){return uo})),i.d(r,"renderToCanvas",(function(){return lo})),i.d(r,"simplify",(function(){return co}));var a="arrow",h="label",u="rectangle",l="ellipse",c="cloud",d="freehand",p="highlight",f="polyline",y="polycloud",v="callout",g="dimension",m="stamp";function x(t,e,i){this.type=e,this.editor=t,this.targetId=i,this.addToHistory=!0,this.selectOnExecution=!0}x.prototype.execute=function(){this.editor.actionManager.execute(this)},x.prototype.redo=function(){},x.prototype.undo=function(){},x.prototype.merge=function(t){return!1},x.prototype.isIdentity=function(){return!1};var M=function(t,e){for(var i={},n=0;n<t.length;++n)i[t[n]]=null;var o=E(i,e);for(n=0;n<t.length;++n){var s=t[n];i[s]=o[s].values[o[s].default].value}return i},k=function(t,e){for(var i in e)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},b=function(t,e){for(var i in e)if(t.hasOwnProperty(i)&&t[i]!==e[i])return!1;return!0},w=function(t){var e={};for(var i in t)e[i]=t[i];return e},E=function(t,e){function i(t){return{values:[{name:"Thin",value:t/2},{name:"Normal",value:t},{name:"Thick",value:4*t}],default:1}}function n(t){return{values:[{name:"100%",value:1},{name:"75%",value:.75},{name:"50%",value:.5},{name:"25%",value:.25},{name:"0%",value:0}],default:t?4:0}}var o,s=w(t),r=e.getStrokeWidth(),a=e.getFontWidth();for(var h in s)switch(h){case"stroke-width":s[h]={values:[{name:"Thin",value:(o=r)/3},{name:"Normal",value:o},{name:"Thick",value:3*o},{name:"Very Thick",value:9*o}],default:1};break;case"stroke-linejoin":s[h]={values:[{name:"Miter",value:"miter"},{name:"Round",value:"round"},{name:"Bevel",value:"bevel"}],default:0};break;case"font-size":s[h]=i(a);break;case"font-family":s[h]={values:[{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Arial Narrow",value:"Arial Narrow"},{name:"Century Gothic",value:"Century Gothic"},{name:"Courier New",value:"Courier New"},{name:"Georgia",value:"Georgia"},{name:"Impact",value:"Impact"},{name:"Lucida Console",value:"Lucida Console"},{name:"Tahoma",value:"Tahoma"},{name:"Verdana",value:"Verdana"}],default:0};break;case"font-style":s[h]={values:[{name:"Normal",value:"normal"},{name:"Italic",value:"italic"}],default:0};break;case"font-weight":s[h]={values:[{name:"Normal",value:"normal"},{name:"Bold",value:"bold"}],default:0};break;case"stroke-color":case"fill-color":s[h]={values:[{name:"red",value:"#ff0000"},{name:"green",value:"#00ff00"},{name:"blue",value:"#0000ff"},{name:"white",value:"#ffffff"},{name:"black",value:"#000000"},{name:"yellow",value:"#ffff00"}],default:0};break;case"stroke-opacity":var u=!1;s[h]=n(u);break;case"fill-opacity":u=!0;s[h]=n(u);break;case"text-data":s[h]={values:[{name:"DefaultValue",value:'<svg height="100" width="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="red" /></svg>'}],default:0}}return s},T="EVENT_EDITMODE_CHANGED",S="EVENT_EDITMODE_ENTER",A="EVENT_EDITMODE_LEAVE",C="EVENT_MARKUP_SELECTED",I="EVENT_MARKUP_DRAGGING",z="EVENT_MARKUP_ENTER_EDITION",P="EVENT_MARKUP_CANCEL_EDITION",D="EVENT_MARKUP_DELETE_EDITION",R="EVENT_HISTORY_CHANGED",L="EVENT_EDITMODE_CREATION_BEGIN",H="EVENT_EDITMODE_CREATION_END",_="EVENT_MARKUP_DESELECT",N="EVENT_EDITFRAME_EDITION_START",O="EVENT_EDITFRAME_EDITION_END",V=Autodesk.Viewing;function B(t,e,i){this.id=t,this.type="",this.editor=e,this.viewer=e.viewer,this.setGlobalManager(this.viewer.globalManager),this.position={x:0,y:0},this.size={x:0,y:0},this.rotation=0,this.style=M(i,this.editor),this.style=k(e.getDefaultStyle(),this.style),this.highlightColor="#0696D7",this.constraintWidth=!1,this.constraintHeight=!1,this.constraintRotation=!1,this.minWidth=-1e4,this.minHeight=-1e4,this.highlighted=!1,this.selected=!1,this.checkLineSegment=io.bind(this),this.checkPolygon=no.bind(this),this.renderToCanvasX=lo.bind(this),Hn(this)}V.GlobalManagerMixin.call(B.prototype);var F=B.prototype;function j(t,e,i){x.call(this,t,"SET-STYLE",e.id),this.newStyle=w(i),this.oldStyle=e.getStyle()}F.destroy=function(){this.unselect(),this.setParent(null)},F.setParent=function(t){var e=this.shape;e.parentNode&&e.parentNode.removeChild(e),t&&t.appendChild(e)},F.clone=function(){var t=Object.create(this.__proto__),e=this.getCloneOverrides();for(var i in this)if(this.hasOwnProperty(i)){var n=this[i];e.hasOwnProperty(i)?t[i]=e[i]:null!=n?n.clone instanceof Function?t[i]=n.clone():n instanceof Function?t[i]=n.bind(t):n.nodeType?t[i]=n.cloneNode(!0):n instanceof V.GlobalManager?(V.GlobalManagerMixin.call(t),t.setGlobalManager(n)):t[i]=n instanceof Object?JSON.parse(JSON.stringify(n)):n:t[i]=n}return this.cloneShape(t),t},F.cloneShape=function(t){t.shape.markup=t.shape.childNodes.item(0),t.shape.hitarea=t.shape.childNodes.item(1),t.bindDomEvents()},F.getCloneOverrides=function(){return{viewer:this.viewer,editor:this.editor,hammer:null,listeners:{}}},F.select=function(){this.selected||(this.selected=!0,this.highlighted=!1,this.updateStyle(),this.dispatchEvent({type:C,markup:this}))},F.unselect=function(){this.selected=!1},F.highlight=function(t){this.interactionsDisabled||(this.highlighted=t,this.updateStyle())},F.getStyle=function(){return w(this.style)},F.setStyle=function(t){k(t,this.style),this.updateStyle()},F.updateStyle=function(){},F.edit=function(){this.dispatchEvent({type:z,markup:this})},F.cancel=function(){this.dispatchEvent({type:P,markup:this})},F.deleteMarkup=function(){this.dispatchEvent({type:D,markup:this})},F.getEditMode=function(){return console.warn("EditMode of markup type"+this.type+" not defined."),null},F.getClientPosition=function(){var t=this.position;return this.editor.positionFromMarkupsToClient(t.x,t.y)},F.getClientSize=function(){var t=this.size;return this.editor.sizeFromMarkupsToClient(t.x,t.y)},F.getBoundingRect=function(){var t=this.rotation;0!==t&&this.setRotation(0);var e=this.viewer.impl.getCanvasBoundingClientRect(),i=this.shape.markup.getBoundingClientRect(),n=i.top-e.top,o=this.style["stroke-width"]||0,s=this.editor.sizeFromMarkupsToClient(o,0).x;return 0!==t&&this.setRotation(t),{x:i.left-e.left-s,y:n-s,width:i.width+2*s,height:i.height+2*s}},F.setRotation=function(t){this.rotation=t,this.updateStyle()},F.getRotation=function(){return this.rotation},F.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.updateStyle()},F.setSize=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},F.isWidthConstrained=function(){return this.constraintWidth},F.isHeightConstrained=function(){return this.constraintHeight},F.isRotationConstrained=function(){return this.constraintRotation},F.setMinWidth=function(t){this.minWidth=t},F.setMinHeight=function(t){this.minHeight=t},F.getMinWidth=function(){return this.minWidth},F.getMinHeight=function(){return this.minHeight},F.disableInteractions=function(t){this.interactionsDisabled=t},F.setStrokeWidth=function(t){},F.constrainsToBounds=function(t){},F.onMouseDown=function(t){this.interactionsDisabled||(this.select(),this.editor.editFrame.startDrag(t))},F.generatePoint3d=function(t){var e=this.viewer,i=this.generateBoundingPolygon(),n=this;function o(i,o){var s=n.checkLineSegment(i.x,i.y,o.x,o.y,t),r=s&&e.clientToWorld(s.x,s.y);return r&&r.point}var s=i.xVertices,r=i.yVertices,a=new THREE.Vector2(s[0]+s[1],r[0]+r[1]).multiplyScalar(.5),h=new THREE.Vector2(s[0]+s[3],r[0]+r[3]).multiplyScalar(.5),u=new THREE.Vector2(s[2]+s[1],r[2]+r[1]).multiplyScalar(.5),l=new THREE.Vector2(s[2]+s[3],r[2]+r[3]).multiplyScalar(.5),c=h.clone().add(u).multiplyScalar(.5);return o(c,u)||o(c,h)||o(c,a)||o(c,l)||function(i){var o=n.checkPolygon(i,t),s=o&&e.clientToWorld(o.x,o.y);return s&&s.point}(i)},F.generateBoundingBox=function(){for(var t={min:{x:0,y:0},max:{x:0,y:0}},e=this.generateBoundingPolygon(),i=e.vertexCount,n=e.xVertices,o=e.yVertices,s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,u=0;u<i;++u){var l=n[u],c=o[u];s=Math.min(s,l),r=Math.min(r,c),a=Math.max(a,l),h=Math.max(h,c)}return t.min.x=s,t.min.y=r,t.max.x=a,t.max.y=h,t},F.generateBoundingPolygon=function(){var t=this.getClientPosition(),e=this.getClientSize();e.x*=.5,e.y*=.5;var i=new THREE.Vector3(-e.x,-e.y).add(t),n=new THREE.Vector3(e.x,-e.y).add(t),o=new THREE.Vector3(e.x,e.y).add(t),s=new THREE.Vector3(-e.x,e.y).add(t);if(0!==this.rotation){var r=(new THREE.Matrix4).makeTranslation(-t.x,-t.y,0),a=(new THREE.Matrix4).makeRotationZ(this.rotation),h=(new THREE.Matrix4).makeTranslation(t.x,t.y,0).multiply(a).multiply(r);i.applyMatrix4(h),n.applyMatrix4(h),o.applyMatrix4(h),s.applyMatrix4(h)}return{vertexCount:4,xVertices:new Float32Array([i.x,n.x,o.x,s.x]),yVertices:new Float32Array([i.y,n.y,o.y,s.y])}},F.setMetadata=function(){return null},F.setMouseDisabledWhenTouching=function(t){if(t.isFirst)this.shape.removeEventListener("mousedown",this.onMouseDownBinded);else if(t.isFinal){var e=this;setTimeout((function(){e.shape.addEventListener("mousedown",e.onMouseDownBinded)}),10)}},F.bindDomEvents=function(){vn()&&(this.hammer=new V.Hammer.Manager(this.shape,{recognizers:[V.GestureRecognizers.singletap],handlePointerEventMouse:!1,inputClass:V.isIE11?V.Hammer.PointerEventInput:V.Hammer.TouchInput}),this.onSingleTapBinded=function(t){this.onMouseDown(t)}.bind(this),this.onHammerInputBinded=function(t){this.setMouseDisabledWhenTouching(t)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("hammer.input",this.onHammerInputBinded)),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseOutBinded=function(){this.highlight(!1)}.bind(this),this.onMouseOverBinded=function(){this.highlight(!0)}.bind(this),this.shape.addEventListener("mousedown",this.onMouseDownBinded),this.shape.addEventListener("mouseout",this.onMouseOutBinded),this.shape.addEventListener("mouseover",this.onMouseOverBinded)},F.renderToCanvas=function(t,e,i,n,o){this.renderToCanvasX(this.shape,e,i,n,t,o)},F.getPath=function(){},F.getTransform=function(){return["translate(",this.position.x,",",this.position.y,")","rotate(",Un(-this.rotation),")"].join(" ")},j.prototype=Object.create(x.prototype),j.prototype.constructor=j;var U=j.prototype;function G(t,e,i){this.editor=t,this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.type=e,this.selectedMarkup=null,this.dragging=!1,this.draggingAnnotationIniPosition=null,this.draggingMouseIniPosition=new THREE.Vector2,this.initialX=0,this.initialY=0,this.minSize=9,this.creating=!1,this.size={x:0,y:0},this.style=M(i,this.editor),this.style=k(t.getDefaultStyle(),this.style),this.CREATION_METHOD_DRAG="CREATION_METHOD_DRAG",this.CREATION_METHOD_CLICK="CREATION_METHOD_CLICK",this.CREATION_METHOD_CLICKS="CREATION_METHOD_CLICKS",this.creationMethod=this.CREATION_METHOD_DRAG,Hn(this)}U.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setStyle(this.newStyle)},U.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setStyle(this.oldStyle)},Autodesk.Viewing.GlobalManagerMixin.call(G.prototype);var W=G.prototype;function K(t,e){x.call(this,t,"DELETE-ARROW",e.id),this.createArrow=new et(t,e.id,e.tail,e.head,e.getStyle())}W.destroy=function(){this.unselect(),_n(this)},W.unselect=function(){var t=!1,e=this.selectedMarkup,i=null;e&&(i=e.id,e.unselect(),this.selectedMarkup=null,t=!0),this.editor.editFrame.setMarkup(null),t&&this.dispatchEvent({type:_,markupId:i})},W.creationBegin=function(){this.creating||(this.creating=!0,this.dispatchEvent({type:L}))},W.creationEnd=function(t){this.creating&&(this.creationMethod!==this.CREATION_METHOD_CLICK&&(this.selectedMarkup&&!this.isMinSizeValid()?(this.creationCancel(),t=!0):(this.creationMethod===this.CREATION_METHOD_DRAG&&this.finishDragging(),this.selectedMarkup&&(this.editor.closeActionGroup(),this.selectedMarkup=null))),this.creating=!1,this.dispatchEvent({type:H,creationCancelled:!!t}))},W.creationCancel=function(){this.editor.cancelActionGroup(),this.creationEnd(!0),this.selectedMarkup=null},W.setStyle=function(t){this.style=t;var e=this.selectedMarkup;e&&new j(this.editor,e,t).execute()},W.getStyle=function(){return this.style},W.setSelection=function(t){this.selectedMarkup!==t&&(this.unselect(),t&&t.select()),this.selectedMarkup=t;var e=this.editor;t&&e.bringToFront(t),this.isTextInputHelperActive()&&e.editFrame.markup?this.textInputHelper.setEditFrame():this.creating||e.editFrame.setMarkup(t)},W.getSelection=function(){return this.selectedMarkup},W.deleteMarkup=function(t,e){return!1},W.isMinSizeValid=function(){if(0!==this.minSize){var t=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y);return t.x*t.x+t.y*t.y>=this.minSize*this.minSize}return!0},W.startDragging=function(){var t=this.selectedMarkup,e=this.editor.getMousePosition();t&&(this.dragging=!0,this.draggingAnnotationIniPosition=t.getClientPosition(),this.draggingMouseIniPosition.set(e.x,e.y))},W.finishDragging=function(){var t=this.dragging,e=this.selectedMarkup;this.dragging=!1,e&&t&&e.finishDragging()},W.getFinalMouseDraggingPosition=function(){var t=this.editor,e=t.getBounds(),i=t.getMousePosition(),n=this.initialX,o=this.initialY,s=Math.min(Math.max(e.x,i.x),e.x+e.width),r=Math.min(Math.max(e.y,i.y),e.y+e.height);if(s==n&&r==o&&(s++,r++),t.input.makeSameXY){var a=Math.abs(s-n),h=Math.abs(r-o),u=Math.max(a,h);s=n+u*Wn(s-n),r=o+u*Wn(r-o)}return{x:s,y:r}},W.notifyAllowNavigation=function(t){},W.onMouseMove=function(t){},W.onMouseDown=function(){},W.onMouseUp=function(t){this.creationMethod===this.CREATION_METHOD_DRAG&&this.creationEnd()},W.onMouseDoubleClick=function(t){this.creationMethod===this.CREATION_METHOD_CLICKS&&this.creationEnd()},W.onSave=function(){this.creating&&this.creationCancel()},W.getDraggingPosition=function(){var t=this.editor.getMousePosition(),e=t.x-this.draggingMouseIniPosition.x,i=t.y-this.draggingMouseIniPosition.y;return{x:this.draggingAnnotationIniPosition.x+e,y:this.draggingAnnotationIniPosition.y+i}},W.isInsideBounds=function(t,e,i){return t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height},W.useWithSnapping=function(){return this.viewer.model.is2d()},W.isTextInputHelperActive=function(){return this.textInputHelper&&this.textInputHelper.isActive()},K.prototype=Object.create(x.prototype),K.prototype.constructor=K;var Y=K.prototype;function X(t,e,i,n){x.call(this,t,"SET-ARROW",e.id),this.newHead={x:i.x,y:i.y},this.newTail={x:n.x,y:n.y},this.oldHead={x:e.head.x,y:e.head.y},this.oldTail={x:e.tail.x,y:e.tail.y}}Y.redo=function(){this.createArrow.undo()},Y.undo=function(){this.createArrow.redo()},X.prototype=Object.create(x.prototype),X.prototype.constructor=X;var q=X.prototype;q.redo=function(){this.applyState(this.targetId,this.newHead,this.newTail)},q.undo=function(){this.applyState(this.targetId,this.oldHead,this.oldTail)},q.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newHead=t.newHead,this.newTail=t.newTail,!0)},q.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.head.x-e.x)>=1e-4||Math.abs(n.head.y-e.y)>=1e-4||Math.abs(n.tail.x-i.x)>=1e-4||Math.abs(n.tail.y-i.y)>=1e-4)&&n.set(e.x,e.y,i.x,i.y)}},q.isIdentity=function(){return this.newHead.x===this.oldHead.x&&this.newHead.y===this.oldHead.y&&this.newTail.x===this.oldTail.x&&this.newTail.y===this.oldTail.y};var Z=Autodesk.Viewing.MeasureCommon;function J(t){G.call(this,t,a,["stroke-width","stroke-color","stroke-opacity"])}J.prototype=Object.create(G.prototype),J.prototype.constructor=J;var $=J.prototype;function Q(t,e){B.call(this,t,e,["stroke-width","stroke-color","stroke-opacity"]),this.addMarkupMetadata=In.bind(this),this.checkLineSegment=io.bind(this),this.type=a,this.constraintHeight=!0,this.head=new THREE.Vector3,this.tail=new THREE.Vector3,this.size.y=3*this.style["stroke-width"],this.shape=Mn(),this.bindDomEvents()}$.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new K(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},$.onMouseDown=function(){if(G.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();if(this.initialX=e.x,this.initialY=e.y,this.size.x=0,this.size.y=0,this.lineSnapped=null,t.snapper){var i=t.snapper.getGeometryType();i!==Z.SnapType.SNAP_VERTEX&&i!==Z.SnapType.SNAP_EDGE&&i!==Z.SnapType.SNAP_MIDPOINT&&i!==Z.SnapType.SNAP_CIRCLE_CENTER||(this.lineSnapped=t.snapper.getEdge())}var n=3.5*this.style["stroke-width"],o=this.head=t.positionFromClientToMarkups(this.initialX,this.initialY),s={x:o.x+Math.cos(.25*Math.PI)*n,y:o.y+Math.sin(.25*-Math.PI)*n};(function(t,e,i,n){this.isInsideBounds(e.x,e.y,n)||(e.y=t.y+Math.sin(.25*Math.PI)*i,this.isInsideBounds(e.x,e.y,n)||(e.x=t.x+Math.cos(.25*-Math.PI)*i,this.isInsideBounds(e.x,e.y,n)||(e.y=t.y+Math.sin(.25*-Math.PI)*i)))}).bind(this)(o,s,n,t.getBounds()),t.beginActionGroup();var r=new THREE.Vector2(s.x-o.x,s.y-o.y);r.lengthSq()<n*n&&(r=r.normalize().multiplyScalar(n),s.x=o.x+r.x,s.y=o.y+r.y);var a=t.getId();new et(t,a,o,s,this.style).execute(),this.selectedMarkup=t.getMarkup(a),this.creationBegin()}},$.onMouseMove=function(t){G.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i=this.editor,n=this.getFinalMouseDraggingPosition(),o=this.initialX,s=this.initialY;if(i.snapper&&!i.snapper.isSnapped()&&this.lineSnapped){var r=i.project(this.lineSnapped.vertices[0]),a=i.project(this.lineSnapped.vertices[1]),h=new THREE.Vector3(n.x,n.y,r.z),u=Z.nearestPointInPointToLine(h,r,a),l=-(r.x-a.x)/(r.y-a.y),c=o+1,d=l*c+(s-l*o),p=new THREE.Vector3(c,d,r.z),f=new THREE.Vector3(o,s,r.z),y=Z.nearestPointInPointToLine(h,f,p);u.distanceTo(h)<=20?(n.x=u.x,n.y=u.y):y.distanceTo(h)<=20&&(n.x=y.x,n.y=y.y)}var v=this.head,g=i.positionFromClientToMarkups(n.x,n.y),m=new THREE.Vector2(g.x-v.x,g.y-v.y),x=3.5*e.style["stroke-width"];m.lengthSq()<x*x&&(m=m.normalize().multiplyScalar(x),g.x=v.x+m.x,g.y=v.y+m.y),this.size=i.sizeFromClientToMarkups(n.x-o,n.y-s),new X(i,e,v,g).execute()}},Q.prototype=Object.create(B.prototype),Q.prototype.constructor=Q;var tt=Q.prototype;function et(t,e,i,n,o){x.call(this,t,"CREATE-ARROW",e),this.selectOnExecution=!1,this.tail=n,this.head=i,this.style=w(o)}tt.getEditMode=function(){return new J(this.editor)},tt.set=function(t,e,i,n){var o=new THREE.Vector2(t,e),s=new THREE.Vector2(i,n),r=s.clone().sub(o).normalize();this.size.x=o.distanceTo(s),this.rotation=Math.acos(r.dot(new THREE.Vector2(1,0))),this.rotation=n>e?2*Math.PI-this.rotation:this.rotation;var a=this.head,h=this.tail;a.set(i,n,0),h.set(t,e,0),this.position.x=h.x+.5*(a.x-h.x),this.position.y=h.y+.5*(a.y-h.y),this.updateStyle()},tt.setRotation=function(t){this.rotation=t;var e=Math.cos(-t),i=Math.sin(-t),n=new THREE.Vector2(e,i);n.multiplyScalar(.5*this.size.x);var o=new THREE.Vector2(this.position.x,this.position.y),s=o.clone().sub(n),r=o.clone().add(n);this.head.set(r.x,r.y,0),this.tail.set(s.x,s.y,0),this.updateStyle()},tt.setSize=function(t,e,i){var n=Math.cos(-this.rotation),o=Math.sin(-this.rotation),s=new THREE.Vector2(n,o);s.multiplyScalar(.5*e);var r=new THREE.Vector2(t.x,t.y),a=r.clone().sub(s),h=r.clone().add(s);this.head.set(h.x,h.y,0),this.tail.set(a.x,a.y,0),this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.updateStyle()},tt.updateStyle=function(){var t=this.style,e=this.shape,i=t["stroke-width"],n=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]),o=this.getTransform();this.size.y=3*i,this.style["fill-color"]=t["stroke-color"],this.style["fill-opacity"]=t["stroke-opacity"],kn(e,"d",this.getPath().join(" ")),kn(e,"stroke-width",i),kn(e,"stroke",n),kn(e,"fill",n),kn(e,"transform",o),bn(e,this.editor)},tt.setPosition=function(t,e){var i=this.head,n=this.tail,o=i.x-n.x,s=i.y-n.y,r=t+.5*o,a=e+.5*s;i.x=r,i.y=a,n.x=r-o,n.y=a-s,this.position.x=n.x+.5*(i.x-n.x),this.position.y=n.y+.5*(i.y-n.y),this.updateStyle()},tt.generatePoint3d=function(t){var e=this.editor.positionFromMarkupsToClient(this.head.x,this.head.y),i=this.editor.positionFromMarkupsToClient(this.tail.x,this.tail.y),n=e.clone().sub(i).normalize(),o=this.checkLineSegment(e.x,e.y,e.x+200*n.x,e.y+200*n.y,t),s=o&&this.viewer.clientToWorld(o.x,o.y);return s&&s.point},tt.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.head=[this.head.x,this.head.y].join(" "),t.tail=[this.tail.x,this.tail.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},tt.getPath=function(){var t=this.size.x,e=this.size.y,i=e/3,n=this.style["stroke-width"],o=t-3*n,s=t-o,r=.3*n;return["M",.5*-t,.5*-e+i,"l",o,0,"l",-r,-i,"l",s+r,1.5*i,"l",-s-r,1.5*i,"l",r,-i,"l",-o,0,"z"]},et.prototype=Object.create(x.prototype),et.prototype.constructor=et;var it=et.prototype;it.redo=function(){var t=this.editor,e=new Q(this.targetId,t);t.addMarkup(e),e.set(this.head.x,this.head.y,this.tail.x,this.tail.y),e.setStyle(this.style)},it.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)};var nt=function(t,e){x.call(this,t,"DELETE-RECTANGLE",e.id),this.createRectangle=new dt(t,e.id,e.position,e.size,e.rotation,e.getStyle())};(nt.prototype=Object.create(x.prototype)).constructor=nt;var ot=nt.prototype;function st(t,e,i,n){x.call(this,t,"SET-RECTANGLE",e.id),this.newPosition={x:i.x,y:i.y},this.newSize={x:n.x,y:n.y},this.oldPosition={x:e.position.x,y:e.position.y},this.oldSize={x:e.size.x,y:e.size.y}}ot.redo=function(){this.createRectangle.undo()},ot.undo=function(){this.createRectangle.redo()},st.prototype=Object.create(x.prototype),st.prototype.constructor=st;var rt=st.prototype;rt.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},rt.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},rt.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newSize=t.newSize,!0)},rt.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.position.x-e.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-e.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(e,i)}},rt.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y};var at=Autodesk.Viewing.MeasureCommon;function ht(t){G.call(this,t,u,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"])}ht.prototype=Object.create(G.prototype),ht.prototype.constructor=ht;var ut=ht.prototype;function lt(t,e){B.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=In.bind(this),this.type=u,this.shape=Mn(),this.bindDomEvents()}ut.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new nt(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},ut.onMouseMove=function(t){G.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i,n,o=this.editor,s=this.getFinalMouseDraggingPosition(),r=o.clientToMarkups(s.x,s.y),a={x:(this.firstCorner.x+r.x)/2,y:(this.firstCorner.y+r.y)/2};if(o.snapper&&this.lineSnapped){var h=o.project(this.lineSnapped.vertices[0]),u=o.project(this.lineSnapped.vertices[1]),l=h.z;h=o.clientToMarkups(h.x,h.y),u=o.clientToMarkups(u.x,u.y),h=new THREE.Vector3(h.x,h.y,l),u=new THREE.Vector3(u.x,u.y,l);var c=new THREE.Vector3(r.x,r.y,l),d=at.nearestPointInPointToLine(c,h,u);n=c.distanceTo(d);var p=-(h.x-u.x)/(h.y-u.y),f=this.firstCorner.y-p*this.firstCorner.x,y=this.firstCorner.x+1,v=p*y+f,g=new THREE.Vector3(y,v,l),m=new THREE.Vector3(this.firstCorner.x,this.firstCorner.y,l),x=at.nearestPointInPointToLine(c,m,g);i=c.distanceTo(x)}else i=r.x-this.firstCorner.x,n=r.y-this.firstCorner.y;new st(o,e,a,this.size={x:Math.abs(i),y:Math.abs(n)}).execute()}},ut.onMouseDown=function(){if(G.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y;var i=this.firstCorner=t.clientToMarkups(this.initialX,this.initialY),n=this.size=t.sizeFromClientToMarkups(1,1),o=0;if(this.lineSnapped=null,t.snapper)if(t.snapper.getGeometryType()===at.SnapType.SNAP_EDGE){this.lineSnapped=t.snapper.getEdge();var s=t.project(this.lineSnapped.vertices[0]),r=t.project(this.lineSnapped.vertices[1]),a=r.x-s.x,h=r.y-s.y;o=this.rotation=Math.atan2(h,a)}t.beginActionGroup();var u=t.getId();new dt(t,u,i,n,o,this.style).execute(),this.selectedMarkup=t.getMarkup(u),this.creationBegin()}},lt.prototype=Object.create(B.prototype),lt.prototype.constructor=lt;var ct=lt.prototype;function dt(t,e,i,n,o,s){x.call(this,t,"CREATE-RECTANGLE",e),this.selectOnExecution=!1,this.position={x:i.x,y:i.y},this.size={x:n.x,y:n.y},this.rotation=o,this.style=w(s)}ct.getEditMode=function(){return new ht(this.editor)},ct.set=function(t,e){this.position.x=t.x,this.position.y=t.y,this.size.x=e.x,this.size.y=e.y,this.updateStyle()},ct.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]),s=eo(t["fill-color"],t["fill-opacity"]),r=this.getTransform();kn(e,"d",i),kn(e,"stroke-width",n),kn(e,"stroke",o),kn(e,"fill",s),kn(e,"transform",r),bn(e,this.editor)},ct.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},ct.getPath=function(){var t=this.style["stroke-width"],e=this.size.x-t,i=this.size.y-t,n=[];return uo(.5*-e,.5*-i,e,i,!1,n),n},dt.prototype=Object.create(x.prototype),dt.prototype.constructor=dt;var pt=dt.prototype;function ft(t,e){x.call(this,t,"DELETE-TEXT",e.id);var i={x:e.position.x,y:e.position.y},n={x:e.size.x,y:e.size.y};this.createText=new Qt(t,e.id,i,n,e.getText(),e.getStyle())}pt.redo=function(){var t=this.editor,e=new lt(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size),e.setRotation(this.rotation),e.setStyle(this.style)},pt.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)},ft.prototype=Object.create(x.prototype),ft.prototype.constructor=ft;var yt=ft.prototype;function vt(t,e,i,n,o,s){x.call(this,t,"SET-CALLOUT",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y},this.newSize={x:n.x,y:n.y},this.oldSize={x:e.size.x,y:e.size.y},this.newText=o,this.oldText=e.getText(),this.newIsFrameUsed=s,this.oldIsFrameUsed=e.isFrameUsed}yt.redo=function(){this.createText.undo()},yt.undo=function(){this.createText.redo()},vt.prototype=Object.create(x.prototype),vt.prototype.constructor=vt;var gt=vt.prototype;function mt(t,e,i,n,o){x.call(this,t,"SET-SIZE",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y},this.newWidth=n,this.oldWidth=e.size.x,this.newHeight=o,this.oldHeight=e.size.y}gt.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.newPosition,this.newSize,this.newText,this.newIsFrameUsed)},gt.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.oldPosition,this.oldSize,this.oldText,this.oldIsFrameUsed)},mt.prototype=Object.create(x.prototype),mt.prototype.constructor=mt;var xt=mt.prototype;xt.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setSize(this.newPosition,this.newWidth,this.newHeight)},xt.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setSize(this.oldPosition,this.oldWidth,this.oldHeight)},xt.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newWidth=t.newWidth,this.newHeight=t.newHeight,!0)},xt.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newWidth===this.oldWidth&&this.newHeight===this.oldHeight};var Mt,kt,bt=i(51),wt="function"==typeof Map?new Map:(Mt=[],kt=[],{has:function(t){return Mt.indexOf(t)>-1},get:function(t){return kt[Mt.indexOf(t)]},set:function(t,e){-1===Mt.indexOf(t)&&(Mt.push(t),kt.push(e))},delete:function(t){var e=Mt.indexOf(t);e>-1&&(Mt.splice(e,1),kt.splice(e,1))}}),Et=function(t){return new Event(t,{bubbles:!0})};
/*!
                  Based on Autosize 4.0.0
                  license: MIT
                  http://www.jacklmoore.com/autosize
              */try{new Event("test")}catch(t){Et=function(t){var e=Autodesk.Viewing.getGlobal().document.createEvent("Event");return e.initEvent(t,!0,!1),e}}function Tt(t){if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!wt.has(t)){var e=null,i=t.clientWidth,n=null,o=this,s=function(){t.clientWidth!==i&&u()},r=function(e){o.removeWindowEventListener("resize",s,!1),t.removeEventListener("input",u,!1),t.removeEventListener("keyup",u,!1),t.removeEventListener("autosize:destroy",r,!1),t.removeEventListener("autosize:update",u,!1),Object.keys(e).forEach((function(i){t.style[i]=e[i]})),wt.delete(t)}.bind(t,{height:t.style.height,resize:t.style.resize,overflow:t.style.overflow,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",r,!1),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",u,!1),o.addWindowEventListener("resize",s,!1),t.addEventListener("input",u,!1),t.addEventListener("autosize:update",u,!1),t.style.overflowX="hidden",t.style.wordWrap="break-word",wt.set(t,{destroy:r,update:u}),function(){var i=o.getWindow().getComputedStyle(t,null);"vertical"===i.resize?t.style.resize="none":"both"===i.resize&&(t.style.resize="horizontal"),e="content-box"===i.boxSizing?-(parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)):parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),isNaN(e)&&(e=0),u()}()}function a(e){var i=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=i,t.style.overflow=e}function h(){var n=t.style.height,s=function(t){for(var e=[];t&&t.parentNode&&t.parentNode instanceof Element;)t.parentNode.scrollTop&&e.push({node:t.parentNode,scrollTop:t.parentNode.scrollTop}),t=t.parentNode;return e}(t),r=o.getDocument(),a=r.documentElement&&r.documentElement.scrollTop;t.style.height="";var h=t.scrollHeight+e;0!==t.scrollHeight?(t.style.height=h+"px",i=t.clientWidth,s.forEach((function(t){t.node.scrollTop!==t.scrollTop&&(t.node.scrollTop=t.scrollTop)})),a&&(r.documentElement.scrollTop=a)):t.style.height=n}function u(){h();var e=o.getWindow(),i=Math.round(parseFloat(t.style.height)),s=e.getComputedStyle(t,null),r="content-box"===s.boxSizing?Math.round(parseFloat(s.height)):t.offsetHeight;if(r!==i?"hidden"===s.overflow&&(a("scroll"),h(),r="content-box"===s.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight):"hidden"!==s.overflow&&(a("hidden"),h(),r="content-box"===s.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight),n!==r){n=r;var u=Et("autosize:resized");try{t.dispatchEvent(u)}catch(t){}}}}function St(t){var e=wt.get(t);e&&e.destroy()}function At(t){var e=wt.get(t);e&&e.update()}var Ct=(Autodesk.Viewing.getGlobal(),"undefined"!=typeof window&&"function"==typeof window.getComputedStyle),It=function(t,e){var i=this;return Ct&&t&&Array.prototype.forEach.call(t.length?t:[t],(function(t){return Tt.bind(i)(t,e)})),t};function zt(){this.reset()}It.destroy=function(t){return Ct&&t&&Array.prototype.forEach.call(t.length?t:[t],St),t},It.update=function(t){return Ct&&t&&Array.prototype.forEach.call(t.length?t:[t],At),t};var Pt=["-ms-","-webkit-","-moz-","-o-"],Dt=zt.prototype;function Rt(t,e,i,n,o){this.parentDiv=t,this.editor=e,this.setGlobalManager(e.viewer.globalManager),this.EVENT_TEXT_CHANGE="EVENT_CO2_TEXT_CHANGE",this.EVENT_TEXT_SET_ACTIVE="EVENT_CO2_TEXT_SET_ACTIVE",this.EVENT_TEXT_SET_INACTIVE="EVENT_CO2_TEXT_SET_INACTIVE";var s=this.getDocument();i?(this.textArea=s.createElement("input"),this.textArea.setAttribute("type","text")):(this.textArea=s.createElement("textarea"),this.textArea.rows="1",Autodesk.Viewing.isIE11||(this.textArea.dir="auto")),this.firstEdit=!0,this.defaultText=n,this.textArea.setAttribute("maxlength",o),this.textArea.setAttribute("data-i18n",n),this.startingHeight=0,It.bind(this)(this.textArea),new bt.a(function(t,e){this.setEditFrame()}.bind(this)).observe(this.textArea),this.styleTextArea=new zt,this.styleTextArea.setAttribute("position","absolute").setAttribute("resize","none").setAttribute("box-sizing","border-box").setAttribute("-moz-box-sizing","border-box").setAttribute("-webkit-box-sizing","border-box").setAttribute("overflow","hidden").setAttribute("outline","none").setAttribute("border","none").setAttribute("z-index","1").setAttribute("padding","10px"),this.measureDiv=s.createElement("div"),Hn(this)}Dt.reset=function(){return this.attributes={},this.dirty=!1,this.styleString="",this},Dt.setAttribute=function(t,e,i){if(this.attributes[t]=e,i&&i.allBrowsers){var n=this;Pt.forEach((function(i){n.attributes[i+t]=e}))}return this.dirty=!0,this},Dt.removeAttribute=function(t){Array.isArray(t)||(t=[t]);var e=this;return t.forEach((function(t){t in e.attributes&&(delete e.attributes[t],e.dirty=!0)})),this},Dt.getStyleString=function(){return this.dirty&&(this.styleString=function(t){var e=[];for(var i in t){var n=t[i];e.push(i),e.push(":"),e.push(n),e.push("; ")}return e.join("")}(this.attributes),this.dirty=!1),this.styleString},Dt.clone=function(){var t=new zt,e=this.attributes;for(var i in e)t.setAttribute(i,e[i]);return t},Autodesk.Viewing.GlobalManagerMixin.call(Rt.prototype);var Lt=Rt.prototype;function Ht(t){if(0===t.length)return"";for(var e=t.length-1,i=e;i>=0;--i)if(" "!==t.charAt(i)){e=i;break}return t.substr(0,e+1)}function _t(t){if(0===t.length)return"";for(var e=0,i=0;i<t.length;++i)if(" "!==t.charAt(i)){e=i;break}return t.substr(e)}Lt.destroy=function(){this.setInactive()},Lt.setActive=function(t,e){if(this.textMarkup!==t){var i=Autodesk.Viewing.i18n.translate(this.defaultText);if(this.textArea.setAttribute("placeholder",i),this.setInactive(),this.parentDiv.appendChild(this.textArea),this.textMarkup=t,this.firstEdit=e||!1,this.constrainToCanvas=e,this.initFromMarkup(),this.constrainToCanvas=!1,!Autodesk.Viewing.isIOSDevice()){var n=this.textArea;this.getWindow().requestAnimationFrame((function(){n.focus()}))}var o={markup:this.textMarkup,firstEdit:this.firstEdit,isActive:!0};this.dispatchEvent({type:this.EVENT_TEXT_SET_ACTIVE,data:o})}},Lt.setInactive=function(){var t={markup:this.textMarkup,isActive:!1};Autodesk.Viewing.isIOSDevice()&&this.textArea.blur(),this.removeWindowEventListener("resize",this.onResizeBinded),this.textMarkup&&(this.textMarkup=null,this.parentDiv.removeChild(this.textArea)),this.style=null,this.dispatchEvent({type:this.EVENT_TEXT_SET_INACTIVE,data:t})},Lt.isActive=function(){return!!this.textMarkup},Lt.setEditFrame=function(){if(this.editor.editFrame.markup&&this.textMarkup&&this.editor.editFrame.markup===this.textMarkup){var t=parseFloat(this.textArea.style.width),e=parseFloat(this.textArea.style.height),i=this.textMarkup.getClientPosition(),n=this.textMarkup.getRotation(),o=i.x-t/2,s=i.y-this.startingHeight/2;this.editor.editFrame.setSelection(o,s,t,e,n)}},Lt.initFromMarkup=function(t){var e=this.textMarkup,i=e.getClientPosition(),n=e.getClientSize(),o=e.getClientFontSize()/2;this.startingHeight=n.y;var s=i.x-.5*n.x,r=i.y-.5*n.y,a=e.lineHeight+"%";this.styleTextArea.setAttribute("line-height",a),this.styleTextArea.setAttribute("padding",o+"px"),this.setPosAndSize(s,r,n.x,n.y),t?(this.setStyle(e.getStyle()),this.textArea.value=e.getText()):(this.textArea.value=e.getText(),this.setStyle(e.getStyle()))},Lt.setPosAndSize=function(t,e,i,n){this.constrainToCanvas&&(t+i>=this.editor.viewer.container.clientWidth&&(t=this.editor.viewer.container.clientWidth-(i+10)),e+n>=this.editor.viewer.container.clientHeight&&(e=this.editor.viewer.container.clientHeight-(n+10)),t<5&&(t=5,i=this.editor.viewer.container.clientWidth-10)),this.styleTextArea.setAttribute("left",t+"px").setAttribute("top",e+"px").setAttribute("width",i+"px").setAttribute("height",n+"px")},Lt.setStyle=function(t){if(this.style){var e={};this.injectSizeValues(e),this.setPosAndSize(e.newPos.x-.5*e.width,e.newPos.y-.5*e.height,e.width,e.height)}var i=this.editor.sizeFromMarkupsToClient(0,t["font-size"]).y,n=this.editor.sizeFromMarkupsToClient(0,t["stroke-width"]).y,o=this.styleTextArea.setAttribute("color",t["stroke-color"]).setAttribute("outline",n+"px solid "+t["stroke-color"]).setAttribute("font-family",t["font-family"]).setAttribute("font-size",i+"px").setAttribute("font-weight",t["font-weight"]).setAttribute("font-style",t["font-style"]).getStyleString();this.textArea.setAttribute("style",o),this.style=w(t),It.update(this.textArea)},Lt.getTextValuesForMarkup=function(t,e){var i=this.isActive(),n=this.textMarkup,o=this.firstEdit;this.setActive(t,!1);var s={markup:t,textValues:this.getTextValues()};return i?this.setActive(n,o):(e&&this.injectSizeValues(s),this.setInactive()),s},Lt.getTextValues=function(){var t=this.textArea.value;return t===this.defaultText&&(t=""),{text:t,lines:this.generateLines()}},Lt.acceptAndExit=function(){var t=this.getTextValues(),e=this.textMarkup,i={markup:this.textMarkup,style:this.style,firstEdit:this.firstEdit,newText:t.text,newLines:t.lines};this.injectSizeValues(i),this.dispatchEvent({type:this.EVENT_TEXT_CHANGE,data:i}),this.setInactive(),e.updateStyle(!0)},Lt.injectSizeValues=function(t){var e=parseFloat(this.textArea.style.width),i=parseFloat(this.textArea.style.height),n=parseFloat(this.textArea.style.left),o=parseFloat(this.textArea.style.top);t.width=e,t.height=i,t.newPos={x:n+.5*e,y:o+.5*i}},Lt.onCameraChanged=function(t){var e=this.textArea.value;this.textMarkup.style=w(this.style),this.style=null,this.initFromMarkup(!0),this.textArea.value=e,this.setEditFrame()},Lt.generateLines=function(){var t=this.textArea.value.split(/\r*\n/),e=this.styleTextArea.clone().removeAttribute(["top","left","width","height"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString();this.measureDiv.setAttribute("style",e),this.parentDiv.appendChild(this.measureDiv);for(var i=this.textArea.clientWidth-2*parseFloat(this.textArea.style.padding),n=[],o=0,s=t.length;o<s;++o){var r=Ht(t[o]);r=""===r?" ":r,this.splitLine(r,i,n)}return this.parentDiv.removeChild(this.measureDiv),n},Lt.splitLine=function(t,e,i){if(""!==t)for(var n="",o=!1;!o;){if(this.measureDiv.innerText=t,this.measureDiv.clientWidth-2*parseFloat(this.measureDiv.style.padding)<=e)i.push(t),this.splitLine(_t(n),e,i),o=!0;else{var s=this.getShorterLine(t);1===s.length?(this.splitWord(t,n,e,i),o=!0):(t=s[0],n=s[1]+n)}}},Lt.getShorterLine=function(t){var e=t.lastIndexOf(" ");if(-1===e)return[t];for(;" "===t.charAt(e-1);)e--;var i=t.substr(e);return[t.substr(0,e),i]},Lt.splitWord=function(t,e,i,n){for(var o=1;;){var s=t.substr(0,o);if(this.measureDiv.innerText=s,this.measureDiv.clientWidth-2*parseFloat(this.measureDiv.style.padding)>i){if(1===o)return n.push(s),void this.splitWord(t.substr(1),e,i,n);var r=t.substr(0,o-1);n.push(r);var a=t.substr(o-1);return void this.splitLine(a+e,i,n)}if(++o>t.length)return void n.push(t)}};function Nt(t){G.call(this,t,v,["font-size","stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]),this.style["fill-opacity"]=1,this.style["fill-color"]="#ffffff";var e=new Rt(this.viewer.container,this.editor,!1,"Text",360);e.addEventListener(e.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_ACTIVE,this.onHelperSetActive.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_INACTIVE,this.onHelperSetActive.bind(this),!1),this.textInputHelper=e,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}Nt.prototype=Object.create(G.prototype),Nt.prototype.constructor=Nt;var Ot=Nt.prototype;Ot.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type===this.type){var i=new Gt(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},Ot.setStyle=function(t){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(t):G.prototype.setStyle.call(this,t)},Ot.notifyAllowNavigation=function(t){t&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},Ot.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),G.prototype.destroy.call(this)},Ot.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())this.textInputHelper.acceptAndExit();else if(!this.selectedMarkup){var t=this.editor,e=t.getMousePosition(),i=t.sizeFromMarkupsToClient(0,this.style["font-size"]).y,n=6*i,o=1*i,s=this.size=t.sizeFromClientToMarkups(n,o),r=t.positionFromClientToMarkups(e.x+.5*n,e.y+.5*o);this.creationBegin(),t.beginActionGroup();var a=new jt(t,t.getId(),r,s,"",this.style,!0);a.execute(),this.creationEnd(),this.selectedMarkup=t.getMarkup(a.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(R,this.onHistoryChangeBinded)}},Ot.onMouseUp=function(t){},Ot.onMouseDoubleClick=function(t){t===this.selectedMarkup&&(this.editor.selectMarkup(t),this.editor.editFrame.setMarkup(t),this.textInputHelper&&this.textInputHelper.setActive(t,!1))},Ot.onHelperSetActive=function(t){var e=t.data,i=e.markup;i&&(i.setIsHelperTextActive(e.isActive),i.setIsShapeVisible(!e.isActive))},Ot.onHelperTextChange=function(t){var e=t.data,i=e.markup,n=e.style,o=this.selectedMarkup;if(this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),""===e.newText)return this.editor.cancelActionGroup(),new Gt(this.editor,i).execute(),void(i!==o&&this.editor.selectMarkup(o));e.firstEdit||this.editor.beginActionGroup();var s=this.editor.positionFromClientToMarkups(e.newPos.x,e.newPos.y),r=this.editor.sizeFromClientToMarkups(e.width,e.height);new mt(this.editor,i,s,r.x,r.y).execute(),new vt(this.editor,i,i.position,i.size,e.newText,i.isFrameUsed).execute(),new j(this.editor,i,n).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(o)},Ot.onHistoryChange=function(t){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},Ot.onSave=function(){if(G.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var t=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),t&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},Ot.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()};var Vt=100;function Bt(t,e,i){B.call(this,t,e,["font-size","stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]),this.addMarkupMetadata=In.bind(this),this.createSvgElement=gn.bind(this),this.type=v,this.textShape=wn(),this.rectShape=Mn(),this.shape=xn([this.rectShape,this.textShape]),this.isFrameUsed=!0,this.constraintRotation=!0,this.constraintHeight=!0,this.constraintWidth=!1,this.size.x=i.x,this.size.y=i.y,this.currentText="",this.currentTextLines=[""],this.prevHighlight=!1,this.isHelperTextActive=!1,this.lineHeight=130,this.minWidth=6*this.getClientFontSize(),this.bindDomEvents()}Bt.prototype=Object.create(B.prototype),Bt.prototype.constructor=Bt;var Ft=Bt.prototype;function jt(t,e,i,n,o,s,r){x.call(this,t,"CREATE-CALLOUT",e),this.text=o,this.position={x:i.x,y:i.y},this.size={x:n.x,y:n.y},this.style=w(s),this.isFrameUsed=r}Ft.getEditMode=function(){return new Nt(this.editor)},Ft.set=function(t,e,i,n){this.position.x=t.x,this.position.y=t.y,this.size.x=e.x,this.size.y=e.y,this.setIsFilledFrameUsed(n),this.setText(i)},Ft.setSize=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i;this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle(!0)},Ft.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle()},Ft.setStyle=function(t){var e=b(t,this.style);e||k(t,this.style),this.updateStyle(!e)},Ft.setText=function(t){this.currentText=t},Ft.getText=function(){return this.currentText},Ft.getTextLines=function(){return this.currentTextLines.concat()},Ft.highlightChanged=function(){if(this.highlighted&&this.highlighted!==this.prevHighlight){var t=this.rectShape,e=this.textShape,i=this.highlighted?this.highlightColor:eo(style["stroke-color"],style["stroke-opacity"]);return kn(e,"fill",i),this.isFrameUsed&&kn(t,"stroke",i),this.prevHighlight=!0,!1}return!0},Ft.updateTextBoxStyle=function(){var t=this.editor.duringEditMode&&this.editor.editMode;t&&t.type===this.type||(t=this.getEditMode()),t.updateTextBoxStyle()},Ft.setIsHelperTextActive=function(t){this.isHelperTextActive=t},Ft.updateStyle=function(t){if(this.highlightChanged()){this.prevHighlight=!1;var e=this.style,i=this.rectShape,n=this.textShape,o=this.style["font-size"],s=this.style["font-family"],r=this.style["font-weight"],a=this.style["font-style"],h=this.highlighted?this.highlightColor:eo(e["stroke-color"],e["stroke-opacity"]),u=this.style["stroke-width"];Vt=o>1?1:100,this.rebuildTextSvg(t);var l=this.editor,c=this.getTextContainerTransform(),d=this.getTextTransform();kn(n,"font-family",s),kn(n,"font-size",o*Vt),kn(n,"fill",h),kn(n,"font-weight",r),kn(n,"font-style",a),En(n,c,d),An(n,this.size.x,this.size.y),Tn(n,this.size.x,this.size.y,l);var p=this.getPath().join(" "),f=this.getTransform(),y=eo(e["fill-color"],e["fill-opacity"]);kn(i,"d",p),kn(i,"stroke-width",u),kn(i,"stroke",h),kn(i,"transform",f),kn(i,"fill",y),bn(i,l)}},Ft.rebuildTextSvg=function(t){var e=this.editor.duringEditMode&&this.editor.editMode;if(e&&e.type===this.type||((e=this.getEditMode()).textInputHelper.textArea.value=this.currentText,e.textInputHelper.setStyle(this.style)),!e.textInputHelper.textMarkup||e.textInputHelper.textMarkup===this){var i=w(e.textInputHelper.style),n=e.textInputHelper.textArea.value,o=e.textInputHelper.getTextValuesForMarkup(this,t);if(this.currentTextLines=o.textValues.lines,o.newPos){var s=this.editor.positionFromClientToMarkups(o.newPos.x,o.newPos.y),r=this.editor.sizeFromClientToMarkups(o.width,o.height);this.position.x=s.x,this.position.y=s.y,this.size.x=r.x,this.size.y=r.y}e.selectedMarkup===this||e.textInputHelper.firstEdit||(e.textInputHelper.textArea.value=n,e.textInputHelper.setStyle(i));var a=this.createSvgElement("text");a.setAttribute("id","markup"),a.setAttribute("alignment-baseline","middle"),this.textShape.childNodes[0].removeChild(this.textShape.markup),this.textShape.childNodes[0].appendChild(a),this.textShape.markup=a;var h=this.getLineHeight()*Vt*(this.lineHeight/100),u=this.getLineHeight()*Vt/2,l=u,c=u;this.currentTextLines.forEach(function(t){var e=this.createSvgElement("tspan");e.setAttribute("x",l),e.setAttribute("y",c),e.textContent=t,a.appendChild(e),c+=h}.bind(this))}},Ft.setIsFilledFrameUsed=function(t){this.isFrameUsed=t;var e=this.rectShape.parentNode===this.shape;t&&!e?this.shape.insertBefore(this.rectShape,this.shape.firstChild):!t&&e&&this.shape.removeChild(this.rectShape)},Ft.setIsFilledFrameVisible=function(t){this.rectShape.markup.style.display=t&&this.isFrameUsed?"block":"none"},Ft.setIsShapeVisible=function(t){this.shape.style.display=t?"block":"none"},Ft.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.text=String(this.currentText),t.isframeused=this.isFrameUsed?1:0,this.addMarkupMetadata(this.shape,t)},Ft.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},Ft.getLineHeight=function(){return this.style["font-size"]},Ft.getTextContainerTransform=function(){return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",Un(-this.rotation),")","scale(1,-1)"].join(" ")},Ft.getTextTransform=function(){var t=this.getLineHeight();return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-t,")","rotate(",Un(-this.rotation),")","scale("+1/Vt+","+-1/Vt+")"].join(" ")},Ft.cloneShape=function(t){t.textShape=wn(),t.rectShape=Mn(),t.shape=xn([t.rectShape,t.textShape]),t.bindDomEvents()},Ft.getPath=function(){var t=this.style["stroke-width"],e=this.size.x+t,i=this.size.y+t,n=[];return uo(.5*-e,.5*-i,e,i,!1,n),n},Ft.getBoundingRect=function(){var t=this.getClientPosition(),e=this.getClientSize(),i=this.style["stroke-width"],n=this.editor.sizeFromMarkupsToClient(i,0).x+yn;return{x:t.x-e.x/2,y:t.y-e.y/2,width:e.x,height:e.y,margin:n}},jt.prototype=Object.create(x.prototype),jt.prototype.constructor=jt;var Ut=jt.prototype;function Gt(t,e){x.call(this,t,"DELETE-CALLOUT",e.id);var i={x:e.position.x,y:e.position.y},n={x:e.size.x,y:e.size.y};this.createCallout=new jt(t,e.id,i,n,e.getText(),e.getStyle(),e.isFrameUsed)}Ut.redo=function(){var t=this.editor,e=this.position,i=this.size,n=new Bt(this.targetId,t,i);t.addMarkup(n),n.setIsFilledFrameUsed(this.isFrameUsed),n.setText(this.text),n.setSize(e,i.x,i.y),n.setStyle(this.style)},Ut.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&(this.editor.removeMarkup(t),t.destroy())},Gt.prototype=Object.create(x.prototype),Gt.prototype.constructor=Gt;var Wt=Gt.prototype;function Kt(t,e,i,n,o){x.call(this,t,"SET-TEXT",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y},this.newSize={x:n.x,y:n.y},this.oldSize={x:e.size.x,y:e.size.y},this.newText=o,this.oldText=e.getText()}Wt.redo=function(){this.createCallout.undo()},Wt.undo=function(){this.createCallout.redo()},Kt.prototype=Object.create(x.prototype),Kt.prototype.constructor=Kt;var Yt=Kt.prototype;function Xt(t){G.call(this,t,h,["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]);var e=new Rt(this.viewer.container,this.editor,!1,"Text",260);e.addEventListener(e.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_ACTIVE,this.onHelperSetActive.bind(this),!1),e.addEventListener(e.EVENT_TEXT_SET_INACTIVE,this.onHelperSetActive.bind(this),!1),this.textInputHelper=e,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}Yt.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.newPosition,this.newSize,this.newText)},Yt.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.oldPosition,this.oldSize,this.oldText)},Xt.prototype=Object.create(G.prototype),Xt.prototype.constructor=Xt;var qt=Xt.prototype;qt.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new ft(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},qt.setStyle=function(t){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(t):G.prototype.setStyle.call(this,t)},qt.notifyAllowNavigation=function(t){t&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},qt.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),G.prototype.destroy.call(this)},qt.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())this.textInputHelper.acceptAndExit();else if(!this.selectedMarkup){var t=this.editor,e=t.getMousePosition(),i=t.sizeFromMarkupsToClient(0,this.style["font-size"]).y,n=15*i,o=1*i,s=this.size=t.sizeFromClientToMarkups(n,o),r=t.positionFromClientToMarkups(e.x+.5*n,e.y+.5*o);this.creationBegin(),t.beginActionGroup();var a=new Qt(t,t.getId(),r,s,"",this.style);a.execute(),this.creationEnd(),this.selectedMarkup=t.getMarkup(a.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(R,this.onHistoryChangeBinded)}},qt.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()},qt.onMouseUp=function(t){},qt.onMouseDoubleClick=function(t){t===this.selectedMarkup&&(this.editor.selectMarkup(t),this.editor.editFrame.setMarkup(t),this.textInputHelper&&this.textInputHelper.setActive(t,!1))},qt.onHelperSetActive=function(t){var e=t.data,i=e.markup;i&&(i.setIsHelperTextActive(e.isActive),i.setIsShapeVisible(!e.isActive))},qt.onHelperTextChange=function(t){var e=t.data,i=e.markup,n=e.style,o=this.selectedMarkup;if(this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),""===e.newText)return this.editor.cancelActionGroup(),new Gt(this.editor,i).execute(),void(i!==o&&this.editor.selectMarkup(o));e.firstEdit||this.editor.beginActionGroup();var s=this.editor.positionFromClientToMarkups(e.newPos.x,e.newPos.y),r=this.editor.sizeFromClientToMarkups(e.width,e.height);new mt(this.editor,i,s,r.x,r.y).execute(),new Kt(this.editor,i,i.position,i.size,e.newText).execute(),new j(this.editor,i,n).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(o)},qt.onHistoryChange=function(t){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},qt.onSave=function(){if(G.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var t=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),t&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},qt.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()};var Zt=100;function Jt(t,e,i){B.call(this,t,e,["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"]),this.createSvgElement=gn.bind(this),this.addMarkupMetadata=In.bind(this),this.type=h,this.shape=wn(),this.constraintRotation=!0,this.constraintHeight=!0,this.constraintWidth=!1,this.size.x=i.x,this.size.y=i.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.prevHighlight=!1,this.isHelperTextActive=!1,this.lineHeight=130,this.minWidth=6*this.getClientFontSize(),this.bindDomEvents()}Jt.prototype=Object.create(B.prototype),Jt.prototype.constructor=Jt;var $t=Jt.prototype;function Qt(t,e,i,n,o,s){x.call(this,t,"CREATE-TEXT",e),this.text=o,this.position={x:i.x,y:i.y},this.size={x:n.x,y:n.y},this.style=w(s)}$t.getEditMode=function(){return new Xt(this.editor)},$t.set=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e.x,this.size.y=e.y,this.setText(i)},$t.setSize=function(t,e,i){this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i;this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle(!0)},$t.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.isHelperTextActive?this.updateTextBoxStyle():this.updateStyle()},$t.setStyle=function(t){var e=b(t,this.style);e||k(t,this.style),this.updateStyle(!e)},$t.setText=function(t){this.currentText=t},$t.getText=function(){return this.currentText},$t.getTextLines=function(){return this.currentTextLines.concat()},$t.highlightChanged=function(){if(this.highlighted&&this.highlighted!==this.prevHighlight){var t=this.shape,e=this.highlighted?this.highlightColor:eo(style["stroke-color"],style["stroke-opacity"]);return kn(t,"fill",e),this.prevHighlight=!0,!1}return!0},$t.updateTextBoxStyle=function(){var t=this.editor.duringEditMode&&this.editor.editMode;t&&t.type===this.type||(t=this.getEditMode()),t.updateTextBoxStyle()},$t.setIsHelperTextActive=function(t){this.isHelperTextActive=t},$t.updateStyle=function(t){if(this.highlightChanged()){this.prevHighlight=!1;var e=this.style,i=this.shape,n=this.style["font-size"],o=this.style["font-family"],s=this.style["font-weight"],r=this.style["font-style"],a=this.highlighted?this.highlightColor:eo(e["stroke-color"],e["stroke-opacity"]),h=eo(e["fill-color"],e["fill-opacity"]);Zt=n>1?1:100,this.rebuildTextSvg(t),kn(i,"font-family",o),kn(i,"font-size",n*Zt),kn(i,"fill",a),kn(i,"font-weight",s),kn(i,"font-style",r);var u=this.editor,l=this.getTransform(),c=this.getTextTransform();En(i,l,c),Sn(i,this.size.x,this.size.y,h),An(i,this.size.x,this.size.y),Tn(i,this.size.x,this.size.y,u)}},$t.rebuildTextSvg=function(t){var e=this.editor.duringEditMode&&this.editor.editMode;if(e&&e.type===this.type||((e=this.getEditMode()).textInputHelper.textArea.value=this.currentText,e.textInputHelper.setStyle(this.style)),!e.textInputHelper.textMarkup||e.textInputHelper.textMarkup===this){var i=w(e.textInputHelper.style),n=e.textInputHelper.textArea.value,o=e.textInputHelper.getTextValuesForMarkup(this,t);if(this.currentTextLines=o.textValues.lines,o.newPos){var s=this.editor.positionFromClientToMarkups(o.newPos.x,o.newPos.y),r=this.editor.sizeFromClientToMarkups(o.width,o.height);this.position.x=s.x,this.position.y=s.y,this.size.x=r.x,this.size.y=r.y}e.selectedMarkup===this||e.textInputHelper.firstEdit||(e.textInputHelper.textArea.value=n,e.textInputHelper.setStyle(i));var a=this.createSvgElement("text");a.setAttribute("id","markup"),a.setAttribute("alignment-baseline","middle"),this.shape.childNodes[0].removeChild(this.shape.markup),this.shape.childNodes[0].appendChild(a),this.shape.markup=a;var h=this.getLineHeight()*Zt*(this.lineHeight/100),u=this.getLineHeight()*Zt/2,l=u,c=u;this.currentTextLines.forEach(function(t){var e=this.createSvgElement("tspan");e.setAttribute("x",l),e.setAttribute("y",c),e.textContent=t,a.appendChild(e),c+=h}.bind(this))}},$t.setIsShapeVisible=function(t){this.shape.style.display=t?"block":"none"},$t.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.text=String(this.currentText),this.addMarkupMetadata(this.shape,t)},$t.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},$t.getLineHeight=function(){return this.style["font-size"]},$t.getTransform=function(){return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",Un(-this.rotation),")","scale(1,-1)"].join(" ")},$t.getTextTransform=function(){var t=this.getLineHeight();return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-t,")","rotate(",Un(-this.rotation),")","scale("+1/Zt+","+-1/Zt+")"].join(" ")},$t.cloneShape=function(t){t.shape=wn(),t.bindDomEvents()},$t.getBoundingRect=function(){var t=this.getClientPosition(),e=this.getClientSize();return{x:t.x-e.x/2,y:t.y-e.y/2,width:e.x,height:e.y}},Qt.prototype=Object.create(x.prototype),Qt.prototype.constructor=Qt;var te=Qt.prototype;function ee(t,e){x.call(this,t,"DELETE-CIRCLE",e.id),this.createCircle=new ue(t,e.id,e.position,e.size,e.rotation,e.getStyle())}te.redo=function(){var t=this.editor,e=this.position,i=this.size,n=new Jt(this.targetId,t,i);t.addMarkup(n),n.set(e,i,this.text),n.setStyle(this.style)},te.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&(this.editor.removeMarkup(t),t.destroy())},ee.prototype=Object.create(x.prototype),ee.prototype.constructor=ee;var ie=ee.prototype;function ne(t,e,i,n){x.call(this,t,"SET-CIRCLE",e.id),this.newPosition={x:i.x,y:i.y},this.newSize={x:n.x,y:n.y},this.oldPosition={x:e.position.x,y:e.position.y},this.oldSize={x:e.size.x,y:e.size.y}}ie.redo=function(){this.createCircle.undo()},ie.undo=function(){this.createCircle.redo()},ne.prototype=Object.create(x.prototype),ne.prototype.constructor=ne;var oe=ne.prototype;function se(t){G.call(this,t,l,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"])}oe.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},oe.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},oe.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newSize=t.newSize,!0)},oe.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.position.x-e.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-e.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(e,i)}},oe.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},se.prototype=Object.create(G.prototype),se.prototype.constructor=se;var re=se.prototype;function ae(t,e){B.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=In.bind(this),this.type=l,this.shape=Mn(),this.bindDomEvents()}re.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new ee(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},re.onMouseMove=function(t){G.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i=this.editor,n=this.getFinalMouseDraggingPosition();n=i.clientToMarkups(n.x,n.y);var o=Math.abs(this.firstPosition.x-n.x),s=Math.abs(this.firstPosition.y-n.y);new ne(i,e,{x:.5*(this.firstPosition.x+n.x),y:.5*(this.firstPosition.y+n.y)},this.size={x:o,y:s}).execute()}},re.onMouseDown=function(){if(G.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y;var i=this.firstPosition=t.clientToMarkups(this.initialX,this.initialY),n=this.size=t.sizeFromClientToMarkups(1,1);t.beginActionGroup();var o=t.getId();new ue(t,o,i,n,0,this.style).execute(),this.selectedMarkup=t.getMarkup(o),this.creationBegin()}},ae.prototype=Object.create(B.prototype),ae.prototype.constructor=ae;var he=ae.prototype;function ue(t,e,i,n,o,s){x.call(this,t,"CREATE-CIRCLE",e),this.selectOnExecution=!1,this.position={x:i.x,y:i.y},this.size={x:n.x,y:n.y},this.rotation=o,this.style=w(s)}he.getEditMode=function(){return new se(this.editor)},he.set=function(t,e){this.setSize(t,e.x,e.y)},he.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]),s=eo(t["fill-color"],t["fill-opacity"]),r=this.getTransform();kn(e,"d",i),kn(e,"stroke-width",n),kn(e,"stroke",o),kn(e,"fill",s),kn(e,"transform",r),bn(e,this.editor)},he.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},he.getPath=function(){var t=this.size;if(1===t.x||1===t.y)return[""];var e=this.style["stroke-width"],i=t.x-e,n=t.y-e,o=[];return ho(-.5*i,0,i,n,!1,o),o},ue.prototype=Object.create(x.prototype),ue.prototype.constructor=ue;var le=ue.prototype;function ce(t,e){x.call(this,t,"DELETE-CLOUD",e.id),this.createCloud=new xe(t,e.id,e.position,e.size,e.rotation,e.getStyle())}le.redo=function(){var t=this.editor,e=new ae(this.targetId,t);t.addMarkup(e),e.setSize(this.position,this.size.x,this.size.y),e.setRotation(this.rotation),e.setStyle(this.style)},le.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)},ce.prototype=Object.create(x.prototype),ce.prototype.constructor=ce;var de=ce.prototype;function pe(t,e,i,n){x.call(this,t,"SET-CLOUD",e.id),this.newPosition={x:i.x,y:i.y},this.newSize={x:n.x,y:n.y},this.oldPosition={x:e.position.x,y:e.position.y},this.oldSize={x:e.size.x,y:e.size.y}}de.redo=function(){this.createCloud.undo()},de.undo=function(){this.createCloud.redo()},pe.prototype=Object.create(x.prototype),pe.prototype.constructor=pe;var fe=pe.prototype;function ye(t){G.call(this,t,c,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"])}fe.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize,this.newStrokeWidth,this.newColor)},fe.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize,this.oldStrokeWidth,this.oldColor)},fe.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newSize=t.newSize,!0)},fe.applyState=function(t,e,i){var n=this.editor.getMarkup(t);if(n){(Math.abs(n.position.x-e.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-e.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(e,i)}},fe.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},ye.prototype=Object.create(G.prototype),ye.prototype.constructor=ye;var ve=ye.prototype;function ge(t,e){B.call(this,t,e,["stroke-width","stroke-linejoin","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=In.bind(this),this.type=c,this.shape=Mn(),this.bindDomEvents()}ve.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new ce(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1},ve.onMouseMove=function(t){G.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup;if(e&&this.creating){var i=this.editor,n=this.getFinalMouseDraggingPosition(),o=i.clientToMarkups(n.x,n.y);new pe(i,e,{x:(this.firstPosition.x+o.x)/2,y:(this.firstPosition.y+o.y)/2},this.size={x:Math.abs(o.x-this.firstPosition.x),y:Math.abs(o.y-this.firstPosition.y)}).execute()}},ve.onMouseDown=function(){if(G.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y;var i=this.firstPosition=t.clientToMarkups(this.initialX,this.initialY),n=this.size=t.sizeFromClientToMarkups(1,1);t.beginActionGroup();var o=t.getId();new xe(t,o,i,n,0,this.style).execute(),this.selectedMarkup=t.getMarkup(o),this.creationBegin()}},ge.prototype=Object.create(B.prototype),ge.prototype.constructor=ge;var me=ge.prototype;function xe(t,e,i,n,o,s){x.call(this,t,"CREATE-CLOUD",e),this.selectOnExecution=!1,this.position={x:i.x,y:i.y},this.size={x:n.x,y:n.y},this.rotation=o,this.style=w(s)}me.getEditMode=function(){return new ye(this.editor)},me.set=function(t,e){this.setSize(t,e.x,e.y)},me.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]),s=eo(t["fill-color"],t["fill-opacity"]),r=this.getTransform();kn(e,"d",i),kn(e,"stroke-width",n),kn(e,"stroke",o),kn(e,"fill",s),kn(e,"transform",r),bn(e,this.editor)},me.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)},me.getPath=function(){var t=this.position,e=this.size,i=this.style["stroke-width"],n=2*i;function o(t,e,i,n,o){return o.push("a"),o.push(i),o.push(n),o.push(0),o.push(1),o.push(1),o.push(t),o.push(e),o}function s(t,e,i,n,s){switch(t){case"LT":return o(e,-i,e,i,s);case"RT":return o(e,i,e,i,s);case"RB":return o(-e,i,e,i,s);case"LB":return o(-e,-i,e,i,s)}}function r(t,e,i,n){var o=2*i,s=Math.abs(e-t-n),r=Math.round(s/o),a=.05*(o+=(s-o*r)/r),h=3.5*(i=.5*o)/3;return{count:r,radius:i,diameter:o,p1:{x:a,y:-h},p2:{x:o-a,y:-h},p3:{x:o,y:0}}}var a=t.x,h=t.y,u=t.x+e.x,l=t.y+e.y,c=5*n,d=[];if(e.x<c||e.y<c){var p=e.x-i,f=e.y-i;ho(b=.5*-p,w=0,p,f,!1,d)}else{var y=r(a,u,n,i),v=r(h,l,n,i),g=y.diameter,m=v.diameter,x=y.radius,M=v.radius;y=r(a+g,u-g,n,i),v=r(h+m,l-m,n,i);var k=.5*i,b=.5*-e.x+k+x,w=.5*-e.y+k+2*M;d.push("M"),d.push(b),d.push(w),s("LT",x,M,0,d),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(i.p1.x),e.push(i.p1.y),e.push(i.p2.x),e.push(i.p2.y),e.push(i.p3.x),e.push(i.p3.y)}(y,d),s("RT",x,M,0,d),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(-i.p1.y),e.push(i.p1.x),e.push(-i.p2.y),e.push(i.p2.x),e.push(-i.p3.y),e.push(i.p3.x)}(v,d),s("RB",x,M,0,d),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(-i.p1.x),e.push(-i.p1.y),e.push(-i.p2.x),e.push(-i.p2.y),e.push(-i.p3.x),e.push(-i.p3.y)}(y,d),s("LB",x,M,0,d),function(t,e){for(var i=t,n=0;n<i.count;++n)e.push("c"),e.push(i.p1.y),e.push(-i.p1.x),e.push(i.p2.y),e.push(-i.p2.x),e.push(i.p3.y),e.push(-i.p3.x)}(v,d)}return d.push("z"),d},xe.prototype=Object.create(x.prototype),xe.prototype.constructor=xe;var Me=xe.prototype;function ke(t,e){B.call(this,t,e,["stroke-width","stroke-color","stroke-opacity"]),this.addMarkupMetadata=In.bind(this),this.shape=Mn(),this.bindDomEvents()}Me.redo=function(){var t=this.editor,e=new ge(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size),e.setRotation(this.rotation),e.setStyle(this.style)},Me.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)},ke.prototype=Object.create(B.prototype),ke.prototype.constructor=ke;var be=ke.prototype;function we(t,e,i){G.call(this,t,e,i),this.smoothen=!0,this.bufferSize=8}be.set=function(t,e,i,n){this.rotation=0,this.isAbsoluteCoords=n,this.isAbsoluteCoords?this.updatePath(i):(this.locations=i.slice(0),this.size.x=0===e.x?1:e.x,this.size.y=0===e.y?1:e.y,this.setSize(t,e.x,e.y),this.updateStyle())},be.setPosition=function(t,e){this.position.x=t,this.position.y=e;var i=this.shape,n=this.getTransform();kn(i,"transform",n),bn(i,this.editor)},be.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]);kn(e,"stroke-width",n),kn(e,"stroke-linejoin","round"),kn(e,"stroke-linecap","round"),kn(e,"stroke",o),kn(e,"fill","none"),this.updatePath(i),bn(e,this.editor)},be.updatePath=function(t){var e=this.shape,i=this.isAbsoluteCoords?"scale(1)":this.getTransform();kn(e,"transform",i),kn(e,"d",t)},be.setSize=function(t,e,i){e=0===e?1:e,i=0===i?1:i;for(var n=this.locations,o=n.length,s=e/this.size.x,r=i/this.size.y,a=0;a<o;++a){var h=n[a];h.x*=s,h.y*=r}this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},be.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),t.locations=this.locations.map((function(t){return[t.x,t.y].join(" ")})).join(" "),this.addMarkupMetadata(this.shape,t)},be.getPath=function(){var t=[],e=this.locations,i=e.length;if(i>1){t.push("M"),t.push(+e[0].x.toFixed(6)),t.push(+e[0].y.toFixed(6));for(var n=1;n<i;++n){var o=e[n-1],s=e[n];t.push("l"),t.push(+(s.x-o.x).toFixed(6)),t.push(+(s.y-o.y).toFixed(6))}}return t},we.prototype=Object.create(G.prototype);var Ee=we.prototype;function Te(t,e){x.call(this,t,"DELETE-FREEHAND",e.id),this.createFreehand=new De(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle())}Ee.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type===this.type){var i=this.deletePen(t);return i.addToHistory=!e,i.execute(),!0}return!1},Ee.onMouseMove=function(t){if(G.prototype.onMouseMove.call(this,t),this.selectedMarkup&&this.creating){var e=this.editor,i=e.getMousePosition(),n=this.movements,o=e.clientToMarkups(i.x,i.y);if(this.smoothen)this.appendToBuffer(o),this.amendPath();else{var s=this.lastX-i.x,r=this.lastY-i.y;n.length>1&&s*s+r*r<25?(n[n.length-1]=o,this.removeFromAbsolutePath(1)):(n.push(o),this.lastX=i.x,this.lastY=i.y),this.addToAbsolutePath([o])}this.setPen(this.position,this.size,this.absolutePath,!0).execute()}},Ee.onMouseDown=function(){if(G.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor;t.snapper&&t.snapper.clearSnapped();var e=t.getMousePosition();this.lastX=this.initialX=e.x,this.lastY=this.initialY=e.y;var i=this.position=t.clientToMarkups(this.initialX,this.initialY);this.movements=[i],this.smoothen&&(this.buffer=[],this.movementsLastIndex=null,this.appendToBuffer(i));var n=this.size=t.sizeFromClientToMarkups(1,1);t.beginActionGroup();var o=t.getId();this.createPen(o,i,n,0,[{x:0,y:0}]).execute(),this.createAbsolutePath(i),this.selectedMarkup=t.getMarkup(o),this.creationBegin()}},Ee.onMouseUp=function(){if(this.creating){var t=this.movements,e=this.viewer.impl.camera.right-this.viewer.impl.camera.left,i=this.viewer.impl.camera.top-this.viewer.impl.camera.bottom,n=(t=co(t,1e-8*(e*e+i*i),!0)).map((function(t){return t.x})),o=t.map((function(t){return t.y})),s=Math.min.apply(null,n),r=Math.min.apply(null,o),a=Math.max.apply(null,n)-s,h=Math.max.apply(null,o)-r,u={x:s+.5*a,y:r+.5*h},l=this.size={x:a,y:h},c=t.map((function(t){return{x:t.x-u.x,y:t.y-u.y}}));this.setPen(u,l,c,!1).execute(),G.prototype.onMouseUp.call(this)}else G.prototype.onMouseUp.call(this)},Ee.createPen=function(){console.error("createPen not implemented")},Ee.deletePen=function(){console.error("deletePen not implemented")},Ee.setPen=function(){console.error("setPen not implemented")},Ee.useWithSnapping=function(){return!1},Ee.createAbsolutePath=function(t){this.absolutePath="M"+ +t.x.toFixed(6)+" "+ +t.y.toFixed(6),this.absolutePathIndexes=[0]},Ee.removeFromAbsolutePath=function(t){(t=Math.min(t,this.absolutePathIndexes.length))>0&&(this.absolutePath=this.absolutePath.slice(0,this.absolutePathIndexes[this.absolutePathIndexes.length-t]),this.absolutePathIndexes.splice(this.absolutePathIndexes.length-t))},Ee.addToAbsolutePath=function(t){for(var e=0;e<t.length;e++)this.absolutePathIndexes.push(this.absolutePath.length),this.absolutePath+=" L"+ +t[e].x.toFixed(6)+" "+ +t[e].y.toFixed(6)},Ee.appendToBuffer=function(t){for(this.buffer.push(t);this.buffer.length>this.bufferSize;)this.buffer.shift()},Ee.amendPath=function(){var t=this.getAveragePoint(0);if(t){this.movementsLastIndex&&(this.removeFromAbsolutePath(this.movements.length-this.movementsLastIndex),this.movements.splice(this.movementsLastIndex));var e=[t];this.movementsLastIndex=this.movements.length+1;for(var i=2;i<this.buffer.length;i+=2){var n=this.getAveragePoint(i);e.push(n)}this.addToAbsolutePath(e),this.movements.push.apply(this.movements,e)}},Ee.getAveragePoint=function(t){var e=this.buffer.length;if(e%2==1||e>=this.bufferSize){for(var i,n=0,o=0,s=0,r=t;r<e;r++)s++,n+=(i=this.buffer[r]).x,o+=i.y;return{x:n/s,y:o/s}}return null},Te.prototype=Object.create(x.prototype),Te.prototype.constructor=Te;var Se=Te.prototype;function Ae(t,e,i,n,o,s){x.call(this,t,"SET-FREEHAND",e.id),this.position=i,this.size=n,this.locations=s?o:o.slice(0),this.isAbsoluteCoords=s}Se.redo=function(){this.createFreehand.undo()},Se.undo=function(){this.createFreehand.redo()},Ae.prototype=Object.create(x.prototype),Ae.prototype.constructor=Ae;var Ce=Ae.prototype;function Ie(t){we.call(this,t,d,["stroke-width","stroke-color","stroke-opacity"])}Ce.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.isAbsoluteCoords)},Ce.undo=function(){},Ce.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.isAbsoluteCoords?t.locations:t.locations.slice(0),this.position=t.position,this.size=t.size,this.isAbsoluteCoords=t.isAbsoluteCoords,!0)},Ce.isIdentity=function(){return!1},Ie.prototype=Object.create(we.prototype),Ie.prototype.constructor=Ie;var ze=Ie.prototype;function Pe(t,e){ke.call(this,t,e),this.type=d}function De(t,e,i,n,o,s,r){x.call(this,t,"CREATE-FREEHAND",e),this.selectOnExecution=!1,this.position=i,this.size=n,this.rotation=o,this.movements=s.slice(0),this.style=w(r)}ze.createPen=function(t,e,i,n,o){return new De(this.editor,t,e,i,n,o,this.style)},ze.deletePen=function(t){return new Te(this.editor,t)},ze.setPen=function(t,e,i,n){return new Ae(this.editor,this.selectedMarkup,t,e,i,n)},Pe.prototype=Object.create(ke.prototype),Pe.prototype.constructor=Pe,Pe.prototype.getEditMode=function(){return new Ie(this.editor)},De.prototype=Object.create(x.prototype),De.prototype.constructor=De;var Re=De.prototype;function Le(t,e){x.call(this,t,"DELETE-POLYLINE",e.id),this.createPolyline=new Ue(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle(),e.closed)}Re.redo=function(){var t=this.editor,e=new Pe(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,!1),e.setRotation(this.rotation),e.setStyle(this.style)},Re.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)},Le.prototype=Object.create(x.prototype),Le.prototype.constructor=Le;var He=Le.prototype;function _e(t,e,i,n,o,s){x.call(this,t,"SET-POLYLINE",e.id),this.position=i,this.size=n,this.locations=o.concat(),this.closed=s}He.redo=function(){this.createPolyline.undo()},He.undo=function(){this.createPolyline.redo()},_e.prototype=Object.create(x.prototype),_e.prototype.constructor=_e;var Ne=_e.prototype;Ne.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.closed)},Ne.undo=function(){},Ne.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.locations.concat(),this.position=t.position,this.size=t.size,this.closed=t.closed,!0)},Ne.isIdentity=function(){return!1};function Oe(t){G.call(this,t,f,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}Oe.prototype=Object.create(G.prototype),Oe.prototype.constructor=Oe;var Ve=Oe.prototype;function Be(t,e){var i=function(t,e){var i=t.map((function(t){return t[e]}));return Math.min.apply(null,i)},n=function(t,e){var i=t.map((function(t){return t[e]}));return Math.max.apply(null,i)},o=i(t,"x"),s=i(t,"y"),r=n(t,"x")-o,a=n(t,"y")-s;e.size={x:r,y:a},e.position={x:o+.5*r,y:s+.5*a};var h=e.position;return t.map((function(t){return{x:t.x-h.x,y:t.y-h.y}}))}function Fe(t,e){B.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=In.bind(this),this.type=f,this.shape=Mn("path"),this.bindDomEvents()}Ve.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=this.movements;if(!(this.creating&&i.length>=2)){var n=new Le(this.editor,t);return n.addToHistory=!e,n.execute(),this.creationEnd(),!0}i.pop(),i.pop();var o=i.length-1;if(o>=0){var s=i[o];i.push(s);var r=Be(i,this);new _e(this.editor,t,this.position,this.size,r).execute()}}return!1},Ve.onMouseMove=function(t){G.prototype.onMouseMove.call(this,t);var e=this.editor,i=this.selectedMarkup;if(i&&this.creating){this.dragging=!0;var n=this.movements;n.splice(n.length-1,1);var o=e.getMousePosition();o=e.clientToMarkups(o.x,o.y),n.length>=2&&Kn(n[0],o,25,this.editor)&&(o=n[0]),n.push(o);var s=Be(n,this);new _e(e,i,this.position,this.size,s).execute()}},Ve.onMouseDown=function(t){if(G.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var e=this.editor,i=e.getMousePosition();i=e.clientToMarkups(i.x,i.y);var n=this.size=e.sizeFromClientToMarkups(1,1);this.movements=[i,i],e.beginActionGroup();var o=e.getId();new Ue(e,o,i,n,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=e.getMarkup(o),this.creationBegin()}},Ve.onMouseUp=function(){if(G.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var t=this.editor,e=t.getMousePosition(),i=this.movements,n=!1;if(e=t.clientToMarkups(e.x,e.y),!(i.length>1&&Kn(i[i.length-2],e,25,this.editor))){i.length>2&&Kn(i[0],e,25,this.editor)&&(e=i[0],n=!0),i.splice(i.length-1,1),n||(i.push(e),i.push(e));var o=this.selectedMarkup,s=Be(i,o);new _e(t,o,o.position,o.size,s,n).execute(),n&&this.creationEnd()}}},Ve.destroy=function(){this.onMouseDoubleClick(),G.prototype.creationEnd.call(this),G.prototype.destroy.call(this)},Ve.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),G.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},Ve.creationCancel=function(){G.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},Ve.onMouseDoubleClick=function(t){if(this.creating){var e=this.movements;if(e.splice(Math.max(0,e.length-1)),e.length<2)this.creationCancel();else{var i=this.selectedMarkup,n=Be(e,i);new _e(this.editor,i,i.position,i.size,n,this.closed).execute(),this.creationEnd()}}},Fe.prototype=Object.create(B.prototype),Fe.prototype.constructor=Fe;var je=Fe.prototype;function Ue(t,e,i,n,o,s,r,a){x.call(this,t,"CREATE-POLYLINE",e),this.selectOnExecution=!1,this.position=i,this.size=n,this.rotation=o,this.movements=s.concat(),this.closed=a,this.style=w(r)}je.getEditMode=function(){return new Oe(this.editor)},je.set=function(t,e,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===e.x?1:e.x,this.size.y=0===e.y?1:e.y,this.closed=n,this.setSize(t,e.x,e.y),this.updateStyle()},je.updateStyle=function(){var t=this.style,e=this.shape,i=this.style["stroke-width"],n=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]),o=this.closed?eo(t["fill-color"],t["fill-opacity"]):"none",s=this.getTransform();kn(e,"d",this.getPath().join(" ")),kn(e,"stroke-width",i),kn(e,"stroke",n),kn(e,"fill",o),kn(e,"transform",s),bn(e,this.editor)},je.setSize=function(t,e,i){e=0===e?1:e,i=0===i?1:i;for(var n=this.locations,o=n.length,s=e/this.size.x,r=i/this.size.y,a=0;a<o;++a){var h=n[a];h.x*=s,h.y*=r}this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},je.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),t.locations=this.locations.map((function(t){return[t.x,t.y].join(" ")})).join(" "),this.addMarkupMetadata(this.shape,t)},je.getPath=function(){var t=[],e=this.locations,i=e.length;if(0===i)return" ";t.push("M"),t.push(e[0].x),t.push(e[0].y);for(var n=1;n<i;++n){var o=e[n-1],s=e[n];t.push("l"),t.push(s.x-o.x),t.push(s.y-o.y)}return this.closed&&t.push("z"),t},Ue.prototype=Object.create(x.prototype),Ue.prototype.constructor=Ue;var Ge=Ue.prototype;function We(t,e){x.call(this,t,"DELETE-POLYCLOUD",e.id),this.createPolycloud=new ti(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle(),e.closed)}Ge.redo=function(){var t=this.editor,e=new Fe(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,this.closed),e.setRotation(this.rotation),e.setStyle(this.style)},Ge.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)},We.prototype=Object.create(x.prototype),We.prototype.constructor=We;var Ke=We.prototype;function Ye(t,e,i,n,o,s){x.call(this,t,"SET-POLYCLOUD",e.id),this.position=i,this.size=n,this.locations=o.concat(),this.closed=s}Ke.redo=function(){this.createPolycloud.undo()},Ke.undo=function(){this.createPolycloud.redo()},Ye.prototype=Object.create(x.prototype),Ye.prototype.constructor=Ye;var Xe=Ye.prototype;Xe.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.closed)},Xe.undo=function(){},Xe.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.locations.concat(),this.position=t.position,this.size=t.size,this.closed=t.closed,!0)},Xe.isIdentity=function(){return!1};function qe(t){G.call(this,t,y,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}qe.prototype=Object.create(G.prototype),qe.prototype.constructor=qe;var Ze=qe.prototype;function Je(t,e){var i=function(t,e){var i=t.map((function(t){return t[e]}));return Math.min.apply(null,i)},n=function(t,e){var i=t.map((function(t){return t[e]}));return Math.max.apply(null,i)},o=e.style["stroke-width"],s=2*o+.5*o,r=i(t,"x")-s,a=i(t,"y")-s,h=n(t,"x")+s-r,u=n(t,"y")+s-a;e.size={x:h,y:u},e.position={x:r+.5*h,y:a+.5*u};var l=e.position;return t.map((function(t){return{x:t.x-l.x,y:t.y-l.y}}))}function $e(t,e){B.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"]),this.addMarkupMetadata=In.bind(this),this.type=y,this.locations=[],this.shape=Mn(),this.bindDomEvents()}Ze.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=this.movements;if(!(this.creating&&i.length>=2)){var n=new We(this.editor,t);return n.addToHistory=!e,n.execute(),this.creationEnd(),!0}i.pop(),i.pop();var o=i.length-1;if(o>=0){var s=i[o];i.push(s);var r=Je(i,this);new Ye(this.editor,t,this.position,this.size,r).execute()}}return!1},Ze.onMouseMove=function(t){G.prototype.onMouseMove.call(this,t);var e=this.editor,i=this.selectedMarkup;if(i&&this.creating){this.dragging=!0;var n=this.movements;n.splice(n.length-1,1);var o=e.getMousePosition();o=e.clientToMarkups(o.x,o.y),n.length>=2&&Kn(n[0],o,25,this.editor)&&(o=n[0]),n.push(o);var s=Je(n,this);new Ye(e,i,this.position,this.size,s).execute()}},Ze.onMouseDown=function(){if(G.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var t=this.editor,e=t.getMousePosition();e=t.clientToMarkups(e.x,e.y);var i=this.size=t.sizeFromClientToMarkups(1,1);this.movements=[e,e],t.beginActionGroup();var n=t.getId();new ti(t,n,e,i,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=t.getMarkup(n),this.creationBegin()}},Ze.onMouseUp=function(t){if(G.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var e=this.editor,i=e.getMousePosition(),n=this.movements,o=!1;if(i=e.clientToMarkups(i.x,i.y),!(n.length>1&&Kn(n[n.length-2],i,25,this.editor))){n.length>2&&Kn(n[0],i,25,this.editor)&&(i=n[0],o=!0),n.splice(n.length-1,1),o||(n.push(i),n.push(i));var s=this.selectedMarkup,r=Je(n,s);new Ye(e,s,s.position,s.size,r,o).execute(),o&&this.creationEnd()}}},Ze.onMouseDoubleClick=function(t){if(this.creating){var e=this.movements;if(e.splice(Math.max(0,e.length-1)),e.length<2)this.creationCancel();else{var i=this.selectedMarkup,n=Je(e,i);new Ye(this.editor,i,i.position,i.size,n,!0).execute(),this.creationEnd()}}},Ze.destroy=function(){this.onMouseDoubleClick(),G.prototype.creationEnd.call(this),G.prototype.destroy.call(this)},Ze.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),G.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},Ze.creationCancel=function(){G.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},$e.prototype=Object.create(B.prototype),$e.prototype.constructor=$e;var Qe=$e.prototype;function ti(t,e,i,n,o,s,r,a){x.call(this,t,"CREATE-POLYCLOUD",e),this.selectOnExecution=!1,this.position=i,this.size=n,this.rotation=o,this.movements=s.concat(),this.style=w(r),this.closed=a}Qe.getEditMode=function(){return new qe(this.editor)},Qe.set=function(t,e,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===e.x?1:e.x,this.size.y=0===e.y?1:e.y,this.closed=n,this.setSize(t,e.x,e.y),this.updateStyle()},Qe.updateStyle=function(){var t=this.style,e=this.shape,i=this.getPath().join(" "),n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]),s=this.closed?eo(t["fill-color"],t["fill-opacity"]):"none",r=this.getTransform();kn(e,"d",i),kn(e,"stroke-width",n),kn(e,"stroke",o),kn(e,"fill",s),kn(e,"transform",r),bn(e,this.editor)},Qe.setSize=function(t,e,i){e=0===e?1:e,i=0===i?1:i;for(var n=this.locations,o=n.length,s=e/this.size.x,r=i/this.size.y,a=0;a<o;++a){var h=n[a];h.x*=s,h.y*=r}this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.size.y=i,this.updateStyle()},Qe.setMetadata=function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),t.locations=this.locations.map((function(t){return[t.x,t.y].join(" ")})).join(" "),this.addMarkupMetadata(this.shape,t)},Qe.getPath=function(){function t(t,e,i,n){var o=e.radius,s=i.radius,r=t.length;if(o>0&&s>0&&o+s>r&&Math.abs(o-s)<r){var a=t.pointA.x,h=t.pointA.y,u=t.pointB.x,l=t.pointB.y,c=.25*Math.sqrt((r+o+s)*(r+o-s)*(r-o+s)*(-r+o+s)),d=(a+u)/2+(u-a)*(o*o-s*s)/(2*r*r),p=2*(h-l)/(r*r)*c,f=(h+l)/2+(l-h)*(o*o-s*s)/(2*r*r),y=2*(a-u)/(r*r)*c,v=d+p,g=d-p,m=f-y,x=f+y;if(Math.abs((v-a)*(v-a)+(m-h)*(m-h)-o*o)>1e-7){var M=m;m=x,x=M}var k=new THREE.Vector3(v,m,0);return Math.sign(k.clone().sub(t.pointA).cross(t.vecAB).z)!==n&&k.set(g,x,0),e.pointB=k.clone(),i.pointA=k.clone(),!0}return!1}function e(t,e,i){var n=t.bodyCount;if(0!==n){var o=t.bodyRadius,s=t.bodyDiameter,r=.05*s,a=3.5*o/3,h=new THREE.Vector3(r,e*-a),u=new THREE.Vector3(s-r,e*-a),l=new THREE.Vector3(s,0),c=Math.acos(t.vecAB.x)*(t.vecAB.y<0?-1:1),d=(new THREE.Matrix4).makeRotationZ(c);h.applyMatrix4(d),u.applyMatrix4(d),l.applyMatrix4(d);for(var p=0;p<n;++p)i.push("c"),i.push(h.x),i.push(h.y),i.push(u.x),i.push(u.y),i.push(l.x),i.push(l.y)}}function i(t,e,i,n){e&&(n.push("M"),n.push(t.pointA.x),n.push(t.pointA.y));var o=1===i?t.large:!t.large;return 0!==t.radius&&(n.push("a"),n.push(t.radius),n.push(t.radius),n.push(0),n.push(o?1:0),n.push(1===i?1:0),n.push(t.pointB.x-t.pointA.x),n.push(t.pointB.y-t.pointA.y)),n}var n=2*this.style["stroke-width"],o=function(t){switch(t.length){case 0:case 1:return 1;case 2:var e=t[0],i=t[1];return e.y>i.y?1:-1;default:var n=t[0],o=t[1],s=t[2];return(o.x-n.x)*(o.y+n.y)+(s.x-o.x)*(s.y+o.y)<0?1:-1}}(this.locations),s=this.closed,r=[],a=function(t,e){for(var i=t.length,n=[],o=i-(e?0:1),s=0;s<o;++s){var r=t[s],a=t[(s+1)%i],h=a.x-r.x,u=a.y-r.y,l=Math.sqrt(h*h+u*u);n.push({index:s,pointA:new THREE.Vector3(r.x,r.y,0),pointB:new THREE.Vector3(a.x,a.y,0),vecAB:new THREE.Vector3(h/l,u/l,0),vecBA:new THREE.Vector3(-h/l,-u/l,0),length:l})}return n}(this.locations,s),h=function(t,e,i){for(var n=[],o=t.length,s=0;s<o;++s){var r=t[0!==s?s-1:o-1],a=t[s],h=r.vecBA.clone().cross(a.vecAB).z<0;r.length<e||a.length<e||0===s&&!i?n.push({pointA:a.pointA.clone(),pointB:a.pointA.clone(),radius:0,large:!1}):n.push({pointA:a.pointA.clone().add(r.vecBA.clone().multiplyScalar(e)),pointB:a.pointA.clone().add(a.vecAB.clone().multiplyScalar(e)),radius:e,large:h})}return n}(a,n,s),u=h.length;!function(e,i,n,o){for(var s=2*n,r=e.length,a=0;a<r;++a){var h=e[a],u=i[a],l=i[(a+1)%r];h.bodyA=h.vecAB.clone().multiplyScalar(u.radius).add(h.pointA),h.bodyB=h.vecBA.clone().multiplyScalar(l.radius).add(h.pointB),t(h,u,l,o)?(h.body=0,h.bodyDiameter=h.bodyCount=0):(h.body=h.bodyB.clone().sub(h.bodyA).length(),h.bodyCount=Math.round(h.body/s),0===h.bodyCount&&h.body>.5*n&&(h.bodyCount=1),h.bodyDiameter=s+(h.body-s*h.bodyCount)/h.bodyCount),h.bodyRadius=.5*h.bodyDiameter}}(a,h,n,o);for(var l=0;l<u;++l)i(h[l],0===l,o,r),e(a[l],o,r);return s&&r.push("z"),r},ti.prototype=Object.create(x.prototype),ti.prototype.constructor=ti;var ei=ti.prototype;function ii(t,e){x.call(this,t,"DELETE-HIGHLIGHT",e.id),this.createHighlight=new ui(t,e.id,e.position,e.size,e.rotation,e.locations,e.getStyle())}ei.redo=function(){var t=this.editor,e=new $e(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,this.closed),e.setRotation(this.rotation),e.setStyle(this.style)},ei.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)},ii.prototype=Object.create(x.prototype),ii.prototype.constructor=ii;var ni=ii.prototype;function oi(t,e,i,n,o,s){x.call(this,t,"SET-HIGHLIGHT",e.id),this.position=i,this.size=n,this.locations=s?o:o.slice(0),this.isAbsoluteCoords=s}ni.redo=function(){this.createHighlight.undo()},ni.undo=function(){this.createHighlight.redo()},oi.prototype=Object.create(x.prototype),oi.prototype.constructor=oi;var si=oi.prototype;function ri(t){we.call(this,t,p,["stroke-width","stroke-color","stroke-opacity"]);var e=t.getStrokeWidth();this.style["stroke-opacity"]=.5,this.style["stroke-color"]="#ffff00",this.style["stroke-width"]=4*e}si.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.set(this.position,this.size,this.locations,this.isAbsoluteCoords)},si.undo=function(){},si.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.locations=t.isAbsoluteCoords?t.locations:t.locations.slice(0),this.position=t.position,this.size=t.size,this.isAbsoluteCoords=t.isAbsoluteCoords,!0)},si.isIdentity=function(){return!1},ri.prototype=Object.create(we.prototype),ri.prototype.constructor=ri;var ai=ri.prototype;function hi(t,e){ke.call(this,t,e),this.type=p}function ui(t,e,i,n,o,s,r){x.call(this,t,"CREATE-HIGHLIGHT",e),this.selectOnExecution=!1,this.position=i,this.size=n,this.rotation=o,this.movements=s.slice(0),this.style=w(r)}ai.createPen=function(t,e,i,n,o){return new ui(this.editor,t,e,i,n,o,this.style)},ai.deletePen=function(t){return new ii(this.editor,t)},ai.setPen=function(t,e,i,n){return new oi(this.editor,this.selectedMarkup,t,e,i,n)},hi.prototype=Object.create(ke.prototype),hi.prototype.constructor=hi,hi.prototype.getEditMode=function(){return new ri(this.editor)},ui.prototype=Object.create(x.prototype),ui.prototype.constructor=ui;var li=ui.prototype;function ci(t,e){x.call(this,t,"DELETE-DIMENSION",e.id),this.createDimension=new ki(t,e.id,e.secondAnchor,e.firstAnchor,e.currentText,e.getStyle())}li.redo=function(){var t=this.editor,e=new hi(this.targetId,t);t.addMarkup(e),e.set(this.position,this.size,this.movements,!1),e.setRotation(this.rotation),e.setStyle(this.style)},li.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)},ci.prototype=Object.create(x.prototype),ci.prototype.constructor=ci;var di=ci.prototype;function pi(t,e,i,n,o){x.call(this,t,"SET-DIMENSION",e.id),this.newFirstAnchor={x:i.x,y:i.y},this.newSecondAnchor={x:n.x,y:n.y},this.oldFirstAnchor={x:e.firstAnchor.x,y:e.firstAnchor.y},this.oldSecondAnchor={x:e.secondAnchor.x,y:e.secondAnchor.y},this.newText=o,this.oldText=e.currentText}di.redo=function(){this.createDimension.undo()},di.undo=function(){this.createDimension.redo()},pi.prototype=Object.create(x.prototype),pi.prototype.constructor=pi;var fi=pi.prototype;fi.redo=function(){this.applyState(this.newFirstAnchor,this.newSecondAnchor,this.newText)},fi.undo=function(){this.applyState(this.oldFirstAnchor,this.oldSecondAnchor,this.oldText)},fi.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newFirstAnchor=t.newFirstAnchor,this.newSecondAnchor=t.newSecondAnchor,this.newText=t.newText,!0)},fi.applyState=function(t,e,i){var n=this.editor.getMarkup(this.targetId);n&&n.set(t.x,t.y,e.x,e.y,i)},fi.isIdentity=function(){return this.newText===this.oldText&&(!this.newFirstAnchor||!this.newSecondAnchor||this.newFirstAnchor.x===this.oldFirstAnchor.x&&this.newFirstAnchor.y===this.oldFirstAnchor.y&&this.newSecondAnchor.x===this.oldSecondAnchor.x&&this.newSecondAnchor.y===this.oldSecondAnchor.y)};var yi,vi=Autodesk.Viewing.MeasureCommon;function gi(t){var e=this;G.call(this,t,g,["stroke-width","stroke-color","stroke-opacity","font-size","font-family","font-style","font-weight"]),this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.measurement=new vi.Measurement(vi.MeasurementTypes.MEASUREMENT_DISTANCE);var i=this.viewer,n=i.getExtension("Autodesk.Measure");function o(){e.cancelEditModeChange=!0,t.enterEditMode()}n||(console.error("Demension markup cant work without measure extension. Please load measure extension first"),o()),this.sharedMeasureConfig=n.sharedMeasureConfig,(n.forceCalibrate||i.model.isLeaflet()||i.model.isPdf(!0))&&!n.calibrationTool.isCalibrated()&&(n.openCalibrationRequiredDialog("dimension"),o())}gi.prototype=Object.create(G.prototype),gi.prototype.constructor=gi;var mi=gi.prototype;mi.deleteMarkup=function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new ci(this.editor,t);return i.addToHistory=!e,i.execute(),this.creating=!1,this.dragging=!1,!0}return!1},mi.updateTextBoxStyle=function(t){this.isTextInputHelperActive()&&(t||(t=this.textInputHelper.textMarkup.getStyle()),this.textInputHelper.setStyle(t),this.updateTextBox(this.textInputHelper.textMarkup))},mi.setStyle=function(t){G.prototype.setStyle.call(this,t),this.updateTextBoxStyle(t)},mi.notifyAllowNavigation=function(t){t&&this.isTextInputHelperActive()&&this.textInputHelper.acceptAndExit()},mi.creationBegin=function(){G.prototype.creationBegin.call(this)},mi.creationEnd=function(){this.dragging=!1,G.prototype.creationEnd.call(this)},mi.isMinSizeValid=function(){if(0!==this.minSize){var t=this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x,this.selectedMarkup.size.y);return t.x*t.x>=this.minSize*this.minSize}return!0},mi.creationCancel=function(){G.prototype.creationCancel.call(this),this.creating=!1,this.dragging=!1},mi.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),this.textInputHelper.destroy(),this.textInputHelper=null),this.updateViewportId(),G.prototype.destroy.call(this)},mi.getDistance=function(){if(this.measurement.computeResult(this.measurement.picks,this.viewer),this.viewer.model&&this.measurement.distanceXYZ){var t=Autodesk.Viewing.Private.convertUnits(this.viewer.model.getUnitString(),this.sharedMeasureConfig.units,this.sharedMeasureConfig.calibrationFactor,this.measurement.distanceXYZ);return Autodesk.Viewing.Private.formatValueWithUnits(t,this.sharedMeasureConfig.units,3,this.sharedMeasureConfig.precision)}return null},mi.updateMeasurement=function(t){var e=this.editor,i=this.measurement.getPick(t);return yi?(i.geomType=vi.SnapType.SNAP_VERTEX,i.geomVertex=yi,i.intersectPoint=yi):e.snapper.copyResults(i),i},mi.updateViewportId=function(t){this.viewer.model&&this.viewer.model.is2d()&&(t?(this.viewer.impl.updateViewportId(t),this.editor.snapper.setViewportId(t)):(this.viewer.impl.updateViewportId(0),this.editor.snapper.setViewportId(null)))},mi.pickFirstAnchor=function(){var t=this.editor;this.measurement.clearAllPicks();var e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y,this.firstAnchor=t.positionFromClientToMarkups(this.initialX,this.initialY),t.beginActionGroup();var i=t.getId();new ki(t,i,this.firstAnchor,null,this.currentText,this.style).execute(),this.selectedMarkup=t.getMarkup(i),this.creationBegin();var n=this.updateMeasurement(1);this.updateViewportId(n.viewportIndex2d)},mi.pickSecondAnchor=function(t){var e=this.editor,i=this.selectedMarkup;if(this.secondAnchor=this.getFinalMouseDraggingPosition(),this.updateMeasurement(2),vi.correctPerpendicularPicks(this.measurement.getPick(1),this.measurement.getPick(2),this.viewer,e.snapper)){var n=vi.getSnapResultPosition(this.measurement.getPick(2),this.viewer);this.secondAnchor=e.project(n),e.snapper.indicator.render()}var o=e.positionFromClientToMarkups(this.secondAnchor.x,this.secondAnchor.y);this.size.x=i.size.x,this.size.y=i.size.y,i.currentText=this.getDistance(),new pi(e,i,this.firstAnchor,o,i.currentText).execute(),new j(e,i,this.style).execute(),t&&!i.currentText&&this.isMinSizeValid()&&(i.currentText="",this.editor.selectMarkup(null),this.updateTextBox(i))},mi.onMouseDown=function(t){if(!Autodesk.Viewing.Private.isRightClick(t,this.viewer.navigation))if(yi=null,this.isTextInputHelperActive())this.textInputHelper.acceptAndExit();else if(G.prototype.onMouseDown.call(this),!this.selectedMarkup||this.creating){var e=this.editor.snapper.isSnapped();this.selectedMarkup||this.creating||!e?this.selectedMarkup&&this.creating&&(e?this.pickSecondAnchor(!0):(this.deleteMarkup(this.selectedMarkup,!0),this.creating=!0),this.updateViewportId(),this.creationEnd()):this.pickFirstAnchor()}},mi.onMouseUp=function(t){this.dragging&&(this.onMouseDown(t),this.dragging=!1)},mi.onMouseMove=function(t){yi=null,this.selectedMarkup&&this.creating&&(this.dragging=!0,this.pickSecondAnchor(!1))},mi.getFinalMouseDraggingPosition=function(){var t=this.editor,e=t.getBounds(),i=t.getMousePosition();t.snapper.isSnapped()||t.viewer.model&&t.viewer.model.is2d()&&(yi=vi.inverseProject(i,t.viewer));var n=this.initialX,o=this.initialY,s=Math.min(Math.max(e.x,i.x),e.x+e.width),r=Math.min(Math.max(e.y,i.y),e.y+e.height);(s==n&&r==o&&(s++,r++),t.input.constrainAxis&&t.viewer.model.is2d())&&(Math.abs(s-n)>Math.abs(r-o)?r=o:s=n,t.snapper.onMouseMove({x:s,y:r}),t.snapper.isSnapped()?(t.snapper.copyResults(this.measurement.getPick(2)),yi=null):yi=vi.inverseProject({x:s,y:r},t.viewer));return{x:s,y:r}},mi.isVisibleChar=function(t){return t>47&&t<58||32==t||t>64&&t<91||t>95&&t<112||t>185&&t<193||t>218&&t<223},mi.measureTextLine=function(t,e,i){return t=0===(t=t.replace(new RegExp(" ","g")," ")).length?e.initialText:t,ro([t+"|"],this.style,i)[0]},mi.handleKeyDown=function(t){var e=this.textInputHelper;if(t.keyCode!==Autodesk.Viewing.KeyCode.ENTER){var i=e.textMarkup,n=e.textArea.value;t.keyCode===Autodesk.Viewing.KeyCode.BACKSPACE&&(n=n.substring(0,n.length-1)),n.length<15&&this.isVisibleChar(t.keyCode)&&(n+=t.key);var o=this.measureTextLine(n,i,this.editor);this.updateTextBox(i,o)}},mi.updateTextBox=function(t,e){this.textInputHelper||(this.textInputHelper=new Rt(this.viewer.container,this.editor,!0,t.initialText,15),this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.handleKeyDownBinded=this.handleKeyDown.bind(this)),t.text.style.display="none",e||(e=this.measureTextLine(this.textInputHelper.textArea.value,t,this.editor));var i=this.getTextAreaTransform(t,e);this.textInputHelper.styleTextArea.setAttribute("text-align","center"),this.textInputHelper.setActive(t,!1),this.textInputHelper.textArea.style.position="static",this.textInputHelper.textArea.style.padding="0",this.textInputHelper.textArea.style.width=e.width+"px",this.textInputHelper.textArea.style.height=e.height+"px",this.textInputHelper.textArea.style.transform=i,this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),this.editor.actionManager.addEventListener(R,this.onHistoryChangeBinded),this.textInputHelper.textArea.removeEventListener("keydown",this.handleKeyDownBinded),this.textInputHelper.textArea.addEventListener("keydown",this.handleKeyDownBinded)},mi.getTextAreaTransform=function(t,e){var i=t.getClientPosition(),n=Un(t.rotation)%360;return n>90&&n<=270&&t.shouldFlip()&&(n=180+n),["translate(",i.x-e.width/2+"px,",i.y-this.viewer.container.clientHeight-e.height+"px)","rotate(",n+"deg)","translate(0px,",e.height+"px)"].join(" ")},mi.onMouseDoubleClick=function(t){t===this.selectedMarkup&&(this.editor.selectMarkup(null),this.updateTextBox(t))},mi.onHelperTextChange=function(t){var e=t.data,i=e.markup,n=e.style,o=this.editor;i.text.style.display="block",""===e.newText&&(e.newText=i.initialText),e.firstEdit||o.beginActionGroup(),new j(o,i,n).execute(),new pi(o,i,i.firstAnchor,i.secondAnchor,e.newText).execute(),o.closeActionGroup(),o.selectMarkup(null)},mi.onHistoryChange=function(t){this.isTextInputHelperActive()&&(this.textInputHelper.textMarkup.text.style.display="block",this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},mi.onSave=function(){if(G.prototype.onSave.call(this),this.isTextInputHelperActive()){this.editor.actionManager.removeEventListener(R,this.onHistoryChangeBinded);var t=this.textInputHelper.textMarkup;this.textInputHelper.acceptAndExit(),t.text.style.display="block"}},mi.useWithSnapping=function(){return!0};function xi(t,e){B.call(this,t,e,["stroke-width","stroke-color","stroke-opacity","font-size","font-family","font-style","font-weight"]),this.type=g,this.constraintHeight=!0,this.constraintWidth=!0,this.addMarkupMetadata=In.bind(this),this.createSvgElement=gn.bind(this),this.checkLineSegment=io.bind(this),this.measureTextLines=ro.bind(this),this.firstAnchor=new THREE.Vector3,this.secondAnchor=new THREE.Vector3,this.shape=Mn(),this.text=wn(),this.shape.appendChild(this.text),this.textSize={x:0,y:0},this.initialText="Add Length",this.currentText=" ",this.viewer.model.is2d()||(this.preventReposition=!0,this.constraintRotation=!0),this.bindDomEvents()}xi.prototype=Object.create(B.prototype),xi.prototype.constructor=xi;var Mi=xi.prototype;function ki(t,e,i,n,o,s){x.call(this,t,"CREATE-DIMENSION",e),this.selectOnExecution=!1,this.secondAnchor=n,this.firstAnchor=i,this.text=o,this.style=w(s)}Mi.getEditMode=function(){return new gi(this.editor)},Mi.set=function(t,e,i,n,o){var s=new THREE.Vector2(t,e),r=new THREE.Vector2(i,n),a=r.clone().sub(s).normalize();this.size.x=s.distanceTo(r),this.rotation=Math.acos(a.dot(new THREE.Vector2(1,0))),this.rotation=n>e?2*Math.PI-this.rotation:this.rotation;var h=this.firstAnchor,u=this.secondAnchor;h.set(i,n,0),u.set(t,e,0),this.position.x=u.x+.5*(h.x-u.x),this.position.y=u.y+.5*(h.y-u.y),this.currentText=o,this.updateStyle()},Mi.setRotation=function(t){90===Un(t)&&(t=Gn(-90)),this.rotation=t;var e=Math.cos(-t),i=Math.sin(-t),n=new THREE.Vector2(e,i);n.multiplyScalar(.5*this.size.x);var o=new THREE.Vector2(this.position.x,this.position.y),s=o.clone().sub(n),r=o.clone().add(n);this.firstAnchor.set(r.x,r.y,0),this.secondAnchor.set(s.x,s.y,0),this.updateStyle()},Mi.setSize=function(t,e,i){var n=Math.cos(-this.rotation),o=Math.sin(-this.rotation),s=new THREE.Vector2(n,o);s.multiplyScalar(.5*e);var r=new THREE.Vector2(t.x,t.y),a=r.clone().sub(s),h=r.clone().add(s);this.firstAnchor.set(h.x,h.y,0),this.secondAnchor.set(a.x,a.y,0),this.position.x=t.x,this.position.y=t.y,this.size.x=e,this.updateStyle()},Mi.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},Mi.updateStyle=function(){var t=this.style,e=this.shape,i=t["stroke-width"],n=this.highlighted?this.highlightColor:eo(t["stroke-color"],t["stroke-opacity"]),o=this.getTransform();this.rebuildTextSvg(this.currentText),kn(e,"d",this.getPath().join(" ")),kn(e,"stroke-width",i/2),kn(e,"stroke",n),kn(e,"fill",n),kn(e,"transform",o),bn(e,this.editor)},Mi.rebuildTextSvg=function(t){var e=this.style,i=this.highlighted?this.highlightColor:eo(e["stroke-color"],e["stroke-opacity"]),n=e["stroke-width"],o=this.createSvgElement("text");o.setAttribute("id","markup"),o.setAttribute("alignment-baseline","middle");var s=this.text,r=this.editor;s.childNodes[0].removeChild(s.markup),s.childNodes[0].appendChild(o),s.markup=o;var a=this.createSvgElement("tspan");a.textContent=t,o.appendChild(a);var h=this.measureTextLines([t],e,r)[0],u=this.textSize=r.sizeFromClientToMarkups(h.width,h.height),l=10*n/2,c=2*n/2,d=u.x+2*n>=this.size.x?c+l/2:c;this.size.y=l+u.y+d;var p=this.getTextTransform(.8*u.y+d,!0),f=this.getTextTransform(u.y+d,!1);kn(s,"font-family",e["font-family"]),kn(s,"font-size",e["font-size"]),kn(s,"font-weight",e["font-weight"]),kn(s,"font-style",e["font-style"]),kn(s,"text-rendering","auto"),kn(s,"fill",i),En(s,f,p),Sn(s,u.x,u.y,"none"),An(s,u.x,u.y),Tn(s,u.x,u.y,r)},Mi.shouldFlip=function(){return this.firstAnchor.x<this.secondAnchor.x},Mi.getTextTransform=function(t,e){var i=this.shouldFlip()?-1:1;return e=e?-1:1,90===Un(this.rotation)&&(this.rotation=Gn(-90)),["translate(",this.position.x,",",this.position.y,")","rotate(",Un(-this.rotation),")","translate(",-i*this.textSize.x/2,",",-i*t,")","scale("+i+","+i*e+")"].join(" ")},Mi.setPosition=function(t,e){var i=this.firstAnchor,n=this.secondAnchor,o=i.x-n.x,s=i.y-n.y,r=t+.5*o,a=e+.5*s;i.x=r,i.y=a,n.x=r-o,n.y=a-s,this.position.x=n.x+.5*(i.x-n.x),this.position.y=n.y+.5*(i.y-n.y),this.updateStyle()},Mi.generatePoint3d=function(t){var e=this.editor.positionFromMarkupsToClient(this.firstAnchor.x,this.firstAnchor.y),i=this.editor.positionFromMarkupsToClient(this.secondAnchor.x,this.secondAnchor.y),n=e.clone().sub(i).normalize(),o=this.checkLineSegment(e.x,e.y,e.x+200*n.x,e.y+200*n.y,t),s=o&&this.viewer.clientToWorld(o.x,o.y);return s&&s.point},Mi.setMetadata=function(){this.text.setAttribute("pointer-events","none");var t=w(this.style);return t.type=this.type,t.firstAnchor=[this.firstAnchor.x,this.firstAnchor.y].join(" "),t.secondAnchor=[this.secondAnchor.x,this.secondAnchor.y].join(" "),t.text=String(this.currentText),this.addMarkupMetadata(this.shape,t)},Mi.getText=function(){return this.currentText===this.initialText?"":this.currentText},Mi.getPath=function(){var t=this.style["stroke-width"],e=this.size.x-t/2,i=10*t/2;return["M",.5*-e,0,"l",0,i/2,"l",0,-i/2,"l",e,0,"l",0,i/2,"l",0,-i,"l",0,i/2,"l",-e,0,"l",0,-i/2,"z"]},Mi.cloneShape=function(t){t.shape=Mn(),t.text=wn(),t.shape.appendChild(t.text),t.bindDomEvents()},Mi.getBoundingRect=function(){var t=this.getClientPosition(),e=this.getClientSize();return{x:t.x-e.x/2,y:t.y-e.y/2,width:e.x,height:e.y}},ki.prototype=Object.create(x.prototype),ki.prototype.constructor=ki;var bi=ki.prototype;function wi(t){return(wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ei(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ti(t,e){return(Ti=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Si(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Ci(t);if(e){var o=Ci(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ai(this,i)}}function Ai(t,e){return!e||"object"!==wi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ci(t){return(Ci=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}bi.redo=function(){var t=this.editor,e=new xi(this.targetId,t);t.addMarkup(e),this.secondAnchor&&(e.set(this.firstAnchor.x,this.firstAnchor.y,this.secondAnchor.x,this.secondAnchor.y,this.text),e.setStyle(this.style))},bi.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)};var Ii=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ti(t,e)}(s,t);var e,i,n,o=Si(s);function s(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this,t,"DELETE-STAMP",e.id)).createStamp=new an(t,e.id,e.position,e.size,e.rotation,e.getStyle()),i}return e=s,(i=[{key:"redo",value:function(){this.createStamp.undo()}},{key:"undo",value:function(){this.createStamp.redo()}}])&&Ei(e.prototype,i),n&&Ei(e,n),s}(x);function zi(t){return(zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Di(t,e){return(Di=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ri(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Hi(t);if(e){var o=Hi(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Li(this,i)}}function Li(t,e){return!e||"object"!==zi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Hi(t){return(Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _i=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Di(t,e)}(s,t);var e,i,n,o=Ri(s);function s(t,e,i,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,t,"SET-STAMP",e.id)).newPosition={x:i.x,y:i.y},r.newSize={x:n.x,y:n.y},r.oldPosition={x:e.position.x,y:e.position.y},r.oldSize={x:e.size.x,y:e.size.y},r}return e=s,(i=[{key:"redo",value:function(){this.applyState(this.targetId,this.newPosition,this.newSize)}},{key:"undo",value:function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)}},{key:"merge",value:function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,this.newSize=t.newSize,!0)}},{key:"applyState",value:function(t,e,i){var n=this.editor.getMarkup(t);n&&(Math.abs(n.position.x-e.x)>1e-4||Math.abs(n.position.y-e.y)>1e-4||Math.abs(n.size.x-i.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(e,i)}},{key:"isIdentity",value:function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y==this.newSize.y}}])&&Pi(e.prototype,i),n&&Pi(e,n),s}(x);function Ni(t){return(Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vi(t,e){return(Vi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Bi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=ji(t);if(e){var o=ji(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Fi(this,i)}}function Fi(t,e){return!e||"object"!==Ni(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ji(t){return(ji=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ui=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vi(t,e)}(s,t);var e,i,n,o=Bi(s);function s(t,e){var i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);return(i=o.call(this,t,m,["text-data"])).svgData=e,i}return e=s,(i=[{key:"deleteMarkup",value:function(t,e){if((t=t||this.selectedMarkup)&&t.type==this.type){var i=new Ii(this.editor,t);return i.addToHistory=!e,i.execute(),!0}return!1}},{key:"onMouseMove",value:function(t){G.prototype.onMouseMove.call(this,t);var e=this.selectedMarkup,i=this.editor;if(e&&this.creating){var n=this.getFinalMouseDraggingPosition();n=i.clientToMarkups(n.x,n.y);var o={x:(this.firstPosition.x+n.x)/2,y:(this.firstPosition.y+n.y)/2},s=this.size={x:Math.abs(n.x-this.firstPosition.x),y:Math.abs(n.y-this.firstPosition.y)};new _i(i,e,o,s).execute()}}},{key:"onMouseDown",value:function(){if(G.prototype.onMouseDown.call(this),!this.selectedMarkup){var t=this.editor,e=t.getMousePosition();this.initialX=e.x,this.initialY=e.y,this.firstPosition=t.clientToMarkups(this.initialX,this.initialY),this.size=t.sizeFromClientToMarkups(1,1),t.beginActionGroup();var i=t.getId();new an(t,i,this.firstPosition,this.size,0,this.style,this.svgData).execute(),this.selectedMarkup=t.getMarkup(i),this.creationBegin()}}}])&&Oi(e.prototype,i),n&&Oi(e,n),s}(G);function Gi(t){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(t){o=!0,s=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw s}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ki(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ki(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ki(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function Yi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xi(t,e){return(Xi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=$i(t);if(e){var o=$i(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Zi(this,i)}}function Zi(t,e){return!e||"object"!==Gi(e)&&"function"!=typeof e?Ji(t):e}function Ji(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $i(t){return($i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Qi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xi(t,e)}(s,t);var e,i,n,o=qi(s);function s(t,e,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);return(n=o.call(this,t,e,["text-data"])).type=m,n.addMarkupMetadata=In.bind(Ji(n)),n.createShapeGroup(),n.scriptSvgData=i,n.loadSvgData(),n.bindDomEvents(),n}return e=s,(i=[{key:"createShapeGroup",value:function(){this.shape=gn("g"),this.shape.group=gn("g"),this.shape.appendChild(this.shape.group);var t=gn("path");t.setAttribute("id","hitarea"),t.setAttribute("fill","none"),this.shape.appendChild(t),this.shape.hitarea=t,this.shape.markup=t}},{key:"loadSvgData",value:function(){var t=this.scriptSvgData||this.style["text-data"],e=Ln(t);if(null!==e){var i=Wi(this.getDimensions(e),2),n=i[0],o=i[1],s="M 0 0 l ".concat(n," 0 l 0 ").concat(o," l ").concat(-n," 0 z");this.shape.hitarea.setAttribute("d",s),this.shape.group.innerHTML=e.innerHTML,this.shape.group.setAttribute("transform","translate( -0.5 , 0.5 ) scale( ".concat(1/n," , ").concat(-1/o," )")),this.shape.hitarea.setAttribute("transform",this.shape.group.getAttribute("transform"))}else console.warn("SVG data "+t+" is invalid, skipping shape update")}},{key:"getEditMode",value:function(){return new Ui(this.editor)}},{key:"set",value:function(t,e){this.setSize(t,e.x,e.y),this.updateStyle()}},{key:"updateStyle",value:function(t){var e=this.highlighted?this.highlightColor:eo(this.style["stroke-color"],this.style["stroke-opacity"]);this.shape.hitarea.setAttribute("stroke",e);var i=this.getTransform()+" scale( ".concat(this.size.x," , ").concat(this.size.y," )");this.shape.setAttribute("transform",i),t&&this.loadSvgData()}},{key:"getDimensions",value:function(t){var e=t.getAttribute("viewBox");if(!e)return[t.getAttribute("width")||100,t.getAttribute("height")||100];var i=e.split(" ");return[parseInt(i[2]),parseInt(i[3])]}},{key:"setMetadata",value:function(){var t=w(this.style);return t.type=this.type,t.position=[this.position.x,this.position.y].join(" "),t.size=[this.size.x,this.size.y].join(" "),t.rotation=String(this.rotation),this.addMarkupMetadata(this.shape,t)}},{key:"setStyle",value:function(t){var e=b(t,this.style);e||k(t,this.style),this.updateStyle(!e)}}])&&Yi(e.prototype,i),n&&Yi(e,n),s}(B);function tn(t){return(tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function en(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function nn(t,e){return(nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function on(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=rn(t);if(e){var o=rn(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return sn(this,i)}}function sn(t,e){return!e||"object"!==tn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function rn(t){return(rn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var an=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nn(t,e)}(s,t);var e,i,n,o=on(s);function s(t,e,i,n,r,a,h){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(u=o.call(this,t,"CREATE-STAMP",e)).selectOnExecution=!1,u.position={x:i.x,y:i.y},u.size={x:n.x,y:n.y},u.rotation=r,u.style=w(a),u.svgData=h,u}return e=s,(i=[{key:"redo",value:function(){var t=new Qi(this.targetId,this.editor,this.svgData);this.editor.addMarkup(t),t.setSize(this.position,this.size.x,this.size.y),t.setRotation(this.rotation),t.setStyle(this.style)}},{key:"undo",value:function(){var t=this.editor.getMarkup(this.targetId);this.editor.removeMarkup(t)}}])&&en(e.prototype,i),n&&en(e,n),s}(x),hn=Autodesk.Viewing,un=Autodesk.Viewing.Private,ln=hn.getGlobal(),cn=ln.document,dn=1,pn=10,fn=15,yn=7,vn=function(){return!(!hn.isTouchDevice||"function"!=typeof Hammer)&&hn.isTouchDevice()},gn=function(t){return(this&&this.getDocument&&this.getDocument()||cn).createElementNS("http://www.w3.org/2000/svg",t)},mn=function(t){return t.setAttribute("version","1.1"),t.setAttribute("baseProfile","full"),t.setAttribute("layer-order-id","markups-svg"),t},xn=function(t){t=t||[];var e=gn("g");e.setAttribute("cursor","default"),e.setAttribute("pointer-events","none");for(var i=0;i<t.length;i++)e.appendChild(t[i]);return e},Mn=function(){var t=gn("g");t.setAttribute("cursor","inherit"),t.setAttribute("pointer-events","none");var e=gn("path");e.setAttribute("id","markup");var i=gn("path");return i.setAttribute("id","hitarea"),i.setAttribute("fill","transparent"),i.setAttribute("stroke","transparent"),t.markup=e,t.hitarea=i,t.appendChild(e),t.appendChild(i),t},kn=function(t,e,i){t.markup.setAttribute(e,i)},bn=function(t,e){var i=t.markup,n=t.hitarea,o=e.sizeFromClientToMarkups(0,fn).y;o+=parseFloat(i.getAttribute("stroke-width"))+o;var s=i.getAttribute("fill"),r=i.getAttribute("stroke"),a=""!==r&&"none"!==r,h=""!==s&&"none"!==s;if(n.setAttribute("d",i.getAttribute("d")),n.setAttribute("stroke-width",o),n.setAttribute("transform",i.getAttribute("transform")),e.duringEditMode&&!e.navigating){if(a&&h)return void t.setAttribute("pointer-events","painted");if(a)return void t.setAttribute("pointer-events","stroke");if(h)return void t.setAttribute("pointer-events","fill")}t.setAttribute("pointer-events","none")},wn=function(){var t=gn("g");t.setAttribute("cursor","default");var e="markup-clipper-"+Dn(),i="url(#"+e+")",n=gn("clipPath");n.setAttribute("id",e),n.removeAttribute("pointer-events"),n.rect=gn("rect"),n.appendChild(n.rect);var o=gn("rect");o.setAttribute("id","markup-background"),o.removeAttribute("pointer-events");var s=gn("text");s.setAttribute("id","markup");var r=gn("rect");r.setAttribute("id","hitarea"),r.setAttribute("fill","transparent"),r.setAttribute("stroke","none"),r.setAttribute("stroke-width","0");var a=gn("g");return a.setAttribute("clip-path",i),a.appendChild(n),a.appendChild(o),a.appendChild(s),t.appendChild(a),t.appendChild(r),t.clipper=n,t.background=o,t.markup=s,t.hitarea=r,t},En=function(t,e,i){t.clipper.rect.setAttribute("transform",e),t.background.setAttribute("transform",e),t.markup.setAttribute("transform",i),t.hitarea.setAttribute("transform",e)},Tn=function(t,e,i,n){var o=t.hitarea,s=n.sizeFromClientToMarkups(0,fn).y;o.setAttribute("x",-s),o.setAttribute("y",-s),o.setAttribute("width",e+2*s),o.setAttribute("height",i+2*s),t.setAttribute("pointer-events",n.navigating?"none":"painted")},Sn=function(t,e,i,n){var o=t.background;o.setAttribute("x",0),o.setAttribute("y",0),o.setAttribute("width",e),o.setAttribute("height",i),o.setAttribute("fill",n)},An=function(t,e,i){var n=t.clipper;n.rect.setAttribute("x",0),n.rect.setAttribute("y",0),n.rect.setAttribute("width",e),n.rect.setAttribute("height",i)},Cn=function(t,e){var i=this&&this.getDocument&&this.getDocument()||cn,n=i.createElementNS("http://www.w3.org/2000/svg","metadata"),o=i.createElement("markup_document");return n.appendChild(o),o.setAttribute("data-model-version",e["data-model-version"]),t.insertBefore(n,t.firstChild),n},In=function(t,e){var i=this&&this.getDocument&&this.getDocument()||cn,n=i.createElementNS("http://www.w3.org/2000/svg","metadata"),o=i.createElement("markup_element");for(var s in n.appendChild(o),e)e.hasOwnProperty(s)&&o.setAttribute(s,e[s]);return t.insertBefore(n,t.firstChild),n},zn=function t(e){if(e.getElementsByTagName)for(var i=e.getElementsByTagName("metadata"),n=0;n<i.length;++n){var o=i[n];o.parentNode&&o.parentNode.removeChild(o)}var s=e.children||e.childNodes;if(s)for(n=0;n<s.length;++n)t(s[n])},Pn=function(t,e){for(var i=t.children||t.childNodes,n=[],o=0;o<i.length;++o)n.push(i[o]);n.forEach((function(t){e.appendChild(t)}))},Dn=function(){return THREE.Math.generateUUID()},Rn=function(t){var e;try{var i=[];!function t(e,i){var n=e.hitarea,o=n&&n.parentNode;o&&(i.push({hitarea:n,parent:o}),o.removeChild(n));for(var s=e.childNodes,r=s.length,a=0;a<r;++a)t(s.item(a),i)}(t,i),e=(new XMLSerializer).serializeToString(t),function(t){for(var e=t.length,i=0;i<e;++i){var n=t[i];n.parent.appendChild(n.hitarea)}}(i)}catch(t){e="",console.warn("svgNodeToString failed to generate string representation of domNode.")}return e},Ln=function(t){var e=null;try{e=(new DOMParser).parseFromString(t,"text/xml").firstChild}catch(t){e=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return e},Hn=function(t){t.listeners={},t.addEventListener=function(t,e){void 0===this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(e)},t.hasEventListener=function(t,e){if(void 0===this.listeners)return!1;var i=this.listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},t.removeEventListener=function(t,e){if(this.listeners[t]instanceof Array)for(var i=this.listeners[t],n=0,o=i.length;n<o;n++)if(i[n]===e){i.splice(n,1);break}},t.dispatchEvent=function(t){if("string"==typeof t&&(t={type:t}),t.target||(t.target=this),!t.type)throw new Error("event type unknown.");if(this.listeners[t.type]instanceof Array)for(var e=this.listeners[t.type].slice(),i=0;i<e.length;i++)e[i].call(this,t)}},_n=function(t){try{delete t.listeners,delete t.addEventListener,delete t.hasEventListener,delete t.removeEventListener,delete t.dispatchEvent}catch(t){}},Nn=function(t,e,i){var n=Fn(t,e),o=Bn(n.x,n.y,e);return o.z=0,i&&(o.x=Math.floor(o.x)+.5,o.y=Math.floor(o.y)+.5),o},On=function(t,e,i,n){var o=Vn(t,e,n);return o.z=i,o.unproject(n.impl.camera),o},Vn=function(t,e,i){return i.impl.clientToViewport(t,e)},Bn=function(t,e,i){return i.impl.viewportToClient(t,e)},Fn=function(t,e){var i=new THREE.Vector3;return i.x=t.x,i.y=t.y,i.z=t.z,i.project(e.impl.camera),i},jn=function(t,e){return 1/e.model.getUnitScale()*t},Un=function(t){return t*(180/Math.PI)},Gn=function(t){return t*(Math.PI/180)},Wn=function(t){return t>=0?1:-1},Kn=function(t,e,i,n){i=n.sizeFromClientToMarkups(0,i).y;var o=t.x-e.x,s=t.y-e.y;return i*i>=o*o+s*s},Yn=function(t){t.toolbar&&(t.setActiveNavigationTool(),$n(),qn(!0,t),Jn(t))},Xn=function(t){t.toolbar&&($n(),qn(!1,t),Zn(t))},qn=function(t,e){var i=e.dockingPanels;if(i)for(var n=0;n<i.length;++n){var o=i[n],s=o.container;s.classList.contains("dockingPanelVisible")&&(s.style.display=t?"none":"block",o.visibilityChanged())}},Zn=function(t){t&&t.model&&!t.model.is2d()&&t.getExtension("Autodesk.ViewCubeUi",(function(t){t.displayViewCube(!0,!1),t.displayHomeButton(!0)}));var e=t.getDocument().getElementsByClassName("toolbar-animation-subtoolbar");if(e.length>0&&(e[0].style.display=""),t.toolbar)for(var i=t.toolbar.container,n=i.children.length,o=0;o<n;++o)i.children[o].style.display=""},Jn=function(t){t&&t.model&&!t.model.is2d()&&t.getExtension("Autodesk.ViewCubeUi",(function(t){t.displayViewCube(!1,!1),t.displayHomeButton(!1)}));var e=t.getDocument().getElementsByClassName("toolbar-animation-subtoolbar");if(e.length>0){e[0].style.display="none";var i=t.impl.keyFrameAnimator;if(i&&!i.isPaused){i.pauseCameraAnimations(),i.pause();var n=t.modelTools.getControl("toolbar-animationPlay");n&&(n.setIcon("toolbar-animation-pause-icon"),n.setToolTip("Pause"))}}if(t.toolbar)for(var o=t.toolbar.container,s=o.children.length,r=0;r<s;++r)o.children[r].style.display="none"},$n=function(){try{for(var t=!0;t;)t=Autodesk.Viewing.Private.HudMessage.dismiss()}catch(t){console.warn("[CO2]Failed to dismiss LMV HudMessage")}},Qn=function(t,e){return e.sizeFromClientToMarkups(0,t).y},to=function(t,e){if(!t.childNodes[0])return null;var i=t.childNodes[0].childNodes[0]||"",n=function(){var e=t.childNodes[1]||"",i=!1;if("string"!=typeof e){var n=e.getAttribute("d").split(" ");"z"===n[n.length-1].toLowerCase()&&(i=!0)}return i},o=function(){for(var t=[],e=i.getAttribute("locations").split(" ")||"",n=0;n<e.length;n+=2){var o={x:parseFloat(e[n]),y:parseFloat(e[n+1])};t.push(o)}return t},s=function(t){var e=new THREE.Vector3,n=(i.getAttribute(t)||i.getAttribute(t.toLowerCase())).split(" ");return e.x=parseFloat(n[0]),e.y=parseFloat(n[1]),e},r=function(){return s("position")},x=function(){return s("size")},M=function(){var t=i.getAttribute("rotation")||"";return parseFloat(t)},k=function(){return i.getAttribute("text")||""};if("string"!=typeof i){var b,w,E,T,S=e.getId(),A=function(t,e){for(var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-size","font-style","font-weight","stroke-linejoin"],n={},o=0;o<i.length;o++){var s=e.getAttribute(i[o]);if(null!=s)switch(i[o]){case"font-size":case"stroke-width":case"stroke-opacity":case"fill-opacity":n[i[o]]=parseFloat(s);break;case"stroke-linejoin":break;case"font-family":case"font-style":case"font-weight":case"stroke-color":case"text-data":case"fill-color":n[i[o]]=s;break;default:un.logger.warn("Style not recognized.")}}return n}(0,i);switch(i.getAttribute("type")||""){case a:T=new et(e,S,s("tail"),s("head"),A);break;case u:T=new dt(e,S,b=r(),w=x(),E=M(),A);break;case h:T=new Qt(e,S,b=r(),w=x(),k(),A);break;case v:T=new jt(e,S,b=r(),w=x(),k(),A,!!parseInt(i.getAttribute("isframeused")));break;case l:T=new ue(e,S,b=r(),w=x(),E=M(),A);break;case c:T=new xe(e,S,b=r(),w=x(),E=M(),A);break;case d:T=new De(e,S,b=r(),w=x(),E=M(),o(),A);break;case f:T=new Ue(e,S,b=r(),w=x(),E=M(),o(),A,n());break;case y:T=new ti(e,S,b=r(),w=x(),E=M(),o(),A,n());break;case p:T=new ui(e,S,b=r(),w=x(),E=M(),o(),A);break;case g:T=new ki(e,S,s("firstAnchor"),s("secondAnchor"),k(),A);break;case m:b=r(),w=x(),E=M(),T=new an(e,S,b,w,E,A,t);break;default:T=null}if(T){T.addToHistory=!1,T.execute();for(var C=e.svgLayersMap[e.activeLayer].markups,I=0;I<C.length;++I)if(C[I].id===S)return C[I]}return null}},eo=function(t,e){return!t||!e||e<=0?"none":["rgba("+parseInt("0x"+t.substr(1,2)),",",parseInt("0x"+t.substr(3,2)),",",parseInt("0x"+t.substr(5,2)),",",e,")"].join("")},io=function(t,e,i,n,o){var s=(this&&this.getWindow&&this.getWindow()||ln).devicePixelRatio||1;t*=s,e*=s,i*=s,n*=s;var r=o.width,a=o.height,h=o.buffer;function u(t,e){t=Math.round(t),e=Math.round(e);for(var i=0,n=0,o=-s;o<=s;o+=2*s)n+=l(t,e+o)?o:0;for(var r=-s;r<=s;r+=2*s)i+=l(t+r,e)?r:0;return{x:Math.round(t/s+i),y:Math.round((a-e)/s-n)}}function l(t,e){if(t<0||t>=r||e<0||e>=a)return!1;var i=4*(e*r+t);return 255!==h[i]||255!==h[i+1]||255!==h[i+2]}t=Math.round(t),i=Math.round(i),e=Math.round(a-e),n=Math.round(a-n);var c=i-t,d=0!==c?(n-e)/c:1,p=t,f=e;if(0!==c&&Math.abs(d)<=1){if(t<=i){for(;p<=i;++p,f+=d)if(l(p,Math.round(f)))return u(p,f)}else for(;p>=i;--p,f-=d)if(l(p,Math.round(f)))return u(p,f)}else if(d=0!==c?1/d:0,e<=n){for(;f<=n;++f,p+=d)if(l(Math.round(p),f))return u(p,f)}else for(;f>=n;--f,p-=d)if(l(Math.round(p),f))return u(p,f)},no=function(t,e){if(!t||t.verxtexCount<3||!e)return null;var i=(this&&this.getWindow&&this.getWindow()||ln).devicePixelRatio||1,n=e.width,o=e.height,s=e.buffer,r=t.vertexCount,a=Float32Array.from(t.xVertices),h=Float32Array.from(t.yVertices);function u(t,e){for(var n=0,s=0,r=-i;r<=i;r+=2*i)s+=l(t,e+r)?r:0;for(var a=-i;a<=i;a+=2*i)n+=l(t+a,e)?a:0;return{x:Math.round(t/i)+n,y:Math.round((o-e)/i-s)}}function l(e,i){if(e<0||e>=n||i<0||i>=o)return!1;var r=4*(i*n+e);return(255!==s[r]||255!==s[r+1]||255!==s[r+2])&&function(e,i){for(var n=!1,o=t.vertexCount,s=0,r=o-1;s<o;r=s++)h[s]>i!=h[r]>i&&e<(a[r]-a[s])*(i-h[s])/(h[r]-h[s])+a[s]&&(n=!n);return n}(e,i)}for(var c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY,y=0;y<r;++y){var v=a[y]=a[y]*i,g=h[y]=o-h[y]*i;c=Math.min(c,v),d=Math.min(d,g),p=Math.max(p,v),f=Math.max(f,g)}if(p<0||c>n||f<0||d>o)return null;var m=Math.round(p-c),x=Math.round(f-d),M=Math.round(.5*(c+p)),k=Math.round(.5*(d+f)),b=1,w=1;do{for(var E=M+b,T=k+w;M<E;++M)if(l(M,k))return u(M,k);for(;k<T;++k)if(l(M,k))return u(M,k);for(b<m?(E=M-++b,++b):E=M-b,w<x?(T=k-++w,++w):T=k-w;M>E;--M)if(l(M,k))return u(M,k);for(;k>T;--k)if(l(M,k))return u(M,k)}while(b<m||w<x)},oo=function(){var t=this&&this.getDocument&&this.getDocument()||cn,e=t.createElement("style");return e.appendChild(t.createTextNode("")),t.head.appendChild(e),e.sheet},so=function(t,e,i,n){"insertRule"in t?t.insertRule(e+"{"+i+"}",n):"addRule"in t&&t.addRule(e,i,n)},ro=function(t,e,i){var n=i.sizeFromMarkupsToClient(0,e["font-size"]).y,o=(new zt).setAttribute("font-family",e["font-family"]).setAttribute("font-size",n+"px").setAttribute("font-weight",e["font-weight"]?"bold":"").setAttribute("font-style",e["font-style"]?"italic":"").removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString(),s=(this&&this.getDocument&&this.getDocument()||cn).createElement("div");s.setAttribute("style",o),i.viewer.container.appendChild(s);for(var r=[],a=t.length,h=0;h<a;++h)s.innerText=t[h],r.push({line:t[h],width:s.clientWidth,height:s.clientHeight});return i.viewer.container.removeChild(s),r},ao=function(t,e,i,n,o,s){return s.push(o?"a":"A"),s.push(i),s.push(n),s.push(0),s.push(1),s.push(1),s.push(t),s.push(e),s},ho=function(t,e,i,n,o,s){var r=.5*i,a=.5*n;s.push(o?"m":"M"),s.push(t),s.push(e),ao(i,0,r,a,!0,s),ao(-i,0,r,a,!0,s),s.push("z")},uo=function(t,e,i,n,o,s){s.push(o?"m":"M"),s.push(t),s.push(e),s.push("l"),s.push(i),s.push(0),s.push("l"),s.push(0),s.push(n),s.push("l"),s.push(-i),s.push(0),s.push("z")},lo=function(t,e,i,n,o,s){var r=gn("svg");hn.isIE11||r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",i),r.setAttribute("height",n),r.setAttribute("viewBox",e),r.setAttribute("transform","scale(1,-1)");var a=t.parentNode.cloneNode(!0);r.appendChild(a);var h=this&&this.getWindow&&this.getWindow()||ln,u=(this&&this.getDocument&&this.getDocument()||cn).createElement("div"),l=r.cloneNode(!0);u.appendChild(l);var c=u.innerHTML;r=u=l=null;var d=new Image;d.onload=function(){o.drawImage(d,0,0),s()},d.src="data:image/svg+xml;base64,"+h.btoa(unescape(encodeURIComponent(c)))},co=function(t,e,i){if(t.length<=2)return t;function n(t,e,i){var n=e.x,o=e.y,s=i.x-n,r=i.y-o;if(0!==s||0!==r){var a=((t.x-n)*s+(t.y-o)*r)/(s*s+r*r);a>1?(n=i.x,o=i.y):a>0&&(n+=s*a,o+=r*a)}return(s=t.x-n)*s+(r=t.y-o)*r}var o=void 0!==e?e*e:1;return t=function(t,e){var i=t.length-1,o=[t[0]];return function t(e,i,o,s,r){for(var a,h=s,u=i+1;u<o;u++){var l=n(e[u],e[i],e[o]);l>h&&(a=u,h=l)}h>s&&(a-i>1&&t(e,i,a,s,r),r.push(e[a]),o-a>1&&t(e,a,o,s,r))}(t,0,i,e,o),o.push(t[i]),o}(t=i?t:function(t,e){for(var i,n,o,s,r,a=t[0],h=[a],u=1,l=t.length;u<l;u++)i=t[u],o=a,s=void 0,r=void 0,s=(n=i).x-o.x,r=n.y-o.y,s*s+r*r>e&&(h.push(i),a=i);return a!==i&&h.push(i),h}(t,o),o)};function po(){this.actions=[],this.closed=!0}var fo=po.prototype;function yo(t){this.historySize=t,this.undoStack=[],this.redoStack=[],Hn(this)}fo.open=function(){return!!this.closed&&(this.closed=!1,!0)},fo.close=function(){return!this.closed&&(this.closed=!0,!0)},fo.undo=function(){for(var t=this.actions,e=-1,i=t.length-1;i>=0;--i){var n=t[i];n.undo(),-1!==n.targetId&&(e=n.targetId)}return e},fo.redo=function(){for(var t=this.actions,e=t.length,i=-1,n=0;n<e;++n){var o=t[n];o.redo(),-1!==o.targetId&&(i=o.targetId)}return i},fo.isOpen=function(){return!this.closed},fo.isClosed=function(){return this.closed},fo.isEmpty=function(){return 0===this.actions.length},fo.addAction=function(t){return!this.closed&&(this.actions.push(t),this.compact(),!0)},fo.compact=function(){for(var t=this.actions,e=t.length,i=0;i<e;++i){var n=t[i];if(n.isIdentity())t.splice(i,1),--e,--i;else for(var o=i+1;o<e;++o){var s=t[o];if(n.type===s.type&&n.merge(s)){t.splice(o,1),--e,--i;break}}}},fo.getTargetId=function(){for(var t=this.actions,e=t.length,i=-1,n=0;n<e;++n){var o=t[n];-1!==o.targetId&&(i=o.targetId)}return i};var vo=yo.prototype;function go(t,e,i,n){x.call(this,t,"CLONE-MARKUP",e),this.clone=i.clone(),this.clone.id=e,this.position={x:n.x,y:n.y}}vo.execute=function(t){var e=this.redoStack,i=this.undoStack;e.splice(0,e.length),t.redo();var n=this.getEditActionGroup();n.isOpen()?n.addAction(t):(n.open(),n.addAction(t),n.close()),i.length>this.historySize&&i.splice(0,1);var o=t.selectOnExecution?t.targetId:-1;this.dispatchEvent({type:R,data:{action:"execute",targetId:o}})},vo.beginActionGroup=function(){var t=this.undoStack,e=t.length;0===e||t[e-1].isClosed()?this.getEditActionGroup().open():console.warn("Markups - Undo/Redo - Action edit group already open.")},vo.closeActionGroup=function(){var t=this.undoStack,e=t.length;if(0!==e){var i=t[e-1];i.close()||console.warn("Markups - Undo/Redo - Action edit group already closed."),i.isEmpty()&&t.pop()}else console.warn("Markups - Undo/Redo - There is no action edit group to close.")},vo.cancelActionGroup=function(){var t=this.undoStack,e=t.length;if(0!==e){var i=t[e-1];i.close()?(i.undo(),t.pop(),this.dispatchEvent({type:R,data:{action:"cancel",targetId:-1}})):console.warn("Markups - Undo/Redo - Action edit group already closed.")}else console.warn("Markups - Undo/Redo - There is no action edit group to close.")},vo.undo=function(){var t=this.undoStack,e=this.redoStack;if(0!==t.length){var i=t.pop(),n=i.undo();e.push(i),this.dispatchEvent({type:R,data:{action:"undo",targetId:n}})}},vo.redo=function(){var t=this.undoStack,e=this.redoStack;if(0!==e.length){var i=e.pop(),n=i.redo();t.push(i),this.dispatchEvent({type:R,data:{action:"redo",targetId:n}})}},vo.clear=function(){this.undoStack.splice(0,this.undoStack.length),this.redoStack.splice(0,this.redoStack.length),this.dispatchEvent({type:R,data:{action:"clear",targetId:-1}})},vo.isUndoStackEmpty=function(){return 0===this.undoStack.length},vo.isRedoStackEmpty=function(){return 0===this.redoStack.length},vo.getLastElementInUndoStack=function(){var t=this.undoStack;return t[t.length-1]},vo.getEditActionGroup=function(){var t=this.undoStack,e=this.undoStack.length,i=null;return 0===e||t[e-1].isClosed()?(i=new po,t.push(i)):i=t[e-1],i},go.prototype=Object.create(x.prototype),go.prototype.constructor=go;var mo=go.prototype;function xo(t){this.editor=t,this.content=null,this.pastePosition={x:0,y:0},Hn(this)}mo.redo=function(){var t=this.editor,e=this.clone,i=this.position;if(!t.getMarkup(this.targetId)){var n=e.clone();n.setPosition(i.x,i.y),t.addMarkup(n)}},mo.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&this.editor.removeMarkup(t)};var Mo=xo.prototype;Mo.copy=function(){var t=this.editor.getSelection();t&&(this.content=t.clone(),this.pastePosition.x=t.position.x,this.pastePosition.y=t.position.y)},Mo.cut=function(){var t=this.editor.getSelection();t&&(this.copy(),this.editor.deleteMarkup(t))},Mo.paste=function(){var t=this.content;if(t){var e=this.editor,i=this.pastePosition,n=e.sizeFromClientToMarkups(20,20);i.x+=n.x,i.y-=n.y,new go(e,e.getId(),t,i).execute()}};var ko=Autodesk.Viewing,bo=ko.Private,wo=!1,Eo=!1,To=!1;function So(){this.editor=null,this.mousePosition={x:0,y:0},this.makeSameXY=!1,this.snapRotations=!1,this.keepAspectRatio=!1,this.constrainAxis=!1,this.duringEditMode=!1,this.onWheelBinded=this.onWheel.bind(this),this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onTouchPanBinded=this.onTouchPan.bind(this),this.onTouchPinchBinded=this.onTouchPinch.bind(this),this.onSingleTapBinded=this.onSingleTap.bind(this),this.onDoubleTapBinded=this.onDoubleTap.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.onHammerInputBinded=this.onHammerInput.bind(this),this.isMouseDown=!1}ko.GlobalManagerMixin.call(So.prototype);var Ao=So.prototype;function Co(t,e){var i=t.editor.svg.getBoundingClientRect();t.makeSameXY=e.shiftKey,t.snapRotations=e.shiftKey,t.keepAspectRatio=e.shiftKey,t.constrainAxis=e.shiftKey,t.mousePosition.x=e.clientX-i.left,t.mousePosition.y=e.clientY-i.top}function Io(t){t.shiftKey=!1,t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY}function zo(t,e,i){x.call(this,t,"SET-POSITION",e.id),this.newPosition={x:i.x,y:i.y},this.oldPosition={x:e.position.x,y:e.position.y}}Ao.attachTo=function(t){this.editor&&this.detachFrom(this.editor),this.editor=t,vn()&&(this.hammer=new ko.Hammer.Manager(t.svg,{recognizers:[ko.GestureRecognizers.drag,ko.GestureRecognizers.doubletap,ko.GestureRecognizers.doubletap2,ko.GestureRecognizers.singletap,ko.GestureRecognizers.singletap2,ko.GestureRecognizers.press,ko.GestureRecognizers.pan,ko.GestureRecognizers.pinch],handlePointerEventMouse:!1,inputClass:ko.isIE11?ko.Hammer.PointerEventInput:ko.Hammer.TouchInput}),this.hammer.get("doubletap2").recognizeWith("doubletap"),this.hammer.get("singletap2").recognizeWith("singletap"),this.hammer.get("singletap").requireFailure("doubletap"))},Ao.onHammerInput=function(t){this.setMouseDisabledWhenTouching(t)},Ao.setMouseDisabledWhenTouching=function(t){if(t.isFirst&&!To)this.enableMouseButtons(!1),To=!0;else if(t.isFinal){var e=this;setTimeout((function(){e.enableMouseButtons(Eo),To=!1}),10)}},Ao.enableMouseButtons=function(t){t&&!wo?(this.editor.svg.addEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.addEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.addEventListener("wheel",this.onWheelBinded),this.editor.svg.addEventListener("DOMMouseScroll",this.onWheelBinded),this.addDocumentEventListener("mousemove",this.onMouseMoveBinded),this.addDocumentEventListener("mouseup",this.onMouseUpBinded)):!t&&wo&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded),this.editor.svg.removeEventListener("DOMMouseScroll",this.onWheelBinded),this.removeDocumentEventListener("mousemove",this.onMouseMoveBinded),this.removeDocumentEventListener("mouseup",this.onMouseUpBinded)),Eo=wo,wo=t},Ao.detachFrom=function(t){this.hammer&&this.hammer.destroy(),this.removeDocumentEventListener("mousemove",this.onMouseMoveBinded),this.removeDocumentEventListener("mouseup",this.onMouseUpBinded),this.editor&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded)),this.editor=t},Ao.enterEditMode=function(){this.duringEditMode||(this.hammer&&(this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("panstart panmove panend",this.onTouchPanBinded),this.hammer.on("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("singletap2",this.onSingleTapBinded),this.hammer.on("doubletap",this.onDoubleTapBinded),this.hammer.on("doubletap2",this.onDoubleTapBinded),this.hammer.on("hammer.input",this.onHammerInputBinded),this.hammer.get("drag").requireFailure("pinch"),this.hammer.get("drag").requireFailure("pan")),ko.isMobileDevice()||this.enableMouseButtons(!0),this.duringEditMode=!0)},Ao.leaveEditMode=function(){this.duringEditMode&&(this.hammer&&(this.hammer.off("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.off("panstart panmove panend",this.onTouchPanBinded),this.hammer.off("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("singletap2",this.onSingleTapBinded),this.hammer.off("doubletap",this.onDoubleTapBinded),this.hammer.off("doubletap2",this.onDoubleTapBinded),this.hammer.off("hammer.input",this.onHammerInputBinded)),ko.isMobileDevice()||this.enableMouseButtons(!1),this.duringEditMode=!1)},Ao.enterViewMode=function(){},Ao.leaveViewMode=function(){},Ao.getMousePosition=function(){return{x:this.mousePosition.x,y:this.mousePosition.y}},Ao.onWheel=function(t){ko.isMobileDevice()||this.editor.viewer.toolController.mousewheel(t),t.preventDefault()},Ao.onMouseMove=function(t){Co(this,t),ko.isMobileDevice()||this.editor.viewer.toolController.mousemove(t),this.editor.onMouseMove(t),t.preventDefault()},Ao.onMouseDownRightClick=function(t){var e=this.getDocument();ko.isIE11&&ko.inFullscreen(e)||e.activeElement&&e.activeElement.blur&&e.activeElement.blur(),this.editor.viewer.toolController.__clientToCanvasCoords(t),this.editor.markupTool.handleButtonDown(t,2)},Ao.onMouseUpRightClick=function(t){this.editor.viewer.toolController.__clientToCanvasCoords(t),this.editor.markupTool.handleButtonUp(t,2)},Ao.onMouseDown=function(t){Co(this,t),ko.isMobileDevice()||!bo.isRightClick(t,this.editor.viewer.navigation)&&!bo.isMiddleClick(t)?(this.isMouseDown=!0,this.editor.onMouseDown(t),t.preventDefault()):this.onMouseDownRightClick(t)},Ao.onMouseUp=function(t){Co(this,t),ko.isMobileDevice()||!bo.isRightClick(t,this.editor.viewer.navigation)&&!bo.isMiddleClick(t)?(this.isMouseDown=!1,this.editor.onMouseUp(t),t.preventDefault()):this.onMouseUpRightClick(t)},Ao.onMouseDoubleClick=function(t){Co(this,t),this.editor.onMouseDoubleClick(t),t.preventDefault()},Ao.onTouchDrag=function(t){switch(Io(t),t.type){case"dragstart":this.onMouseDown(t);break;case"dragmove":this.onMouseMove(t);break;case"dragend":this.onMouseUp(t)}t.preventDefault()},Ao.onTouchPan=function(t){this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),t.preventDefault()},Ao.onTouchPinch=function(t){Co(this,t),this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),this.mousePosition.x=this.mousePosition.y=null,this.editor.callSnapperMouseMove(),t.preventDefault()},Ao.onSingleTap=function(t){Io(t),this.onMouseDown(t),this.onMouseUp(t),t.preventDefault()},Ao.onDoubleTap=function(t){Io(t),this.onMouseDoubleClick(t),t.preventDefault()},zo.prototype=Object.create(x.prototype),zo.prototype.constructor=zo;var Po=zo.prototype;function Do(t,e,i){x.call(this,t,"SET-ROTATION",e.id);var n=e.getRotation();this.newRotation={angle:i},this.oldRotation={angle:n}}Po.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setPosition(this.newPosition.x,this.newPosition.y)},Po.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setPosition(this.oldPosition.x,this.oldPosition.y)},Po.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newPosition=t.newPosition,!0)},Po.isIdentity=function(){var t=this.newPosition,e=this.oldPosition;return t.x===e.x&&t.y===e.y},Do.prototype=Object.create(x.prototype),Do.prototype.constructor=Do;var Ro=Do.prototype;Ro.redo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setRotation(this.newRotation.angle)},Ro.undo=function(){var t=this.editor.getMarkup(this.targetId);t&&t.setRotation(this.oldRotation.angle)},Ro.merge=function(t){return this.targetId===t.targetId&&this.type===t.type&&(this.newRotation=t.newRotation,!0)},Ro.isIdentity=function(){return this.newRotation.angle===this.oldRotation.angle};var Lo=Autodesk.Viewing,Ho=Autodesk.Viewing.Private;function _o(t,e){this.containingDiv=t,this.editor=e,this.setGlobalManager(this.editor.viewer.globalManager),this.selectionLayer=Vo.bind(this)(),this.frameMargin=yn,this.selection={x:0,y:0,width:0,height:0,rotation:0,element:null,active:!1,dragging:!1,resizing:!1,handle:{}},Yo.bind(this)(),vn()&&(this.hammer=new Lo.Hammer.Manager(this.selectionLayer,{recognizers:[Lo.GestureRecognizers.drag,Lo.GestureRecognizers.doubletap,Lo.GestureRecognizers.doubletap2,Lo.GestureRecognizers.pan,Lo.GestureRecognizers.pinch],handlePointerEventMouse:!1,inputClass:Lo.isIE11?Lo.Hammer.PointerEventInput:Lo.Hammer.TouchInput}),this.onHammerDragBinded=this.onHammerDrag.bind(this),this.onHammerDoubleTapBinded=this.onHammerDoubleTap.bind(this),this.onTouchPanBinded=this.onTouchPan.bind(this),this.onTouchPinchBinded=this.onTouchPinch.bind(this),this.hammer.on("dragstart dragmove dragend",this.onHammerDragBinded),this.hammer.on("doubletap",this.onHammerDoubleTapBinded),this.hammer.on("doubletap2",this.onHammerDoubleTapBinded),this.hammer.on("panstart panmove panend",this.onTouchPanBinded),this.hammer.on("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.get("drag").requireFailure("pinch"),this.hammer.get("drag").requireFailure("pan")),Jo.bind(this)(),is.bind(this)(),os.bind(this)(),ns.bind(this)(),this.containingDiv.appendChild(this.selectionLayer),Hn(this)}Lo.GlobalManagerMixin.call(_o.prototype);var No=_o.prototype;function Oo(t){t.pageX=t.pointers[0].clientX,t.pageY=t.pointers[0].clientY}function Vo(){var t=this.getDocument().createElement("div");return t.style.position="absolute",t.style.top=0,t.style.bottom=0,t.style.left=0,t.style.right=0,t.style.overflow="hidden",t.style.visibility="hidden",ss(t,!1),t}function Bo(t){var e=this.getDocument().createElement("div");return Uo(e,t),e.className="selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-"+t,e.classList.add("adsk-viewing-viewer"),e.setAttribute("data-sdp-handle",t),e}function Fo(){var t=this.getDocument().createElement("div");return t.classList.add("adsk-viewing-viewer"),t.classList.add("selector-rotate-point"),t.classList.add("autodesk-markups-extension-core-make-me-bigger"),Uo(t,"w"),t}function jo(){var t=this.getDocument().createElement("div");return t.classList.add("adsk-viewing-viewer"),t.classList.add("selector-rotate-point"),t.classList.add("autodesk-markups-extension-core-make-me-bigger"),t.classList.add("rotation-bridge"),Uo(t,"w"),t}function Uo(t,e){var i;switch(e){case"n":case"s":i="ns-resize";break;case"w":case"e":i="ew-resize";break;case"ne":case"sw":i="nesw-resize";break;case"nw":case"se":i="nwse-resize"}t.style.cursor=i}function Go(t){["n","s","w","e","nw","ne","sw","se"].forEach(function(e){this.selection.handle[e]=Bo.call(this,e),t.appendChild(this.selection.handle[e])}.bind(this))}function Wo(t){return as(t,".selector-drag-point")}function Ko(t){return as(t,".selector-rotate-point")}function Yo(){var t=this.getDocument().createElement("div");return ss(t,!0),t.classList.add("selector-box"),this.selection.rotationBridge=jo.bind(this)(),t.appendChild(this.selection.rotationBridge),this.selection.rotationHandle=Fo.bind(this)(),t.appendChild(this.selection.rotationHandle),Go.bind(this)(t),this.selection.element=t,Lo.isMobileDevice()||(this.onWheelBinded=this.onWheel.bind(this),this.selection.element.addEventListener("wheel",this.onWheelBinded),this.selection.element.addEventListener("DOMMouseScroll",this.onWheelBinded)),this.selectionLayer.appendChild(this.selection.element),Xo.bind(this)(!1),t}function Xo(t){this.selection.active=t,this.selection.element.style.display=t?"block":"none"}function qo(t,e,i){this.selection.x=t,this.selection.y=e,this.selection.rotation=i;var n=this.markup.getBoundingRect();n.width+=2*this.frameMargin,n.height+=2*this.frameMargin;var o=function(t,e){return"translate3d("+t+"px,"+e+"px,0)"}(t,e)+" rotate("+i+"rad)",s=n.width/2+"px "+n.height/2+"px";this.selection.element.style.msTransform=this.selection.element.style.webkitTransform=this.selection.element.style.transform=o,this.selection.element.style.msTransformOrigin=this.selection.element.style.webkitTransformOrigin=this.selection.element.style.transformOrigin=s}function Zo(t,e){this.selection.width=t,this.selection.height=e,this.selection.element.style.width=t+"px",this.selection.element.style.height=e+"px"}function Jo(){this.selection.element.addEventListener("mousedown",this._onRepositionMouseDown.bind(this))}No.unload=function(){this.containingDiv.removeChild(this.selectionLayer),this.selectionLayer=null},No.setSelection=function(t,e,i,n,o){var s=this.frameMargin,r=2*s;Zo.bind(this)(i+r,n+r),qo.bind(this)(t-s,e-s,o),Xo.bind(this)(!0),this.selectionLayer.style.visibility="visible"},No.setMarkup=function(t){if(this.hammer&&this.hammer.set({enable:null!==t}),this.markup=t,Xo.bind(this)(!1),t){var e=t.getBoundingRect(),i=t.getRotation();this.frameMargin=void 0!==e.margin?e.margin:yn,this.setSelection(e.x,e.y,e.width,e.height,i),this.enableResizeHandles(),this.enableRotationHandle(),t.preventReposition?this.selectionLayer.firstChild.style.cursor="":this.selectionLayer.firstChild.style.cursor="move"}},No.startDrag=function(t){this.markup&&this.markup.preventReposition||(this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),this._onRepositionMouseDown(t,this.editor.getMousePosition()))},No.isActive=function(){return this.selection.active},No.isDragging=function(){return this.selection.dragging},No.isResizing=function(){return this.selection.resizing},No.isRotating=function(){return this.selection.rotating},No.onMouseMove=function(t){},No.onMouseUp=function(t){},No.onWheel=function(t){this.editor.viewer.toolController.mousewheel(t)},No.onTouchPan=function(t){this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),t.preventDefault()},No.onTouchPinch=function(t){this.editor.viewer.toolController.getTool("gestures").distributeGesture(t),t.preventDefault()},No.onHammerDrag=function(t){function e(t,e,i){var n=e.getBoundingClientRect();t.mousePosition.x=i.pageX-n.left,t.mousePosition.y=i.pageY-n.top}switch(Oo(t),t.type){case"dragstart":e(this.editor.input,this.editor.svg,t),this.editor.callSnapperMouseDown(),Ko(t.target)?this._onRotationMouseDown(t):Wo(t.target)?this._onResizeMouseDown(t):this.startDrag(t),t.preventDefault();break;case"dragmove":e(this.editor.input,this.editor.svg,t),this.editor.callSnapperMouseMove(),this.onMouseMove(t),t.preventDefault();break;case"dragend":e(this.editor.input,this.editor.svg,t),this.onMouseUp(t),t.preventDefault()}},No.onHammerDoubleTap=function(t){Oo(t),function(t,e,i){var n=e.getBoundingClientRect();t.mousePosition.x=i.pageX-n.left,t.mousePosition.y=i.pageY-n.top}(this.editor.input,this.editor.svg,t),this.selection.dragging=!1,this.editor.editMode&&this.editor.editMode.onMouseDoubleClick(this.markup)},No.enableResizeHandles=function(){var t,e=this.markup;if(e.isHeightConstrained()||e.isWidthConstrained()){for(var i in this.selection.handle)(t=this.selection.handle[i])&&(t.style.display="none");e.isHeightConstrained()||(this.selection.handle.n.style.display="block",this.selection.handle.s.style.display="block"),e.isWidthConstrained()||(this.selection.handle.w.style.display="block",this.selection.handle.e.style.display="block")}else for(var i in this.selection.handle)(t=this.selection.handle[i])&&(t.style.display="block")},No.enableRotationHandle=function(){var t=this.markup.isRotationConstrained()?"none":"block";this.selection.rotationHandle.style.display=t,this.selection.rotationBridge.style.display=t},No._handleRightClickDown=function(t){return!(Lo.isMobileDevice()||!Ho.isRightClick(t,this.editor.viewer.navigation)&&!Ho.isMiddleClick(t))&&(this.editor.input.onMouseDownRightClick(t),!0)};var $o,Qo,ts=!1;function es(t,e){e?t.classList.add("selected"):t.classList.remove("selected")}function is(){this.selectionLayer.addEventListener("mousedown",this._onResizeMouseDown.bind(this))}function ns(){this.selection.element.addEventListener("mousedown",this._onRotationMouseDown.bind(this))}function os(){var t=function(t){if(!t.defaultPrevented){this.selection.dragging=!1;var e=this.editor.editMode;e&&e.onMouseDoubleClick(this.markup)}}.bind(this);this.selectionLayer.addEventListener("dblclick",t)}function ss(t,e){t.style.pointerEvents=e?"auto":"none"}function rs(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function as(t,e){return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):t.mozMatchesSelector?t.mozMatchesSelector(e):!!t.webkitMatchesSelector&&t.webkitMatchesSelector(e)}No._onRepositionMouseDown=function(t,e){if(!(this._handleRightClickDown(t)||this.markup&&this.markup.preventReposition)){ts=!Lo.isMobileDevice()&&Lo.isTouchDevice();var i=!(t instanceof this.getWindow().MouseEvent);if((i||!Wo(t.target)&&!Ko(t.target))&&(e=i?e:this.editor.getMousePosition(),this.initialCursor=e,this.initialPosition=this.markup.getClientPosition(),this.areAxisConstrained=!1,this.axisConstrains=new THREE.Vector2(1,1),this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),!this.selection.dragging)){if(this.selection.dragging=!0,this.editor.beginActionGroup(),t&&t.altKey){var n=this.editor;new go(n,n.getId(),this.markup,this.markup.position).execute()}this.dispatchEvent({type:N})}}},No._onRepositionMouseMove=function(t){if(ts)ts=!1;else if(this.selection.dragging&&this.markup&&!this.markup.preventReposition){var e=this.editor.getMousePosition(),i=this.editor.input.constrainAxis;this.areAxisConstrained!==i&&(this.areAxisConstrained=i,this.axisConstrains=i?new THREE.Vector2(0,0):new THREE.Vector2(1,1),this.initialPosition.x+=e.x-this.initialCursor.x,this.initialPosition.y+=e.y-this.initialCursor.y,this.initialCursor.x=e.x,this.initialCursor.y=e.y);var n={x:e.x-this.initialCursor.x,y:e.y-this.initialCursor.y};0===this.axisConstrains.x&&0===this.axisConstrains.y&&(Math.abs(n.x)>15?(this.axisConstrains.x=1,n.x+=n.x<0?15:-15):Math.abs(n.y)>15&&(this.axisConstrains.y=1,n.y+=n.y<0?15:-15));var o=this.initialPosition.x+n.x*this.axisConstrains.x,s=this.initialPosition.y+n.y*this.axisConstrains.y;qo.bind(this)(o,s,this.selection.rotation);var r=this.editor.positionFromClientToMarkups(o,s);new zo(this.editor,this.markup,r).execute()}},No._onRepositionMouseUp=function(){this.markup&&this.markup.preventReposition||(this.last=null,this.onMouseMove=function(){},this.onMouseUp=function(){},this.selection.dragging&&(this.editor.closeActionGroup(),this.selection.dragging=!1,this.dispatchEvent({type:O})))},No._onResizeMouseDown=function(t){if(!this._handleRightClickDown(t)){var e=t.target;if(Wo(e)){this.selection.handle.resizing=e;var i=this.selection.handle.resizing.getAttribute("data-sdp-handle");this.containingDiv.style.cursor=i+"-resize";var n=this.editor.getMousePosition(),o=this.markup.getClientPosition(),s=this.markup.getBoundingRect();this.initial={x:o.x,y:o.y,width:s.width,height:s.height,mouseX:n.x,mouseY:n.y},this.onMouseMove=this._onResizeMouseMove.bind(this),this.onMouseUp=this._onResizeMouseUp.bind(this),this.selection.resizing||(this.selection.resizing=!0,this.editor.beginActionGroup(),es(t.target,!0),this.dispatchEvent({type:N}))}}},No._onResizeMouseMove=function(t){if(this.selection.resizing){var e=this.editor.getMousePosition(),i=this.initial,n={x:e.x-i.mouseX,y:e.y-i.mouseY},o=new THREE.Vector3(n.x,n.y,0),s=(new THREE.Matrix4).makeRotationZ(-this.selection.rotation);n=o.applyMatrix4(s);var r=i.x,a=i.y,h=i.width,u=i.height,l=new THREE.Vector3,c=this.selection.handle.resizing.getAttribute("data-sdp-handle");if(this.editor.input.keepAspectRatio&&-1!==["nw","ne","sw","se"].indexOf(c)){var d=new THREE.Vector3(n.x,n.y,0);switch(c){case"nw":n.set(-i.width,-i.height,0);break;case"ne":case"sw":n.set(i.width,-i.height,0);break;case"se":n.set(i.width,i.height,0)}n.normalize(),n=d.projectOnVector(n)}if({n:function(){u-=n.y,l.y=n.y},s:function(){u+=n.y,l.y=n.y},w:function(){h-=n.x,l.x=n.x},e:function(){h+=n.x,l.x=n.x},nw:function(){this.n(),this.w()},ne:function(){this.n(),this.e()},sw:function(){this.s(),this.w()},se:function(){this.s(),this.e()}}[c](),!(h<=this.markup.getMinWidth()||u<=this.markup.getMinHeight())){var p=(new THREE.Matrix4).makeRotationZ(this.selection.rotation),f=l.applyMatrix4(p),y=this.editor.positionFromClientToMarkups(r+.5*f.x,a+.5*f.y),v=this.editor.sizeFromClientToMarkups(h,u);new mt(this.editor,this.markup,y,v.x,v.y).execute()}}},No._onResizeMouseUp=function(t){for(var e in this.selection.resizing=!1,this.selection.handle.resizing=null,this.containingDiv.style.cursor="",this.selection.handle)this.selection.handle[e]&&es(this.selection.handle[e],!1);this.editor.closeActionGroup(),this.dispatchEvent({type:O}),this.onMouseMove=function(){},this.onMouseUp=function(){}},No._onRotationMouseDown=function(t){this._handleRightClickDown(t)||Ko(t.target)&&(this.editor.beginActionGroup(),this.selection.rotating=!0,Qo=this.editor.getMousePosition(),$o=this.selection.rotation||0,this.onMouseMove=this._onRotationMouseMove.bind(this),this.onMouseUp=this._onRotationMouseUp.bind(this),es(t.target,!0),this.dispatchEvent({type:N}))},No._onRotationMouseMove=function(t){if(this.selection.rotating){var e=this.editor.getMousePosition(),i=this.markup.getClientPosition(),n=rs(i,e)-rs(i,Qo)+$o;if(this.editor.input.snapRotations){var o=Gn(22.5);n=Math.ceil(n/o)*o}qo.bind(this)(this.selection.x,this.selection.y,n),new Do(this.editor,this.markup,n).execute()}},No._onRotationMouseUp=function(t){this.selection.rotating=!1,$o=null,Qo=null,es(this.selection.rotationHandle,!1),this.editor.closeActionGroup(),this.dispatchEvent({type:O})};var hs=Autodesk.Viewing.Private;function us(){Autodesk.Viewing.ToolInterface.call(this),this.names=["markups.core"],this.panTool=null,this.allowNav=!1,this.is2d=!1,this.coreExt=null,this.hotkeysEnabled=!0;var t=!1,e=!1;this.allowNavigation=function(t){this.allowNav=t},this.setCoreExtension=function(t){this.coreExt=t},this.setHotkeysEnabled=function(t){this.hotkeysEnabled=t},this.activate=function(t,e){this.panTool=e.toolController.getTool("pan"),this.panTool&&this.panTool.activate("pan"),this.is2d=e.model.is2d(),this.viewer=e},this.deactivate=function(t){this.panTool&&this.panTool.deactivate("pan")},this.handleKeyDown=function(i,n){if(!this.coreExt.editMode)return!1;if(!this.hotkeysEnabled)return!0;switch(n){case Autodesk.Viewing.KeyCode.CONTROL:t=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:e=!0;break;case Autodesk.Viewing.KeyCode.x:t&&!this.allowNav&&this.coreExt.cut();break;case Autodesk.Viewing.KeyCode.c:t&&!this.allowNav&&this.coreExt.copy();break;case Autodesk.Viewing.KeyCode.v:t&&!this.allowNav&&this.coreExt.paste();break;case Autodesk.Viewing.KeyCode.d:t&&!this.allowNav&&(this.coreExt.copy(),this.coreExt.paste());break;case Autodesk.Viewing.KeyCode.z:!t||e||this.allowNav?t&&e&&!this.allowNav&&this.coreExt.redo():this.coreExt.undo();break;case Autodesk.Viewing.KeyCode.y:t&&!this.allowNav&&this.coreExt.redo();break;case Autodesk.Viewing.KeyCode.ESCAPE:this.coreExt.onUserCancel();break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var o=this.coreExt.getSelection();o&&this.coreExt.deleteMarkup(o);break;case Autodesk.Viewing.KeyCode.F12:return!1}return!0},this.handleKeyUp=function(i,n){if(!this.coreExt.editMode)return!1;if(!this.hotkeysEnabled)return!0;switch(n){case Autodesk.Viewing.KeyCode.CONTROL:t=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:e=!1}return!0},this.update=function(){return!!(this.allowNav&&this.panTool&&this.panTool.update)&&this.panTool.update()},this.handleSingleClick=function(t,e){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleClick)&&this.panTool.handleSingleClick(t,e)},this.handleDoubleClick=function(t,e){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleClick)&&this.panTool.handleDoubleClick(t,e)},this.handleSingleTap=function(t){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleTap)&&this.panTool.handleSingleTap(t)},this.handleDoubleTap=function(t){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleTap)&&this.panTool.handleDoubleTap(t)},this.handleWheelInput=function(t,e){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleWheelInput)&&(this.coreExt.callSnapperMouseMove(),this.panTool.handleWheelInput(t,e))},this.handleButtonDown=function(t,e){return!(this.allowNav||this.is2d&&(hs.isRightClick(t,this.viewer.navigation)||hs.isMiddleClick(t)))||!(!this.panTool||!this.panTool.handleButtonDown)&&this.panTool.handleButtonDown(t,e)},this.handleButtonUp=function(t,e){return!(this.allowNav||this.is2d&&(hs.isRightClick(t,this.viewer.navigation)||hs.isMiddleClick(t)))||!(!this.panTool||!this.panTool.handleButtonUp)&&this.panTool.handleButtonUp(t,e)},this.handleMouseMove=function(t){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleMouseMove)&&this.panTool.handleMouseMove(t)},this.handleGesture=function(t){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleGesture)&&this.panTool.handleGesture(t)},this.handleBlur=function(t){return!this.allowNav||!(!this.panTool||!this.panTool.handleBlur)&&this.panTool.handleBlur(t)}}function ls(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var cs={},ds=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,(i=[{key:"register",value:function(t,e){if(t in cs)throw new Error("EditMode with id (".concat(t,") already registered."));cs[t]=e}},{key:"unregister",value:function(t){t in cs&&delete cs[t]}},{key:"getClass",value:function(t){return cs[t]||null}},{key:"getRegistered",value:function(){var t={};for(var e in cs)cs.hasOwnProperty(e)&&(t[e]=cs[e]);return t}}])&&ls(e.prototype,i),n&&ls(e,n),t}());ds.register(a,J),ds.register(h,Xt),ds.register(u,ht),ds.register(l,se),ds.register(c,ye),ds.register(d,Ie),ds.register(p,ri),ds.register(f,Oe),ds.register(y,qe),ds.register(v,Nt),ds.register(g,gi),ds.register(m,Ui);i(564);function ps(t,e,i,n,o,s,r){try{var a=t[s](r),h=a.value}catch(t){return void i(t)}a.done?e(h):Promise.resolve(h).then(n,o)}function fs(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var s=t.apply(e,i);function r(t){ps(s,n,o,r,a,"next",t)}function a(t){ps(s,n,o,r,a,"throw",t)}r(void 0)}))}}var ys=Autodesk.Viewing.MeasureCommon;function vs(t,e){var i=this;Autodesk.Viewing.Extension.call(this,t,e),this.options=this.options||{},this.markups=[],this.styles={},this.activeLayer="",this.duringViewMode=!1,this.duringEditMode=!1,this.svgLayersMap={},this.actionManager=new yo(50),this.actionManager.addEventListener(R,this.onEditActionHistoryChanged.bind(this)),this.nextId=0,this.clipboard=new xo(this),this.input=new So,this.input.setGlobalManager(this.globalManager),this.createSvgElement=gn.bind(this),this.addSvgMetadata=Cn.bind(this),this.checkPolygon=no.bind(this),Hn(this);var n=function(t){t.is2d()&&(i.getStrokeWidth(),i.getFontWidth())};t.model?n(t.model):t.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,(function(e){var i=e.model;t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,(function(){n(i)}),{once:!0})}),{once:!0}),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onViewerResizeBinded=function(t){var e=this;e.onViewerResize(t),requestAnimationFrame((function(){e.duringViewMode&&e.onViewerResize(t)}))}.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.onMarkupEnterEditionBinded=this.onMarkupEnterEdition.bind(this),this.onMarkupCancelEditionBinded=this.onMarkupCancelEdition.bind(this),this.onMarkupDeleteEditionBinded=this.onMarkupDeleteEdition.bind(this),this.onToolChangeBinded=this.onToolChange.bind(this),this.onUnitsCalibrationStartsBinded=this.onUnitsCalibrationStarts.bind(this),t.addEventListener(ys.Events.UNITS_CALIBRATION_STARTS_EVENT,this.onUnitsCalibrationStartsBinded)}vs.prototype=Object.create(Autodesk.Viewing.Extension.prototype),vs.prototype.constructor=vs;var gs=vs.prototype;gs.load=fs(regeneratorRuntime.mark((function t(){var e,i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.svg=this.createSvgElement("svg"),mn(e),(i=new zt).setAttribute("position","absolute"),i.setAttribute("left","0"),i.setAttribute("top","0"),i.setAttribute("transform","scale(1,-1)",{allBrowsers:!0}),i.setAttribute("transformOrigin","0, 0",{allBrowsers:!0}),e.setAttribute("style",i.getStyleString()),this.bounds={x:0,y:0,width:0,height:0},this.input.attachTo(this),this.editFrame=new _o(this.viewer.container,this),this.editFrame.addEventListener(N,function(){this.disableMarkupInteractions(!0)}.bind(this)),this.editFrame.addEventListener(O,function(){this.disableMarkupInteractions(!1)}.bind(this)),n=this.options.markupToolClass||us,this.changeMarkupTool(n,!this.options.markupDisableHotkeys),t.next=18,this.viewer.loadExtension("Autodesk.Snapping");case 18:return this.snapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer,{markupMode:!0}),this.viewer.toolController.registerTool(this.snapper),t.abrupt("return",!0);case 21:case"end":return t.stop()}}),t,this)}))),gs.changeMarkupTool=function(t,e){this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.markupTool=new t,this.markupTool.setCoreExtension(this),this.markupTool.setHotkeysEnabled(e),this.viewer.toolController.registerTool(this.markupTool)},gs.unload=function(){this.hide(),this.input.detachFrom(this),this.editFrame.unload(),this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null);var t=this.svg;return t&&this.onMouseDownBinded&&(t.removeEventListener("mousedown",this.onMouseDownBinded),this.onMouseDownBinded=null),t.parentNode&&t.parentNode.removeChild(t),this.editModeSvgLayerNode=null,this.svg=null,!0},vs.prototype.getStrokeWidth=function(){return(!this.initialStrokeWidth||this.viewer.model&&!this.viewer.model.is2d())&&(this.initialStrokeWidth=this.sizeFromClientToMarkups(0,dn).y),this.initialStrokeWidth},vs.prototype.getFontWidth=function(){return(!this.initialFontWidth||this.viewer.model&&!this.viewer.model.is2d())&&(this.initialFontWidth=this.sizeFromClientToMarkups(0,pn).y),this.initialFontWidth},vs.prototype.toggleEditMode=function(){this.duringEditMode?this.leaveEditMode():this.enterEditMode()},vs.prototype.enterEditMode=function(t){function e(t,e){if(t)for(var i=t.markups,n=0;n<i.length;n++){i[n].disableInteractions(e)}}if(t&&!this.svgLayersMap[t])return console.warn("No such layer exists."),!1;if(!this.duringViewMode&&!this.show())return!1;if(!this.editModeSvgLayerNode){var i=this.createSvgElement("g");this.editModeSvgLayerNode={markups:[],svg:i},this.editModeSvgLayerNode.svg.setAttribute("cursor","default")}if(this.editModeSvgLayerNode.svg.parentNode==this.svg&&t||this.svg.appendChild(this.editModeSvgLayerNode.svg),this.svg.setAttribute("cursor","crosshair"),t){var n=this.svgLayersMap[t];if(n){var o=this.editModeSvgLayerNode.svg.parentNode;for(var s in o&&o.removeChild(this.editModeSvgLayerNode.svg),e(this.editModeSvgLayerNode,!0),this.svgLayersMap)for(var r=this.svgLayersMap[s].markups,a=0;a<r.length;a++){var h=r[a];s!==t.toString()?h.disableInteractions(!0):h.disableInteractions(!1)}this.activeLayer=t,this.editingLayer=t;var u=n.svg;u.parentNode&&this.svg.removeChild(u),this.markups=n.markups.slice(),this.svg.appendChild(u)}}else{if(this.editingLayer){for(var l=0;l<this.markups.length;l++){this.markups[l].disableInteractions(!0)}e(this.editModeSvgLayerNode,!1)}this.editingLayer="",this.editModeSvgLayerNode?this.markups=this.editModeSvgLayerNode.markups.slice():this.markups=[],this.activeLayer=""}return this.input.enterEditMode(),this.activateTool(!0),this.styles={},this.defaultStyle=null,this.duringEditMode=!0,this.changeEditMode(new J(this)),this.actionManager.clear(),this.dispatchEvent({type:S}),this.allowNavigation(!1),!0},vs.prototype.leaveEditMode=function(){return!this.duringEditMode||!this.duringViewMode||!!this.viewer&&(this.editMode.destroy(),this.editMode=null,this.duringEditMode=!1,this.snapper&&(this.snapper.indicator.clearOverlays(),this.snapper.clearSnapped()),this.editModeSvgLayerNode&&this.editModeSvgLayerNode.svg.parentNode&&this.svg.removeChild(this.editModeSvgLayerNode.svg),this.svg.setAttribute("cursor","default"),this.input.leaveEditMode(),this.editFrame.setMarkup(null),this.activateTool(!0),this.allowNavigation(!0),this.dispatchEvent({type:A}),!0)},vs.prototype.toggle=function(){this.duringViewMode?this.hide():this.show()},vs.prototype.show=function(){var t=this.viewer;if(!t||!t.model||!this.svg)return!1;if(this.duringViewMode||this.duringEditMode)return!0;t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),t.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded),t.container.appendChild(this.svg),t.reorderElements(this.svg),this.input.enterViewMode(),Yn(t),this.onViewerRolloverObject=t.impl.rolloverObject,t.impl.rolloverObject=function(){},this.activateTool(!0);var e=t.impl.camera;return this.onViewerResize({width:e.clientWidth,height:e.clientHeight}),this.svgLayersMap={},this.duringViewMode=!0,this.allowNavigation(!0),!0},vs.prototype.hide=function(){var t=this.viewer;if(!t||!this.duringViewMode)return!0;if(this.duringEditMode&&!this.leaveEditMode())return!1;t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),t.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded);var e=this.svg;return e.parentNode&&e.parentNode.removeChild(e),this.unloadMarkupsAllLayers(),zn(e),this.input.leaveViewMode(),Xn(t),this.viewer.impl.rolloverObject=this.onViewerRolloverObject,this.activateTool(!1),this.duringViewMode=!1,!0},vs.prototype.clear=function(){if(this.duringEditMode){var t=this.editingLayer?this.svgLayersMap[this.editingLayer]:this.editModeSvgLayerNode;if(t){var e=t.markups,i=t.svg;if(i&&i.childNodes.length>0)for(;i.childNodes.length;)i.removeChild(i.childNodes[0]);for(;e.length>0;){var n=e[0];this.removeMarkup(n),n.destroy()}}}else console.warn("Clear only removes markups when in Edit Mode.")},vs.prototype.generateData=function(){var t=this.editModeSvgLayerNode.svg;this.editMode&&this.editMode.onSave(),zn(this.svg),this.activeLayer&&(t=this.svgLayersMap[this.activeLayer].svg);var e=this.createSvgElement("svg");Pn(this.svg,e),Pn(t,this.svg);var i=[this.addSvgMetadata(this.svg,{"data-model-version":"4"})];this.markups.forEach((function(t){var e=t.setMetadata();e&&i.push(e)}));var n=Rn(this.svg);return i.forEach((function(t){t.parentNode.removeChild(t)})),Pn(this.svg,t),Pn(e,this.svg),e=null,n},vs.prototype.generatePoints3d=function(){var t={markups:[],main:null},e=this.markups,i=e.length;if(0===i)return t;for(var n=this.viewer.impl.renderer().readbackTargetId(),o=0;o<i;++o){var s=e[o],r=s.generatePoint3d(n)||null;t.markups.push({id:s.id,type:s.type,point:r||null})}if(1===i){var h=t.markups[0].point;return t.main=h&&h.clone(),t}for(var u=0;u<i;++u){var l=t.markups[u];if(l.type===a&&null!==l.point)return t.main=l.point.clone(),t}for(var c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY,y=0;y<i;++y){var v=e[y].generateBoundingBox();c=Math.min(c,v.min.x),d=Math.min(d,v.min.y),p=Math.max(p,v.max.x),f=Math.max(f,v.max.y)}var g={vertexCount:4};g.xVertices=new Float32Array([c,p,p,c]),g.yVertices=new Float32Array([d,d,f,f]);var m=this.checkPolygon(g,n),x=m&&this.viewer.clientToWorld(m.x,m.y);return t.main=x&&x.point,t},vs.prototype.renderToCanvas=function(t,e,i){var n,o=this.bounds.width,s=this.bounds.height,r=this.getSvgViewBox(o,s),a=0,h=[],u=function(){e&&++a===h.length&&e()}.bind(this);if(i)for(var l=Object.keys(this.svg.childNodes),c=Object.keys(this.svgLayersMap),d=0;d<l.length;d++)for(var p=0;p<c.length;p++)n=this.svgLayersMap[c[p]],this.svg.childNodes[l[d]]===n.svg&&(h=h.concat(n.markups));else n=this.svgLayersMap[this.activeLayer]||this.editModeSvgLayerNode,h=n.markups;0===h.length?e():h.forEach((function(e){e.renderToCanvas(t,r,o,s,u)}))},vs.prototype.changeEditMode=function(t){var e=this.editMode;e&&e.destroy(),t.addEventListener(L,function(){this.disableMarkupInteractions(!0)}.bind(this)),t.addEventListener(H,function(){this.disableMarkupInteractions(!1)}.bind(this)),t.addEventListener(_,function(t){this.dispatchEvent(t)}.bind(this)),this.editMode=t,this.styles[t.type]=w(t.getStyle()),this.dispatchEvent({type:T,target:t})},vs.prototype.isNavigationAllowed=function(){return!this.viewer.impl.camera.isPerspective},vs.prototype.allowNavigation=function(t){var e=this.editMode;this.navigating=t,t?(this.svg.setAttribute("pointer-events","none"),e&&this.selectMarkup(null)):this.svg.setAttribute("pointer-events","painted");for(var i=this.markups,n=i.length,o=0;o<n;++o)i[o].updateStyle();if(e&&e.notifyAllowNavigation(t),t&&(this.duringEditMode||this.duringViewMode)&&!this.isNavigationAllowed())return!1;t&&this.snapper&&(this.snapper.indicator.clearOverlays(),this.snapper.clearSnapped()),this.markupTool.allowNavigation(t)},vs.prototype.disableMarkupInteractions=function(t){this.editModeSvgLayerNode&&this.editModeSvgLayerNode.svg.setAttribute("cursor",t?"inherit":"default"),this.markups.forEach((function(e){e.disableInteractions(t)}))},vs.prototype.activateTool=function(t){if(t)this.cachedNavigationTool||(this.cachedNavigationTool=this.viewer.getActiveNavigationTool(),this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)),this.viewer.setActiveNavigationTool(this.markupTool.getName());else{if(this.cachedNavigationTool)this.viewer.setActiveNavigationTool(this.cachedNavigationTool),this.cachedNavigationTool=null;else{var e=this.viewer.getDefaultNavigationToolName();this.viewer.setActiveNavigationTool(e)}this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)}},vs.prototype.onToolChange=function(t){if(t.toolName===this.markupTool.getName()){if(t.active){var e=this.isNavigationAllowed();this.viewer.setNavigationLockSettings({pan:e,zoom:e,orbit:!1,roll:!1,fov:!1,walk:!1,gotoview:!1})}this.viewer.setNavigationLock(t.active)}},vs.prototype.onUnitsCalibrationStarts=function(){this.duringEditMode&&this.hide()},gs.changeInputHandler=function(t){this.input.detachFrom(this),t.attachTo(this),this.input=t,this.duringEditMode&&t.enterEditMode(),this.duringViewMode&&t.enterViewMode()},vs.prototype.copy=function(){this.clipboard.copy()},vs.prototype.cut=function(){this.clipboard.cut()},vs.prototype.paste=function(){this.clipboard.paste()},vs.prototype.undo=function(){this.actionManager.undo()},vs.prototype.redo=function(){this.actionManager.redo()},vs.prototype.isUndoStackEmpty=function(){return this.actionManager.isUndoStackEmpty()},vs.prototype.isRedoStackEmpty=function(){return this.actionManager.isRedoStackEmpty()},gs.beginActionGroup=function(){this.actionManager.beginActionGroup()},gs.closeActionGroup=function(){this.actionManager.closeActionGroup()},gs.cancelActionGroup=function(){this.actionManager.cancelActionGroup()},gs.getId=function(){return++this.nextId},gs.onEditActionHistoryChanged=function(t){var e=t.data;if("undo"!==e.action&&-1!==e.targetId){var i=this.getMarkup(e.targetId);this.selectMarkup(i)}if("undo"===e.action&&!this.isUndoStackEmpty()){var n=this.getMarkup(this.actionManager.getLastElementInUndoStack().getTargetId());this.selectMarkup(n)}this.dispatchEvent(t)},vs.prototype.getMarkup=function(t){for(var e=this.markups,i=e.length,n=0;n<i;++n)if(e[n].id==t)return e[n];return null},vs.prototype.selectMarkup=function(t){if(t)if(this.editMode.type===t.type)this.editMode.setSelection(t);else{var e=t.getEditMode();e.setSelection(null),this.changeEditMode(e),this.setStyle(t.getStyle()),this.editMode.setSelection(t)}else this.editMode&&this.editMode.setSelection(null)},vs.prototype.getSelection=function(){return this.editMode.getSelection()},vs.prototype.deleteMarkup=function(t,e){(!this.editMode||this.editMode&&this.editMode.selectedMarkup.id!==t.id)&&(this.editMode=t.getEditMode()),this.editMode.deleteMarkup(t,e)},gs.addMarkup=function(t){var e,i=this.activeLayer,n=this.svgLayersMap[i]||"";if(n){var o=n.svg;t.setParent(o),n.markups.push(t),e=n.markups.slice()}else t.setParent(this.editModeSvgLayerNode.svg),this.editModeSvgLayerNode.markups.push(t),e=this.editModeSvgLayerNode.markups.slice();t.addEventListener(C,this.onMarkupSelectedBinded),t.addEventListener(z,this.onMarkupEnterEditionBinded),t.addEventListener(P,this.onMarkupCancelEditionBinded),t.addEventListener(D,this.onMarkupDeleteEditionBinded),this.duringEditMode&&(this.markups=e)},gs.removeMarkup=function(t){if(!t)return!1;var e=this;if(-1===function(t){var i,n=-1;if(e.editModeSvgLayerNode){var o=e.editModeSvgLayerNode.markups;if(-1!==(i=o.indexOf(t)))return o.splice(i,1),n=o.slice(),""===e.activeLayer&&(e.markups=n),n}if(e.svgLayersMap)for(var s in e.svgLayersMap){var r=e.svgLayersMap[s].markups;if(-1!==(i=r.indexOf(t)))return r.splice(i,1),n=r.slice(),e.activeLayer===s&&(e.markups=n),n}return n}(t))return!1;t.setParent(null),t.removeEventListener(C,this.onMarkupSelectedBinded),t.removeEventListener(z,this.onMarkupEnterEditionBinded),t.removeEventListener(P,this.onMarkupCancelEditionBinded),t.removeEventListener(D,this.onMarkupDeleteEditionBinded);var i=this.editMode;i&&(i.getSelection()===t&&this.selectMarkup(null))},vs.prototype.setStyle=function(t){var e=this.styles,i=this.editMode;k(t,e[i.type]),i.setStyle(e[i.type])},vs.prototype.getStyle=function(){return w(this.styles[this.editMode.type])},vs.prototype.getDefaultStyle=function(){return this.defaultStyle=this.defaultStyle||M(["stroke-width","font-size","font-family","font-style","font-weight","stroke-color","stroke-opacity","fill-color","text-data","fill-opacity"],this),this.defaultStyle},gs.bringToFront=function(t){this.sendMarkupTo(t,this.markups.length-1)},gs.sendToBack=function(t){this.sendMarkupTo(t,0)},gs.bringForward=function(t){var e=this.markups.indexOf(t);this.sendMarkupTo(t,e+1)},gs.bringBackward=function(t){var e=this.markups.indexOf(t);this.sendMarkupTo(t,e-1)},gs.sendMarkupTo=function(t,e){var i=this.markups,n=i.indexOf(t);if(!(-1===n||e<0||e>=i.length))if(i.splice(n,1),e=n>e?e-1:e,i.splice(e,0,t),t.setParent(null),this.activeLayer){var o=this.svgLayersMap[this.activeLayer].svg;t.setParent(o)}else t.setParent(this.editModeSvgLayerNode.svg)},vs.prototype.loadMarkups=function(t,e){if(this.duringEditMode)return console.warn("Markups will not be loaded during the edit mode"),!1;if(!this.duringViewMode)return!1;if(!e)return console.warn("loadMarkups failed; missing 2nd argument 'layerId'"),!1;var i=Ln(t);if(!i)return!1;if(e in this.svgLayersMap&&this.svg.childNodes.length>0)return console.warn("This layer is already loaded, will not load again."),!1;this.activeLayer=e;var n=this.svgLayersMap[e];n&&delete this.svgLayersMap[e],n={markups:[],svgString:t,svg:this.createLayerNode()},this.svgLayersMap[e]=n;for(var o=i.childNodes,s=0;s<o.length;s++){var r=o[s],a=to(r,this);a&&this.duringEditMode&&this.editingLayer!==this.activeLayer&&a.disableInteractions(!0),a||"metadata"===r.localName||(n.svg.appendChild(r),s--,"function"==typeof r.setAttribute&&r.setAttribute("pointer-events","none"))}var h=this.svgLayersMap[this.activeLayer].svg;return this.svg.appendChild(h),this.duringEditMode&&this.editingLayer!==this.activeLayer&&(this.activeLayer=this.editingLayer,this.editingLayer&&(this.markups=this.svgLayersMap[this.activeLayer].markups.slice())),!0},gs.createLayerNode=function(){var t=this.createSvgElement("g");return t.setAttribute("cursor","default"),t},vs.prototype.revertLayer=function(t){if(!t)return console.warn("revertLayer failed because no layerId was supplied."),!1;var e=this.svgLayersMap[t];if(!e)return console.warn("The supplied layer does not exist."),!1;this.duringEditMode&&this.leaveEditMode();var i=this.markups.slice();this.markups=e.markups;var n=e.svgString;if(this.unloadMarkups(t),this.loadMarkups(n,t),this.editingLayer){if(this.editingLayer!==t){this.markups=i;var o=this.svgLayersMap[this.editingLayer];o&&(o.markups=i)}}else this.editModeSvgLayerNode&&(this.editModeSvgLayerNode.markups=i);if(this.editingLayer||0===this.editingLayer.length){var s=0===this.editingLayer.length?this.editModeSvgLayerNode.svg:this.svgLayersMap[this.editingLayer].svg;s.parentNode==this.svg&&(this.svg.removeChild(s),this.svg.appendChild(s))}return!0},vs.prototype.unloadMarkups=function(t){if(!t)return console.warn("unloadMarkups failed; No layerId provided."),!1;var e=this.svgLayersMap[t];if(!e)return console.warn("No such layer exists to unload."),!1;for(var i=e.markups.slice(),n=i.length,o=0;o<n;o++){var s=i[o];this.removeMarkup(s),s.destroy()}return e.svg.parentNode===this.svg&&this.svg.removeChild(e.svg),delete this.svgLayersMap[t],this.activeLayer.toString()===t.toString()&&(this.activeLayer=""),this.editingLayer&&this.editingLayer.toString()===t.toString()&&(this.editingLayer="",this.duringEditMode&&this.leaveEditMode()),!0},vs.prototype.unloadMarkupsAllLayers=function(){this.activeLayer="";var t,e=this;for(t in function(){if(e.editModeSvgLayerNode)for(var t=e.editModeSvgLayerNode.markups.slice(),i=t.length,n=0;n<i;n++){var o=t[n];e.removeMarkup(o),o.destroy()}}(),this.svgLayersMap)this.unloadMarkups(t)},vs.prototype.hideMarkups=function(t){if(!t)return console.warn("hideMarkups failed; No layerId provided."),!1;var e=this.svgLayersMap[t];if(!e)return!1;var i=e.svg;return i.parentNode!=this.svg?(console.warn("Layer is already hidden."),!1):(this.svg.removeChild(i),!0)},vs.prototype.showMarkups=function(t){if(!t)return console.warn("showMarkups failed; No layerId provided."),!1;var e=this.svgLayersMap[t];if(!e)return!1;var i=e.svg;this.svg.appendChild(i)},gs.positionFromClientToMarkups=function(t,e){return this.clientToMarkups(t,e)},gs.positionFromMarkupsToClient=function(t,e){return this.markupsToClient(t,e)},gs.vectorFromClientToMarkups=function(t,e){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(t,e);return{x:n.x-i.x,y:n.y-i.y}},gs.vectorFromMarkupsToClient=function(t,e){var i=this.markupsToClient(0,0),n=this.markupsToClient(t,e);return{x:n.x-i.x,y:n.y-i.y}},gs.sizeFromClientToMarkups=function(t,e){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(t,e);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},gs.sizeFromMarkupsToClient=function(t,e){var i=this.markupsToClient(0,0),n=this.markupsToClient(t,e);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},gs.markupsToClient=function(t,e){var i=this.viewer.impl.camera,n=new THREE.Vector3(t,e,0);if(i.isPerspective){var o=this.viewer.impl.getCanvasBoundingClientRect();n.x=n.x/1e3*(.5*o.height)+.5*o.width,n.y=-n.y/1e3*(.5*o.height)+.5*o.height}else{n.applyMatrix4(i.matrixWorld),n.sub(i.position);var s=this.viewer.model&&this.viewer.model.getData().globalOffset;s&&n.sub(s),(n=Nn(n,this.viewer,!1)).z=0}return n},gs.clientToMarkups=function(t,e){var i=this.viewer.impl.camera,n=new THREE.Vector3(t,e,0);if(i.isPerspective){var o=this.viewer.impl.getCanvasBoundingClientRect();n.x=(n.x-.5*o.width)/(.5*o.height)*1e3,n.y=-(n.y-.5*o.height)/(.5*o.height)*1e3}else{n=On(n.x,n.y,0,this.viewer);var s=this.viewer.model&&this.viewer.model.getData().globalOffset;s&&n.add(s),n.add(i.position),n.applyMatrix4(i.matrixWorldInverse),n.z=0}return n},gs.getSvgViewBox=function(t,e){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(t,e),o=Math.min(i.x,n.x),s=Math.min(i.y,n.y);return[o,s,Math.max(i.x,n.x)-o,Math.max(i.y,n.y)-s].join(" ")},gs.getBounds=function(){return this.bounds},gs.getMousePosition=function(){return this.editMode.useWithSnapping()&&this.snapper&&this.snapper.isSnapped()?this.getSnapPosition():this.input.getMousePosition()},gs.getSnapPosition=function(){var t=ys.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer),e=this.project(t);return{x:e.x,y:e.y}},gs.project=function(t){var e=this.viewer.navigation.getCamera(),i=this.viewer.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(t);return n.project(e),new THREE.Vector3(Math.round((n.x+1)/2*i.width),Math.round((1-n.y)/2*i.height),n.z)},gs.onCameraChange=function(){var t=this.getSvgViewBox(this.bounds.width,this.bounds.height);if("NaN NaN NaN NaN"!==t){this.svg&&this.svg.setAttribute("viewBox",t);var e=this.editMode;if(e){if(this.editFrame.isActive()){var i=e.getSelection();this.editFrame.setMarkup(i)}e.updateTextBoxStyle&&e.updateTextBoxStyle(),this.snapper&&e.useWithSnapping()&&this.snapper.indicator.render()}}},gs.onViewerResize=function(t){this.bounds.x=0,this.bounds.y=0,this.bounds.width=t.width,this.bounds.height=t.height,this.svg&&(this.svg.setAttribute("width",this.bounds.width),this.svg.setAttribute("height",this.bounds.height)),this.onCameraChange()},gs.callSnapperMouseDown=function(){if(this.editMode&&this.editMode.useWithSnapping()){var t=this.input.getMousePosition();this.snapper&&(this.snapper.onMouseDown(t),this.snapper.indicator.render())}else this.snapper&&(this.snapper.clearSnapped(),this.snapper.indicator.clearOverlays())},gs.callSnapperMouseMove=function(){if(this.editMode&&this.editMode.useWithSnapping()){var t=this.input.getMousePosition();this.snapper&&(this.snapper.onMouseMove(t),this.snapper.indicator.render())}},gs.onMouseMove=function(t){this.navigating||(this.editFrame.isActive()&&"mousemove"===t.type&&this.editFrame.onMouseMove(t),this.callSnapperMouseMove(),this.editMode&&this.editMode.onMouseMove(t))},gs.onMouseDown=function(t){$n(),this.callSnapperMouseDown();var e=this.getBounds(),i=this.getMousePosition();i.x>=e.x&&i.x<=e.x+e.width&&i.y>=e.y&&i.y<=e.y+e.height&&this.editMode.onMouseDown(t),this.editMode.creating||t.target!==this.svg||this.selectMarkup(null),this.ignoreNextMouseUp=!1},gs.onMouseUp=function(t){this.navigating||(this.editFrame.isActive()?this.editFrame.onMouseUp(t):this.ignoreNextMouseUp||this.editMode.onMouseUp(t))},gs.onMouseDoubleClick=function(t){this.navigating||this.editFrame.isActive()||this.editMode.onMouseDoubleClick(t)},gs.onUserCancel=function(){this.editMode&&(this.editMode.creating?this.editMode.creationCancel():this.editMode.unselect())},gs.onMarkupSelected=function(t){this.selectMarkup(t.markup),this.dispatchEvent(t)},gs.onMarkupEnterEdition=function(){},gs.onMarkupCancelEdition=function(){this.onUserCancel()},gs.onMarkupDeleteEdition=function(t){this.removeMarkup(t.markup),this.editMode.deleteMarkup()},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsCore",vs);i(566);function ms(t){return(ms="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xs(t,e){Autodesk.Viewing.Extension.call(this,t,e),this.domEvents=[],this.name="markup",this.onEditModeEnter=this.onEditModeEnter.bind(this),this.onEditModeLeave=this.onEditModeLeave.bind(this),this.onEditModeChange=this.onEditModeChange.bind(this),this.onMarkupSelected=this.onMarkupSelected.bind(this)}xs.prototype=Object.create(Autodesk.Viewing.Extension.prototype),xs.prototype.constructor=xs;var Ms=xs.prototype,ks=Autodesk.Viewing.Private;Ms.load=function(){var t=this;return this.viewer.loadExtension("Autodesk.Viewing.MarkupsCore").then((function(e){t.core=e,t.core.addEventListener(S,t.onEditModeEnter),t.core.addEventListener(A,t.onEditModeLeave),t.core.addEventListener(T,t.onEditModeChange),t.core.addEventListener(C,t.onMarkupSelected)})),!0},Ms.unload=function(){return this.deactivate(),this.unhookAllEvents(),this.core.removeEventListener(S,this.onEditModeEnter),this.core.removeEventListener(A,this.onEditModeLeave),this.core.removeEventListener(T,this.onEditModeChange),this.core.removeEventListener(C,this.onMarkupSelected),this.destroyToolUi(),this.destroyToolbarUI(),this.core=null,!0},Ms.onToolbarCreated=function(t){var e=this;this.viewer;this.markupToolButton=new Autodesk.Viewing.UI.Button("toolbar-markupTool"),this.markupToolButton.setToolTip("Markup"),this.markupToolButton.setIcon("adsk-icon-markup"),this.markupToolButton.onClick=function(){e.activate()};var i=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);i&&i.addControl(this.markupToolButton,{index:0})},Ms.destroyToolbarUI=function(){this.markupToolButton&&(this.viewer.getToolbar()&&this.markupToolButton.removeFromParent(),this.markupToolButton=null)},Ms.onEditModeEnter=function(){ks.logger.log("ENTER edit mode"),this.showToolsUi()},Ms.onEditModeLeave=function(){ks.logger.log("LEAVE edit mode"),this.hideToolsUi()},Ms.onEditModeChange=function(t){if(this.domToolSelect&&!this.ignoreChangeEvent)for(var e=this.core.editMode,i=this.domToolSelect.options,n=0,o=i.length;n<o;n++){if(i[n].value===e.type){this.domToolSelect.selectedIndex=n;break}}},Ms.onMarkupSelected=function(t){var e=t.markup,i=this.core.editMode;this.setStylesUi(i,e)},Ms.showToolsUi=function(){this.createToolsUi();var t=this.core.isNavigationAllowed();this.setControlVisibility(".lmv-markup-gui-enterNavMode",t,"inline-block"),this.exitNavigationMode(),this.domContent.style.display="block",this.viewer.container.appendChild(this.domRoot)},Ms.hideToolsUi=function(){this.domRoot&&this.domRoot.parentNode&&this.domRoot.parentNode.removeChild(this.domRoot)},Ms.createToolsUi=function(){if(!this.domRoot){var t=['<div class="lmv-markup-gui-toolbar-content">','<button class="lmv-markup-gui-collapse-btn">&lt;-&gt;</button>','<button class="lmv-markup-editmode-done">Exit</button>','<div class="lmv-markup-gui-collapse-content">','<div class="lmv-markup-gui-editMode">','<button class="lmv-markup-gui-enterNavMode">Navigate</button>','<button class="lmv-markup-gui-undo">&#8617;</button>','<button class="lmv-markup-gui-redo">&#8618;</button>',"<br>",'<button class="lmv-markup-gui-delete">Delete</button>','<button class="lmv-markup-gui-duplicate">Duplicate</button>',"<br>",'<button class="lmv-markup-gui-cut">Cut</button>','<button class="lmv-markup-gui-copy">Copy</button>','<button class="lmv-markup-gui-paste">Paste</button>',"<br>","<span>Markup:</span>",'<select class="lmv-markup-tool-select">',i("Arrow",a),i("Rectangle",u),i("Circle",l),i("Text",h),i("Callout",v),i("Cloud",c),i("PolyLine",f),i("Polycloud",y),i("Freehand",d),i("Highlight",p),i("Dimension",g),i("SVG Stamp",m),"</select>","<br>",'<div class="lmv-markup-gui-style-options"></div>',"</div>",'<div class="lmv-markup-gui-navMode" style="display:none;">','<button class="lmv-markup-gui-exitNavMode">Back to Markup</button>',"</div>","</div>","</div>"].join(""),e=this.getDocument();this.domRoot=e.createElement("div"),this.domRoot.className="lmv-markup-gui-toolbar",this.domRoot.innerHTML=t,this.domContent=this.domRoot.querySelector(".lmv-markup-gui-collapse-content"),this.domToolSelect=this.domRoot.querySelector(".lmv-markup-tool-select"),this.domStylesRoot=this.domRoot.querySelector(".lmv-markup-gui-style-options"),this.hookEvent("click",".lmv-markup-gui-collapse-btn",this.onToggleCollapse.bind(this)),this.hookEvent("click",".lmv-markup-editmode-done",this.onEditModeDone.bind(this)),this.hookEvent("click",".lmv-markup-gui-enterNavMode",this.enterNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-exitNavMode",this.exitNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-undo",this.onUndoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-redo",this.onRedoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-delete",this.onDeleteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-cut",this.onCutClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-copy",this.onCopyClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-paste",this.onPasteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-duplicate",this.onDuplicateClick.bind(this)),this.hookEvent("change",".lmv-markup-tool-select",this.onSelectEditMode.bind(this)),this.hookEvent("change",".lmv-markup-gui-style-select",this.onStyleChange.bind(this)),this.hookEvent("input",".lmv-markup-gui-style-textarea",this.onStyleChange.bind(this)),this.hookEvent("propertychange",".lmv-markup-gui-style-textarea",this.onStyleChange.bind(this)),this.setStylesUi(this.core.editMode)}function i(t,e){return['<option value="',e,'">',t,"</option>"].join("")}},Ms.destroyToolUi=function(){this.domRoot&&(this.hideToolsUi(),this.domRoot=null)},Ms.getEditMode=function(t){var e=ds.getClass(t);return e?new e(this.core):null},Ms.onToggleCollapse=function(){var t=this.domContent.style.display;this.domContent.style.display="none"===t?"block":"none"},Ms.onEditModeDone=function(){this.deactivate()},Ms.enterNavigationMode=function(){this.core.allowNavigation(!0),this.setControlVisibility(".lmv-markup-gui-editMode",!1),this.setControlVisibility(".lmv-markup-gui-navMode",!0)},Ms.exitNavigationMode=function(){this.core.allowNavigation(!1),this.setControlVisibility(".lmv-markup-gui-editMode",!0),this.setControlVisibility(".lmv-markup-gui-navMode",!1)},Ms.onUndoClick=function(){this.core.undo()},Ms.onRedoClick=function(){this.core.redo()},Ms.onDeleteClick=function(){var t=this.core.getSelection();t&&this.core.deleteMarkup(t)},Ms.onCutClick=function(){this.core.cut()},Ms.onCopyClick=function(){this.core.copy()},Ms.onPasteClick=function(){this.core.paste()},Ms.onDuplicateClick=function(){this.core.getSelection()&&(this.core.copy(),this.core.paste())},Ms.onSelectEditMode=function(t){var e=t.target.value,i=this.getEditMode(e);i?i.cancelEditModeChange?ks.logger.warn("There was a problem selecting current editMode"):(this.ignoreChangeEvent=!0,this.core.changeEditMode(i),this.ignoreChangeEvent=!1,this.setStylesUi(i),this.domToolSelect.blur()):ks.logger.error("Markup editMode not found for type: "+e)},Ms.onStyleChange=function(t){var e,i,n=t.target,o=n.getAttribute("style-key"),s=n.getAttribute("value-type"),r=this.core.getSelection(),a=r?r.getStyle():this.core.getStyle();if("string"===s)a[o]=n.value;else{var h=n.options[n.selectedIndex];a[o]=(e=h.value,"number"===(i=s)?Number(e):"boolean"===i?"true"===e:e),n.blur()}this.core.setStyle(a)},Ms.setStylesUi=function(t,e){var i=e?e.style:t.style,n=E(i,this.core);for(var o in this.domStylesRoot.innerHTML="",n){var s=this.getUiForStyleKey(o,n[o],i[o]);this.domStylesRoot.appendChild(s)}},Ms.getUiForStyleKey=function(t,e,i){for(var n=e.default,o=[],s=e.values,r=0,a=s.length;r<a;++r){var h=['<option value="',s[r].value,'">',s[r].name,"</option>"].join("");o.push(h),this.valueEquals(s[r].value,i)&&(n=r)}var u=ms(s[0].value),l=this.getDocument().createElement("div"),c=[],d=t.includes("text");(c=d?["<span>",t,"</span>","<br>",'<textarea class="lmv-markup-gui-style-textarea" style-key="',t,'" value-type="',u,'">',i||"","</textarea>"].join(""):["<span>",t,"</span>",'<select class="lmv-markup-gui-style-select" style-key="',t,'" value-type="',u,'">',o.join(""),"</select>"].join(""),l.innerHTML=c,d)||(l.querySelector("select").selectedIndex=n);return l},Ms.valueEquals=function(t,e){return t===e},Ms.setControlVisibility=function(t,e,i){i||(i="block"),this.domRoot.querySelector(t).style.display=e?i:"none"},Ms.hookEvent=function(t,e,i){var n=function(t){this.matchesSelector(t.target,e)&&i(t)}.bind(this);this.domRoot.addEventListener(t,n),this.domEvents.push({str:t,handler:n})},Ms.unhookAllEvents=function(){var t=this.domRoot;this.domEvents.forEach((function(e){t.removeEventListener(e.str,e.handler)})),this.domEvents=[]},Ms.matchesSelector=function(t,e){return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):t.mozMatchesSelector?t.mozMatchesSelector(e):!!t.webkitMatchesSelector&&t.webkitMatchesSelector(e)},Ms.getStyleOptions=function(t){var e=t.getStyle();return E(e,this.core)},Ms.activate=function(){return this.activeStatus||(this.core.enterEditMode(),this.activeStatus=!0),!0},Ms.deactivate=function(){return this.activeStatus&&(this.core.hide(),this.activeStatus=!1),!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsGui",xs);var bs={Clipboard:xo,CloneMarkup:go,CreateArrow:et,CreateCallout:jt,CreateCircle:ue,CreateCloud:xe,CreateDimension:ki,CreateFreehand:De,CreateHighlight:ui,CreatePolycloud:ti,CreatePolyline:Ue,CreateRectangle:dt,CreateText:Qt,DeleteArrow:K,DeleteCallout:Gt,DeleteCircle:ee,DeleteCloud:ce,DeleteDimension:ci,DeleteFreehand:Te,DeleteHighlight:ii,DeletePolycloud:We,DeletePolyline:Le,DeleteRectangle:nt,DeleteText:ft,DeleteStamp:Ii,EditAction:x,EditActionGroup:po,EditActionManager:yo,EditFrame:_o,EditMode:G,EditModeArrow:J,EditModeCallout:Nt,EditModeCircle:se,EditModeCloud:ye,EditModeDimension:gi,EditModeFreehand:Ie,EditModeHighlight:ri,EditModePen:we,EditModePolycloud:qe,EditModePolyline:Oe,EditModeRectangle:ht,EditModeText:Xt,EditModeStamp:Ui,EditorTextInput:Rt,Markup:B,MarkupArrow:Q,MarkupCallout:Bt,MarkupCircle:ae,MarkupCloud:ge,MarkupDimension:xi,MarkupFreehand:Pe,MarkupHighlight:hi,MarkupPen:ke,MarkupPolycloud:$e,MarkupPolyline:Fe,MarkupRectangle:lt,MarkupText:Jt,MarkupStamp:Qi,MarkupTool:us,MarkupsCore:vs,SetArrow:X,SetCallout:vt,SetCircle:ne,SetCloud:pe,SetDimension:pi,SetFreehand:Ae,SetHighlight:oi,SetPolycloud:Ye,SetPolyline:_e,SetPosition:zo,SetRectangle:st,SetRotation:Do,SetSize:mt,SetStyle:j,SetText:Kt,SetStamp:_i,MarkupEvents:s,MarkupTypes:n,theEditModeManager:ds,Utils:r};for(var ws in n)bs[ws]=n[ws];for(var Es in s)bs[Es]=s[Es];for(var Ts in o){if(Ts in bs.Utils)throw new Error("Property ".concat(Ts," from StyleUtils already present in MarkupsCoreUtils."));bs.Utils[Ts]=o[Ts]}var Ss={MarkupsGui:xs};Autodesk.Viewing.Extensions.Markups={Core:bs}}});
//# sourceMappingURL=Markup.min.js.map