/*!
 * LMV v7.51.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.DataVisualization=function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=787)}({0:function(t,e){t.exports=THREE},102:function(t,e,i){(function(e,i){
/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(e){"use strict";"function"==typeof bootstrap?bootstrap("promise",e):t.exports=e()}((function(){"use strict";var t=!1;try{throw new Error}catch(e){t=!!e.stack}var n,r=x(),o=function(){},a=function(){var t={task:void 0,next:null},n=t,r=!1,o=void 0,s=!1,u=[];function h(){for(var e,i;t.next;)e=(t=t.next).task,t.task=void 0,(i=t.domain)&&(t.domain=void 0,i.enter()),c(e,i);for(;u.length;)c(e=u.pop());r=!1}function c(t,e){try{t()}catch(t){if(s)throw e&&e.exit(),setTimeout(h,0),e&&e.enter(),t;setTimeout((function(){throw t}),0)}e&&e.exit()}if(a=function(t){n=n.next={task:t,domain:s&&e.domain,next:null},r||(r=!0,o())},"object"==typeof e&&"[object process]"===e.toString()&&e.nextTick)s=!0,o=function(){e.nextTick(h)};else if("function"==typeof i)o="undefined"!=typeof window?i.bind(window,h):function(){i(h)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=function(){o=f,l.port1.onmessage=h,h()};var f=function(){l.port2.postMessage(0)};o=function(){setTimeout(h,0),f()}}else o=function(){setTimeout(h,0)};return a.runAfter=function(t){u.push(t),r||(r=!0,o())},a}(),s=Function.call;function u(t){return function(){return s.apply(t,arguments)}}var h,c=u(Array.prototype.slice),l=u(Array.prototype.reduce||function(t,e){var i=0,n=this.length;if(1===arguments.length)for(;;){if(i in this){e=this[i++];break}if(++i>=n)throw new TypeError}for(;i<n;i++)i in this&&(e=t(e,this[i],i));return e}),f=u(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),d=u(Array.prototype.map||function(t,e){var i=this,n=[];return l(i,(function(r,o,a){n.push(t.call(e,o,a,i))}),void 0),n}),p=Object.create||function(t){function e(){}return e.prototype=t,new e},v=u(Object.prototype.hasOwnProperty),y=Object.keys||function(t){var e=[];for(var i in t)v(t,i)&&e.push(i);return e},g=u(Object.prototype.toString);function m(t){return"[object StopIteration]"===g(t)||t instanceof h}h="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};function w(e,i){if(t&&i.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf("From previous event:")){for(var n=[],r=i;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var o=n.join("\nFrom previous event:\n");e.stack=function(t){for(var e=t.split("\n"),i=[],n=0;n<e.length;++n){var r=e[n];!_(r)&&(-1===(o=r).indexOf("(module.js:")&&-1===o.indexOf("(node.js:"))&&r&&i.push(r)}var o;return i.join("\n")}(o)}}function b(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var i=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(i)return[i[1],Number(i[2])];var n=/.*@(.+):(\d+)$/.exec(t);return n?[n[1],Number(n[2])]:void 0}function _(t){var e=b(t);if(!e)return!1;var i=e[0],o=e[1];return i===n&&o>=r&&o<=q}function x(){if(t)try{throw new Error}catch(t){var e=t.stack.split("\n"),i=b(e[0].indexOf("@")>0?e[1]:e[2]);if(!i)return;return n=i[0],i[1]}}function E(t){return t instanceof k?t:O(t)?function(t){var e=T();return E.nextTick((function(){try{t.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}})),e.promise}(t):U(t)}function T(){var e,i=[],n=[],r=p(T.prototype),o=p(k.prototype);if(o.promiseDispatch=function(t,r,o){var a=c(arguments);i?(i.push(a),"when"===r&&o[1]&&n.push(o[1])):E.nextTick((function(){e.promiseDispatch.apply(e,a)}))},o.valueOf=function(){if(i)return o;var t=P(e);return C(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},E.longStackSupport&&t)try{throw new Error}catch(t){o.stack=t.stack.substring(t.stack.indexOf("\n")+1)}function a(t){e=t,o.source=t,l(i,(function(e,i){E.nextTick((function(){t.promiseDispatch.apply(t,i)}))}),void 0),i=void 0,n=void 0}return r.promise=o,r.resolve=function(t){e||a(E(t))},r.fulfill=function(t){e||a(U(t))},r.reject=function(t){e||a(L(t))},r.notify=function(t){e||l(n,(function(e,i){E.nextTick((function(){i(t)}))}),void 0)},r}function R(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=T();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function S(t){return R((function(e,i){for(var n=0,r=t.length;n<r;n++)E(t[n]).then(e,i)}))}function k(t,e,i){void 0===e&&(e=function(t){return L(new Error("Promise does not support operation: "+t))}),void 0===i&&(i=function(){return{state:"unknown"}});var n=p(k.prototype);if(n.promiseDispatch=function(i,r,o){var a;try{a=t[r]?t[r].apply(n,o):e.call(n,r,o)}catch(t){a=L(t)}i&&i(a)},n.inspect=i,i){var r=i();"rejected"===r.state&&(n.exception=r.reason),n.valueOf=function(){var t=i();return"pending"===t.state||"rejected"===t.state?n:t.value}}return n}function M(t,e,i,n){return E(t).then(e,i,n)}function P(t){if(C(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function C(t){return t instanceof k}function O(t){return(e=t)===Object(e)&&"function"==typeof t.then;var e}E.resolve=E,E.nextTick=a,E.longStackSupport=!1,"object"==typeof e&&e&&e.env&&e.env.Q_DEBUG&&(E.longStackSupport=!0),E.defer=T,T.prototype.makeNodeResolver=function(){var t=this;return function(e,i){e?t.reject(e):arguments.length>2?t.resolve(c(arguments,1)):t.resolve(i)}},E.Promise=R,E.promise=R,R.race=S,R.all=G,R.reject=L,R.resolve=E,E.passByCopy=function(t){return t},k.prototype.passByCopy=function(){return this},E.join=function(t,e){return E(t).join(e)},k.prototype.join=function(t){return E([this,t]).spread((function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)}))},E.race=S,k.prototype.race=function(){return this.then(E.race)},E.makePromise=k,k.prototype.toString=function(){return"[object Promise]"},k.prototype.then=function(t,e,i){var n=this,r=T(),o=!1;return E.nextTick((function(){n.promiseDispatch((function(e){o||(o=!0,r.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(t){return L(t)}}(e)))}),"when",[function(t){o||(o=!0,r.resolve(function(t){if("function"==typeof e){w(t,n);try{return e(t)}catch(t){return L(t)}}return L(t)}(t)))}])})),n.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=function(t){return"function"==typeof i?i(t):t}(t)}catch(t){if(n=!0,!E.onerror)throw t;E.onerror(t)}n||r.notify(e)}]),r.promise},E.tap=function(t,e){return E(t).tap(e)},k.prototype.tap=function(t){return t=E(t),this.then((function(e){return t.fcall(e).thenResolve(e)}))},E.when=M,k.prototype.thenResolve=function(t){return this.then((function(){return t}))},E.thenResolve=function(t,e){return E(t).thenResolve(e)},k.prototype.thenReject=function(t){return this.then((function(){throw t}))},E.thenReject=function(t,e){return E(t).thenReject(e)},E.nearer=P,E.isPromise=C,E.isPromiseAlike=O,E.isPending=function(t){return C(t)&&"pending"===t.inspect().state},k.prototype.isPending=function(){return"pending"===this.inspect().state},E.isFulfilled=function(t){return!C(t)||"fulfilled"===t.inspect().state},k.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},E.isRejected=function(t){return C(t)&&"rejected"===t.inspect().state},k.prototype.isRejected=function(){return"rejected"===this.inspect().state};var A,D,I,j=[],V=[],H=[],B=!0;function F(){j.length=0,V.length=0,B||(B=!0)}function L(t){var i=k({when:function(i){return i&&function(t){if(B){var i=f(V,t);-1!==i&&("object"==typeof e&&"function"==typeof e.emit&&E.nextTick.runAfter((function(){var n=f(H,t);-1!==n&&(e.emit("rejectionHandled",j[i],t),H.splice(n,1))})),V.splice(i,1),j.splice(i,1))}}(this),i?i(t):this}},(function(){return this}),(function(){return{state:"rejected",reason:t}}));return function(t,i){B&&("object"==typeof e&&"function"==typeof e.emit&&E.nextTick.runAfter((function(){-1!==f(V,t)&&(e.emit("unhandledRejection",i,t),H.push(t))})),V.push(t),i&&void 0!==i.stack?j.push(i.stack):j.push("(no stack) "+i))}(i,t),i}function U(t){return k({when:function(){return t},get:function(e){return t[e]},set:function(e,i){t[e]=i},delete:function(e){delete t[e]},post:function(e,i){return null==e?t.apply(void 0,i):t[e].apply(t,i)},apply:function(e,i){return t.apply(e,i)},keys:function(){return y(t)}},void 0,(function(){return{state:"fulfilled",value:t}}))}function z(t,e,i){return E(t).spread(e,i)}function N(t,e,i){return E(t).dispatch(e,i)}function G(t){return M(t,(function(t){var e=0,i=T();return l(t,(function(n,r,o){var a;C(r)&&"fulfilled"===(a=r.inspect()).state?t[o]=a.value:(++e,M(r,(function(n){t[o]=n,0==--e&&i.resolve(t)}),i.reject,(function(t){i.notify({index:o,value:t})})))}),void 0),0===e&&i.resolve(t),i.promise}))}function W(t){if(0===t.length)return E.resolve();var e=E.defer(),i=0;return l(t,(function(n,r,o){var a=t[o];i++,M(a,(function(t){e.resolve(t)}),(function(){0===--i&&e.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}),(function(t){e.notify({index:o,value:t})}))}),void 0),e.promise}function X(t){return M(t,(function(t){return t=d(t,E),M(G(d(t,(function(t){return M(t,o,o)}))),(function(){return t}))}))}E.resetUnhandledRejections=F,E.getUnhandledReasons=function(){return j.slice()},E.stopUnhandledRejectionTracking=function(){F(),B=!1},F(),E.reject=L,E.fulfill=U,E.master=function(t){return k({isDef:function(){}},(function(e,i){return N(t,e,i)}),(function(){return E(t).inspect()}))},E.spread=z,k.prototype.spread=function(t,e){return this.all().then((function(e){return t.apply(void 0,e)}),e)},E.async=function(t){return function(){function e(t,e){var o;if("undefined"==typeof StopIteration){try{o=i[t](e)}catch(t){return L(t)}return o.done?E(o.value):M(o.value,n,r)}try{o=i[t](e)}catch(t){return m(t)?E(t.value):L(t)}return M(o,n,r)}var i=t.apply(this,arguments),n=e.bind(e,"next"),r=e.bind(e,"throw");return n()}},E.spawn=function(t){E.done(E.async(t)())},E.return=function(t){throw new h(t)},E.promised=function(t){return function(){return z([this,G(arguments)],(function(e,i){return t.apply(e,i)}))}},E.dispatch=N,k.prototype.dispatch=function(t,e){var i=this,n=T();return E.nextTick((function(){i.promiseDispatch(n.resolve,t,e)})),n.promise},E.get=function(t,e){return E(t).dispatch("get",[e])},k.prototype.get=function(t){return this.dispatch("get",[t])},E.set=function(t,e,i){return E(t).dispatch("set",[e,i])},k.prototype.set=function(t,e){return this.dispatch("set",[t,e])},E.del=E.delete=function(t,e){return E(t).dispatch("delete",[e])},k.prototype.del=k.prototype.delete=function(t){return this.dispatch("delete",[t])},E.mapply=E.post=function(t,e,i){return E(t).dispatch("post",[e,i])},k.prototype.mapply=k.prototype.post=function(t,e){return this.dispatch("post",[t,e])},E.send=E.mcall=E.invoke=function(t,e){return E(t).dispatch("post",[e,c(arguments,2)])},k.prototype.send=k.prototype.mcall=k.prototype.invoke=function(t){return this.dispatch("post",[t,c(arguments,1)])},E.fapply=function(t,e){return E(t).dispatch("apply",[void 0,e])},k.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},E.try=E.fcall=function(t){return E(t).dispatch("apply",[void 0,c(arguments,1)])},k.prototype.fcall=function(){return this.dispatch("apply",[void 0,c(arguments)])},E.fbind=function(t){var e=E(t),i=c(arguments,1);return function(){return e.dispatch("apply",[this,i.concat(c(arguments))])}},k.prototype.fbind=function(){var t=this,e=c(arguments);return function(){return t.dispatch("apply",[this,e.concat(c(arguments))])}},E.keys=function(t){return E(t).dispatch("keys",[])},k.prototype.keys=function(){return this.dispatch("keys",[])},E.all=G,k.prototype.all=function(){return G(this)},E.any=W,k.prototype.any=function(){return W(this)},E.allResolved=(A=X,D="allResolved",I="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(D+" is deprecated, use "+I+" instead.",new Error("").stack),A.apply(A,arguments)}),k.prototype.allResolved=function(){return X(this)},E.allSettled=function(t){return E(t).allSettled()},k.prototype.allSettled=function(){return this.then((function(t){return G(d(t,(function(t){function e(){return t.inspect()}return(t=E(t)).then(e,e)})))}))},E.fail=E.catch=function(t,e){return E(t).then(void 0,e)},k.prototype.fail=k.prototype.catch=function(t){return this.then(void 0,t)},E.progress=function(t,e){return E(t).then(void 0,void 0,e)},k.prototype.progress=function(t){return this.then(void 0,void 0,t)},E.fin=E.finally=function(t,e){return E(t).finally(e)},k.prototype.fin=k.prototype.finally=function(t){return t=E(t),this.then((function(e){return t.fcall().then((function(){return e}))}),(function(e){return t.fcall().then((function(){throw e}))}))},E.done=function(t,e,i,n){return E(t).done(e,i,n)},k.prototype.done=function(t,i,n){var r=function(t){E.nextTick((function(){if(w(t,o),!E.onerror)throw t;E.onerror(t)}))},o=t||i||n?this.then(t,i,n):this;"object"==typeof e&&e&&e.domain&&(r=e.domain.bind(r)),o.then(void 0,r)},E.timeout=function(t,e,i){return E(t).timeout(e,i)},k.prototype.timeout=function(t,e){var i=T(),n=setTimeout((function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),i.reject(e)}),t);return this.then((function(t){clearTimeout(n),i.resolve(t)}),(function(t){clearTimeout(n),i.reject(t)}),i.notify),i.promise},E.delay=function(t,e){return void 0===e&&(e=t,t=void 0),E(t).delay(e)},k.prototype.delay=function(t){return this.then((function(e){var i=T();return setTimeout((function(){i.resolve(e)}),t),i.promise}))},E.nfapply=function(t,e){return E(t).nfapply(e)},k.prototype.nfapply=function(t){var e=T(),i=c(t);return i.push(e.makeNodeResolver()),this.fapply(i).fail(e.reject),e.promise},E.nfcall=function(t){var e=c(arguments,1);return E(t).nfapply(e)},k.prototype.nfcall=function(){var t=c(arguments),e=T();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},E.nfbind=E.denodeify=function(t){var e=c(arguments,1);return function(){var i=e.concat(c(arguments)),n=T();return i.push(n.makeNodeResolver()),E(t).fapply(i).fail(n.reject),n.promise}},k.prototype.nfbind=k.prototype.denodeify=function(){var t=c(arguments);return t.unshift(this),E.denodeify.apply(void 0,t)},E.nbind=function(t,e){var i=c(arguments,2);return function(){var n=i.concat(c(arguments)),r=T();function o(){return t.apply(e,arguments)}return n.push(r.makeNodeResolver()),E(o).fapply(n).fail(r.reject),r.promise}},k.prototype.nbind=function(){var t=c(arguments,0);return t.unshift(this),E.nbind.apply(void 0,t)},E.nmapply=E.npost=function(t,e,i){return E(t).npost(e,i)},k.prototype.nmapply=k.prototype.npost=function(t,e){var i=c(e||[]),n=T();return i.push(n.makeNodeResolver()),this.dispatch("post",[t,i]).fail(n.reject),n.promise},E.nsend=E.nmcall=E.ninvoke=function(t,e){var i=c(arguments,2),n=T();return i.push(n.makeNodeResolver()),E(t).dispatch("post",[e,i]).fail(n.reject),n.promise},k.prototype.nsend=k.prototype.nmcall=k.prototype.ninvoke=function(t){var e=c(arguments,1),i=T();return e.push(i.makeNodeResolver()),this.dispatch("post",[t,e]).fail(i.reject),i.promise},E.nodeify=function(t,e){return E(t).nodeify(e)},k.prototype.nodeify=function(t){if(!t)return this;this.then((function(e){E.nextTick((function(){t(null,e)}))}),(function(e){E.nextTick((function(){t(e)}))}))},E.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var q=x();return E}))}).call(this,i(62),i(768).setImmediate)},12:function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},30:function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=a(t);if(e){var r=a(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return o(this,i)}}function o(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return e&&u(t.prototype,e),i&&u(t,i),t}var c=function(){"use strict";function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};s(this,t),this.id=e,this.position=i,this.types=n,this.name=r,this.contextData=o,this.dbId=null}return h(t,[{key:"positionFromDBId",value:function(t,e){var i=t.getData().instanceTree,n=new THREE.Box3,r=new THREE.Box3,o=t.getFragmentList();this.dbId=e,i.enumNodeFragments(e,(function(t){o.getWorldBounds(t,r),n.union(r)}),!0),this.position=n.center()||this.position}}]),t}(),l=function(){"use strict";function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;s(this,t),"number"==typeof i&&(i=[i]),this.dbIds=i,this.shadingPoints=n||[],this.isLeaf=!0,this.fragIds=[],this.id=e,this.name=r,this.bounds=new THREE.Box3}return h(t,[{key:"addPoint",value:function(t){this.shadingPoints.push(t)}},{key:"update",value:function(t){var e=this,i=t.getData().instanceTree,n=new Set(this.fragIds),r=new THREE.Box3,o=t.getFragmentList();this.dbIds.forEach((function(t){i.enumNodeFragments(t,(function(t){n.has(t)||(e.fragIds.push(t),o.getWorldBounds(t,r),e.bounds.union(r))}),!0)}))}}]),t}(),f=function(){"use strict";function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;s(this,t),this.id=e,this._children=[],this.isGroup=!0,this.name=i}return h(t,[{key:"addChild",value:function(t){this.children.push(t)}},{key:"update",value:function(t){this.children.forEach((function(e){return e.update(t)}))}},{key:"getLeafsById",value:function(t,e){e=e||[];for(var i=0;i<this.children.length;i++){var n=this.children[i];n.id===t?n.isLeaf?e.push(n):n.isGroup&&n.getChildLeafs(e):n.isGroup&&n.getLeafsById(t,e)}return e}},{key:"getNodeById",value:function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.id===t)return i;if(i.isGroup){var n=i.getNodeById(t);if(n)return n}}}},{key:"getChildLeafs",value:function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.isLeaf?t.push(i):i.isGroup&&i.getChildLeafs(t)}}},{key:"children",get:function(){return this._children}}]),t}(),d=function(t){"use strict";!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(i,t);var e=r(i);function i(){return s(this,i),e.apply(this,arguments)}return h(i,[{key:"initialize",value:function(t){this.update(t)}}]),i}(f);t.exports={SurfaceShadingData:d,SurfaceShadingGroup:f,SurfaceShadingNode:l,SurfaceShadingPoint:c,filterShadingPointsByType:function(t,e){return(t=t||[]).filter((function(t){return t.types&&t.types.includes(e)}))}}},410:function(t,e,i){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=i(0),o=function(){"use strict";function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.meshCallback=e,this.dbIds=[],this.reset()}var e,i,o;return e=t,(i=[{key:"addPoint",value:function(t,e){this.vcount+1>65535&&(this.flushBuffer(),this.reset());var i=this.vcount;if(this.ib[i]=i,this.vb[3*i]=t.position.x,this.vb[3*i+1]=t.position.y,this.vb[3*i+2]=t.position.z,this.idb[3*i]=255&t.dbId,this.idb[3*i+1]=t.dbId>>8&255,this.idb[3*i+2]=t.dbId>>16&255,this.colorb[3*i]=255*t.color.r,this.colorb[3*i+1]=255*t.color.g,this.colorb[3*i+2]=255*t.color.b,e){var n=e.spriteUV(t.style.url);n&&(this.uv[4*i]=n.x,this.uv[4*i+1]=n.y,this.uv[4*i+2]=n.w,this.uv[4*i+3]=n.h)}this.scale[i]=1,this.dbIds.push(t.dbId),this.vcount++}},{key:"reset",value:function(){this.vcount=0,this.ib=new Uint16Array(65535),this.idb=new Uint8Array(196605),this.vb=new Float32Array(196605),this.colorb=new Uint8Array(196605),this.scale=new Float32Array(65535),this.uv=new Float32Array(262140)}},{key:"flushBuffer",value:function(){var t=new r.BufferGeometry,e=new r.BufferAttribute(new Uint8Array(this.idb.slice(0,3*this.vcount)),3);e.bytesPerItem=1,e.normalize=!0;var i=new r.BufferAttribute(new Float32Array(this.vb.slice(0,3*this.vcount)),3);i.bytesPerItem=4;var n=new r.BufferAttribute(new Uint8Array(this.colorb.slice(0,3*this.vcount)),3);n.bytesPerItem=1,n.normalize=!0;var o=new r.BufferAttribute(new Uint16Array(this.ib.slice(0,this.vcount)),1),a=new r.BufferAttribute(new Float32Array(this.uv.slice(0,4*this.vcount)),4),s=new r.BufferAttribute(new Float32Array(this.scale.slice(0,this.vcount)),1);t.addAttribute("id",e),t.addAttribute("index",o),t.addAttribute("position",i),t.addAttribute("color",n),t.addAttribute("uvp",a),t.addAttribute("pointScale",s),t.isPoints=!0,t.dbIds=this.dbIds.slice(0),this.dbIds.length=0,this.meshCallback&&this.meshCallback(t),this.vcount=0}}])&&n(e.prototype,i),o&&n(e,o),t}();t.exports={SpriteMeshBuilder:o}},411:function(t,e,i){var n,r,o;o=function(){var t,e={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},i=function(){var t=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},i=e.defaultRadius;return t.prototype={_organiseData:function(t,e){var n=t[this._xField],r=t[this._yField],o=this._radi,a=this._data,s=this._max,u=this._min,h=t[this._valueField]||1,c=t.radius||this._cfgRadius||i;a[n]||(a[n]=[],o[n]=[]),a[n][r]?a[n][r]+=h:(a[n][r]=h,o[n][r]=c);var l=a[n][r];return l>s?(e?this.setDataMax(l):this._max=l,!1):l<u?(e?this.setDataMin(l):this._min=l,!1):{x:n,y:r,value:h,radius:c,min:u,max:s}},_unOrganizeData:function(){var t=[],e=this._data,i=this._radi;for(var n in e)for(var r in e[n])t.push({x:n,y:r,radius:i[n][r],value:e[n][r]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var i=this._organiseData(arguments[0],!0);i&&(0===this._data.length&&(this._min=this._max=i.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[i]}))}return this},setData:function(t){var e=t.data,i=e.length;this._data=[],this._radi=[];for(var n=0;n<i;n++)this._organiseData(e[n],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},t}(),n=function(){var t=function(t){var e=t.gradient||t.defaultGradient,i=document.createElement("canvas"),n=i.getContext("2d");i.width=256,i.height=1;var r=n.createLinearGradient(0,0,256,1);for(var o in e)r.addColorStop(o,e[o]);return n.fillStyle=r,n.fillRect(0,0,256,1),n.getImageData(0,0,256,1).data},e=function(t,e){var i=document.createElement("canvas"),n=i.getContext("2d"),r=t,o=t;if(i.width=i.height=2*t,1==e)n.beginPath(),n.arc(r,o,t,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill();else{var a=n.createRadialGradient(r,o,t*e,r,o,t);a.addColorStop(0,"rgba(0,0,0,1)"),a.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=a,n.fillRect(0,0,2*t,2*t)}return i};function i(e){var i=e.container,n=this.shadowCanvas=document.createElement("canvas"),r=this.canvas=e.canvas||document.createElement("canvas"),o=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(e.container)||{});r.className="heatmap-canvas",this._width=r.width=n.width=e.width||+o.width.replace(/px/,""),this._height=r.height=n.height=e.height||+o.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=r.getContext("2d"),r.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",i.style.position="relative",i.appendChild(r),this._palette=t(e),this._templates={},this._setStyles(e)}return i.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(function(t){for(var e=[],i=t.min,n=t.max,r=t.radi,o=(t=t.data,Object.keys(t)),a=o.length;a--;)for(var s=o[a],u=Object.keys(t[s]),h=u.length;h--;){var c=u[h],l=t[s][c],f=r[s][c];e.push({x:s,y:c,value:l,radius:f})}return{min:i,max:n,data:e}}(t)),this._colorize())},_updateGradient:function(e){this._palette=t(e)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){for(var i=this._min=t.min,n=this._max=t.max,r=(t=t.data||[]).length,o=1-this._blur;r--;){var a,s=t[r],u=s.x,h=s.y,c=s.radius,l=Math.min(s.value,n),f=u-c,d=h-c,p=this.shadowCtx;this._templates[c]?a=this._templates[c]:this._templates[c]=a=e(c,o);var v=(l-i)/(n-i);p.globalAlpha=v<.01?.01:v,p.drawImage(a,f,d),f<this._renderBoundaries[0]&&(this._renderBoundaries[0]=f),d<this._renderBoundaries[1]&&(this._renderBoundaries[1]=d),f+2*c>this._renderBoundaries[2]&&(this._renderBoundaries[2]=f+2*c),d+2*c>this._renderBoundaries[3]&&(this._renderBoundaries[3]=d+2*c)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],i=this._renderBoundaries[2]-t,n=this._renderBoundaries[3]-e,r=this._width,o=this._height,a=this._opacity,s=this._maxOpacity,u=this._minOpacity,h=this._useGradientOpacity;t<0&&(t=0),e<0&&(e=0),t+i>r&&(i=r-t),e+n>o&&(n=o-e);for(var c=this.shadowCtx.getImageData(t,e,i,n),l=c.data,f=l.length,d=this._palette,p=3;p<f;p+=4){var v,y=l[p],g=4*y;g&&(v=a>0?a:y<s?y<u?u:y:s,l[p-3]=d[g],l[p-2]=d[g+1],l[p-1]=d[g+2],l[p]=h?d[g+3]:v)}c.data=l,this.ctx.putImageData(c,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],i=this._max,n=this._min;return Math.abs(i-n)*(e/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},i}(),r=(t=!1,"canvas2d"===e.defaultRenderer&&(t=n),t),o=function(){for(var t={},e=arguments.length,i=0;i<e;i++){var n=arguments[i];for(var r in n)t[r]=n[r]}return t},a=function(){var t=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,i){var n=this.cStore;n[t]||(n[t]=[]),n[t].push((function(t){return e.call(i,t)}))},emit:function(t,e){var i=this.cStore;if(i[t])for(var n=i[t].length,r=0;r<n;r++)(0,i[t][r])(e)}},t}(),n=function(t){var e=t._renderer,i=t._coordinator,n=t._store;i.on("renderpartial",e.renderPartial,e),i.on("renderall",e.renderAll,e),i.on("extremachange",(function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config.gradient||t._config.defaultGradient})})),n.setCoordinator(i)};function a(){var a=this._config=o(e,arguments[0]||{});if(this._coordinator=new t,a.plugin){var s=a.plugin;if(!e.plugins[s])throw new Error("Plugin '"+s+"' not found. Maybe it was not registered.");var u=e.plugins[s];this._renderer=new u.renderer(a),this._store=new u.store(a)}else this._renderer=new r(a),this._store=new i(a);n(this)}return a.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=o(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},a}();return{create:function(t){return new a(t)},register:function(t,i){e.plugins[t]=i}}},t.exports?t.exports=o():void 0===(r="function"==typeof(n=o)?n.call(e,i,e,t):n)||(t.exports=r)},44:function(t,e){t.exports={MOUSE_HOVERING:"DATAVIZ_OBJECT_HOVERING",MOUSE_CLICK:"DATAVIZ_OBJECT_CLICK",MOUSE_CLICK_OUT:"DATAVIZ_CLICK_OUT"}},57:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));class n{constructor(t=0,e=0,i=0,n=0,r=!1,o){this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=t,this._height=e,this._x=i,this._y=n,this._data={},this._rot=r,this._allowRotation=o}static Collide(t,e){return t.collide(e)}static Contain(t,e){return t.contain(e)}area(){return this.width*this.height}collide(t){return t.x<this.x+this.width&&t.x+t.width>this.x&&t.y<this.y+this.height&&t.y+t.height>this.y}contain(t){return t.x>=this.x&&t.y>=this.y&&t.x+t.width<=this.x+this.width&&t.y+t.height<=this.y+this.height}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._dirty++)}get height(){return this._height}set height(t){t!==this._height&&(this._height=t,this._dirty++)}get x(){return this._x}set x(t){t!==this._x&&(this._x=t,this._dirty++)}get y(){return this._y}set y(t){t!==this._y&&(this._y=t,this._dirty++)}get rot(){return this._rot}set rot(t){if(!1!==this._allowRotation&&this._rot!==t){const e=this.width;this.width=this.height,this.height=e,this._rot=t,this._dirty++}}get allowRotation(){return this._allowRotation}set allowRotation(t){this._allowRotation!==t&&(this._allowRotation=t,this._dirty++)}get data(){return this._data}set data(t){null!==t&&t!==this._data&&(this._data=t,"object"==typeof t&&t.hasOwnProperty("allowRotation")&&(this._allowRotation=t.allowRotation),this._dirty++)}get dirty(){return this._dirty>0}setDirty(t=!0){this._dirty=t?this._dirty+1:0}}class r{constructor(){this._dirty=0}get dirty(){return this._dirty>0||this.rects.some(t=>t.dirty)}setDirty(t=!0){if(this._dirty=t?this._dirty+1:0,!t)for(let t of this.rects)t.setDirty&&t.setDirty(!1)}}class o extends r{constructor(t=s,e=s,i=0,r={}){super(),this.maxWidth=t,this.maxHeight=e,this.padding=i,this.freeRects=[],this.rects=[],this.verticalExpand=!1,this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:u.MAX_EDGE},this.options=Object.assign(Object.assign({},this.options),r),this.width=this.options.smart?0:t,this.height=this.options.smart?0:e,this.border=this.options.border?this.options.border:0,this.freeRects.push(new n(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new n(this.width,this.height)}add(...t){let e,i;if(1===t.length){if("object"!=typeof t[0])throw new Error("MacrectsBin.add(): Wrong parameters");i=t[0];let e=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(this.options.tag&&this.options.exclusiveTag&&this.tag!==e)return}else{if(e=t.length>2?t[2]:null,this.options.tag&&this.options.exclusiveTag){if(e&&this.tag!==e.tag)return;if(!e&&this.tag)return}i=new n(t[0],t[1]),i.data=e,i.setDirty(!1)}const r=this.place(i);return r&&this.rects.push(r),r}repack(){let t=[];this.reset(),this.rects.sort((t,e)=>{const i=Math.max(e.width,e.height)-Math.max(t.width,t.height);return 0===i&&t.hash&&e.hash?t.hash>e.hash?-1:1:i});for(let e of this.rects)this.place(e)||t.push(e);for(let e of t)this.rects.splice(this.rects.indexOf(e),1);return t.length>0?t:void 0}reset(t=!1,e=!1){t&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],e&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new n(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new n(this.width,this.height),this._dirty=0}clone(){let t=new o(this.maxWidth,this.maxHeight,this.padding,this.options);for(let e of this.rects)t.add(e);return t}place(t){let e,i,r=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;if(!this.options.tag||!this.options.exclusiveTag||this.tag===r){if(i=t.hasOwnProperty("_allowRotation")&&void 0!==t.allowRotation?t.allowRotation:this.options.allowRotation,e=this.findNode(t.width+this.padding,t.height+this.padding,i),e){this.updateBinSize(e);let i=this.freeRects.length,n=0;for(;n<i;)this.splitNode(this.freeRects[n],e)&&(this.freeRects.splice(n,1),i--,n--),n++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,t.x=e.x,t.y=e.y,void 0===t.rot&&(t.rot=!1),t.rot=e.rot?!t.rot:t.rot,this._dirty++,t}if(this.verticalExpand){if(this.updateBinSize(new n(t.width+this.padding,t.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new n(t.width+this.padding,t.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(t)}else if(this.updateBinSize(new n(t.width+this.padding,t.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new n(t.width+this.padding,t.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(t)}}findNode(t,e,i){let r,o,a,s=Number.MAX_VALUE;for(let h in this.freeRects)o=this.freeRects[h],o.width>=t&&o.height>=e&&(r=this.options.logic===u.MAX_AREA?o.width*o.height-t*e:Math.min(o.width-t,o.height-e),r<s&&(a=new n(t,e,o.x,o.y),s=r)),i&&o.width>=e&&o.height>=t&&(r=this.options.logic===u.MAX_AREA?o.width*o.height-e*t:Math.min(o.height-t,o.width-e),r<s&&(a=new n(e,t,o.x,o.y,!0),s=r));return a}splitNode(t,e){if(!t.collide(e))return!1;if(e.x<t.x+t.width&&e.x+e.width>t.x){if(e.y>t.y&&e.y<t.y+t.height){let i=new n(t.width,e.y-t.y,t.x,t.y);this.freeRects.push(i)}if(e.y+e.height<t.y+t.height){let i=new n(t.width,t.y+t.height-(e.y+e.height),t.x,e.y+e.height);this.freeRects.push(i)}}if(e.y<t.y+t.height&&e.y+e.height>t.y){if(e.x>t.x&&e.x<t.x+t.width){let i=new n(e.x-t.x,t.height,t.x,t.y);this.freeRects.push(i)}if(e.x+e.width<t.x+t.width){let i=new n(t.x+t.width-(e.x+e.width),t.height,e.x+e.width,t.y);this.freeRects.push(i)}}return!0}pruneFreeList(){let t=0,e=0,i=this.freeRects.length;for(;t<i;){e=t+1;let n=this.freeRects[t];for(;e<i;){let r=this.freeRects[e];if(r.contain(n)){this.freeRects.splice(t,1),t--,i--;break}n.contain(r)&&(this.freeRects.splice(e,1),e--,i--),e++}t++}}updateBinSize(t){if(!this.options.smart)return!1;if(this.stage.contain(t))return!1;let e=Math.max(this.width,t.x+t.width-this.padding+this.border),i=Math.max(this.height,t.y+t.height-this.padding+this.border);if(this.options.allowRotation){const n=Math.max(this.width,t.x+t.height-this.padding+this.border),r=Math.max(this.height,t.y+t.width-this.padding+this.border);n*r<e*i&&(e=n,i=r)}return this.options.pot&&(e=Math.pow(2,Math.ceil(Math.log(e)*Math.LOG2E)),i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E))),this.options.square&&(e=i=Math.max(e,i)),!(e>this.maxWidth+this.padding||i>this.maxHeight+this.padding)&&(this.expandFreeRects(e+this.padding,i+this.padding),this.width=this.stage.width=e,this.height=this.stage.height=i,!0)}expandFreeRects(t,e){this.freeRects.forEach((i,n)=>{i.x+i.width>=Math.min(this.width+this.padding-this.border,t)&&(i.width=t-i.x-this.border),i.y+i.height>=Math.min(this.height+this.padding-this.border,e)&&(i.height=e-i.y-this.border)},this),this.freeRects.push(new n(t-this.width-this.padding,e-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new n(t-2*this.border,e-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter(t=>!(t.width<=0||t.height<=0||t.x<this.border||t.y<this.border)),this.pruneFreeList()}}class a extends r{constructor(...t){if(super(),this.rects=[],1===t.length){if("object"!=typeof t[0])throw new Error("OversizedElementBin: Wrong parameters");const e=t[0];this.rects=[e],this.width=e.width,this.height=e.height,this.data=e.data,e.oversized=!0}else{this.width=t[0],this.height=t[1],this.data=t.length>2?t[2]:null;const e=new n(this.width,this.height);e.oversized=!0,e.data=this.data,this.rects.push(e)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(t=!1){}repack(){}clone(){return new a(this.rects[0])}}const s=4096;var u;!function(t){t[t.MAX_AREA=0]="MAX_AREA",t[t.MAX_EDGE=1]="MAX_EDGE"}(u||(u={}));class h{constructor(t=s,e=s,i=0,n={}){this.width=t,this.height=e,this.padding=i,this.options={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:u.MAX_EDGE},this._currentBinIndex=0,this.bins=[],this.options=Object.assign(Object.assign({},this.options),n)}add(...t){if(1===t.length){if("object"!=typeof t[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const e=t[0];if(e.width>this.width||e.height>this.height)this.bins.push(new a(e));else{if(!this.bins.slice(this._currentBinIndex).find(t=>void 0!==t.add(e))){let t=new o(this.width,this.height,this.padding,this.options),i=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;this.options.tag&&i&&(t.tag=i),t.add(e),this.bins.push(t)}}return e}{const e=new n(t[0],t[1]);if(t.length>2&&(e.data=t[2]),e.width>this.width||e.height>this.height)this.bins.push(new a(e));else{if(!this.bins.slice(this._currentBinIndex).find(t=>void 0!==t.add(e))){let t=new o(this.width,this.height,this.padding,this.options);this.options.tag&&e.data.tag&&(t.tag=e.data.tag),t.add(e),this.bins.push(t)}}return e}}addArray(t){if(!this.options.tag||this.options.exclusiveTag)this.sort(t,this.options.logic).forEach(t=>this.add(t));else{if(0===t.length)return;let e;t.sort((t,e)=>{const i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0,n=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;return void 0===n?-1:void 0===i?1:n>i?-1:1});let i=0;if(!this.bins.slice(this._currentBinIndex).find(n=>{let r=n.clone();for(let o=i;o<t.length;o++){const a=t[o],s=a.data&&a.data.tag?a.data.tag:a.tag?a.tag:void 0;if(0===o&&(e=s),s!==e)return e=s,this.sort(t.slice(i,o),this.options.logic).forEach(t=>n.add(t)),i=o,this.addArray(t.slice(o)),!0;if(void 0===s)return this.sort(t.slice(o),this.options.logic).forEach(t=>this.add(t)),i=t.length,!0;if(void 0===r.add(a))return!1}return this.sort(t.slice(i),this.options.logic).forEach(t=>n.add(t)),!0})){const e=t[i],n=new o(this.width,this.height,this.padding,this.options),r=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;this.options.tag&&this.options.exclusiveTag&&r&&(n.tag=r),this.bins.push(n),this.addArray(t.slice(i))}}}reset(){this.bins=[],this._currentBinIndex=0}repack(t=!0){if(t){let t=[];for(let e of this.bins)if(e.dirty){let i=e.repack();i&&t.push(...i)}return void this.addArray(t)}if(!this.dirty)return;const e=this.rects;this.reset(),this.addArray(e)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(t){t.forEach((t,e)=>{if(t.maxWidth>this.width||t.maxHeight>this.height)this.bins.push(new a(t.width,t.height,{}));else{let i=new o(this.width,this.height,this.padding,t.options);i.freeRects.splice(0),t.freeRects.forEach((t,e)=>{i.freeRects.push(new n(t.width,t.height,t.x,t.y))}),i.width=t.width,i.height=t.height,t.tag&&(i.tag=t.tag),this.bins[e]=i}},this)}save(){let t=[];return this.bins.forEach(e=>{let i={width:e.width,height:e.height,maxWidth:e.maxWidth,maxHeight:e.maxHeight,freeRects:[],rects:[],options:e.options};e.tag&&(i=Object.assign(Object.assign({},i),{tag:e.tag})),e.freeRects.forEach(t=>{i.freeRects.push({x:t.x,y:t.y,width:t.width,height:t.height})}),t.push(i)}),t}sort(t,e=u.MAX_EDGE){return t.slice().sort((t,i)=>{const n=e===u.MAX_EDGE?Math.max(i.width,i.height)-Math.max(t.width,t.height):i.width*i.height-t.width*t.height;return 0===n&&t.hash&&i.hash?t.hash>i.hash?-1:1:n})}get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some(t=>t.dirty)}get rects(){let t=[];for(let e of this.bins)t.push(...e.rects);return t}}},62:function(t,e){var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u,h=[],c=!1,l=-1;function f(){c&&u&&(c=!1,u.length?h=u.concat(h):l=-1,h.length&&d())}function d(){if(!c){var t=s(f);c=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u&&u[l].run();l=-1,e=h.length}u=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new p(t,e)),1!==h.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=v,r.addListener=v,r.once=v,r.off=v,r.removeListener=v,r.removeAllListeners=v,r.emit=v,r.prependListener=v,r.prependOnceListener=v,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},768:function(t,e,i){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},i(769),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(12))},769:function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,r,o,a,s,u=1,h={},c=!1,l=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick((function(){p(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},n=function(t){o.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(r=l.documentElement,n=function(t){var e=l.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):n=function(t){setTimeout(p,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&p(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),n=function(e){t.postMessage(a+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var r={callback:t,args:e};return h[u]=r,n(u),u++},f.clearImmediate=d}function d(t){delete h[t]}function p(t){if(c)setTimeout(p,0,t);else{var e=h[t];if(e){c=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(void 0,i)}}(e)}finally{d(t),c=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(12),i(62))},787:function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"ViewableStyle",(function(){return H})),i.d(n,"SpriteViewable",(function(){return F})),i.d(n,"CustomViewable",(function(){return B})),i.d(n,"ViewableData",(function(){return L})),i.d(n,"ViewableType",(function(){return V}));var r=i(44),o=i.n(r);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=f(t);if(e){var r=f(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return l(this,i)}}function l(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=Autodesk.Viewing,p=d.GlobalManagerMixin,v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(a,t);var e,i,n,o=c(a);function a(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(this,a),(e=o.call(this)).names=["HyperionTool"],e.options=i,e.setGlobalManager(t.globalManager),e.viewer=t,e.delegate=i.delegate,e.init(),e.hoveringDbId=0,e.selectedDbId=0,e}return e=a,(i=[{key:"init",value:function(){var t=this,e=this.viewer.impl;this.activate=function(e){t.active=!0},this.deactivate=function(e){t.clearMarkedObject(),t.active=!1},this.handleSingleClick=function(i,n){var o=!1;if(0===n){var a=e.clientToViewport(i.canvasX,i.canvasY),s=e.renderer(),u=s.getOverlayIdTarget();if(!u)return!1;var h=s.idAtPixel(a.x,a.y,[],[u]);if(t.selectedDbId!=h||0==t.selectedDbId){if(t.selectedDbId){var c={type:r.MOUSE_CLICK_OUT,dbId:t.selectedDbId,originalEvent:i};t.viewer.dispatchEvent(c),c.hasStopped||(t.clearMarkedObject(),t.viewer.impl.invalidate(!1,!1,!0))}t.selectedDbId=h;var l=e.hitTestViewport(a.clone(),!1),f={type:r.MOUSE_CLICK,dbId:h,clickInfo:l,originalEvent:i};t.viewer.dispatchEvent(f),f.hasStopped||(t.markObject([h]),t.viewer.impl.invalidate(!1,!1,!0)),t.selectedDbId&&(o=!0)}}return o},this.handleSingleTap=function(e){return t.handleSingleClick(e,0)},this.handleDoubleClick=function(t,e){return!1},this.handleButtonDown=function(e){return t.buttonDown=!0,!1},this.handleButtonUp=function(e){return t.buttonDown=!1,!1},this.handleMouseMove=function(i){if(!t.buttonDown){var n=e.clientToViewport(i.canvasX,i.canvasY),o=e.renderer().getOverlayIdTarget();if(!o)return!1;var a=e.renderer().idAtPixel(n.x,n.y,[],[o]);if(t.hoveringDbId!=a){var s=0!=a?a:t.hoveringDbId;t.hoveringDbId=a;var u=0!=a;return t.viewer.dispatchEvent({type:r.MOUSE_HOVERING,dbId:s,hovering:u,originalEvent:i}),!0}}},this.markObject=function(e){if(e instanceof Array||(e=[e]),t.delegate.hasViewables){var i=t.delegate.mapDbIdsToGeometries(e),n=new Set(e);i.map((function(e){if(e&&e.attributes.id&&e.attributes.pointScale){for(var i=e.attributes.pointScale.array,r=e.attributes.uvp.array,o=e.attributes.color.array,a=e.attributes.id.array,s=0;s<a.length;s+=3){var u=a[s]+(a[s+1]<<8)+(a[s+2]<<16),h=s/3,c=n.has(u);i[h]=c?1.5:1;var l=t.delegate.viewableData.getViewableUV(u,c);l&&(r[4*h]=l.x,r[4*h+1]=l.y,r[4*h+2]=l.w,r[4*h+3]=l.h);var f=t.delegate.viewableData.getViewableColor(u,c);f&&(o[3*h]=255*f.r,o[3*h+1]=255*f.g,o[3*h+2]=255*f.b)}e.attributes.pointScale.needsUpdate=!0,e.attributes.uvp.needsUpdate=!0,e.attributes.color.needsUpdate=!0}})),t.markedFragments=i}},this.clearMarkedObject=function(){if(t.delegate.hasViewables){var e=t.markedFragments||[];t.markedFragments=[],e&&(e.map((function(e){if(e&&e.attributes.pointScale){for(var i=e.attributes.pointScale.array,n=e.attributes.uvp.array,r=e.attributes.color.array,o=e.attributes.id.array,a=0;a<o.length;a+=3){var s=o[a]+(o[a+1]<<8)+(o[a+2]<<16),u=a/3;i[u]=1;var h=t.delegate.viewableData.getViewableUV(s,!1);h&&(n[4*u]=h.x,n[4*u+1]=h.y,n[4*u+2]=h.w,n[4*u+3]=h.h);var c=t.delegate.viewableData.getViewableColor(s,!1);c&&(r[3*u]=255*c.r,r[3*u+1]=255*c.g,r[3*u+2]=255*c.b)}e.attributes.pointScale.needsUpdate=!0,e.attributes.uvp.needsUpdate=!0,e.attributes.color.needsUpdate=!0}})),t.viewer.impl.invalidate(!1,!1,!0))}else t.markedFragments=[]},this.invalidateViewablesDirect=function(e,i,n,r){if(!e||!i||!r)throw new Error("Parameters of 'invalidateViewables' are mandatory");e instanceof Array||(e=[e]);var o=new Set(e),a=new Map;n.viewables.forEach((function(t){return a.set(t.dbId,t)}));for(var s=!1,u=i[0].geometry,h=u.attributes.id.array,c=0;c<h.length;c+=3){var l=h[c]+(h[c+1]<<8)+(h[c+2]<<16);if(o.has(l)){var f=r(a.get(l));if(f){var d=c/3;if(f.position){var p=u.attributes.position.array;u.attributes.position.needsUpdate=!0,p[3*d+0]=f.position.x,p[3*d+1]=f.position.y,p[3*d+2]=f.position.z,s=!0}if(f.url){var v=n.getSpriteUV(f.url);if(v){var y=u.attributes.uvp.array;u.attributes.uvp.needsUpdate=!0,y[4*d+0]=v.x,y[4*d+1]=v.y,y[4*d+2]=v.w,y[4*d+3]=v.h,s=!0}}if(f.color){var g=u.attributes.color.array;u.attributes.color.needsUpdate=!0,g[3*d+0]=255*f.color.r,g[3*d+1]=255*f.color.g,g[3*d+2]=255*f.color.b,s=!0}if(void 0!==f.scale){if(f.scale>2||f.scale<0){var m="invalidateViewables: 'scale' of '".concat(f.scale,"' out of range [0, 2]");console.warn(m)}var w=u.attributes.pointScale.array;u.attributes.pointScale.needsUpdate=!0,w[d]=f.scale,s=!0}}}}s&&t.viewer.impl.invalidate(!1,!1,!0)}}}])&&u(e.prototype,i),n&&u(e,n),a}(d.ToolInterface);p.call(v.prototype);var y=i(410),g=i(57),m=i(102),w=i.n(m);function b(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var E=Autodesk.Viewing.Private,T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1920,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1080,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;_(this,t),this.width=e,this.height=i,this.padding=n,this.spritesMap={},this.pending=[],this.images=[],this.logger=E.logger,this.packer=new g.a(this.width,this.height,this.padding,{smart:!0,pot:!1,square:!1,allowRotation:!1,tag:!1,border:0}),this.canvas=document.createElement("canvas"),this.hasContent=!1}var e,i,n,r,o;return e=t,(i=[{key:"addSprite",value:function(t){var e=this;if(null==this.spritesMap[t]){var i=w.a.defer(),n=new Image;n.crossOrigin="anonymous",n.onload=function(){e.images.push({url:t,image:n,width:n.width,height:n.height}),i.resolve()},n.onerror=function(t){e.logger.error(t),i.resolve()},n.src=t,this.spritesMap[t]=1,this.pending.push(i.promise)}}},{key:"finish",value:(r=regeneratorRuntime.mark((function t(){var e,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.a.all(this.pending);case 2:e=this.canvas,this.packer.addArray(this.images),this.images.length=0,this.packer.bins.forEach((function(t){e.width=t.width,e.height=t.height;var n=e.getContext("2d");t.rects.forEach((function(t){t.image&&(n.drawImage(t.image,t.x,t.y),t.image=void 0,i.spritesMap[t.url]=t,t.url=void 0)}))}));case 6:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(i,n){var o=r.apply(t,e);function a(t){b(o,i,n,a,s,"next",t)}function s(t){b(o,i,n,a,s,"throw",t)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"spriteUV",value:function(t){var e=this.spritesMap[t];return e?{x:e.x/this.canvasWidth,y:e.y/this.canvasHeight,w:(e.x+e.width)/this.canvasWidth,h:(e.y+e.height)/this.canvasHeight}:{x:0,y:0,w:1,h:1}}},{key:"canvasWidth",get:function(){return this.canvas.width}},{key:"canvasHeight",get:function(){return this.canvas.height}}])&&x(e.prototype,i),n&&x(e,n),t}();function R(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=C(t);if(e){var r=C(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return P(this,i)}}function P(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return A(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return A(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function j(t,e,i){return e&&I(t.prototype,e),i&&I(t,i),t}var V={SPRITE:1,GEOMETRY:2},H=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.SPRITE,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new THREE.Color(16777215),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Color(16777215),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];D(this,t),this.type=e,this.color=i,this.url=n,this.highlightedColor=r,this.highlightedUrl=o,this.spriteUrls=new Set(a)}return j(t,[{key:"preloadSprite",value:function(t){this.spriteUrls.add(t)}},{key:"preloadedSprites",get:function(){return O(this.spriteUrls.values())}}]),t}(),B=function(){function t(e,i,n){D(this,t),this._style=i,this._position=e,this._dbId=n}return j(t,[{key:"style",get:function(){return this._style}},{key:"position",get:function(){return this._position}},{key:"dbId",get:function(){return this._dbId}}]),t}(),F=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(i,t);var e=M(i);function i(t,n,r){return D(this,i),console.assert(n.type==V.SPRITE),e.call(this,t,n,r)}return j(i,[{key:"type",get:function(){return V.SPRITE}},{key:"color",get:function(){return this.style.color}},{key:"highlightedColor",get:function(){return this.style.highlightedColor}}]),i}(B),L=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D(this,t),this._styleMap=new Map,this._viewablesMap=new Map,this._spriteAtlas=new T(e.atlasWidth||1920,e.atlasHeight||1080,2)}var e,i;return j(t,[{key:"addViewable",value:function(t){var e=this;if(t.type==V.SPRITE){var i=new Set;i.add(t.style.url),t.style.highlightedUrl&&i.add(t.style.highlightedUrl),t.style.preloadedSprites.forEach((function(t){return i.add(t)})),i.forEach((function(t){return e.spriteAtlas.addSprite(t)}))}this._viewablesMap.set(t.dbId,t)}},{key:"getSpriteUV",value:function(t){return this._spriteAtlas.spriteUV(t)}},{key:"getViewableUV",value:function(t,e){var i=this._viewablesMap.get(t).style;return e&&i.highlightedUrl?this._spriteAtlas.spriteUV(i.highlightedUrl):this._spriteAtlas.spriteUV(i.url)}},{key:"getViewableColor",value:function(t,e){var i=this._viewablesMap.get(t).style;return e?i.highlightedColor:i.color}},{key:"finish",value:(e=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._spriteAtlas.finish();case 2:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,i=arguments;return new Promise((function(n,r){var o=e.apply(t,i);function a(t){R(o,n,r,a,s,"next",t)}function s(t){R(o,n,r,a,s,"throw",t)}a(void 0)}))},function(){return i.apply(this,arguments)})},{key:"viewables",get:function(){return O(this._viewablesMap.values())}},{key:"spriteAtlas",get:function(){return this._spriteAtlas}}]),t}(),U=i(30);function z(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function N(t){return function(){var e=this,i=arguments;return new Promise((function(n,r){var o=t.apply(e,i);function a(t){z(o,n,r,a,s,"next",t)}function s(t){z(o,n,r,a,s,"throw",t)}a(void 0)}))}}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function X(t,e,i){return e&&W(t.prototype,e),i&&W(t,i),t}var q=function(){function t(e,i,n){G(this,t),this._id=e,this._name=i,this._bounds=n,this._devices=[]}return X(t,[{key:"addDevice",value:function(t){this._devices.push(t)}},{key:"info",set:function(t){this._info=t},get:function(){return this._info}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"bounds",get:function(){return this._bounds}},{key:"devices",get:function(){return this._devices}}]),t}(),$=function(){function t(){G(this,t)}return X(t,[{key:"addRoomToLevel",value:function(t,e){this[t]||(this[t]=[]),this[t].push(e)}},{key:"getRoomsOnLevel",value:function(t,e){var i=this[t]||[];return e?i.filter((function(t){return t.devices.length>0})):i}}]),t}(),Y=function(){function t(e){G(this,t),this.model=e,this.rooms=null}var e,i,n,r;return X(t,[{key:"getImmediateChildNodesByName",value:function(t,e){var i=this.model.getInstanceTree(),n=[];return i&&(e=null==e?i.getRootId():e,i.enumNodeChildren(e,(function(e){var r=i.getNodeName(e,!0);r&&r.indexOf&&r.indexOf(t)>=0&&n.push(e)}),!1)),n}},{key:"getLevelRoomsMap",value:(r=N(regeneratorRuntime.mark((function t(){var e,i,n,r=this,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.length>0&&void 0!==o[0]&&o[0],i=o.length>1?o[1]:void 0,this.levelRoomsMap){t.next=9;break}return n=new $,t.next=6,this.getRoomList(i);case 6:t.sent.forEach((function(t){var i=r.getLevel(t);e||(t.info=void 0),null!=i&&n.addRoomToLevel(i,t)})),this.levelRoomsMap=n;case 9:return t.abrupt("return",this.levelRoomsMap);case 10:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"getLevel",value:function(t){if(t&&t.info&&t.info.properties){var e=t.info.properties.find((function(t){return 20==t.type&&"Level"==t.attributeName}));return e?e.displayValue:void 0}}},{key:"getRoomList",value:(n=N(regeneratorRuntime.mark((function t(e){var i,n,r,o,a,s,u=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.rooms){t.next=10;break}return e=e||"Rooms",i=this.getImmediateChildNodesByName(e),n=this.model,r=[],i&&i.length>0&&(o=i[0],(a=n.getInstanceTree())&&a.enumNodeChildren(o,(function(t){var e=a.getNodeName(t,!0),i=u.getRoomBounds(t);r.push(new q(t,e,i))}),!1)),s=r.map((function(t){return new Promise((function(e,i){n.getProperties2(t.id,(function(i){t.info=i,e(t)}),(function(i){e(t)}))}))})),t.next=9,Promise.all(s);case 9:this.rooms=r;case 10:return t.abrupt("return",this.rooms);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"getRoomBounds",value:function(t){var e=new THREE.Box3,i=new THREE.Box3,n=this.model.getInstanceTree(),r=this.model.getFragmentList();return n&&n.enumNodeFragments(t,(function(t){r.getWorldBounds(t,i),e.union(i)}),!0),e}},{key:"mapDevicesInRoom",value:(i=N(regeneratorRuntime.mark((function t(){var e,i,n,r,o,a,s,u,h=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.length>0&&void 0!==h[0]?h[0]:[],i=h.length>1?h[1]:void 0,t.next=4,this.getRoomList(i);case 4:for(n=t.sent,e=e.slice(0),r=0;e.length>0&&r<n.length;r++)for(o=n[r],a=0;a<e.length;a++)s=e[a],this.roomGeomContainsPoint(o,s.position)&&(s.roomId=o.id,o.addDevice(s),e.splice(a,1),a--);e.length>0&&(u=e.map((function(t){return"".concat(t.id," (").concat(t.name,")")})),console.warn("Some devices did not map to a room: ".concat(u.join(", "))));case 8:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"generateSurfaceShadingData",value:(e=N(regeneratorRuntime.mark((function t(){var e,i,n,r,o,a,s=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:[],i=s.length>1?s[1]:void 0,n=s.length>2?s[2]:void 0,i){t.next=9;break}return t.next=6,this.getLevelRoomsMap(!1,n);case 6:return i=t.sent,t.next=9,this.mapDevicesInRoom(e,n);case 9:for(a in r=new U.SurfaceShadingData,o=function(t){var e=i[t],n=new U.SurfaceShadingGroup(t);e.forEach((function(t){var e=new U.SurfaceShadingNode(t.name,t.id);t.devices.forEach((function(t){var i=t.deviceModel?t.deviceModel.id:t.type;e.addPoint(new U.SurfaceShadingPoint(t.id,t.position,t.sensorTypes,t.name,{styleId:i}))})),n.addChild(e)})),r.addChild(n)},i)o(a);return r.initialize(this.model),t.abrupt("return",r);case 14:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"roomGeomContainsPoint",value:function(t,e){return t.bounds&&t.bounds.containsPoint(e)}}]),t}();function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}function et(t,e){return!e||"object"!==K(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function it(t){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(o,THREE.ShaderMaterial);var e,i,n,r=tt(o);function o(t,e,i,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(J(this,o),e.length<2||e.length!=i.length)throw new Error("Heatmap requires at least two colors to work");if(n<0)throw new Error("Heatmap 'confidence' must be a positive number");if(a<0)throw new Error("Heatmap 'powerParameter' must be a positive number");if(s<0||s>1)throw new Error("Heatmap 'alpha' must range between 0.0 and 1.0");var u={uPower:{type:"f",value:a},uAlpha:{type:"f",value:s},uConfidence:{type:"f",value:n},uSensors:{type:"v4v",value:t.map((function(t){return t}))},uStops:{type:"fv1",value:i},uColors:{type:"v3v",value:e}},h=e.length,c=t.length,l="\n            varying vec4 worldCoord;\n\n            void main()\n            {\n                vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                worldCoord = modelMatrix * vec4(position, 1.0);\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        ",f="\n            varying vec4 worldCoord;\n            uniform float uPower;\n            uniform float uAlpha;\n            uniform float uConfidence;\n            uniform vec4 uSensors [".concat(c,"];\n            uniform float uStops[").concat(h,"];\n            uniform vec3 uColors[").concat(h,"];\n\n            const float dotSize = 6.0;\n            const float h_var1 = 0.4;\n            const float h_var2 = 0.25;\n            const float two_pi = 2.0 * 3.1415927;\n            \n            float lmap(float value, float inMin, float inMax, float outMin, float outMax)\n            {\n                return clamp(outMin + ((outMax - outMin) * (value - inMin)) / (inMax - inMin), outMin, outMax);\n            }\n\n            // Gradient with multiple colors in non-equal intervals\n            vec3 colormap(float x)\n            {\n                for (int i = 1; i < ").concat(h,"; i++) {\n                    if (x <= uStops[i]) {\n                        float stopPct = lmap(x, uStops[i-1], uStops[i], 0.0, 1.0);\n                        return mix(uColors[i-1], uColors[i], stopPct);\n                    }\n                }\n            \n                // In case 'x' goes beyond upper bound.\n                return uColors[").concat(h," - 1];\n            }\n\n            vec2 get_pix(float angle) {\n                float rad = radians(angle);\n                float c = cos(rad);\n                float s = sin(rad);\n                mat2 R = mat2(vec2(c, -s), vec2(s, c));\n                return R * gl_FragCoord.xy;\n            }\n\n            vec3 halftone(float tone, vec3 dotColor, vec3 backgroundColor) {\n                vec2 u = get_pix(-45.0) / (dotSize);\n                float h = (h_var1 + h_var2 * cos(u.x*two_pi));\n                const float e = 0.05;\n                float gradient = smoothstep(-e, e, h - tone);\n                return mix(dotColor, backgroundColor, gradient);\n            }\n\n            void main(void) {\n                vec3 fragPos = vec3(worldCoord.x, worldCoord.y, worldCoord.z);\n                float result = 0.0;\n                float sum = 0.0;\n                float wsum = 0.000001;\n                float minDist = 999999999.0;\n                bool found = false; // at exact location of the sensor\n                int validSensors = 0;\n\n                for (int i=0; i < ").concat(c,"; i++) {\n                    float mydist = distance(fragPos, vec3(uSensors[i][0], uSensors[i][1], uSensors[i][2]));\n                    if (uSensors[i][3] >= 0.0) {\n                        if (mydist < 0.00001) {\n                            result = uSensors[i][3];\n                            found = true;\n                        } else {\n                            float w = (1.0 / (pow(mydist, uPower)));\n                            sum += (uSensors[i][3] * w);\n                            wsum += w;\n                        }\n                        validSensors += 1;\n                        if (mydist < minDist) {\n                            minDist = mydist;\n                        }\n                    }\n                }\n\n                if (validSensors == 0) {\n                    result = -1.0;\n                } else if (!found) {\n                    result = sum / wsum;\n                }\n\n                // Defaults without influence from any sensor\n                float confidence = 0.0;\n                vec3 sensorColor = vec3(0.5, 0.5, 0.5);\n\n                if (result >= 0.0) {\n                    result = clamp(result, 0.0, 1.0);\n                    confidence = 1.0 - clamp(minDist / uConfidence, 0.0, 1.0);\n                    sensorColor = colormap(result);\n                }\n\n                vec3 confidenceColor = halftone(clamp(confidence, 0.3, 0.9), vec3(0.7, 0.7, 0.7), vec3(1.0, 1.0, 1.0));\n                gl_FragColor = vec4(mix(confidenceColor, sensorColor, clamp(confidence, 0.0, 1.0)), uAlpha);\n            }\n        ");return r.call(this,{uniforms:u,vertexShader:l,fragmentShader:f,side:THREE.DoubleSide,depthTest:!0,depthWrite:!1})}return e=o,(i=[{key:"update",value:function(t,e,i,n){isNaN(e)||null===e||(this.uniforms.uConfidence.value=e),isNaN(i)||null===i||(this.uniforms.uPower.value=i),isNaN(n)||null===n||(this.uniforms.uAlpha.value=n),this.uniforms.uSensors.value=t}}])&&Z(e.prototype,i),n&&Z(e,n),o}();function rt(t){for(var e=[],i=1/(t-1),n=0;n<t;n++)e.push(i*n);return e}function ot(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return at(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return at(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function st(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ut=Autodesk.Viewing.Private,ht=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.model=i,this.shadingData=n,this.activeShadingPoints=[],this.settings={},this.registerSensorColors("hatchPattern",[16777215,16777215],.7),this.registerSensorColors("__defaultSensor__",[255,65280,16776960,16711680],.7)}var e,i,n;return e=t,(i=[{key:"removeShading",value:function(){this.viewer.impl.removeOverlayScene("DataVizSurfaceShading"),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"cleanUp",value:function(){this.removeShading(),this._clearActiveShadingPoints(),this.hatchMaterial&&(this.hatchMaterial.dispose(),delete this.hatchMaterial)}},{key:"_clearActiveShadingPoints",value:function(){this.activeShadingPoints.forEach((function(t){return t.heatmapMaterial.dispose()})),this.activeShadingPoints=[]}},{key:"_createHatchMaterial",value:function(){var t=this.settings.hatchPattern;return new nt([new THREE.Vector4(9999999.9,9999999.9,9999999.9,-1)],t.colors,t.stops,60,2,t.alpha)}},{key:"registerSensorColors",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;this.settings[t]={stops:rt(e.length),colors:e.map((function(t){return new THREE.Color(t)})).map((function(t){return new THREE.Vector3(t.r,t.g,t.b)})),alpha:i}}},{key:"getSetting",value:function(t){return this.settings[t]?this.settings[t]:this.settings.__defaultSensor__}},{key:"render",value:function(t,e,i,n){var r=this,o=n?n.confidence:0;o=isNaN(o)?0:Math.abs(o);var a=2;n&&"number"==typeof n.powerParameter&&(a=n.powerParameter);var s=[];t instanceof Array?t.forEach((function(t){return r.shadingData.getLeafsById(t,s)})):s=this.shadingData.getLeafsById(t);var u=this.model.getInstanceTree();this._clearActiveShadingPoints();var h=this.viewer.impl,c=this.activeShadingPoints;h.createOverlayScene("DataVizSurfaceShading"),this.hatchMaterial||(this.hatchMaterial=this._createHatchMaterial());for(var l=this.getSetting(e),f=function(t){var n=s[t],f=Object(U.filterShadingPointsByType)(n.shadingPoints,e),d=r.hatchMaterial;if(f.length>0){var p=o;if(n.bounds&&!o){var v=n.bounds.max,y=n.bounds.min;p=v.x-y.x+(v.y-y.y)+(v.z-y.z)}p=p||160;var g=[];f.forEach((function(t){var n=t.position,r=i(t,e),o=new THREE.Vector4(n.x,n.y,n.z,r);g.push(o)})),d=new nt(g,l.colors,l.stops,p,a,l.alpha),c.push({shadingPoints:f,sensorType:e,heatmapMaterial:d})}n.fragIds.forEach((function(t){return function(t,e){var i=u.fragList.getGeometry(t);if(i){var n=new THREE.Mesh(i,e),r=new THREE.Matrix4;u.fragList.getWorldMatrix(t,r),n.matrix.copy(r),n.matrixWorldNeedsUpdate=!0,n.matrixAutoUpdate=!1,n.frustumCulled=!1,h.addOverlay("DataVizSurfaceShading",n)}else ut.logger.error("Geometry for the fragment is empty, FragId:",t)}(t,d)}))},d=0;s&&d<s.length;d++)f(d)}},{key:"updateShading",value:function(t,e){var i,n,r;e&&(i=e.confidence,n=e.powerParameter,r=e.alpha);for(var o=0;o<this.activeShadingPoints.length;o++){var a,s=this.activeShadingPoints[o],u=s.shadingPoints,h=s.sensorType,c=s.heatmapMaterial,l=[],f=ot(u);try{for(f.s();!(a=f.n()).done;){var d=a.value,p=d.position,v=t(d,h);l.push(new THREE.Vector4(p.x,p.y,p.z,v))}}catch(t){f.e(t)}finally{f.f()}c.update(l,i,n,r)}this.viewer.impl.invalidate(!1,!1,!0)}}])&&st(e.prototype,i),n&&st(e,n),t}(),ct=i(411),lt=i.n(ct);function ft(t){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dt(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return pt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return pt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var gt=Autodesk.Viewing.Private,mt=function(){function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};vt(this,t);var o=r=this._handleLegacyOptions(r),a=o.width,s=o.height,u=o.minOpacity,h=o.maxOpacity;this.options=r;var c=document.createElement("canvas");c.width=a,c.height=s,this.config={canvas:c,width:a,height:s,minOpacity:u,maxOpacity:h,radius:20},this.model=i,this.viewer=e,this.shadingData=n;var l=new THREE.Texture(c,THREE.UVMapping);l.minFilter=THREE.LinearFilter,l.flipY=!1,this.material=new THREE.MeshBasicMaterial({map:l,depthTest:!0,depthWrite:!1,transparent:!0,side:THREE.DoubleSide}),this.gradientMap={}}var e,i,n;return e=t,(i=[{key:"_handleLegacyOptions",value:function(t){function e(t,e){return null==t||"number"!=typeof t?e:t<0?0:t>1?1:t}return"string"==typeof(t=Object.assign({width:1024,height:1024,slicingEnabled:!0},t)).position&&(t.slicingPosition={min:0,middle:.5,max:1}[t.position]),"string"==typeof t.placePosition&&(t.placementPosition={min:0,max:1}[t.placePosition]),delete t.position,delete t.placePosition,t.slicingPosition=e(t.slicingPosition,.5),t.placementPosition=e(t.placementPosition,0),t}},{key:"_setup",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,n=this.model,r=this.shadingData,o=new THREE.Box3,a=n.getInstanceTree(),s=[],u={},h=[],c={};function l(t){return!(null==t.shadingPoints||t.shadingPoints&&0==t.shadingPoints.length||null==t.shadingPoints.find((function(t){return t.types.find((function(t){return t==e}))})))}this.gradientMap[e]&&(this.config.gradient=this.gradientMap[e]),this.config.radius=i,t.forEach((function(t){return r.getLeafsById(t,s)}));for(var f=0;f<s.length;f++)l(s[f])&&s[f].dbIds.forEach((function(t){if(a.getNodeBox(t,h),h[0]!=1/0){var e=new THREE.Box3(new THREE.Vector3(h[0],h[1],h[2]),new THREE.Vector3(h[3],h[4],h[5]));o.union(e),u[t]=e}}));var d=o.min.x,p=o.min.y,v=o.max.x-d,y=o.max.y-p,g=this.options,m=g.slicingEnabled,w=g.width,b=g.height;if(v>y?b=w/v*y:w=b/y*v,this.config.canvas.width=w,this.config.canvas.height=b,this.config.width=w,this.config.height=b,this.heatmapInstance)this.heatmapInstance.configure(this.config);else{var _=document.createElement("div");_.width=w,_.height=b,this.config.container=_,this.heatmapInstance=lt.a.create(this.config),_.removeChild(this.config.canvas),delete this.config.container}for(var x=[],E=[],T=[],R=Autodesk.Viewing.Extensions.CompGeom,S=this.options.slicingPosition,k=this.options.placementPosition,M=n.getFragmentList(),P=0;P<s.length;P++){var C=s[P],O=Object(U.filterShadingPointsByType)(C.shadingPoints,e);if(!(O.length<=0)){var A;m?function(){var t=new THREE.Vector3(0,0,1);new gt.VertexBufferBuilder(!1),A=[],C.dbIds.forEach((function(e){var i=u[e],n=i.min,r=i.max,o=n.z+(r.z-n.z)*S,s=n.z+(r.z-n.z)*k,h=new THREE.Plane(t,-o),c=R.makePlaneBasis(h);a.enumNodeFragments(e,(function(t){var e=M.getVizmesh(t);e.geometry&&!e.geometry.is2d&&!e.geometry.isLines&&e.material.cutplanes&&R.xMeshPlane(h,e,A)}),!0);var l=new THREE.Box3;R.convertToPlaneCoords(c,A,l);var f=new R.EdgeSet(A,l,1e-6*l.size().length());f.snapEdges(),f.sanitizeEdges(),f.stitchContours();var g=f.triangulate();if(g&&!g.triangulationFailed){for(var m=g.toPolygonMesh(),w=x.length/3,b=m.attributes.position.array,_=0,P=b.length;_<P;_+=3)x.push(b[_],b[_+1],s),E.push((b[_]-d)/v,(b[_+1]-p)/y);for(var C=m.attributes.index.array,O=0,D=C.length;O<D;O++)T.push(C[O]+w)}}))}():C.dbIds.forEach((function(t){var e=u[t];if(!e.isEmpty()){var i=e.min,n=e.max,r=i.z+(n.z-i.z)*k,o=x.length/3;T.push(o,o+2,o+1,o,o+3,o+2),x.push(i.x,i.y,r,i.x,n.y,r,n.x,n.y,r,n.x,i.y,r),E.push((i.x-d)/v,(i.y-p)/y,(i.x-d)/v,(n.y-p)/y,(n.x-d)/v,(n.y-p)/y,(n.x-d)/v,(i.y-p)/y)}}));var D,I=dt(O);try{for(I.s();!(D=I.n()).done;){var j=D.value,V={x:Math.round((j.position.x-d)/v*w),y:Math.round((j.position.y-p)/y*b),value:0};c[j.id]={data:V,shadingPoint:j}}}catch(t){I.e(t)}finally{I.f()}}}x=new Float32Array(x),E=new Float32Array(E),T=new Uint16Array(T);var H=new THREE.BufferGeometry,B=new THREE.BufferAttribute(x,3);B.bytesPerItem=4;var F=new THREE.BufferAttribute(E,2);F.bytesPerItem=4;var L=new THREE.BufferAttribute(T,1);H.addAttribute("index",L),H.addAttribute("position",B),H.addAttribute("uv",F),this.geometry=H;var z=this.viewer.impl;z.createOverlayScene("DataVizPlanarHeatmap");var N=new THREE.Mesh(H,this.material);z.addOverlay("DataVizPlanarHeatmap",N),this.totalBounds=o,this.pointDataMap=c,this.currentSensorType=e}},{key:"render",value:function(t,e,i,n){var r=200;"number"==typeof n?r=Math.abs(n):"object"===ft(n)&&n.confidence&&(r=n.confidence),this.geometry&&(this.geometry.dispose(),this.geometry=null),t=t instanceof Array?t:[t],this._setup(t,e,r),this.updateShading(i)}},{key:"updateShading",value:function(t){var e=[];for(var i in this.pointDataMap){var n=this.pointDataMap[i],r=t(n.shadingPoint,this.currentSensorType,n.data);n.data.value=0===r?1e-4:r,isNaN(n.data.value)||e.push(n.data)}this.heatmapInstance.setData({data:e,min:0,max:1}),this.material.map.needsUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"cleanUp",value:function(){this.removeShading(),this.geometry&&(this.geometry.dispose(),this.geometry=null),this.material&&(this.material.dispose(),this.material=null)}},{key:"removeShading",value:function(){this.viewer.impl.removeOverlayScene("DataVizPlanarHeatmap"),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"registerSensorColors",value:function(t,e){for(var i,n,r,o={},a=e.length-1,s=0;s<e.length;s++)o[(s/a).toFixed(3)]=(i=e[s],n=void 0,r=void 0,n=255&i,r=i>>8&255,"rgb(".concat(i>>16&255,", ").concat(r,", ").concat(n,")"));this.gradientMap[t]=o}}])&&yt(e.prototype,i),n&&yt(e,n),t}();function wt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var bt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this._textures={},this._colors={},this._excluded=["__defaultMaterial__","__fadeMaterial__","__highlightMaterial__","__dataVizSpriteMaterial__"]}var e,i,n;return e=t,(i=[{key:"show",value:function(){return this.hideTextures(),this.regen(),!0}},{key:"hide",value:function(){return this.showTextures(),this.regen(),!0}},{key:"regen",value:function(){this.viewer.refresh(!0)}},{key:"hideTextures",value:function(){var t=0===Object.keys(this._textures).length,e=new THREE.Color(1,1,1),i=this.viewer.impl.matman()._materials;for(var n in i)if(-1===this._excluded.indexOf(n)){var r=i[n];t&&(this._textures[n]=r.map,this._colors[n]=r.color),r.map=null,r.color=e,r.needsUpdate=!0}this.regen()}},{key:"showTextures",value:function(){if(Object.keys(this._textures).length>0){var t=this.viewer.impl.matman()._materials;for(var e in t)if(-1===this._excluded.indexOf(e)){var i=t[e],n=this._textures[e];n&&(i.map=n);var r=this._colors[e];r&&(i.color=r),i.needsUpdate=!0}}this.regen()}}])&&wt(e.prototype,i),n&&wt(e,n),t}();function _t(t){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Et(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Tt(t,e,i){return e&&Et(t.prototype,e),i&&Et(t,i),t}function Rt(t,e){return(Rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function St(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Mt(t);if(e){var r=Mt(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return kt(this,i)}}function kt(t,e){return!e||"object"!==_t(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Mt(t){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rt(t,e)}(i,THREE.ShaderMaterial);var e=St(i);function i(t,n,r){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;xt(this,i);var s={dataTexture:{type:"t",value:null},vertexTexture:{type:"t",value:null},uPower:{type:"f",value:a=parseFloat(a).toFixed(3)},uDataCount:{type:"i",value:r},uDataTextureWidth:{type:"i",value:1}},u="\n            varying vec2 vUV;\n\n            void main()\n            {\n                vUV = uv;\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        ",h="\n            varying vec2 vUV;\n\n            uniform float uPower;\n            uniform int uDataCount;\n            uniform int uDataTextureWidth;\n            \n            uniform sampler2D dataTexture;\n            uniform sampler2D vertexTexture;\n            \n            void main(void) {\n                // The position of the vertex whose value is to be determined.\n                vec4 vertex = texture2D(vertexTexture, vUV);\n            \n                if (vertex.w < 0.) {\n                    // This is an invalid vertex, mark as transparent.\n                    gl_FragColor = vec4(0., 0., 0., 1.);\n                    return;\n                }\n            \n                float sum = 0.;\n                float wsum = 0.;\n                float factor = 1. / float(uDataTextureWidth);\n                float textureWidth = float(uDataTextureWidth);\n            \n                // Compute weighted influence from all the data points.\n                for (int index = 0; index < uDataCount; index++)\n                {\n                    float i = float(index);\n                    float y = floor(i / textureWidth);\n                    float x = mod(i, textureWidth);\n            \n                    vec2 dUV = vec2((x + 0.5) * factor, (y + 0.5) * factor);\n                    vec4 dataPoint = texture2D(dataTexture, dUV);\n            \n                    float dist = distance(vertex.xyz, dataPoint.xyz);\n            \n                    if (dist < 0.0001) {\n                        gl_FragColor = vec4(dataPoint.w, 0., 0., 1.);\n                        return;\n                    }\n            \n                    float w = 1. / dist;\n                    w = pow(w, uPower);\n            \n                    sum += dataPoint.w * w;\n                    wsum += w;\n                }\n            \n                gl_FragColor = vec4(sum/wsum , 0., 0., 1.);\n            }\n        ";return(o=e.call(this,{uniforms:s,vertexShader:u,fragmentShader:h,side:THREE.DoubleSide,depthTest:!0,depthWrite:!0})).vertexTexture=t,o.dataTexture=n,o}return Tt(i,[{key:"vertexTexture",set:function(t){t&&(this.uniforms.vertexTexture.value=t)}},{key:"dataTexture",set:function(t){t&&(this.uniforms.dataTexture.value=t,this.uniforms.uDataTextureWidth.value=t.image.width)}}]),i}(),Ct=function(){function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};xt(this,t),this.viewer=e,this.min=r.min,this.max=r.max;var o=r.colors;o?this.setColors(o):this.setColors([255,65535,65280,16776960,16711680]),this.setVertices(i),this.setDataPoints(n),this.initializeRender()}return Tt(t,[{key:"setVertices",value:function(t){this.vertexTexture&&(this.vertexTexture.dispose(),this.vertexTexture=null);var e=Math.ceil(Math.sqrt(t.length/3)),i=new Float32Array(e*e*4);i.fill(-1);for(var n=0,r=t.length/3;n<r;n++)i[4*n]=t[3*n],i[4*n+1]=t[3*n+1],i[4*n+2]=t[3*n+2],i[4*n+3]=1;var o=new THREE.DataTexture(i,e,e,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);o.generateMipmaps=!1,o.needsUpdate=!0,this.vertexTexture=o,this.verticesLength=t.length,this.vertexValues=new Uint8Array(e*e*4)}},{key:"setDataPoints",value:function(t){this.dataTexture&&(this.dataTexture.dispose(),this.dataTexture=null);var e=Math.ceil(Math.sqrt(t.length/4)),i=new Float32Array(e*e*4),n=this.min,r=this.max;if(null==n||null==r){n=1/0,r=-1/0;for(var o=0;o<t.length;o+=4)n=Math.min(n,t[o+3]),r=Math.max(r,t[o+3])}for(var a=r-n||1,s=0;s<t.length;s+=4)i[s]=t[s],i[s+1]=t[s+1],i[s+2]=t[s+2],i[s+3]=(t[s+3]-n)/a;var u=new THREE.DataTexture(i,e,e,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);u.generateMipmaps=!1,u.needsUpdate=!0,this.dataTexture=u,this.dataCount=t.length/4}},{key:"initializeRender",value:function(){var t=new Pt(this.vertexTexture,this.dataTexture,this.dataCount),e=new THREE.PlaneBufferGeometry(2,2,1,1),i=new THREE.OrthographicCamera(-1,1,-1,1,0,1),n=this.vertexTexture.image.width,r=new THREE.WebGLRenderTarget(n,n,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),o=new THREE.Mesh(e,t);o.frustumCulled=!1,this.scene=new THREE.Scene,this.scene.add(o),this.material=t,this.renderTarget=r,this.planeGeometry=e,this.camera=i}},{key:"setColors",value:function(t){if(t){this.colors=t.map((function(t){return new THREE.Color(t)})),this.stops=this._createColorStops(t.length),this.colorMapData=[];for(var e=0;e<256;e++)this.colorMapData.push(this._mapValueToColor(e/255))}}},{key:"_createColorStops",value:function(t){for(var e=[],i=1/(t-1),n=0;n<t;n++)e.push(i*n);return e}},{key:"_mapValueToColor",value:function(t){var e=this.colors,i=this.stops;function n(t,e,i){return t*(1-i)+e*i}function r(t,e,i){var r=new THREE.Color;return r.r=n(t.r,e.r,i),r.g=n(t.g,e.g,i),r.b=n(t.b,e.b,i),r}for(var o=e[i.length-1],a=1;a<i.length;a++)if(t<=i[a]){var s=(t-i[a-1])/(i[a]-i[a-1]);o=r(e[a-1],e[a],s);break}return{r:Math.round(255*o.r),g:Math.round(255*o.g),b:Math.round(255*o.b)}}},{key:"process",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.colors,i=t.power,n=t.outputTarget;e&&this.setColors(e),null==i&&(i=1),this.material.uniforms.uPower.value=i;var r=this.vertexTexture.image.width;this.renderTarget.width!=r&&this.renderTarget.setSize(r,r);var o=this.viewer.impl.glrenderer();return o.render(this.scene,this.camera,this.renderTarget,!0),o.readRenderTargetPixels(this.renderTarget,0,0,r,r,this.vertexValues),this._getColorValues(n)}},{key:"_getColorValues",value:function(t){var e;e=t&&t.length==this.verticesLength?t:new Uint8Array(this.verticesLength);for(var i=this.vertexValues,n=0,r=this.verticesLength/3;n<r;n++){var o=4*n;if(!(i[o+3]<128)){var a=i[o],s=this.colorMapData[a];e[3*n]=s.r,e[3*n+1]=s.g,e[3*n+2]=s.b}}return e}},{key:"cleanUp",value:function(){var t=this;setTimeout((function(){t.vertexTexture&&(t.vertexTexture.dispose(),t.vertexTexture=null),t.dataTexture&&(t.dataTexture.dispose(),t.dataTexture=null),t.renderTarget&&(t.renderTarget.dispose(),t.renderTarget=null),t.material&&(t.material.dispose(),t.material=null),t.planeGeometry&&(t.planeGeometry.dispose(),t.planeGeometry=null)}),32)}}]),t}();function Ot(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function At(t,e,i,n,r){if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,r&&e+r):t.slice(e,r&&e+r):t,i.set)i.set(t,n);else for(var o=0;o<t.length;o++)i[o+n]=t[o];return i}var Dt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._position=[],this._prev=[],this._next=[],this._side=[],this._width=[],this._index=[],this._widthCallback=null,this._geometry=null}var e,i,n;return e=t,(i=[{key:"dispose",value:function(){this._geometry&&(this._geometry.dispose(),this._geometry=null)}},{key:"setPoints",value:function(t,e){if(!(t instanceof Float32Array)||0===t.length)throw new Error("Input points must be of Float32Array type");this._widthCallback=e,this._position=[];for(var i=0;i<t.length;i+=3)t.length,this._position.push(t[i],t[i+1],t[i+2]),this._position.push(t[i],t[i+1],t[i+2]);this.process()}},{key:"compareV3",value:function(t,e){var i=6*t,n=6*e;return this._position[i]===this._position[n]&&this._position[i+1]===this._position[n+1]&&this._position[i+2]===this._position[n+2]}},{key:"copyV3",value:function(t){var e=6*t;return{x:this._position[e],y:this._position[e+1],z:this._position[e+2]}}},{key:"updateAttribute",value:function(t,e){t.set(e),t.needsUpdate=!0}},{key:"process",value:function(){var t=this._position.length/6;this._prev=[],this._next=[],this._side=[],this._width=[],this._index=[];var e=this.compareV3(0,t-1),i=e?t-2:0,n=this.copyV3(i),r=n.x,o=n.y,a=n.z;this._prev.push(r,o,a),this._prev.push(r,o,a);for(var s=0;s<t;s++){this._side.push(1),this._side.push(-1);var u=1;if(this._widthCallback&&(u=this._widthCallback(s/(t-1))),this._width.push(u),this._width.push(u),s<t-1){var h=this.copyV3(s),c=h.x,l=h.y,f=h.z;this._prev.push(c,l,f),this._prev.push(c,l,f);var d=2*s;this._index.push(d,d+1,d+2),this._index.push(d+2,d+1,d+3)}if(s>0){var p=this.copyV3(s),v=p.x,y=p.y,g=p.z;this._next.push(v,y,g),this._next.push(v,y,g)}}var m=e?1:t-1,w=this.copyV3(m),b=w.x,_=w.y,x=w.z;this._next.push(b,_,x),this._next.push(b,_,x);var E=new Float32Array(this._position),T=new Float32Array(this._prev),R=new Float32Array(this._next),S=new Float32Array(this._side),k=new Float32Array(this._width),M=new Uint16Array(this._index);this._attributes&&this._attributes.position.length===this._position.length?(this.updateAttribute(this._attributes.position,E),this.updateAttribute(this._attributes.prev,T),this.updateAttribute(this._attributes.next,R),this.updateAttribute(this._attributes.side,S),this.updateAttribute(this._attributes.width,k),this.updateAttribute(this._attributes.index,M)):this._attributes={position:new THREE.BufferAttribute(E,3),prev:new THREE.BufferAttribute(T,3),next:new THREE.BufferAttribute(R,3),side:new THREE.BufferAttribute(S,1),width:new THREE.BufferAttribute(k,1),index:new THREE.BufferAttribute(M,1)},this._geometry||(this._geometry=new THREE.BufferGeometry),this._geometry.addAttribute("position",this._attributes.position),this._geometry.addAttribute("prev",this._attributes.prev),this._geometry.addAttribute("next",this._attributes.next),this._geometry.addAttribute("side",this._attributes.side),this._geometry.addAttribute("width",this._attributes.width),this._geometry.addAttribute("index",this._attributes.index),this._geometry.computeBoundingSphere(),this._geometry.computeBoundingBox(),this._geometry.visible=!0}},{key:"advance",value:function(t){var e=this._attributes.position.array,i=this._attributes.prev.array,n=this._attributes.next.array,r=e.length;At(e,0,i,0,r),At(e,6,e,0,r-6),e[r-6]=t.x,e[r-5]=t.y,e[r-4]=t.z,e[r-3]=t.x,e[r-2]=t.y,e[r-1]=t.z,At(e,6,n,0,r-6),n[r-6]=t.x,n[r-5]=t.y,n[r-4]=t.z,n[r-3]=t.x,n[r-2]=t.y,n[r-1]=t.z,this._attributes.position.needsUpdate=!0,this._attributes.prev.needsUpdate=!0,this._attributes.next.needsUpdate=!0}},{key:"geometry",get:function(){return this._geometry}}])&&Ot(e.prototype,i),n&&Ot(e,n),t}();function It(t){function e(t,e){return void 0===t?e:t}THREE.Material.call(this),t=t||{},t=Object.assign(t,{side:THREE.DoubleSide,depthTest:!0,depthWrite:!1}),this.lineColor=e(t.lineColor,new THREE.Color(16777215)),this.opacity=e(t.opacity,1),this.lineWidth=e(t.lineWidth,6),delete t.lineColor,delete t.opacity,delete t.lineWidth;var i=new THREE.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},color:{type:"c",value:this.lineColor},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:new THREE.Vector2(1920,1080)},sizeAttenuation:{type:"f",value:0}},attributes:{position:{type:"v3",value:new THREE.Vector3},prev:{type:"v3",value:new THREE.Vector3},next:{type:"v3",value:new THREE.Vector3},side:{type:"f",value:0},width:{type:"f",value:0}},vertexShader:"\n    attribute vec3 position;\n    attribute vec3 prev;\n    attribute vec3 next;\n    attribute float side;\n    attribute float width;\n\n    uniform mat4 projectionMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform vec2 resolution;\n    uniform float lineWidth;\n    uniform vec3 color;\n    uniform float opacity;\n    uniform float sizeAttenuation;\n\n    varying vec4 vColor;\n\n    vec2 fix( vec4 i, float aspect ) {\n\n        vec2 res = i.xy / i.w;\n        res.x *= aspect;\n        return res;\n    }\n\n    void main() {\n        float aspect = resolution.x / resolution.y;\n\n        vColor = vec4( color, opacity );\n\n        mat4 m = projectionMatrix * modelViewMatrix;\n        vec4 finalPosition = m * vec4( position, 1.0 );\n        vec4 prevPos = m * vec4( prev, 1.0 );\n        vec4 nextPos = m * vec4( next, 1.0 );\n\n        vec2 currP = fix( finalPosition, aspect );\n        vec2 prevP = fix( prevPos, aspect );\n        vec2 nextP = fix( nextPos, aspect );\n\n        float w = lineWidth * width;\n\n        vec2 dir;\n        if ( nextP == currP ) {\n            dir = normalize( currP - prevP );\n        }\n        else if( prevP == currP ) {\n            dir = normalize( nextP - currP );\n        }\n        else {\n            vec2 dir1 = normalize( currP - prevP );\n            vec2 dir2 = normalize( nextP - currP );\n            dir = normalize( dir1 + dir2 );\n\n            vec2 perp = vec2( -dir1.y, dir1.x );\n            vec2 miter = vec2( -dir.y, dir.x );\n            w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );\n        }\n\n        vec4 normal = vec4( -dir.y, dir.x, 0., 1. );\n        normal.xy *= .5 * w;\n        normal *= projectionMatrix;\n\n        if ( sizeAttenuation == 0. ) {\n            normal.xy *= finalPosition.w;\n            normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\n        }\n\n        finalPosition.xy += normal.xy * side;\n        gl_Position = finalPosition;\n    }\n",fragmentShader:"\n    varying vec4 vColor;\n\n    void main() {\n        gl_FragColor = vColor;\n    }\n"});return i.type="StreamLineMaterial",i.setValues(t),i}function jt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}It.prototype=Object.create(THREE.Material.prototype),It.prototype.constructor=It,It.prototype.copy=function(t){return THREE.Material.prototype.copy.call(this,t),this},It.prototype.id=function(){return It.generateId(this.lineColor,this.opacity,this.lineWidth)},It.generateId=function(t,e,i){var n=t.getHexString(),r=e.toFixed(4),o=i.toFixed(4);return"".concat(n,"-").concat(r,"-").concat(o)};var Vt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._viewer=e,this._overlayCreated=!1,this._streamLines=[],this._cachedMaterials={}}var e,i,n;return e=t,(i=[{key:"dispose",value:function(){var t=this;this._streamLines.forEach((function(e){var i=e.streamLine,n=e.mesh;t._removeMeshFromScene(n),i.dispose()})),this._streamLines=[],Object.values(this._cachedMaterials).forEach((function(t){return t.dispose()})),this._cachedMaterials={},this._overlayCreated&&(this._overlayCreated=!1,this._viewer.impl.removeOverlayScene("StreamLineOverlay"))}},{key:"createStreamLine",value:function(t){var e=new Dt;e.setPoints(new Float32Array(t.lineData.points));var i=this._getOrCreateMaterial(t),n=new THREE.Mesh(e.geometry,i);return this._addMeshToScene(n),this._streamLines.push({streamLine:e,mesh:n}),e}},{key:"destroyStreamLine",value:function(t){var e=this._streamLines.findIndex((function(e){return e.streamLine===t}));if(e>=0){var i=this._streamLines.splice(e,1);this._removeMeshFromScene(i[0].mesh),i[0].streamLine.dispose()}}},{key:"_addMeshToScene",value:function(t){this._overlayCreated||(this._overlayCreated=!0,this._viewer.impl.createOverlayScene("StreamLineOverlay")),this._viewer.impl.addOverlay("StreamLineOverlay",t)}},{key:"_removeMeshFromScene",value:function(t){this._overlayCreated&&this._viewer.impl.removeOverlay("StreamLineOverlay",t)}},{key:"_getOrCreateMaterial",value:function(t){var e=t.lineColor,i=t.opacity,n=t.lineWidth,r=It.generateId(e,i,n),o=this._cachedMaterials[r];return o||(o=new It({lineColor:e,opacity:i,lineWidth:n}),this._cachedMaterials[r]=o),o}}])&&jt(e.prototype,i),n&&jt(e,n),t}();function Ht(t){return(Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bt(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function Ft(t){return function(){var e=this,i=arguments;return new Promise((function(n,r){var o=t.apply(e,i);function a(t){Bt(o,n,r,a,s,"next",t)}function s(t){Bt(o,n,r,a,s,"throw",t)}a(void 0)}))}}function Lt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zt(t,e){return(zt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Xt(t);if(e){var r=Xt(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Gt(this,i)}}function Gt(t,e){return!e||"object"!==Ht(e)&&"function"!=typeof e?Wt(t):e}function Wt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xt(t){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qt="Autodesk.DataVisualization",$t=AutodeskNamespace("Autodesk.DataVisualization.Core");$t=Object.assign($t,n),$t=Object.assign($t,o.a),($t=Object.assign($t,U)).Room=q,$t.LevelRoomsMap=$,$t.ModelStructureInfo=Y,$t.SurfaceShading=ht,$t.PlanarHeatmap=mt,$t.IDWDataProcessor=Ct,$t.IDWProcessMaterial=Pt;var Yt=Autodesk.Viewing,Kt=Yt.Private,Jt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zt(t,e)}(u,t);var e,i,n,r,o,a,s=Nt(u);function u(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Lt(this,u),(e=s.call(this,t,i)).textureUtility=new bt(t),e.pointMeshes=[],e._streamLineBuilder=null,e._onInstanceTreeReady=e._onInstanceTreeReady.bind(Wt(e)),e}return e=u,(i=[{key:"load",value:(a=Ft(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.tool=new v(this.viewer,{delegate:this}),this.viewer.toolController.registerTool(this.tool),this.activate(),this.instanceTreeReadyPromise=new Promise((function(t,i){e.instanceTreeReadyPromiseResolve=t,e.instanceTreeReadyPromiseReject=i})),this.datavizDotOverlay=this.viewer.impl.createOverlayScene("DataVizDots",null,null,null,!0,!0),this.viewer.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,this._onInstanceTreeReady),this.deviceDepthOcclusion=!1,t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"unload",value:function(){return this.viewer.toolController.deregisterTool(this.tool),this.viewer.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,this._onInstanceTreeReady),this.removeSurfaceShading(),this.surfaceShading=null,this.deactivate(),!0}},{key:"activate",value:function(){return this.viewer.toolController.activateTool(this.tool.getName()),!0}},{key:"deactivate",value:function(){return this._streamLineBuilder&&(this._streamLineBuilder.dispose(),this._streamLineBuilder=null),this.viewer.toolController.deactivateTool(this.tool.getName()),this.removeSurfaceShading(),this.showTextures(),this.removeAllViewables(),!0}},{key:"_onInstanceTreeReady",value:function(t){this.instanceTreeReadyPromiseResolve&&this.instanceTreeReadyPromiseResolve()}},{key:"waitForInstanceTree",value:(o=Ft(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.getInstanceTree()){t.next=4;break}this.instanceTreeReadyPromiseResolve(),t.next=6;break;case 4:return t.next=6,this.instanceTreeReadyPromise;case 6:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"mapDbIdsToGeometries",value:function(t){var e=this.dbId2Geometry||{},i=new Set;return t.map((function(t){var n=e[t];n&&i.add(n)})),Array.from(i)}},{key:"addViewables",value:function(t){var e=this,i=THREE.ImageUtils.loadTexture(t.spriteAtlas.canvas.toDataURL());i.minFilter=THREE.LinearFilter,i.maxFilter=THREE.LinearFilter,i.flipY=!1;var n=new THREE.PointCloudMaterial({size:t.spriteSize*this.getWindow().devicePixelRatio,map:i,vertexColors:THREE.VertexColors,alphaTest:.5,transparent:!0,occlusion:1,depthTest:!0,depthWrite:!0});function r(t,e){var i=t.impl.renderer().getDepthTarget();if(i){var n=new THREE.Vector2(1/i.width,1/i.height);e.uniforms=Object.assign(e.uniforms||{},{tDepthTest:{type:"t",value:i},tDepthResolution:{type:"v2",value:n}})}}n.skipMrtNormals=!0,r(this.viewer,n),n.defines=Object.assign(n.defines||{},{PARTICLE_FRAGMENT:1,USE_VERTEX_ID:1,DEPTH_OCCLUSION:this.deviceDepthOcclusion?1:0,PARTICLE_UV:1,PARTICLE_FLAGS:""});var o=this.viewer.impl;o.matman().addMaterial("__dataVizSpriteMaterial__",n,!0),this.pointMaterial=n,this.viewableData=t,this.dbId2Geometry={},this.viewer.addEventListener(Yt.VIEWER_RESIZE_EVENT,(function(){r(e.viewer,n)}));var a=this,s=new y.SpriteMeshBuilder((function(t){t.dbIds.forEach((function(e){a.dbId2Geometry[e]=t}));var e=new THREE.Mesh(t,n);o.addOverlay("DataVizDots",e),a.pointMeshes.push(e),setTimeout((function(){o.invalidate(!1,!1,!0)}),16)}));t.viewables.map((function(e){e.position&&s.addPoint(e,t.spriteAtlas)})),s.flushBuffer()}},{key:"removeAllViewables",value:function(){if(this.pointMeshes&&this.pointMeshes.length>0){var t=this.viewer.impl;this.pointMeshes.forEach((function(e){t.removeOverlay("DataVizDots",e),e.geometry.dispose(),e.material.dispose()})),t.invalidate(!1,!1,!0)}this.pointMeshes=[],delete this.dbId2Geometry,delete this.viewableData}},{key:"changeOcclusion",value:function(t){if(this.deviceDepthOcclusion!=t){this.deviceDepthOcclusion=t;var e=t?1:0;this.pointMaterial&&this.pointMaterial.program&&(this.pointMaterial.defines.DEPTH_OCCLUSION=e,this.pointMaterial.needsUpdate=!0),this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"showHideViewables",value:function(t,e){this.changeOcclusion(e),this.pointMaterial&&(this.pointMaterial.visible=t,this.pointMaterial.needsUpdate=!0),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"highlightViewables",value:function(t){this.tool&&this.tool.markObject(t)}},{key:"clearHighlightedViewables",value:function(){this.tool&&this.tool.clearMarkedObject()}},{key:"invalidateViewables",value:function(t,e){!t||t.length<=0?console.warn("All parameters of 'invalidateViewables' are mandatory"):!this.pointMeshes||this.pointMeshes.length<=0||!this.viewableData?console.warn("'addViewables' must be called before 'invalidateViewables'"):this.tool&&this.tool.invalidateViewablesDirect(t,this.pointMeshes,this.viewableData,e)}},{key:"showTextures",value:function(){this.textureUtility.showTextures()}},{key:"hideTextures",value:function(){this.textureUtility.hideTextures()}},{key:"setupSurfaceShading",value:(r=Ft(regeneratorRuntime.mark((function t(e,i){var n,r,o=this,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:{},r=function(){var t=Ft(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.surfaceShading&&o.surfaceShading.cleanUp(),"PlanarHeatmap"!=n.type){t.next=7;break}return t.next=4,o.viewer.loadExtension("Autodesk.CompGeom");case 4:o.surfaceShading=new mt(o.viewer,e,i,n),t.next=8;break;case 7:o.surfaceShading=new ht(o.viewer,e,i);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=4,this.waitForInstanceTree(e);case 4:return t.abrupt("return",r());case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"renderSurfaceShading",value:function(t,e,i,n){null==n?n={confidence:160}:"number"==typeof n&&(n={confidence:Math.abs(n)}),this.surfaceShading?this.surfaceShading.render(t,e,i,n):Kt.logger.error("Please call setupSurfaceShading first")}},{key:"updateSurfaceShading",value:function(t,e){this.surfaceShading?this.surfaceShading.updateShading(t,e):Kt.logger.error("Please call setupSurfaceShading first")}},{key:"registerSurfaceShadingColors",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;this.surfaceShading?this.surfaceShading.registerSensorColors(t,e,i):Kt.logger.error("Please call setupSurfaceShading first")}},{key:"removeSurfaceShading",value:function(){this.surfaceShading&&this.surfaceShading.removeShading()}},{key:"hasViewables",get:function(){return this.pointMeshes&&this.pointMeshes.length>0&&this.viewableData}},{key:"streamLineBuilder",get:function(){return this._streamLineBuilder||(this._streamLineBuilder=new Vt(this.viewer)),this._streamLineBuilder}}])&&Ut(e.prototype,i),n&&Ut(e,n),u}(Yt.Extension);Yt.theExtensionManager.registerExtension(qt,Jt)}});
//# sourceMappingURL=DataVisualization.min.js.map