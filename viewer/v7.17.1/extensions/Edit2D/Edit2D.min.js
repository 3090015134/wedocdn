/*!
 * LMV v7.17.1
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Edit2D=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=573)}({1:function(e,t,i){"use strict";i.d(t,"l",(function(){return S})),i.d(t,"j",(function(){return T})),i.d(t,"e",(function(){return P})),i.d(t,"f",(function(){return C})),i.d(t,"h",(function(){return A})),i.d(t,"b",(function(){return L})),i.d(t,"c",(function(){return D})),i.d(t,"d",(function(){return _})),i.d(t,"g",(function(){return B})),i.d(t,"i",(function(){return I})),i.d(t,"a",(function(){return H})),i.d(t,"k",(function(){return j}));var n=i(3),o=i(12);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?a(e):t}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t,i){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,i){return t&&d(e.prototype,t),i&&d(e,i),e}var f=1,v=Autodesk.Viewing,g=function(e,t,i){return"rgb("+e+","+t+","+i+")"},m=function(e){return e.map((function(e){return{x:e.x,y:e.y}}))},x=new THREE.Vector3,E=new THREE.Vector3,b=new THREE.Box2,S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(this,e),this.lineColor=t.lineColor||t.color||"rgb(0,0,128)",this.lineAlpha=void 0!==t.lineAlpha?t.lineAlpha:void 0!==t.alpha?t.alpha:1,this.lineWidth=void 0!==t.lineWidth?t.lineWidth:3,this.fillColor=t.fillColor||t.color||"rgb(0,0,128)",this.fillAlpha=void 0!==t.fillAlpha?t.fillAlpha:void 0!==t.alpha?t.alpha:.2,this.lineStyle=t.lineStyle||0,this.isScreenSpace=void 0===t.isScreenSpace||t.isScreenSpace}return y(e,[{key:"setFillColor",value:function(e,t,i){this.fillColor=g(e,t,i)}},{key:"setLineColor",value:function(e,t,i){this.lineColor=g(e,t,i)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.lineColor=e.lineColor,this.lineAlpha=e.lineAlpha,this.lineWidth=e.lineWidth,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.lineStyle=e.lineStyle,this.isScreenSpace=e.isScreenSpace,this}}]),e}();S.toColor=g;var k=new S,w=function(e,t){for(var i=0;i<e.length;i++)t.expandByPoint(e[i])},T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.clone();p(this,e),this.style=t,this.id=f++,this.bbox=new THREE.Box2,this.bboxDirty=!0,this.name=this.id.toString()}return y(e,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"applyMatrix4",value:function(e){return this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.style=e.style.clone(),this}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}},{key:"getBBox",value:function(){return this.updateBBox(),this.bbox}},{key:"toSVG",value:function(e,t){return o.a.toSvg(this,e,t)}},{key:"createSvgShape",value:function(e){return o.a.toSvgElement(this,e)}}],[{key:"fromSVG",value:function(e,t){return o.a.fromSvg(e,t)}}]),e}();v.GlobalManagerMixin.call(T.prototype);var P=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.clone();return p(this,t),(e=s(this,h(t).call(this,n))).loops=i?[i]:[],e.isClosed=void 0,e}return u(t,e),y(t,[{key:"getLoopCount",value:function(){return this.loops.length}},{key:"loopCount",value:function(){return this.loops.length}},{key:"isPolygon",value:function(){return this.isClosed}},{key:"isPolyline",value:function(){return!this.isClosed}},{key:"isPath",value:function(){return this instanceof _}},{key:"addPoint",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i]||(this.loops[i]=[]),o={x:e,y:t};return n.push(o),this.modified(),o}},{key:"getPoint",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(t=t||new THREE.Vector2).copy(this.loops[i][e])}},{key:"removePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.loops[t].splice(e,1)}},{key:"updatePoint",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=this.loops[n][e];o.x=t,o.y=i,this.modified()}},{key:"insertPoint",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.loops[i].splice(e,0,t)}},{key:"getVertexCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.loops[e];return t?t.length:0}},{key:"clear",value:function(){this.loops=[],this.modified()}},{key:"enumEdges",value:function(e){for(var t=this.getEdgeCount(),i=0;i<t;i++){var n=i,o=this.nextIndex(i);if(e(this.getPoint(n),this.getPoint(o),n,o))return}}},{key:"findEdgeIndex",value:function(e,t){var i=-1;return this.enumEdges((function(o,r,s){var a=n.a.isPointOnEdge(e,o,r,t);return a&&(i=s),a})),i}},{key:"move",value:function(e,t){for(var i=0;i<this.loops.length;i++)for(var n=this.loops[i],o=0;o<n.length;o++)n[o].x+=e,n[o].y+=t;return this.modified(),this}},{key:"applyMatrix4",value:function(e){for(var t=0;t<this.loops.length;t++)for(var i=this.loops[t],n=0;n<i.length;n++){var o=i[n],r=function(t,i,n){var o=x.set(t,i,0).applyMatrix4(e);return n.x=o.x,n.y=o.y,n};if(r(o.x,o.y,o),this.isBezierArc(n,t)){var s=r(o.cp1x,o.cp1y,x);o.cp1x=s.x,o.cp1y=s.y,s=r(o.cp2x,o.cp2y,x),o.cp2x=s.x,o.cp2y=s.y}this.isEllipseArc(n,t)&&o.ellipseArcParams.applyMatrix4(e)}return this.modified(),this}},{key:"addLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.loops[t],n=m(i),o=this.nextFreeLoop();return this.loops[o]=n,this.modified(),o}},{key:"copy",value:function(e){l(h(t.prototype),"copy",this).call(this,e),this.isClosed=e.isClosed,this.loops=[];for(var i=0;i<e.getLoopCount();i++)this.addLoop(e,i);return this}},{key:"computeBBox",value:function(){this.bbox.makeEmpty();for(var e=0;e<this.loops.length;e++){var t=this.loops[e];t&&w(t,this.bbox)}return this.bbox}},{key:"indexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e>=0&&e<this.getVertexCount(t)}},{key:"nextIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return-1;var i=e===this.getVertexCount(t)-1;return i?this.isClosed?0:-1:e+1}},{key:"prevIndex",value:function(e){return this.indexValid(e)?0===e?this.isClosed?this.vertexCount-1:-1:e-1:-1}},{key:"edgeBeforeVertex",value:function(e){return this.prevIndex(e)}},{key:"edgeAfterVertex",value:function(e){return this.edgeIndexValid(e)?e:-1}},{key:"nextEdgeIndex",value:function(e){return this.edgeIndexValid(e)&&(this.isClosed||e!==this.getEdgeCount()-1)?this.nextIndex(e):-1}},{key:"prevEdgeIndex",value:function(e){return this.edgeIndexValid(e)&&(this.isClosed||0!==e)?this.prevIndex(e):-1}},{key:"edgeIndexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.getEdgeCount(t);return e>=0&&e<i}},{key:"prevEdgeExists",value:function(e){return this.edgeIndexValid(e)&&this.vertexCount>2&&(e>0||this.isClosed)}},{key:"nextEdgeExists",value:function(e){var t=edgeIndex===this.vertexCount-2;return this.edgeIndexValid(edgeIndex)&&this.vertexCount>2&&(!t||this.isClosed)}},{key:"getEdge",value:function(e,t,i){var n=e,o=this.nextIndex(e);this.getPoint(n,t),this.getPoint(o,i)}},{key:"getEdgeDirection",value:function(e,t){var i=e,o=this.nextIndex(e);return t=t||new THREE.Vector2,n.a.getEdgeDirection(this.points[i],this.points[o],t)}},{key:"getEdgeLength",value:function(e){var t=e,i=this.nextIndex(e),o=this.points[t],r=this.points[i];return n.a.getEdgeLength(o,r)}},{key:"getEdgeCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.getVertexCount(e);return this.isClosed?t:t-1}},{key:"getLength",value:function(e){for(var t=new THREE.Vector2,i=new THREE.Vector2,n=0,o=0;o<this.getEdgeCount();o++)this.getEdge(o,t,i),e&&(e.apply(t),e.apply(i)),n+=t.distanceTo(i);return n}},{key:"fromBox2",value:function(e){return this.addPoint(e.min.x,e.min.y),this.addPoint(e.max.x,e.min.y),this.addPoint(e.max.x,e.max.y),this.addPoint(e.min.x,e.max.y),this}},{key:"getPointOnEdge",value:function(e,t,i){var n=i||new THREE.Vector2,o=this.points[e],r=this.points[this.nextIndex(e)];return n.lerpVectors(o,r,t)}},{key:"isCCW",value:function(){return Autodesk.Extensions.CompGeom.polygonArea(this.points)>0}},{key:"getLeftEdgeNormal",value:function(e,t){t=t||new THREE.Vector2;var i=e,n=(e+1)%this.vertexCount,o=this.points[i],r=this.points[n];t.subVectors(r,o).normalize();var s=t.x;return t.x=-t.y,t.y=s,t}},{key:"getOuterNormal",value:function(e,t){var i=this.getLeftEdgeNormal(e,t);return this.isCCW()?i.multiplyScalar(-1):i}},{key:"nextFreeLoop",value:function(){var e=this.loops.findIndex((function(e){return!e||!e.length}));return e>=0?e:this.loops.length}},{key:"points",get:function(){return this.loops[0]||(this.loops[0]=[])}},{key:"length",get:function(){return console.warn("poly.length is deprecated and will be removed. Please use poly.vertexCount property instead."),this.points.length}},{key:"vertexCount",get:function(){return this.points.length}}]),t}(T),C=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.clone();return p(this,t),(e=s(this,h(t).call(this,i,n))).isClosed=!0,e}return u(t,e),y(t,[{key:"draw",value:function(e,t){R(e,this,t)}},{key:"hitTest",value:function(e,t){if(!this.vertexCount)return!1;for(var i=0,n=0;n<this.loops.length;n++){var o=this.loops[n];if(o){for(var r=new Autodesk.Extensions.CompGeom.ComplexPolygon(o),s=[],a=0;a<o.length;a++)s.push(a);r.pointInContour(e,t,s)&&i++}}return Boolean(1&i)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"getArea",value:function(e){if(this.points.length<3)return 0;var t=0;return this.enumEdges((function(i,n){e&&e.apply(i),e&&e.apply(n),t+=i.x*n.y-n.x*i.y})),Math.abs(.5*t)}}]),t}(P),A=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.clone();return p(this,t),(e=s(this,h(t).call(this,i,n))).isClosed=!1,e}return u(t,e),y(t,[{key:"makeLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!==this.vertexCount?(this.clear(),this.addPoint(e,t),this.addPoint(i,n)):(this.updatePoint(0,e,t),this.updatePoint(1,i,n)),this}},{key:"draw",value:function(e,t){R(e,this,t)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"hitTest",value:function(e,t,i){return-1!==this.findEdgeIndex({x:e,y:t},i)}}]),t}(P),L={Line:0,Bezier:1,Ellipse:2},V=null,z=function(){return V=V||new Autodesk.Extensions.CompGeom.EllipseArc},M=new THREE.Vector2,G=function(e,t,i){var n=t.loops[i];if(n&&n.length){e.moveTo(n[0].x,n[0].y);for(var o=function(n,o,r){switch(n.arcType){case L.Line:break;case L.Bezier:return void e.bezierCurveTo(n.cp1x,n.cp1y,n.cp2x,n.cp2y,o.x,o.y);case L.Ellipse:var s=n.ellipseArcParams,a=t.exportEllipseArc(r,z(),i);if(!a.isValid())break;return void(e.ellipseArcTo?e.ellipseArcTo(s.rx,s.ry,THREE.Math.degToRad(s.rotation),s.largeArcFlag,s.sweepFlag,o.x,o.y):e.ellipse(a.cx,a.cy,a.rx,a.ry,a.rotation,a.startAngle,a.endAngle,a.ccw))}e.lineTo(o.x,o.y)},r=1;r<n.length;r+=1){o(n[r-1],n[r],r-1)}if(t.isClosed)o(n[n.length-1],n[0],n.length-1),e.closePath()}},O=function(e,t){for(var i=0;i<t.loopCount();i++)G(e,t,i)},R=function(e,t,i){if(t.vertexCount){var n=i||t.style;e.dbId=t.id,e.lineStyle=n.lineStyle,e.isScreenSpace=n.isScreenSpace,e.beginPath(),O(e,t);var o=e.canvasContext;t.isClosed&&(o.fillStyle=n.fillColor,o.globalAlpha=n.fillAlpha,e.fill()),o.strokeStyle=n.lineColor,o.globalAlpha=n.lineAlpha,o.lineWidth=n.lineWidth,n.isScreenSpace&&(o.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}},D=function(){function e(){p(this,e),this.rx=0,this.ry=0,this.rotation=0,this.largeArcFlag=!1,this.sweepFlag=!1}return y(e,[{key:"copy",value:function(e){return this.rx=e.rx,this.ry=e.ry,this.rotation=e.rotation,this.largeArcFlag=e.largeArcFlag,this.sweepFlag=e.sweepFlag,this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"rotate",value:function(e){this.rotation+=e,this.rotation-=360*Math.trunc(this.rotation/360)}},{key:"scale",value:function(e){this.rx*=e,this.ry*=e}},{key:"applyMatrix4",value:function(e){x.set(1,0,0).applyMatrix4(e),E.set(0,0,0).applyMatrix4(e);var t=x.sub(E),i=THREE.Math.radToDeg(Math.atan2(t.y,t.x)),o=t.length();this.rotate(i),this.scale(o),n.a.changesOrientation(e)&&(this.sweepFlag=!this.sweepFlag,this.rotation=360-this.rotation)}}]),e}(),_=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.clone();return p(this,t),(i=s(this,h(t).call(this,e,o))).isClosed=n,i}return u(t,e),y(t,[{key:"_updateEllipseArcParams",value:function(e,t,i){var o=this.points[e].ellipseArcParams,r=this.getEdgeDirection(e),s=n.a.getEdgeDirection(t,i),a=n.a.angleBetweenDirections(s,r);o.rotate(THREE.Math.radToDeg(a));var l=this.getEdgeLength(e),h=n.a.distance2D(t,i)/l;isFinite(h)&&h>0&&o.scale(h)}},{key:"updatePoint",value:function(e,t,i){var n=this.points[e],o=M.set(t,i),r=t-n.x,s=i-n.y;if(this.isBezierArc(e)&&(n.cp1x+=r,n.cp1y+=s),this.isEllipseArc(e)){var a=this.points[this.nextIndex(e)];this._updateEllipseArcParams(e,o,a)}var l=this.edgeBeforeVertex(e);if(this.edgeIndexValid(l)){var h=this.points[l];this.isBezierArc(l)&&(h.cp2x+=r,h.cp2y+=s),this.isEllipseArc(l)&&this._updateEllipseArcParams(l,h,o)}n.x=t,n.y=i,this.modified()}},{key:"getEdgeType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.loops[t][e].arcType;return i||L.Line}},{key:"setBezierArc",value:function(e,t,i,n,o){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=this.loops[r][e];s.arcType=L.Bezier,s.cp1x=t,s.cp1y=i,s.cp2x=n,s.cp2y=o,this.modified()}},{key:"setEllipseArc",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i][e];n.arcType=L.Ellipse,n.ellipseArcParams=t.clone(),this.modified()}},{key:"getEllipseArcParams",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i][e],o=n&&n.arcType===L.Ellipse&&n.ellipseArcParams;return o&&(t||new D).copy(o)}},{key:"exportEllipseArc",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i],o=this.nextIndex(e,i),r=n[e],s=n[o],a=r.ellipseArcParams,l=t||new EllipseArc;return l.setFromSvgArc(a.rx,a.ry,a.rotation,a.largeArcFlag,a.sweepFlag,r,s),l}},{key:"isBezierArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this.loops[t][e].arcType===L.Bezier}},{key:"isEllipseArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this.loops[t][e].arcType===L.Ellipse}},{key:"isArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.isBezierArc(e,t)||this.isEllipseArc(e,t)}},{key:"getStartTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t||new THREE.Vector2,n=this.points[e];return i.x=n.cp1x-n.x,i.y=n.cp1y-n.y,i}},{key:"getEndTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t||new THREE.Vector2,n=this.nextIndex(e),o=this.points[e],r=this.points[n];return i.x=o.cp2x-r.x,i.y=o.cp2y-r.y,i}},{key:"setStartTangent",value:function(e,t){var i=this.points[e];i.cp1x=i.x+t.x,i.cp1y=i.y+t.y,this.modified()}},{key:"setEndTangent",value:function(e,t){var i=this.points[e],n=this.points[this.nextIndex(e)];i.cp2x=n.x+t.x,i.cp2y=n.y+t.y,this.modified()}},{key:"removeArc",value:function(e){var t=this.points[e];t.arcType===L.Bezier&&(t.cp1x=void 0,t.cp1y=void 0,t.cp2x=void 0,t.cp2y=void 0),t.ellipseArcParams&&(t.ellipseArcParams=void 0),t.arcType=L.Line}},{key:"getControlPoint",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=i||new THREE.Vector2,r=this.loops[n][e];return 1===t?(o.x=r.cp1x,o.y=r.cp1y):(o.x=r.cp2x,o.y=r.cp2y),o}},{key:"updateControlPoint",value:function(e,t,i,n){var o=this.points[e];1===t?(o.cp1x=i,o.cp1y=n):(o.cp2x=i,o.cp2y=n),this.modified()}},{key:"draw",value:function(e,t){R(e,this,t)}},{key:"toPoly",value:function(){for(var e=this,t=this.isClosed?new C:new A,i=function(i){e.updateBBox();var n=e.bbox.size().length(),o={moveTo:function(e,n){return t.addPoint(e,n,i)},lineTo:function(e,n){return t.addPoint(e,n,i)},bezierCurveTo:function(e,i,r,s,a,l){var h=t.points[t.vertexCount-1];Autodesk.Extensions.CompGeom.TesselateCubic(o,h.x,h.y,e,i,r,s,a,l,n)},ellipse:function(e,t,i,r,s,a,l,h){var u=this.tessParams||Autodesk.Extensions.CompGeom.DefaultTessParams,c=u.numIterations,p=u.minSegLenFraction*n;z().set(e,t,i,r,s,a,l,h).tesselate(o,c,p)},closePath:function(){}};G(o,e,i)},n=0;n<this.loops.length;n++)i(n);return t}},{key:"computeBBox",value:function(){l(h(t.prototype),"computeBBox",this).call(this);for(var e=new THREE.Vector2,i=0;i<this.getLoopCount();i++)for(var n=0;n<this.getVertexCount(i);n++)if(this.isBezierArc(n,i))this.getControlPoint(n,1,e,i),this.bbox.expandByPoint(e),this.getControlPoint(n,2,e,i),this.bbox.expandByPoint(e);else if(this.isEllipseArc(n)){var o=this.exportEllipseArc(n,z(),i);this.bbox.union(o.computeBBox(b))}}},{key:"hitTest",value:function(e,t,i){return this.toPoly().hitTest(e,t,i)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"addLoop",value:function(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=l(h(t.prototype),"addLoop",this).call(this,e,i),o=e.loops[i],r=this.loops[n],s=0;s<o.length;s++){var a=e.getEdgeType(s,i);if(a!==L.Line){var u=o[s],c=r[s];switch(c.arcType=u.arcType,a){case L.Bezier:c.cp1x=u.cp1x,c.cp1y=u.cp1y,c.cp2x=u.cp2x,c.cp2y=u.cp2y;break;case L.Ellipse:c.ellipseArcParams=u.ellipseArcParams&&u.ellipseArcParams.clone()}}}return this}},{key:"move",value:function(e,i){l(h(t.prototype),"move",this).call(this,e,i);for(var n=0;n<this.loops.length;n++)for(var o=this.loops[n],r=0;r<o.length;r++)if(this.isBezierArc(r,n)){var s=o[r];s.cp1x+=e,s.cp1y+=i,s.cp2x+=e,s.cp2y+=i}return this.modified(),this}},{key:"getArea",value:function(e){if(this.isClosed)return this.toPoly().getArea(e)}},{key:"getLength",value:function(e){return this.toPoly().getLength(e)}},{key:"getPointOnEdge",value:function(e,i,n){switch(this.getEdgeType(e)){case L.Line:break;case L.Bezier:var o=this.points[e],r=this.points[this.nextIndex(e)],s=n||new THREE.Vector2;return Autodesk.Extensions.CompGeom.getCubeBezierPoint(i,o.x,o.y,o.cp1x,o.cp1y,o.cp2x,o.cp2y,r.x,r.y,s);case L.Ellipse:var a=this.exportEllipseArc(e,z());if(!a.isValid())break;return a.getPoint(i,n);default:avp.logger.error("unexpected edge type")}return l(h(t.prototype),"getPointOnEdge",this).call(this,e,i,n)}},{key:"runPathCommands",value:function(e){O(e,this)}}]),t}(P),B=function(e){function t(e,i){return p(this,t),s(this,h(t).call(this,e,!0,i))}return u(t,e),t}(_),I=function(e){function t(e,i){return p(this,t),s(this,h(t).call(this,e,!1,i))}return u(t,e),t}(_),H=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.clone(),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return p(this,t),(e=s(this,h(t).call(this,r))).polygon=new C([],r),e.polygon.id=e.id,e.centerX=i,e.centerY=n,e.radius=o,e.tessSegments=a,e.needsUpdate=!0,e}return u(t,e),y(t,[{key:"draw",value:function(e,t){this.polygon.points.length=0;for(var i=360/this.tessSegments,n=0;n<360;n+=i){var o=n*Math.PI/180,r=this.radius*Math.cos(o),s=this.radius*Math.sin(o);this.polygon.addPoint(this.centerX+r,this.centerY+s)}this.needsUpdate=!1,this.polygon.draw(e,t)}},{key:"setCenter",value:function(e,t){this.centerX=e,this.centerY=t,this.modified()}},{key:"move",value:function(e,t){this.centerX+=e,this.centerY+=t,this.modified()}},{key:"hitTest",value:function(e,t){var i=e-this.centerX,n=t-this.centerY;return i*i+n*n<this.radius*this.radius}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){return l(h(t.prototype),"copy",this).call(this,e),this.polygon=e.polygon.clone(),this.centerX=e.centerX,this.centerY=e.centerY,this.radius=e.radius,this.tessSegments=e.tessSegments,this.modified(),this}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}]),t}(T),j=function(e){function t(e){var i;return p(this,t),(i=s(this,h(t).call(this))).shape=e,Object.defineProperty(a(i),"bbox",{get:function(){return i.shape.bbox},set:function(e){i.shape.bbox=e}}),Object.defineProperty(a(i),"id",{get:function(){return i.shape.id},set:function(e){i.shape.id=e}}),Object.defineProperty(a(i),"bboxDirty",{get:function(){return i.shape.bboxDirty},set:function(e){i.shape.bboxDirty=e}}),Object.defineProperty(a(i),"name",{get:function(){return i.shape.name},set:function(e){i.shape.name=e}}),i}return u(t,e),y(t,[{key:"draw",value:function(){var e;return(e=this.shape).draw.apply(e,arguments)}},{key:"hitTest",value:function(){var e;return(e=this.shape).hitTest.apply(e,arguments)}},{key:"move",value:function(){var e;return(e=this.shape).move.apply(e,arguments)}},{key:"modified",value:function(){var e;return(e=this.shape).modified.apply(e,arguments)}},{key:"computeBBox",value:function(){var e;return(e=this.shape).computeBBox.apply(e,arguments)}},{key:"updateBBox",value:function(){var e;return(e=this.shape).updateBBox.apply(e,arguments)}},{key:"clone",value:function(){return new t(this.shape.clone())}},{key:"copy",value:function(e){this.shape.copy(e.shape)}}]),t}(T)},12:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var n=i(1),o=i(3);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=null,a="http://www.w3.org/2000/svg",l=Math.pow(10,4),h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||null===t)return e;var i=4===t?l:Math.pow(10,t);return Math.round(e*i)/i},u=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return'<circle cx="'.concat(h(e.centerX,t),'" cy="').concat(h(e.centerY,t),'" r="').concat(h(e.radius,t)).concat(i,'"/>')},c=function(e){for(var t,i=e.split(/ (?=[a-zA-Z])/gi),r={x:0,y:0},s=[],a=!1,l=0;l<i.length;l++){var h=i[l];if(-1==="MLHVCZA".indexOf(h[0]))throw'"'.concat(h[0],'" is not a supported or invalid glyph: ').concat(h);var u=h.substring(1);switch(h[0]){case"M":case"L":var c=u.split(",");t={x:parseFloat(c[0]),y:parseFloat(c[1])},"M"===h[0]&&s.shift();break;case"H":t={x:parseFloat(u),y:r.y};break;case"V":t={x:r.x,y:parseFloat(u)};break;case"C":var p=u.split(",");t={x:parseFloat(p[4]),y:parseFloat(p[5])},r.arcType=n.b.Bezier,r.cp1x=parseFloat(p[0]),r.cp1y=parseFloat(p[1]),r.cp2x=parseFloat(p[2]),r.cp2y=parseFloat(p[3]);break;case"A":var d=u.split(",");t={x:parseFloat(d[5]),y:parseFloat(d[6])},r.arcType=n.b.Ellipse;var y=new n.c;y.rx=parseFloat(d[0]),y.ry=parseFloat(d[1]),y.rotation=parseFloat(d[2]),y.largeArcFlag=Boolean(parseFloat(d[3])),y.sweepFlag=Boolean(parseFloat(d[4])),r.ellipseArcParams=y;break;case"Z":a=!0;continue}r=t,s.push(t)}return o.a.pointDelta(s[0],s[s.length-1],0)||s.pop(),{points:s,isPolygon:a}},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e.vertexCount)return[];var r=[];r.push("M ".concat(h(e.points[0].x,i),",").concat(h(e.points[0].y,i)));for(var s=1;s<e.points.length;s+=1){var a=e.points[s-1],l=e.points[s],u=void 0;switch(a.arcType){case n.b.Ellipse:var c=a.ellipseArcParams,p=c.largeArcFlag?1:0,d=c.sweepFlag?1:0;u="A ".concat(c.rx,",").concat(c.ry,",").concat(c.rotation,",").concat(p,",").concat(d,",").concat(l.x,",").concat(l.y);break;case n.b.Bezier:u="C ".concat(h(a.cp1x,i),",").concat(h(a.cp1y,i),",").concat(h(a.cp2x,i),",").concat(h(a.cp2y,i),",").concat(h(l.x,i),",").concat(h(l.y,i));break;default:var y=o.a.pointDelta(a,l,i);if(!y)continue;u=Math.abs(y.x)<=t?"V ".concat(h(l.y,i)):Math.abs(y.y)<=t?"H ".concat(h(l.x,i)):"L ".concat(h(l.x,i),",").concat(h(l.y,i))}r.push(u)}if(e.isClosed){var f=e.points[e.points.length-1];if(f.arcType===n.b.Bezier){var v=e.points[0],g="C ".concat(h(f.cp1x,i),",").concat(h(f.cp1y,i),",").concat(h(f.cp2x,i),",").concat(h(f.cp2y,i),",").concat(h(v.x,i),",").concat(h(v.y,i));r.push(g)}r.push("Z")}return r},d=function(e){var t={};return t.stroke=e.lineColor,t.fill=e.fillColor,t["stroke-width"]=e.lineWidth,1!=e.lineAlpha&&(t["stroke-opacity"]=e.lineAlpha),1!=e.fillAlpha&&(t["fill-opacity"]=e.fillAlpha),t},y=function(e){var t="";for(var i in e)t+=" ".concat(i,'="').concat(e[i],'"');return t},f=function(e,t){var i=t&&t.precision||0,o=t&&t.digits||0,r=t&&t.exportStyle||!0;if(e instanceof n.e){var s=document.createElementNS(a,"path");if(s.setAttribute("d",p(e,i,o)),r)!function(e,t){for(var i in t)e.setAttribute(i,t[i])}(s,d(e.style));return s}console.error("SVG serialization not supported for this shape: ",e)},v={toSvg:function(e,t){var i=t&&t.precision||0,o=t&&t.digits||null,s=t&&t.exportStyle||!1,a="";if(s){var l=d(e.style);a=y(l)}if("object"!==r(t)&&("number"==typeof arguments[1]&&(i=arguments[1]),"number"==typeof arguments[2]&&(o=arguments[2])),e instanceof n.a)return u(e,i,o,a);if(e instanceof n.e){var h=p(e,i,o);return'<path d="'.concat(h.join(" "),'"').concat(a,"/>")}console.error("SVG serialization not supported for this shape: ",e)},fromSvg:function(e,t){if(e){var i=(s=s||new DOMParser).parseFromString(e,"application/xml"),o=t&&t.forcePaths;if(1!==i.childNodes.length)throw"Function does only support svg with a single element: path, circle";var r=i.firstChild;if("circle"===r.nodeName)return function(e){if(!e.hasAttributes||!e.hasAttributes())throw"No attributes available on the <circle/> node";for(var t=new n.a,i=e.attributes.length-1;i>=0;i--){var o=e.attributes[i];switch(o.name){case"cx":t.centerX=parseFloat(o.value);break;case"cy":t.centerY=parseFloat(o.value);break;case"r":t.radius=parseFloat(o.value)}}return t}(r);if("path"===r.nodeName)return function(e,t){var i=e.getAttribute("d");if(i){var o=c(i),r=o.points,s=o.isPolygon;return t||r.find((function(e){return void 0!==e.arcType}))?new n.d(r,s):s?new n.f(r):new n.h(r)}}(r,o);throw"Unsupported svg node type: ".concat(r.nodeName)}},createSvgShape:f,createSvgElement:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new THREE.Box2;e.forEach((function(e){return i.union(e.getBBox())}));var n=t.srcBox||i,r=t.dstBox||i,s={preserveAspect:!0,flipY:!0},l=o.a.getFitToBoxTransform(n,r,s),h=r.max.x-r.min.x,u=r.max.y-r.min.y,c=document.createElementNS(a,"svg");return c.setAttribute("height",h),c.setAttribute("width",u),e.forEach((function(e){var i=e.clone().applyMatrix4(l),n=f(i,t);c.appendChild(n)})),c}}},3:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n,o=new THREE.Vector2,r=new THREE.Vector2,s=function(e,t,i){var n=(e.x-t.x)*i.x+(e.y-t.y)*i.y;e.set(t.x+n*i.x,t.y+n*i.y)},a=(n=new THREE.Vector2,function(e,t,i){return s(n.copy(e),t,i),e.distanceTo(n)}),l=function(e,t,i,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=i.x-t.x,s=i.y-t.y,a=Math.sqrt(r*r+s*s),l={v1:t,dx:r,dy:s,length:a,length2:a*a};return Autodesk.Extensions.CompGeom.pointOnLine(e.x,e.y,l,o,n)},h=function(e,t,i){return Math.abs(e-t)<i},u={getEdgeDirection:function(e,t,i){return(i=i||new THREE.Vector2).copy(t).sub(e).normalize()},projectToLine:s,pointLineDistance:a,intersectLines:function(e,t,i,n,o){var r=n.y*t.x-n.x*t.y;if(Math.abs(r)<1e-8)return!1;var s=e.x-i.x,a=e.y-i.y,l=n.x*a-n.y*s;return o&&(o.x=e.x+l/r*t.x,o.y=e.y+l/r*t.y),!0},rotateAround:function(e,t,i){var n=Math.cos(t),o=Math.sin(t);i&&e.sub(i);var r=e.x,s=e.y;return e.x=r*n-s*o,e.y=r*o+s*n,i&&e.add(i),e},angleBetweenDirections:function(e,t){var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i+=2*Math.PI),i},getEdgeCenter:function(e,t,i){return(i=i||new THREE.Vector2).set(.5*(e.x+t.x),.5*(e.y+t.y))},getEdgeLength:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},turnLeft:function(e){var t=e.x;return e.x=-e.y,e.y=t,e},isPointOnEdge:l,isPointOnLine:function(e,t,i,n){return l(e,t,i,n,!1)},pointDelta:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={x:t.x-e.x,y:t.y-e.y};if(i){var o=Math.pow(10,i);n.x=Math.round(n.x*o)/o,n.y=Math.round(n.y*o)/o}if(n.x||n.y)return n},edgeIsDegenerated:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10;return e.distanceToSquared(t)<i},mirrorPointOnPoint:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(i=i||new THREE.Vector2).x=t.x-(e.x-t.x),i.y=t.y-(e.y-t.y),i},fuzzyEqual:h,collinear:function(e,t,i,n,o){var r=h(t.x,n.x,o)&&h(t.y,n.y,o),s=h(t.x,-n.x,o)&&h(t.y,-n.y,o);if(!r&&!s)return!1;var a=i.x-e.x,l=i.y-e.y,u=a*t.x+l*t.y;return Math.abs(u)<o},distance2D:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},changesOrientation:function(e){return e.determinant()<0},getFitToBoxTransform:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Matrix4,s=e.size(o),a=t.size(r),l=a.x/s.x,h=a.y/s.y;i.preserveAspect&&(h=l=Math.min(l,h));var u=e.min.x,c=e.min.y;i.flipY&&(h*=-1,c=e.max.y);var p=-l*u+t.min.x,d=-h*c+t.min.y,y=n.makeScale(l,h,1);return y.elements[12]=p,y.elements[13]=d,y}}},353:function(e,t,i){var n=i(354);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(5)(n,o);n.locals&&(e.exports=n.locals)},354:function(e,t,i){(e.exports=i(4)(!1)).push([e.i,".adsk-viewing-viewer .edge-gizmo:hover{background-color:lime}.adsk-viewing-viewer .edge-gizmo{position:absolute;background-color:#009bff;box-shadow:0px 1px 3px 1px rgba(0,0,0,0.25);border-radius:8px;cursor:move;z-index:1;-webkit-tap-highlight-color:rgba(0,0,0,0)}.adsk-viewing-viewer .edge-gizmo.selected{background-color:lime}.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover{border-color:lime}.adsk-viewing-viewer .vertex-gizmo{display:inline-block;position:absolute;width:7px;height:7px;left:-2px;top:-2px;background-color:#009bff;border-style:solid;border-width:2px;border-color:#FFFFFF;border-radius:100px;box-shadow:0 2px 5px 0 #182A3D;z-index:1;cursor:move}.adsk-viewing-viewer .ellipse-arc-gizmo{display:inline-block;position:absolute;width:5px;height:5px;left:-1px;top:-1px;background-color:#ff00ff;border-style:solid;border-width:1px;border-color:#000000;border-radius:100px;box-shadow:0 2px 5px 0 #182A3D;z-index:2;cursor:move}.adsk-viewing-viewer .vertex-gizmo.selected{border-color:lime}.adsk-viewing-viewer .edge-move-gizmo{width:20px;height:6px}\n",""])},4:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var o=(s=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=n.sources.map((function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"}));return[i].concat(r).concat([o]).join("\n")}var s;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&n[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),t.push(s))}},t}},5:function(e,t,i){var n,o,r={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,i){if("function"==typeof e)return e();if(void 0===t[e]){var n=a.call(this,e,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),h=null,u=0,c=[],p=i(6);function d(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=r[n.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](n.parts[s]);for(;s<n.parts.length;s++)o.parts.push(x(n.parts[s],t))}else{var a=[];for(s=0;s<n.parts.length;s++)a.push(x(n.parts[s],t));r[n.id]={id:n.id,refs:1,parts:a}}}}function y(e,t){for(var i=[],n={},o=0;o<e.length;o++){var r=e[o],s=t.base?r[0]+t.base:r[0],a={css:r[1],media:r[2],sourceMap:r[3]};n[s]?n[s].parts.push(a):i.push(n[s]={id:s,parts:[a]})}return i}function f(e,t){var i=l(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),c.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,i);i.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=c.indexOf(e);t>=0&&c.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=function(){0;return i.nc}();n&&(e.attrs.nonce=n)}return m(t,e.attrs),f(e,t),t}function m(e,t){Object.keys(t).forEach((function(i){e.setAttribute(i,t[i])}))}function x(e,t){var i,n,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var s=u++;i=h||(h=g(t)),n=S.bind(null,i,s,!1),o=S.bind(null,i,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),f(e,t),t}(t),n=w.bind(null,i,t),o=function(){v(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(t),n=k.bind(null,i),o=function(){v(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=y(e,t);return d(i,t),function(e){for(var n=[],o=0;o<i.length;o++){var s=i[o];(a=r[s.id]).refs--,n.push(a)}e&&d(y(e,t),t);for(o=0;o<n.length;o++){var a;if(0===(a=n[o]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete r[a.id]}}}};var E,b=(E=[],function(e,t){return E[e]=t,E.filter(Boolean).join("\n")});function S(e,t,i,n){var o=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=b(t,o);else{var r=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function k(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function w(e,t,i){var n=i.css,o=i.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(n=p(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([n],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},573:function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var o=1,r=Autodesk.Viewing,s=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r.EventDispatcher.prototype.apply(this),this.scene=new THREE.Scene,this.shapes=[],this.canvasGizmos=[],this.id=o++;this.context=new Autodesk.Extensions.CompGeom.LmvCanvasContext({width:0,height:0},1,this._processMesh.bind(this),null),this.context.addContextCurrentTransform(),this.viewer=t,this.setGlobalManager(t.globalManager),this.autoUpdate=!0,this.toPageUnits=1,this.styleModifiers=[],this.onCameraChange=function(){return i.updateCanvasGizmos()},this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.context.setTessParams({numIterations:100,minSegLenFraction:.01}),this.layerToWorld=new THREE.Matrix4,this.worldToLayer=new THREE.Matrix4,this.tmp_pWorld=new THREE.Vector3,this.tmp_p0=new THREE.Vector2,this.tmp_p1=new THREE.Vector2,this.tmp_ray=new THREE.Ray,this.tmp_box=new THREE.Box2,this.is3d=!1,this.plane=new THREE.Plane,this._updatePlane()}var t,i,s;return t=e,(i=[{key:"dtor",value:function(){this._clearScene(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange)}},{key:"addShape",value:function(t){this.shapes.push(t),this.dispatchEvent({type:e.SHAPE_ADDED,shape:t}),this._onModified()}},{key:"addShapes",value:function(e){var t=this;e.forEach((function(e){return t.addShape(e)}))}},{key:"removeShape",value:function(t){var i=this.shapes.indexOf(t);return-1!==i&&(this.shapes.splice(i,1),this.dispatchEvent({type:e.SHAPE_REMOVED,shape:t}),this._onModified(),!0)}},{key:"clear",value:function(){this.shapes.length=0,this.dispatchEvent({type:e.LAYER_CLEARED}),this._onModified()}},{key:"update",value:function(){this._clearScene();for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e],i=this._getOverrideStyle(t);t.draw(this.context,i)}this.context.flushBuffer(0,!0),this.viewer.impl.invalidate(!1,!1,!0),this.updateCanvasGizmos()}},{key:"updateCanvasGizmos",value:function(){for(var e=0;e<this.canvasGizmos.length;e++)this.canvasGizmos[e].update()}},{key:"addCanvasGizmo",value:function(e){this.canvasGizmos.push(e)}},{key:"removeCanvasGizmo",value:function(e){var t=this.canvasGizmos.indexOf(e);return-1!==t&&(this.canvasGizmos.splice(t,1),!0)}},{key:"getViewport",value:function(){return this.viewport}},{key:"hitTest",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.shapes.length-1;n>=0;n--){var o=this.shapes[n],r=this.getLineHitRadius(o,i),s=this.tmp_box.makeEmpty();if(s.min.set(e-r,t-r),s.max.set(e+r,t+r),o.updateBBox(),o.bbox.isIntersectionBox(s)&&o.hitTest(e,t,r))return o}}},{key:"getLineHitRadius",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=this.getUnitsPerPixel(),n=(e.style.isScreenSpace?i:1)*e.style.lineWidth;return Math.max(n,t*i)}},{key:"addStyleModifier",value:function(e){this.styleModifiers.push(e),this._onModified()}},{key:"removeStyleModifier",value:function(e){var t=this.styleModifiers.indexOf(e);return-1!=t&&(this.styleModifiers.splice(t,1),this._onModified(),!0)}},{key:"layerToCanvas",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,n=this.tmp_pWorld.set(e,t,0).applyMatrix4(this.layerToWorld),o=this.viewer.impl.worldToClient(n);return i.set(o.x,o.y,0)}},{key:"getPixelsPerUnit",value:function(){var e=this.getWindow(),t=this.layerToCanvas(0,0,this.tmp_p0),i=this.layerToCanvas(1,0,this.tmp_p1);return t.distanceTo(i)/e.devicePixelRatio}},{key:"getUnitsPerPixel",value:function(){return 1/this.getPixelsPerUnit()}},{key:"canvasToLayer",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,n=this.viewer.impl.clientToViewport(e,t),o=this.viewer.impl.viewportToRay(n,this.tmp_ray),r=o.intersectPlane(this.plane,this.tmp_pWorld);return r?(r.applyMatrix4(this.worldToLayer),i.set(r.x,r.y,0)):i.set(0,0)}},{key:"enumShapes",value:function(e,t){for(var i=0;i<this.shapes.length;i++){var n=this.shapes[i];n.updateBBox(),e.isIntersectionBox(n.bbox)&&t(n)}}},{key:"enumMeshes",value:function(e,t){for(var i=0;i<this.scene.children.length;i++){var n=this.scene.children[i],o=n.geometry.boundingBox;e.isIntersectionBox(o)&&t(n)}}},{key:"findShapeById",value:function(e){return this.shapes.find((function(t){return t.id==e}))}},{key:"setMatrix",value:function(e){this.layerToWorld.copy(e),this.worldToLayer.getInverse(e),this._updatePlane()}},{key:"_processMesh",value:function(e){var t={mesh:e,is2d:!0,packId:"0",meshIndex:0};Autodesk.Viewing.Private.BufferGeometryUtils.meshToGeometry(t);var i=t.geometry,n=this.viewer.impl.getMaterials(),o=n.create2DMaterial(null,e.material),r=n.findMaterial(null,o),s=new THREE.Mesh(i,r);s.matrix=this.layerToWorld,s.matrixAutoUpdate=!1,this.scene.children.push(s)}},{key:"_onModified",value:function(){this.autoUpdate&&this.update()}},{key:"_getOverrideStyle",value:function(e){for(var t=e.style,i=0;i<this.styleModifiers.length;i++)t=(0,this.styleModifiers[i])(e,t)||t;return t}},{key:"_clearScene",value:function(){for(var e=this.scene.children,t=0;t<e.length;t++)e[t].geometry.dispose();this.scene.children.length=0}},{key:"_updatePlane",value:function(){this.plane.normal.set(0,0,1),this.plane.constant=0,this.plane.applyMatrix4(this.layerToWorld)}}])&&n(t.prototype,i),s&&n(t,s),e}();r.GlobalManagerMixin.call(s.prototype),s.SHAPE_ADDED="shapeAdded",s.SHAPE_REMOVED="shapeRemoved",s.LAYER_CLEARED="layerCleared";var a=i(1);function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=Autodesk.Viewing,u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h.EventDispatcher.prototype.apply(this),this.stack=[],this.current=0}var t,i,n;return t=e,(i=[{key:"run",value:function(t){this.stack.length=this.current,this.dispatchEvent({type:e.BEFORE_ACTION,action:t}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t}),this.stack.push(t),this.current=this.stack.length}},{key:"undo",value:function(){if(!this.current)return!1;this.current--;var t=this.stack[this.current];return this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!0}),t.undo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!0}),t.layer.update(),!0}},{key:"redo",value:function(){var t=this.stack[this.current];return!!t&&(this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!1}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!1}),this.current++,t.layer.update(),!0)}},{key:"clear",value:function(){this.stack.length=0,this.current=0}}])&&l(t.prototype,i),n&&l(t,n),e}();function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}u.BEFORE_ACTION="beforeAction",u.AFTER_ACTION="afterAction";var p=Autodesk.Viewing,d=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p.EventDispatcher.prototype.apply(this),this.isSelected={},this.hoveredId=0,this.tmpStyle=new a.l,this.modifier=function(e,t){var i=n.isSelected[e.id],o=e.id===n.hoveredId;if(i||o)return n.tmpStyle.copy(t),i?(n.tmpStyle.fillAlpha=Math.min(n.tmpStyle.fillAlpha+.3,1),n.tmpStyle.lineWidth*=1.5):(n.tmpStyle.fillAlpha=Math.min(n.tmpStyle.fillAlpha+.2,1),n.tmpStyle.lineWidth*=1.5),n.tmpStyle},this.layer=t,this.onShapeRemoved=this.onShapeRemoved.bind(this),this.onLayerCleared=this.onLayerCleared.bind(this),this.layer.addEventListener(s.SHAPE_REMOVED,this.onShapeRemoved),this.layer.addEventListener(s.LAYER_CLEARED,this.onLayerCleared),this.layer.addStyleModifier(this.modifier),this.undoStack=i,this.onActionCb=function(e){return n.onAction(e)},this.undoStack.addEventListener(u.AFTER_ACTION,this.onActionCb)}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.layer.removeStyleModifier(this.modifier),this.undoStack.removeEventListener(u.AFTER_ACTION,this.onActionCb),this.undoStack.removeEventListener(s.SHAPE_REMOVED,this.onShapeRemoved),this.undoStack.removeEventListener(s.LAYER_CLEARED,this.onLayerCleared)}},{key:"setSelection",value:function(e){e=e||[];var t=!1;if(this.getSelectedShapes().length!=e.length)t=!0;else for(var i=0;i<e.length;i++){var n=e[i];this.isSelected[n.id]||(t=!0)}if(t){this.isSelected={};for(var o=0;o<e.length;o++){var r=e[o];this.isSelected[r.id]=r}this.modified()}}},{key:"empty",value:function(){return!Object.keys(this.isSelected).length}},{key:"selectOnly",value:function(e){this.setSelection(e&&[e])}},{key:"clear",value:function(){this.setSelection([])}},{key:"getSelectedShapes",value:function(){return Object.values(this.isSelected)}},{key:"getSelectedIds",value:function(){return Object.keys(this.isSelected)}},{key:"modified",value:function(){this.layer.update(),this.dispatchEvent({type:e.Events.SELECTION_CHANGED})}},{key:"onAction",value:function(){if(!this.empty()){var e=this.getSelectedShapes();if(1!=e.length){var t={};this.layer.shapes.forEach((function(e){return t[e.id]=!0})),e=e.filter((function(e){return t[e.id]})),this.setSelection(e)}else this.layer.findShapeById(e[0].id)||this.clear()}}},{key:"onShapeRemoved",value:function(e){var t=e.shape;this.empty()||this.isSelected[t.id]&&(delete this.isSelected[t.id],this.modified())}},{key:"onLayerCleared",value:function(){this.empty()||this.clear()}},{key:"setHoveredId",value:function(t){t!==this.hoveredId&&(this.hoveredId=t,this.layer.update(),this.dispatchEvent({type:e.Events.SELECTION_HOVER_CHANGED}))}},{key:"getFirstSelected",value:function(){var e=this.getSelectedShapes();return e.length?e[0]:null}}])&&c(t.prototype,i),n&&c(t,n),e}();d.Events={SELECTION_CHANGED:"selectionChanged",SELECTION_HOVER_CHANGED:"selectionHoverChanged"};var y=i(3),f=i(12),v=new THREE.Vector3,g=new THREE.Vector3,m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new THREE.Vector3;return t.set(e[0],e[1],e[2])},x=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.getVertexCount(i);if(0==o){var r=t.getStartVertex().getPosition();e.addPoint(r[0],r[1],i)}if(!n){var s=t.getEndVertex().getPosition();e.addPoint(s[0],s[1],i)}var l=t instanceof SolidDef.Coedge,h=l?t.getEdge():t,u=!!l&&t.isReversed(),c=h.isReversed(),p=u!==c,d=h.getCurveType();if(d!==SolidDef.GEOMETRY_TYPES.LINE){var y=Math.max(o-1,0),f=h.getCurve();if(d!==SolidDef.GEOMETRY_TYPES.BCURVE){if(d===SolidDef.GEOMETRY_TYPES.ELLIPSE){var x=new a.c;x.rx=f.getMajorRadius(),x.ry=f.getMinorRadius();var E=f.getMajorAxis(),b=Math.atan2(E[1],E[0]);x.rotation=THREE.Math.radToDeg(b);var S=f.getRange(),k=S[0],w=S[1];x.largeArcFlag=w-k>Math.PI,x.sweepFlag=!p;var T=f.getMinorAxis(),P=m(E,v),C=m(T,g),A=P.cross(C).z<0;return A&&(x.sweepFlag=!x.sweepFlag),void e.setEllipseArc(y,x,i)}console.error("Unexpected curve type")}else{var L=t.t0(),V=t.t1(),z=t.evaluatePosition(L),M=t.evaluatePosition(V),G=t.evaluateDt(L),O=t.evaluateDt(V),R=Math.abs(V-L);G[0]*=R,G[1]*=R,O[0]*=R,O[1]*=R;var D=z[0]+G[0]/3,_=z[1]+G[1]/3,B=M[0]-O[0]/3,I=M[1]-O[1]/3;e.setBezierArc(y,D,_,B,I,i)}}},E=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.g,i=t.nextFreeLoop(),n=e.getCoedges(),o=0;o<n.length;o++){var r=n[o],s=o==n.length-1;x(t,r,i,s)}return t},b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.g;return e.getLoops().forEach((function(e){t=E(e,t)})),t},S=function(e){var t=new a.d;t.isClosed=e.isClosed();for(var i=e.getOrderedEdges().edges,n=0;n<i.length;n++){var o=i[n],r=e.isClosed()&&n==i.length-1;x(t,o,0,r)}return t},k={addCoedge:x,loopToShape:E,faceToShape:b,facesToShape:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.g;return e.forEach((function(e){t=b(e,t)})),t},wireToShape:S,pathToShape:function(e){var t=e.getWireBody().getWires();if(0==t.length)return new a.d;for(var i=S(t[0]),n=1;n<t.length;n++){var o=t[n],r=S(o);i.addLoop(r,0)}return i},toSolidDefPath:function(e){var t=new SolidDef.Path2D;return e.runPathCommands(t),t}},w={Intersect:1,Union:2,Difference:3,Xor:4},T=function(e,t){var i=e.getFaces();i.forEach((function(e){return e.rank=0})),t.getWires().forEach((function(t){var i=t.getEdges();(function(e,t){var i=e.getFaces(),n=SolidDef.getRegionEdges(e,t);return SolidDef.getBoundedRegionFaces(i,n)})(e,i).forEach((function(e){return e.rank++}))}));return i.filter((function(e){return Boolean(1&e.rank)}))},P={Operator:w,apply:function(e,t,i){var n=function(e,t,i){var n=e.getWireBody(),o=t.getWireBody(),r=n.getEdges(),s=o.getEdges(),a=r.concat(s),l=new SolidDef.SketchRegionSolver;l.compute(a);var h=l.getFaces(),u=T(l,n),c=T(l,o),p=h.filter((function(e,t){var n=u.includes(e),o=c.includes(e);switch(i){case w.Intersect:return n&&o;case w.Union:return!0;case w.Difference:return n&&!o;case w.Xor:return n!==o}}));return SolidDef.mergeConnectedFaces(p)}(k.toSolidDefPath(e),k.toSolidDefPath(t),i);return k.facesToShape(n)}};function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function O(e,t,i){return t&&G(e.prototype,t),i&&G(e,i),e}var R=function(){function e(t){M(this,e),this.layer=t}return O(e,[{key:"undo",value:function(){throw new Error("Abstract method invoked")}},{key:"redo",value:function(){throw new Error("Abstract method invoked")}}]),e}(),D=function(e,t){if(!e.isPath()||!e.edgeIndexValid(t))return null;switch(e.getEdgeType(t)){case a.b.Ellipse:return e.getEllipseArcParams(t);case a.b.Bezier:return{cp1:e.getControlPoint(t,1),cp2:e.getControlPoint(t,2)};case a.b.Line:return null;default:console.warn("unexpected edge type")}},_=function(e,t,i){if(i)if(i instanceof a.c)e.setEllipseArc(t,i);else if(i.cp1){var n=i.cp1,o=i.cp2;e.setBezierArc(t,n.x,n.y,o.x,o.y)}},B={Action:R,AddShape:function(e){function t(e,i){var n;return M(this,t),(n=A(this,L(t).call(this,e))).shape=i,n}return V(t,e),O(t,[{key:"undo",value:function(){this.layer.removeShape(this.shape)}},{key:"redo",value:function(){this.layer.addShape(this.shape)}}]),t}(R),AddShapes:function(e){function t(e,i){var n;return M(this,t),(n=A(this,L(t).call(this,e))).shapes=i,n}return V(t,e),O(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}}]),t}(R),MoveShape:function(e){function t(e,i,n,o){var r;return M(this,t),(r=A(this,L(t).call(this,e))).shape=i,r.delta={x:n,y:o},r.beforeState=r.shape.clone(),r.afterState=r.shape.clone(),r.afterState.move(n,o),r}return V(t,e),O(t,[{key:"undo",value:function(){this.shape.copy(this.beforeState)}},{key:"redo",value:function(){this.shape.copy(this.afterState)}}]),t}(R),RemoveShape:function(e){function t(e,i){var n;return M(this,t),(n=A(this,L(t).call(this,e))).shape=i,n}return V(t,e),O(t,[{key:"undo",value:function(){this.layer.addShape(this.shape)}},{key:"redo",value:function(){this.layer.removeShape(this.shape)}}]),t}(R),RemoveShapes:function(e){function t(e,i){var n;return M(this,t),(n=A(this,L(t).call(this,e))).shapes=i.slice(),n}return V(t,e),O(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}}]),t}(R),AddVertex:function(e){function t(e,i,n,o){var r;return M(this,t),(r=A(this,L(t).call(this,e))).poly=i,r.vIndex=n,r.point=o.clone(),r}return V(t,e),O(t,[{key:"undo",value:function(){this.poly.removePoint(this.vIndex)}},{key:"redo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}}]),t}(R),MoveVertex:function(e){function t(e,i,n,o){var r;return M(this,t),(r=A(this,L(t).call(this,e))).poly=i,r.vIndex=n,r.posBefore=i.getPoint(n),r.posAfter=o.clone(),r}return V(t,e),O(t,[{key:"undo",value:function(){this.poly.updatePoint(this.vIndex,this.posBefore.x,this.posBefore.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.vIndex,this.posAfter.x,this.posAfter.y)}}]),t}(R),RemoveVertex:function(e){function t(e,i,n){var o;return M(this,t),(o=A(this,L(t).call(this,e))).poly=i,o.vIndex=n,o.point=i.getPoint(n),o.arcBefore=D(i,i.edgeBeforeVertex(n)),o.arcAfter=D(i,i.edgeAfterVertex(n)),o}return V(t,e),O(t,[{key:"undo",value:function(){this.poly.insertPoint(this.vIndex,this.point),_(this.poly,this.poly.edgeBeforeVertex(this.vIndex),this.arcBefore),_(this.poly,this.poly.edgeAfterVertex(this.vIndex),this.arcAfter)}},{key:"redo",value:function(){this.poly.isPath()&&(this.poly.removeArc(this.poly.edgeBeforeVertex(this.vIndex)),this.poly.removeArc(this.poly.edgeAfterVertex(this.vIndex))),this.poly.removePoint(this.vIndex)}}]),t}(R),MoveEdge:function(e){function t(e,i,n,o,r,s,a){var l;M(this,t),(l=A(this,L(t).call(this,e))).poly=i,l.edgeIndex=n,l.duplicateStartVertex=s,l.duplicateEndVertex=a;var h=n,u=i.nextIndex(h),c=i.getPoint(h),p=i.getPoint(u);return l.edgeBefore={a:c,b:p},l.edgeAfter={a:o.clone(),b:r.clone()},l}return V(t,e),O(t,[{key:"undo",value:function(){var e=t.getNewEdgeIndex(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex),i=this.poly.nextIndex(e);this.poly.updatePoint(e,this.edgeBefore.a.x,this.edgeBefore.a.y),this.poly.updatePoint(i,this.edgeBefore.b.x,this.edgeBefore.b.y),t.revertDuplicateVertices(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex)}},{key:"redo",value:function(){t.duplicateVertices(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex);var e=t.getNewEdgeIndex(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex),i=this.poly.nextIndex(e);this.poly.updatePoint(e,this.edgeAfter.a.x,this.edgeAfter.a.y),this.poly.updatePoint(i,this.edgeAfter.b.x,this.edgeAfter.b.y)}}],[{key:"duplicateVertex",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e.getPoint(t,null,i);e.insertPoint(t,{x:n.x,y:n.y})}},{key:"duplicateVertices",value:function(e,i,n,o){var r=i;if(n&&(t.duplicateVertex(e,r),r++),o){var s=e.nextIndex(r);t.duplicateVertex(e,s)}}},{key:"revertDuplicateVertices",value:function(e,i,n,o){var r=t.getNewEdgeIndex(e,i,n,o);if(n){var s=r-1;e.removePoint(s),r--}if(o){var a=e.nextIndex(r);e.removePoint(a)}}},{key:"getNewEdgeIndex",value:function(e,t,i,n){var o=t;i&&o++;var r=e.vertexCount-(i?1:0)-(n?1:0);return n&&t===r-1&&o++,o}}]),t}(R),ChangeEdgeType:function(e){function t(e,i,n,o,r,s,a){var l;M(this,t),(l=A(this,L(t).call(this,e))).path=i,l.edgeIndex=n;var h=i.isBezierArc(n);return l.oldEdgeType=i.getEdgeType(n),l.oldCp1=h&&i.getControlPoint(n,1),l.oldCp2=h&&i.getControlPoint(n,2),l.oldEllipseArcParams=i.getEllipseArcParams(n),l.newEdgeType=o,l.newCp1=r,l.newCp2=s,l.newEllipseArcParams=a,l}return V(t,e),O(t,[{key:"redo",value:function(){switch(this.newEdgeType){case a.b.Line:this.path.removeArc(this.edgeIndex);break;case a.b.Ellipse:this.path.setEllipseArc(this.edgeIndex,this.newEllipseArcParams);break;case a.b.Bezier:this.path.setBezierArc(this.edgeIndex,this.newCp1.x,this.newCp1.y,this.newCp2.x,this.newCp2.y)}}},{key:"undo",value:function(){switch(this.oldEdgeType){case a.b.Line:this.path.removeArc(this.edgeIndex);break;case a.b.Bezier:this.path.setBezierArc(this.edgeIndex,this.oldCp1.x,this.oldCp1.y,this.oldCp2.x,this.oldCp2.y);break;case a.b.Ellipse:this.path.setEllipseArc(this.edgeIndex,this.oldEllipseArcParams)}}}]),t}(R),ApplyCutOut:function(e){function t(e,i){var n;M(this,t),n=A(this,L(t).call(this,e));var o=i.getBBox();return n.paths=e.shapes.filter((function(e){if(e===i)return!1;if(!(e instanceof a.e&&e.isClosed))return!1;var t=e.getBBox();return o.isIntersectionBox(t)})),n.clippedPaths=n.paths.map((function(e){return P.apply(e,i,P.Operator.Difference)})),n.originalShapes=n.paths.map((function(e){return e.clone()})),n}return V(t,e),O(t,[{key:"redo",value:function(){var e=this;this.paths.forEach((function(t,i){return t.copy(e.clippedPaths[i])})),this.layer.update()}},{key:"undo",value:function(){var e=this;this.paths.forEach((function(t,i){return t.copy(e.originalShapes[i])}))}}]),t}(R)};function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function j(e,t,i){return t&&H(e.prototype,t),i&&H(e,i),e}var N=function(){function e(t,i){I(this,e),this.a=t.clone(),this.b=i.clone(),this.dir=y.a.getEdgeDirection(t,i)}return j(e,[{key:"intersect",value:function(e,t){return y.a.intersectLines(this.a,this.dir,e.a,e.dir,t)}},{key:"snapToLine",value:function(e){y.a.projectToLine(e,this.a,this.dir)}},{key:"isUsable",value:function(e,t){return y.a.pointLineDistance(e,this.a,this.dir)<t}},{key:"isEqual",value:function(e,t){return y.a.collinear(this.a,this.dir,e.a,e.dir,t)}}]),e}(),U=function(e,t,i){(t||i)&&(i?t?t.intersect(i,e):i.snapToLine(e):t.snapToLine(e))},F=function(e,t){return t=(t+e.vertexCount)%e.vertexCount,e.getPoint(t)},K=function(e,t){var i=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,r=[];return e.enumEdges((function(e,s,a,l){a!=t&&l!=t&&(y.a.edgeIsDegenerated(e,s)||function(e,t){r.push(new N(e,t)),i=y.a.turnLeft(y.a.getEdgeDirection(e,t,i)),n=y.a.getEdgeCenter(e,t,n),o.copy(e).add(i),r.push(new N(e,o)),o.copy(n).add(i),r.push(new N(n,o)),o.copy(t).add(i),r.push(new N(t,o))}(e,s))})),r},Y=function(e,t,i,n,o){var r=new THREE.Vector2;return i.intersect(e,r)?r.distanceTo(n)>o?t:t?Math.abs(i.dir.dot(e.dir))>Math.abs(i.dir.dot(t.dir))?e:t:e:t},W=new THREE.Vector2(1,0),X=Autodesk.Viewing,q=function(){function e(t){I(this,e),this.poly=null,this.vIndex=-1,this.snapAngles=[0,45,90,135,180,225,270,315,360],this.snapAngleTolerance=2,this.snapRadius=10,this.gizmoLayer=t,this.setGlobalManager(t.globalManager),this.movedPoint=new THREE.Vector2,this.prevPoint=new THREE.Vector2,this.prevPoint2=new THREE.Vector2,this.edgeDir=new THREE.Vector2,this.alignAxis=new THREE.Vector2,this.edgeSnapLines=[],this.snapLine1=null,this.snapLine2=null,this.snapLineExt=null,this.snapLineStyle=new a.l({lineColor:"rgb(255, 0, 0)",lineWidth:1,lineStyle:10}),this.snapLineGizmos=[],this.snapLineGizmosUsed=0}return j(e,[{key:"onSetGlobalManager",value:function(e){this.globalManager=e,this.snapLineGizmos.forEach((function(t){return t.setGloblaManager(e)}))}},{key:"acquireSnapLineGizmo",value:function(){var e=this.snapLineGizmos[this.snapLineGizmosUsed];return e||((e=new a.h([],this.snapLineStyle)).setGlobalManager(this.globalManager),this.snapLineGizmos[this.snapLineGizmosUsed]=e),this.snapLineGizmosUsed++,e}},{key:"clearSnappingGizmos",value:function(){var e=this;this.snapLineGizmos.forEach((function(t){return e.gizmoLayer.removeShape(t)})),this.snapLineGizmosUsed=0}},{key:"startSnapping",value:function(e,t){this.poly=e,this.vIndex=t,this.edgeSnapLines=K(e,t)}},{key:"stopSnapping",value:function(){this.poly=null,this.vIndex=-1,this.snapLine1=null,this.snapLine2=null,this.clearSnappingGizmos()}},{key:"clearSnappingResult",value:function(){this.snapLine1=null,this.snapLine2=null}},{key:"getPrevSnapLine",value:function(e){var t=F(this.poly,this.vIndex-1),i=F(this.poly,this.vIndex-2),n=y.a.getEdgeDirection(i,t);return this.computeAngleSnapLine(e,t,n)}},{key:"getNextSnapLine",value:function(e){if(this.poly.isPolyline()&&this.vIndex>=this.poly.vertexCount-2)return null;var t=F(this.poly,this.vIndex+1),i=F(this.poly,this.vIndex+2),n=y.a.getEdgeDirection(t,i,n);return this.computeAngleSnapLine(e,t,n)}},{key:"snapToAngle",value:function(e,t){var i=this;if(this.snapLine1=null,this.snapLine2=null,this.snapLineExt=t&&new N(t.a,t.b),this.active&&!(this.poly.vertexCount<=1)){var n=F(this.poly,this.vIndex-1);if(2==this.poly.vertexCount){var o=this.computeAngleSnapLine(e,n,W);return o&&this.snapLineExt?this.snapLine1=Y(o,null,this.snapLineExt,e,a):this.snapLine1=o,void U(e,this.snapLine1,this.snapLineExt)}var r=this.getPrevSnapLine(e),s=this.getNextSnapLine(e),a=this.snapRadius*this.gizmoLayer.getUnitsPerPixel(),l=function(t){return!!t&&(i.snapLineExt?Boolean(Y(t,null,i.snapLineExt,e,a)):t.isUsable(e,a))},h=this.edgeSnapLines.filter(l);if(r=l(r)&&r,s=l(s)&&s,this.snapLine1=r||s||h[0],this.snapLine1){if(this.snapLineExt)return U(e,this.snapLine1,this.snapLineExt);if(r&&s&&(this.snapLine2=Y(s,null,this.snapLine1,e,a)),!this.snapLine2)for(var u=0;u<h.length;u++){var c=h[u];this.snapLine2=Y(c,this.snapLine2,this.snapLine1,e,a)}return U(e,this.snapLine1,this.snapLine2)}}}},{key:"isSnapped",value:function(){return Boolean(this.snapLine1||this.snapLine2)}},{key:"updateSnapLineGizmos",value:function(e){var t=this;if(this.clearSnappingGizmos(),this.poly){var i=[],n=function(t){return t&&t.isUsable(e,1e-4)};if(2==this.poly.vertexCount){var o=F(this.poly,this.vIndex-1),r=this.computeAngleSnapLine(e,o,W);r&&n(r)&&i.push(r)}else{i=this.edgeSnapLines.filter(n);var s=this.getPrevSnapLine(e),a=this.getNextSnapLine(e);n(s)&&i.push(s),n(a)&&i.push(a)}i=i.filter((function(e,t){for(var n=!1,o=0;o<t;o++){var r=i[o];if(e.isEqual(r,1e-4)){n=!0;break}}return!n}));for(var l=this.gizmoLayer.viewer.canvas,h=Math.sqrt(l.width*l.width+l.height*l.height),u=this.gizmoLayer.getUnitsPerPixel()*h,c=function(e,i){if(e){var n=e.a;i.makeLine(n.x-u*e.dir.x,n.y-u*e.dir.y,n.x+u*e.dir.x,n.y+u*e.dir.y),t.gizmoLayer.addShape(i)}},p=0;p<i.length;p++){c(i[p],this.acquireSnapLineGizmo())}}}},{key:"dtor",value:function(){this.clearSnapping()}},{key:"computeAngleSnapLine",value:function(e,t,i){if(y.a.edgeIsDegenerated(t,e))return null;for(var n=e.clone().sub(t),o=THREE.Math.radToDeg(y.a.angleBetweenDirections(n,i)),r=-1,s=0;s<this.snapAngles.length;s++){var a=this.snapAngles[s];if(Math.abs(a-o)<this.snapAngleTolerance){r=s;break}}if(-1==r)return null;var l=THREE.Math.degToRad(this.snapAngles[r]),h=y.a.rotateAround(i.clone(),l),u=t.distanceTo(e),c=h.multiplyScalar(u).add(t);return new N(t,c)}},{key:"active",get:function(){return this.poly}}]),e}();function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e,t,i){return t&&Q(e.prototype,t),i&&Q(e,i),e}X.GlobalManagerMixin.call(q.prototype);var J={Line:1,CircularArc:2,EllipticalArc:3},ee=function(e,t,i,n,o){return{type:J.Line,x1:e,y1:t,x2:i,y2:n,vpId:o}},te=function(e,t,i,n,o,r){return{type:J.CirularArc,cx:e,cy:t,start:i,end:n,radius:o,vpId:r}},ie=function(e,t,i,n,o,r,s,a){return{type:J.EllipticalArc,cx:e,cy:t,start:i,end:n,major:o,minor:r,tilt:s,vpId:a}},ne=function(e,t){switch(e.type){case J.Line:t.onLineSegment(e.x1,e.y1,e.x2,e.y2,e.vpId);break;case J.CirularArc:t.onCircularArc(e.cx,e.cy,e.start,e.end,e.radius,e.vpId);break;case J.EllipticalArc:t.onEllipticalArc(e.cx,e.cy,e.tart,e.end,e.major,e.minor,e.tilt,e.vpId)}},oe=function(){function e(){$(this,e),this.boundsCb=new Autodesk.Viewing.Private.BoundsCallback(new THREE.Box2),this.queryBox=new THREE.Box2,this.tmpPoint=new THREE.Vector2}return Z(e,[{key:"getSegmentBox",value:function(e){return this.boundsCb.bounds.makeEmpty(),ne(e,this.boundsCb),this.boundsCb.bounds}},{key:"getQueryBox",value:function(e,t,i,n){return this.queryBox.min.set(e,t),this.queryBox.max.set(i,n),this.queryBox}},{key:"intersectsBox",value:function(e,t,i,n,o){var r=this.getQueryBox(t,i,n,o),s=this.getSegmentBox(e);return r.isIntersectionBox(s)}},{key:"getPoint",value:function(e,t){var i=this.getSegmentBox(e).center(this.tmpPoint);t.x=i.x,t.y=i.y}}]),e}(),re=function(){function e(){$(this,e)}return Z(e,[{key:"buildFromModel",value:function(e){var t=e.getBoundingBox();this.tree=new Autodesk.Extensions.CompGeom.QuadTree(t.min.x,t.min.y,t.max.x,t.max.y,0,new oe);for(var i=e.getFragmentList(),n=i.getCount(),o=0;o<n;o++){var r=i.getGeometry(o);this.addGeometry(r)}}},{key:"addGeometry",value:function(e){var t=this,i={onLineSegment:function(){return t.tree.addItem(ee.apply(void 0,arguments))},onCircularArc:function(){return t.tree.addItem(te.apply(void 0,arguments))},onEllipticalArc:function(){return t.tree.addItem(ie.apply(void 0,arguments))}};new Autodesk.Viewing.Private.VertexBufferReader(e).enumGeoms(null,i)}},{key:"enumSegments",value:function(e,t,i,n,o){this.tree.enumInBox(e,t,i,n,(function(e){return ne(e,o)}))}}]),e}();function se(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ae=Autodesk.Viewing.MeasureCommon.SnapType,le=Autodesk.Viewing,he=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.setGlobalManager(t.globalManager),this.layer=i,this.gizmoLayer=n,this.sheetSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.layerSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.angleSnapper=new q(n),this.snapBox=new THREE.Box2,this.sheetSnapper.activate(),this.layerSnapper.activate(),this.onCameraChangeCb=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb),this.initSegmentTrees(),this.tmpVec=new THREE.Vector3,this.geomSnapLine={a:new THREE.Vector3,b:new THREE.Vector3}}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.sheetSnapper.deactivate(),this.layerSnapper.deactivate(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb)}},{key:"onCameraChange",value:function(){this.updateSnapperIndicators()}},{key:"initSegmentTrees",value:function(){this.viewer.getVisibleModels().forEach((function(e){var t=!(!e.myData||!e.myData.isLeaflet);e.is2d()&&!t&&!e.segmentTree&&e.isLoadDone()&&(e.segmentTree=new re,e.segmentTree.buildFromModel(e))}))}},{key:"updateSnapperIndicators",value:function(){this.sheetSnapper.isSnapped()?this.sheetSnapper.indicator.render():this.layerSnapper.indicator.render()}},{key:"getSnapPosition",value:function(e,t,i){var n=this._getSnapPosition(e,t,i);return this.angleSnapper.updateSnapLineGizmos(n),this.updateSnapperIndicators(),n}},{key:"clearSnappingGizmos",value:function(){this.angleSnapper.clearSnappingGizmos(),this.sheetSnapper.clearSnapped(),this.sheetSnapper.indicator&&this.sheetSnapper.indicator.clearOverlays(),this.layerSnapper.clearSnapped(),this.layerSnapper.indicator&&this.layerSnapper.indicator.clearOverlays()}},{key:"startAngleSnapping",value:function(e,t){this.angleSnapper.startSnapping(e,t)}},{key:"stopAngleSnapping",value:function(){this.angleSnapper.stopSnapping()}},{key:"_getSnapPosition",value:function(e,t,i){this.angleSnapper.clearSnappingResult(),this.sheetSnapper.clearSnapped(),this.layerSnapper.clearSnapped();var n=this.layer.canvasToLayer(e,t),o=this._getGeomSnapPosition(e,t,i),r=this._getGeomSnapLine();if(o&&!r)return o;if(this.angleSnapper.snapToAngle(n,r),r&&!this.angleSnapper.isSnapped())return o;if(r&&this.angleSnapper.isSnapped()){var s=this._getGeomSnapResult(),a=new THREE.Vector3(n.x,n.y,0).applyMatrix4(this.layer.layerToWorld);s.geomType=ae.SNAP_INTERSECTION,s.snapPoint=a,s.geomVertex=s.snapPoint}return n}},{key:"_getGeomSnapPosition",value:function(e,t,i){var n=this.layer.canvasToLayer(e,t),o=this._getSheetSnapPosition(e,t),r=this._getEditLayerSnapPosition(e,t,i);return o||r?r?o?THREE.Vector2.prototype.distanceToSquared.call(o,n)<THREE.Vector2.prototype.distanceToSquared.call(r,n)?(this.layerSnapper.clearSnapped(),o):(this.sheetSnapper.clearSnapped(),r):r:o:null}},{key:"_getGeomSnapResult",value:function(){var e=this.sheetSnapper.isSnapped(),t=this.layerSnapper.isSnapped();return e||t?(e?this.sheetSnapper:this.layerSnapper).getSnapResult():null}},{key:"_getGeomSnapLine",value:function(){var e=this._getGeomSnapResult();if(!e)return null;if(e.geomEdge){var t=e.geomEdge.vertices;return this.geomSnapLine.a.copy(t[0]),this.geomSnapLine.b.copy(t[1]),this.geomSnapLine.a.applyMatrix4(this.layer.worldToLayer),this.geomSnapLine.b.applyMatrix4(this.layer.worldToLayer),this.geomSnapLine}return null}},{key:"_getEditLayerSnapPosition",value:function(e,t,i){var n=this.layer.canvasToLayer(e,t,this.tmpVec),o=this.layerSnapper.detectRadiusInPixels*this.layer.getUnitsPerPixel();this.snapBox.min.set(n.x-o,n.y-o),this.snapBox.max.set(n.x+o,n.y+o);var r={};this.layer.enumShapes(this.snapBox,(function(e){i&&!i(e)||(r[e.id]=!0)}));var s=[];if(this.layer.enumMeshes(this.snapBox,(function(e){return s.push(e)})),this.layerSnapper.clearSnapped(),this.layerSnapper.snapping2DOverlay(n,s,(function(e){return Boolean(r[e])}),o),this.layerSnapper.isSnapped()){var a=this.layerSnapper.getSnapResult(),l=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(a,this.viewer);return l=(new THREE.Vector2).copy(l),a.applyMatrix4(this.layer.layerToWorld),l}}},{key:"_getSheetSnapPosition",value:function(e,t){var i=this;this.initSegmentTrees();var n=this.viewer.impl.intersectGround(e,t);if(this.sheetSnapper.snapping2DWithSegmentEnum(n,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=i.viewer.getVisibleModels();o.forEach((function(e){var i;e.is2d()&&e.segmentTree&&(i=e.segmentTree).enumSegments.apply(i,t)}))})),this.sheetSnapper.isSnapped()){var o=this.sheetSnapper.getSnapResult(),r=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(o,this.viewer);return r=this.tmpVec.copy(r).applyMatrix4(this.layer.worldToLayer),(new THREE.Vector2).copy(r)}}}])&&se(t.prototype,i),n&&se(t,n),e}();function ue(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}le.GlobalManagerMixin.call(he.prototype);var ce=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.toolSet=i,this.callbackId="Edit2D_".concat(i.name),this.callback=this.onContextMenu.bind(this)}var t,i,n;return t=e,(i=[{key:"register",value:function(){this.viewer.registerContextMenuCallback(this.callbackId,this.callback)}},{key:"unregister",value:function(){this.viewer.unregisterContextMenuCallback(this.callbackId)}},{key:"findGizmoUnderMouse",value:function(e,t,i){var n=document.elementFromPoint(t,i);return e.findIndex((function(e){return e.container===n}))}},{key:"vertexGizmoUnderMouse",value:function(e,t){var i=this.toolSet.tools.polygonEditTool.vertexGizmos;return this.findGizmoUnderMouse(i,e,t)}},{key:"edgeGizmoUnderMouse",value:function(e,t){var i=this.toolSet.tools.polygonEditTool.edgeGizmos;return this.findGizmoUnderMouse(i,e,t)}},{key:"onContextMenu",value:function(e,t){var i=this,n=this.toolSet.tools.polygonEditTool,o=this.toolSet.context.layer,r=t.event;if(Boolean(n.poly)){var s=o.canvasToLayer(t.canvasX,t.canvasY),l=this.vertexGizmoUnderMouse(r.clientX,r.clientY),h=-1!==l,u=-1!==this.edgeGizmoUnderMouse(r.clientX,r.clientY),c=n.findEdgeUnderMouse(s),p=n.getNewVertexPosition(s,c),d=Boolean(p);if(o.hitTest(s.x,s.y)||h||d){if(e.length=0,window.SolidDef){var y=n.poly;y instanceof a.e&&y.isClosed&&e.push({title:"Apply as Cutout",target:function(){var e=new B.ApplyCutOut(o,y);i.toolSet.context.undoStack.run(e)}})}h?e.push({title:"Remove Vertex",target:function(){n.removePoint(l)}}):p&&e.push({title:"Insert Vertex",target:function(){var e=c+1;n.insertPoint(e,p)}});var f=u||d,v=n.poly instanceof a.d;if(!h&&f&&v){var g=n.poly.getEdgeType(c);g!==a.b.Line&&e.push({title:"Change to Line Segment",target:function(){n.changeEdgeToLine(c)}}),g!==a.b.Bezier&&e.push({title:"Change to Arc Segment",target:function(){n.changeEdgeToBezier(c)}}),g!==a.b.Ellipse&&n.enableEllipseArcs&&e.push({title:"Change to Ellipse Segment",target:function(){n.changeEdgeToEllipse(c)}})}}}}}])&&ue(t.prototype,i),n&&ue(t,n),e}();function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function de(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function me(e,t,i){return t&&ge(e.prototype,t),i&&ge(e,i),e}var xe=function(){function e(){ve(this,e)}return me(e,[{key:"apply",value:function(e){}}]),e}(),Ee=function(e){function t(e){var i;return ve(this,t),(i=de(this,ye(t).call(this))).viewer=e,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,e),me(t,[{key:"apply",value:function(e){var t=this.viewer.model;if(t){var i=function(e){var t=e.getData().viewports;if(!t)return-1;for(var i=-1,n=-1,o=0;o<t.length;o++){var r=t[o];if(r.transform){var s=r.geom_metrics.db_ids;s>n&&(i=o,n=s)}}return i}(t);t.pageToModel(e,null,i)}}}]),t}(xe);function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t,i){return(Se="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=we(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function ke(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}function Pe(e,t){return(Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Le(e,t,i){return t&&Ae(e.prototype,t),i&&Ae(e,i),e}var Ve=Autodesk.Viewing.Private,ze=function(){function e(){Ce(this,e),this.measureTransform=null}return Le(e,[{key:"lengthToString",value:function(e){console.error("Not implemented")}},{key:"areaToString",value:function(e){console.error("Not implemented")}}]),e}(),Me=function(e){function t(e){var i;return Ce(this,t),(i=ke(this,we(t).call(this))).viewer=e,i.config={layerUnits:"inch",displayUnits:"inch",precision:2,scaleFactor:1},i}return Te(t,e),Le(t,[{key:"lengthToString",value:function(e){var t=this.config;return e=Ve.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e),Ve.formatValueWithUnits(e,t.displayUnits,3,t.precision)}},{key:"areaToString",value:function(e){var t=this.config;e=Ve.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e,"square");var i=t.displayUnits?"".concat(t.displayUnits,"^2"):null;return Ve.formatValueWithUnits(e,i,3,t.precision)}}]),t}(ze),Ge=function(e){function t(e){var i;return Ce(this,t),(i=ke(this,we(t).call(this,e))).measureTransform=new Ee(e),i}return Te(t,e),Le(t,[{key:"updateConfig",value:function(){var e=this.config,t=this.viewer.model;e.layerUnits=t?t.getUnitString():"inch";var i=this.viewer.getExtension("Autodesk.Measure"),n=i&&i.sharedMeasureConfig;n?(e.displayUnits=n.units,e.precision=n.precision,e.scaleFactor=n.calibrationFactor):(e.displayUnits=this.config.layerUnits,e.precision=2,e.scaleFactor=1)}},{key:"lengthToString",value:function(e){return this.updateConfig(),Se(we(t.prototype),"lengthToString",this).call(this,e)}},{key:"areaToString",value:function(e){return this.updateConfig(),Se(we(t.prototype),"areaToString",this).call(this,e)}}]),t}(Me);function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t,i){return(Re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Be(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function De(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?_e(e):t}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Be(e){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ue(e,t,i){return t&&Ne(e.prototype,t),i&&Ne(e,i),e}var Fe=function(e){return e.toString()+"px"},Ke={Left:1,Center:2,Right:3},Ye={Top:1,Center:2,Bottom:3},We=Autodesk.Viewing,Xe=function(){function e(){je(this,e)}return Ue(e,[{key:"update",value:function(){}}]),e}();We.GlobalManagerMixin.call(Xe.prototype);var qe=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];je(this,t),(i=De(this,Be(t).call(this))).layer=e,i.setGlobalManager(e.globalManager),i.layerPos=new THREE.Vector2,i.canvasPos=new THREE.Vector2;var o=i.getDocument();return i.container=o.createElement("div"),i.container.style.position="absolute",i.container.style.transformOrigin="50% 50%",i.visible=!1,i.alignX=Ke.Center,i.alignY=Ye.Center,i.angle=0,n&&i.setVisible(!0,!1),i.container.addEventListener("contextmenu",(function(e){i.layer.viewer.triggerContextMenu(e)})),i}return Ie(t,e),Ue(t,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setVisible",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e!=this.visible&&(e?(this.layer.viewer.canvasWrap.appendChild(this.container),this.layer.addCanvasGizmo(this),t&&this.update()):(this.layer.viewer.canvasWrap.removeChild(this.container),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"setAlignX",value:function(e){this.alignX=e,this.update()}},{key:"setAlignY",value:function(e){this.alignY=e,this.update()}},{key:"setRotation",value:function(e){this.angle=e,this.update()}},{key:"update",value:function(){this.canvasPos.copy(this.layer.layerToCanvas(this.layerPos.x,this.layerPos.y));var e,t,i=this.canvasPos,n=this.container.style;switch(n.left=Fe(i.x),n.top=Fe(i.y),this.alignX){case Ke.Left:e="0%";break;case Ke.Center:e="-50%";break;case Ke.Right:e="-100%"}switch(this.alignY){case Ye.Top:t="0%";break;case Ye.Center:t="-50%";break;case Ye.Bottom:t="-100%"}n.transform="translate(".concat(e,", ").concat(t,") rotate(").concat(this.angle,"deg)")}},{key:"setPosition",value:function(e,t){this.layerPos.set(e,t),this.update()}},{key:"setClassEnabled",value:function(e,t){t?this.container.classList.add(e):this.container.classList.remove(e)}},{key:"setSelected",value:function(e){this.setClassEnabled("selected",e)}},{key:"isSelected",value:function(){return this.container.classList.contains("selected")}},{key:"setHoverEnabled",value:function(e){this.setClassEnabled("enable-hover",e)}},{key:"setName",value:function(e){this.name=e,this.container.id=e||""}}]),t}(Xe),$e=function(e){e.container.classList.add("measure-length"),e.container.classList.add("visible");var t=e.getDocument();e.textDiv=t.createElement("div"),e.textDiv.classList.add("measure-length-text"),e.container.appendChild(e.textDiv),e.setText=function(e){this.textDiv.textContent=e}.bind(e)},Qe=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return je(this,t),n=De(this,Be(t).call(this,i,o)),$e(_e(n)),n.shape=e,n.valueValid=!0,n.pixelOffset=new THREE.Vector2,n.update(),n}return Ie(t,e),Ue(t,[{key:"update",value:function(){if(this.shape&&this.valueValid){if(this.container.style.visibility="visible",this.shape.isPolyline()){var e=this.shape.getEdgeCount(),i=Math.floor(e/2);this.shape.edgeIndexValid(i)&&this.shape.getPointOnEdge(i,.5,this.layerPos)}else this.shape.computeBBox(),this.shape.bbox.center(this.layerPos);if(this.pixelOffset){var n=this.layer.getUnitsPerPixel(),o=this.pixelOffset.x*n,r=this.pixelOffset.y*n;this.layerPos.x+=o,this.layerPos.y+=r}Re(Be(t.prototype),"update",this).call(this)}else this.container.style.visibility="hidden"}},{key:"setShape",value:function(e){this.shape=e,this.update()}}]),t}(qe),Ze=function(e){function t(e,i,n){var o,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return je(this,t),(o=De(this,Be(t).call(this,e,i,r))).unitHandler=n,o}return Ie(t,e),Ue(t,[{key:"update",value:function(){var e=this.shape&&this.shape.getLength&&this.shape.getLength(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var i=this.unitHandler.lengthToString(e);this.setText(i)}Re(Be(t.prototype),"update",this).call(this)}}]),t}(Qe),Je=function(e){function t(e,i,n){var o,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return je(this,t),(o=De(this,Be(t).call(this,e,i,r))).unitHandler=n,o}return Ie(t,e),Ue(t,[{key:"update",value:function(){var e=this.shape&&this.shape.getArea&&this.shape.getArea(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var i=this.unitHandler.areaToString(e);this.setText(i)}Re(Be(t.prototype),"update",this).call(this)}}]),t}(Qe),et=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return je(this,t),(i=De(this,Be(t).call(this,e,n))).posA=new THREE.Vector2,i.posB=new THREE.Vector2,i.posValid=!1,i.edgeDir=new THREE.Vector2,i.poly=null,i.edgeIndex=0,i.container.classList.add("edge-gizmo"),i.ignoreArcs=!1,i.maxRelativeLength=void 0,i}return Ie(t,e),Ue(t,[{key:"attachToEdge",value:function(e,t){this.poly=e,this.edgeIndex=t,this.update()}},{key:"detachFromEdge",value:function(){this.poly=null,this.edgeIndex=-1,this.posValid=!1,this.update()}},{key:"edgeValid",value:function(){return this.poly&&this.poly.edgeIndexValid(this.edgeIndex)}},{key:"update",value:function(){this.poly&&this.poly.edgeIndexValid(this.edgeIndex)&&(this.poly.getEdge(this.edgeIndex,this.posA,this.posB),this.posValid=!0);var e=this._shouldBeShown();this.container.style.visibility=e?"visible":"hidden",e&&(this.ignoreArcs?a.e.prototype.getPointOnEdge.call(this.poly,this.edgeIndex,.5,this.layerPos):this.poly.getPointOnEdge(this.edgeIndex,.5,this.layerPos),this._updateRotation(),Re(Be(t.prototype),"update",this).call(this))}},{key:"_shouldBeShown",value:function(){if(!this.posValid)return!1;if(this.maxRelativeLength){var e=this.layer.layerToCanvas(this.posA.x,this.posA.y),t=this.layer.layerToCanvas(this.posB.x,this.posB.y),i=e.distanceTo(t)*this.maxRelativeLength,n=this.getWindow();return parseFloat(n.getComputedStyle(this.container).width)<i}return!0}},{key:"_updateRotation",value:function(){var e=y.a.getEdgeDirection(this.posA,this.posB,this.edgeDir),t=Math.atan2(e.y,e.x);e.x<0&&(t+=Math.PI),this.angle=-THREE.Math.radToDeg(t)}}]),t}(qe),tt=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return je(this,t),(n=De(this,Be(t).call(this,e,o))).setName(i),n.container.classList.add("edge-move-gizmo"),n.ignoreArcs=!0,n.maxRelativeLength=.3,n}return Ie(t,e),t}(et),it=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return je(this,t),i=De(this,Be(t).call(this,e,n)),$e(_e(i)),i.maxRelativeLength=1,i}return Ie(t,e),t}(et),nt=function(e){function t(e,i,n,o){var r;return je(this,t),(r=De(this,Be(t).call(this,e,!0))).setPosition(i,n),r.setName(o),r.container.classList.add("vertex-gizmo"),r}return Ie(t,e),t}(qe),ot=function(e,t){e.updateBBox();var i=e.bbox,n=i.max.x-i.min.x;return n*t.getPixelsPerUnit()*n},rt=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return je(this,t),(e=De(this,Be(t).call(this))).minWidth=i,e}return Ie(t,e),Ue(t,[{key:"accepts",value:function(e,t,i){var n=ot(e,i);return Boolean(t)&&n>=this.minWidth}}]),t}(function(){function e(){je(this,e)}return Ue(e,[{key:"accepts",value:function(e,t){return!0}}]),e}()),st=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return je(this,t),(e=De(this,Be(t).call(this))).rangeStart=i,e.rangeEnd=n,e}return Ie(t,e),Ue(t,[{key:"apply",value:function(e,t,i){var n=(ot(t,i)-this.rangeStart)/(this.rangeEnd-this.rangeStart),o=THREE.Math.clamp(n,0,1);e.container.style.opacity=o}}]),t}(function(){function e(){je(this,e)}return Ue(e,[{key:"apply",value:function(e,t,i,n){}}]),e}()),at=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new rt,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new st;je(this,e),this.layer=t,this.shapeToLabelText=i,this.labels=[],this.labelsUsed=0,this.layer.addCanvasGizmo(this),this.visible=!0,this.layer.update(),this.filter=n,this.styleRule=o}return Ue(e,[{key:"setTextRule",value:function(e){this.shapeToLabelText=e,this.update()}},{key:"setVisible",value:function(e){e!==this.visible&&(e?(this.layer.addCanvasGizmo(this),this.update()):(this.clearLabels(),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"dtor",value:function(){this.setVisible(!1)}},{key:"clearLabels",value:function(){for(var e=0;e<this.labelsUsed;e++)this.labels[e].setShape(null),this.labels[e].setVisible(!1);this.labelsUsed=0}},{key:"acquireLabel",value:function(){return this.labelsUsed===this.labels.length&&this.labels.push(new Qe(null,this.layer)),this.labels[this.labelsUsed++]}},{key:"update",value:function(){this.clearLabels();for(var e=this.layer.shapes,t=0;t<e.length;t++){var i=e[t],n=this.shapeToLabelText(i);if(!this.filter||this.filter.accepts(i,n,this.layer)){var o=this.acquireLabel();o.setShape(i),o.setText(n),o.setVisible(!0),this.styleRule&&this.styleRule.apply(o,i,this.layer)}}}}]),e}(),lt=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return je(this,t),(i=De(this,Be(t).call(this))).layer=e,i.textCb=n,i.viewer=i.layer.viewer,i.mousePos=null,i.distanceToBox=5,i.container=i.getDocument().createElement("div"),i.container.classList.add("adsk-control-tooltip"),i.viewer.canvasWrap.appendChild(i.container),i.layer.addCanvasGizmo(_e(i)),i.onMouseMoved=i.onMouseMoved.bind(_e(i)),i.viewer.canvasWrap.addEventListener("mousemove",i.onMouseMoved),i.layer.updateCanvasGizmos(),i}return Ie(t,e),Ue(t,[{key:"dtor",value:function(){this.layer.removeCanvasGizmo(),this.viewer.canvasWrap.removeEventListener("mousemove",this.onMouseMoved),this.viewer.canvasWrap.removeChild(this.container)}},{key:"setTextCallback",value:function(e){this.textCb=e,this.update()}},{key:"onMouseMoved",value:function(e){this.viewer.toolController.__clientToCanvasCoords(e),this.mousePos=this.layer.canvasToLayer(e.canvasX,e.canvasY),this.update()}},{key:"update",value:function(){var e=this.mousePos&&this.textCb&&this.layer.hitTest(this.mousePos.x,this.mousePos.y),t=e&&this.textCb(e);if(this.container.textContent=t||"",t){this.container.style.visibility="visible",e.updateBBox();var i=e.bbox.max,n=this.layer.layerToCanvas(i.x,i.y);n.y-=this.distanceToBox;var o=this.viewer.canvas.width,r=this.viewer.canvas.height;this.container.style.right=o-n.x+"px",this.container.style.bottom=r-n.y+"px",this.container.style.left="auto",this.container.style.top="auto"}else this.container.style.visibility="hidden"}}]),t}(Xe),ht=function(){function e(){je(this,e),this.elemUnderMouse=null}return Ue(e,[{key:"update",value:function(e){this.elemUnderMouse=document.elementFromPoint(e.clientX,e.clientY)}},{key:"isUnderMouse",value:function(e){return e.container&&e.container===this.elemUnderMouse}},{key:"getGizmoIndex",value:function(e){var t=this;return e.findIndex((function(e){return t.isUnderMouse(e)}))}}]),e}(),ut=function(){function e(t,i){je(this,e),this.layer=t,this.gizmoLayer=i,this.shapes=[],this.visibility=!1,this.setVisible(!0),this.highlightColor=void 0,this.highlightIndex=0}return Ue(e,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setPoly",value:function(e){e!==this.poly&&(this.poly=e,this.clearEdgeHighlighting(),this.update())}},{key:"setVisible",value:function(e){this.visible!==e&&(this.visible=e,e?this.layer.addCanvasGizmo(this):this.layer.removeCanvasGizmo(this),this.update())}},{key:"clearShapes",value:function(){var e=this;this.shapes.forEach((function(t){return e.gizmoLayer.removeShape(t)})),this.shapes=[]}},{key:"edgeShapeName",value:function(e){return"ArcEdgeGizmo_"+e}},{key:"_addEdge",value:function(e){var t=new THREE.Vector2,i=new THREE.Vector2;this.poly.getEdge(e,t,i);var n=new a.h([t,i]);n.name=this.edgeShapeName(e),n.style.lineStyle=11,n.style.lineWidth=this.poly.style.lineWidth/2,n.style.lineAlpha=this.poly.style.lineAlha/2,e==this.highlightIndex&&this.highlightColor&&(n.style.lineColor=this.highlightColor),this.gizmoLayer.addShape(n),this.shapes.push(n)}},{key:"clearEdgeHighlighting",value:function(){-1!==this.highlightIndex&&(this.highlightColor=null,this.highlightIndex=-1,this.update())}},{key:"setEdgeHighlighted",value:function(e,t){e===this.highlightIndex&&t===this.highlightColor||(this.highlightColor=t,this.highlightIndex=e,this.update())}},{key:"update",value:function(){if(this.clearShapes(),this.visible&&this.poly&&this.poly.isPath())for(var e=this.poly.getEdgeCount(),t=0;t<e;t++){this.poly.isArc(t)&&this._addEdge(t)}}}]),e}();function ct(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pt=-1,dt=0,yt=1,ft=function(){function e(t,i,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path=t,this.gizmoLayer=o,this.layer=n,this.gizmoManager=r,this.index=i,this.line=new a.h,this.lineVisible=!1,this.line.style.isScreenSpace=!0,this.line.style.lineColor="rgb(255, 0, 255)",this.line.style.lineWidth=1,this.line.style.lineStyle=10,this.line.style.lineAlpha=1,this.vertexGizmo1=new nt(this.gizmoLayer,0,0,"TangentGizmo-$vertexIndex-$sideIndex"),this.vertexGizmo2=new nt(this.gizmoLayer,0,0,"TangentGizmo-$vertexIndex-$sideIndex"),this.vertexGizmo1.setVisible(!1),this.vertexGizmo2.setVisible(!1),this.pStart=new THREE.Vector2,this.pEnd=new THREE.Vector2,this.layer.addCanvasGizmo(this),this.dragIndex=pt,this.lastDragPos=new THREE.Vector2,this.dragOffset=new THREE.Vector2(0,0),this.update()}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.setVisible(!1),this.layer.removeCanvasGizmo(this)}},{key:"setVisible",value:function(e){this.vertexGizmo1.setVisible(e),this.vertexGizmo2.setVisible(e),e!==this.lineVisible&&(e?this.gizmoLayer.addShape(this.line):this.gizmoLayer.removeShape(this.line)),this.lineVisible=e}},{key:"update",value:function(){var e=this.path.edgeBeforeVertex(this.index),t=this.path.edgeAfterVertex(this.index),i=-1!==t,n=-1!==e&&this.path.isBezierArc(e),o=i&&this.path.isBezierArc(t);if(n||o){var r=this.path.points[this.index];if(o)this.pEnd.set(r.cp1x,r.cp1y),y.a.mirrorPointOnPoint(this.pEnd,r,this.pStart);else{var s=this.path.points[e];this.pStart.set(s.cp2x,s.cp2y),y.a.mirrorPointOnPoint(this.pStart,r,this.pEnd)}this.vertexGizmo1.setPosition(this.pStart.x,this.pStart.y),this.vertexGizmo2.setPosition(this.pEnd.x,this.pEnd.y),this.line.makeLine(this.pStart.x,this.pStart.y,this.pEnd.x,this.pEnd.y),this.gizmoLayer.update(),this.setVisible(!0)}else this.setVisible(!1)}},{key:"setTangentEndPoints",value:function(e,t){var i=this.path.edgeBeforeVertex(this.index);-1!==i&&this.path.isBezierArc(i)&&this.path.updateControlPoint(i,2,e.x,e.y);var n=this.path.edgeAfterVertex(this.index);-1!==n&&this.path.isBezierArc(n)&&this.path.updateControlPoint(this.index,1,t.x,t.y),this.update()}},{key:"onStartVertexMoved",value:function(e){var t=this.path.getPoint(this.index),i=y.a.mirrorPointOnPoint(e,t);this.setTangentEndPoints(e,i)}},{key:"onEndVertexMoved",value:function(e){var t=this.path.getPoint(this.index),i=y.a.mirrorPointOnPoint(e,t);this.setTangentEndPoints(i,e)}},{key:"startDrag",value:function(e,t,i){this.dragIndex=i;var n=i===dt?this.pStart:this.pEnd,o=this.layer.layerToCanvas(n.x,n.y);this.dragOffset.set(o.x-e,o.y-t),this.lastDragPos.copy(n)}},{key:"endDrag",value:function(e,t){this.moveDrag(e,t),this.dragIndex=pt}},{key:"moveDrag",value:function(e,t){var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.layer.canvasToLayer(i,n);this.dragIndex===dt?this.onStartVertexMoved(o):this.dragIndex===yt&&this.onEndVertexMoved(o),this.layer.update()}},{key:"onButtonDown",value:function(e,t){var i=this.gizmoManager.isUnderMouse(this.vertexGizmo1),n=this.gizmoManager.isUnderMouse(this.vertexGizmo2);if(!i&&!n)return!1;var o=i?dt:yt;return this.startDrag(e,t,o),!0}},{key:"isDragging",value:function(){return this.dragIndex!==pt}}])&&ct(t.prototype,i),n&&ct(t,n),e}();function vt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var gt=Autodesk.Viewing,mt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.shape=null,this.dragStartPoint=new THREE.Vector2,this.backupShape=null,this.keyMap={CancelEdit:gt.KeyCode.ESCAPE},this.lastMousePos=new THREE.Vector2}var t,i,n;return t=e,(i=[{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"Edit2_MoveTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.layer.hitTest(i.x,i.y);return n&&this.startDrag(n,i),this.shape?this.selection.selectOnly(this.shape):this.selection.clear(),Boolean(this.shape)}}},{key:"startDrag",value:function(e,t){this.shape=e,this.dragStartPoint.copy(t),this.backupShape=e.clone()}},{key:"moveDrag",value:function(e){var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;this.shape.copy(this.backupShape),this.shape.move(t,i),this.layer.update()}},{key:"resetDragging",value:function(){this.shape=null,this.backupShape=null}},{key:"endDrag",value:function(e){if(this.shape){this.shape.copy(this.backupShape);var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;return this.undoStack.run(new B.MoveShape(this.layer,this.shape,t,i)),!!this.shape&&(this.shape=null,!0)}}},{key:"cancelDrag",value:function(){this.isDragging()&&(this.shape.copy(this.backupShape),this.layer.update(),this.resetDragging())}},{key:"isDragging",value:function(){return Boolean(this.shape)}},{key:"handleMouseMove",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.lastMousePos.copy(t),!!this.shape&&(this.moveDrag(t),!0)}},{key:"handleButtonUp",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.endDrag(i)}}},{key:"handleKeyDown",value:function(e,t){t===this.keyMap.CancelEdit&&this.cancelDrag()}},{key:"getCursor",value:function(){return this.shape||this.layer.hitTest(this.lastMousePos.x,this.lastMousePos.y)?"move":void 0}}])&&vt(t.prototype,i),n&&vt(t,n),e}();function xt(e){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var bt=Autodesk.Viewing,St=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.layer=t.layer,this.gizmoLayer=t.gizmoLayer,this.snapper=t.snapper,this.selection=t.selection,this.undoStack=t.undoStack,this.unitHandler=t.unitHandler,this.nameSuffix="_".concat(t.toolSetName),this.ignoreDragging=!1,this.ignoreActions=!1,this.onActionCb=function(e){i.ignoreActions||i.handleExternalAction(e)},this.suppressSnapping=!1,this.keyMap={SnapKey:bt.KeyCode.SHIFT,PanKey:bt.KeyCode.SPACE},this.selection&&(this.selectionCb=function(){i.active&&i.onSelectionChanged&&i.onSelectionChanged()},this.selection.addEventListener(d.Events.SELECTION_CHANGED,this.selectionCb)),this.active=!1,this.canvasPos=new THREE.Vector2,this.gizmoManager=new ht,this.keyState={ctrl:!1,shift:!1,alt:!1}}var t,i,n;return t=e,(i=[{key:"getSnapPosition",value:function(e,t){var i=this;return this.snapper&&!this.suppressSnapping?this.snapper.getSnapPosition(e,t,(function(e){return i.snappingFilter(e)})):(this.snapper.clearSnappingGizmos(),this.layer.canvasToLayer(e,t))}},{key:"dtor",value:function(){this.selectionCb&&this.selection.removeEventListener(d.Events.SELECTION_CHANGED,this.selectionCb)}},{key:"getNames",value:function(){return[this.getName()]}},{key:"handleKeyDown",value:function(e,t){if(this.keyState[t]=!0,t!==this.keyMap.SnapKey||this.suppressSnapping||(this.suppressSnapping=!0,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===bt.KeyCode.BACKSPACE)return!0;t===this.keyMap.PanKey&&(this.ignoreDragging=!0)}},{key:"handleKeyUp",value:function(e,t){this.keyState[t]=!1,t===this.keyMap.SnapKey&&this.suppressSnapping&&(this.suppressSnapping=!1,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===this.keyMap.PanKey&&(this.ignoreDragging=!1)}},{key:"handleExternalAction",value:function(e){}},{key:"runAction",value:function(e){this.ignoreActions=!0,this.undoStack.run(e),this.ignoreActions=!1}},{key:"activate",value:function(){this.active=!0,this.undoStack.addEventListener(u.AFTER_ACTION,this.onActionCb)}},{key:"deactivate",value:function(){this.active=!1,this.undoStack.removeEventListener(u.AFTER_ACTION,this.onActionCb),this.snapper&&this.snapper.clearSnappingGizmos()}},{key:"register",value:function(){}},{key:"mapKey",value:function(e,t){for(var i in t){var n=t[i];if(null!==n){if(e.keyCode==n)return i;if(Array.isArray(n)&&n.includes(e.keyCode))return i;if("object"===xt(n)){var o=void 0===n.ctrlKey||n.ctrlKey===e.ctrlKey,r=void 0===n.shiftKey||n.shiftKey===e.shiftKey,s=void 0===n.altKey||n.altKey===e.altKey,a=void 0===n.meta||n.metaKey===e.metaKey;if(n.keyCode===e.keyCode&&o&&r&&s&&a)return i}if("function"==typeof n&&n(e))return i}}return null}},{key:"snappingFilter",value:function(){return!0}},{key:"trackMousePos",value:function(e){this.canvasPos.set(e.canvasX,e.canvasY),this.gizmoManager.update(e)}},{key:"handleMouseMove",value:function(e){this.trackMousePos(e)}},{key:"handleSingleClick",value:function(e){this.trackMousePos(e)}},{key:"handleDoubleClick",value:function(e){this.trackMousePos(e)}},{key:"handleButtonUp",value:function(e){this.trackMousePos(e)}},{key:"handleButtonDown",value:function(e){this.trackMousePos(e)}}])&&Et(t.prototype,i),n&&Et(t,n),e}();function kt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}bt.GlobalManagerMixin.call(St.prototype);var wt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.checkedModifiers={}}var t,i,n;return t=e,(i=[{key:"addCondition",value:function(e,t){this.checkedModifiers[e]=t}},{key:"removeCondition",value:function(e){delete this.checkedModifiers[e]}},{key:"accepts",value:function(e){for(var t in this.checkedModifiers)if(e.getModifierState(t)!==this.checkedModifiers[t])return!1;return!0}}])&&kt(t.prototype,i),n&&kt(t,n),e}();function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ct(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function At(e,t){return!t||"object"!==Tt(t)&&"function"!=typeof t?Vt(e):t}function Lt(e){return(Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mt=Autodesk.Viewing,Gt=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.l;return Pt(this,t),i=At(this,Lt(t).call(this,e)),Autodesk.Viewing.EventDispatcher.prototype.apply(Vt(i)),i.style=n,i.rect=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.areaLabel=new Je(null,i.layer,e.unitHandler,!1),i.modifiers=new wt,i.enableArcs=!0,i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(t,e),i=t,(n=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_RectangleTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(!this.modifiers.accepts(e))return!1;if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){return 0==t&&(this.dragCanceled?(this.dragCanceled=!1,!0):(this.handleMouseMove(e),this.endDrag()))}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.rect&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){var t=[e.clone(),e.clone(),e.clone(),e.clone()],i=this.style.clone();this.rect=this.enableArcs?new a.g(t,i):new a.f(t,i),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.rect)}},{key:"updateRect",value:function(e){if(this.isDragging()){var t=this.startPoint,i=this.endPoint;if(e){var n=i.x-t.x,o=i.y-t.y,r=Math.max(Math.abs(n),Math.abs(o)),s=Math.sign(n),a=Math.sign(o);this.rect.updatePoint(1,t.x+r*s,t.y),this.rect.updatePoint(2,t.x+r*s,t.y+r*a),this.rect.updatePoint(3,t.x,t.y+r*a)}else this.rect.updatePoint(1,i.x,t.y),this.rect.updatePoint(2,i.x,i.y),this.rect.updatePoint(3,t.x,i.y);this.gizmoLayer.update(),this.areaLabel.setShape(this.rect)}}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateRect(t)}},{key:"endDrag",value:function(){if(!this.rect)return!1;var e=this.endPoint.x-this.startPoint.x,t=this.endPoint.y-this.startPoint.y,i=Math.abs(e)>1e-10&&Math.abs(t)>1e-10;return this.gizmoLayer.removeShape(this.rect),i&&this.undoStack.run(new B.AddShape(this.layer,this.rect)),this.rect=null,this.areaLabel.setShape(null),!0}},{key:"cancelDrag",value:function(){this.rect&&(this.gizmoLayer.removeShape(this.rect),this.rect=null,this.dragCanceled=!0,this.areaLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.rect)}},{key:"handleKeyDown",value:function(e,t){t==Mt.KeyCode.SHIFT&&this.updateRect(!0)}},{key:"handleKeyUp",value:function(e,t){t==Mt.KeyCode.SHIFT&&this.updateRect(!1)}}])&&Ct(i.prototype,n),o&&Ct(i,o),t}(St);function Ot(e){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _t(e,t){return!t||"object"!==Ot(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function It(e,t){return(It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ht=Autodesk.Viewing,jt=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.l;return Rt(this,t),(i=_t(this,Bt(t).call(this,e))).style=n,i.line=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.lengthLabel=new Ze(null,i.layer,e.unitHandler,!1),i.enableArcs=!0,i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(t,e),i=t,(n=[{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_LineTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){if(0==t)return this.handleMouseMove(e),this.dragCanceled?(this.dragCanceled=!1,!0):this.endDrag()}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.line&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){var t=[e.clone(),e.clone()],i=this.style.clone();this.line=this.enableArcs?new a.i(t,i):new a.h(t,i),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.line)}},{key:"updateLine",value:function(){this.isDragging()&&(this.line.updatePoint(1,this.endPoint.x,this.endPoint.y),this.gizmoLayer.update(),this.lengthLabel.setShape(this.line))}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateLine()}},{key:"endDrag",value:function(){return!!this.line&&(this.gizmoLayer.removeShape(this.line),!y.a.edgeIsDegenerated(this.startPoint,this.endPoint)&&this.undoStack.run(new B.AddShape(this.layer,this.line)),this.line=null,this.lengthLabel.setShape(null),!0)}},{key:"cancelDrag",value:function(){this.line&&(this.gizmoLayer.removeShape(this.line),this.line=null,this.dragCanceled=!0,this.lengthLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.line)}},{key:"handleKeyDown",value:function(e,t){t==Ht.KeyCode.SHIFT&&this.updateLine(!0)}},{key:"handleKeyUp",value:function(e,t){t==Ht.KeyCode.SHIFT&&this.updateLine(!1)}}])&&Dt(i.prototype,n),o&&Dt(i,o),t}(St);function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ut(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ft(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Kt(e,t){return!t||"object"!==Nt(t)&&"function"!=typeof t?Yt(e):t}function Yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wt(e,t,i){return(Wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xt(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function Xt(e){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qt(e,t){return(qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $t={Polyline:1,Polygon:2},Qt=Autodesk.Viewing,Zt=new a.l,Jt=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$t.Polygon,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l;return Ut(this,t),(i=Kt(this,Xt(t).call(this,e))).lineRectTool=n===$t.Polygon?new Gt(e,o):new jt(e,o),Autodesk.Viewing.EventDispatcher.prototype.apply(Yt(i)),i.vertexGizmos=[],i.poly=void 0,i.style=o,i.edgePreviewStyle=new a.l({lineWidth:2,isScreenSpace:!0,lineStyle:11}),i.mode=n,i.lastClickX=void 0,i.lastClickY=void 0,i.keyMap.CANCEL_EDIT=Qt.KeyCode.ESCAPE,i.keyMap.REMOVE_LAST_VERTEX=Qt.KeyCode.BACKSPACE,i.keyMap.FINISH_EDIT=[Qt.KeyCode.ENTER,Qt.KeyCode.c],i.fillGizmo=null,i.outlineGizmo=null,i.edgePreviewGizmo=null,i.mousePos=new THREE.Vector2,i.areaLabel=new Je(null,i.gizmoLayer,i.unitHandler,!1),i.lengthLabel=new it(i.gizmoLayer,!1),i.enableArcs=!0,i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qt(e,t)}(t,e),i=t,(n=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"setArcsEnabled",value:function(e){this.enableArcs=e,this.lineRectTool.enableArcs=e}},{key:"deactivate",value:function(){Wt(Xt(t.prototype),"deactivate",this).call(this),this.cancelEdit()}},{key:"isPolygon",value:function(){return this.poly&&this.poly.isPolygon()}},{key:"setStyles",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.lineColor===Zt.lineColor&&t||(this.style.lineColor=e.lineColor),e.lineAlpha===Zt.lineAlpha&&t||(this.style.lineAlpha=e.lineAlpha),e.lineWidth===Zt.lineWidth&&t||(this.style.lineWidth=e.lineWidth,this.lineRectTool.style.lineWidth=e.lineWidth,this.edgePreviewStyle.lineWidth=2*e.lineWidth/3),e.lineStyle===Zt.lineStyle&&t||(this.style.lineStyle=e.lineStyle,this.lineRectTool.style.lineStyle=e.lineStyle),e.fillColor===Zt.fillColor&&t||(this.style.fillColor=e.fillColor),e.fillAlpha===Zt.fillAlpha&&t||(this.style.fillAlpha=e.fillAlpha)}},{key:"initGizmos",value:function(){this.isPolygon()&&(this.fillGizmo=new a.f([],this.style.clone()),this.fillGizmo.style.lineAlpha=0,this.gizmoLayer.addShape(this.fillGizmo)),this.outlineGizmo=new a.h([],this.style.clone()),this.gizmoLayer.addShape(this.outlineGizmo),this.edgePreviewGizmo=new a.h([],this.edgePreviewStyle),this.edgePreviewGizmo.style.lineColor=this.poly.style.lineColor,this.gizmoLayer.addShape(this.edgePreviewGizmo),this.areaLabel.setShape(this.fillGizmo),this.poly&&this.poly.isPolyline()&&this.lengthLabel.attachToEdge(this.edgePreviewGizmo,0)}},{key:"clearGizmos",value:function(){this.fillGizmo&&(this.gizmoLayer.removeShape(this.fillGizmo),this.fillGizmo=null),this.areaLabel.setShape(null),this.lengthLabel.detachFromEdge(),this.outlineGizmo&&(this.gizmoLayer.removeShape(this.outlineGizmo),this.outlineGizmo=null),this.edgePreviewGizmo&&(this.gizmoLayer.removeShape(this.edgePreviewGizmo),this.edgePreviewGizmo=null);for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"polyModified",value:function(){this.updateGizmos();var e=this.poly.clone();e.addPoint(this.mousePos.x,this.mousePos.y),this.snapper.startAngleSnapping(e,this.poly.vertexCount)}},{key:"updateGizmos",value:function(){if(this.fillGizmo){this.fillGizmo.clear();for(var e=0;e<this.poly.vertexCount;e++){var t=this.poly.getPoint(e);this.fillGizmo.addPoint(t.x,t.y)}this.fillGizmo.addPoint(this.mousePos.x,this.mousePos.y)}if(this.outlineGizmo.clear(),this.poly.vertexCount>=2)for(var i=0;i<this.poly.vertexCount;i++){var n=this.poly.getPoint(i);this.outlineGizmo.addPoint(n.x,n.y)}if(this.edgePreviewGizmo.clear(),this.poly.vertexCount>=1){var o=this.poly.getPoint(this.poly.vertexCount-1);this.edgePreviewGizmo.addPoint(o.x,o.y),this.edgePreviewGizmo.addPoint(this.mousePos.x,this.mousePos.y),this.updateLengthLabel()}this.gizmoLayer.update()}},{key:"updateLengthLabel",value:function(){if(this.poly&&this.poly.isPolyline()){var e=this.unitHandler.measureTransform,t=this.poly.getLength(e)+this.edgePreviewGizmo.getLength(e),i=this.unitHandler.lengthToString(t);this.lengthLabel.setText(i)}}},{key:"getName",value:function(){return(this.mode===$t.Polygon?"Edit2_PolygonTool":"Edit2_PolylineTool")+this.nameSuffix}},{key:"handleMouseMove",value:function(e){return Wt(Xt(t.prototype),"handleMouseMove",this).call(this,e),e.buttons?this.lineRectTool.handleMouseMove(e):(this.onHover(e.canvasX,e.canvasY),!1)}},{key:"onHover",value:function(e,t){if(this.poly){var i=this.layer.canvasToLayer(e,t),n=this.poly.vertexCount>=3&&this.gizmoManager.isUnderMouse(this.vertexGizmos[0]);this.setStartVertexHighlighted(n),n?(this.snapper.clearSnappingGizmos(),i.copy(this.vertexGizmos[0].layerPos)):i=this.getSnapPosition(e,t),this.mousePos.copy(i),this.edgePreviewGizmo.updatePoint(1,i.x,i.y),this.fillGizmo&&this.fillGizmo.updatePoint(this.fillGizmo.vertexCount-1,i.x,i.y),this.gizmoLayer.update(),this.updateLengthLabel()}else this.getSnapPosition(e,t)}},{key:"handleStartVertexClicked",value:function(e){if(this.poly||!(this.poly.vertexCount<3)){if(this.poly.isPolyline()){var t=this.poly.getPoint(0);this.addVertex(t.x,t.y)}this.finishPolygon(),e.stopPropagation()}}},{key:"handleSingleClick",value:function(e,i){return Wt(Xt(t.prototype),"handleSingleClick",this).call(this,e,i),0!=!i&&(this.vertexGizmos.length>0&&e.canvasX===this.lastClickX&&e.canvasY===this.lastClickY||(this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.mousePos.copy(this.getSnapPosition(e.canvasX,e.canvasY)),this.poly||this.startPoly(this.mousePos.x,this.mousePos.y),this.addVertex(this.mousePos.x,this.mousePos.y)),!0)}},{key:"handleButtonDown",value:function(e,t){return!this.ignoreDragging&&!this.poly&&(this.selection.clear(),this.lineRectTool.handleButtonDown(e,t))}},{key:"handleButtonUp",value:function(e,t){return this.lineRectTool.handleButtonUp(e,t)}},{key:"handleDoubleClick",value:function(e,i){return Wt(Xt(t.prototype),"handleDoubleClick",this).call(this,e,i),0!=!i&&(this.finishPolygon(),!0)}},{key:"startPoly",value:function(e,t){if(this.enableArcs){var i=this.mode===$t.Polygon;this.poly=new a.d([],i,this.style.clone())}else this.mode===$t.Polygon?this.poly=new a.f([],this.style.clone()):this.poly=new a.h([],this.style.clone());this.initGizmos()}},{key:"addVertex",value:function(e,t){var i=this;this.poly.addPoint(e,t);var n="PolygonTool_vertexGizmo_"+this.vertexGizmos.length,o=new nt(this.gizmoLayer,e,t,n);this.vertexGizmos.push(o),1===this.vertexGizmos.length&&o.container.addEventListener("click",(function(e){return i.handleStartVertexClicked(e)})),this.polyModified()}},{key:"removeLastVertex",value:function(){this.poly&&this.poly.vertexCount&&(this.poly.vertexCount<=1?this.cancelEdit():(this.poly.removePoint(this.poly.vertexCount-1),this.vertexGizmos[this.vertexGizmos.length-1].dtor(),this.vertexGizmos.pop(),this.polyModified()))}},{key:"finishPolygon",value:function(){this.clearGizmos(),this.snapper.stopAngleSnapping(),this.runAction(new B.AddShape(this.layer,this.poly)),this.dispatchEvent({type:t.POLYGON_ADDED,polygon:this.poly}),this.poly=null}},{key:"cancelEdit",value:function(){this.lineRectTool.isDragging()&&this.lineRectTool.cancelDrag(),this.poly&&(this.gizmoLayer.removeShape(this.poly),this.poly=null),this.clearGizmos(),this.snapper.stopAngleSnapping()}},{key:"handleFinishKey",value:function(e){return!(!this.poly||this.isPolygon()&&this.poly.vertexCount<3||(this.finishPolygon(),0))}},{key:"handleKeyDown",value:function(e,i){var n=Wt(Xt(t.prototype),"handleKeyDown",this).call(this,e,i);switch(n=this.lineRectTool.handleKeyDown(e,i)||n,this.mapKey(e,this.keyMap)){case"CANCEL_EDIT":this.cancelEdit(),n=!0;break;case"REMOVE_LAST_VERTEX":this.removeLastVertex(),n=!0;break;case"FINISH_EDIT":n=this.handleFinishKey(e)}return n}},{key:"handleKeyUp",value:function(e,i){Wt(Xt(t.prototype),"handleKeyUp",this).call(this,e,i),this.lineRectTool.handleKeyUp(e,i)}},{key:"onSnappingToggled",value:function(e,t){this.onHover(e,t)}},{key:"mouseOnStartVertex",value:function(){return!!this.vertexGizmos[0]&&this.gizmoManager(this.this.vertexGizmos[0])}},{key:"setStartVertexHighlighted",value:function(e){this.vertexGizmos[0]&&this.vertexGizmos[0].setSelected(e)}},{key:"getCursor",value:function(){return"crosshair"}}])&&Ft(i.prototype,n),o&&Ft(i,o),t}(St);function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ii(e,t){return!t||"object"!==ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ni(e){return(ni=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function oi(e,t){return(oi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Jt.POLYGON_ADDED="polygonAdded",Jt.Mode=$t;var ri=new THREE.Vector2,si=function(e,t,i,n){var o=n||new a.c,r=e.getEdgeDirection(t,ri),s=Math.atan2(r.y,r.x);return o.rotation=THREE.Math.radToDeg(s),o.rx=.5*e.getEdgeLength(t),o.ry=Math.abs(i),o.largeArcFlag=!1,o.sweepFlag=Boolean(e.isCCW()^i<0),o},ai=function(e){function t(e,i,n,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ii(this,ni(t).call(this,e,o))).container.classList.add("ellipse-arc-gizmo"),r.dragging=!1,r.dragStartParams=new a.c,r.dragOffset=new THREE.Vector2,r.tmpVec=new THREE.Vector2,r.tmpVec2=new THREE.Vector2,r.tmpVec3=new THREE.Vector2,r.tmpParams=new a.c,r.gizmoManager=i,r.undoStack=n,r}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oi(e,t)}(t,e),i=t,(n=[{key:"isUnderMouse",value:function(){return this.visible&&this.edgeValid()&&this.gizmoManager.isUnderMouse(this)}},{key:"startDrag",value:function(e,t){if(!this.edgeValid()||!this.isUnderMouse())return!1;if(this.dragging)return!0;this.dragging=!0,this.setSelected(!0);var i=this.layerPos,n=this.layer.layerToCanvas(i.x,i.y);return this.dragOffset.set(n.x-e,n.y-t),this.poly.getEllipseArcParams(this.edgeIndex,this.dragStartParams),!0}},{key:"moveDrag",value:function(e,t){if(!this.dragging)return!1;var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.layer.canvasToLayer(i,n),r=this.poly.getPoint(this.edgeIndex,this.tmpVec),s=this.tmpVec2.copy(o).sub(r),a=this.poly.getOuterNormal(this.edgeIndex,this.tmpVec3),l=s.dot(a),h=si(this.poly,this.edgeIndex,l,this.tmpParams);return this.poly.setEllipseArc(this.edgeIndex,h),this.update(),this.layer.update(),!0}},{key:"endDrag",value:function(e,t){this.moveDrag(e,t),this.dragging=!1;var i=this.poly.getEllipseArcParams(this.edgeIndex,this.tmpParams);this.restoreArc(),this.undoStack.run(new B.ChangeEdgeType(this.layer,this.poly,this.edgeIndex,a.b.Ellipse,null,null,i)),this.setSelected(!1)}},{key:"cancelDrag",value:function(){this.restoreArc(),this.dragging=!1,this.layer.update()}},{key:"restoreArc",value:function(){this.poly.setEllipseArc(this.edgeIndex,this.dragStartParams)}}])&&ti(i.prototype,n),o&&ti(i,o),t}(et);function li(e){return(li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ui(e,t){return!t||"object"!==li(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ci(e,t,i){return(ci="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pi(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function pi(e){return(pi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function di(e,t){return(di=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yi=Autodesk.Viewing,fi=function(e){return"PolygonEditTool_vertexGizmo_"+e.toString()},vi=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.setName(fi(t)),i.update(!1)}},gi=function(e,t){if(e.vertexCount<3)return!1;var i=e.isPolyline(),n=!(i&&0===t),o=!(i&&t===e.vertexCount-1);if(!n||!o)return!1;var r=e.prevIndex(t),s=e.nextIndex(t),a=e.getPoint(r),l=e.getPoint(t),h=e.getPoint(s);return y.a.isPointOnLine(l,a,h,1e-5)},mi=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=ui(this,pi(t).call(this,e))).moveTool=new mt(e),i.poly=null,i.lastDragPoint=new THREE.Vector2,i.vertexGizmos=[],i.draggedVertex=-1,i.dragVertexStartPos=new THREE.Vector2,i.dragEdgeStartPos={a:new THREE.Vector2,b:new THREE.Vector2},i.draggedEdge=-1,i.selectedEdge=-1,i.draggedEdgeBefore=-1,i.draggedEdgeNormal=new THREE.Vector2,i.duplicateStartVertex=!1,i.duplicateEndVertex=!1,i.selectedVertex=-1,i.dragOffset=new THREE.Vector2(0,0),i.edgeGizmo=new a.h,i.edgeGizmoShown=!1,i.keyMap.DeleteSelectedVertex=yi.KeyCode.BACKSPACE,i.keyMap.CancelEdit=yi.KeyCode.ESCAPE,i.keyMap.ChangeToArc=yi.KeyCode.a,i.keyMap.ChangeToLine=yi.KeyCode.l,i.mousePos=new THREE.Vector2,i.areaLabel=new Je(null,i.layer,e.unitHandler,!1),i.lengthLabel=new Ze(null,i.layer,e.unitHandler,!1),i.edgeGizmos=[],i.arcEdgeGizmo=new ut(e.layer,e.gizmoLayer),i.tangentGizmos=[],i.hoverEnabled=!0,i.enableEllipseArcs=!1,i.ellipseArcGizmo=new ai(e.layer,i.gizmoManager,e.undoStack,!1),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&di(e,t)}(t,e),i=t,(n=[{key:"setHoverEnabled",value:function(e){this.hoverEnabled&&!e&&this.selection.setHovered(null),this.hoverEnabled=e}},{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_PolygonEditTool"+this.nameSuffix}},{key:"deactivate",value:function(){ci(pi(t.prototype),"deactivate",this).call(this),this.reset()}},{key:"createVertexGizmos",value:function(){for(var e=0;e<this.poly.points.length;e++){var t=this.poly.points[e],i=new nt(this.gizmoLayer,t.x,t.y,fi(e),this.poly.style);this.vertexGizmos.push(i),i.setHoverEnabled(!0)}}},{key:"updateVertexGizmos",value:function(){var e=this.poly?this.poly.vertexCount:0,t=new THREE.Vector2;if(e==this.vertexGizmos.length)for(var i=0;i<e;i++)this.poly.getPoint(i,t),this.vertexGizmos[i].setPosition(t.x,t.y);else this.clearVertexGizmos(),this.createVertexGizmos()}},{key:"clearVertexGizmos",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"clearEdgeGizmos",value:function(){for(var e=0;e<this.edgeGizmos.length;e++)this.edgeGizmos[e].dtor();this.edgeGizmos.length=0,this.arcEdgeGizmo.setPoly(null)}},{key:"updateEdgeGizmoHighlighting",value:function(){for(var e=0;e<this.edgeGizmos.length;e++)this.edgeGizmos[e].setSelected(e==this.selectedEdge)}},{key:"createEdgeGizmos",value:function(){this.clearEdgeGizmos();var e=this.poly?this.poly.getEdgeCount():0,t=e>=2;if(t)for(var i=0;i<e;i++){var n=new tt(this.layer,"PolygonEditTool_edgeGizmo_"+i.toString());n.attachToEdge(this.poly,i),this.edgeGizmos.push(n)}this.arcEdgeGizmo.setPoly(this.poly),this.updateEdgeGizmoHighlighting();var o=t?20:0;this.lengthLabel.pixelOffset.set(0,o)}},{key:"updateVertexHighlighting",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].setSelected(e===this.selectedVertex)}},{key:"updateAllGizmos",value:function(){this.updateVertexGizmos(),this.updateEdgeGizmo(),this.createEdgeGizmos(),this.updateTangentGizmos(),this.updateEllipseArcGizmo()}},{key:"setSelectedVertex",value:function(e){-1!==e&&this.setSelectedEdge(-1),this.selectedVertex=this.poly?e:-1,this.updateVertexHighlighting(),this.updateTangentGizmos(),this.updateEllipseArcGizmo()}},{key:"getVertexIndex",value:function(){return this.gizmoManager.getGizmoIndex(this.vertexGizmos)}},{key:"getEdgeIndex",value:function(){return this.gizmoManager.getGizmoIndex(this.edgeGizmos)}},{key:"reset",value:function(){this.poly&&(this.clearVertexGizmos(),this.clearEdgeGizmos(),this.clearTangentGizmos(),this.areaLabel.setShape(null),this.lengthLabel.setShape(null),this.poly=null,this.draggedVertex=-1,this.draggedEdge=-1,this.selectedVertex=-1,this.selectedEdge=-1,this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(e){this.reset(),e&&(this.poly=e,this.updateAllGizmos());var t=e&&e.isPolygon()?e:null;this.areaLabel.setShape(t);var i=e&&e.isPolyline()?e:null;this.lengthLabel.setShape(i)}},{key:"insertPoint",value:function(e,t){this.runAction(new B.AddVertex(this.layer,this.poly,e,t));var i=new nt(this.gizmoLayer,t.x,t.y,void 0,this.poly.style);i.setHoverEnabled(!0),this.vertexGizmos.splice(e,0,i),vi(this.vertexGizmos),this.updateAllGizmos(),this.layer.update()}},{key:"removePoint",value:function(e){var t=this.poly.isPolygon()?3:2;if(this.poly.vertexCount<=t)return this.runAction(new B.RemoveShape(this.layer,this.poly)),void this.reset();this.runAction(new B.RemoveVertex(this.layer,this.poly,e));var i=this.vertexGizmos.splice(e,1)[0];vi(this.vertexGizmos),this.updateAllGizmos(),i.dtor(),this.selectedVertex===e&&this.setSelectedVertex(-1),this.poly.edgeIndexValid(this.selectedEdge)||this.setSelectedEdge(-1),this.layer.update()}},{key:"startDragVertex",value:function(e,t){this.snapper.startAngleSnapping(this.poly.clone(),t),this.draggedVertex=t;var i=this.poly.points[this.draggedVertex],n=this.layer.layerToCanvas(i.x,i.y);this.dragOffset.set(n.x-e.canvasX,n.y-e.canvasY),this.setSelectedVertex(this.draggedVertex),this.lastDragPoint.copy(i),this.dragVertexStartPos.copy(i)}},{key:"moveDragVertex",value:function(e,t){var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.getSnapPosition(i,n),r=o.x-this.lastDragPoint.x,s=o.y-this.lastDragPoint.y,a=this.poly.points[this.draggedVertex];this.poly.updatePoint(this.draggedVertex,a.x+r,a.y+s),this.vertexGizmos[this.draggedVertex].setPosition(a.x,a.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(o)}},{key:"restoreDragVertex",value:function(){this.poly.updatePoint(this.draggedVertex,this.dragVertexStartPos.x,this.dragVertexStartPos.y)}},{key:"endDragVertex",value:function(){this.restoreDragVertex();var e=this.dragVertexStartPos,t=this.lastDragPoint,i=.5*this.layer.getUnitsPerPixel();e.distanceTo(t)>i&&this.runAction(new B.MoveVertex(this.layer,this.poly,this.draggedVertex,t)),this.draggedVertex=-1,this.snapper.clearSnappingGizmos()}},{key:"startDragEdge",value:function(e,t){this.draggedEdgeNormal=this.poly.getLeftEdgeNormal(t,this.draggedEdgeNormal),this.lastDragPoint.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY));var i=t,n=(t+1)%this.poly.vertexCount;this.dragEdgeStartPos.a.copy(this.poly.getPoint(i)),this.dragEdgeStartPos.b.copy(this.poly.getPoint(n)),this.duplicateStartVertex=gi(this.poly,i),this.duplicateEndVertex=gi(this.poly,n),B.MoveEdge.duplicateVertices(this.poly,t,this.duplicateStartVertex,this.duplicateEndVertex),this.draggedEdgeBefore=t;var o=B.MoveEdge.getNewEdgeIndex(this.poly,t,this.duplicateStartVertex,this.duplicateEndVertex);this.setSelectedEdge(o),this.draggedEdge=o,(this.duplicateStartVertex||this.duplicateEndVertex)&&this.updateAllGizmos()}},{key:"moveDragEdge",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY),i=t.clone().sub(this.lastDragPoint),n=this.poly.prevEdgeIndex(this.draggedEdge),o=this.poly.nextEdgeIndex(this.draggedEdge),r=-1!==n,s=-1!==o,a=new THREE.Vector2,l=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector2;if(this.poly.getEdge(this.draggedEdge,h,u),r||s){var c=new THREE.Vector2,p=new THREE.Vector2,d=new THREE.Vector2,f=new THREE.Vector2;r&&this.poly.getEdge(n,c,p),s&&this.poly.getEdge(o,d,f),r||(p.copy(h),this.duplicateEndVertex?c.copy(h).add(this.draggedEdgeNormal):c.copy(f).sub(u).add(h)),s||(d.copy(u),this.duplicateStartVertex?f.copy(u).add(this.draggedEdgeNormal):f.copy(c).sub(h).add(u));var v=y.a.getEdgeDirection(c,p),g=y.a.getEdgeDirection(h,u),m=y.a.getEdgeDirection(d,f);if(h.add(i),u.add(i),this.duplicateStartVertex&&v.copy(this.draggedEdgeNormal),this.duplicateEndVertex&&m.copy(this.draggedEdgeNormal),!y.a.intersectLines(c,v,h,g,a)||!y.a.intersectLines(d,m,h,g,l))return}else a.copy(h).add(i),l.copy(u).add(i);var x=this.draggedEdge,E=this.poly.nextIndex(x);this.poly.updatePoint(x,a.x,a.y),this.poly.updatePoint(E,l.x,l.y),this.vertexGizmos[x].setPosition(a.x,a.y),this.vertexGizmos[E].setPosition(l.x,l.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(t),this.updateEdgeGizmo()}},{key:"restoreDragEdge",value:function(){var e=this.dragEdgeStartPos.a,t=this.dragEdgeStartPos.b,i=this.draggedEdge,n=this.poly.nextIndex(i);this.poly.updatePoint(i,e.x,e.y),this.poly.updatePoint(n,t.x,t.y),B.MoveEdge.revertDuplicateVertices(this.poly,this.draggedEdgeBefore,this.duplicateStartVertex,this.duplicateEndVertex),this.selectedEdge=this.draggedEdgeBefore}},{key:"endDragEdge",value:function(){var e=this.draggedEdge,t=this.poly.nextIndex(e),i=this.poly.getPoint(e),n=this.poly.getPoint(t);this.restoreDragEdge(),this.dragEdgeStartPos.a.distanceTo(i)*this.layer.getPixelsPerUnit()>=3&&(this.runAction(new B.MoveEdge(this.layer,this.poly,this.draggedEdgeBefore,i,n,this.duplicateStartVertex,this.duplicateEndVertex)),this.selectedEdge=this.draggedEdge),this.draggedEdge=-1,this.updateAllGizmos()}},{key:"edgeMovePossible",value:function(){return this.poly&&this.poly.vertexCount>2}},{key:"isSingleLine",value:function(){return this.poly&&2===this.poly.vertexCount}},{key:"findEdgeUnderMouse",value:function(e){var t=17*this.layer.getUnitsPerPixel();return this.poly?this.poly.findEdgeIndex(e,t):-1}},{key:"getNewVertexPosition",value:function(e,t){if(!this.poly||!this.poly.edgeIndexValid(t))return null;var i=new THREE.Vector2,n=new THREE.Vector2;this.poly.getEdge(t,i,n);var o=y.a.getEdgeDirection(i,n),r=e.clone();return y.a.projectToLine(r,i,o),y.a.isPointOnEdge(r,i,n,1e-4)?r:null}},{key:"handleButtonDown",value:function(e,i){if(this.ignoreDragging)return!1;if(ci(pi(t.prototype),"handleButtonDown",this).call(this,e,i),0==!i)return!1;var n=this.layer.canvasToLayer(e.canvasX,e.canvasY);this.mousePos.copy(n);var o=this.getVertexIndex();if(-1!=o)return this.startDragVertex(e,o),!0;var r=-1;if(e.ctrlKey){var s=this.findEdgeUnderMouse(this.mousePos),l=this.getNewVertexPosition(this.mousePos,s);if(l)return r=s+1,this.insertPoint(r,l),this.startDragVertex(e,r),!0}for(var h=0;h<this.tangentGizmos.length;h++)if(this.tangentGizmos[h].onButtonDown(e.canvasX,e.canvasY))return!0;if(this.ellipseArcGizmo.startDrag(e.canvasX,e.canvasY))return!0;this.setSelectedVertex(-1),this.setSelectedEdge(-1);var u=this.getEdgeIndex();if(this.edgeMovePossible()&&-1!==u)return this.startDragEdge(e,u),!0;if(this.poly){var c=this.layer.getLineHitRadius(this.poly);if(this.poly.hitTest(n.x,n.y,c))return this.moveTool.startDrag(this.poly,n),!0}var p=this.layer.hitTest(n.x,n.y),d=p instanceof a.f,y=p instanceof a.h,f=p instanceof a.d;return d||y||f||(p=null),this.selection.selectOnly(p),Boolean(this.poly)}},{key:"handleSingleClick",value:function(e){return ci(pi(t.prototype),"handleSingleClick",this).call(this,e),Boolean(this.poly)}},{key:"handleMouseMove",value:function(e){if(ci(pi(t.prototype),"handleMouseMove",this).call(this,e),this.mousePos.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY)),this.updateMouseOverHighlights(),!this.poly)return!1;if(-1!=this.draggedVertex)return this.moveDragVertex(e.canvasX,e.canvasY),!0;-1!=this.draggedEdge&&this.moveDragEdge(e),this.moveTool.isDragging()&&(this.moveTool.moveDrag(this.mousePos),this.updateVertexGizmos());var i=this.findDraggedTangentGizmo();return i&&i.moveDrag(e.canvasX,e.canvasY),!!this.ellipseArcGizmo.dragging&&this.ellipseArcGizmo.moveDrag(e.canvasX,e.canvasY)}},{key:"handleButtonUp",value:function(e,i){if(ci(pi(t.prototype),"handleButtonUp",this).call(this,e,i),-1!==this.draggedVertex)return this.endDragVertex(),!0;if(-1!==this.draggedEdge)return this.endDragEdge(),!0;if(this.moveTool.isDragging()){var n=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.ignoreActions=!0,this.moveTool.endDrag(n),this.ignoreActions=!1,this.updateVertexGizmos(),!0}var o=this.findDraggedTangentGizmo();return o&&o.endDrag(e.canvasX,e.canvasY),this.ellipseArcGizmo.dragging&&this.ellipseArcGizmo.endDrag(e.canvasX,e.canvasY),!this.ignoreDragging&&this.poly&&0==i}},{key:"snappingFilter",value:function(e){return e!==this.poly}},{key:"onSelectionChanged",value:function(){var e=this.selection.getSelectedShapes()[0];e instanceof a.e?this.setEditPoly(e):this.setEditPoly(null)}},{key:"handleKeyDown",value:function(e,i){var n=ci(pi(t.prototype),"handleKeyDown",this).call(this,e,i);if(i===this.keyMap.DeleteSelectedVertex&&this.poly&&-1!==this.selectedVertex&&(this.removePoint(this.selectedVertex),n=!0),i===this.keyMap.CancelEdit)return this.cancelDrag(),!0;var o=this.isSingleLine()?0:this.selectedEdge,r=this.poly&&this.poly.edgeIndexValid(o);return i===this.keyMap.ChangeToArc?(r&&!this.poly.isBezierArc(o)&&this.changeEdgeToBezier(o),!0):(i===this.keyMap.ChangeToLine&&r&&this.poly.isBezierArc(o)&&this.changeEdgeToLine(o),n)}},{key:"onSnappingToggled",value:function(e,t){-1!==this.draggedVertex&&this.moveDragVertex(e,t)}},{key:"cancelDrag",value:function(){var e=!1;-1!==this.draggedVertex&&(this.restoreDragVertex(),this.draggedVertex=-1,e=!0),-1!==this.draggedEdge&&(this.restoreDragEdge(),this.draggedEdge=-1,e=!0),this.moveTool.isDragging()&&(this.moveTool.cancelDrag(),this.updateVertexGizmos()),e&&(this.updateAllGizmos(),this.layer.update()),this.ellipseArcGizmo.dragging&&(this.ellipseArcGizmo.cancelDrag(),this.updateAllGizmos()),this.snapper.clearSnappingGizmos()}},{key:"handleExternalAction",value:function(){this.poly&&(Boolean(this.layer.findShapeById(this.poly.id))||this.reset(),this.setSelectedEdge(-1),this.setSelectedVertex(-1),this.updateAllGizmos(),this.cancelDrag(),this.snapper.clearSnappingGizmos())}},{key:"updateEdgeGizmo",value:function(){var e=this.getEdgeIndex(),t=-1!=this.getVertexIndex()||-1!=this.draggedVertex,i=this.edgeMovePossible(),n=this.poly&&-1!=this.selectedEdge,o=i&&-1!=e&&!t,r=o&&this.poly.isPath()&&this.poly.isArc(e),s=n||o&&!r;s&&!this.edgeGizmoShown?(this.gizmoLayer.addShape(this.edgeGizmo),this.edgeGizmoShown=!0):!s&&this.edgeGizmoShown&&(this.gizmoLayer.removeShape(this.edgeGizmo),this.edgeGizmoShown=!1);var a=n?this.selectedEdge:e;if(this.edgeGizmoShown||r?this.arcEdgeGizmo.setEdgeHighlighted(a,"rgb(0, 255, 0)"):this.arcEdgeGizmo.clearEdgeHighlighting(),s){var l=new THREE.Vector2,h=new THREE.Vector2;this.poly.getEdge(a,l,h),this.edgeGizmo.makeLine(l.x,l.y,h.x,h.y),this.edgeGizmo.style.lineWidth=this.poly.style.lineWidth,this.edgeGizmo.style.isScreenSpace=this.poly.style.isScreenSpace,n?(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=1):(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=.5),this.gizmoLayer.update()}}},{key:"setSelectedEdge",value:function(e){-1!==e&&this.setSelectedVertex(-1),this.selectedEdge=e,this.updateEdgeGizmo(),this.updateEdgeGizmoHighlighting(),this.updateTangentGizmos(),this.updateEllipseArcGizmo()}},{key:"updateMouseOverHighlights",value:function(){if(this.updateEdgeGizmo(),this.hoverEnabled){var e=this.layer.hitTest(this.mousePos.x,this.mousePos.y);this.selection.setHoveredId(e?e.id:0)}}},{key:"getCursor",value:function(){if(this.poly){var e=this.mousePos;if(this.moveTool.isDragging())return"move";if(-1!=this.draggedVertex||-1!=this.draggedEdge)return"move";if(this.ellipseArcGizmo.dragging)return"move";if(this.keyState[yi.KeyCode.CONTROL]){var t=17*this.layer.getUnitsPerPixel();if(-1!==(this.poly?this.poly.findEdgeIndex(this.mousePos,t):-1))return"copy"}var i=this.layer.getLineHitRadius(this.poly);return this.poly.hitTest(e.x,e.y,i)?"move":void 0}}},{key:"clearTangentGizmos",value:function(){this.tangentGizmos.forEach((function(e){return e.dtor()})),this.tangentGizmos.length=0}},{key:"updateTangentGizmos",value:function(){if(this.clearTangentGizmos(),this.poly&&this.poly.isPath())for(var e=0;e<this.poly.points.length;e++){var t=this.selectedVertex===e,i=this.poly.edgeBeforeVertex(e),n=this.poly.edgeAfterVertex(e),o=-1!==i,r=-1!==n,s=o&&this.selectedEdge===i,a=r&&this.selectedEdge===n,l=o&&this.poly.isBezierArc(i),h=r&&this.poly.isBezierArc(n);(this.isSingleLine()||t&&(l||h)||s&&l||a&&h)&&this.tangentGizmos.push(new ft(this.poly,e,this.layer,this.gizmoLayer,this.gizmoManager))}}},{key:"updateEllipseArcGizmo",value:function(){var e=-1!==this.selectedEdge&&this.poly instanceof a.d&&this.poly.isEllipseArc(this.selectedEdge);this.ellipseArcGizmo.setVisible(e),e?this.ellipseArcGizmo.attachToEdge(this.poly,this.selectedEdge):this.ellipseArcGizmo.detachFromEdge()}},{key:"findDraggedTangentGizmo",value:function(){return this.tangentGizmos.find((function(e){return e.isDragging()}))}},{key:"getVertexTangentLength",value:function(e,t){return.5*(e+t)*(.551915024494/Math.SQRT2)}},{key:"getVertexTangent",value:function(e,t,i){var n=(new THREE.Vector2).copy(i).sub(e).normalize(),o=t.distanceTo(e),r=t.distanceTo(i),s=this.getVertexTangentLength(o,r);return n.multiplyScalar(s)}},{key:"changeEdgeToEllipse",value:function(e){var t=.5*this.poly.getEdgeLength(e),i=si(this.poly,e,t);this.runAction(new B.ChangeEdgeType(this.layer,this.poly,e,a.b.Ellipse,null,null,i)),this.layer.update(),this.setSelectedEdge(e)}},{key:"changeEdgeToBezier",value:function(e){var t=this.poly,i=t.prevEdgeIndex(e),n=t.nextEdgeIndex(e),o=-1!==i,r=-1!==n,s=new THREE.Vector2,l=new THREE.Vector2;t.getEdge(e,s,l);var h=o&&t.getPoint(i),u=r&&t.getPoint(t.nextIndex(n));o||(h=y.a.mirrorPointOnPoint(l,s)),r||(u=y.a.mirrorPointOnPoint(s,l));var c=null,p=null,d=o&&t.isBezierArc(i),f=r&&t.isBezierArc(n);if(d){var v=t.getControlPoint(i,2);c=y.a.mirrorPointOnPoint(v,s)}else c=this.getVertexTangent(h,s,l).add(s);if(f){var g=t.getControlPoint(n,1);p=y.a.mirrorPointOnPoint(g,l)}else p=this.getVertexTangent(u,l,s).add(l);this.runAction(new B.ChangeEdgeType(this.layer,this.poly,e,a.b.Bezier,c,p)),this.layer.update(),this.setSelectedEdge(e)}},{key:"changeEdgeToLine",value:function(e){this.runAction(new B.ChangeEdgeType(this.layer,this.poly,e,a.b.Line)),this.layer.update(),this.setSelectedEdge(e)}}])&&hi(i.prototype,n),o&&hi(i,o),t}(St);function xi(e){return(xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ei(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function bi(e){return(bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Si(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ki(e,t){return(ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wi=function(e){function t(e){var i,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=!(o=bi(t).call(this,e))||"object"!==xi(o)&&"function"!=typeof o?Si(n):o,Autodesk.Viewing.EventDispatcher.prototype.apply(Si(i)),i.symbol=new a.a(0,0,.2,new a.l({fillAlpha:1,lineWidth:.01,fillColor:"rgb(255, 255, 0)"})),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ki(e,t)}(t,e),i=t,(n=[{key:"getName",value:function(){return"Edit2_InsertSymbolTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"setSymbol",value:function(e){this.symbol=e}},{key:"handleMouseMove",value:function(e){}},{key:"handleSingleClick",value:function(e){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.symbol.clone();return n.move(i.x,i.y),this.undoStack.run(new B.AddShape(this.layer,n)),this.dispatchEvent({type:t.SYMBOL_INSERTED,symbol:n}),!0}},{key:"handleDoubleClick",value:function(){return!0}},{key:"getCursor",value:function(){return"crosshair"}}])&&Ei(i.prototype,n),o&&Ei(i,o),t}(St);function Ti(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}wi.SYMBOL_INSERTED="symbolInserted";var Pi=Autodesk.Viewing,Ci=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.undoStack=t}var t,i,n;return t=e,(i=[{key:"handleKeyDown",value:function(e,t){if(t!==Pi.KeyCode.z||!e.ctrlKey)return!1;e.shiftKey?this.undoStack.redo():this.undoStack.undo()}},{key:"getName",value:function(){return"Edit2_UndoTool"}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&Ti(t.prototype,i),n&&Ti(t,n),e}();function Ai(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Li=Autodesk.Viewing,Vi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.viewer=t.viewer,this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.clipBoard=[],this.pasteCounter=0}var t,i,n;return t=e,(i=[{key:"copy",value:function(){this.clipBoard.length=0;var e=this.selection.getSelectedShapes();this.originalShapes=e,this.clipBoard=e.slice(),this.pasteCounter=0}},{key:"paste",value:function(){this.pasteCounter++;var t=30*this.pasteCounter*this.layer.getUnitsPerPixel(),i=[],n={type:e.BEFORE_PASTE,originalShapes:this.originalShapes,veto:!1};if(this.dispatchEvent(n),!n.veto){for(var o=0;o<this.clipBoard.length;o++){var r=this.clipBoard[o].clone();r.move(t,t),i.push(r)}this.selection.setSelection(i),this.undoStack.run(new B.AddShapes(this.layer,i)),this.dispatchEvent({type:e.AFTER_PASTE,originalShapes:this.originalShapes,shapes:i})}}},{key:"delete",value:function(){var e=this.selection.getSelectedShapes();this.undoStack.run(new B.RemoveShapes(this.layer,e)),this.selection.clear()}},{key:"handleKeyDown",value:function(e,t){if(!this.selection.empty()){if(t===Li.KeyCode.DELETE)return this.delete(),!0;if(e.ctrlKey&&t===Li.KeyCode.c)return this.copy(),!0}if(0!==this.clipBoard.length&&e.ctrlKey&&t===Li.KeyCode.v)return this.paste(),!0}},{key:"getName",value:function(){return"Edit2_CopyTool"+this.nameSuffix}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&Ai(t.prototype,i),n&&Ai(t,n),e}();Vi.BEFORE_PASTE="BEFORE_PASTE",Vi.AFTER_PASTE="AFTER_PASTE";i(353);function zi(e){return(zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mi(e,t,i,n,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,o)}function Gi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Oi(e,t,i){return t&&Gi(e.prototype,t),i&&Gi(e,i),e}function Ri(e){return(Ri=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Di(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _i(e,t){return(_i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"default",(function(){return Ni}));var Ii=AutodeskNamespace("Autodesk.Edit2D"),Hi=Autodesk.Viewing,ji=function e(t,i){Bi(this,e),this.name=t,this.autoReactivate=i,this.context=null,this.tools={}},Ni=function(e){function t(e,i){var n,o,r;return Bi(this,t),o=this,(n=!(r=Ri(t).call(this,e,i))||"object"!==zi(r)&&"function"!=typeof r?Di(o):r).undoStack=new u,n._registeredTools=new Map,n._boundOnModelAdded=n._onModelAdded.bind(Di(n)),n._boundOnModelRemoved=n._onModelRemoved.bind(Di(n)),n._boundOnSelectionChanged=n._onSelectionChanged.bind(Di(n)),n}var i,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_i(e,t)}(t,e),Oi(t,[{key:"load",value:(i=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.viewer.impl.createOverlayScene("Edit2D"),e.next=3,this.viewer.loadExtension("Autodesk.Snapping");case 3:this.viewer.addEventListener(Hi.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.addEventListener(Hi.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),this.undoTool=new Ci(this.undoStack),this.viewer.toolController.registerTool(this.undoTool),this.viewer.toolController.activateTool(this.undoTool.getName());case 8:case"end":return e.stop()}}),e,this)})),n=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function s(e){Mi(r,n,o,s,a,"next",e)}function a(e){Mi(r,n,o,s,a,"throw",e)}s(void 0)}))},function(){return n.apply(this,arguments)})},{key:"unload",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this._registeredTools.keys()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.unregisterTools(r)}}catch(e){t=!0,i=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}return this.viewer.toolController.deregisterTool(this.undoTool),this.undoTool=null,this.viewer.removeEventListener(Hi.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.removeEventListener(Hi.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),!0}},{key:"_onModelAdded",value:function(){var e=this;if(1===this.viewer.getVisibleModels().length){var t=!0,i=!1,n=void 0;try{for(var o,r=this._registeredTools.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.autoReactivate&&s.toolsToReactivate.forEach((function(t){return e.viewer.toolController.activateTool(t)}))}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}},{key:"_onModelRemoved",value:function(){if(0===this.viewer.getVisibleModels().length){var e=this.viewer.toolController,t=!0,i=!1,n=void 0;try{for(var o,r=this._registeredTools.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.autoReactivate&&(s.toolsToReactivate=Object.values(s.tools).map((function(e){return e.getNames()})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(t){return e.isToolActivated(t)})),s.toolsToReactivate.forEach((function(t){return e.deactivateTool(t)})))}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}},{key:"_onSelectionChanged",value:function(e){var t=e.target,i=!0,n=!1,o=void 0;try{for(var r,s=this._registeredTools.values()[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t===a.context.selection||t.empty()||a.context.selection.clear()}}catch(e){n=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw o}}}},{key:"registerDefaultTools",value:function(){this.defaultContext=this.registerTools("default")}},{key:"getToolSet",value:function(e){return this._registeredTools.get(e)}},{key:"registerTools",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._registeredTools.get(e);if(i)return console.warn("Edit 2D tools are already registered for tool set '".concat(e,"'")),i.context;i=new ji(e,t),this._registeredTools.set(e,i);var n=i.context=new Ui(this,e);n.selection.addEventListener(d.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),i.tools.polygonTool=new Jt(n,Jt.Mode.Polygon),i.tools.polylineTool=new Jt(n,Jt.Mode.Polyline),i.tools.moveTool=new mt(n),i.tools.polygonEditTool=new mi(n),i.tools.insertSymbolTool=new wi(n),i.tools.copyTool=new Vi(n);var o=Boolean(this.options.enableArcs);i.tools.polygonTool.setArcsEnabled(o),i.tools.polylineTool.setArcsEnabled(o),this.options.enableEllipseArcs&&(i.tools.polygonEditTool.enableEllipseArcs=!0);var r=this.viewer.toolController;return r.registerTool(i.tools.polygonTool),r.registerTool(i.tools.polylineTool),r.registerTool(i.tools.moveTool),r.registerTool(i.tools.polygonEditTool),r.registerTool(i.tools.insertSymbolTool),r.registerTool(i.tools.copyTool),r.activateTool(i.tools.copyTool.getName()),i.contextMenu=new ce(this.viewer,i),i.contextMenu.register(),n}},{key:"unregisterDefaultTools",value:function(){this.unregisterTools("default"),this.defaultContext=null}},{key:"unregisterTools",value:function(e){var t=this._registeredTools.get(e);if(t){var i=this.viewer.toolController;i.deregisterTool(t.tools.polygonTool),i.deregisterTool(t.tools.polylineTool),i.deregisterTool(t.tools.moveTool),i.deregisterTool(t.tools.polygonEditTool),i.deregisterTool(t.tools.insertSymbolTool),i.deregisterTool(t.tools.copyTool),t.context.selection.removeEventListener(d.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),t.contextMenu.unregister(),t.contextMenu=null,this._registeredTools.delete(e)}}},{key:"createLayer",value:function(){this.viewer.model||console.error("A 2D model is needed to adjust viewport");var e=new s(this.viewer);return this.viewer.impl.overlayScenes.Edit2D.scene.add(e.scene),e}},{key:"defaultTools",get:function(){var e=this._registeredTools.get("default");return e&&e.tools}}]),t}(Hi.Extension),Ui=function(){function e(t,i){var n=this;Bi(this,e),this.toolSetName=i,this.viewer=t.viewer,this.layer=t.createLayer(),this.gizmoLayer=t.createLayer(),this.undoStack=t.undoStack,this.selection=new d(this.layer,this.undoStack),this.snapper=new he(this.viewer,this.layer,this.gizmoLayer),this.unitHandler=new Ge(this.viewer);this.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,(function(){n.layer.updateCanvasGizmos(),n.gizmoLayer.updateCanvasGizmos()}))}return Oi(e,[{key:"setMatrix",value:function(e){this.layer.setMatrix(e),this.gizmoLayer.setMatrix(e),this.layer.update(),this.gizmoLayer.update()}},{key:"clearLayer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e){var t=new B.RemoveShapes(this.layer,this.layer.shapes);this.undoStack.run(t)}else this.layer.clear(),this.undoStack.clear()}},{key:"addShape",value:function(e){var t=new B.AddShape(this.layer,e);this.undoStack.run(t)}},{key:"removeShape",value:function(e){var t=new B.AddShape(this.layer,e);this.undoStack.run(t)}}]),e}();Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Edit2D",Ni),Ii.Shape=a.j,Ii.Polygon=a.f,Ii.Polyline=a.h,Ii.PolyBase=a.e,Ii.Path=a.d,Ii.PolygonPath=a.g,Ii.PolylinePath=a.i,Ii.Circle=a.a,Ii.Style=a.l,Ii.EllipseArcParams=a.c,Ii.PolygonTool=Jt,Ii.Selection=d,Ii.MoveTool=mt,Ii.PolygonEditTool=mi,Ii.InsertSymbolTool=wi,Ii.Math2D=y.a,Ii.VertexGizmo=nt,Ii.RectangleTool=Gt,Ii.LineTool=jt,Ii.CopyTool=Vi,Ii.Actions=B,Ii.UndoStack=u,Ii.UndoTool=Ci,Ii.Edit2DContext=Ui,Ii.CanvasGizmo=qe,Ii.CanvasGizmoBase=Xe,Ii.ShapeLabel=Qe,Ii.AlignX=Ke,Ii.AlignY=Ye,Ii.AreaLabel=Je,Ii.EdgeLabel=it,Ii.UnitHandler=ze,Ii.SimpleUnitHandler=Me,Ii.DefaultUnitHandler=Ge,Ii.ShapeLabelRule=at,Ii.ShapeWrapper=a.k,Ii.SegmentTree=re,Ii.TangentGizmo=ft,Ii.MeasureTransform=xe,Ii.DefaultMeasureTransform=Ee,Ii.ShapeToolTip=lt,Ii.Svg=f.a,Ii.SolidDefConvert=k,Ii.BooleanOps=P},6:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,n=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?i+r:n+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}}});
//# sourceMappingURL=Edit2D.min.js.map