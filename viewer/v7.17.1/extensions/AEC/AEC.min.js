/*!
 * LMV v7.17.1
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.AEC=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=572)}({0:function(e,t){e.exports=THREE},1:function(e,t,i){"use strict";i.d(t,"l",(function(){return b})),i.d(t,"j",(function(){return M})),i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return T})),i.d(t,"h",(function(){return A})),i.d(t,"b",(function(){return C})),i.d(t,"c",(function(){return R})),i.d(t,"d",(function(){return I})),i.d(t,"g",(function(){return N})),i.d(t,"i",(function(){return F})),i.d(t,"a",(function(){return H})),i.d(t,"k",(function(){return z}));var n=i(3),o=i(12);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?s(e):t}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t,i){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,i){return t&&p(e.prototype,t),i&&p(e,i),e}var f=1,m=Autodesk.Viewing,g=function(e,t,i){return"rgb("+e+","+t+","+i+")"},y=function(e){return e.map((function(e){return{x:e.x,y:e.y}}))},E=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Box2,b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,e),this.lineColor=t.lineColor||t.color||"rgb(0,0,128)",this.lineAlpha=void 0!==t.lineAlpha?t.lineAlpha:void 0!==t.alpha?t.alpha:1,this.lineWidth=void 0!==t.lineWidth?t.lineWidth:3,this.fillColor=t.fillColor||t.color||"rgb(0,0,128)",this.fillAlpha=void 0!==t.fillAlpha?t.fillAlpha:void 0!==t.alpha?t.alpha:.2,this.lineStyle=t.lineStyle||0,this.isScreenSpace=void 0===t.isScreenSpace||t.isScreenSpace}return v(e,[{key:"setFillColor",value:function(e,t,i){this.fillColor=g(e,t,i)}},{key:"setLineColor",value:function(e,t,i){this.lineColor=g(e,t,i)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.lineColor=e.lineColor,this.lineAlpha=e.lineAlpha,this.lineWidth=e.lineWidth,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.lineStyle=e.lineStyle,this.isScreenSpace=e.isScreenSpace,this}}]),e}();b.toColor=g;var k=new b,S=function(e,t){for(var i=0;i<e.length;i++)t.expandByPoint(e[i])},M=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.clone();d(this,e),this.style=t,this.id=f++,this.bbox=new THREE.Box2,this.bboxDirty=!0,this.name=this.id.toString()}return v(e,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"applyMatrix4",value:function(e){return this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.style=e.style.clone(),this}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}},{key:"getBBox",value:function(){return this.updateBBox(),this.bbox}},{key:"toSVG",value:function(e,t){return o.a.toSvg(this,e,t)}},{key:"createSvgShape",value:function(e){return o.a.toSvgElement(this,e)}}],[{key:"fromSVG",value:function(e,t){return o.a.fromSvg(e,t)}}]),e}();m.GlobalManagerMixin.call(M.prototype);var _=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.clone();return d(this,t),(e=a(this,u(t).call(this,n))).loops=i?[i]:[],e.isClosed=void 0,e}return h(t,e),v(t,[{key:"getLoopCount",value:function(){return this.loops.length}},{key:"loopCount",value:function(){return this.loops.length}},{key:"isPolygon",value:function(){return this.isClosed}},{key:"isPolyline",value:function(){return!this.isClosed}},{key:"isPath",value:function(){return this instanceof I}},{key:"addPoint",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i]||(this.loops[i]=[]),o={x:e,y:t};return n.push(o),this.modified(),o}},{key:"getPoint",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(t=t||new THREE.Vector2).copy(this.loops[i][e])}},{key:"removePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.loops[t].splice(e,1)}},{key:"updatePoint",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=this.loops[n][e];o.x=t,o.y=i,this.modified()}},{key:"insertPoint",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.loops[i].splice(e,0,t)}},{key:"getVertexCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.loops[e];return t?t.length:0}},{key:"clear",value:function(){this.loops=[],this.modified()}},{key:"enumEdges",value:function(e){for(var t=this.getEdgeCount(),i=0;i<t;i++){var n=i,o=this.nextIndex(i);if(e(this.getPoint(n),this.getPoint(o),n,o))return}}},{key:"findEdgeIndex",value:function(e,t){var i=-1;return this.enumEdges((function(o,r,a){var s=n.a.isPointOnEdge(e,o,r,t);return s&&(i=a),s})),i}},{key:"move",value:function(e,t){for(var i=0;i<this.loops.length;i++)for(var n=this.loops[i],o=0;o<n.length;o++)n[o].x+=e,n[o].y+=t;return this.modified(),this}},{key:"applyMatrix4",value:function(e){for(var t=0;t<this.loops.length;t++)for(var i=this.loops[t],n=0;n<i.length;n++){var o=i[n],r=function(t,i,n){var o=E.set(t,i,0).applyMatrix4(e);return n.x=o.x,n.y=o.y,n};if(r(o.x,o.y,o),this.isBezierArc(n,t)){var a=r(o.cp1x,o.cp1y,E);o.cp1x=a.x,o.cp1y=a.y,a=r(o.cp2x,o.cp2y,E),o.cp2x=a.x,o.cp2y=a.y}this.isEllipseArc(n,t)&&o.ellipseArcParams.applyMatrix4(e)}return this.modified(),this}},{key:"addLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.loops[t],n=y(i),o=this.nextFreeLoop();return this.loops[o]=n,this.modified(),o}},{key:"copy",value:function(e){l(u(t.prototype),"copy",this).call(this,e),this.isClosed=e.isClosed,this.loops=[];for(var i=0;i<e.getLoopCount();i++)this.addLoop(e,i);return this}},{key:"computeBBox",value:function(){this.bbox.makeEmpty();for(var e=0;e<this.loops.length;e++){var t=this.loops[e];t&&S(t,this.bbox)}return this.bbox}},{key:"indexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e>=0&&e<this.getVertexCount(t)}},{key:"nextIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return-1;var i=e===this.getVertexCount(t)-1;return i?this.isClosed?0:-1:e+1}},{key:"prevIndex",value:function(e){return this.indexValid(e)?0===e?this.isClosed?this.vertexCount-1:-1:e-1:-1}},{key:"edgeBeforeVertex",value:function(e){return this.prevIndex(e)}},{key:"edgeAfterVertex",value:function(e){return this.edgeIndexValid(e)?e:-1}},{key:"nextEdgeIndex",value:function(e){return this.edgeIndexValid(e)&&(this.isClosed||e!==this.getEdgeCount()-1)?this.nextIndex(e):-1}},{key:"prevEdgeIndex",value:function(e){return this.edgeIndexValid(e)&&(this.isClosed||0!==e)?this.prevIndex(e):-1}},{key:"edgeIndexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.getEdgeCount(t);return e>=0&&e<i}},{key:"prevEdgeExists",value:function(e){return this.edgeIndexValid(e)&&this.vertexCount>2&&(e>0||this.isClosed)}},{key:"nextEdgeExists",value:function(e){var t=edgeIndex===this.vertexCount-2;return this.edgeIndexValid(edgeIndex)&&this.vertexCount>2&&(!t||this.isClosed)}},{key:"getEdge",value:function(e,t,i){var n=e,o=this.nextIndex(e);this.getPoint(n,t),this.getPoint(o,i)}},{key:"getEdgeDirection",value:function(e,t){var i=e,o=this.nextIndex(e);return t=t||new THREE.Vector2,n.a.getEdgeDirection(this.points[i],this.points[o],t)}},{key:"getEdgeLength",value:function(e){var t=e,i=this.nextIndex(e),o=this.points[t],r=this.points[i];return n.a.getEdgeLength(o,r)}},{key:"getEdgeCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.getVertexCount(e);return this.isClosed?t:t-1}},{key:"getLength",value:function(e){for(var t=new THREE.Vector2,i=new THREE.Vector2,n=0,o=0;o<this.getEdgeCount();o++)this.getEdge(o,t,i),e&&(e.apply(t),e.apply(i)),n+=t.distanceTo(i);return n}},{key:"fromBox2",value:function(e){return this.addPoint(e.min.x,e.min.y),this.addPoint(e.max.x,e.min.y),this.addPoint(e.max.x,e.max.y),this.addPoint(e.min.x,e.max.y),this}},{key:"getPointOnEdge",value:function(e,t,i){var n=i||new THREE.Vector2,o=this.points[e],r=this.points[this.nextIndex(e)];return n.lerpVectors(o,r,t)}},{key:"isCCW",value:function(){return Autodesk.Extensions.CompGeom.polygonArea(this.points)>0}},{key:"getLeftEdgeNormal",value:function(e,t){t=t||new THREE.Vector2;var i=e,n=(e+1)%this.vertexCount,o=this.points[i],r=this.points[n];t.subVectors(r,o).normalize();var a=t.x;return t.x=-t.y,t.y=a,t}},{key:"getOuterNormal",value:function(e,t){var i=this.getLeftEdgeNormal(e,t);return this.isCCW()?i.multiplyScalar(-1):i}},{key:"nextFreeLoop",value:function(){var e=this.loops.findIndex((function(e){return!e||!e.length}));return e>=0?e:this.loops.length}},{key:"points",get:function(){return this.loops[0]||(this.loops[0]=[])}},{key:"length",get:function(){return console.warn("poly.length is deprecated and will be removed. Please use poly.vertexCount property instead."),this.points.length}},{key:"vertexCount",get:function(){return this.points.length}}]),t}(M),T=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.clone();return d(this,t),(e=a(this,u(t).call(this,i,n))).isClosed=!0,e}return h(t,e),v(t,[{key:"draw",value:function(e,t){P(e,this,t)}},{key:"hitTest",value:function(e,t){if(!this.vertexCount)return!1;for(var i=0,n=0;n<this.loops.length;n++){var o=this.loops[n];if(o){for(var r=new Autodesk.Extensions.CompGeom.ComplexPolygon(o),a=[],s=0;s<o.length;s++)a.push(s);r.pointInContour(e,t,a)&&i++}}return Boolean(1&i)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"getArea",value:function(e){if(this.points.length<3)return 0;var t=0;return this.enumEdges((function(i,n){e&&e.apply(i),e&&e.apply(n),t+=i.x*n.y-n.x*i.y})),Math.abs(.5*t)}}]),t}(_),A=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.clone();return d(this,t),(e=a(this,u(t).call(this,i,n))).isClosed=!1,e}return h(t,e),v(t,[{key:"makeLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!==this.vertexCount?(this.clear(),this.addPoint(e,t),this.addPoint(i,n)):(this.updatePoint(0,e,t),this.updatePoint(1,i,n)),this}},{key:"draw",value:function(e,t){P(e,this,t)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"hitTest",value:function(e,t,i){return-1!==this.findEdgeIndex({x:e,y:t},i)}}]),t}(_),C={Line:0,Bezier:1,Ellipse:2},V=null,L=function(){return V=V||new Autodesk.Extensions.CompGeom.EllipseArc},D=new THREE.Vector2,O=function(e,t,i){var n=t.loops[i];if(n&&n.length){e.moveTo(n[0].x,n[0].y);for(var o=function(n,o,r){switch(n.arcType){case C.Line:break;case C.Bezier:return void e.bezierCurveTo(n.cp1x,n.cp1y,n.cp2x,n.cp2y,o.x,o.y);case C.Ellipse:var a=n.ellipseArcParams,s=t.exportEllipseArc(r,L(),i);if(!s.isValid())break;return void(e.ellipseArcTo?e.ellipseArcTo(a.rx,a.ry,THREE.Math.degToRad(a.rotation),a.largeArcFlag,a.sweepFlag,o.x,o.y):e.ellipse(s.cx,s.cy,s.rx,s.ry,s.rotation,s.startAngle,s.endAngle,s.ccw))}e.lineTo(o.x,o.y)},r=1;r<n.length;r+=1){o(n[r-1],n[r],r-1)}if(t.isClosed)o(n[n.length-1],n[0],n.length-1),e.closePath()}},B=function(e,t){for(var i=0;i<t.loopCount();i++)O(e,t,i)},P=function(e,t,i){if(t.vertexCount){var n=i||t.style;e.dbId=t.id,e.lineStyle=n.lineStyle,e.isScreenSpace=n.isScreenSpace,e.beginPath(),B(e,t);var o=e.canvasContext;t.isClosed&&(o.fillStyle=n.fillColor,o.globalAlpha=n.fillAlpha,e.fill()),o.strokeStyle=n.lineColor,o.globalAlpha=n.lineAlpha,o.lineWidth=n.lineWidth,n.isScreenSpace&&(o.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}},R=function(){function e(){d(this,e),this.rx=0,this.ry=0,this.rotation=0,this.largeArcFlag=!1,this.sweepFlag=!1}return v(e,[{key:"copy",value:function(e){return this.rx=e.rx,this.ry=e.ry,this.rotation=e.rotation,this.largeArcFlag=e.largeArcFlag,this.sweepFlag=e.sweepFlag,this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"rotate",value:function(e){this.rotation+=e,this.rotation-=360*Math.trunc(this.rotation/360)}},{key:"scale",value:function(e){this.rx*=e,this.ry*=e}},{key:"applyMatrix4",value:function(e){E.set(1,0,0).applyMatrix4(e),w.set(0,0,0).applyMatrix4(e);var t=E.sub(w),i=THREE.Math.radToDeg(Math.atan2(t.y,t.x)),o=t.length();this.rotate(i),this.scale(o),n.a.changesOrientation(e)&&(this.sweepFlag=!this.sweepFlag,this.rotation=360-this.rotation)}}]),e}(),I=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.clone();return d(this,t),(i=a(this,u(t).call(this,e,o))).isClosed=n,i}return h(t,e),v(t,[{key:"_updateEllipseArcParams",value:function(e,t,i){var o=this.points[e].ellipseArcParams,r=this.getEdgeDirection(e),a=n.a.getEdgeDirection(t,i),s=n.a.angleBetweenDirections(a,r);o.rotate(THREE.Math.radToDeg(s));var l=this.getEdgeLength(e),u=n.a.distance2D(t,i)/l;isFinite(u)&&u>0&&o.scale(u)}},{key:"updatePoint",value:function(e,t,i){var n=this.points[e],o=D.set(t,i),r=t-n.x,a=i-n.y;if(this.isBezierArc(e)&&(n.cp1x+=r,n.cp1y+=a),this.isEllipseArc(e)){var s=this.points[this.nextIndex(e)];this._updateEllipseArcParams(e,o,s)}var l=this.edgeBeforeVertex(e);if(this.edgeIndexValid(l)){var u=this.points[l];this.isBezierArc(l)&&(u.cp2x+=r,u.cp2y+=a),this.isEllipseArc(l)&&this._updateEllipseArcParams(l,u,o)}n.x=t,n.y=i,this.modified()}},{key:"getEdgeType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.loops[t][e].arcType;return i||C.Line}},{key:"setBezierArc",value:function(e,t,i,n,o){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=this.loops[r][e];a.arcType=C.Bezier,a.cp1x=t,a.cp1y=i,a.cp2x=n,a.cp2y=o,this.modified()}},{key:"setEllipseArc",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i][e];n.arcType=C.Ellipse,n.ellipseArcParams=t.clone(),this.modified()}},{key:"getEllipseArcParams",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i][e],o=n&&n.arcType===C.Ellipse&&n.ellipseArcParams;return o&&(t||new R).copy(o)}},{key:"exportEllipseArc",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.loops[i],o=this.nextIndex(e,i),r=n[e],a=n[o],s=r.ellipseArcParams,l=t||new EllipseArc;return l.setFromSvgArc(s.rx,s.ry,s.rotation,s.largeArcFlag,s.sweepFlag,r,a),l}},{key:"isBezierArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this.loops[t][e].arcType===C.Bezier}},{key:"isEllipseArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this.loops[t][e].arcType===C.Ellipse}},{key:"isArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.isBezierArc(e,t)||this.isEllipseArc(e,t)}},{key:"getStartTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t||new THREE.Vector2,n=this.points[e];return i.x=n.cp1x-n.x,i.y=n.cp1y-n.y,i}},{key:"getEndTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t||new THREE.Vector2,n=this.nextIndex(e),o=this.points[e],r=this.points[n];return i.x=o.cp2x-r.x,i.y=o.cp2y-r.y,i}},{key:"setStartTangent",value:function(e,t){var i=this.points[e];i.cp1x=i.x+t.x,i.cp1y=i.y+t.y,this.modified()}},{key:"setEndTangent",value:function(e,t){var i=this.points[e],n=this.points[this.nextIndex(e)];i.cp2x=n.x+t.x,i.cp2y=n.y+t.y,this.modified()}},{key:"removeArc",value:function(e){var t=this.points[e];t.arcType===C.Bezier&&(t.cp1x=void 0,t.cp1y=void 0,t.cp2x=void 0,t.cp2y=void 0),t.ellipseArcParams&&(t.ellipseArcParams=void 0),t.arcType=C.Line}},{key:"getControlPoint",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=i||new THREE.Vector2,r=this.loops[n][e];return 1===t?(o.x=r.cp1x,o.y=r.cp1y):(o.x=r.cp2x,o.y=r.cp2y),o}},{key:"updateControlPoint",value:function(e,t,i,n){var o=this.points[e];1===t?(o.cp1x=i,o.cp1y=n):(o.cp2x=i,o.cp2y=n),this.modified()}},{key:"draw",value:function(e,t){P(e,this,t)}},{key:"toPoly",value:function(){for(var e=this,t=this.isClosed?new T:new A,i=function(i){e.updateBBox();var n=e.bbox.size().length(),o={moveTo:function(e,n){return t.addPoint(e,n,i)},lineTo:function(e,n){return t.addPoint(e,n,i)},bezierCurveTo:function(e,i,r,a,s,l){var u=t.points[t.vertexCount-1];Autodesk.Extensions.CompGeom.TesselateCubic(o,u.x,u.y,e,i,r,a,s,l,n)},ellipse:function(e,t,i,r,a,s,l,u){var h=this.tessParams||Autodesk.Extensions.CompGeom.DefaultTessParams,c=h.numIterations,d=h.minSegLenFraction*n;L().set(e,t,i,r,a,s,l,u).tesselate(o,c,d)},closePath:function(){}};O(o,e,i)},n=0;n<this.loops.length;n++)i(n);return t}},{key:"computeBBox",value:function(){l(u(t.prototype),"computeBBox",this).call(this);for(var e=new THREE.Vector2,i=0;i<this.getLoopCount();i++)for(var n=0;n<this.getVertexCount(i);n++)if(this.isBezierArc(n,i))this.getControlPoint(n,1,e,i),this.bbox.expandByPoint(e),this.getControlPoint(n,2,e,i),this.bbox.expandByPoint(e);else if(this.isEllipseArc(n)){var o=this.exportEllipseArc(n,L(),i);this.bbox.union(o.computeBBox(x))}}},{key:"hitTest",value:function(e,t,i){return this.toPoly().hitTest(e,t,i)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"addLoop",value:function(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=l(u(t.prototype),"addLoop",this).call(this,e,i),o=e.loops[i],r=this.loops[n],a=0;a<o.length;a++){var s=e.getEdgeType(a,i);if(s!==C.Line){var h=o[a],c=r[a];switch(c.arcType=h.arcType,s){case C.Bezier:c.cp1x=h.cp1x,c.cp1y=h.cp1y,c.cp2x=h.cp2x,c.cp2y=h.cp2y;break;case C.Ellipse:c.ellipseArcParams=h.ellipseArcParams&&h.ellipseArcParams.clone()}}}return this}},{key:"move",value:function(e,i){l(u(t.prototype),"move",this).call(this,e,i);for(var n=0;n<this.loops.length;n++)for(var o=this.loops[n],r=0;r<o.length;r++)if(this.isBezierArc(r,n)){var a=o[r];a.cp1x+=e,a.cp1y+=i,a.cp2x+=e,a.cp2y+=i}return this.modified(),this}},{key:"getArea",value:function(e){if(this.isClosed)return this.toPoly().getArea(e)}},{key:"getLength",value:function(e){return this.toPoly().getLength(e)}},{key:"getPointOnEdge",value:function(e,i,n){switch(this.getEdgeType(e)){case C.Line:break;case C.Bezier:var o=this.points[e],r=this.points[this.nextIndex(e)],a=n||new THREE.Vector2;return Autodesk.Extensions.CompGeom.getCubeBezierPoint(i,o.x,o.y,o.cp1x,o.cp1y,o.cp2x,o.cp2y,r.x,r.y,a);case C.Ellipse:var s=this.exportEllipseArc(e,L());if(!s.isValid())break;return s.getPoint(i,n);default:avp.logger.error("unexpected edge type")}return l(u(t.prototype),"getPointOnEdge",this).call(this,e,i,n)}},{key:"runPathCommands",value:function(e){B(e,this)}}]),t}(_),N=function(e){function t(e,i){return d(this,t),a(this,u(t).call(this,e,!0,i))}return h(t,e),t}(I),F=function(e){function t(e,i){return d(this,t),a(this,u(t).call(this,e,!1,i))}return h(t,e),t}(I),H=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.clone(),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return d(this,t),(e=a(this,u(t).call(this,r))).polygon=new T([],r),e.polygon.id=e.id,e.centerX=i,e.centerY=n,e.radius=o,e.tessSegments=s,e.needsUpdate=!0,e}return h(t,e),v(t,[{key:"draw",value:function(e,t){this.polygon.points.length=0;for(var i=360/this.tessSegments,n=0;n<360;n+=i){var o=n*Math.PI/180,r=this.radius*Math.cos(o),a=this.radius*Math.sin(o);this.polygon.addPoint(this.centerX+r,this.centerY+a)}this.needsUpdate=!1,this.polygon.draw(e,t)}},{key:"setCenter",value:function(e,t){this.centerX=e,this.centerY=t,this.modified()}},{key:"move",value:function(e,t){this.centerX+=e,this.centerY+=t,this.modified()}},{key:"hitTest",value:function(e,t){var i=e-this.centerX,n=t-this.centerY;return i*i+n*n<this.radius*this.radius}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){return l(u(t.prototype),"copy",this).call(this,e),this.polygon=e.polygon.clone(),this.centerX=e.centerX,this.centerY=e.centerY,this.radius=e.radius,this.tessSegments=e.tessSegments,this.modified(),this}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}]),t}(M),z=function(e){function t(e){var i;return d(this,t),(i=a(this,u(t).call(this))).shape=e,Object.defineProperty(s(i),"bbox",{get:function(){return i.shape.bbox},set:function(e){i.shape.bbox=e}}),Object.defineProperty(s(i),"id",{get:function(){return i.shape.id},set:function(e){i.shape.id=e}}),Object.defineProperty(s(i),"bboxDirty",{get:function(){return i.shape.bboxDirty},set:function(e){i.shape.bboxDirty=e}}),Object.defineProperty(s(i),"name",{get:function(){return i.shape.name},set:function(e){i.shape.name=e}}),i}return h(t,e),v(t,[{key:"draw",value:function(){var e;return(e=this.shape).draw.apply(e,arguments)}},{key:"hitTest",value:function(){var e;return(e=this.shape).hitTest.apply(e,arguments)}},{key:"move",value:function(){var e;return(e=this.shape).move.apply(e,arguments)}},{key:"modified",value:function(){var e;return(e=this.shape).modified.apply(e,arguments)}},{key:"computeBBox",value:function(){var e;return(e=this.shape).computeBBox.apply(e,arguments)}},{key:"updateBBox",value:function(){var e;return(e=this.shape).updateBBox.apply(e,arguments)}},{key:"clone",value:function(){return new t(this.shape.clone())}},{key:"copy",value:function(e){this.shape.copy(e.shape)}}]),t}(M)},12:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var n=i(1),o=i(3);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=null,s="http://www.w3.org/2000/svg",l=Math.pow(10,4),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||null===t)return e;var i=4===t?l:Math.pow(10,t);return Math.round(e*i)/i},h=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return'<circle cx="'.concat(u(e.centerX,t),'" cy="').concat(u(e.centerY,t),'" r="').concat(u(e.radius,t)).concat(i,'"/>')},c=function(e){for(var t,i=e.split(/ (?=[a-zA-Z])/gi),r={x:0,y:0},a=[],s=!1,l=0;l<i.length;l++){var u=i[l];if(-1==="MLHVCZA".indexOf(u[0]))throw'"'.concat(u[0],'" is not a supported or invalid glyph: ').concat(u);var h=u.substring(1);switch(u[0]){case"M":case"L":var c=h.split(",");t={x:parseFloat(c[0]),y:parseFloat(c[1])},"M"===u[0]&&a.shift();break;case"H":t={x:parseFloat(h),y:r.y};break;case"V":t={x:r.x,y:parseFloat(h)};break;case"C":var d=h.split(",");t={x:parseFloat(d[4]),y:parseFloat(d[5])},r.arcType=n.b.Bezier,r.cp1x=parseFloat(d[0]),r.cp1y=parseFloat(d[1]),r.cp2x=parseFloat(d[2]),r.cp2y=parseFloat(d[3]);break;case"A":var p=h.split(",");t={x:parseFloat(p[5]),y:parseFloat(p[6])},r.arcType=n.b.Ellipse;var v=new n.c;v.rx=parseFloat(p[0]),v.ry=parseFloat(p[1]),v.rotation=parseFloat(p[2]),v.largeArcFlag=Boolean(parseFloat(p[3])),v.sweepFlag=Boolean(parseFloat(p[4])),r.ellipseArcParams=v;break;case"Z":s=!0;continue}r=t,a.push(t)}return o.a.pointDelta(a[0],a[a.length-1],0)||a.pop(),{points:a,isPolygon:s}},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e.vertexCount)return[];var r=[];r.push("M ".concat(u(e.points[0].x,i),",").concat(u(e.points[0].y,i)));for(var a=1;a<e.points.length;a+=1){var s=e.points[a-1],l=e.points[a],h=void 0;switch(s.arcType){case n.b.Ellipse:var c=s.ellipseArcParams,d=c.largeArcFlag?1:0,p=c.sweepFlag?1:0;h="A ".concat(c.rx,",").concat(c.ry,",").concat(c.rotation,",").concat(d,",").concat(p,",").concat(l.x,",").concat(l.y);break;case n.b.Bezier:h="C ".concat(u(s.cp1x,i),",").concat(u(s.cp1y,i),",").concat(u(s.cp2x,i),",").concat(u(s.cp2y,i),",").concat(u(l.x,i),",").concat(u(l.y,i));break;default:var v=o.a.pointDelta(s,l,i);if(!v)continue;h=Math.abs(v.x)<=t?"V ".concat(u(l.y,i)):Math.abs(v.y)<=t?"H ".concat(u(l.x,i)):"L ".concat(u(l.x,i),",").concat(u(l.y,i))}r.push(h)}if(e.isClosed){var f=e.points[e.points.length-1];if(f.arcType===n.b.Bezier){var m=e.points[0],g="C ".concat(u(f.cp1x,i),",").concat(u(f.cp1y,i),",").concat(u(f.cp2x,i),",").concat(u(f.cp2y,i),",").concat(u(m.x,i),",").concat(u(m.y,i));r.push(g)}r.push("Z")}return r},p=function(e){var t={};return t.stroke=e.lineColor,t.fill=e.fillColor,t["stroke-width"]=e.lineWidth,1!=e.lineAlpha&&(t["stroke-opacity"]=e.lineAlpha),1!=e.fillAlpha&&(t["fill-opacity"]=e.fillAlpha),t},v=function(e){var t="";for(var i in e)t+=" ".concat(i,'="').concat(e[i],'"');return t},f=function(e,t){var i=t&&t.precision||0,o=t&&t.digits||0,r=t&&t.exportStyle||!0;if(e instanceof n.e){var a=document.createElementNS(s,"path");if(a.setAttribute("d",d(e,i,o)),r)!function(e,t){for(var i in t)e.setAttribute(i,t[i])}(a,p(e.style));return a}console.error("SVG serialization not supported for this shape: ",e)},m={toSvg:function(e,t){var i=t&&t.precision||0,o=t&&t.digits||null,a=t&&t.exportStyle||!1,s="";if(a){var l=p(e.style);s=v(l)}if("object"!==r(t)&&("number"==typeof arguments[1]&&(i=arguments[1]),"number"==typeof arguments[2]&&(o=arguments[2])),e instanceof n.a)return h(e,i,o,s);if(e instanceof n.e){var u=d(e,i,o);return'<path d="'.concat(u.join(" "),'"').concat(s,"/>")}console.error("SVG serialization not supported for this shape: ",e)},fromSvg:function(e,t){if(e){var i=(a=a||new DOMParser).parseFromString(e,"application/xml"),o=t&&t.forcePaths;if(1!==i.childNodes.length)throw"Function does only support svg with a single element: path, circle";var r=i.firstChild;if("circle"===r.nodeName)return function(e){if(!e.hasAttributes||!e.hasAttributes())throw"No attributes available on the <circle/> node";for(var t=new n.a,i=e.attributes.length-1;i>=0;i--){var o=e.attributes[i];switch(o.name){case"cx":t.centerX=parseFloat(o.value);break;case"cy":t.centerY=parseFloat(o.value);break;case"r":t.radius=parseFloat(o.value)}}return t}(r);if("path"===r.nodeName)return function(e,t){var i=e.getAttribute("d");if(i){var o=c(i),r=o.points,a=o.isPolygon;return t||r.find((function(e){return void 0!==e.arcType}))?new n.d(r,a):a?new n.f(r):new n.h(r)}}(r,o);throw"Unsupported svg node type: ".concat(r.nodeName)}},createSvgShape:f,createSvgElement:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new THREE.Box2;e.forEach((function(e){return i.union(e.getBBox())}));var n=t.srcBox||i,r=t.dstBox||i,a={preserveAspect:!0,flipY:!0},l=o.a.getFitToBoxTransform(n,r,a),u=r.max.x-r.min.x,h=r.max.y-r.min.y,c=document.createElementNS(s,"svg");return c.setAttribute("height",u),c.setAttribute("width",h),e.forEach((function(e){var i=e.clone().applyMatrix4(l),n=f(i,t);c.appendChild(n)})),c}}},154:function(e){e.exports=JSON.parse('{"@@locale":"en","@@context":"Minimap3D Extension","Show large map":"Show large map","Show small map":"Show small map","Show sheet":"Show sheet","Hide sheet":"Hide sheet","Loading sheet...":"Loading sheet...","Loading models...":"Loading models..."}')},155:function(e){e.exports=JSON.parse('{"@@locale":"cs","@@context":"Rozšíření Minimap3D","Show large map":"Zobrazit velkou mapu","Show small map":"Zobrazit malou mapu","Show sheet":"Zobrazit list","Hide sheet":"Hide sheet","Loading sheet...":"Načítání listu...","Loading models...":"Načítání modelů..."}')},156:function(e){e.exports=JSON.parse('{"@@locale":"de","@@context":"Minimap3D-Erweiterung","Show large map":"Große Karte anzeigen","Show small map":"Kleine Karte anzeigen","Show sheet":"Plan anzeigen","Hide sheet":"Hide sheet","Loading sheet...":"Plan wird geladen...","Loading models...":"Modelle werden geladen..."}')},157:function(e){e.exports=JSON.parse('{"@@locale":"es","@@context":"Extensión de minimapa 3D","Show large map":"Mostrar mapa grande","Show small map":"Mostrar mapa pequeño","Show sheet":"Mostrar plano","Hide sheet":"Hide sheet","Loading sheet...":"Cargando plano...","Loading models...":"Cargando modelos..."}')},158:function(e){e.exports=JSON.parse('{"@@locale":"fr","@@context":"Extension Minimap3D","Show large map":"Afficher une grande carte","Show small map":"Afficher une petite carte","Show sheet":"Afficher une feuille","Hide sheet":"Hide sheet","Loading sheet...":"Chargement de la feuille…","Loading models...":"Chargement des modèles…"}')},159:function(e){e.exports=JSON.parse('{"@@locale":"fr-CA","@@context":"Extension Minimap3D","Show large map":"Afficher la grande carte","Show small map":"Afficher la petite carte","Show sheet":"Afficher la feuille","Hide sheet":"Hide sheet","Loading sheet...":"Chargement de la feuille...","Loading models...":"Chargement des modèles..."}')},160:function(e){e.exports=JSON.parse('{"@@locale":"it","@@context":"Estensione Minimap3D","Show large map":"Mostra mappa di grandi dimensioni","Show small map":"Mostra mappa di piccole dimensioni","Show sheet":"Mostra foglio","Hide sheet":"Hide sheet","Loading sheet...":"Caricamento foglio in corso...","Loading models...":"Caricamento modelli in corso..."}')},161:function(e){e.exports=JSON.parse('{"@@locale":"ja","@@context":"Minimap3D Extension","Show large map":"大きいマップを表示","Show small map":"小さいマップを表示","Show sheet":"シートを表示","Hide sheet":"Hide sheet","Loading sheet...":"シートをロード中...","Loading models...":"モデルをロード中..."}')},162:function(e){e.exports=JSON.parse('{"@@locale":"ko","@@context":"Minip3D 확장 프로그램","Show large map":"큰 맵 표시","Show small map":"작은 맵 표시","Show sheet":"시트 표시","Hide sheet":"Hide sheet","Loading sheet...":"시트 로드 중...","Loading models...":"모델 로드 중..."}')},163:function(e){e.exports=JSON.parse('{"@@locale":"pl","@@context":"Rozszerzenie Minimap3D","Show large map":"Pokaż dużą mapę","Show small map":"Pokaż małą mapę","Show sheet":"Pokaż arkusz","Hide sheet":"Hide sheet","Loading sheet...":"Wczytywanie arkusza...","Loading models...":"Wczytywanie modeli..."}')},164:function(e){e.exports=JSON.parse('{"@@locale":"pt","@@context":"Extensão Minimap3D","Show large map":"Mostrar mapa grande","Show small map":"Mostrar mapa pequeno","Show sheet":"Mostrar folha","Hide sheet":"Hide sheet","Loading sheet...":"Carregando folha...","Loading models...":"Carregando modelos..."}')},165:function(e){e.exports=JSON.parse('{"@@locale":"ru","@@context":"Расширение Minimap3D","Show large map":"Показать большую карту","Show small map":"Показать маленькую карту","Show sheet":"Показать лист","Hide sheet":"Hide sheet","Loading sheet...":"Загрузка листа...","Loading models...":"Загрузка моделей..."}')},166:function(e){e.exports=JSON.parse('{"@@locale":"tr","@@context":"Minimap3D Uzantısı","Show large map":"Büyük haritayı göster","Show small map":"Küçük haritayı göster","Show sheet":"Sayfayı göster","Hide sheet":"Hide sheet","Loading sheet...":"Sayfa yükleniyor...","Loading models...":"Model yükleniyor..."}')},167:function(e){e.exports=JSON.parse('{"@@locale":"zh-Hans","@@context":"Minimap3D 扩展","Show large map":"显示大型贴图","Show small map":"显示小贴图","Show sheet":"显示图纸","Hide sheet":"Hide sheet","Loading sheet...":"正在加载图纸...","Loading models...":"正在加载模型..."}')},168:function(e){e.exports=JSON.parse('{"@@locale":"zh-Hant","@@context":"Minimap3D 延伸","Show large map":"展示大地圖","Show small map":"展示小地圖","Show sheet":"展示圖紙","Hide sheet":"Hide sheet","Loading sheet...":"正在載入圖紙...","Loading models...":"正在載入模型..."}')},169:function(e){e.exports=JSON.parse('{"@@locale":"nl","@@context":"Minimap3D-extensie","Show large map":"Grote kaart weergeven","Show small map":"Kleine kaart weergeven","Show sheet":"Blad weergeven","Hide sheet":"Hide sheet","Loading sheet...":"Blad laden...","Loading models...":"Modellen laden..."}')},170:function(e){e.exports=JSON.parse('{"@@locale":"sv","@@context":"Minimap3D-tillägg","Show large map":"Visa stor karta","Show small map":"Visa liten karta","Show sheet":"Visa blad","Hide sheet":"Hide sheet","Loading sheet...":"Läser in blad...","Loading models...":"Läser in modeller..."}')},171:function(e){e.exports=JSON.parse('{"@@locale":"da","@@context":"Minimap3D-udvidelse","Show large map":"Vis stort kort","Show small map":"Vis lille kort","Show sheet":"Vis ark","Hide sheet":"Hide sheet","Loading sheet...":"Indlæser ark...","Loading models...":"Indlæser modeller..."}')},172:function(e,t){e.exports="void main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},173:function(e,t){e.exports="uniform sampler2D sheetMap;\nuniform vec2 resolution;\nvoid main() {\n    vec2 uv = vec2(gl_FragCoord.x * resolution.x, gl_FragCoord.y * resolution.y);\n    vec4 c = texture2D(sheetMap, uv);\n    if (c.a == 0.0)\n        discard;\n    \n    gl_FragColor = c;\n}\n"},3:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n,o=new THREE.Vector2,r=new THREE.Vector2,a=function(e,t,i){var n=(e.x-t.x)*i.x+(e.y-t.y)*i.y;e.set(t.x+n*i.x,t.y+n*i.y)},s=(n=new THREE.Vector2,function(e,t,i){return a(n.copy(e),t,i),e.distanceTo(n)}),l=function(e,t,i,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=i.x-t.x,a=i.y-t.y,s=Math.sqrt(r*r+a*a),l={v1:t,dx:r,dy:a,length:s,length2:s*s};return Autodesk.Extensions.CompGeom.pointOnLine(e.x,e.y,l,o,n)},u=function(e,t,i){return Math.abs(e-t)<i},h={getEdgeDirection:function(e,t,i){return(i=i||new THREE.Vector2).copy(t).sub(e).normalize()},projectToLine:a,pointLineDistance:s,intersectLines:function(e,t,i,n,o){var r=n.y*t.x-n.x*t.y;if(Math.abs(r)<1e-8)return!1;var a=e.x-i.x,s=e.y-i.y,l=n.x*s-n.y*a;return o&&(o.x=e.x+l/r*t.x,o.y=e.y+l/r*t.y),!0},rotateAround:function(e,t,i){var n=Math.cos(t),o=Math.sin(t);i&&e.sub(i);var r=e.x,a=e.y;return e.x=r*n-a*o,e.y=r*o+a*n,i&&e.add(i),e},angleBetweenDirections:function(e,t){var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i+=2*Math.PI),i},getEdgeCenter:function(e,t,i){return(i=i||new THREE.Vector2).set(.5*(e.x+t.x),.5*(e.y+t.y))},getEdgeLength:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},turnLeft:function(e){var t=e.x;return e.x=-e.y,e.y=t,e},isPointOnEdge:l,isPointOnLine:function(e,t,i,n){return l(e,t,i,n,!1)},pointDelta:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={x:t.x-e.x,y:t.y-e.y};if(i){var o=Math.pow(10,i);n.x=Math.round(n.x*o)/o,n.y=Math.round(n.y*o)/o}if(n.x||n.y)return n},edgeIsDegenerated:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10;return e.distanceToSquared(t)<i},mirrorPointOnPoint:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(i=i||new THREE.Vector2).x=t.x-(e.x-t.x),i.y=t.y-(e.y-t.y),i},fuzzyEqual:u,collinear:function(e,t,i,n,o){var r=u(t.x,n.x,o)&&u(t.y,n.y,o),a=u(t.x,-n.x,o)&&u(t.y,-n.y,o);if(!r&&!a)return!1;var s=i.x-e.x,l=i.y-e.y,h=s*t.x+l*t.y;return Math.abs(h)<o},distance2D:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},changesOrientation:function(e){return e.determinant()<0},getFitToBoxTransform:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Matrix4,a=e.size(o),s=t.size(r),l=s.x/a.x,u=s.y/a.y;i.preserveAspect&&(u=l=Math.min(l,u));var h=e.min.x,c=e.min.y;i.flipY&&(u*=-1,c=e.max.y);var d=-l*h+t.min.x,p=-u*c+t.min.y,v=n.makeScale(l,u,1);return v.elements[12]=d,v.elements[13]=p,v}}},313:function(e,t,i){var n=i(314);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(5)(n,o);n.locals&&(e.exports=n.locals)},314:function(e,t,i){(e.exports=i(4)(!1)).push([e.i,'.list-panel{width:260px;min-width:260px;height:260px;min-height:260px;top:180px;left:220px;border-color:transparent}.list-panel .itemList{width:100%;display:flex;flex-direction:column}.list-panel .listItem{display:flex;justify-content:space-between;text-align:left;line-height:35px;background-color:rgba(0,0,0,0);border-style:none;font-family:"ArtifaktElement", "Helvetica Neue", "Segoe UI Semilight", sans-serif;padding:0 15px}.adsk-viewing-viewer.dark-theme .listItem{color:#f3f7fb}.adsk-viewing-viewer.light-theme .list-panel .listItem:hover{background-color:rgba(10,19,28,0.2)}.adsk-viewing-viewer.dark-theme .list-panel .listItem:hover{background-color:#4a555b}.list-panel .listItem:focus{outline:none}.list-panel .listItem.selected{color:#00bfff;border-style:none}.list-panel .listItem .textContainer{-webkit-mask-image:linear-gradient(to left, transparent, black 1em);mask-image:linear-gradient(to left, transparent, black 1em);white-space:nowrap;overflow:hidden;width:100%}.list-panel .listItem .icon{width:24px}.list-panel .listItem.selected .icon::before{content:\'\\2713\';margin-left:8px}.list-panel-item-warning{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScyNCcgaGVpZ2h0PScyNCcgdmlld0JveD0nMCAwIDggOCc+PHBhdGggZmlsbD0nIzZiNzg3ZicgZD0nTTMuMDkgMGMtLjA2IDAtLjEuMDQtLjEzLjA5bC0yLjk0IDYuODFjLS4wMi4wNS0uMDMuMTMtLjAzLjE5di44MWMwIC4wNS4wNC4wOS4wOS4wOWg2LjgxYy4wNSAwIC4wOS0uMDQuMDktLjA5di0uODFjMC0uMDUtLjAxLS4xNC0uMDMtLjE5bC0yLjk0LTYuODFjLS4wMi0uMDUtLjA3LS4wOS0uMTMtLjA5aC0uODF6bS0uMDkgM2gxdjJoLTF2LTJ6bTAgM2gxdjFoLTF2LTF6JyAvPjwvc3ZnPg==");width:24px;height:24px;margin-left:auto;margin-top:auto;margin-bottom:auto}\n',""])},315:function(e,t,i){var n=i(316);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(5)(n,o);n.locals&&(e.exports=n.locals)},316:function(e,t,i){(e.exports=i(4)(!1)).push([e.i,".camera-selector{width:0;height:0;border-left:50px solid transparent;border-right:50px solid transparent;border-top:100px solid #0696D7;border-radius:50%;transform-origin:bottom center;position:absolute;opacity:0.8;pointer-events:none;z-index:1}.camera-selector-position{width:20px;height:20px;border-radius:50%;background-color:#0696D7;position:absolute;opacity:0.8;pointer-events:none;z-index:1;transform:scale(1, 1);transition:transform 3s ease-in}.camera-selector-position--teleporting{transform:scale(0, 0)}.camera-selector-background{width:200px;height:200px;background-color:#0696D7;opacity:0.2;position:absolute;pointer-events:none;z-index:0;transform:translate(-100px, -100px);border-radius:50%}.dropme-guidenace-ui{display:flex;position:absolute;left:50%;top:20px;padding:10px 20px;transform:translate(-50%, 0);align-items:center;border:1px solid #9ec8f6;border-radius:4px;background-color:#edf5fd;color:#039be5;font-size:12px;box-shadow:0 2px 4px 0 rgba(0,0,0,0.25);opacity:1;z-index:999;overflow-y:hidden}\n",""])},317:function(e,t,i){var n=i(318);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(5)(n,o);n.locals&&(e.exports=n.locals)},318:function(e,t,i){(e.exports=i(4)(!1)).push([e.i,".canvas-bookmark.adsk-button,.clustered-canvas-bookmark.adsk-button,.declustered-canvas-bookmark.adsk-button{position:absolute;left:0px;top:0px;border-style:none !important;color:white;margin:none;padding:0px;transition:visibility 0.5s, opacity 0.5s;opacity:0;visibility:hidden}.canvas-bookmark.adsk-button{width:22px;height:22px}.clustered-canvas-bookmark.adsk-button{width:29px;height:29px}.declustered-canvas-bookmark.adsk-button{width:29px;height:29px;color:lightgrey}.canvas-bookmark.visible{opacity:1;visibility:visible}.clustered-canvas-bookmark.visible{opacity:1;visibility:visible}\n",""])},319:function(e,t,i){var n=i(320);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(5)(n,o);n.locals&&(e.exports=n.locals)},320:function(e,t,i){(e.exports=i(4)(!1)).push([e.i,'.minimap3D{width:0px;height:0px;right:10px;top:10px;position:absolute;display:flex;flex-direction:column;transition:visibility 0.7s, opacity 0.7s;opacity:0;visibility:hidden;background:rgba(255,255,255,0.4);user-select:none;border-radius:4px;box-shadow:1px 1px 8px rgba(0,0,0,0.4)}.minimap3D.paddedForToolbar{right:70px}.minimapScrollArea{width:100%;height:100%;position:relative}.minimap3D.side-by-side{right:0px;top:0px;box-sizing:border-box;box-shadow:0px 0px 3px rgba(0,0,0,0.5);z-index:1;overflow-x:hidden}.minimap3D.side-by-side.left-2d-view{border-left:none;border-right:solid 2px #979797;left:0px}.minimap3D.visible{opacity:1;visibility:visible}.mapContainer{position:absolute;left:0px;top:0px;opacity:1}.mapImage{position:absolute;left:0px;top:0px;pointer-events:none}.floorNameLabel{z-index:2;position:absolute;top:0px;left:0px;opacity:0.99;background-color:#f5f5f5;box-shadow:1px 3px 10px 0 rgba(0,0,0,0.5);margin:4px;border-radius:5px}.floorNameLabel.dark{margin-top:10px;left:50%;transform:translate(-50%);border-radius:28px;background-color:rgba(50,50,50,0.8)}.floorNameLabel.light{margin-top:10px;left:50%;transform:translate(-50%);border-radius:28px;background-color:rgba(255,255,255,0.85);box-shadow:none}.floorText{margin:5px 5px 5px 5px;color:black;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.floorText.dark{padding:0px 15px;color:#FFFFFF;font-family:"Artifakt Element", Helvetica, Arial;font-size:14px}.floorText.light{padding:0px 15px;color:#000;font-family:"Artifakt Element", Helvetica, Arial;font-size:14px}.minimap-placeholder{left:0px;top:0px;position:absolute;background-color:rgba(255,255,255,0.5);opacity:1}.minimap-progressWidget{transform:translate(0, -50%);left:0px;top:50%;position:relative;height:fit-content;width:calc(100% - 60px);margin-left:30px;margin-right:30px}.minimap-progressText{color:black;text-align:left;position:relative}.minimap-progress{z-index:10;width:100%}.map-button-bar{z-Index:2;right:0px;top:0px;position:absolute;right:100%;display:flex;flex-direction:column;background-color:#f5f5f5;box-shadow:1px 3px 10px 0 rgba(0,0,0,0.5);margin-right:4px;margin-top:0px;border-radius:5px}.map-button-bar.side-by-side{margin-top:4px}.map-button-bar.side-by-side.left-2d-view{right:0px}.sheetmap-thumbnail{position:absolute;overflow:hidden}.side-by-side .minimap-header{border-radius:0}.minimap-header{background:#ffffff;display:flex;position:initial;align-items:center;justify-content:flex-end;border-radius:4px 4px 0 0;width:100%;z-index:4;-moz-box-shadow:0px 2px 4px -2px rgba(0,0,0,0.5);-webkit-box-shadow:0px 2px 4px -2px rgba(0,0,0,0.5);box-shadow:0px 2px 4px -2px rgba(0,0,0,0.5)}.minimap-title{font-size:14px;text-align:left;text-align-last:left;margin-right:12px;-webkit-appearance:none;-moz-appearance:none;appearance:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.minimap-dropdown-wrapper{cursor:pointer;outline:none;white-space:nowrap;flex-grow:1;display:flex;align-items:center;padding:0 5px 0 15px;overflow:hidden;margin-right:auto}.minimap-dropdown-wrapper:after{content:"";border-width:6px 5px 0 5px;border-style:solid;border-color:#819099 transparent}.minimap-dropdown{position:absolute;top:40px;left:5px;max-height:120px;margin:0;width:90%;background:#ffffff;list-style:none;opacity:0;pointer-events:none;overflow:scroll;overflow-x:hidden;border-radius:3px;z-index:10;box-shadow:0px 1px 7px rgba(0,0,0,0.3)}.minimap-dropdown li{display:block;color:#222222;text-decoration:none;border-left:5px;padding:8px 8px 8px 20px;font-size:14px;overflow:hidden;text-overflow:ellipsis}.minimap-dropdown li.active{background:#eef0f2}.minimap-dropdown li:hover{background:#f8f9fa}.minimap-dropdown.active{opacity:1;pointer-events:auto;padding:0 0 10px 0}\n',""])},321:function(e,t,i){"use strict";function n(e,t,i,n){return new Promise((function(o,r){e((function(e){if(!e)return r("Invalid access token.");var a=function(e){switch(e){case"staging":case"qa":case"dev":case"local":return"https://developer-stg.api.autodesk.com";default:return"https://developer.api.autodesk.com"}}(n),s=function(e){switch(e){case"qa":return"-qa";case"dev":case"local":return"-dev";default:return""}}(n),l="bim360/locations".concat(s,"/v2"),u="".concat(a,"/").concat(l,"/containers/").concat(t,"/trees/").concat("default","/nodes:search"),h=[];!function t(n){var s=function(e,t,i,n,o,r){var a=new XMLHttpRequest;return a.open(e,t),i&&a.setRequestHeader("Content-Type",i),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.setRequestHeader("Authorization","Bearer "+n),a.onload=function(e){201===e.currentTarget.status||200===e.currentTarget.status||204===e.currentTarget.status?o(e.currentTarget.responseText):r()},a.onerror=r,a.ontimeout=r,a.onabort=r,a}("POST",n,"application/json",e,(function(e){var i=JSON.parse(e);h=h.concat(i.results),i.pagination.next?t(a+i.pagination.next):o(h)}),r),l={documentUrns:[i]};s.send(JSON.stringify(l))}(u)}))}))}i.r(t),i.d(t,"fetch2dLocations",(function(){return n}))},322:function(e,t,i){"use strict";i.r(t),i.d(t,"getPointLocations",(function(){return r})),i.d(t,"parseLocationsMetadata",(function(){return a}));var n=i(1);function o(e,t){return!(!e||!t)&&(e===t||o(e.parent,t))}function r(e,t){for(var i=[],n=0;n<t.length;n++){var r=t[n];r.polygon.hitTest(e.x,e.y)&&i.push(r)}for(var a=0;a<i.length-1;a++)for(var s=a+1;s<i.length;s++)o(i[a],i[s])?i[s]=null:o(i[s],i[a])&&(i[a]=null);return i=i.filter((function(e){return e}))}function a(e){var t={},i=e.map((function(e){if(e.area&&"Svg"===e.area.format){var i=n.j.fromSVG(e.area.geometry),o=e.node&&e.node.id||e.id,r={id:o,metadata:e,polygon:i,parent:void 0};return t[o]=r,r}})).filter((function(e){return e}));return i.forEach((function(e){var i=e.metadata.node&&e.metadata.node.parentId||e.metadata.parentId;e.parent=t[i]})),i}},323:function(e,t,i){var n=i(324);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(5)(n,o);n.locals&&(e.exports=n.locals)},324:function(e,t,i){(e.exports=i(4)(!1)).push([e.i,".avatar-widget{width:0px;height:0px;top:0px;left:0px;position:absolute;transition:opacity 0.7s;opacity:0;z-index:1;pointer-events:none}.avatar-widget.visible{opacity:0.7;pointer-events:all}.avatar-frustum{border-left:20px solid transparent;border-right:20px solid transparent;border-top:40px solid #3590e9;border-radius:50%;opacity:0.4;width:0px;height:0px;position:absolute;transform-origin:bottom center;cursor:crosshair}.avatar-frustum.touch{border-left:40px solid transparent;border-right:40px solid transparent;border-top:80px solid #3590e9}.avatar-position-fill{width:10px;height:10px;left:15px;top:35px;position:absolute;border-radius:50%;background-color:#3590e9;box-shadow:0px 0px 0px 2px #fff}.avatar-position-fill.touch{left:35px;top:75px}.avatar-position-hitarea{position:absolute;width:15px;height:15px;left:5px;top:5px;border-radius:50px;transform:translate(-50%, -50%);cursor:grab}.avatar-position-hitarea.touch{width:50px;height:50px}\n",""])},4:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var o=(a=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),r=n.sources.map((function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"}));return[i].concat(r).concat([o]).join("\n")}var a;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<e.length;o++){var a=e[o];"number"==typeof a[0]&&n[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="("+a[2]+") and ("+i+")"),t.push(a))}},t}},5:function(e,t,i){var n,o,r={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,i){if("function"==typeof e)return e();if(void 0===t[e]){var n=s.call(this,e,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),u=null,h=0,c=[],d=i(6);function p(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=r[n.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(E(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(E(n.parts[a],t));r[n.id]={id:n.id,refs:1,parts:s}}}}function v(e,t){for(var i=[],n={},o=0;o<e.length;o++){var r=e[o],a=t.base?r[0]+t.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};n[a]?n[a].parts.push(s):i.push(n[a]={id:a,parts:[s]})}return i}function f(e,t){var i=l(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),c.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,i);i.insertBefore(t,o)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=c.indexOf(e);t>=0&&c.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=function(){0;return i.nc}();n&&(e.attrs.nonce=n)}return y(t,e.attrs),f(e,t),t}function y(e,t){Object.keys(t).forEach((function(i){e.setAttribute(i,t[i])}))}function E(e,t){var i,n,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var a=h++;i=u||(u=g(t)),n=b.bind(null,i,a,!1),o=b.bind(null,i,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",y(t,e.attrs),f(e,t),t}(t),n=S.bind(null,i,t),o=function(){m(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(t),n=k.bind(null,i),o=function(){m(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=v(e,t);return p(i,t),function(e){for(var n=[],o=0;o<i.length;o++){var a=i[o];(s=r[a.id]).refs--,n.push(s)}e&&p(v(e,t),t);for(o=0;o<n.length;o++){var s;if(0===(s=n[o]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete r[s.id]}}}};var w,x=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function b(e,t,i,n){var o=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=x(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function k(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function S(e,t,i){var n=i.css,o=i.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(n=d(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},572:function(t,i,n){"use strict";n.r(i);n(313),n(315),n(317);function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=AutodeskNamespace("Autodesk.AEC"),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._viewer=t,this._dbIdsToUnhide=new Map,this._cache={}}var t,i,n;return t=e,(i=[{key:"filter",value:function(e,t){var i=this;if(!e)throw new Error("floorFilterData cannot be undefined.");if(!(e.modelsDbIds instanceof Map))throw new Error("floorFilterData.modelsDbIds has to be a Map.");if(!t)throw new Error("floor cannot be undefined.");var n=this._getLevelHeightFactor(e.levelHeightFactor),o=e.modelsDbIds;if(this._hasModelDbIds(o)){var r=t.zMin,a=t.zMax,s=r+(a-r)*n,l=a+.1*(a-r);this._cache[t.name]||(this._cache[t.name]={});var u=this._viewer.impl.modelQueue().getModels(),h=function(e,n){var r=u[e];if(!r.visibilityManager)return console.warn("The VisibilityManager of the model with ID = ".concat(r.id," is not yet initialized.")),"break";if(i._cache[t.name][r.id]){var a=i._cache[t.name][r.id];return a.size>0&&i.hideDbIds(r,a),"continue"}var h=r.getInstanceTree();if(!h)return console.warn("The instanceTree of the model with ID = ".concat(r.id," is not yet initialized.")),"continue";var c=new Set,d=o.get(r.id);if(!d)return"continue";d.forEach((function(e){var t=new Float32Array(6);h.getNodeBox(e,t);var i=t[2],n=t[5];(i>=s&&i<=l||n>=s&&n<=l||i<=s&&n>=l)&&c.add(e)})),c.size>0&&i.hideDbIds(r,c),i._cache[t.name][r.id]=c};e:for(var c=0,d=u.length;c<d;c++)switch(h(c)){case"break":break e;case"continue":continue}}}},{key:"hideDbIds",value:function(e,t){if(e.visibilityManager)if(t.forEach((function(t){e.visibilityManager.setNodeOff(t,!0)})),this._dbIdsToUnhide.has(e)){var i=this._dbIdsToUnhide.get(e),n=!0,o=!1,r=void 0;try{for(var a,s=i[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;i.add(l)}}catch(e){o=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}}else this._dbIdsToUnhide.set(e,t)}},{key:"clearFilter",value:function(){0!==this._dbIdsToUnhide.size&&this._dbIdsToUnhide.forEach(function(e,t){t.visibilityManager&&(e.forEach((function(e){t.visibilityManager.setNodeOff(e,!1)})),this._dbIdsToUnhide.delete(t))}.bind(this))}},{key:"unhideModel",value:function(e){this._dbIdsToUnhide.delete(e)}},{key:"_hasModelDbIds",value:function(e){if(0===e.size)return!1;var t=!0,i=!1,n=void 0;try{for(var o,r=e.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if(a&&a.length>0)return!0}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}return!1}},{key:"_getLevelHeightFactor",value:function(e){if(void 0===e)return.5;if("number"!=typeof e)throw new Error("floorFilterData.levelHeightFactor has to be a number");if(e<0||e>=1)throw new Error("floorFilterData.levelHeightFactor has to be a number between 0-1.");return e}},{key:"reApplyFilter",value:function(e){var t=this._dbIdsToUnhide.get(e),i=e.visibilityManager;t&&i&&t.forEach((function(e){i.setNodeOff(e,!0)}))}},{key:"isVisible",value:function(e,t){var i=this._dbIdsToUnhide.get(e);return!i||!i.has(t)}}])&&o(t.prototype,i),n&&o(t,n),e}();function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.FloorSelectorFilter=a;var l=Autodesk.Viewing,u=Autodesk.Viewing.Private,h=AutodeskNamespace("Autodesk.AEC"),c=0,d=1,p=2,v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l.EventDispatcher.prototype.apply(this),this._viewer=t,this._renderer=t.impl.renderer(),this._cameraMovedCB=this._interruptFading.bind(this),t.addEventListener(l.CAMERA_CHANGE_EVENT,this._cameraMovedCB),this._viewerResizeCB=this._onViewerResized.bind(this),t.addEventListener(l.VIEWER_RESIZE_EVENT,this._viewerResizeCB),this._renderOptionsChangedCB=this._onRenderOptionsChanged.bind(this),t.addEventListener(l.RENDER_OPTION_CHANGED_EVENT,this._renderOptionsChangedCB),this._floorSelectionFilterToBeUpdated=this._runFloorSelectorFilterEventHandler.bind(this),t.addEventListener(l.MODEL_ADDED_EVENT,this._floorSelectionFilterToBeUpdated),t.addEventListener(l.OBJECT_TREE_CREATED_EVENT,this._floorSelectionFilterToBeUpdated),this._modelUnloadingCB=this._runModelUnloadingEventHandler.bind(this),t.addEventListener(l.MODEL_UNLOADED_EVENT,this._modelUnloadingCB),this._floors=[],this._currentMode=p,this._hovering=!1,this._floorSectionMin=void 0,this._floorSectionMax=void 0,this._zMinAllModels=void 0,this._zMaxAllModels=void 0,this._floorAnim=null,this._fadeAnim=null,this._ghostFloorOpacity=0,this._currentFloor=void 0,this._aoVisible=!0,this._aoOpacity=void 0,this._floorSelectorFilter=new a(this._viewer),this._floorFilterData=void 0,this._floorRollOverActive=!1,this._fadeEnabled=!0,this.enabled=!0,this.offscreenRenderBudget=void 0,this.fadingTime=.5}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this._viewer&&(this._viewer.removeEventListener(l.CAMERA_CHANGE_EVENT,this._cameraMovedCB),this._viewer.removeEventListener(l.VIEWER_RESIZE_EVENT,this._viewerResizeCB),this._viewer.removeEventListener(l.RENDER_OPTION_CHANGED_EVENT,this._renderOptionsChangedCB),this._viewer.removeEventListener(l.OBJECT_TREE_CREATED_EVENT,this._floorSelectionFilterToBeUpdated),this._viewer.removeEventListener(l.MODEL_ADDED_EVENT,this._floorSelectionFilterToBeUpdated),this._viewer.removeEventListener(l.MODEL_UNLOADED_EVENT,this._modelUnloadingCB),this._viewer=null)}},{key:"resetState",value:function(){this._floors=[],this._selectFloor(void 0),this._clearFloorSection(),this._floorSelectorFilter.clearFilter()}},{key:"enterHoverMode",value:function(){this._currentMode!==d&&this._setMode(c),this._hovering=!0}},{key:"exitHoverMode",value:function(e){(this._currentMode!==d||e)&&this._setMode(p),this._hovering=!1,this._setSpatialFilterForRollOver()}},{key:"setPanelHoverEffectEnabled",value:function(e){this.exitHoverMode(!0),this._skipFadeAnimations(),this._fadeEnabled=e}},{key:"_getFadeExtension",value:function(){return this._fadeEnabled&&this._viewer.getExtension("Autodesk.CrossFadeEffects")}},{key:"_ghostFloorsEnabled",value:function(){return Boolean(this._getFadeExtension())}},{key:"rollOverFloor",value:function(e){var t=this._ghostFloorsEnabled()||void 0===this._currentFloor,i=this._renderer.spatialFilterForRollOverSupported();if(void 0===e||!i||!t)return this._setSpatialFilterForRollOver(),void this._renderer.rolloverObjectId(0);this._renderer.rolloverObjectId(1),this._setSpatialFilterForRollOver(e),this._viewer.impl.invalidate(!1,!0,!0)}},{key:"selectFloor",value:function(t,i){this.floorSelectionValid(t)&&(i?this._moveToFloor(t):this._selectFloor(t),this._runFloorSelectorFilter(),this._ghostFloorsEnabled()||this.rollOverFloor(),this.fireEvent({type:e.SELECTED_FLOOR_CHANGED,levelIndex:t}))}},{key:"floorSelectionValid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return!(!Number.isInteger(e)&&void 0!==e||!this.floorData||0===this.floorData.length||this.currentFloor===e||!(void 0===e||e>=0||this.floorData.length>e))}},{key:"isVisible",value:function(e,t){this._tmpNodeBox||(this._tmpNodeBox=new Float32Array(6));var i=this._floors[this._currentFloor];if(void 0===i)return!0;var n=e.getInstanceTree();if(!n)return!0;var o=this._tmpNodeBox;n.getNodeBox(t,o);var r=o[2],a=o[5];return!(r>i.zMax||a<i.zMin)&&this._floorSelectorFilter.isVisible(e,t)}},{key:"setEnabled",value:function(e){this.enabled=e,this._applySelectedFloorSection()}},{key:"_stopFloorAnim",value:function(){this._floorAnim&&(this._floorAnim.stop(),this._floorAnim=null)}},{key:"_stopFadeAnim",value:function(){this._fadeAnim&&(this._fadeAnim.stop(),this._fadeAnim=null)}},{key:"_skipFadeAnimations",value:function(){this._fadeAnim&&(this._fadeAnim.skip(),this._fadeAnim=null),this._floorAnim&&(this._floorAnim.skip(),this._floorAnim=null)}},{key:"_leaveHoverMode",value:function(){var e=this._getFadeExtension();e&&(e.releaseFadingImage(0),e.releaseFadingImage(1),e.setModelTargetIndexForAll(void 0),this._applySelectedFloorSection(),this._setAOVisible(!0))}},{key:"_interruptFading",value:function(){!this._hovering&&this._fadeAnim&&this._fadeAnim.isRunning&&(this._stopFadeAnim(),this._leaveHoverMode())}},{key:"_onViewerResized",value:function(){this.forceImageRefresh()}},{key:"forceImageRefresh",value:function(){var e=this._hovering;this.exitHoverMode(),this._skipFadeAnimations(),e&&(this.enterHoverMode(),this._skipFadeAnimations())}},{key:"_onRenderOptionsChanged",value:function(){this._floorRollOverActive&&!this._renderer.spatialFilterForRollOverSupported()&&this.rollOverFloor()}},{key:"_getVisibleModels",value:function(){return this._viewer.impl.modelQueue().getModels()}},{key:"_updateZLimits",value:function(){var e=this._getVisibleModels();this._zMinAllModels=1e20,this._zMaxAllModels=-1e20;for(var t=0;t<e.length;t++){var i=e[t].getBoundingBox();this._zMinAllModels=Math.min(i.min.z,this._zMinAllModels),this._zMaxAllModels=Math.max(i.max.z,this._zMaxAllModels)}this._zMinAllModels>this._zMaxAllModels&&(this._zMinAllModels=-1e20,this._zMaxAllModels=1e20)}},{key:"_setAOVisible",value:function(e){if(e!==this._aoVisible){this._aoVisible=e;var t=this._renderer.getBlendPass(),i=0;e?(0!==t.uniforms.aoOpacity.value&&console.warn("ao opacity should not be changed while FloorSelector is in use."),i=this._aoOpacity):this._aoOpacity=t.uniforms.aoOpacity.value,this._renderer.setAOOptions(this._renderer.getAORadius(),this._renderer.getAOIntensity(),i)}}},{key:"_setGhostFloorOpactiy",value:function(e){var t=this._getFadeExtension();t&&t.setCrossFadeOpacity(1,e),this._ghostFloorOpacity=e}},{key:"_setSpatialFilterForRollOver",value:function(t){var i=void 0,n=this._floors[t],o=function(e,t){return"bool spatialFilter(vec3 worldPos) { return (worldPos.z >= float("+e+") && worldPos.z <= float("+t+")); }"};n?i=o(n.zMin,n.zMax):t===e.AllFloors&&(i=o(this._zMinAllModels,this._zMaxAllModels)),this._renderer.setSpatialFilterForRollOver(i);var r=this._getFadeExtension();r&&r.crossFade.setSaoHeuristicEnabled(!i),this._floorRollOverActive=!!i}},{key:"_applyFloorSection",value:function(e,t){if(this.enabled){Number.isFinite(e)||(e=-1e20),Number.isFinite(t)||(t=1e20);var i=[new THREE.Vector4(0,0,-1,e),new THREE.Vector4(0,0,1,-t)];this._viewer.impl.setCutPlaneSet("Autodesk.AEC.FloorSelector",i)}else this._viewer.impl.setCutPlaneSet("Autodesk.AEC.FloorSelector",i)}},{key:"_applySelectedFloorSection",value:function(){var e=void 0!==this._floorSectionMin?this._floorSectionMin:-1e20,t=void 0!==this._floorSectionMax?this._floorSectionMax:1e20;this._applyFloorSection(e,t)}},{key:"_setFloorSection",value:function(e,t){this._floorSectionMin=isNaN(e)?void 0:e,this._floorSectionMax=isNaN(t)?void 0:t,this._applySelectedFloorSection()}},{key:"_clearFloorSection",value:function(){this._updateZLimits(),this._applyFloorSection()}},{key:"_setMode",value:function(e){var t=this;if(e!==this._currentMode)if(this._currentMode=e,e===c){var i=this._getFadeExtension();if(i){i.acquireControl("FloorSelector",(function(){return t._interruptFading()})),i.setModelTargetIndexForAll(void 0),this._applySelectedFloorSection(),this._renderer.rolloverObjectId(0),this._setAOVisible(!0),i.renderFadingImage(0,this.offscreenRenderBudget),i.setCrossFadeOpacity(0,1),this._clearFloorSection(),i.setModelTargetIndexForAll(1),this._setAOVisible(!1),this._stopFadeAnim();var n=this._setGhostFloorOpactiy.bind(this);this._fadeAnim=u.fadeValue(this._ghostFloorOpacity,.2,this.fadingTime,n)}}else if(e===d){var o=this._getFadeExtension();o&&(o.setClearEnabled(1,!1),o.setClearEnabled(0,!0),o.setModelTargetIndexForAll(0),o.setCrossFadeOpacity(0,1)),this._setAOVisible(!0),this._applySelectedFloorSection()}else if(e===p){this._stopFadeAnim();var r=this._setGhostFloorOpactiy.bind(this),a=this._leaveHoverMode.bind(this);this._fadeAnim=u.fadeValue(this._ghostFloorOpacity,0,this.fadingTime,r,a)}}},{key:"_moveToFloor",value:function(e){var t=this;this._currentFloor=e,this._setMode(d);var i=this._floors[e];this._updateZLimits();var n=void 0===this._floorSectionMin?this._zMinAllModels:this._floorSectionMin,o=void 0===this._floorSectionMax?this._zMaxAllModels:this._floorSectionMax,r=i?i.zMin:this._zMinAllModels,a=i?i.zMax:this._zMaxAllModels;this._stopFloorAnim(),this._floorAnim=u.fadeValue(0,1,this.fadingTime,(function(e){var i=u.smootherStep(e),s=u.lerp(n,r,i),l=u.lerp(o,a,i);t._setFloorSection(s,l);var h=t._renderer.getBlendPass().uniforms.highlightIntensity;h.value=Math.min(h.value,1-i)}),(function(){var e=t._hovering?c:p;t._setMode(e)}))}},{key:"_selectFloor",value:function(e){this._stopFloorAnim(),this._currentFloor=e;var t=this._floors[e],i=t?t.zMin:void 0,n=t?t.zMax:void 0;this._setFloorSection(i,n)}},{key:"_runFloorSelectorFilter",value:function(){if(this._floorSelectorFilter.clearFilter(),this._floorFilterData&&void 0!==this._currentFloor){var e=this._floors[this._currentFloor];this._floorSelectorFilter.filter(this._floorFilterData,e)}}},{key:"_runFloorSelectorFilterEventHandler",value:function(e){e.model.isObjectTreeLoaded()&&(this._floorFilterData&&void 0!==this._currentFloor?this._runFloorSelectorFilter():this._floorSelectorFilter.clearFilter())}},{key:"_runModelUnloadingEventHandler",value:function(e){this._floorFilterData&&void 0!==this._currentFloor&&this._floorSelectorFilter.unhideModel(e.model)}},{key:"floorData",get:function(){return this._floors},set:function(t){this.resetState(),this._floors=Array.isArray(t)?t:[],this.fireEvent({type:e.FLOOR_DATA_CHANGED,floorData:this._floors})}},{key:"floorFilterData",get:function(){return this._floorFilterData},set:function(e){this._floorFilterData=e}},{key:"currentFloor",get:function(){return this._currentFloor}}])&&s(t.prototype,i),n&&s(t,n),e}();function f(e){var t=e.extension;return t&&t.hasOwnProperty("projectElevation")?t.projectElevation:e.elevation}function m(e,t){var i=new THREE.Vector3,n=function(e){return i.set(0,0,e),i.applyMatrix4(t),i.z};e.forEach((function(e){e.zMin=n(e.zMin),e.zMax=n(e.zMax)}))}function g(e,t){var i=e.levels.filter((function(e){var t=e.extension;return!t||(!t.hasOwnProperty("buildingStory")||t.buildingStory)})),n=[],o=i.length;return i.forEach((function(e,t){var r=void 0;if(t+1<o)r=f(i[t+1]);else{var a=i[i.length-1];r=f(a)+a.height}n.push({index:n.length,name:e.name,zMin:f(e)-1/12,zMax:r,guid:e.guid})})),t?m(n,t):function(e,t){t&&m(e,Autodesk.Viewing.BubbleNode.readMatrixFromArray12(t))}(n,e.refPointTransformation),n}function y(e){var t=e.impl.modelQueue().getModels(),i=null,n=-1;return t.forEach((function(e){if(!e.is2d()){var t=e.getDocumentNode();if(t)t.getAecModelData()&&(t.data.size>n?(i=e,n=t.data.size):t.data.size||-1!==n||(i=e,n=0))}})),i}v.AllFloors=-1,v.NoFloor=void 0,v.SELECTED_FLOOR_CHANGED="selectedFloorChanged",v.FLOOR_DATA_CHANGED="floorDataChanged",h.FloorSelector=v;var E=Autodesk.Viewing,w=Autodesk.Viewing.UI,x={ITEM_SELECT:"itemSelect",ITEM_MOUSE_ENTER:"itemMouseEnter",ITEM_MOUSE_LEAVE:"itemMouseLeave"};function b(e,t,i,n){w.DockingPanel.call(this,e,t,i,n),E.EventDispatcher.prototype.apply(this),this.container.classList.add("list-panel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:65,marginTop:0})}function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}b.prototype=Object.create(w.DockingPanel.prototype),b.prototype.setItems=function(e){this.buttons=[],this.items=e,this.listDiv&&this.scrollContainer.removeChild(this.listDiv);var t=this.getDocument();this.listDiv=t.createElement("div"),this.listDiv.classList.add("itemList"),this.scrollContainer.appendChild(this.listDiv);for(var i=this,n=function(e){var n=i._getItemText?i._getItemText(e):"<no item text>",o=t.createElement("div");o.classList.add("listItem"),o.item=e,o.setAttribute("title",n),o.addEventListener("click",(function(){i.fireEvent({type:x.ITEM_SELECT,item:e})})),o.addEventListener("mouseenter",(function(){i.fireEvent({type:x.ITEM_MOUSE_ENTER,item:e})})),o.addEventListener("mouseleave",(function(){i.fireEvent({type:x.ITEM_MOUSE_LEAVE,item:e})}));var r=t.createElement("span");r.innerHTML=n,r.classList.add("text");var a=t.createElement("div");a.classList.add("textContainer"),a.appendChild(r),o.appendChild(a);var s=t.createElement("span");s.classList.add("list-panel-item-warning"),o.appendChild(s),o.warnSpan=s;var l=t.createElement("span");return l.classList.add("icon"),o.appendChild(l),o},o=0;o<e.length;o++){var r=n(e[o]);this.listDiv.appendChild(r),this.buttons.push(r)}this.updateItemStates()},b.prototype.updateItemStates=function(){if(this.buttons)for(var e=0;e<this.buttons.length;e++){var t=this.buttons[e];t.classList.remove("selected"),this._isSelected&&this._isSelected(t.item)&&t.classList.add("selected");var i=this._getWarningText&&this._getWarningText(t.item);t.warnSpan.style.visibility=i?"visible":"hidden",t.warnSpan.setAttribute("title",i||"")}},b.prototype.setItemHandlers=function(e,t,i){this._isSelected=e,this._getItemText=t,this._getWarningText=i,this.updateItemStates()},w.ListPanelEvents=x,w.ListPanel=b;var A=Autodesk.Viewing,C=A.UI,V=AutodeskNamespace("Autodesk.AEC"),L=function(e){function t(e,i){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=M(t).call(this,e,i))||"object"!==k(r)&&"function"!=typeof r?_(o):r).container=n.options.panelUIContainers&&n.options.panelUIContainers.levelsPanel,n._onCameraMoved=n._onCameraMoved.bind(_(n)),n.onItemMouseEnter=n.onItemMouseEnter.bind(_(n)),n.onItemMouseLeave=n.onItemMouseLeave.bind(_(n)),n.onItemSelected=n.onItemSelected.bind(_(n)),n._currentLevel=void 0,n}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,e),i=t,(n=[{key:"_onCameraMoved",value:function(){var e=this._mapCameraToLevel();e&&(this._currentLevel&&e.guid===this._currentLevel.guid||(this._currentLevel=e,this.viewer.dispatchEvent({type:t.LEVEL_CHANGED,level:e})))}},{key:"_mapCameraToLevel",value:function(){var e=this.floorSelector.floorData;if(e.length){var t=this.viewer.impl.camera.position.z;return t<e[0].zMin?e[0]:t>e[e.length-1].zMax?e[e.length-1]:e.find((function(e){return e.zMin<=t&&e.zMax>=t}))}}},{key:"onToolbarCreated",value:function(){if(!this.container){var e=this.viewer.getToolbar().getControl(A.TOOLBAR.MODELTOOLSID);e&&e.addControl(this.levelsButton)}}},{key:"onItemMouseEnter",value:function(e){var t=e.item.index;t===this.floorSelector.currentFloor&&(t=v.AllFloors),this.floorSelector.rollOverFloor(t),this.hoveredFloor=t}},{key:"onItemMouseLeave",value:function(e){var t=e.item;this.hoveredFloor===t.index&&(this.hoveredFloor=void 0,this.floorSelector.rollOverFloor(v.NoFloor))}},{key:"onItemSelected",value:function(e){var t=e.item,i=t.index!==this.floorSelector.currentFloor?t.index:void 0;this.floorSelector.selectFloor(i,!0)}},{key:"_createUI",value:function(){var e=this;this.levelsButton=new C.Button("toolbar-levelsTool"),this.levelsButton.setToolTip("Levels"),this.levelsButton.icon.innerHTML=D(),this.levelsPanel=new b(this.container||this.viewer.container,"LevelsPanel-"+this.viewer.id,"Levels"),this.levelsPanel.setGlobalManager(this.globalManager),this.container||this.viewer.addPanel&&this.viewer.addPanel(this.levelsPanel),this.levelsPanel.addVisibilityListener((function(t){e.levelsButton.setState(t?C.Button.State.ACTIVE:C.Button.State.INACTIVE)})),this.levelsPanel.closer.addEventListener("click",(function(){e.onPanelVisibilityToggled&&e.onPanelVisibilityToggled(!1)})),this.levelsPanel.addEventListener(x.ITEM_MOUSE_ENTER,this.onItemMouseEnter),this.levelsPanel.addEventListener(x.ITEM_MOUSE_LEAVE,this.onItemMouseLeave),this.levelsPanel.addEventListener(x.ITEM_SELECT,this.onItemSelected),this.levelsPanel.container.addEventListener("mouseenter",(function(){return e.floorSelector.enterHoverMode()})),this.levelsPanel.container.addEventListener("mouseleave",(function(){return e.floorSelector.exitHoverMode()})),this.floorSelector.addEventListener(v.SELECTED_FLOOR_CHANGED,(function(){return e.levelsPanel.updateItemStates()})),this.levelsPanel.setItemHandlers((function(t){return t.index===e.floorSelector.currentFloor}),(function(e){return e.text})),this.levelsButton.onClick=function(){var t=!e.levelsPanel.isVisible();e.levelsPanel.setVisible(t),e.onPanelVisibilityToggled&&e.onPanelVisibilityToggled(t)}}},{key:"setAecModelData",value:function(e,t){if(e!==this.aecModelData){this.aecModelData=e,this.floorSelector.floorData=e?g(e,t):[];for(var i=this.floorSelector.floorData,n=[],o=0;o<i.length;o++){var r=i[o];n.push({text:r.name,index:o})}n.reverse(),this.levelsPanel.setItems(n),this._updateOccluderData()}}},{key:"_updateOccluderData",value:function(){var e=this.aecModelData?function(e){var t=e.impl.modelQueue().getModels(),i=new Map;return t.forEach((function(e){if(!e.is2d()){var t=e.getDocumentNode();if(t){var n=t.getAecModelData();n&&i.set(e.id,n.levelOccluderIds)}}})),{modelsDbIds:i}}(this.viewer):void 0;this.floorSelector.floorFilterData=e}},{key:"load",value:function(){var e=this;return this.floorSelector=new v(this.viewer),this.updateFloorSelector=function(){if(e.floorSelector){if(!1!==e.options.autoDetectAecModelData){var t=y(e.viewer),i=t&&t.getDocumentNode(),n=i&&i.getAecModelData(),o=t&&t.myData.placementWithOffset;e.setAecModelData(n,o)}e._updateOccluderData();var r=e.viewer.getVisibleModels().some((function(e){return e.is3d()}));e.floorSelector.setEnabled(r)}},this.viewer.addEventListener(A.MODEL_ROOT_LOADED_EVENT,this.updateFloorSelector),this.viewer.addEventListener(A.MODEL_UNLOADED_EVENT,this.updateFloorSelector),this.viewer.addEventListener(A.MODEL_ADDED_EVENT,this.updateFloorSelector),this.viewer.addEventListener(A.CAMERA_CHANGE_EVENT,this._onCameraMoved),this._createUI(),this.updateFloorSelector(),!0}},{key:"unload",value:function(){return this.container||this.viewer.removePanel&&this.viewer.removePanel(this.levelsPanel),this.floorSelector.selectFloor(void 0,!1),this.levelsPanel=null,this.updateFloorSelector&&(this.viewer.removeEventListener(A.MODEL_ROOT_LOADED_EVENT,this.updateFloorSelector),this.viewer.removeEventListener(A.MODEL_UNLOADED_EVENT,this.updateFloorSelector),this.viewer.removeEventListener(A.MODEL_ADDED_EVENT,this.updateFloorSelector),this.updateFloorSelector=null),this.viewer.removeEventListener(A.CAMERA_CHANGE_EVENT,this._onCameraMoved),this._currentLevel=null,this.floorSelector=null,!0}},{key:"getState",value:function(e){if(this.viewer.model&&!this.viewer.model.is2d()){var t=this.floorSelector.currentFloor;e.floorGuid=t?this.floorSelector.floorData[t].guid:null}}},{key:"restoreState",value:function(e,t){if(void 0!==e.floorGuid){if(e.floorGuid){var i=this.floorSelector.floorData.find((function(t){return t.guid===e.floorGuid}));i&&this.floorSelector.selectFloor(i.index,!1)}else this.floorSelector.selectFloor(v.NoFloor,!1);return!0}}},{key:"getCurrentLevel",value:function(){var e=this.floorSelector,t=e.floorData[e.currentFloor];return t||this._mapCameraToLevel()}},{key:"getZRange",value:function(e){var t=this.floorSelector&&this.floorSelector.floorData[e],i=t.zMin+.5*(t.zMax-t.zMin),n=this.floorSelector.floorData[e-1];return{zMin:n?.5*(n.zMin+n.zMax):t.zMin,zMax:i}}}])&&S(i.prototype,n),o&&S(i,o),t}(A.Extension),D=function(){return['<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<g stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">','<path d="M4 8 L12 3 L 20 8 L12 13Z"/>','<path d="M4 12 L12 17 L 20 12"/>','<path d="M4 16 L12 21 L 20 16"/>Ä',"</g>","</svg>"].join("")};V.LevelsExtension=L,L.LEVEL_CHANGED="levelChanged",Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.LevelsExtension",L);var O=Autodesk.Viewing,B=Autodesk.Viewing.Private;function P(t,i,n,o){O.ToolInterface.call(this),this.names=["hyperlink-tracker"],t.toolController.registerTool(this);var r,a,s=t,l=n,u=o,h=[0,0],c={},d=0,p=!1,v=!1;function f(){var e,t=c[h[1]];if(!t){var i=1===(e=s.impl.modelQueue().getModels()).length?e[0]:void 0;i&&(t=c[i.id])}return t}function m(e){return e&&Object.keys(e).length>0}function g(e,t,i,n){var o=4*i,r=t.stringBoxes[o+1],a=t.stringBoxes[o+3],s=.2*(a-r);r-=s,a+=s;var l=t.stringBoxes[o]-s,u=t.stringBoxes[o+2]+s,h=t.stringDbIds[i],c=e.vcount;e.addVertexPolytriangle(l,r,2009054015,h,0,0),e.addVertexPolytriangle(u,r,2009054015,h,0,0),e.addVertexPolytriangle(u,a,2009054015,h,0,0),e.addVertexPolytriangle(l,a,2009054015,h,0,0),e.addIndices([0,1,2,0,2,3],c),e.addSegment(l,r,u,r,0,-2*n,-4211905,h,0,0,0),e.addSegment(u,r,u,a,0,-2*n,-4211905,h,0,0,0),e.addSegment(u,a,l,a,0,-2*n,-4211905,h,0,0,0),e.addSegment(l,a,l,r,0,-2*n,-4211905,h,0,0,0)}function y(t){if(t&&t.is2d()){var i=c[t.id];if(!i){var n=t.getDocumentNode(),o=n&&n.getRootNode(),r=o&&o.search({role:"2d",type:"geometry"});if(r&&r.length){i=c[t.id]={};var a="";t.myData&&(a=t.myData.basePath);var l=r.map((function(e){var t=function(e){if(e.children){var t=!0,i=!1,n=void 0;try{for(var o,r=e.children[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;if("resource"===a.type()){var s=a.urn();if(s){var l=s.split("/");return l.pop(),l.join("/")}}}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}return null}(e);if(-1===a.indexOf(t)){var i=e.name().split(" ")[0];if(i.length>2)return i}return""}));i.numHyperlinks=0;for(var h=new B.VertexBufferBuilder,d=1/(t.getData().loadOptions.modelScale||1),p=t.getData(),v=0;v<p.strings.length;v++){var f=l.indexOf(p.strings[v]);f>=0&&(i[p.stringDbIds[v]]=r[f],g(h,p,v,d),i.numHyperlinks++)}i.boxFragId=function(e,t){var i=e.getFragmentList().vizmeshes.length,n={mesh:t.toMesh(),is2d:!0,packId:"0",meshIndex:i};B.BufferGeometryUtils.meshToGeometry(n);var o=s.impl.matman().create2DMaterial(e,{}),r=s.impl.setupMesh(e,n.geometry,o,e.getData().loadOptions.placementTransform);return e.activateFragment(i,r),i}(t,h),u&&u(e.model.id,i.numHyperlinks)}}}}function E(e){y(e.model)}function w(e){for(var t=s.getVisibleModels().concat(s.getHiddenModels()),i=0;i<t.length;i++){var n=t[i];n.is2d()&&n.isLoadDone()&&e(n)}}this.update=function(){if(v)d=0;else if(p){var e=s.impl.clientToViewport(r,a);d=s.impl.renderer().idAtPixel(e.x,e.y,h),p=!1}return!1},this.handleSingleClick=function(){if(s.model&&s.model.is2d()){var e=s.impl.clientToViewport(r,a);d=s.impl.renderer().idAtPixel(e.x,e.y,h);var t=f(),i=m(t)?t[d]:null;return!!i&&(l(i,t.numHyperlinks),!0)}},this.handleButtonDown=function(e){return v=!0,r=e.canvasX,a=e.canvasY,!1},this.handleButtonUp=function(){return v=!1,!1},this.handleMouseMove=function(e){return r=e.canvasX,a=e.canvasY,p=!0,!1},this.activate=function(){w((function(e){y(e)})),s.addEventListener(O.GEOMETRY_LOADED_EVENT,E),s.impl.invalidate(!0,!0)},this.deactivate=function(){s.removeEventListener(O.GEOMETRY_LOADED_EVENT,E),w((function(e){var t=c[e.id];t&&function(e,t){var i=e.getFragmentList();i.vizmeshes[t].geometry.dispose(),delete i.vizmeshes[t]}(e,t.boxFragId)})),c={},s.impl.invalidate(!0,!0)},this.getCursor=function(){var e=f();return d<-1&&m(e)&&e[d]?"pointer":null}}function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}AutodeskNamespace("Autodesk.AEC").HyperlinkTracker=P;var z=Autodesk.Viewing,j=AutodeskNamespace("Autodesk.AEC"),G=function(e){function t(e,i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=N(this,F(t).call(this,e,i))).hyperlinkTracker=new P(n.viewer,n.options.rootBubbleNode,n.options.loadViewableCb,n.options.hyperlinksAddedCb),n}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,e),i=t,(n=[{key:"load",value:function(){return this.viewer.toolController.activateTool("hyperlink-tracker"),!0}},{key:"unload",value:function(){return this.viewer.toolController.deactivateTool("hyperlink-tracker"),!0}}])&&I(i.prototype,n),o&&I(i,o),t}(z.Extension);function W(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}j.HyperlinkExtension=G,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.HyperlinkExtension",G);var U=Autodesk.Viewing.Private,Y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.overlayName="DropMeViewPortOverlay"}var t,i,n;return t=e,(i=[{key:"addOverlay",value:function(e,t,i,n){this.viewer.impl.createOverlayScene(this.overlayName);var o=this._createMesh(e,t,i,n);this.viewer.impl.addOverlay(this.overlayName,o)}},{key:"removeOverlay",value:function(){this.viewer.impl.removeOverlayScene(this.overlayName)}},{key:"_createMesh",value:function(e,t,i,n){var o=new U.VertexBufferBuilder(!1,void 0,4);o.addSegment(e,t,i,t,0,.1,2581042694,-1,0,0),o.addSegment(i,t,i,n,0,.1,2581042694,-1,0,0),o.addSegment(i,n,e,n,0,.1,2581042694,-1,0,0),o.addSegment(e,n,e,t,0,.1,2581042694,-1,0,0);var r={mesh:o.toMesh(),is2d:!0,packId:"0",meshIndex:1};U.BufferGeometryUtils.meshToGeometry(r);var a=r.geometry,s=this.viewer.impl.matman(),l=s.create2DMaterial(this.viewer.impl.model,{skipEllipticals:!0,skipCircles:!0,skipTriangleGeoms:!0,useInstancing:!1}),u=s.findMaterial(this.viewer.impl.model,l);return new THREE.Mesh(a,u)}}])&&W(t.prototype,i),n&&W(t,n),e}(),Z=AutodeskNamespace("Autodesk.AEC"),X=function(e,t,i,n,o,r,a,s){var l=(a-o)/(i-e),u=(s-r)/(n-t),h=o-l*e,c=r-u*t,d=new THREE.Matrix4;return d.elements[0]=l,d.elements[5]=u,d.elements[12]=h,d.elements[13]=c,d},q=function(e){return.3048*(1/e)},J=function(e,t){var i=e.geometryViewportRegion;if(!i)return null;var n=q(t),o=new THREE.Box2;return o.min.x=(i[0]+.01)*n,o.min.y=(i[1]+.01)*n,o.max.x=(i[3]-.01)*n,o.max.y=(i[4]-.01)*n,o},K=function(e,t){var i=J(e,t),n=e.sectionBox,o=Autodesk.Viewing.BubbleNode.readMatrixFromArray12(n.transform),r=X(i.min.x,i.min.y,i.max.x,i.max.y,0,0,1,1),a=function(e){var t=new THREE.Matrix4;switch(e){case 0:return t;case 1:t.elements[0]=0,t.elements[4]=-1,t.elements[12]=1,t.elements[1]=1,t.elements[5]=0;break;case 2:t.elements[0]=0,t.elements[4]=1,t.elements[1]=-1,t.elements[5]=0,t.elements[13]=1;break;default:console.warn("Unexpected enum value for view rotation: ",e)}return t}(e.viewportRotation),s=X(0,0,1,1,n.min.x,n.min.y,n.max.x,n.max.y);return o.multiply(s).multiply(a).multiply(r)},Q=function(e,t){var i=K(e,t);return i.getInverse(i),i},$=function(e){var t=e instanceof Autodesk.Viewing.BubbleNode?e:e.getDocumentNode(),i=t.getAecModelData();return i&&i.viewports?i.viewports.filter((function(e){return e.sheetGuid===t.guid()})):[]},ee=function(e){var t=e.extensions&&e.extensions.viewRange,i=t&&t.cutPlane;return i&&i.levelGuid},te={get2DTo3DMatrix:K,get3DTo2DMatrix:Q,getViewportBounds:J,remapRectangle:X,findSheetForViewport:function(e,t){return e.search(Autodesk.Viewing.BubbleNode.SHEET_NODE).find((function(e){return e.guid()===t.sheetGuid}))},findViewportsForLevel:function(e,t){return(e.viewports||[]).filter((function(e){return ee(e)===t}))},supports2DTo3DTransform:function(e){var t=Boolean(!1),i=Boolean(e.sectionBox&&e.isCropBoxActive);if(!t&&!i)return!1;return Boolean(["FloorPlan","CeilingPlan","EngineeringPlan"].includes(e.viewType)&&e.geometryViewportRegion&&!e.hasBreaks&&!e.extensions.hasRegions)},getLinkedLevel:ee,findViewportsOnSheet:$,findViewportAtPoint:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=$(e);i&&(n=n.filter(i));var o=function(e){return e.bounds&&e.bounds.containsPoint(t)};if((n=(n=n.map((function(t){return{viewport:t,bounds:J(t,e.getUnitScale())}}))).filter(o)).length){var r=function(e,t){return Math.min(Math.min(t.x-e.min.x,e.max.x-t.x),Math.min(t.y-e.min.y,e.max.y-t.y))},a=function(e,i){var n=r(e.bounds,t);return r(i.bounds,t)>n?i:e};return n.reduce(a).viewport}},findLevelForViewport:function(e,t){var i=ee(t);return i&&e.levels.find((function(e){return e.guid===i}))}},ie=te;function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Z.AecModelData=te;var le=Autodesk.Viewing,ue=(le.Private,le.GlobalManagerMixin),he="Auto",ce="Manual",de=function(e){function t(e,i,n){var o,r,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(o=!(a=re(t).call(this))||"object"!==ne(a)&&"function"!=typeof a?ae(r):a).names=["drop-me"],o.viewer=e,o.setGlobalManager(o.viewer.globalManager),o.options=n,void 0===o.options.teleportOnRelease&&(o.options.teleportOnRelease=!0),o.viewer.toolController.registerTool(ae(o)),o.onDrop=i,o.active=!1,o._movedSinceFirstClick=!1,o.init(),o.cameraSelectionState={pending:!1,pos:null,target:null,inViewport:!1,initialVp:null},o.teleportationInProgress=0,o.isFirstClick=!0,o.viewPortOverlay=new Y(o.viewer),o.escapeHotkeyId="Autodesk.AEC.DropMeToolEsc",o}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,e),i=t,(n=[{key:"init",value:function(){var e=this;this.activate=function(){var t=e.viewer.toolController.getTool("gestures");t&&t.setGestureParameter("drag","threshold",0);var i=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){return e.options.triggerDeactivate&&e.options.triggerDeactivate()}}];e.viewer.getHotkeyManager().pushHotkeys(e.escapeHotkeyId,i),e.viewer.addEventListener(le.MODEL_ADDED_EVENT,e.options.triggerDeactivate),e.viewer.impl.pauseHighlight(!0),e.active=!0},this.deactivate=function(){var t=e.viewer.toolController.getTool("gestures");t&&t.restoreGestureParameterDefault("drag","threshold"),e.viewer.getHotkeyManager().popHotkeys(e.escapeHotkeyId),e._cancelTeleportation(),e._destroyCameraSelectorUi(),e.viewer.removeEventListener(le.MODEL_ADDED_EVENT,e.options.triggerDeactivate),e.viewer.impl.pauseHighlight(!1),e.active=!1,e._movedSinceFirstClick=!1},this.handleButtonDown=function(e){return!0},this.handleButtonUp=function(e){return!(!this._movedSinceFirstClick||this.isFirstClick)},this.handleSingleClick=function(t,i){if(e.isFirstClick){var n=e._get3DCameraPositionAndVp(t.canvasX,t.canvasY);n&&n.pos&&(e.cameraSelectionState.pos={x:t.canvasX,y:t.canvasY},e.cameraSelectionState.pending=!0,e.cameraSelectionState.initialVp=n.vp,e._createCameraSelectorUi(e.cameraSelectionState.pos),requestAnimationFrame((function(){e._movedSinceFirstClick||e.cameraSelectorPosition.classList.add("camera-selector-position--teleporting")})),"Section"===n.vp.viewType||i?e._runTeleportation(he):(e._scheduleTeleportation(),e.isFirstClick=!1,e.cursor="none",e.getCursor()))}else e.options.teleportOnRelease&&e.teleport();return!0},this.teleport=function(){e.cameraSelectionState.target={x:e.lastX,y:e.lastY},e._runTeleportation(ce),e.isFirstClick=e.options.teleportOnRelease,e._movedSinceFirstClick=!1,e._recoverCursor()},this.handleMouseMove=function(t){e.isFirstClick||e._movedSinceFirstClick||(e._movedSinceFirstClick=!0),e.cursor&&e._recoverCursor();var i=e._get3DCameraPositionAndVp(t.canvasX,t.canvasY);if(e.cameraSelectionState.initialVp&&!e.isFirstClick?e._addVpOverlay(e.cameraSelectionState.initialVp):i&&i.pos?e._addVpOverlay(i.vp):e.viewPortOverlay.removeOverlay(),e.cameraSelectionState.inViewport=e.isFirstClick&&i&&i.pos||!e.isFirstClick,e.getCursor(),e.cameraSelectionState.pending){e.teleportationInProgress&&(e.cameraSelectorPosition.classList.remove("camera-selector-position--teleporting"),clearTimeout(e.teleportationInProgress),e.teleportationInProgress=0),e.lastX=t.canvasX,e.lastY=t.canvasY;var n=t.canvasX-e.cameraSelectionState.pos.x,o=t.canvasY-e.cameraSelectionState.pos.y,r=180*Math.atan2(o,n)/Math.PI;return 0===n&&0===o||(r+=90),e.cameraSelector.style.transform="rotate(".concat(r,"deg)"),e.options.teleportOnRelease||e.teleport(),!0}},this.handleSingleTap=function(e){return this.handleSingleClick(e,!0)},this.handleResize=function(){e.options.triggerDeactivate&&e.options.triggerDeactivate()},this.handleSingleTap=function(t,i){e.isFirstClick?e.handleSingleClick(t):e.handleMouseMove(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":break;case"dragmove":return e.handleMouseMove(t,0);case"dragend":return!0;case"panmove":case"panstart":case"panend":case"pinchmove":case"pinchstart":case"pinchend":return!0}return!1}}},{key:"_recoverCursor",value:function(){this.cursor=null,this.getCursor()}},{key:"getCursor",value:function(){return this.cursor?this.cursor:this.cameraSelectionState.inViewport?"cell":"default"}},{key:"_addVpOverlay",value:function(e){this.viewPortOverlay.removeOverlay();var t=ie.getViewportBounds(e,this.viewer.model.getUnitScale()),i=t.min,n=t.max;this.viewPortOverlay.addOverlay(i.x,i.y,n.x,n.y)}},{key:"_runTeleportation",value:function(e){this._mapToCameraPositionIn3D(e),this._cancelTeleportation()}},{key:"_scheduleTeleportation",value:function(){var e=this;this.teleportationInProgress=setTimeout((function(){e._runTeleportation(he)}),3e3)}},{key:"_cancelTeleportation",value:function(){this.teleportationInProgress&&(clearTimeout(this.teleportationInProgress),this.teleportationInProgress=0)}},{key:"_createCameraSelectorUi",value:function(e){var t=this.getDocument();this.cameraSelectorBackground=t.createElement("div"),this.cameraSelectorBackground.className="camera-selector-background",this.viewer.container.appendChild(this.cameraSelectorBackground),this.cameraSelectorBackground.style.top="".concat(e.y,"px"),this.cameraSelectorBackground.style.left="".concat(e.x,"px"),this.cameraSelectorPosition=t.createElement("div"),this.cameraSelectorPosition.className="camera-selector-position",this.viewer.container.appendChild(this.cameraSelectorPosition),this.cameraSelectorPosition.style.top="".concat(e.y-10,"px"),this.cameraSelectorPosition.style.left="".concat(e.x-10,"px"),this.cameraSelector=t.createElement("div"),this.cameraSelector.className="camera-selector",this.viewer.container.appendChild(this.cameraSelector),this.cameraSelector.style.top="".concat(e.y-100,"px"),this.cameraSelector.style.left="".concat(e.x-50,"px")}},{key:"_destroyCameraSelectorUi",value:function(){this.viewer.container.contains(this.cameraSelector)&&this.viewer.container.removeChild(this.cameraSelector),this.viewer.container.contains(this.cameraSelectorBackground)&&this.viewer.container.removeChild(this.cameraSelectorBackground),this.viewer.container.contains(this.cameraSelectorPosition)&&this.viewer.container.removeChild(this.cameraSelectorPosition),this.cameraSelectionState={pending:!1,pos:null,target:null,inViewport:!1,initialVp:null},this.isFirstClick=!0,this.viewPortOverlay.removeOverlay()}},{key:"_findViewport",value:function(e){var t=new THREE.Vector2(e.x,e.y),i=this.viewer.model;return ie.findViewportAtPoint(i,t,this.options.isSupportedViewport)}},{key:"_mapToCameraPositionIn3DForFloorplan",value:function(e,t){var i=this._applyGeoRefTransform(e),n=new THREE.Vector3(0,1,0);if(this.cameraSelectionState.target){var o=this.cameraSelectionState.target.x,r=this.cameraSelectionState.target.y,a=this._get3DCameraPositionAndVp(o,r,!0);if(a&&a.pos){var s=this._applyGeoRefTransform(a.pos),l=s.x-i.x,u=s.y-i.y;0===l&&0===u||(n.setX(l).setY(u),n.normalize())}}var h=new THREE.Vector3(-n.y,n.x,0);n.applyAxisAngle(h,Math.PI/18),this.onDrop(i,n,t)}},{key:"_mapToCameraPositionIn3DForSection",value:function(e,t){var i=this._applyGeoRefTransform(e),n=new THREE.Vector3(0,1,0),o=new THREE.Vector3(-n.y,n.x,0);n.applyAxisAngle(o,Math.PI/18),this.onDrop(i,n,t)}},{key:"_mapToCameraPositionIn3D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=this.cameraSelectionState.pos.x,i=this.cameraSelectionState.pos.y,n=this._get3DCameraPositionAndVp(t,i);n&&n.pos&&n.vp&&("FloorPlan"===n.vp.viewType||"EngineeringPlan"===n.vp.viewType||"CeilingPlan"===n.vp.viewType?this._mapToCameraPositionIn3DForFloorplan(n.pos,e):"Section"===n.vp.viewType&&this._mapToCameraPositionIn3DForSection(n.pos,he))}},{key:"_get3DCameraPositionAndVp",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.viewer.impl.clientToViewport(e,t),o=this.viewer.impl.intersectGroundViewport(n),r=this._findViewport(o)||i&&this.cameraSelectionState.initialVp;if(!r)return null;var a=this.viewer.model,s=a.getDocumentNode().getAecModelData(),l=this.viewer.model.getUnitScale(),u=ie.get2DTo3DMatrix(r,l),h=o.clone().applyMatrix4(u);if("FloorPlan"===r.viewType){var c=ie.findLevelForViewport(s,r);if(c){var d=5.74147;h.z=c.elevation+d}}return{pos:h,vp:r}}},{key:"_applyGeoRefTransform",value:function(e){var t=e.clone();if(this.options.useLocalModelCoords)return t;var i=this.viewer.model.getDocumentNode().getRootNode().extractRefPointTransform();return t.applyMatrix4(i),t}}])&&oe(i.prototype,n),o&&oe(i,o),t}(le.ToolInterface);function pe(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ve(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}ue.call(de.prototype);var fe=Autodesk.Viewing,me=function(){function e(t,i,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=i,this.dropMeExt=t,this.options=n,this._onModelAdded=this._onModelAdded.bind(this),this._onGeometryLoaded=this._onGeometryLoaded.bind(this),this._onModelUnloaded=this._onModelUnloaded.bind(this),this._onAggregatedSelectionChanged=this._onAggregatedSelectionChanged.bind(this),this.viewer.registerContextMenuCallback("ViewObjectIn3D",(function(e,t){var i=o.viewer.model.is2d(),n=o.options.enableViewIn3d&&o.dropMeExt.isSupportedModel(o.viewer.model)&&o.viewer.getAggregateSelection();i&&n&&1===n.length&&1===n[0].selection.length&&(o.pos3dFrom2d=o._getSelected3dPosFrom2d(n[0].selection[0],n[0].model),e.push({title:"View in 3D",target:function(){return o.selectObject(n[0].selection[0])}}))}))}var t,i,n;return t=e,(i=[{key:"selectObject",value:function(e){this.viewer.addEventListener(fe.MODEL_ADDED_EVENT,this._onModelAdded,{once:!0}),this.viewer.addEventListener(fe.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded),this.viewer.addEventListener(fe.MODEL_UNLOADED_EVENT,this._onModelUnloaded),this.viewer.addEventListener(fe.AGGREGATE_SELECTION_CHANGED_EVENT,this._onAggregatedSelectionChanged),this.selectedObjectID=e,this.dropMeExt.dispatchEvent({type:Te.OBJECT_SELECTED_EVENT,selectedObjectID:e})}},{key:"_onAggregatedSelectionChanged",value:function(e){var t=e.selections&&1===e.selections.length&&e.selections[0];(t.dbIdArray&&1===t.dbIdArray.length&&t.dbIdArray[0])!==this.selectedObjectID&&e.selections.length&&(this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval),this.viewer.removeEventListener(fe.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded),this.viewer.removeEventListener(fe.AGGREGATE_SELECTION_CHANGED_EVENT,this._onAggregatedSelectionChanged),this.chosenPos=null,this.selectedObjectID=null)}},{key:"_onModelAdded",value:function(e){var t=this,i=e.model;this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval),this.selectedObjectID&&i.is3d()&&this._waitForAllModels().then((function(){return t._placeMeToObject()}))}},{key:"_onModelUnloaded",value:function(){this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval)}},{key:"_placeMeToObject",value:function(){var t=this;this.isGeometryLoaded=this._loadingAllGeometriesDone();var i=this._getAllBoundingBoxes();if(this.selectionBox=i[this.selectedObjectID],this.selectionBox){this._setBoundingBoxPoints(),this.selectionCenter=this.selectionBox.center(),delete i[this.selectedObjectID];var n=this._createCandidates(),o=this._getCloseBoxesKeys(i),r=this._getBetterCandidates(n,i,o);this.chosenPos=this._chooseBestCandidate(r,i,o),this.dropMeExt.dispatchEvent({type:Te.POSITION_FOUND_EVENT,position:this.chosenPos.position,target:this.selectionCenter,applySelectionCB:function(){return t._applySelections(t.chosenPos)}}),this.isGeometryLoaded||this._waitForAllInstanceTrees().then((function(){t.hidingObjectInterval&&clearInterval(t.hidingObjectInterval),t.hidingObjectInterval=setInterval((function(){return t._hideCurrentIntersections()}),e.HIDING_INTERVAL_FREQUENCY)}))}else this.pos3dFrom2d&&this.dropMeExt.dispatchEvent({type:Te.POSITION_FOUND_EVENT,position:this.pos3dFrom2d,target:this.pos3dFrom2d.clone().add(new THREE.Vector3(0,1,0)),isPosFrom2dTo3dMatrix:!0})}},{key:"_getAllBoundingBoxes",value:function(){for(var e={},t=this.viewer.getVisibleModels(),i=0;i<t.length;i++){var n=t[i].getFragmentList();e=Object.assign(e,this._getBoundingBoxes(n))}return e}},{key:"_getBoundingBoxes",value:function(e){for(var t={},i=new THREE.Box3,n=0;n<e.fragments.length;n++){var o=e.fragments.fragId2dbId[n];t[o]||(t[o]=new THREE.Box3),e.getWorldBounds(n,i),t[o].union(i)}return t}},{key:"_createCandidates",value:function(){var t=this._getHeight(this.selectionCenter.z);this.maxDistance=Number.MIN_VALUE;var i,n=this.viewer.navigation.getWorldRightVector(),o=this.viewer.navigation.getWorldUpVector().cross(n),r=this.selectionBox.size(),a=Math.abs(r.clone().multiply(n).length()),s=Math.abs(r.clone().multiply(o).length()),l=Math.max(a,s);l/Math.min(a,s)>e.COVERAGE_FACTOR&&(i=l===a?n:o),this.viewer.navigation.toPerspective();for(var u=[],h=0;h<e.NUMBER_OF_POSITION;++h){var c=h/(e.NUMBER_OF_POSITION/2)*Math.PI,d=this.selectionCenter.clone().add(new THREE.Vector3(Math.cos(c),-Math.sin(c),0)),p=this.viewer.navigation.getVerticalFov(),v=this.viewer.getCamera().aspect,f=this.viewer.navigation.computeFit(d,this.selectionCenter,p,this.selectionBox,v).position,m=f.clone().sub(this.selectionCenter);f.add(m.clone().multiplyScalar(.1)),f.z=t;var g=i&&m.normalize().dot(i),y=g&&Math.abs(g)>Math.cos(THREE.Math.degToRad(e.IGNORE_ANGLE)),E=this.selectionCenter.clone().sub(f.clone()),w=E.clone().normalize(),x=new THREE.Ray(f.clone(),w.clone()),b=x.intersectBox(this.selectionBox),k=b&&b.sub(f).length(),S=E.length();this.maxDistance=Math.max(this.maxDistance,k,S),k&&!y&&u.push({index:h,position:f,ray:x,distanceToTarget:k,distanceToCenterTarget:S,selectionID:this.selectedObjectID,intersections:[],cornerIntersections:[],cornerIntersectionsToHide:[]})}return u}},{key:"_getClientViewBoundingBox",value:function(e){for(var t=new THREE.Box3,i=0;i<this.boundingBoxPoints.length;i++){var n=this.boundingBoxPoints[i],o=this.viewer.impl.worldToClient(n,e);t.min.x>o.x&&(t.min.x=o.x),t.max.x<o.x&&(t.max.x=o.x),t.min.y>o.y&&(t.min.y=o.y),t.max.y<o.y&&(t.max.y=o.y)}return t}},{key:"_setBoundingBoxPoints",value:function(){this.boundingBoxPoints=[];for(var e=0;e<8;e++){var t=new THREE.Vector3;t.x=0==!!(1&e)?this.selectionBox.max.x:this.selectionBox.min.x,t.y=0==!!(2&e)?this.selectionBox.max.y:this.selectionBox.min.y,t.z=0==!!(4&e)?this.selectionBox.max.z:this.selectionBox.min.z,this.boundingBoxPoints.push(t)}}},{key:"_getCloseBoxesKeys",value:function(t){var i=this;return Object.keys(t).filter((function(n){return t[n].center().clone().sub(i.selectionCenter).length()<i.maxDistance*e.DISTANCE_FACTOR}))}},{key:"_getBetterCandidates",value:function(e,t,i){for(var n=this,o=[],r=Number.POSITIVE_INFINITY,a=function(a){var s=e[a];if(n.isGeometryLoaded){var l=[];s.intersections=[],n.viewer.impl.rayIntersect(s.ray,!1,!1,!1,l);var u=n._getClosestIntersectionWithSelectedObject(l);u?s.distanceToTarget=u:u=s.distanceToCenterTarget,l.forEach((function(e){e.dbId!==n.selectedObjectID&&-1===s.intersections.indexOf(e.dbId)&&e.distance<u&&s.intersections.push(e.dbId)}))}else s.intersections=n._getIntersectionsOfRayWithBoundingBoxes(s,s.ray,r,t,i);s.intersections.length===r?o.push(s):s.intersections.length<r&&(o=[s],r=s.intersections.length)},s=0;s<e.length;++s)a(s);return o}},{key:"_chooseBestCandidate",value:function(e,t,i){var n,o=this,r=Number.MAX_VALUE;return e.forEach((function(e){n=n||e;for(var a=0;a<o.boundingBoxPoints.length;a++){var s=o.boundingBoxPoints[a],l=s.clone().sub(o.selectionCenter).multiplyScalar(.1);s.sub(l);var u,h,c=s.clone().sub(e.position).normalize(),d=new THREE.Ray(e.position.clone(),c),p=[];if(o.isGeometryLoaded){if("continue"===function(){o.viewer.impl.rayIntersect(d,!1,!1,!1,p);var e=o._getClosestIntersectionWithSelectedObject(p);if(!e)return"continue";p=(p=p.filter((function(t){return t.dbId!==o.selectedObjectID&&t.distance<=e}))).map((function(e){return e.dbId}))}())continue}else p=o._getIntersectionsOfRayWithBoundingBoxes(e,d,r,t,i);if(p.length&&((u=e.cornerIntersections).push.apply(u,pe(p)),e.cornerIntersections=pe(new Set(e.cornerIntersections)),e.cornerIntersections.length>r))break;o.isGeometryLoaded&&s.clone().sub(o.selectionCenter).dot(e.ray.direction)>0&&p.length&&((h=e.cornerIntersectionsToHide).push.apply(h,pe(p)),e.cornerIntersectionsToHide=pe(new Set(e.cornerIntersections)))}var v=e.cornerIntersections.length;o._isInsideOtherObject(e,t,i)&&v++,v<r?(r=v,n=e):v===r&&(e.distanceToCenterTarget===n.distanceToCenterTarget?e.distanceToTarget<n.distanceToTarget&&(n=e):e.distanceToCenterTarget<n.distanceToCenterTarget&&(n=e))})),n}},{key:"_getIntersectionsOfRayWithBoundingBoxes",value:function(e,t,i,n,o){for(var r=[],a=o.length,s=0;s<a;++s){var l=o[s],u=n[l],h=parseInt(l),c=u&&t.intersectBox(u),d=c&&e.position.clone().sub(c).length();if(d&&d<e.distanceToTarget&&(r.push(h),r.length>i))break}return r}},{key:"_isInsideOtherObject",value:function(e,t,i){for(var n=0;n<i.length;++n)if(t[i[n]].containsPoint(e.position))return!0;return!1}},{key:"_getClosestIntersectionWithSelectedObject",value:function(e){var t=this,i=e.filter((function(e){return e.dbId===t.selectedObjectID})),n=Number.MAX_VALUE;if(!i[0])return null;for(var o=0;o<i.length;o++)i[o].distance<n&&(n=i[o].distance);return n}},{key:"_hideCurrentIntersections",value:function(e){if(this.chosenPos){var t=!1,i=[];this.viewer.impl.rayIntersect(this.chosenPos.ray,!1,!1,!1,i),t=this._hideIntersectionsCandidates(i,!0),e&&(t=this._hideCornersIntersections()||t),t&&this.viewer.impl.invalidate(!0,!0,!0)}}},{key:"_hideCornersIntersections",value:function(){for(var t=!1,i=0;i<this.boundingBoxPoints.length;i++)for(var n=this.boundingBoxPoints[i],o=0;o<e.NUMBER_OF_CORNER_INTERSECTIONS;o++){var r=[],a=n.clone().sub(this.selectionCenter).multiplyScalar(o/e.NUMBER_OF_CORNER_INTERSECTIONS);n.sub(a);var s=n.clone().sub(this.chosenPos.position).normalize(),l=new THREE.Ray(this.chosenPos.position.clone(),s);this.viewer.impl.rayIntersect(l,!1,!1,!1,r),t=this._hideIntersectionsCandidates(r)||t}return t}},{key:"_hideIntersectionsCandidates",value:function(e,t){var i,n=e.length,o=!1;if(n>1&&(i=this._getClosestIntersectionWithSelectedObject(e),t&&i&&!this._isSelected(this.selectedObjectID)&&this.allTreesLoaded()&&this.viewer.select(this.selectedObjectID),t||i))for(var r=0;r<n;r++){var a=e[r];a.dbId!==this.selectedObjectID&&a.distance<(i||this.chosenPos.distanceToCenterTarget)&&(this.viewer.hide(a.dbId),o=!0)}return o}},{key:"_isSelected",value:function(e){for(var t=this.viewer.getVisibleModels(),i=0;i<t.length;++i)if(t[i].selector.isSelected(e))return!0;return!1}},{key:"_applySelections",value:function(e){if(e&&this.allTreesLoaded())if(this._isSelected(e.selectionID)||this.viewer.select(e.selectionID),this.isGeometryLoaded)this._hideCurrentIntersections(!0);else{for(var t=0;t<e.intersections.length;++t)this.viewer.hide(e.intersections[t]);for(var i=0;i<e.cornerIntersectionsToHide.length;++i)this.viewer.hide(e.cornerIntersectionsToHide[i])}}},{key:"_getHeight",value:function(e){var t=this.viewer.model.getData().metadata["distance unit"].value||"foot",i=1.8/this.viewer.model.getUnitData(t).unitScale,n=g(this.viewer.model.getDocumentNode().getAecModelData(),this.viewer.model.myData.placementWithOffset);return n.length?(e<n[0].zMin?n[0]:e>n[n.length-1].zMax?n[n.length-1]:n.find((function(t){return t.zMin<=e&&t.zMax>=e}))).zMin+i:this.selectionBox.min.z+i}},{key:"_pending3DLoaders",value:function(){return!!this.viewer.impl.loaders.filter((function(e){return e.is3d()})).length}},{key:"_loadingAllGeometriesDone",value:function(){for(var e=this.viewer.getVisibleModels(),t=0;t<e.length;++t)if(!e[t].isLoadDone())return!1;return!this._pending3DLoaders()}},{key:"_waitForAllModels",value:function(){var e=this;return new Promise((function(t,i){!function i(n){!function(){for(var t=e.viewer.getVisibleModels(),i=0;i<t.length;++i)if(!t[i].modelRootLoaded)return!1;return!e._pending3DLoaders()}()?e.viewer.addEventListener(fe.MODEL_ROOT_LOADED_EVENT,i,{once:!0}):t()}()}))}},{key:"allTreesLoaded",value:function(){for(var e=this.viewer.getVisibleModels(),t=0;t<e.length;++t)if(!e[t].getInstanceTree())return!1;return!this._pending3DLoaders()}},{key:"_waitForAllInstanceTrees",value:function(){var e=this;return new Promise((function(t,i){!function i(n){e.allTreesLoaded()?t():e.viewer.addEventListener(fe.OBJECT_TREE_CREATED_EVENT,i,{once:!0})}()}))}},{key:"_onGeometryLoaded",value:function(){var e=this;this._loadingAllGeometriesDone()&&(this.viewer.removeEventListener(fe.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded),this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval),this.selectedObjectID&&this.chosenPos&&this._waitForAllInstanceTrees().then((function(){e.viewer.clearSelection(),e._isSelected(e.selectedObjectID)||e.viewer.select(e.selectedObjectID),e._hideCurrentIntersections(!0),e.viewer.impl.invalidate(!0,!0,!0),e.chosenPos=null,e.selectedObjectID=null})))}},{key:"_getSelected3dPosFrom2d",value:function(e,t){var i=this.viewer.impl.computeSelectionBounds([e],t),n=this.viewer.impl.worldToClient(i.center()),o=this.dropMeExt.dropMeTool._get3DCameraPositionAndVp(n.x,n.y);return o&&o.pos}}])&&ve(t.prototype,i),n&&ve(t,n),e}();function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function we(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?be(e):t}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}me.HIDING_INTERVAL_FREQUENCY=300,me.NUMBER_OF_CORNER_INTERSECTIONS=10,me.DISTANCE_FACTOR=3,me.COVERAGE_FACTOR=4,me.IGNORE_ANGLE=35,me.NUMBER_OF_POSITION=8;var Se=Autodesk.Viewing,Me=Autodesk.Viewing.UI,_e=AutodeskNamespace("Autodesk.AEC"),Te=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{teleportOnRelease:!0};return ye(this,t),i=we(this,xe(t).call(this,e,n)),Autodesk.Viewing.EventDispatcher.prototype.apply(be(i)),i.teleportOnRelease=n.teleportOnRelease,i.viewer=e,i._onModelLoaded=i._onModelLoaded.bind(be(i)),i._deactivateTool=i._deactivateTool.bind(be(i)),i.onDropOverride=null,i.options=n,i.options.triggerDeactivate=i._deactivateTool,i.options.isSupportedViewport=t.IsSupportedViewport,i.toggleIndex=n.toggleIndex||0,i.enableGuidance=n.enableGuidance||!1,i.dropMeTool=new de(e,(function(){var e;return(e=i)._onDrop.apply(e,arguments)}),i.options),i.options.enableViewIn3d&&(i.viewObjectIn3D=new me(be(i),e,i.options)),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(t,e),i=t,o=[{key:"IsSupportedViewport",value:function(e){var t=Boolean(ie.getLinkedLevel(e)),i="FloorPlan"===e.viewType&&!t;return ie.supports2DTo3DTransform(e)&&!i}}],(n=[{key:"load",value:function(){return this.viewer.addEventListener(Se.MODEL_ADDED_EVENT,this._onModelLoaded),this.viewer.model&&this._initUI(this.viewer.model),!0}},{key:"unload",value:function(){return this.viewer.removeEventListener(Se.MODEL_ADDED_EVENT,this._onModelLoaded),this.viewer.toolController.setIsLocked(!1),this._deactivateTool(),this._destroyUI(),!0}},{key:"setOnDrop",value:function(e){this.onDropOverride=e}},{key:"_destroyUI",value:function(){this._showDrop(!1),this.dropMeButton&&(this.dropMeButton.removeFromParent(),this.dropMeButton=null)}},{key:"_onDrop",value:function(e,i,n){this.teleportOnRelease&&(this.viewer.toolController.setIsLocked(!1),this._deactivateTool()),console.log("DropMe: 3D camera position is ".concat(JSON.stringify(e))),console.log("DropMe: 3D camera direction is ".concat(JSON.stringify(i))),this.dispatchEvent({type:t.DROP_ME_EVENT,pos:e,dir:i,mode:n}),this.onDropOverride?this.onDropOverride(e,i,n):this.options.onDrop?this.options.onDrop(e,i,n):console.warn("DropMe: No onDrop callback specified ")}},{key:"_onModelLoaded",value:function(e){this.uiInitialized?this._updateUI(e.model):this._initUI(e.model)}},{key:"_deactivateTool",value:function(){this.uiInitialized&&(this._showGuidenaceUI(!1),this.dropMeButton.setState(Me.Button.State.INACTIVE)),this.viewer.toolController.deactivateTool("drop-me")}},{key:"isSupportedModel",value:function(e){if(!(e&&e.isAEC&&e.isAEC()&&e.is2d())||e.isPdf())return!1;if(!e.getDocumentNode())return!1;var i=ie.findViewportsOnSheet(e);return i.length&&i.find(t.IsSupportedViewport)}},{key:"_updateUI",value:function(e){var t=this.viewer.getToolbar&&this.viewer.getToolbar();t&&(this.dropMeButton.removeFromParent(),t.getControl(Se.TOOLBAR.NAVTOOLSID).addControl(this.dropMeButton,{index:this.toggleIndex}),this._showDrop(this.isSupportedModel(e)))}},{key:"_initUI",value:function(e){var t=this;this.viewer.getToolbar&&this.viewer.getToolbar()&&(this.dropMeButton=new Me.Button("drop-me-icon"),this.dropMeButton.icon.innerHTML=Ae(),this._updateUI(e),this.dropMeButton.onClick=function(){t.dropMeTool.active?t._deactivateTool():(t.dropMeButton.setState(Me.Button.State.ACTIVE),t.viewer.toolController.activateTool("drop-me"),t._showGuidenaceUI())},this.uiInitialized=!0)}},{key:"_showGuidenaceUI",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.enableGuidance)if(e){var t=this.getDocument();this.guidenaceUI=t.createElement("div"),this.guidenaceUI.className="dropme-guidenace-ui",this.guidenaceUI.innerHTML=Autodesk.Viewing.i18n.translate("Click on a location to ground yourself, then select a camera direction"),this.viewer.container.appendChild(this.guidenaceUI)}else this.viewer.container.contains(this.guidenaceUI)&&this.viewer.container.removeChild(this.guidenaceUI)}},{key:"_showDrop",value:function(e){if(this.dropMeButton){this.viewer.getToolbar().getControl(Se.TOOLBAR.NAVTOOLSID)&&!this.container&&this.dropMeButton.setState(e?Me.Button.State.INACTIVE:Me.Button.State.DISABLED);var t=Autodesk.Viewing.i18n.translate("Click a 2D location to view that space in 3D"),i=Autodesk.Viewing.i18n.translate("Current view is not supported by Place Me");this.dropMeButton.setToolTip(e?t:i)}}}])&&Ee(i.prototype,n),o&&Ee(i,o),t}(Se.Extension),Ae=function(){return['<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">','<g stroke="currentColor" fill="currentColor">','<path d="M67,0c2.4.5,4.8.9,7.1,1.6C87.5,5.3,96.6,16.6,98,31a37.2,37.2,0,0,1-2.1,16.2c-4.7,13-23.6,48.1-31.6,58.2-.3-.2-.6-.3-.8-.5-11.1-17.6-21.9-35.4-30-54.7-4.6-10.9-4.6-21.7.6-32.3S47.5,2.6,58.3.7l3-.7ZM64,47A11.8,11.8,0,1,0,52.3,34.9,12,12,0,0,0,64,47Z"/>','<path d="M12.8,103.4c1.4-8,6.9-12.3,14-14.6s12-2.9,18.1-4.2c1.1-.2,2.4.5,3.4,1.5-4.5,1.1-9.1,1.8-13.5,3.3a35,35,0,0,0-9.6,5c-4,3-4.3,7.5-.7,10.9a28.7,28.7,0,0,0,9.6,6.2,87.3,87.3,0,0,0,59.9.1,28.2,28.2,0,0,0,8.7-5.2c4.9-4.1,4.8-9.7-.8-12.8S90.7,89.3,85,87.3c-1.6-.6-3.4-.6-5.3-1.7,1.1-.4,2.2-1.2,3.2-1.1,7.8.9,15.5,2.2,22.6,6,12,6.4,13,17.9,2.1,26.1-8.1,6.1-17.6,8.5-27.4,10L69.1,128H59.2l-5.2-.7c-9.1-.8-18-2.6-26.4-6.5s-13.4-8.1-14.9-16.8Z"/>',"</g>","</svg>"].join("")};function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Le(e,t,i){return t&&Ve(e.prototype,t),i&&Ve(e,i),e}_e.DropMeExtension=Te,Te.POSITION_FOUND_EVENT="POSITION_FOUND_EVENT",Te.OBJECT_SELECTED_EVENT="OBJECT_SELECTED_EVENT",Te.DROP_ME_EVENT="DROP_ME_EVENT",Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.DropMeExtension",Te);var De=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;Ce(this,e),this._clusterfck=t,this.setDistanceFuncAndThreshold(i,n)}return Le(e,null,[{key:"FlattenCluster",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.value?i.push(t.value):(e.FlattenCluster(t.left,i),e.FlattenCluster(t.right,i)),i}},{key:"ComputeMeanValueForFlattenCluster",value:function(e){var t=new THREE.Box3,i=new THREE.Box3;return e.forEach((function(e){t.expandByPoint(e.currentPosProjected),i.expandByPoint(e.currentPos3D)})),{center2D:t.center(),center3D:i.center()}}}]),Le(e,[{key:"setDistanceFuncAndThreshold",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this._distanceFunc=e,this._threshold=t}},{key:"setThreshold",value:function(e){this._threshold=e}},{key:"createClusters",value:function(e){return this._clusterfck.hcluster(e,this._distanceFunc,this._clusterfck.AVERAGE_LINKAGE,this._threshold)}}]),e}();function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne,Fe,He,ze,je,Ge,We,Ue,Ye,Ze=Autodesk.Viewing,Xe=Ze.Private,qe=Autodesk.Viewing.UI,Je=AutodeskNamespace("Autodesk.AEC"),Ke="Autodesk.AEC.LevelsExtension",Qe="CanvasBookmark_Extension_Overlay",$e=(Ne=new THREE.Vector3,Fe=new THREE.Vector3,He=new THREE.Vector3,ze=new THREE.Vector3,je=new THREE.Quaternion,Ge=new THREE.Quaternion,We=new THREE.Vector3,Ue=new THREE.Vector3,Ye=new THREE.Quaternion,function(e,t,i,n){return e.decompose(Ne,je,He),t.decompose(Fe,Ge,ze),We.lerpVectors(Ne,Fe,i),Ue.lerpVectors(He,ze,i),THREE.Quaternion.slerp(je,Ge,Ye,i),n.compose(We,Ye,Ue),n}),et=function(e){var t=e.clone();return t.transform=e.transform?e.transform.clone():new THREE.Matrix4,t},tt=function(e,t){e.visiblityChangePending=!0,requestAnimationFrame((function(){t?e.container.classList.add("visible"):e.container.classList.remove("visible"),e.visiblityChangePending=!1}))},it=function(e){function t(e,i){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Pe(t).call(this,e,i))||"object"!==Oe(r)&&"function"!=typeof r?Re(o):r).viewer=e,n.bookmarks=[],n.clusteredBookmarks=[],n.camera=n.viewer.navigation.getCamera(),n.cameraMovedCB=n.onCameraMoved.bind(Re(n)),n.onVisibilityChangedCB=n.onVisibilityChanged.bind(Re(n)),n.sectionBox=null,n.activeSectionBox=null,n.animStartSectionBox=null,n.animEndSectionBox=null,n.sectionBoxAnim=null,n.changeBookmarksVisibility=n.changeBookmarksVisibility.bind(Re(n)),n.changeBookmarksVisibilityTimeout=null,n._clusteringEnabled=void 0!==n.options.clusterfck,n._clusteringThreshold=n.options.clusteringThreshold||110,n._clusteringEnabled&&(n.hcluster=new De(n.options.clusterfck,(function(e,t){var i=new THREE.Vector2(e.currentPosProjected.x,e.currentPosProjected.y);return new THREE.Vector2(t.currentPosProjected.x,t.currentPosProjected.y).distanceTo(i)}),n._clusteringThreshold)),n._filterOutInvisibleBookmark=n._filterOutInvisibleBookmark.bind(Re(n)),n.levelChangedCB=n.onLevelChanged.bind(Re(n)),n.extensionLoadedCB=n.onExtensionLoaded.bind(Re(n)),n.isFrustumFading=!1,n.waitingCallbacks=[],n}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(t,e),i=t,(n=[{key:"setBookmarksVisible",value:function(e){this.bookmarks.forEach((function(t){return tt(t.marker,e)})),this.clusteredBookmarks.forEach((function(t){return tt(t.marker,e)})),e||this.stopGhosting()}},{key:"onVisibilityChanged",value:function(e){this.viewer.prefs&&this.viewer.prefs.set("canvasBookmarks",e),this.setBookmarksVisible(e),e&&this.updateBookmarkPositions()}},{key:"isVisible",value:function(){return this.viewer.prefs&&this.viewer.prefs.get("canvasBookmarks")}},{key:"onCameraMoved",value:function(){this.setBookmarksVisible(!1),this.debounceBookmarksVisibility()}},{key:"createTooltip",value:function(e,t){e.setToolTip(t.name()),e._toolTipElement.innerHTML="<b>".concat(t.name(),"</b>")}},{key:"flyToBookmark",value:function(e){var t={position:e.pos,target:e.target,up:e.up};this.anim=Xe.flyToView(this.viewer,t,1)}},{key:"createBookmark",value:function(e){var t=this,i=e.extractCamera();if(i){var n=i.position,o=i.target,r=e.getRootNode().extractRefPointTransform();this.options.globalOffset&&r&&(n.applyMatrix4(r),n.sub(this.options.globalOffset),o.applyMatrix4(r),o.sub(this.options.globalOffset));var a=new THREE.Vector3(o.x-n.x,o.y-n.y,o.z-n.z).normalize(),s=new THREE.Vector3(0,0,1),l=new Autodesk.Viewing.UI.Button("b-".concat(e.name().replace(/\s/g,"")));l.container.classList.add("canvas-bookmark"),l.container.innerHTML=['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 114 114">',"<defs>",'<path id="camera-view-icon-3-with-shadow-v3-b" d="M60.934065,73.4602645 C54.1164768,73.4602645 48.5886781,67.9324658 48.5886781,61.1148776 C48.5886781,54.2963836 54.1164768,48.7694907 60.934065,48.7694907 C67.752559,48.7694907 73.2803577,54.2963836 73.2803577,61.1148776 C73.2803577,67.9324658 67.752559,73.4602645 60.934065,73.4602645 M78.7230158,42.834104 C77.2575106,42.9581919 75.7711731,42.808743 74.2984219,42.8748628 C73.4714712,42.9119986 72.9388896,42.637556 72.4470667,41.9817922 C70.947143,39.9827997 69.3693246,38.0417751 67.8621549,36.0491228 C67.287003,35.2873862 66.5959149,34.9939228 65.6521223,35.0029804 C62.0046628,35.0355874 58.354486,35.0401161 54.7070265,35.0002631 C53.7097946,34.9893941 53.0033088,35.3145587 52.4046073,36.1116196 C50.9028721,38.1088007 49.382116,40.0951128 47.7852769,42.0171165 C47.4311283,42.4437253 46.748192,42.7707014 46.1884378,42.8187062 C44.8515493,42.9346424 43.4974514,42.855842 41.9640149,42.855842 C41.9640149,42.2091358 41.9929989,41.6520989 41.9576746,41.0995907 C41.8897433,40.036239 41.3046281,39.4293858 40.2331246,39.4112707 C38.5112919,39.381381 36.7894591,39.3759465 35.0676263,39.4130822 C33.9934056,39.4366318 33.4291227,40.057977 33.3892696,41.1303863 C33.3693431,41.6557219 33.3856466,42.1819632 33.3856466,42.8078372 C31.121269,42.9074698 29.8523117,44.2289606 29,46.07941 L29,75.8722796 C30.0434252,78.4165343 31.9636175,79.1737422 34.6482636,79.1583444 C49.3911736,79.0686751 64.1340835,79.0713923 78.8769935,79.1556272 C81.5299383,79.1710249 83.372236,78.3377339 84.4011692,75.8722796 L84.4011692,46.07941 C83.3332887,43.5523646 81.4058504,42.6067605 78.7230158,42.834104"/>','<filter id="camera-view-icon-3-with-shadow-v3-a" width="125.3%" height="131.7%" x="-12.6%" y="-11.3%" filterUnits="objectBoundingBox">','<feOffset dy="2" in="SourceAlpha" result="shadowOffsetOuter1"/>','<feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="2"/>','<feColorMatrix in="shadowBlurOuter1" values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.1 0"/>',"</filter>",'<path id="camera-view-icon-3-with-shadow-v3-d" d="M104.440851,57.2204256 C104.440851,83.2997158 83.2997158,104.440851 57.2204256,104.440851 C31.1411354,104.440851 10,83.2997158 10,57.2204256 C10,31.1411354 31.1411354,10 57.2204256,10 C83.2997158,10 104.440851,31.1411354 104.440851,57.2204256 Z"/>','<filter id="camera-view-icon-3-with-shadow-v3-c" width="125.5%" height="125.5%" x="-12.8%" y="-10.6%" filterUnits="objectBoundingBox">','<feMorphology in="SourceAlpha" operator="dilate" radius="5.045" result="shadowSpreadOuter1"/>','<feOffset dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"/>','<feMorphology in="SourceAlpha" radius="5.045" result="shadowInner"/>','<feOffset dy="2" in="shadowInner" result="shadowInner"/>','<feComposite in="shadowOffsetOuter1" in2="shadowInner" operator="out" result="shadowOffsetOuter1"/>','<feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="2"/>','<feColorMatrix in="shadowBlurOuter1" values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.1 0"/>',"</filter>","</defs>",'<g fill="none" fill-rule="evenodd">','<use fill="#000" filter="url(#camera-view-icon-3-with-shadow-v3-a)" xlink:href="#camera-view-icon-3-with-shadow-v3-b"/>','<use fill="currentColor" xlink:href="#camera-view-icon-3-with-shadow-v3-b"/>',"<g>",'<use fill="#000" filter="url(#camera-view-icon-3-with-shadow-v3-c)" xlink:href="#camera-view-icon-3-with-shadow-v3-d"/>','<use stroke="currentColor" stroke-width="10.09" xlink:href="#camera-view-icon-3-with-shadow-v3-d"/>',"</g>","</g>","</svg>"].join(""),tt(l,this.isVisible()),this.createTooltip(l,e),this.viewer.container.appendChild(l.container);var u=l.getDimensions(),h=this.findSectionBox(e,e.name()),c=h?h.center().applyMatrix4(h.transform):null,d={marker:l,pos:h?c:n,cameraPos:n,dir:a,up:s,target:o,name:e.name(),anchorX:u.width/2,anchorY:u.height/2,fadeValue:0,hovered:!1,bubbleNode:e,clustered:!1};return l.container.addEventListener("mouseenter",(function(){t.onBookmarkMouseEnter(d)})),l.container.addEventListener("mouseleave",(function(){t.onBookmarkMouseLeave(d)})),l.addEventListener(qe.Button.Event.CLICK,(function(){t.options&&t.options.onBookmark&&t.options.onBookmark(d.bubbleNode,i)})),d}}},{key:"createClusteredBookmark",value:function(e,t,i){var n=this,o=new Autodesk.Viewing.UI.Button(t);o.container.classList.add("clustered-canvas-bookmark"),o.container.innerHTML=['<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 652 598">','<path fill="currentColor" d="M254.7,94.3A157.6,157.6,0,1,0,412.3,251.9,157.6,157.6,0,0,0,254.7,94.3ZM173.6,281.4a24.2,24.2,0,1,1,23.9-24.2A23.8,23.8,0,0,1,173.6,281.4Zm86.6,0a24.2,24.2,0,1,1,23.9-24.2A23.8,23.8,0,0,1,260.2,281.4Zm86.7,0a24.2,24.2,0,1,1,23.9-24.2A23.8,23.8,0,0,1,346.9,281.4Z"/>','<circle fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="42.87px" cx="256" cy="256" r="221.5" transform="translate(-101.8 200.6) rotate(-36.2)"/>',"</svg>"].join(""),tt(o,this.isVisible()&&i),this.viewer.container.appendChild(o.container);var r=De.ComputeMeanValueForFlattenCluster(e),a={marker:o,name:t,pos:r.center3D,currentPosProjected:r.center2D,cluster:e,fadeValue:0,hovered:!1,folded:!0};o.container.addEventListener("mouseenter",(function(){n.onClusteredBookmarkMouseEnter(a)})),o.container.addEventListener("mouseleave",(function(){n.onClusteredBookmarkMouseLeave(a)})),o.addEventListener(qe.Button.Event.CLICK,(function(){n.onClusteredBookmarkClicked(a)})),a.marker.container.style.transform="translate(".concat(r.center2D.x,"px, ").concat(r.center2D.y,"px)"),this.clusteredBookmarks.push(a)}},{key:"deleteBookmark",value:function(e){this.viewer.container.removeChild(e.marker.container),this.hideFrustumShape(e)}},{key:"clearBookmarks",value:function(){var e=this;this.stopSectionBoxAnim(),this.applySectionBox(),this.bookmarks.forEach((function(t){e.deleteBookmark(t)})),this.bookmarks=[],this.clusteredBookmarks.forEach((function(t){e.deleteBookmark(t)})),this.clusteredBookmarks=[]}},{key:"resetBookmarks",value:function(e){var t=this;this.clearBookmarks(),e&&Ze.Document.getAecModelData(e).then((function(){for(var i=0;i<e.length;i++){var n=e[i],o=t.createBookmark(n);o&&t.bookmarks.push(o)}t.bookmarkData=e,t.updateBookmarkPositions()}))}},{key:"resetGlobalOffset",value:function(e){this.options.globalOffset=e,this.resetBookmarks(this.bookmarkData)}},{key:"showFrustumShape",value:function(e){e.frustumShape||(e.frustumShape=function(e,t){for(var i=THREE.Math.degToRad,n=Math.sin(i(17)),o=Math.sin(i(17)),r=Math.sqrt(1-n*n-o*o),a=new THREE.Vector3(-n,-o,r),s=new THREE.Vector3(n,-o,r),l=new THREE.Vector3(-n,o,r),u=new THREE.Vector3(n,o,r),h=new Float32Array([a.x,a.y,a.z,s.x,s.y,s.z,l.x,l.y,l.z,u.x,u.y,u.z,0,0,0]),c=new Uint32Array([4,1,0,4,3,1,4,2,3,4,0,2,0,1,3,0,3,2]),d=new Float32Array(3*c.length),p=0;p<c.length;p++){var v=c[p];d[3*p]=h[3*v],d[3*p+1]=h[3*v+1],d[3*p+2]=h[3*v+2]}var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.BufferAttribute(d,3)),f.computeVertexNormals();var m=new THREE.MeshPhongMaterial({color:5263615,transparent:!0,opacity:0,depthTest:!1,depthWrite:!1,blending:THREE.NoBlending}),g=new THREE.Mesh(f,m),y=new Uint32Array([4,0,4,1,4,3,4,2,0,1,1,3,3,2,2,0]),E=new THREE.BufferGeometry;E.addAttribute("index",new THREE.BufferAttribute(y,1)),E.addAttribute("position",new THREE.BufferAttribute(h,3)),E.isLines=!0;var w=new THREE.LineBasicMaterial({color:16777215,transparent:!0,side:THREE.DoubleSide,opacity:0,depthTest:!1,depthWrite:!1,blending:THREE.NoBlending}),x=new THREE.Mesh(E,w),b=new THREE.Scene;b.add(g),b.add(x),f.visible=!0,E.visible=!0,g.name="FrustumGizmo",b.scale.set(50,50,50),b.position.copy(e);var k=new THREE.Vector3(0,0,0),S=new THREE.Vector3(0,0,1),M=new THREE.Vector3(-t.x,-t.y,-t.z),_=(new THREE.Matrix4).lookAt(k,M,S);return b.rotation.setFromRotationMatrix(_),b.frustumCulled=!1,g.frustumCulled=!1,x.frustumCulled=!1,b.setFadeValue=function(e){m.opacity=.05*e,w.opacity=1*e},b}(e.cameraPos,e.dir),this.viewer.impl.addOverlay(Qe,e.frustumShape),e.frustumShape.name=e.bubbleNode.name(),this.viewer.impl.updateCameraMatrices())}},{key:"hideFrustumShape",value:function(e){e.frustumShape&&(this.viewer.impl.removeOverlay(Qe,e.frustumShape),e.frustumShape=null)}},{key:"setFrustumFadeValue",value:function(e,t){e.fadeValue=t,e.frustumShape&&e.frustumShape.setFadeValue(t)}},{key:"updateFrustumShapeFading",value:function(e,t){var i=e.hovered&&e.fadeValue<1,n=!e.hovered&&e.fadeValue>0;if(!i&&!n)return!1;var o=t/500,r=t/500,a=e.fadeValue+(i?o:-r);return a=THREE.Math.clamp(a,0,1),this.setFrustumFadeValue(e,a),e.marker&&e.marker._toolTipElement&&(e.marker._toolTipElement.style.opacity=Math.min(1,3*a)),e.hovered||0!==e.fadeValue||this.hideFrustumShape(e),this.viewer.impl.invalidate(!1,!1,!0),!0}},{key:"requestTimer",value:function(){var e=this,t=this.getWindow();this.timerId=t.requestAnimationFrame((function(){return e.onTimer()}))}},{key:"onTimer",value:function(){var e=this,t=performance.now(),i=t-this.lastTime;this.lastTime=t,this.isFrustumFading=!1,this.bookmarks.forEach((function(t){var n=e.updateFrustumShapeFading(t,i);e.isFrustumFading=e.isFrustumFading||n})),this.isAllDone()&&(this.waitingCallbacks.forEach((function(e){return e()})),this.waitingCallbacks.length=0),this.requestTimer()}},{key:"findSectionBox",value:function(e,t){var i=e.search({type:"view"});if(!i.length||i[0].data.name!==t)return null;var n=i[0].data.sectionBox,o=i[0].data.sectionBoxTransform;if(!n||!o)return null;var r=(new THREE.Matrix4).fromArray([o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15]]),a=new THREE.Box3;a.min.set(n[0],n[1],n[2]),a.max.set(n[3],n[4],n[5]),a.transform=new THREE.Matrix4;var s=e.getRootNode().getAecModelData().refPointTransformation;if(this.options.globalOffset&&s){var l=this.options.globalOffset,u=Ze.BubbleNode.readMatrixFromArray12(s);a.transform.makeTranslation(-l.x,-l.y,-l.z),a.transform.multiply(u),a.transform.multiply(r)}return a}},{key:"setOverlaySceneVisible",value:function(e){var t=this.viewer.impl.overlayScenes[Qe],i=t&&t.scene;i&&(i.visible=e)}},{key:"getFadeExtension",value:function(){return this.viewer.getExtension("Autodesk.CrossFadeEffects")}},{key:"showGhosting",value:function(){var e=this,t=this.getFadeExtension();t&&(t.acquireControl("CanvasBookmarks",(function(){return e.stopGhosting()})),this.ghostingActive?this.stopGhostFadeOut():(this.viewer.impl.setCutPlaneSet("CanvasBookmark_CutPlanes"),this.setOverlaySceneVisible(!1),t.renderFadingImage(0),this.applySectionBox(this.activeSectionBox),this.setOverlaySceneVisible(!0),this.ghostingActive=!0),t.setCrossFadeOpacity(0,.3))}},{key:"stopGhosting",value:function(){if(this.ghostingActive){this.stopGhostFadeOut();var e=this.getFadeExtension();e&&e.releaseFadingImage(0),this.ghostingActive=!1}}},{key:"stopGhostFadeOut",value:function(){this.ghostFadeAnim&&(this.ghostFadeAnim.skip(),this.ghostFadeAnim=null)}},{key:"fadeOutGhosting",value:function(){var e=this.getFadeExtension();if(this.ghostingActive&&e){var t=e.getCrossFadeOpacity(0);this.ghostFadeAnim=Xe.fadeValue(t,0,.5,(function(t){return e.setCrossFadeOpacity(0,t)}))}}},{key:"onBookmarkMouseEnter",value:function(e){var t=this.findSectionBox(e.bubbleNode,e.name);t&&(this.showGhosting(),this.animateToSectionBox(t)),this.showFrustumShape(e),e.hovered=!0}},{key:"onBookmarkMouseLeave",value:function(e){this.animateToSectionBox(null),this.fadeOutGhosting(),e.hovered=!1}},{key:"onClusteredBookmarkMouseEnter",value:function(e){e.hovered=!0}},{key:"onClusteredBookmarkMouseLeave",value:function(e){e.hovered=!1}},{key:"onClusteredBookmarkClicked",value:function(e){if(e.folded){for(var t=function(e,t,i){var n=Math.cos(i),o=Math.sin(i),r=e.x-t.x,a=e.y-t.y;e.x=r*n-a*o+t.x,e.y=r*o+a*n+t.y},i=e.cluster.length,n=Math.round(360/i),o=new THREE.Vector2(e.currentPosProjected.x,e.currentPosProjected.y),r=new THREE.Vector2(o.x,o.y+35),a=0;a<i;++a){var s=e.cluster[a],l=r.clone();t(l,o,a*n*Math.PI/180),s.currentPosProjected.x=l.x,s.currentPosProjected.y=l.y,s.marker.container.style.transform="translate(".concat(l.x,"px, ").concat(l.y,"px)"),tt(s.marker,!0)}e.marker.container.classList.add("declustered-canvas-bookmark")}else e.cluster.forEach((function(e){tt(e.marker,!1)})),e.marker.container.classList.remove("declustered-canvas-bookmark");e.folded=!e.folded}},{key:"debounceBookmarksVisibility",value:function(){this.changeBookmarksVisibilityTimeout&&clearTimeout(this.changeBookmarksVisibilityTimeout),this.changeBookmarksVisibilityTimeout=setTimeout(this.changeBookmarksVisibility,100)}},{key:"changeBookmarksVisibility",value:function(){this.updateBookmarkPositions()}},{key:"updateBookmarkPositions",value:function(){var e=this;if(this.isVisible()){this.bookmarks.forEach((function(t){var i=t.bubbleNode.sectionBox,n=i?i.center():t.pos;t.currentPos3D=n;var o=e.project(n);o.x-=t.anchorX,o.y-=t.anchorY,t.currentPosProjected=new THREE.Vector3(o.x,o.y,o.z),t.marker.container.style.transform="translate(".concat(o.x,"px, ").concat(o.y,"px)")}));var t=this._clusteringEnabled?this.hcluster.createClusters(this.bookmarks):[];this.updateClusteredBookmarks(t)}}},{key:"updateClusteredBookmarks",value:function(e){var t=this;this.clusteredBookmarks.forEach((function(e){t.deleteBookmark(e)})),this.clusteredBookmarks=[],this.bookmarks.forEach((function(e){tt(e.marker,!1)}));var i=this._getFloorSelector();if(void 0===(i&&i.currentFloor)){this.bookmarks.filter(this._filterOutInvisibleBookmark).forEach((function(e){e.clustered=!1,tt(e.marker,!0)}));for(var n=0;n<e.length;n++){var o=e[n];o.size>1&&function(){var e=De.FlattenCluster(o),i=!1;e.forEach((function(e){e.clustered=!0,!i&&e.marker.isVisible()&&(i=!0),tt(e.marker,!1)})),t.createClusteredBookmark(e,"c-".concat(e[0].bubbleNode.data.viewableID),i)}()}}}},{key:"project",value:function(e){var t=this.viewer.navigation.getScreenViewport(),i=(new THREE.Vector3).copy(e),n=new THREE.Matrix4;return n.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),i.applyProjection(n),new THREE.Vector3(Math.round((i.x+1)/2*t.width),Math.round((1-i.y)/2*t.height),i.z)}},{key:"load",value:function(){this.viewer.prefs.add("canvasBookmarks",!0),this.viewer.addEventListener(Ze.CAMERA_CHANGE_EVENT,this.cameraMovedCB);var e=this._getFloorSelector();return e&&e.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.levelChangedCB),this.viewer.addEventListener(Ze.EXTENSION_LOADED_EVENT,this.extensionLoadedCB),this.updateBookmarkPositions(),this.viewer.impl.createOverlayScene(Qe),this.lastTime=performance.now(),this.requestTimer(),this.updateSettingsPanel||(this.updateSettingsPanel=this.configureSettings.bind(this),this.viewer.addEventListener(Ze.TOOLBAR_CREATED_EVENT,this.updateSettingsPanel)),!0}},{key:"unload",value:function(){this.clearBookmarks(),this.viewer.impl.removeOverlayScene(Qe),this.viewer.removeEventListener(Ze.CAMERA_CHANGE_EVENT,this.cameraMovedCB);var e=this._getFloorSelector();return e&&e.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.levelChangedCB),this.viewer.removeEventListener(Ze.EXTENSION_LOADED_EVENT,this.extensionLoadedCB),this.timerId&&(this.getWindow().cancelAnimationFrame(this.timerId),this.timerId=null),this.updateSettingsPanel&&(this.viewer.removeEventListener(Ze.TOOLBAR_CREATED_EVENT,this.updateSettingsPanel),this.updateSettingsPanel=null),!0}},{key:"applySectionBox",value:function(e){if(this.activeSectionBox=e,e){var t=Xe.SceneMath.box2CutPlanes(e,e.transform);this.viewer.impl.setCutPlaneSet("CanvasBookmark_CutPlanes",t)}else this.viewer.impl.setCutPlaneSet("CanvasBookmark_CutPlanes")}},{key:"getModelBox",value:function(){for(var e=this.viewer.impl.modelQueue().getModels(),t=new THREE.Box3,i=0;i<e.length;i++)t.union(e[i].getBoundingBox());return t}},{key:"stopSectionBoxAnim",value:function(){this.sectionBoxAnim&&(this.sectionBoxAnim.stop(),this.sectionBoxAnim=null)}},{key:"animateToSectionBox",value:function(e){var t=this;if(e||this.activeSectionBox){this.stopSectionBoxAnim(),this.animStartBox=this.activeSectionBox?et(this.activeSectionBox):et(this.getModelBox()),this.animEndBox=et(e||this.getModelBox()),this.sectionBox=e;var i=new THREE.Box3;i.transform=new THREE.Matrix4,this.sectionBoxAnim=Xe.fadeValue(0,1,.5,(function(e){e=Xe.smootherStep(e),function(e,t,i,n){n.min.lerpVectors(e.min,t.min,i),n.max.lerpVectors(e.max,t.max,i),$e(e.transform,t.transform,i,n.transform)}(t.animStartBox,t.animEndBox,e,i),t.applySectionBox(i)}),(function(){t.applySectionBox(t.sectionBox),t.sectionBoxAnim=null}))}}},{key:"enableClustering",value:function(e){this._clusteringEnabled!==e&&(this._clusteringEnabled=e,this.updateClusteredBookmarks([]))}},{key:"setClusteringThreshold",value:function(e){this._clusteringThreshold!==e&&(this._clusteringThreshold=e,this.hcluster.setThreshold(e),this.updateClusteredBookmarks([]))}},{key:"isAllDone",value:function(){var e=this.sectionBoxAnim&&this.sectionBoxAnim.isRunning,t=this.bookmarks.some((function(e){return e.marker&&e.marker.visiblityChangePending}));return!e&&!this.isFrustumFading&&!t}},{key:"waitForAllDone",value:function(){var e=this;return this.onTimer(),this.isAllDone()?Promise.resolve():new Promise((function(t){e.waitingCallbacks.push(t)}))}},{key:"_filterOutInvisibleBookmark",value:function(e){var t=this.viewer.navigation.getScreenViewport();if(e.currentPosProjected.x<0||e.currentPosProjected.x>t.width)return!1;if(e.currentPosProjected.y<0||e.currentPosProjected.y>t.height)return!1;var i=this.camera.target.clone().sub(this.camera.position),n=e.pos.clone().sub(this.camera.position);return i.dot(n)>0}},{key:"onLevelChanged",value:function(){this.updateBookmarkPositions()}},{key:"onExtensionLoaded",value:function(e){e.extensionId===Ke&&this.updateBookmarkPositions()}},{key:"configureSettings",value:function(){if(this.viewer.getSettingsPanel){var e=this.viewer.getSettingsPanel(!0);if(e.is3dMode){var t=Ze.Extensions.ViewerSettingTab.Navigation;e.addLabel(t,"Location Icons"),e&&!e.showLocationIconsChkBoxId&&(e.showLocationIconsChkBoxId=e.addCheckbox(t,"Show location icons","Toggles availability of the location icons when looking at the project model",!0,this.onVisibilityChangedCB,"canvasBookmarks"))}}}},{key:"_getFloorSelector",value:function(){var e=this.viewer.getExtension(Ke);return e&&e.floorSelector}}])&&Be(i.prototype,n),o&&Be(i,o),t}(Ze.Extension);function nt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Je.CanvasBookmarkExtension=it,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.CanvasBookmarkExtension",it);var ot=Autodesk.Viewing.GlobalManagerMixin,rt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.parent=t,this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.dropdownWrapper=null,this.parentContainer=t.mapWidgetHeader,this.onClickOptionHandler=this.onClickOption.bind(this),this.createWrapper(50);var i=this.getFloorDataFromLevelExtension();this.createDropdown(i),0===i.length&&this.dropdownWrapper.classList.add("hidden"),this.onLevelChanged=this.onLevelChanged.bind(this),this.viewer.addEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.onLevelChanged);var n=this.viewer.getExtension("Autodesk.AEC.LevelsExtension");n&&n.floorSelector&&n.floorSelector.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.onLevelChanged)}var t,i,n;return t=e,(i=[{key:"createWrapper",value:function(e){var t=this.getDocument().createElement("div");t.classList.add("minimap-dropdown-wrapper"),t.id="minimap-dropdown-wrapper",t.style.height=e,this.parentContainer.insertBefore(t,this.parentContainer.firstChild),this.dropdownWrapper=t}},{key:"createDropdown",value:function(e){var t=this,i=this.getDocument();this.titleElement=i.createElement("div"),this.titleElement.classList.add("minimap-title"),this.dropdownWrapper.appendChild(this.titleElement),this.createDropdownOptions(e),this.dropdownWrapper.addEventListener("click",(function(e){t.dropdownElement.classList.toggle("active"),e.stopPropagation()}))}},{key:"onClickOption",value:function(e){var t=this.getDocument();this.titleElement.id=e.target.id,this.viewer.getExtension("Autodesk.BimWalk").jumpToFloor(e.target.id);var i=t.createEvent("Event");i.initEvent("change",!0,!0),this.titleElement.dispatchEvent(i),Array.from(this.dropdownElement.children).forEach((function(e){return e.classList.remove("active")})),this.dropdownWrapper.classList.toggle("active"),e.target.classList.toggle("active")}},{key:"createDropdownOptions",value:function(e){var t=this.getDocument();this.dropdownElement&&this.dropdownWrapper.removeChild(this.dropdownElement),this.dropdownElement=t.createElement("ul"),this.dropdownElement.classList.add("minimap-dropdown"),this.dropdownElement.id="minimap-dropdown",this.dropdownWrapper.appendChild(this.dropdownElement);for(var i=e.length-1;i>=0;i--)this.createNewOption(e[i].name,i)}},{key:"createNewOption",value:function(e,t){var i=this.getDocument(),n=i.createElement("li");n.appendChild(i.createTextNode(e)),n.setAttribute("id",t),n.onclick=this.onClickOptionHandler,this.dropdownElement.appendChild(n)}},{key:"onLevelChanged",value:function(){var e=this.viewer.getExtension("Autodesk.AEC.LevelsExtension").getCurrentLevel(),t=this.getFloorDataFromLevelExtension();this.update(e.index,t)}},{key:"getFloorDataFromLevelExtension",value:function(){var e=this.viewer.getExtension("Autodesk.AEC.LevelsExtension");return e&&e.floorSelector&&e.floorSelector.floorData?e.floorSelector.floorData:[]}},{key:"update",value:function(e,t){if(0===t.length?this.dropdownWrapper.classList.add("hidden"):this.dropdownWrapper.classList.remove("hidden"),this.createDropdownOptions(t),e>=0&&t[e]){var i=t[e];this.dropdownWrapper.style.display="flex",this.setSelectedValue(i.name),Array.from(this.dropdownElement.children).forEach((function(e){e.classList.remove("active"),e.textContent===i.name&&e.classList.add("active")}))}}},{key:"setSelectedValue",value:function(e){this.titleElement.textContent=e}},{key:"terminate",value:function(){this.viewer.removeEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.onLevelChanged);var e=this.viewer.getExtension("Autodesk.AEC.LevelsExtension");e&&e.floorSelector&&e.floorSelector.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.onLevelChanged),this.dropdownWrapper.parentNode.removeChild(this.dropdownWrapper),this.dropdownWrapper=null}}])&&nt(t.prototype,i),n&&nt(t,n),e}();ot.call(rt.prototype);var at=function(e){e.container.style.width="20px",e.container.style.height="20px",e.container.style.padding="3px",e.icon.classList.remove("adsk-button-icon"),e.setToolTip("");var t=e._toolTipElement.style;t.bottom="7px",t.top="auto",t.left="auto",t.right="130%",t.zIndex=3};function st(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var lt=Autodesk.Viewing,ut=lt.UI,ht=lt.GlobalManagerMixin,ct=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=t,this.parentElement=t.mapWidgetHeader,this.setGlobalManager(t.viewer.globalManager),this.sideBySideButton=new ut.Button("Minimap_SideBySide"),this.sideBySideButton.setGlobalManager(this.globalManager),this.sideBySideButton.onClick=function(){return t.setSideBySideEnabled(!t.sideBySideEnabled)},this.sideBySideButton.icon.innerHTML=dt(),this.parentElement.appendChild(this.sideBySideButton.container);var i=this.getDocument();this.shrinkIcon=i.createElement("div"),this.shrinkIcon.innerHTML=pt(),this.sideBySideButton.container.appendChild(this.shrinkIcon),at(this.sideBySideButton),this.parent.options.enableSheetMapAndSideBySide||(this.parentElement.style.display="none"),this.update()}var t,i,n;return t=e,(i=[{key:"setSideBySideButtonDisabled",value:function(e){this.parent.options.sideBySideButtonDisabled=e}},{key:"update",value:function(){var e=this.parent.sideBySideEnabled;this.shrinkIcon.style.display=e?"block":"none",this.sideBySideButton.icon.style.width="20px",this.sideBySideButton.icon.style.height="20px",this.sideBySideButton.icon.style.display=e?"none":"block",this.sideBySideButton.setState(this.parent.options.sideBySideButtonDisabled?ut.Button.State.DISABLED:ut.Button.State.INACTIVE);var t=Autodesk.Viewing.i18n.translate("Show large map"),i=Autodesk.Viewing.i18n.translate("Show small map");this.sideBySideButton.setToolTip(e?i:t)}}])&&st(t.prototype,i),n&&st(t,n),e}();ht.call(ct.prototype);var dt=function(){return['<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">','<path d="M18.5 6C18.5 5.72386 18.2761 5.5 18 5.5L13.5 5.5C13.2239 5.5 13 5.72386 13 6C13 6.27614 13.2239 6.5 13.5 6.5L17.5 6.5L17.5 10.5C17.5 10.7761 17.7239 11 18 11C18.2761 11 18.5 10.7761 18.5 10.5L18.5 6ZM5.5 18C5.5 18.2761 5.72386 18.5 6 18.5L10.5 18.5C10.7761 18.5 11 18.2761 11 18C11 17.7239 10.7761 17.5 10.5 17.5L6.5 17.5L6.5 13.5C6.5 13.2239 6.27614 13 6 13C5.72386 13 5.5 13.2239 5.5 13.5L5.5 18ZM17.6464 5.64645L5.64645 17.6464L6.35355 18.3536L18.3536 6.35355L17.6464 5.64645Z" fill="currentColor"/>',"</svg>"].join("")},pt=function(){return['<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">','<path d="M18 6L13 11M13 11L13 6.83333M13 11L17.1667 11" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>','<path d="M6 18L11 13M11 13L11 17.1667M11 13L6.83333 13" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>',"</svg>"].join("")};function vt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ft=Autodesk.Viewing,mt=ft.UI,gt=ft.GlobalManagerMixin,yt=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.minimap3DExtension=t.minimap3DExtension,this.parentElement=t.mapWidgetHeader,this.setGlobalManager(t.globalManager),this.sheetModeButton=new mt.Button("Minimap_SheetMode"),this.sheetModeButton.setGlobalManager(this.globalManager),this.sheetModeButton.onClick=function(){return i.minimap3DExtension.setSheetMapEnabled(!i.minimap3DExtension.getSheetMapEnabled())},this.sheetModeButton.icon.innerHTML=Et(),this.parentElement.appendChild(this.sheetModeButton.container),at(this.sheetModeButton),this.sheetModeButton.icon.style.display="block",this.sheetModeButton.icon.style.width="20px",this.sheetModeButton.icon.style.height="20px",this.sheetModeButton.icon.style.verticalAlign="middle",this.update()}var t,i,n;return t=e,(i=[{key:"update",value:function(){var e=this.minimap3DExtension.getSheetMapEnabled()?mt.Button.State.ACTIVE:mt.Button.State.INACTIVE;this.sheetModeButton.setState(e);var t=Autodesk.Viewing.i18n.translate("Show sheet"),i=Autodesk.Viewing.i18n.translate("Hide sheet");this.sheetModeButton.setToolTip(e===mt.Button.State.INACTIVE?t:i)}}])&&vt(t.prototype,i),n&&vt(t,n),e}();gt.call(yt.prototype);var Et=function(){return['<svg viewBox="2 2 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">','<path d="M20 10V17C20 17.5523 19.5523 18 19 18H5C4.44772 18 4 17.5523 4 17V7C4 6.44772 4.44772 6 5 6H16M20 10L16 6M20 10H17C16.4477 10 16 9.55228 16 9V6" stroke="currentColor"/>','<path d="M13 9H7V15.5H12V13" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>','<path d="M11.5 15.5H16V12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>','<path d="M10 9V11.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>',"</svg>"].join("")},wt={en:n(154),cs:n(155),de:n(156),es:n(157),fr:n(158),"fr-CA":n(159),it:n(160),ja:n(161),ko:n(162),pl:n(163),"pt-BR":n(164),ru:n(165),tr:n(166),"zh-HANS":n(167),"zh-HANT":n(168),nl:n(169),sv:n(170),da:n(171)};n(319);function xt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var bt=Autodesk.Viewing,kt=bt.GlobalManagerMixin,St=function(e){return e.toString()+"px"},Mt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.minimap3DExtension=t,this.viewer=this.minimap3DExtension.viewer,this.options=t.options,this.setGlobalManager(this.viewer.globalManager),t.extendLocalization(wt),this.sideBySideOptions=this.options.sideBySideOptions||{},this.update=this.update.bind(this),this.onResize=this.onResize.bind(this),this.mapWidgetWidth=300,this.mapWidgetHeight=300,this.relMapWidgetSizeLongEdge=.25,this.relMapWidgetSizeShortEdge=.37,this.dropdown=null,this.sideBySideEnabled=this.sideBySideOptions.sideBySideDefault||!1,this.sideBySide=!1,this.sideBySideSplit=this.sideBySideOptions.sideBySideSplit||40,this.init()}var t,i,n;return t=e,(i=[{key:"setMinimapVisible",value:function(e){var t=this;this.visible=e,this.mapWidget&&(this.getWindow().requestAnimationFrame((function(){t.mapWidgetRoot&&(e?(t.mapWidgetRoot.classList.add("visible"),t.viewer.getExtension("Autodesk.ViewCubeUi",(function(e){e.displayViewCube(!1,!1)}))):t.mapWidgetRoot.classList.remove("visible"))})),this.updateBimWalkInfoButtonPos(),e&&this.updateSideBySide())}},{key:"initWidgets",value:function(){var e=this,t=this.getDocument(),i=this.options.additionalWrapperCss?" "+this.options.additionalWrapperCss:"";this.mapWidgetRoot=t.createElement("div"),this.mapWidgetRoot.style.width=St(this.mapWidgetWidth),this.mapWidgetRoot.style.height=St(this.mapWidgetHeight),this.mapWidgetRoot.className="minimap3D ".concat(i," "),this.mapWidgetRoot.classList.add("adsk-viewing-viewer"),this.mapWidgetRoot.classList.add(this.viewer.theme),this.mapWidgetHeader=t.createElement("div"),this.mapWidgetHeader.className="minimap-header",this.mapWidgetHeader.classList.add("adsk-viewing-viewer"),this.mapWidgetHeader.classList.add("adsk-control-group"),this.mapWidgetHeader.classList.add(this.viewer.theme),this.mapWidgetRoot.appendChild(this.mapWidgetHeader),this.mapWidget=t.createElement("div"),this.mapWidget.className="minimapScrollArea",this.mapWidgetRoot.appendChild(this.mapWidget),this.dropdown=new rt(this),this.sheetModeButton=new yt(this),this.sideBySideButton=new ct(this),this.setMinimapVisible(!1),this.mapWidgetRoot.addEventListener("transitionend",(function(){e.updateBimWalkInfoButtonPos(),e.updateSideBySide(),e.minimap3DExtension.mapViewer&&e.minimap3DExtension.mapViewer.resize()}))}},{key:"destroyWidgets",value:function(){this.mapWidgetRoot.parentElement&&this.mapWidgetRoot.parentElement.removeChild(this.mapWidgetRoot),this.mapWidgetRoot=null,this.mapWidget=null,this.mapWidgetHeader=null,this.dropdown=null,this.sheetModeButton=null,this.sideBySideButton=null}},{key:"init",value:function(){this.initWidgets(),this.updateMapSize(),this.viewer.container.appendChild(this.mapWidgetRoot),this.viewer.addEventListener(bt.VIEWER_RESIZE_EVENT,this.onResize)}},{key:"destroy",value:function(){this.destroyWidgets(),this.restoreViewerContainerStyle(),this.viewer.resize(),this.viewer.removeEventListener(bt.VIEWER_RESIZE_EVENT,this.onResize),this.updateSettingsPanel&&(this.viewer.removeEventListener(bt.TOOLBAR_CREATED_EVENT,this.updateSettingsPanel),this.updateSettingsPanel=null)}},{key:"updateToolbar",value:function(){this.sideBySideButton&&this.sideBySideButton.update(),this.sheetModeButton&&this.sheetModeButton.update()}},{key:"update",value:function(){this.minimap3DExtension.isEnabled()?this.setMinimapVisible(!0):this.setMinimapVisible(!1),this.updateToolbar(),this.updateSideBySide(),this.minimap3DExtension.mapViewer&&this.minimap3DExtension.mapViewer.resize()}},{key:"setWidgetSize",value:function(e,t){this.mapWidgetWidth=e,this.mapWidgetHeight=t;var i=St(e),n=St(t);this.mapWidgetRoot.style.width=i,this.mapWidgetRoot.style.height=n,this.update()}},{key:"updateMapSize",value:function(){var e,t,i=this.viewer.container.clientWidth,n=this.viewer.container.clientHeight;if(this.sideBySide)this.verticalSideBySide?(e=i,t=n*(this.sideBySideSplit/(100-this.sideBySideSplit))):(e=i*(this.sideBySideSplit/(100-this.sideBySideSplit)),t=n);else{var o=Math.max(i,n),r=Math.min(i,n);t=.66*(e=Math.min(this.relMapWidgetSizeLongEdge*o,this.relMapWidgetSizeShortEdge*r))+this.mapWidgetHeader.clientHeight}this.setWidgetSize(e,t)}},{key:"onResize",value:function(){if(this.sideBySide){var e=this.viewer.clientContainer.getBoundingClientRect();if(!this.lastContainerBounds||this.lastContainerBounds.width!==e.width||this.lastContainerBounds.height!==e.height)return this.lastContainerBounds=e,void this.updateSideBySide(!0)}this.updateMapSize()}},{key:"updateBimWalkInfoButtonPos",value:function(){var e=this.viewer.getExtension("Autodesk.BimWalk"),t=e&&e.getInfoButton();if(t&&!e.options.disableBimWalkInfoIcon){var i=this.getWindow().getComputedStyle(this.mapWidgetRoot),n=this.visible||i.opacity>0?this.mapWidgetWidth:0;this.sideBySide&&(n=0);var o=n+20;t.style.right=St(o)}}},{key:"setSideBySideEnabled",value:function(e){this.sideBySideEnabled=e,this.updateSideBySide()}},{key:"setSideBySideSplit",value:function(e){this.sideBySideSplit=e,this.updateSideBySide(!0),this.updateBimWalkInfoButtonPos()}},{key:"updateSideBySide",value:function(e){var t=this.sideBySide;if(this.sideBySide=this.visible&&this.sideBySideEnabled,e||t!==this.sideBySide){if(this.sideBySide){var i=this.viewer.clientContainer.getBoundingClientRect();this.viewer.clientContainer.appendChild(this.mapWidgetRoot),this.mapWidgetRoot.classList.add("side-by-side"),i.width>=i.height?(this.viewer.container.style.width=(100-this.sideBySideSplit).toString()+"%",this.viewer.container.style.height="100%",this.sideBySideOptions.left2DView?this.viewer.container.style.left=this.sideBySideSplit.toString()+"%":this.viewer.container.style.right=this.sideBySideSplit.toString()+"%",this.viewer.container.style.top="0px",this.sideBySideOptions.left2DView&&this.mapWidgetRoot.classList.add("left-2d-view"),this.verticalSideBySide=!1):(this.viewer.container.style.width="100%",this.viewer.container.style.height=(100-this.sideBySideSplit).toString()+"%",this.viewer.container.style.top=this.sideBySideSplit.toString()+"%",this.viewer.container.style.left="0px",this.viewer.container.style.right="initial",this.verticalSideBySide=!0),this.sideBySideOptions.onSideBySideUpdated&&this.sideBySideOptions.onSideBySideUpdated(this.sideBySideSplit)}else this.viewer.container.appendChild(this.mapWidgetRoot),this.restoreViewerContainerStyle(),this.mapWidgetRoot.classList.remove("side-by-side"),this.mapWidgetRoot.classList.remove("left-2d-view");this.viewer.resize(),this.updateMapSize()}}},{key:"restoreViewerContainerStyle",value:function(){this.viewer.container.style.width="100%",this.viewer.container.style.height="100%",this.viewer.container.style.left="",this.viewer.container.style.right="",this.viewer.container.style.top=""}},{key:"getMapViewerContainer",value:function(){return this.mapWidget}}])&&xt(t.prototype,i),n&&xt(t,n),e}();function _t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}kt.call(Mt.prototype);var Tt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer3DImpl=t}var t,i,n;return t=e,(i=[{key:"loadFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=t.width||100,r=t.height||100;n&&n(),this.svf={is2d:!0,viewports:[],layersMap:{0:0},layerCount:1,bbox:new THREE.Box3(new THREE.Vector3(0,0,0),new THREE.Vector3(o,r,0)),fragments:{length:1,fragId2dbId:[0],transforms:new Float32Array(12),boxes:[0,0,0,o,r,0]},loadOptions:{bubbleNode:new Autodesk.Viewing.BubbleNode({urn:"Dummy_urn",guid:"Dummy_guid"})},metadata:{page_dimensions:{page_width:o,page_height:r,logical_width:o,logical_height:r,logical_offset_x:0,logical_offset_y:0,page_units:"inch"}},strings:[],stringDbIds:[],loadDone:!0};var a=new Autodesk.Viewing.Model(this.svf);a.initialize(),a.loader=this,this.model=a,i(null,a),this.viewer3DImpl.api.dispatchEvent({type:Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,svf:this.svf,model:a}),this.viewer3DImpl.onLoadComplete(a)}},{key:"dtor",value:function(){}},{key:"is2d",value:function(){return!0}},{key:"is3d",value:function(){return!1}}])&&_t(t.prototype,i),n&&_t(t,n),e}();function At(e){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Lt(e,t){return!t||"object"!==At(t)&&"function"!=typeof t?Ot(e):t}function Dt(e){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e,t){return(Bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pt=Autodesk.Viewing,Rt=AutodeskNamespace("Autodesk.AEC"),It="Autodesk.AEC.TopViewRendererExtension",Nt=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ct(this,t),(i=Lt(this,Dt(t).call(this,e,n))).mapViewerHighlightEnabled=n.mapViewerHighlightEnabled||!1,i.mapViewerSelectionEnabled=n.mapViewerSelectionEnabled||!1,i.update=i.update.bind(Ot(i)),i.onVisibilityChanged=i.onVisibilityChanged.bind(Ot(i)),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bt(e,t)}(t,e),i=t,(n=[{key:"load",value:function(){this.loaded=!0;var e=this.options.LayoutClass||Mt;return this.layout=new e(this),this.viewer.prefs.add("miniMap3D",!0),this.viewer.addEventListener(Pt.TOOL_CHANGE_EVENT,this.update),this.configureSettings()||this.updateSettingsPanel||(this.updateSettingsPanel=this.configureSettings.bind(this),this.viewer.addEventListener(Pt.TOOLBAR_CREATED_EVENT,this.updateSettingsPanel)),!0}},{key:"unload",value:function(){return this.loaded=!1,this.mapViewer&&(this.mapViewer.finish(),this.mapViewer=null),this.layout&&(this.layout.destroy&&this.layout.destroy(),this.layout=null),this.viewer.removeEventListener(Pt.TOOL_CHANGE_EVENT,this.update),this.updateSettingsPanel&&(this.viewer.removeEventListener(Pt.TOOLBAR_CREATED_EVENT,this.updateSettingsPanel),this.updateSettingsPanel=null),!0}},{key:"isEnabled",value:function(){var e=this.viewer.prefs&&this.viewer.prefs.get("miniMap3D"),t=this.viewer.getExtension("Autodesk.BimWalk"),i=t&&t.tool&&t.tool.active;return e&&i}},{key:"onVisibilityChanged",value:function(e){this.viewer.prefs&&this.viewer.prefs.set("miniMap3D",e),this.update()}},{key:"initMapViewer",value:function(){var e=this.layout.getMapViewerContainer();if(this.options.getMapViewer)this.mapViewer=this.options.getMapViewer(e);else{var t=Pt.getGlobal(),i=t.NOP_VIEWER,n=this.options.MapViewerClass||Autodesk.Viewing.Viewer3D;this.mapViewer=new n(e,{}),this.mapViewer.start(void 0,void 0,void 0,void 0,{webglInitParams:{alpha:!0}}),t.NOP_VIEWER=i}this.mapViewer.config.extensions=this.mapViewer.config.extensions||[],this.mapViewer.config.sheetSyncOptions={targetViewer:this.viewer,cropToViewport:!0,hideSheetWhenNotFocused:!0,autoSwitchSheet:!0,hidePaper:!0,useCustomModel:this.options.useCustomModel,showSheet:this.options.showSheet,loadDocumentNode:this.options.loadDocumentNode,unloadModel:this.options.unloadModel},this.mapViewer.config.avatarOptions={trackUsage:this.options.trackUsage,autoFocus:this.options.autoFocus},-1===this.mapViewer.config.extensions.indexOf("Autodesk.AEC.AvatarExtension")&&this.mapViewer.config.extensions.push("Autodesk.AEC.AvatarExtension"),-1===this.mapViewer.config.extensions.indexOf(It)&&this.mapViewer.config.extensions.push(It),this.mapViewer.disableHighlight(!this.mapViewerHighlightEnabled),this.mapViewer.disableSelection(!this.mapViewerSelectionEnabled),this.mapViewer.loadModel("Dummy",{fileLoader:Tt,headlessViewer:!0})}},{key:"update",value:function(){this.isEnabled()&&!this.mapViewer&&this.initMapViewer(),this.layout&&this.layout.update&&this.layout.update()}},{key:"configureSettings",value:function(){if(!this.viewer.getSettingsPanel)return!1;var e=this.viewer.getSettingsPanel();if(!e||!e.is3dMode)return!1;var t=Pt.Extensions.ViewerSettingTab.Navigation;return e.addLabel(t,"3D Mini-map"),e.showMinimapChkBoxId||(e.showMinimapChkBoxId=e.addCheckbox(t,"Show 3D mini-map","Toggles availability of the 3D mini-map when using first person mode",!0,this.onVisibilityChanged,"miniMap3D")),!0}},{key:"setSheetMapEnabled",value:function(e){var t=this.mapViewer&&this.mapViewer.getExtension("Autodesk.AEC.SheetSyncExtension");t&&(t.setShowSheet(e),this.update())}},{key:"getSheetMapEnabled",value:function(){var e=this.mapViewer&&this.mapViewer.getExtension("Autodesk.AEC.SheetSyncExtension");return e&&e.getShowSheet()}},{key:"setSideBySideEnabled",value:function(e){this.layout&&this.layout.setSideBySideEnabled&&this.layout.setSideBySideEnabled(e)}},{key:"setSideBySideSplit",value:function(e){this.layout&&this.layout.setSideBySideSplit&&this.layout.setSideBySideSplit(e)}}])&&Vt(i.prototype,n),o&&Vt(i,o),t}(Pt.Extension);Rt.Minimap3DExtension=Nt,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.Minimap3DExtension",Nt);var Ft=n(172),Ht=n.n(Ft),zt=n(173),jt=n.n(zt),Gt=n(0),Wt=[new Gt.Vector3(1,0,0),new Gt.Vector3(0,1,0),new Gt.Vector3(0,0,1),new Gt.Vector3(-1,0,0),new Gt.Vector3(0,-1,0),new Gt.Vector3(0,0,-1)],Ut=new Gt.Plane;function Yt(e,t,i,n){var o=e;o.z=-1;var r=new Gt.Vector3(o.x,o.y,1);o=o.unproject(t),(r=r.unproject(t)).sub(o).normalize();var a,s=r;if(Math.abs(s[i])<1e-6)return null;a=t.isPerspective?t.position:o;var l=((n?n.min[i]:0)-a[i])/s[i];return s.multiplyScalar(l),s.add(a),s}var Zt={box2CutPlanes:function(e,t){for(var i=[],n=0;n<Wt.length;n++){Ut.normal.copy(Wt[n]);var o=n<3?e.max:e.min;Ut.constant=-Ut.normal.dot(o),t&&Ut.applyMatrix4(t),i.push(new Gt.Vector4(Ut.normal.x,Ut.normal.y,Ut.normal.z,Ut.constant))}return i},getPixelsPerUnit:function(e,t,i,n,o,r){var a;if(t){var s=Yt(new Gt.Vector3(0,0,1),e,"z",r);a=n/(2*(s?e.position.distanceTo(s):e.position.distanceTo(i.center()))*Math.tan(Gt.Math.degToRad(.5*e.fov)))}else{var l;if(o){var u=o,h=e.target.clone().sub(e.position).normalize(),c=h.dot(u);if(0===c)l=i.center();else{var d=-(e.position.clone().dot(u)+u.w)/c;l=i.clampPoint(h.multiplyScalar(d).add(e.position))}}else l=i.center();a=n/(2*e.position.distanceTo(l)*Math.tan(Gt.Math.degToRad(.5*e.fov)))}return a},intersectGroundViewport:Yt,getNormalizingMatrix:function(e,t){t=t||e.getData().bbox;var i=new Gt.Matrix4;i.makeTranslation(-t.min.x,-t.min.y,-t.min.z);var n=new Gt.Vector3(0,0,0).subVectors(t.max,t.min),o=new Gt.Matrix4;o.makeScale(1/n.x,1/n.y,1);var r=new Gt.Matrix4;return r.multiplyMatrices(o,i),r}};function Xt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var qt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.renderContext=this.viewer.impl.renderer(),this.glRenderer=this.viewer.impl.glrenderer(),this.materialName="__material_2Don3D__",this.renderScene=this.renderScene.bind(this),this.onResize=this.onResize.bind(this),this.addListeners()}var t,i,n;return t=e,(i=[{key:"createContext",value:function(){this.sheetContext=new Autodesk.Viewing.Private.RenderContext,this.sheetContext.init(this.glRenderer,this.viewer.canvas.clientWidth,this.viewer.canvas.clientHeight,{offscreen:!0});var e=this.renderContext.getConfig();e.antialias=!1,e.aoEnabled=!1,e.renderEdges=!1,e.clearAlpha=0,e.clearColorBottom.set(0,0,0),e.clearColorTop.set(0,0,0),this.sheetContext.applyConfig(e)}},{key:"createTarget",value:function(e,t){this.target=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,depthBuffer:!1}),this.sheetContext.setOffscreenTarget(this.target)}},{key:"onResize",value:function(e){this.setSize(e.width,e.height)}},{key:"setSize",value:function(e,t){this.sheetContext&&(this.cleanup(),this.createTarget(e,t),this.sheetContext.setSize(e,t),this.width=this.sheetContext.settings.deviceWidth,this.height=this.sheetContext.settings.deviceHeight,this.updateMaterial())}},{key:"createScene",value:function(){this.sheetContext||this.createContext(),this.setSize(this.viewer.canvas.clientWidth,this.viewer.canvas.clientHeight),this.scene=new THREE.Scene,this.planeGeometry=new THREE.PlaneBufferGeometry(1,1),this.material=new THREE.ShaderMaterial({uniforms:{sheetMap:{type:"t",value:this.target},resolution:{type:"v2",value:new THREE.Vector2}},vertexShader:Ht.a,fragmentShader:jt.a,side:THREE.DoubleSide,transparent:!0}),this.updateMaterial(),this.viewer.impl.getMaterials().addMaterialNonHDR(this.materialName,this.material),this.mesh=new THREE.Mesh(this.planeGeometry,this.material),this.scene.add(this.mesh)}},{key:"updateMaterial",value:function(){this.material&&(this.material.uniforms.sheetMap.value=this.target,this.material.uniforms.resolution.value.set(1/(this.width||1),1/(this.height||1)))}},{key:"renderScene",value:function(e){var t=e.scene,i=e.want_colorTarget,n=e.want_saoTarget,o=e.want_idTarget,r=e.context;if(t.frags&&t.frags.is2d){if(this.scene||this.createScene(),(r=r||this.viewer.impl.renderer())!==this.renderContext){this.renderContext=r;var a=r.settings;a.deviceWidth===this.width&&a.deviceHeight===this.height||this.setSize(a.logicalWidth,a.logicalHeight)}this.glRenderer.pushViewport();var s=this.viewer.impl.camera,l=this.viewer.impl.modelQueue().findModel(t.frags.modelId),u=l.getVisibleBounds(),h=this.viewer.impl.getMaterials().getModelMaterials(l),c=l.getBoundingBox(),d=Zt.getPixelsPerUnit(s,!1,u,this.height,null,c);Object.keys(h.mats).forEach((function(e){var t=h.mats[e];t.uniforms.aaRange.value=.5/(d*t.modelScale),t.uniforms.pixelsPerUnit.value=d*t.modelScale})),this.sheetContext.beginScene(this.viewer.impl.scene,s,this.viewer.impl.noLights,!0),this.sheetContext.renderScenePart(t,!0,!1,!1,!1),this.sheetContext.presentBuffer(),this.glRenderer.popViewport(),this.mesh.scale.x=u.size().x,this.mesh.scale.y=u.size().y,u.center(this.mesh.position),this.scene.modelId=t.modelId,this.renderContext.renderScenePart(this.scene,i,n,o),e.preventDefault=!0}}},{key:"cleanup",value:function(){this.target&&(this.target.dispose(),this.target=null)}},{key:"addListeners",value:function(){this.viewer.addEventListener(Autodesk.Viewing.RENDER_SCENE_PART,this.renderScene),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize)}},{key:"removeListeners",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.RENDER_SCENE_PART,this.renderScene),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize)}},{key:"destroy",value:function(){this.cleanup(),this.removeListeners(),this.sheetContext&&(this.sheetContext.cleanup(),this.context=null),this.viewer=null,this.renderContext=null,this.glRenderer=null}}])&&Xt(t.prototype,i),n&&Xt(t,n),e}();function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kt(e,t,i,n,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void i(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Qt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ei(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?ii(e):t}function ti(e){return(ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ii(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ni(e,t){return(ni=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oi=AutodeskNamespace("Autodesk.AEC"),ri=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Qt(this,t),(i=ei(this,ti(t).call(this,e,n))).loadedSheets={},i.sheetsPerLevelCache={},i.zPositionPerLevel={},i.onModelRootLoaded=i.onModelRootLoaded.bind(ii(i)),i.onModelChanged=i.onModelChanged.bind(ii(i)),i}var i,n,o,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ni(e,t)}(t,Autodesk.Viewing.Extension),i=t,(n=[{key:"load",value:(r=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.LevelsExtension");case 2:return this.levelExtension=e.sent,this.addListeners(),t=y(this.viewer),this.init(t),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(i,n){var o=r.apply(e,t);function a(e){Kt(o,i,n,a,s,"next",e)}function s(e){Kt(o,i,n,a,s,"throw",e)}a(void 0)}))},function(){return a.apply(this,arguments)})},{key:"onModelChanged",value:function(e){if(!e.model.is2d()){var t=y(this.viewer);t!==this.model3D&&(this.unloadAll(),this.init(t))}}},{key:"init",value:function(e){this.loadedSheets={},this.sheetsPerLevelCache={},this.zPositionPerLevel={},this.floorSelector=this.levelExtension.floorSelector,this.model3D=e,e&&(this.rootNode=this.model3D.getDocumentNode().getRootNode(),this.document=this.rootNode.getDocument(),this.aec=this.rootNode.getAecModelData(),this.sheetRendererContext||(this.sheetRendererContext=new qt(this.viewer)))}},{key:"unload",value:function(){return this.removeListeners(),this.sheetRendererContext&&(this.sheetRendererContext.destroy(),this.sheetRendererContext=null),this.unloadAll(),this.floorSelector=null,this.model3D=null,this.rootNode=null,this.document=null,this.aec=null,!0}},{key:"addListeners",value:function(){this.viewer.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelRootLoaded),this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.onModelChanged),this.viewer.addEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.onModelChanged)}},{key:"removeListeners",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelRootLoaded),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.onModelChanged),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.onModelChanged)}},{key:"getHashNameForViewportAndLevel",value:function(e,t){return e.viewportGuid+"."+t}},{key:"onModelRootLoaded",value:function(e){var t=e.model;if(!t.is3d()){var i=t.loader.options.hyperModelingHashName,n=this.loadedSheets[i];if(n&&n.loading){var o=t.getUnitScale(),r=ie.get2DTo3DMatrix(n.viewport,o),a=this.floorSelector.floorData[n.levelIndex];this.zPositionPerLevel.hasOwnProperty(n.levelIndex)?this.zPositionPerLevel[n.levelIndex]+=.001:this.zPositionPerLevel[n.levelIndex]=0;var s=1/12+1/120+this.zPositionPerLevel[n.levelIndex],l=new THREE.Vector3;l.setFromMatrixPosition(r);var u=this.model3D.getData().placementWithOffset;l.applyMatrix4(u),l.z=a.zMin+s,r.setPosition(l),t.loader.options.placementTransform=r,t.loader.modelScale=r.getMaxScaleOnAxis()}else Autodesk.Viewing.Private.logger.warn("Model root loaded called for sheet not being loaded")}}},{key:"getAvailableSheetsForLevel",value:function(e){var t=this;if(this.sheetsPerLevelCache[e])return this.sheetsPerLevelCache[e];var i=this.floorSelector.floorData[e],n=ie.findViewportsForLevel(this.aec,i.guid);if(0===(n=n.filter(ie.supports2DTo3DTransform)).length)return Autodesk.Viewing.Private.logger.warn("No supported viewports for current level"),[];var o=[],r=new THREE.Box3;return n.forEach((function(e){var i=t.rootNode.search({type:"geometry",role:"2d",guid:e.sheetGuid});if(i.length){r.set(e.sectionBox.min,e.sectionBox.max);var n=Autodesk.Viewing.BubbleNode.readMatrixFromArray12(e.sectionBox.transform);r.applyMatrix4(n);var a=r.size();o.push({viewport:e,node:i[0],boxSize:a.x*a.y})}})),o.sort((function(e,t){return t.boxSize-e.boxSize})),this.sheetsPerLevelCache[e]=o,o}},{key:"loadSheetFromLevel",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=this.getAvailableSheetsForLevel(e);if(o.length){var r=o[i],a=this.getHashNameForViewportAndLevel(r.viewport,e),s=r.node;if(this.loadedSheets[a]){var l=this.loadedSheets[a];return l.loading||this.viewer.showModel(l.model),void(n&&n({hash:a,model:l.model}))}var u={isAEC:!0,useConsolidation:!1,preserveView:!0,keepCurrentModels:!0,disable3DModelLayers:!0,disablePrecomputedNodeBoxes:!0,noShadow:!0,doNotCut:!0,hyperModelingHashName:a};this.options.hidePaper&&(u.modelSpace=!0,u.bgColor=0),this.loadedSheets[a]={node:s,levelIndex:e,sheetIndex:i,viewport:r.viewport,loading:!0},this.viewer.loadDocumentNode(this.document,s,u).then((function(e){t.loadedSheets[a]?(t.loadedSheets[a].loading=!1,t.loadedSheets[a].model=e,e.invalidateBBoxes(),n&&n({hash:a,model:e})):n&&n({})}))}}},{key:"findLoadedSheetsFromLevelIndex",value:function(e){var t=[];for(var i in this.loadedSheets)this.loadedSheets[i].levelIndex===e&&t.push(i);return t}},{key:"findLoadedSheetFromLevelAndSheetIndex",value:function(e,t){for(var i in this.loadedSheets)if(this.loadedSheets[i].levelIndex===e&&this.loadedSheets[i].sheetIndex===t)return i}},{key:"unloadSheet",value:function(e){var t=this.loadedSheets[e];t&&(this.viewer.unloadDocumentNode(t.node),delete this.loadedSheets[e])}},{key:"hideModel",value:function(e){var t=this.loadedSheets[e];t&&(t.model?this.viewer.hideModel(t.model):t.loading&&this.unloadSheet(e))}},{key:"hideSheetFromLevel",value:function(e,t){var i=this.findLoadedSheetFromLevelAndSheetIndex(e,t);i&&this.hideModel(i)}},{key:"hideAllSheetsFromLevel",value:function(e){var t=this;this.findLoadedSheetsFromLevelIndex(e).forEach((function(e){t.hideModel(e)}))}},{key:"unloadSheetsFromLevel",value:function(e){var t=this;this.findLoadedSheetsFromLevelIndex(e).forEach((function(e){t.unloadSheet(e)}))}},{key:"unloadAll",value:function(){for(var e in this.loadedSheets)this.viewer.unloadDocumentNode(this.loadedSheets[e].node);this.loadedSheets={}}}])&&$t(i.prototype,n),o&&$t(i,o),t}();oi.HypermodelingExtension=ri,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.Hypermodeling",ri);var ai=n(98),si=n.n(ai),li=null,ui=function(e,t){var i=(li=li||new THREE.Vector3).copy(e).applyProjection(t);return Math.abs(i.x)<1&&Math.abs(i.y)<1},hi=function(e,t,i,n,o){var r=THREE.Box3.prototype.center.call(t);e.position.copy(r),e.position.z=n,e.target.copy(e.position),e.target.z-=o,e.isPerspective=!1,e.up.set(0,1,0),e.worldup.set(0,1,0),e.near=0,e.far=n-i,e.updateCameraMatrices()},ci=function(e,t,i){var n=Math.cos(i),o=Math.sin(i),r=e.x-t.x,a=e.y-t.y;e.x=r*n-a*o+t.x,e.y=r*o+a*n+t.y},di=function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x-=t.min.x,e.y-=t.min.y,e.x/=i,e.y/=n},pi=function(e,t){var i=t.x-e.x,n=t.y-e.y,o=Math.atan2(n,i);return o+=Math.PI/2};function vi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fi=Autodesk.Viewing.GlobalManagerMixin,mi=new THREE.Vector3(0,0,1),gi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.avatarWidget=t,this.targetViewer=t.targetViewer,this.transforms=t.transforms,this.setGlobalManager(t.globalManager),this.dragDirectionStart=this.dragDirectionStart.bind(this),this.dragDirectionMove=this.dragDirectionMove.bind(this),this.dragDirectionEnd=this.dragDirectionEnd.bind(this),this.dragPositionStart=this.dragPositionStart.bind(this),this.dragPositionMove=this.dragPositionMove.bind(this),this.dragPositionEnd=this.dragPositionEnd.bind(this),this.lastAngle=void 0,this.isDragging=!1,this.isRotating=!1,this.active=!1,this.names=["avatar-tool"]}var t,i,n;return t=e,(i=[{key:"getNames",value:function(){return this.names}},{key:"getName",value:function(){return this.names[0]}},{key:"isActive",value:function(){return this.active}},{key:"activate",value:function(){this.isActive()||(this.active=!0,this.avatarWidget.widgetUI.hitArea.addEventListener("mousedown",this.dragPositionStart),this.avatarWidget.widgetUI.hitArea.addEventListener("touchstart",this.dragPositionStart),this.avatarWidget.widgetUI.addEventListener("mousedown",this.dragDirectionStart),this.avatarWidget.widgetUI.addEventListener("touchstart",this.dragDirectionStart))}},{key:"deactivate",value:function(){this.isActive()&&(this.active=!1,this.avatarWidget.widgetUI.hitArea.removeEventListener("mousedown",this.dragPositionStart),this.avatarWidget.widgetUI.hitArea.removeEventListener("touchstart",this.dragPositionStart),this.avatarWidget.widgetUI.removeEventListener("mousedown",this.dragDirectionStart),this.avatarWidget.widgetUI.removeEventListener("touchstart",this.dragDirectionStart),this.dragPositionEnd(),this.dragDirectionEnd())}},{key:"screenToMap",value:function(e,t){e.type.indexOf("touch")>=0&&(e.clientX=e.touches[0].pageX,e.clientY=e.touches[0].pageY);var i=this.avatarWidget.container.getBoundingClientRect(),n=new THREE.Vector2(e.clientX-i.left,e.clientY-i.top);return this.transforms.widgetToMapPixels(n,t),n}},{key:"dragPositionStart",value:function(e){this.addWindowEventListener("mousemove",this.dragPositionMove),this.addWindowEventListener("mouseup",this.dragPositionEnd),this.addWindowEventListener("touchmove",this.dragPositionMove),this.addWindowEventListener("touchend",this.dragPositionEnd),e.stopPropagation(),e.preventDefault(),this.isDragging=!0,this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.DRAG_START_EVENT})}},{key:"dragPositionMove",value:function(e){var t=this.screenToMap(e,!0),i=t.x,n=t.y,o=this.targetViewer.impl.camera,r=o.position.z,a=o.position.clone(),s=this.transforms.mapPixelsToWorld(i,n,r);o.position.copy(s);var l=o.position.clone().sub(a);o.target.add(l),o.target.z=r,this.targetViewer.impl.invalidate(!0,!0,!0),this.targetViewer.dispatchEvent({type:Autodesk.Viewing.CAMERA_CHANGE_EVENT,camera:o}),e.stopPropagation(),this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.DRAG_MOVE_EVENT,camera:o})}},{key:"dragPositionEnd",value:function(e){this.removeWindowEventListener("mousemove",this.dragPositionMove),this.removeWindowEventListener("mouseup",this.dragPositionEnd),this.removeWindowEventListener("touchmove",this.dragPositionMove),this.removeWindowEventListener("touchend",this.dragPositionEnd),e&&e.stopPropagation(),this.isDragging=!1,this.avatarInteractionTracked||(this.avatarInteractionTracked=!0,this.avatarWidget&&this.avatarWidget.trackUsage&&this.avatarWidget.trackUsage({avatar_interaction_tracked:!0})),this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.DRAG_END_EVENT})}},{key:"getCameraPositionOnMap",value:function(){var e=this.targetViewer.impl.camera.position;return this.transforms.worldToMapPixels(e)}},{key:"dragDirectionStart",value:function(e){var t=this.getCameraPositionOnMap(),i=this.screenToMap(e);this.lastAngle=pi(t,i),this.addWindowEventListener("mousemove",this.dragDirectionMove),this.addWindowEventListener("mouseup",this.dragDirectionEnd),this.addWindowEventListener("touchmove",this.dragDirectionMove),this.addWindowEventListener("touchend",this.dragDirectionEnd),e.stopPropagation(),e.preventDefault(),this.isRotating=!0,this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.ROTATE_START_EVENT,angle:this.lastAngle})}},{key:"dragDirectionMove",value:function(e){var t=this.getCameraPositionOnMap(),i=this.screenToMap(e),n=pi(t,i),o=this.lastAngle-n,r=this.targetViewer.impl.camera,a=r.target.clone().sub(r.position);a.applyAxisAngle(mi,o),a.add(r.position),r.target.copy(a),r.up.applyAxisAngle(mi,o),this.targetViewer.impl.syncCamera(),this.targetViewer.dispatchEvent({type:Autodesk.Viewing.CAMERA_CHANGE_EVENT,camera:r}),this.lastAngle=n,e.stopPropagation(),this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.ROTATE_MOVE_EVENT,angle:this.lastAngle})}},{key:"dragDirectionEnd",value:function(e){this.removeWindowEventListener("mousemove",this.dragDirectionMove),this.removeWindowEventListener("mouseup",this.dragDirectionEnd),this.removeWindowEventListener("touchmove",this.dragDirectionMove),this.removeWindowEventListener("touch",this.dragDirectionEnd),e&&e.stopPropagation(),this.isRotating=!1,this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.ROTATE_END_EVENT,angle:this.lastAngle})}},{key:"convertEventHammerToMouse",value:function(e){e.pointers&&(e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY)}},{key:"getCurrentLevel",value:function(){var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");if(e)return e.getCurrentLevel()}},{key:"handleDoubleClick",value:function(e){var t=this;this.convertEventHammerToMouse(e);var i=this.screenToMap(e),n=i.x,o=i.y,r=this.targetViewer.impl.camera,a=r.getWorldDirection();a.z=Math.max(a.z,0);var s=r.position.z,l=this.getCurrentLevel();if(l){var u=l.zMin+1.8/this.targetViewer.model.getUnitScale();u>=l.zMax&&(u=(l.zMin+l.zMax)/2),isFinite(u)&&(s=u)}var h=this.transforms.mapPixelsToWorld(n,o,s),c=h.clone().add(a),d={position:h,target:c,up:r.up};return this.isDragging=!0,Autodesk.Viewing.Private.flyToView(this.targetViewer,d,.5,(function(){t.isDragging=!1})),e.stopPropagation(),e.preventDefault(),!0}},{key:"handleDoubleTap",value:function(e){return this.handleDoubleClick(e)}}])&&vi(t.prototype,i),n&&vi(t,n),e}();fi.call(gi.prototype);n(323);function yi(e){return(yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ei(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wi(e){return(wi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bi(e,t){return(bi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ki=AutodeskNamespace("Autodesk.AEC"),Si=Autodesk.Viewing.GlobalManagerMixin,Mi=Autodesk.Viewing,_i=function(e){function t(e,i,n,o,r){var a,s,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=this,(a=!(l=wi(t).call(this))||"object"!==yi(l)&&"function"!=typeof l?xi(s):l).container=e,a.targetViewer=i,a.transforms=o,a.trackUsage=r,a.setGlobalManager(n),a.widgetUI=a.createUI(),a.tool=new gi(xi(a)),a.tool.activate(),a}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bi(e,t)}(t,Autodesk.Viewing.EventDispatcher),i=t,(n=[{key:"createUI",value:function(){var e=this.getDocument(),t=e.createElement("div");t.className="avatar-widget",this.container.appendChild(t);var i=e.createElement("div");i.className="avatar-frustum",t.appendChild(i),t.frustumWidget=i,t.anchorX=20,t.anchorY=40;var n=e.createElement("div");n.className="avatar-position-fill",t.appendChild(n),t.posCircle=n;var o=e.createElement("div");return o.className="avatar-position-hitarea",t.posCircle.appendChild(o),t.hitArea=o,Mi.isTouchDevice()&&(o.classList.add("touch"),i.classList.add("touch"),t.posCircle.classList.add("touch"),t.anchorX=40,t.anchorY=80),t}},{key:"destroy",value:function(){this.tool.deactivate(),this.tool=null,this.container.removeChild(this.widgetUI),this.widgetUI=null}},{key:"show",value:function(){this.widgetUI.classList.contains("visible")||this.widgetUI.classList.add("visible")}},{key:"hide",value:function(){this.widgetUI.classList.contains("visible")&&this.widgetUI.classList.remove("visible")}},{key:"update",value:function(){var e=this.targetViewer.impl.camera.position,t=this.transforms.worldToMapPixels(e),i=this.targetViewer.impl.camera.target,n=this.transforms.worldToMapPixels(i),o=pi(t,n),r=this.transforms.getMapRotationAngle();this.widgetUI.frustumWidget.style.transform="rotate(".concat(o+r,"rad)"),this.transforms.mapPixelsToWidget(t),this.widgetUI.style.transform="translate(".concat(t.x-this.widgetUI.anchorX,"px, ").concat(t.y-this.widgetUI.anchorY,"px)")}},{key:"isDragging",value:function(){return this.tool.isDragging}},{key:"isRotating",value:function(){return this.tool.isRotating}}])&&Ei(i.prototype,n),o&&Ei(i,o),t}();function Ti(e,t){var i=e.viewportBounds.size();return function(e,t,i,n){var o=e.clone().applyProjection(t);return new THREE.Vector2((o.x+1)/2*i,(1-o.y)/2*n)}(t,e.mapMatrix,i.x,i.y)}function Ai(e,t,i,n){var o=e.viewportBounds.size();return function(e,t,i,n,o,r){var a=e/o*2-1,s=t/r*2-1,l=new THREE.Vector3(a,-s,0).applyProjection(n);return l.z=i,l}(t,i,n,e.mapMatrixInv,o.x,o.y)}function Ci(e,t){t.y=e.viewportBounds.size().y-t.y;var i=e.viewportBounds.min;t.x+=i.x,t.y+=i.y}function Vi(e,t,i){var n=e.impl.clientToViewport(t,i),o=e.impl.camera.projectionMatrix,r=new THREE.Matrix4;return r.getInverse(o),n.applyMatrix4(r),n.applyMatrix4(e.impl.camera.matrixWorld),n.z=0,n}Si.call(_i.prototype),Object.assign(ki,{AvatarEvents:{DRAG_START_EVENT:"dragStart",DRAG_MOVE_EVENT:"dragMove",DRAG_END_EVENT:"dragEnd",ROTATE_START_EVENT:"rotateStart",ROTATE_MOVE_EVENT:"rotateMove",ROTATE_END_EVENT:"rotateEnd"}});function Li(e,t,i,n){i.copy(Vi(t,i.x,i.y));var o=e.viewportBounds.min;if(i.x-=o.x,i.y-=o.y,i.y=e.viewportBounds.size().y-i.y,n){var r=e.viewportBounds.size();i.x=THREE.Math.clamp(i.x,.001,r.x-.001),i.y=THREE.Math.clamp(i.y,.001,r.y-.001)}}function Di(e){var t=e.navigation.getCameraUpVector();return Math.atan2(t.y,t.x)-.5*Math.PI}var Oi={MAIN_MAP_CHANGED_EVENT:"mapChanged",CHANGING_SHEET_EVENT:"changingSheet"};function Bi(e){return(Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pi(e,t,i,n,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void i(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Ri(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ii(e){return(Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ni(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fi(e,t){return(Fi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Hi=Autodesk.Viewing,zi=AutodeskNamespace("Autodesk.AEC"),ji=function(e){function t(e,i){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Ii(t).call(this,e,i))||"object"!==Bi(r)&&"function"!=typeof r?Ni(o):r).options=n.options.avatarOptions||n.options,n.autoFocus=void 0===n.options.autoFocus||n.options.autoFocus,n.outOfFocus=!0,n.focusDuration=2,n.last3dCameraPos=new THREE.Vector3,n.update=n.update.bind(Ni(n)),n.onMainMapChanged=n.onMainMapChanged.bind(Ni(n)),n.on3dCameraChanged=n.on3dCameraChanged.bind(Ni(n)),n.onSheetCameraChanged=n.onSheetCameraChanged.bind(Ni(n)),n.onDragStart=n.onDragStart.bind(Ni(n)),n.onDragEnd=n.onDragEnd.bind(Ni(n)),n}var i,n,o,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fi(e,t)}(t,Autodesk.Viewing.Extension),i=t,(n=[{key:"load",value:(r=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.SheetSyncExtension",this.viewer.config);case 2:this.sheetSyncExt=e.sent,this.targetViewer=this.sheetSyncExt.targetViewer,t={mapPixelsToWorld:this.mapPixelsToWorld.bind(this),worldToMapPixels:this.worldToMapPixels.bind(this),mapPixelsToWidget:this.mapPixelsToWidget.bind(this),widgetToMapPixels:this.widgetToMapPixels.bind(this),getMapRotationAngle:this.getCameraRotationAngle.bind(this)},this.avatarWidget=new _i(this.viewer.container,this.targetViewer,this.globalManager,t,this.options.trackUsage),this.addListeners(),this.activateTool();case 8:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(i,n){var o=r.apply(e,t);function a(e){Pi(o,i,n,a,s,"next",e)}function s(e){Pi(o,i,n,a,s,"throw",e)}a(void 0)}))},function(){return a.apply(this,arguments)})},{key:"unload",value:function(){return this.sheetSyncExt=null,this.removeListeners(),this.deactivateTool(),this.avatarWidget.destroy(),this.avatarWidget=null,this.focusAnim&&(this.focusAnim.stop(),this.focusAnim=null),!0}},{key:"activateTool",value:function(){this.toolActive||(this.toolActive=!0,this.viewer.toolController.registerTool(this.avatarWidget.tool),this.viewer.toolController.activateTool(this.avatarWidget.tool.getName()),this.avatarWidget.addEventListener(Autodesk.AEC.AvatarEvents.DRAG_START_EVENT,this.onDragStart),this.avatarWidget.addEventListener(Autodesk.AEC.AvatarEvents.DRAG_END_EVENT,this.onDragEnd),this.updateFocus())}},{key:"deactivateTool",value:function(){this.toolActive&&(this.toolActive=!1,this.viewer.toolController.deactivateTool(this.avatarWidget.tool.getName()),this.viewer.toolController.deregisterTool(this.avatarWidget.tool),this.avatarWidget.removeEventListener(Autodesk.AEC.AvatarEvents.DRAG_START_EVENT,this.onDragStart),this.avatarWidget.removeEventListener(Autodesk.AEC.AvatarEvents.DRAG_END_EVENT,this.onDragEnd))}},{key:"addListeners",value:function(){this.targetViewer.addEventListener(Hi.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.addEventListener(Hi.MODEL_ADDED_EVENT,this.update),this.targetViewer.addEventListener(Hi.MODEL_REMOVED_EVENT,this.update),this.targetViewer.addEventListener(Hi.CAMERA_CHANGE_EVENT,this.on3dCameraChanged),this.viewer.addEventListener(Hi.MODEL_ADDED_EVENT,this.update),this.viewer.addEventListener(Hi.MODEL_REMOVED_EVENT,this.update),this.viewer.addEventListener(Hi.RENDER_PRESENTED_EVENT,this.update),this.viewer.addEventListener(Hi.VIEWER_RESIZE_EVENT,this.update),this.viewer.addEventListener(Oi.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.addEventListener(Hi.CAMERA_CHANGE_EVENT,this.onSheetCameraChanged)}},{key:"removeListeners",value:function(){this.targetViewer.removeEventListener(Hi.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.removeEventListener(Hi.MODEL_ADDED_EVENT,this.update),this.targetViewer.removeEventListener(Hi.MODEL_REMOVED_EVENT,this.update),this.targetViewer.removeEventListener(Hi.CAMERA_CHANGE_EVENT,this.on3dCameraChanged),this.viewer.removeEventListener(Hi.MODEL_ADDED_EVENT,this.update),this.viewer.removeEventListener(Hi.MODEL_REMOVED_EVENT,this.update),this.viewer.removeEventListener(Hi.RENDER_PRESENTED_EVENT,this.update),this.viewer.removeEventListener(Hi.VIEWER_RESIZE_EVENT,this.update),this.viewer.removeEventListener(Oi.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.removeEventListener(Hi.CAMERA_CHANGE_EVENT,this.onSheetCameraChanged)}},{key:"onDragStart",value:function(){this.focusAnim&&(this.focusAnim.stop(),this.focusAnim=null)}},{key:"onDragEnd",value:function(){this.outOfFocus=!0,this.updateFocus()}},{key:"isBimWalkActive",value:function(){return"bimwalk"===this.targetViewer.getActiveNavigationTool()}},{key:"onMainMapChanged",value:function(e){e.sheetMap&&this.update()}},{key:"update",value:function(){this.viewer.model&&this.avatarWidget&&this.sheetSyncExt&&(this.sheetSyncExt.sheetMap&&this.isBimWalkActive()?(this.avatarWidget.show(),this.avatarWidget.update(),this.activateTool()):(this.avatarWidget.hide(),this.deactivateTool()))}},{key:"setCameraPosition",value:function(e,t){var i=this.viewer.getCamera();i.position.set(e.x,e.y,t?e.z:i.position.z),i.target.set(e.x,e.y,i.target.z),i.dirty=!0}},{key:"getCameraRotationAngle",value:function(){return Di(this.viewer)}},{key:"worldToMapPixels",value:function(e){return Ti(this.sheetSyncExt.sheetMap,e)}},{key:"mapPixelsToWorld",value:function(e,t,i){return Ai(this.sheetSyncExt.sheetMap,e,t,i)}},{key:"mapPixelsToWidget",value:function(e){return function(e,t,i){Ci(e,i),i.copy(t.worldToClient(i))}(this.sheetSyncExt.sheetMap,this.viewer,e)}},{key:"widgetToMapPixels",value:function(e,t){return t=t&&!this.sheetSyncExt.options.cropToViewport,Li(this.sheetSyncExt.sheetMap,this.viewer,e,t)}},{key:"world3DtoWorld2D",value:function(e){var t=this.worldToMapPixels(e);return this.mapPixelsToWidget(t),Vi(this.viewer,t.x,t.y)}},{key:"getAvatarPositionOn2DSheet",value:function(){return this.world3DtoWorld2D(this.targetViewer.getCamera().position)}},{key:"on3dCameraChanged",value:function(){this.updateFocus(),this.update()}},{key:"onSheetCameraChanged",value:function(){this.viewer.toolController.getTool("pan").isInteractionActive()&&(this.outOfFocus=!0,this.focusAnim&&(this.focusAnim.stop(),this.focusAnim=null))}},{key:"focusOnAvatar",value:function(){var e=this;this.animateFocus(!1,(function(){e.outOfFocus=!1}))}},{key:"focusOnModel",value:function(){var e=this;this.animateFocus(!0,(function(){e.outOfFocus=!0}))}},{key:"updateFocus",value:function(){if(this.sheetSyncExt&&this.sheetSyncExt.sheetMap&&this.autoFocus&&!this.avatarWidget.tool.isDragging){var e=this.targetViewer.getCamera();if(this.last3dCameraPos.x!==e.position.x||this.last3dCameraPos.y!==e.position.y){if(this.isAvatarInsideBounds())if(this.outOfFocus)this.focusOnAvatar();else{var t=this.getAvatarPositionOn2DSheet();this.setCameraPosition(t)}else this.focusOnModel();this.last3dCameraPos=e.position.clone()}}else this.outOfFocus=!0}},{key:"getFuzzyBoundsCenter",value:function(){var e=this.sheetSyncExt.getFuzzyBox(),t=this.world3DtoWorld2D(e.min),i=this.world3DtoWorld2D(e.max),n=(new THREE.Box3).setFromPoints([t,i]),o=this.viewer.getCamera();return this.viewer.navigation.computeFit(o.position,o.target,o.fov,n,o.aspect).position}},{key:"isAvatarInsideBounds",value:function(){var e=this.sheetSyncExt.getFuzzyBox();e.min.z=-1/0,e.max.z=1/0;var t=this.targetViewer.getCamera().position;return e.containsPoint(t)}},{key:"animateFocus",value:function(e,t){var i=this;if(!this.focusAnim){var n=this.viewer.getCamera().position;this.focusAnim=Autodesk.Viewing.Private.fadeValue(0,1,this.focusDuration,(function(t){var o=e?i.getFuzzyBoundsCenter():i.getAvatarPositionOn2DSheet();t=Autodesk.Viewing.Private.smootherStep(t);var r=n.clone().lerp(o,t);i.setCameraPosition(r,e)}),(function(){i.focusAnim=null,t&&t()}))}}},{key:"getAutoFocus",value:function(){return this.autoFocus}},{key:"setAutoFocus",value:function(e){this.autoFocus=e,this.updateFocus()}}])&&Ri(i.prototype,n),o&&Ri(i,o),t}();function Gi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ui(e,t,i){return t&&Wi(e.prototype,t),i&&Wi(e,i),e}zi.AvatarExtension=ji,Hi.theExtensionManager.registerExtension("Autodesk.AEC.AvatarExtension",ji);var Yi=function(){function e(t,i,n,o){Gi(this,e),this.sheetNode=t,this.viewport=i,this.mapMatrix=n,this.mapMatrixInv=(new THREE.Matrix4).getInverse(n),this.levelGuid=o,this.thumbnail=void 0}return Ui(e,[{key:"isUsable",value:function(e,t){return this.levelGuid===t&&ui(e,this.mapMatrix)}}]),e}(),Zi=new THREE.Matrix4,Xi=function(){function e(){Gi(this,e)}return Ui(e,null,[{key:"computeMapMatrix",value:function(e,t,i){var n=ie.getViewportBounds(e,1),o=ie.remapRectangle(n.min.x,n.min.y,n.max.x,n.max.y,-1,-1,1,1),r=ie.get3DTo2DMatrix(e,1),a=(new THREE.Matrix4).multiplyMatrices(o,r);if(t.myData.placementWithOffset){var s=i||new THREE.Matrix4;s.getInverse(t.myData.placementWithOffset),a.multiply(s)}return a}},{key:"findMaps",value:function(t,i){for(var n=[],o=0;o<t.length;o++){var r=t[o],a=r.getDocumentNode().getAecModelData(),s=a&&ie.findViewportsForLevel(a,i).filter(ie.supports2DTo3DTransform);if(s)for(var l=r.getDocumentNode().getRootNode(),u=0;u<s.length;u++){var h=s[u],c=ie.findSheetForViewport(l,h);if(c){var d=e.computeMapMatrix(h,r,Zi);n.push(new Yi(c,h,d,i))}}}return n}},{key:"createSheetMapConfigs",value:function(t,i){for(var n=e.findMaps(t,i),o=[],r=0;r<n.length;r++){var a=n[r];a.sheetNode.search({type:"view"}).length>0&&o.push(a)}return o}}]),e}();function qi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ji=(new THREE.Box3).setFromPoints([new THREE.Vector3(-1e20,-1e20,-1e20),new THREE.Vector3(1e20,1e20,1e20)]),Ki=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.options=i}var t,i,n;return t=e,(i=[{key:"updateSheetAppearance",value:function(e,t){var i=this;if(this.viewer.model){var n=t?.8:0,o=e&&e.viewportBounds;t&&this.updateCrop(t,o),this.animateOpacity(this.viewer.model,n,(function(){i.updateCrop(t,o)}))}}},{key:"setVisibilityImmediate",value:function(e){var t=this.viewer.model;t&&(t.fadeAnim&&(t.fadeAnim.stop(),t.fadeAnim=null),this.setModelOpacity(t,e?1:0))}},{key:"animateOpacity",value:function(e,t,i){var n=this;if(e){e.fadeAnim&&(e.fadeAnim.stop(),e.fadeAnim=null);var o=e.opacity||0;e.fadeAnim=Autodesk.Viewing.Private.fadeValue(0,1,.7,(function(i){i=Autodesk.Viewing.Private.smootherStep(i);var r=Autodesk.Viewing.Private.lerp(o,t,i);n.setModelOpacity(e,r)}),(function(){e.fadeAnim=null,i&&i()})),e.fadeAnim.targetValue=t}}},{key:"setModelOpacity",value:function(e,t){if(this.options.hideSheetWhenNotFocused&&e){var i=this.viewer.impl.matman().getModelMaterials(e).mats,n=!1;Object.keys(i).forEach((function(e){i[e].uniforms&&i[e].uniforms.opacity&&i[e].uniforms.opacity.value!==t&&(i[e].uniforms.opacity.value=t,n=!0)})),e.opacity=t,n&&this.viewer.impl.invalidate(!0)}}},{key:"updateCrop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ji;if(this.options.cropToViewport){var i,n=this.viewer.model;if(!n)return;n.latestCropBounds||(n.latestCropBounds=new THREE.Box3),i=e?t:Ji,n.latestCropBounds.equals(i)||(n.latestCropBounds=i.clone(),this.cropToViewport(i))}}},{key:"cropToViewport",value:function(e){var t=[new THREE.Vector4(0,-1,0,e.min.y),new THREE.Vector4(0,1,0,-e.max.y),new THREE.Vector4(-1,0,0,e.min.x),new THREE.Vector4(1,0,0,-e.max.x)];this.viewer.impl.setCutPlaneSet("SheetRegion",t)}}])&&qi(t.prototype,i),n&&qi(t,n),e}();function Qi(e){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function en(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tn(e,t){return!t||"object"!==Qi(t)&&"function"!=typeof t?on(e):t}function nn(e){return(nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function on(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rn(e,t){return(rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var an=Autodesk.Viewing,sn=AutodeskNamespace("Autodesk.AEC"),ln=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $i(this,t),(i=tn(this,nn(t).call(this,e,n))).options=i.options.sheetSyncOptions||i.options,i.targetViewer=i.options.targetViewer,i.sheetMap=null,i.targetModels=[],i.mapCache={},i.modelIdToFuzzyBox=[],i.isModelLoadingMap={},i.showSheet=i.options.showSheet||!1,i.sheetVisibilityManager=new Ki(i.viewer,i.options),i.onNavigationToolChanged=i.onNavigationToolChanged.bind(on(i)),i.onSheetGeometryLoaded=i.onSheetGeometryLoaded.bind(on(i)),i.on3dGeometryLoaded=i.on3dGeometryLoaded.bind(on(i)),i.updateSheetAppearance=i.updateSheetAppearance.bind(on(i)),i.isCameraInsideMap=i.isCameraInsideMap.bind(on(i)),i.update=i.update.bind(on(i)),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rn(e,t)}(t,Autodesk.Viewing.Extension),i=t,(n=[{key:"load",value:function(){return this.targetViewer.addEventListener(an.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationToolChanged),this.onNavigationToolChanged(),!0}},{key:"unload",value:function(){return this.deactivate(),this.sheetVisibilityManager.setVisibilityImmediate(!0),this.sheetVisibilityManager.updateCrop(null),this.sheetMap=null,this.targetModels=[],this.targetViewer.removeEventListener(an.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationToolChanged),this.throttleTimeout&&clearTimeout(this.throttleTimeout),!0}},{key:"activate",value:function(){this.active||(this.active=!0,this.addListeners(),this.on3dGeometryLoaded())}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.sheetMap=null,this.removeListeners())}},{key:"addListeners",value:function(){this.targetViewer.addEventListener(an.MODEL_ADDED_EVENT,this.update),this.targetViewer.addEventListener(an.MODEL_REMOVED_EVENT,this.update),this.targetViewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.update),this.targetViewer.addEventListener(an.GEOMETRY_LOADED_EVENT,this.on3dGeometryLoaded),this.targetViewer.addEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.updateSheetAppearance),this.viewer.addEventListener(an.MODEL_ROOT_LOADED,this.onSheetGeometryLoaded),this.viewer.addEventListener(an.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.addEventListener(an.TEXTURES_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.addEventListener(Oi.MAIN_MAP_CHANGED_EVENT,this.updateSheetAppearance);var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");e&&e.floorSelector&&e.floorSelector.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update)}},{key:"removeListeners",value:function(){this.targetViewer.removeEventListener(an.MODEL_ADDED_EVENT,this.update),this.targetViewer.removeEventListener(an.MODEL_REMOVED_EVENT,this.update),this.targetViewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.update),this.targetViewer.removeEventListener(an.GEOMETRY_LOADED_EVENT,this.on3dGeometryLoaded),this.targetViewer.removeEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.updateSheetAppearance),this.viewer.removeEventListener(an.MODEL_ROOT_LOADED,this.onSheetGeometryLoaded),this.viewer.removeEventListener(an.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.removeEventListener(an.TEXTURES_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.removeEventListener(Oi.MAIN_MAP_CHANGED_EVENT,this.updateSheetAppearance);var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");e&&e.floorSelector&&e.floorSelector.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update)}},{key:"isBimWalkActive",value:function(){return"bimwalk"===this.targetViewer.getActiveNavigationTool()}},{key:"onNavigationToolChanged",value:function(){this.isBimWalkActive()?this.activate():this.deactivate(),this.update()}},{key:"updateSheetAppearance",value:function(){if(this.isSheetMapLoaded(this.sheetMap)&&this.isMapOnCurrentLevel(this.sheetMap)){var e=this.showSheet&&this.isCameraInsideMap(this.sheetMap)&&this.isBimWalkActive();this.sheetVisibilityManager.updateSheetAppearance(this.sheetMap,e)}else this.sheetVisibilityManager.setVisibilityImmediate(!1),this.sheetVisibilityManager.updateCrop(null)}},{key:"getFuzzyBox",value:function(){for(var e=new THREE.Box3,t=0;t<this.targetModels.length;t++){var i=this.targetModels[t],n=this.modelIdToFuzzyBox[i.id];n||(n=i.getFuzzyBox(),this.modelIdToFuzzyBox[i.id]=n),e.union(n)}return e}},{key:"generateDummyMap",value:function(){if(!this.sheetMap){var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension"),t=e.getCurrentLevel(),i=e.getZRange(t.index),n=this.getFuzzyBox();n.min.z=0,n.max.z=0;var o=this.viewer.impl.renderer(),r=o.settings.logicalWidth,a=o.settings.logicalHeight,s=new an.UnifiedCamera(r,a);hi(s,n,i.zMin,i.zMax,n.size().y);var l=new THREE.Matrix4,u=new THREE.Matrix4;!function(e,t){t.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)}(s,l),u.getInverse(l);var h=Vi(this.viewer,0,0),c=Vi(this.viewer,r,a),d=(new THREE.Box3).setFromPoints([h,c]);this.sheetMap={viewportBounds:d,mapMatrix:l,mapMatrixInv:u,viewport:{}},this.viewer.dispatchEvent({type:Oi.MAIN_MAP_CHANGED_EVENT,sheetMap:this.sheetMap}),this.update()}}},{key:"on3dGeometryLoaded",value:function(){this.updateTargetModels(),this.targetModels&&(this.generateDummyMap(),this.update())}},{key:"onSheetGeometryLoaded",value:function(e){var t=e.model;this.options.hidePaper&&(t.getFragmentList().setObject2DVisible(-1,!1),this.viewer.impl.invalidate(!0)),this.update()}},{key:"updateTargetModels",value:function(){if(!this.options.useCustomModel){var e=this.targetViewer.getVisibleModels().filter((function(e){return e.is3d()}));this.setTargetModels(e)}}},{key:"setTargetModels",value:function(e){this.targetModels=e}},{key:"getSheetNodeKey",value:function(e){return e&&e.sheetNode&&e.sheetNode.getModelKey()}},{key:"isLoadingSheetNode",value:function(e){var t=this.getSheetNodeKey(e);return t&&this.isModelLoadingMap[t]}},{key:"shouldSwitchSheet",value:function(){var e=this.showSheet,t=this.options.autoSwitchSheet,i=!this.isSheetMapLoaded(this.sheetMap),n=this.isCameraInsideMap(this.sheetMap),o=this.isLoadingSheetNode(this.sheetMap);return t&&i&&e&&n&&!o}},{key:"getCurrentLevel",value:function(){var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");if(e)return e.getCurrentLevel()}},{key:"update",value:function(){this.viewer.model&&this.getCurrentLevel()&&this.isBimWalkActive()&&(this.updateTargetModels(),this.updateSheetMaps(),this.updateSheetAppearance(),this.switchSheetIfNeededDebounce())}},{key:"switchSheetIfNeededDebounce",value:function(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(this.switchSheetIfNeeded.bind(this),300)}},{key:"switchSheetIfNeeded",value:function(){var e=this;if(this.shouldSwitchSheet()){this.viewer.dispatchEvent({type:Oi.CHANGING_SHEET_EVENT,sheetNode:this.sheetMap.sheetNode});var t=this.viewer.model,i=this.sheetMap.sheetNode.getRootNode().getDocument(),n=this.options.hideSheetWhenNotFocused?0:1,o=this.options.loadDocumentNode||this.viewer.loadDocumentNode.bind(this.viewer),r=this.options.unloadModel||this.viewer.unloadModel.bind(this.viewer),a=this.getSheetNodeKey(this.sheetMap);this.isModelLoadingMap[a]=!0,o(i,this.sheetMap.sheetNode,{opacity:n,preserveView:!0,keepCurrentModels:!0,loadAsHidden:!0}).catch((function(t){return console.error("Failed to load sheet: ",e.sheetMap.sheetNode.name(),": ",t)})).then((function(i){t&&t!==i&&r(t),e.isModelLoadingMap[a]=!1,e.viewer.showModel(i,!0),e.sheetVisibilityManager.setVisibilityImmediate(!1),e.update(),e.viewer.dispatchEvent({type:Oi.MAIN_MAP_CHANGED_EVENT,sheetMap:e.sheetMap})}))}}},{key:"isSheetMapsEqual",value:function(e,t){return!(!!e^!!t||e&&e.viewport.viewportGuid!==t.viewport.viewportGuid)}},{key:"isMapOnCurrentLevel",value:function(e){if(!e)return!1;var t=this.getCurrentLevel();return!(!t||e.levelGuid!==t.guid)}},{key:"isSheetMapLoaded",value:function(e){return e&&e.sheetNode&&this.viewer.model&&e.sheetNode.guid()===this.viewer.model.getDocumentNode().guid()}},{key:"isCameraInsideMap",value:function(e){return!!e&&!!this.isMapOnCurrentLevel(e)&&!(!this.options.autoSwitchSheet&&!this.isSheetMapLoaded(e))&&ui(this.targetViewer.getCamera().position,e.mapMatrix)}},{key:"updateSheetMaps",value:function(){var e,t=this,i=this.getCurrentLevel();this.mapCache[i.guid]?e=this.mapCache[i.guid]:((e=Xi.createSheetMapConfigs(this.targetModels,i.guid)).forEach((function(e){e.viewportBounds=ie.getViewportBounds(e.viewport,t.viewer.model.getUnitScale())})),this.mapCache[i.guid]=e);var n=e.find(this.isCameraInsideMap)||(this.options.cropToViewport?this.sheetMap:void 0),o=!this.isSheetMapsEqual(this.sheetMap,n);this.sheetMap=n,o&&this.viewer.dispatchEvent({type:Oi.MAIN_MAP_CHANGED_EVENT,sheetMap:this.sheetMap})}},{key:"setShowSheet",value:function(e){this.showSheet=e,this.update()}},{key:"getShowSheet",value:function(){return this.showSheet}}])&&en(i.prototype,n),o&&en(i,o),t}();Object.assign(sn,{SheetSyncEvents:Oi}),sn.SheetSyncExtension=ln,an.theExtensionManager.registerExtension("Autodesk.AEC.SheetSyncExtension",ln);var un=2;function hn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var cn=Autodesk.Viewing,dn=function(e,t){var i=Autodesk.AEC.AecModelData.getViewportBounds(t,.0254),n=e.search({type:"view"})[0];if(!n)return null;var o,r,a,s,l=n.getViewBox(),u=new THREE.Box2;return u.min.set(l[0],l[1]),u.max.set(l[2],l[3]),r=(o=u).size(),a=o.center(),s=.5*Math.max(r.x,r.y),o.min.set(a.x-s,a.y-s),o.max.set(a.x+s,a.y+s),di(i.min,u),di(i.max,u),i},pn=function(){function e(t,i,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sheetMapConfig=t,this.viewer=i,this.thumbnailImage=null,this.thumbnailRefined=!1,this.img=new Image,this.img.onload=function(){var e=o.sheetMapConfig,t=e.sheetNode,i=e.viewport,r=dn(t,i),a=function(e,t){var i=cn.getGlobal().document.createElement("canvas"),n=i.getContext("2d"),o=t.max.x-t.min.x,r=t.max.y-t.min.y,a=o*e.width,s=r*e.height;i.width=a,i.height=s,n.drawImage(e,t.min.x*e.width,(1-t.max.y)*e.height,a,s,0,0,a,s);var l=new Image;return l.src=i.toDataURL(),l}(o.img,r);a.onload=function(){o.thumbnailImage=a,n(o.sheetMapConfig)}}}var t,i,n;return t=e,(i=[{key:"onThumbnailDownloaded",value:function(e){this.thumbnailRefined||(this.img.src=e)}},{key:"requestThumbnail",value:function(){var e=this,t=this.sheetMapConfig.sheetNode,i=t.getRootNode().getDocument(),n=i.getThumbnailOptions(t.data,400,400);if(t.data.thumbnailUrn)n.urn=t.getDocument().getFullPath(t.data.thumbnailUrn),n.responseType="blob",Autodesk.Viewing.Private.ViewingService.getThumbnail(Autodesk.Viewing.initLoadContext(),n.urn,(function(t){var i=new FileReader;i.onload=function(t){e.onThumbnailDownloaded(t.target.result)},i.readAsDataURL(t)}),(function(){console.warn("Failed to load sheet thumbnail. Error: ".concat(error,", Urn: ").concat(n.urn,", SheetName: ").concat(t.name()))}),n);else if(Autodesk.Viewing.endpoint.getUseCookie()){var o=i.getThumbnailPath(t.data,400,400);this.onThumbnailDownloaded(o)}else Autodesk.Viewing.Document.requestThumbnailWithSecurity(n,(function(i,o){if(i)console.warn("Failed to load sheet thumbnail. Error: ".concat(i,", Urn: ").concat(n.urn,", SheetName: ").concat(t.name()));else{var r=cn.getGlobal().URL.createObjectURL(o);e.onThumbnailDownloaded(r)}}))}},{key:"refineThumbnail",value:function(){var e=this;if(!this.thumbnailRefined){this.thumbnailRefined=!0;var t=this.viewer.model.getBoundingBox(),i=this.viewer.model.getDocumentNode().search({type:"view"})[0],n=i&&i.getViewBox();n&&(t.min.x=n[0],t.min.y=n[1],t.max.x=n[2],t.max.y=n[3]);var o=new Autodesk.Viewing.UnifiedCamera(1500,1500);o.setViewFromBox(t,!0);var r={camera:o};this.viewer.impl.getScreenShotProgressive(1500,1500,(function(t){e.img.src=t}),r)}}}])&&hn(t.prototype,i),n&&hn(t,n),e}();function vn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fn="thumbnail-overlay-scene",mn=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.sheetSyncExt=i,this.planeGeometry=new THREE.PlaneBufferGeometry(1,1),this.viewer.impl.createOverlayScene(fn),this.createThumbnailMesh=this.createThumbnailMesh.bind(this)}var t,i,n;return t=e,(i=[{key:"createThumbnailMesh",value:function(e){var t=e.thumbnail.mesh;if(!t){var i=Ai(e,e.viewportBounds.min.x,e.viewportBounds.min.y,0),n=Ai(e,e.viewportBounds.max.x,e.viewportBounds.max.y,0),o=Ai(e,e.viewportBounds.max.x,e.viewportBounds.min.y,0),r=Math.atan2(o.y-i.y,o.x-i.x),a=(new THREE.Box3).setFromPoints([i,n]),s=a.center();ci(i,s,-r),ci(n,s,-r),a.setFromPoints([i,n]);var l=a.size(),u=e.viewportBounds.size(),h=Ai(e,u.x/2,u.y/2,this.viewer.getCamera().position.z-1e-4),c=new THREE.MeshBasicMaterial({opacity:0,transparent:!0,blending:THREE.NoBlending});(t=new THREE.Mesh(this.planeGeometry,c)).position.copy(h),t.rotation.set(0,0,r),t.scale.set(l.x,l.y,1),e.thumbnail.mesh=t;var d=new THREE.Texture;d.minFilter=THREE.LinearFilter,t.material.map=d}t.material.map.image=e.thumbnail.thumbnailImage,t.material.map.needsUpdate=!0,this.update()}},{key:"showThumbnail",value:function(e){e&&e.mesh&&-1===this.viewer.impl.overlayScenes[fn].scene.children.indexOf(e.mesh)&&(this.viewer.impl.addOverlay(fn,e.mesh),this.animateOpacity(e,.5))}},{key:"hideThumbnail",value:function(e,t){var i=this;e&&e.mesh&&-1!==this.viewer.impl.overlayScenes[fn].scene.children.indexOf(e.mesh)&&(t?(this.viewer.impl.removeOverlay(fn,e.mesh),e.mesh.material.opacity=0):this.animateOpacity(e,0,(function(){i.viewer.impl.removeOverlay(fn,e.mesh)})))}},{key:"animateOpacity",value:function(e,t,i){var n=this;if(e.fadeAnim){if(e.fadeAnim.targetValue===t)return;e.fadeAnim.stop(),e.fadeAnim=null}var o=e.mesh.material.opacity;e.fadeAnim=Autodesk.Viewing.Private.fadeValue(0,1,.7,(function(i){i=Autodesk.Viewing.Private.smootherStep(i);var r=Autodesk.Viewing.Private.lerp(o,t,i);n.setThumbnailOpacity(e,r)}),(function(){e.fadeAnim=null,i&&i()})),e.fadeAnim.targetValue=t}},{key:"setThumbnailOpacity",value:function(e,t){e.mesh.material.opacity!==t&&(e.mesh.material.opacity=t,this.viewer.impl.invalidate(!1,!1,!0))}},{key:"requestThumbnailDebounce",value:function(e){var t=this;this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((function(){e.thumbnail=new pn(e,t.sheetSyncExt.viewer,t.createThumbnailMesh),t.tryRefineThumbnail(e)||e.thumbnail.requestThumbnail()}),300)}},{key:"tryRefineThumbnail",value:function(e){return!(!this.sheetSyncExt.isSheetMapLoaded(e)||!this.sheetSyncExt.viewer.model.isLoadDone()||.8!==this.sheetSyncExt.viewer.model.opacity||(e.thumbnail.refineThumbnail(),0))}},{key:"update",value:function(){var e=this,t=this.sheetSyncExt.mapCache,i=this.sheetSyncExt.getCurrentLevel();if(i){var n=this.sheetSyncExt.getShowSheet();Object.keys(t).forEach((function(o){var r=t[o],a=o===i.guid;r.forEach((function(t){var r=a&&n&&!e.sheetSyncExt.isCameraInsideMap(t);a&&(t.thumbnail?t.thumbnail.thumbnailRefined||e.tryRefineThumbnail(t):e.requestThumbnailDebounce(t)),r?e.showThumbnail(t.thumbnail):e.hideThumbnail(t.thumbnail,o!==i.guid)}))}))}}},{key:"destroy",value:function(){this.planeGeometry.dispose(),this.planeGeometry=null,this.viewer.impl.removeOverlayScene(fn),this.sheetSyncExt=null,this.viewer=null}}])&&vn(t.prototype,i),n&&vn(t,n),e}();function gn(e){return(gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yn(e,t,i,n,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void i(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function En(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xn(e,t){return!t||"object"!==gn(t)&&"function"!=typeof t?kn(e):t}function bn(e){return(bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sn(e,t){return(Sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mn=Autodesk.Viewing,_n=AutodeskNamespace("Autodesk.AEC"),Tn=new THREE.Vector3,An=new THREE.Vector2,Cn=new THREE.Box3,Vn=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return En(this,t),(i=xn(this,bn(t).call(this,e,n))).options=i.options.topViewRendererOptions||i.options,i.isModelLoadingMap={},i.waitBeforeRotation=1,i.rotationDuration=2,i.onBeginScene=i.onBeginScene.bind(kn(i)),i.update=i.update.bind(kn(i)),i.onMainMapChanged=i.onMainMapChanged.bind(kn(i)),i.onResize=i.onResize.bind(kn(i)),i.rotateToSheet=i.rotateToSheet.bind(kn(i)),i.onSheetGeometryLoaded=i.onSheetGeometryLoaded.bind(kn(i)),i}var i,n,o,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sn(e,t)}(t,Autodesk.Viewing.Extension),i=t,(n=[{key:"load",value:(r=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.SheetSyncExtension",this.viewer.config);case 2:this.sheetSyncExt=e.sent,this.targetViewer=this.sheetSyncExt.targetViewer,this.initTopViewViewer(),this.thumbnailsOverlay=new mn(this.topViewViewer,this.sheetSyncExt),this.addListeners();case 7:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(i,n){var o=r.apply(e,t);function a(e){yn(o,i,n,a,s,"next",e)}function s(e){yn(o,i,n,a,s,"throw",e)}a(void 0)}))},function(){return a.apply(this,arguments)})},{key:"initTopViewViewer",value:function(){var e=this.viewer.container,t=this.targetViewer.sharedResources;t?this.topViewViewer=Autodesk.Viewing.createLeechViewer(e,{},t,Autodesk.Viewing.Viewer3D):(console.warn("TopViewRenderer - It is highly recommended using LeechViewer as your target viewer when using this extension."),this.topViewViewer=new Autodesk.Viewing.Viewer3D(e,{})),this.viewer.container.insertBefore(this.topViewViewer.container,this.viewer.container.firstChild),this.topViewViewer.container.style.zIndex=-1,this.topViewViewer.container.style.pointerEvents="none",this.topViewViewer.container.style.transition="opacity 0.7s",this.topViewViewer.container.style.backgroundColor="transparent",this.topViewViewer.start(void 0,void 0,void 0,void 0,{webglInitParams:{alpha:!0}}),this.topViewViewer.impl.skipCameraUpdate=!0,this.topViewViewer.setBackgroundOpacity(0),this.backgroundColorBackup=this.viewer.container.style.backgroundColor,this.viewer.container.style.backgroundColor="transparent",this.backgroundOpacityBackup=this.viewer.impl.glrenderer().getClearAlpha(),this.viewer.setBackgroundOpacity(0)}},{key:"destroyTopViewViewer",value:function(){this.topViewViewer&&(this.topViewViewer.finish(),this.topViewViewer=null,this.viewer.container.style.backgroundColor=this.backgroundColorBackup,this.viewer.setBackgroundOpacity(this.backgroundOpacityBackup))}},{key:"unload",value:function(){return this.removeListeners(),this.thumbnailsOverlay&&(this.thumbnailsOverlay.destroy(),this.thumbnailsOverlay=null),this.destroyTopViewViewer(),this.rotationAnim&&(this.rotationAnim.stop(),this.rotationAnim=null),this.rotationTimeout&&clearTimeout(this.rotationTimeout),this.viewer=null,this.targetViewer=null,this.sheetSyncExt=null,!0}},{key:"addListeners",value:function(){this.targetViewer.addEventListener(Mn.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.addEventListener(Mn.MODEL_ADDED_EVENT,this.update),this.targetViewer.addEventListener(Mn.MODEL_REMOVED_EVENT,this.update),this.targetViewer.addEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.update),this.viewer.addEventListener(Mn.PROGRESS_UPDATE_EVENT,this.onBeginScene),this.viewer.addEventListener(Mn.RENDER_SCENE_PART,this.update),this.viewer.addEventListener(Mn.VIEWER_RESIZE_EVENT,this.onResize),this.viewer.addEventListener(Oi.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.addEventListener(Mn.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.topViewViewer.addEventListener(Mn.MODEL_ADDED_EVENT,this.update);var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");e&&e.floorSelector&&e.floorSelector.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update)}},{key:"removeListeners",value:function(){this.targetViewer.removeEventListener(Mn.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.removeEventListener(Mn.MODEL_ADDED_EVENT,this.update),this.targetViewer.removeEventListener(Mn.MODEL_REMOVED_EVENT,this.update),this.targetViewer.removeEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.update),this.viewer.removeEventListener(Mn.PROGRESS_UPDATE_EVENT,this.onBeginScene),this.viewer.removeEventListener(Mn.RENDER_SCENE_PART,this.update),this.viewer.removeEventListener(Mn.VIEWER_RESIZE_EVENT,this.onResize),this.viewer.removeEventListener(Oi.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.removeEventListener(Mn.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.topViewViewer.removeEventListener(Mn.MODEL_ADDED_EVENT,this.update);var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");e&&e.floorSelector&&e.floorSelector.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update)}},{key:"isBimWalkActive",value:function(){return this.targetViewer&&"bimwalk"===this.targetViewer.getActiveNavigationTool()}},{key:"onResize",value:function(e){var t=e.width,i=e.height;this.topViewViewer.impl.resize(t,i,!0),this.update()}},{key:"onMainMapChanged",value:function(){this.syncCamera(),this.update(),this.validateRotation()}},{key:"onSheetGeometryLoaded",value:function(){this.validateRotation()}},{key:"validateRotation",value:function(){this.rotationTimeout&&clearTimeout(this.rotationTimeout),this.rotationTimeout=setTimeout(this.rotateToSheet,1e3*this.waitBeforeRotation)}},{key:"isDraggingAvatar",value:function(){var e=this.viewer.getExtension("Autodesk.AEC.AvatarExtension"),t=!e||!e.avatarWidget||e.avatarWidget.isDragging();return t}},{key:"rotateToSheet",value:function(){var e=this;if(this.viewer&&this.sheetSyncExt.getShowSheet())if(this.rotationAnim&&(this.rotationAnim.stop(),this.rotationAnim=null),this.isDraggingAvatar())this.validateRotation();else{var t=Di(this.viewer);t<-Math.PI?t+=2*Math.PI:t>Math.PI&&(t-=2*Math.PI),this.rotationAnim=Autodesk.Viewing.Private.fadeValue(0,1,this.rotationDuration,(function(i){i=Autodesk.Viewing.Private.smootherStep(i);var n=t*(1-i),o=e.viewer.getCamera();o.up.set(0,1,0),ci(o.up,Tn,n),o.dirty=!0,o.updateCameraMatrices()}),(function(){e.rotationAnim=null}))}}},{key:"onBeginScene",value:function(e){var t=e.percent,i=e.state;0===t&&i===un&&this.update()}},{key:"syncCamera",value:function(){if(this.sheetSyncExt&&this.sheetSyncExt.sheetMap&&this.viewer.model&&this.worldBoundingBox){var e=this.viewer.getCamera(),t=this.sheetSyncExt.sheetMap,i=Ai(t,t.viewportBounds.min.x,t.viewportBounds.min.y,0),n=Ai(t,t.viewportBounds.max.x,t.viewportBounds.min.y,0),o=Math.atan2(n.y-i.y,n.x-i.x),r=this.worldBoundingBox.center();ci(this.worldBoundingBox.min,r,o),ci(this.worldBoundingBox.max,r,o);var a=Ti(t,this.worldBoundingBox.min.clone()),s=Ti(t,new THREE.Vector3(this.worldBoundingBox.min.x,this.worldBoundingBox.max.y,0)),l=Ti(t,this.worldBoundingBox.max.clone());a.z=0,s.z=0,l.z=0,Ci(t,a),Ci(t,l),Ci(t,s),Cn.setFromPoints([a,l]),e.setViewFromBox(Cn,!0);var u=Di(this.topViewViewer);ci(e.up,Tn,u-o),e.dirty=!0,e.updateCameraMatrices(),this.viewer.impl.invalidate(!0),this.rotationAnim&&this.rotateToSheet()}}},{key:"updateTopViewViewerCamera",value:function(){if(this.viewer.model){var e=this.sheetSyncExt.getCurrentLevel();if(e){this.viewer.impl.updateCameraMatrices();var t=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension").getZRange(e.index),i=this.viewer.impl.renderer(),n=i.settings.logicalWidth,o=i.settings.logicalHeight,r=this.viewer.getCamera().up.clone(),a=An.set(0,o);Li(this.sheetSyncExt.sheetMap,this.viewer,a);var s=Ai(this.sheetSyncExt.sheetMap,a.x,a.y,0),l=An.set(n,o);Li(this.sheetSyncExt.sheetMap,this.viewer,l);var u=Ai(this.sheetSyncExt.sheetMap,l.x,l.y,0),h=An.set(n,0);Li(this.sheetSyncExt.sheetMap,this.viewer,h);var c=Ai(this.sheetSyncExt.sheetMap,h.x,h.y,0);Cn.setFromPoints([s,c]);var d=Cn.center(),p=Di(this.viewer),v=Math.atan2(u.y-s.y,u.x-s.x);ci(s,d,-v),ci(c,d,-v),ci(r,Tn,v-p),Cn.setFromPoints([s,c]),this.worldBoundingBox=Cn.clone();var f=this.targetViewer.impl.getVisibleBounds(),m=Math.min(t.zMax,f.max.z),g=f.min.z,y=this.topViewViewer.getCamera();hi(y,Cn,g,m,Cn.size().y),y.up.copy(r),y.updateCameraMatrices(),y.dirty=!0}}}},{key:"getModelKey",value:function(e){var t=e.getDocumentNode();return t?t.getModelKey():e.getData().urn}},{key:"unloadIrrelevant3DModels",value:function(){var e=this;if(this.sheetSyncExt.targetModels){var t=this.sheetSyncExt.targetModels.map((function(t){return e.getModelKey(t)}));this.topViewViewer.getVisibleModels().forEach((function(i){var n=e.getModelKey(i);-1===t.indexOf(n)&&(e.topViewViewer.unloadModel(i),e.isModelLoadingMap[n]=!1)}))}}},{key:"loadRelevant3DModels",value:function(){var e=this;if(this.sheetSyncExt.targetModels){var t=this.topViewViewer.getVisibleModels().map((function(t){return e.getModelKey(t)}));this.sheetSyncExt.targetModels.forEach((function(i){var n=e.getModelKey(i);-1!==t.indexOf(n)||e.isModelLoadingMap[n]||(e.isModelLoadingMap[n]=!0,e.topViewViewer.loadDocumentNode(i.getDocumentNode().getRootNode().getDocument(),i.getDocumentNode(),{keepCurrentModels:!0}).then((function(){var t=e.targetViewer.impl.renderer().getConfig();t.renderEdges=!0,t.envMapBackground=null,t.aoEnabled=!1,t.antialias=!0,t.envMap=null,e.topViewViewer.impl.renderer().applyConfig(t),e.topViewViewer.setBackgroundOpacity(0)})))}))}}},{key:"hideTopViewViewer",value:function(){this.topViewViewer.container.style.opacity=0}},{key:"showTopViewViewer",value:function(){this.topViewViewer.container.style.opacity=1}},{key:"update",value:function(){this.sheetSyncExt&&this.sheetSyncExt.sheetMap&&this.viewer&&this.targetViewer&&this.topViewViewer?(this.showTopViewViewer(),this.unloadIrrelevant3DModels(),this.loadRelevant3DModels(),this.updateTopViewViewerCamera(),this.thumbnailsOverlay.update()):this.hideTopViewViewer()}}])&&wn(i.prototype,n),o&&wn(i,o),t}();_n.TopViewRenderer=Vn,Mn.theExtensionManager.registerExtension("Autodesk.AEC.TopViewRendererExtension",Vn),n.d(i,"FloorSelector",(function(){return v})),n.d(i,"ListPanel",(function(){return b})),n.d(i,"ListPanelEvents",(function(){return x})),n.d(i,"LevelsExtension",(function(){return L})),n.d(i,"HyperlinkTracker",(function(){return P})),n.d(i,"HyperlinkExtension",(function(){return G})),n.d(i,"DropMeExtension",(function(){return Te})),n.d(i,"CanvasBookmarkExtension",(function(){return it})),n.d(i,"Minimap3DExtension",(function(){return Nt})),n.d(i,"AecModelData",(function(){return ie})),n.d(i,"Locations",(function(){return si.a})),n.d(i,"AvatarExtension",(function(){return ji})),n.d(i,"SheetSyncExtension",(function(){return ln})),n.d(i,"TopViewRendererExtension",(function(){return Vn})),n.d(i,"Hypermodeling",(function(){return ri}))},6:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,n=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?i+r:n+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},98:function(e,t,i){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=Autodesk.Viewing,u=AutodeskNamespace("Autodesk.AEC.Locations");function h(t,i){for(var n in t)t.hasOwnProperty(n)&&(e.exports[n]=t[n],i[n]=t[n])}h(i(321),u),h(i(322),u);var c=function(e){"use strict";function t(e,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,a(t).call(this,e,i))}var i,n,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,e),i=t,(n=[{key:"load",value:function(){return this.locations=[],!0}},{key:"unload",value:function(){return this.locations=[],!0}},{key:"activate",value:function(){return!0}},{key:"deactivate",value:function(){return!1}},{key:"setLocations",value:function(e){this.locations=e}},{key:"getLocations",value:function(){return this.locations}}])&&o(i.prototype,n),l&&o(i,l),t}(l.Extension);l.theExtensionManager.registerExtension("Autodesk.AEC.LocationsExtension",c)}});
//# sourceMappingURL=AEC.min.js.map