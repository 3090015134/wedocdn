/*! For license information please see Edit2D.min.js.LICENSE.txt */
(()=>{var __webpack_modules__={95443:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var i=r(87537),n=r.n(i),o=r(23645),s=r.n(o)()(n());s.push([e.id,".adsk-viewing-viewer .edge-gizmo:hover{background-color:lime}.adsk-viewing-viewer .edge-gizmo{position:absolute;background-color:#009bff;box-shadow:0px 1px 3px 1px rgba(0,0,0,0.25);border-radius:8px;cursor:move;z-index:1;-webkit-tap-highlight-color:rgba(0,0,0,0)}.adsk-viewing-viewer .edge-gizmo.selected{background-color:lime}.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover{border-color:lime}.adsk-viewing-viewer .vertex-gizmo{display:inline-block;position:absolute;width:7px;height:7px;left:-2px;top:-2px;background-color:#009bff;border-style:solid;border-width:2px;border-color:#FFFFFF;border-radius:100px;box-shadow:0 2px 5px 0 #182A3D;z-index:1;cursor:move}.adsk-viewing-viewer .ellipse-arc-gizmo{display:inline-block;position:absolute;width:5px;height:5px;left:-1px;top:-1px;background-color:#ff00ff;border-style:solid;border-width:1px;border-color:#000000;border-radius:100px;box-shadow:0 2px 5px 0 #182A3D;z-index:2;cursor:move}.adsk-viewing-viewer .vertex-gizmo.selected{border-color:lime}.adsk-viewing-viewer .edge-move-gizmo{width:20px;height:6px}.adsk-viewing-viewer .edit2d-label{display:none;position:absolute;height:19px;left:0px;top:0px;padding:2px 0 2px 0;background-color:#009bff;box-shadow:0px 1px 3px 1px rgba(0,0,0,0.25);color:#f4f4f4;font-size:12px;text-align:center;line-height:1.2;white-space:nowrap;border-radius:8px;pointer-events:none;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0)}.adsk-viewing-viewer .edit2d-label.visible{display:block}.adsk-viewing-viewer .edit2d-label-text{display:inline-block;margin:0 5px 0 5px;vertical-align:middle;font-size:16px;pointer-events:none}.adsk-viewing-viewer .edit2d-label.error-indicator{background-color:red}\n","",{version:3,sources:["webpack://./extensions/Edit2D/Edit2D.css"],names:[],mappings:"AACA,uCAEI,qBAAgC,CACnC,iCAGG,iBAAkB,CAElB,wBAAyB,CACzB,2CAA4C,CAE5C,iBAAkB,CAClB,WAAY,CACZ,SAAU,CAEV,yCAA0C,CAC7C,0CAIG,qBAAgC,CACnC,mEAKG,iBAA4B,CAC/B,mCAGG,oBAAqB,CACrB,iBAAkB,CAClB,SAAU,CACV,UAAW,CACX,SAAU,CACV,QAAS,CACT,wBAAyB,CACzB,kBAAmB,CACnB,gBAAiB,CACjB,oBAAqB,CACrB,mBAAmB,CACnB,8BAA+B,CAC/B,SAAU,CACV,WAAY,CACf,wCAGG,oBAAqB,CACrB,iBAAkB,CAClB,SAAU,CACV,UAAW,CACX,SAAU,CACV,QAAS,CACT,wBAAyB,CACzB,kBAAmB,CACnB,gBAAiB,CACjB,oBAAqB,CACrB,mBAAmB,CACnB,8BAA+B,CAC/B,SAAU,CACV,WAAY,CACf,4CAIG,iBAA4B,CAC/B,sCAIG,UAAW,CACX,UAAW,CACd,mCAGG,YAAa,CACb,iBAAkB,CAElB,WAAY,CAEZ,QAAS,CACT,OAAS,CAET,mBAAoB,CAEpB,wBAAyB,CACzB,2CAA4C,CAE5C,aAAc,CACd,cAAc,CACd,iBAAkB,CAClB,eAAgB,CAChB,kBAAmB,CAEnB,iBAAkB,CAClB,mBAAoB,CACpB,cAAe,CACf,SAAU,CAEV,yCAA0C,CAC7C,2CAGG,aAAc,CACjB,wCAGG,oBAAqB,CACrB,kBAAmB,CACnB,qBAAsB,CACtB,cAAe,CACf,mBAAoB,CACvB,mDAKE,oBAAqB",sourcesContent:["\n.adsk-viewing-viewer .edge-gizmo:hover\n{\n    background-color: rgb(0, 255, 0);\n}\n\n.adsk-viewing-viewer .edge-gizmo {\n    position: absolute;\n\n    background-color: #009bff;\n    box-shadow: 0px 1px 3px 1px rgba(0,0,0,0.25);\n\n    border-radius: 8px;\n    cursor: move;\n    z-index: 1; /* Place above the viewer but below the measure labels, which are at 2 */\n\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\n}\n\n.adsk-viewing-viewer .edge-gizmo.selected\n{\n    background-color: rgb(0, 255, 0);\n}\n\n\n.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover\n{\n    border-color: rgb(0, 255, 0);\n}\n\n.adsk-viewing-viewer .vertex-gizmo {\n    display: inline-block;\n    position: absolute;\n    width: 7px;\n    height: 7px;\n    left: -2px;\n    top: -2px;\n    background-color: #009bff;\n    border-style: solid;\n    border-width: 2px;\n    border-color: #FFFFFF;\n    border-radius:100px;\n    box-shadow: 0 2px 5px 0 #182A3D;\n    z-index: 1; /* Place above the viewer but below the measure labels, which are at 2 */\n    cursor: move;\n}\n\n.adsk-viewing-viewer .ellipse-arc-gizmo {\n    display: inline-block;\n    position: absolute;\n    width: 5px;\n    height: 5px;\n    left: -1px;\n    top: -1px;\n    background-color: #ff00ff;\n    border-style: solid;\n    border-width: 1px;\n    border-color: #000000;\n    border-radius:100px;\n    box-shadow: 0 2px 5px 0 #182A3D;\n    z-index: 2; /* Must always be in front of the EdgeMove gizmo. Otherwise it would become unreachable on low radii.*/\n    cursor: move;\n}\n\n.adsk-viewing-viewer .vertex-gizmo.selected\n{\n    border-color: rgb(0, 255, 0);\n}\n\n.adsk-viewing-viewer .edge-move-gizmo\n{\n    width: 20px; /* width along the edge */\n    height: 6px; /* height vertical to the edge */\n}\n\n.adsk-viewing-viewer .edit2d-label {\n    display: none;\n    position: absolute;\n\n    height: 19px;\n\n    left: 0px;\n    top:  0px;\n\n    padding: 2px 0 2px 0;\n\n    background-color: #009bff;\n    box-shadow: 0px 1px 3px 1px rgba(0,0,0,0.25);\n\n    color: #f4f4f4;\n    font-size:12px;\n    text-align: center;\n    line-height: 1.2;\n    white-space: nowrap;\n\n    border-radius: 8px;\n    pointer-events: none;\n    cursor: pointer;\n    z-index: 2;\n\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\n}\n\n.adsk-viewing-viewer .edit2d-label.visible {\n    display: block;\n}\n\n.adsk-viewing-viewer .edit2d-label-text {\n    display: inline-block;\n    margin: 0 5px 0 5px;\n    vertical-align: middle;\n    font-size: 16px;\n    pointer-events: none;\n}\n\n/* Mark area labels for invalid shapes with red background */\n.adsk-viewing-viewer .edit2d-label.error-indicator\n{\n   background-color: red;\n}\n"],sourceRoot:""}]);const a=s},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",i=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),i&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),i&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,i,n,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);i&&s[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),t.push(c))}},t}},87537:e=>{"use strict";e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(n," */"),s=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[t].concat(s).concat([o]).join("\n")}return[t].join("\n")}},68312:(e,t,r)=>{"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}r.r(t),r.d(t,{default:()=>Do});var s=1,a=Autodesk.Viewing,l=function(){function e(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,e),a.EventDispatcher.prototype.apply(this),this.viewer=t,this.options=i,this.group=new THREE.Group,i.useSceneAfter?this.viewer.sceneAfter.add(this.group):(this.scene=new THREE.Scene,this.scene.add(this.group)),this.shapes=[],this.canvasGizmos=[],this.id=s++;var o=null,l=1,u={width:0,height:0};this.context=new Autodesk.Extensions.CompGeom.LmvCanvasContext(u,l,this._processMesh.bind(this),o),this.context.addContextCurrentTransform(),this.setGlobalManager(t.globalManager),this.autoUpdate=!0,this.toPageUnits=l,this.styleModifiers=[],this.onCameraChange=function(){return r.updateCanvasGizmos()},this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onCameraChange),this.context.setTessParams({numIterations:100,minSegLenFraction:.01}),this.layerToWorld=new THREE.Matrix4,this.worldToLayer=new THREE.Matrix4,this.tmp_pWorld=new THREE.Vector3,this.tmp_p0=new THREE.Vector2,this.tmp_p1=new THREE.Vector2,this.tmp_ray=new THREE.Ray,this.tmp_box=new THREE.Box2,this.is3d=!1,this.plane=new THREE.Plane,this._updatePlane(),this.enableCutplanes=!0,this.overlayCamera=void 0}var t,r;return t=e,r=[{key:"dtor",value:function(){this._clearScene(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onCameraChange)}},{key:"addShape",value:function(t){this.shapes.push(t),this.dispatchEvent({type:e.SHAPE_ADDED,shape:t}),this._onModified()}},{key:"addShapes",value:function(e){var t=this;e.forEach((function(e){return t.addShape(e)}))}},{key:"hasShape",value:function(e){return-1!==this.shapes.indexOf(e)}},{key:"removeShape",value:function(t){var r=this.shapes.indexOf(t);return-1!==r&&(this.shapes.splice(r,1),this.dispatchEvent({type:e.SHAPE_REMOVED,shape:t}),this._onModified(),!0)}},{key:"removeShapes",value:function(e){var t=this;e.forEach((function(e){return t.removeShape(e)}))}},{key:"clear",value:function(){this.shapes.length=0,this.dispatchEvent({type:e.LAYER_CLEARED}),this._onModified()}},{key:"update",value:function(){this._clearScene();for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e];if(t.visible){var r=this._getOverrideStyle(t);t.draw(this.context,r)}}this.context.flushBuffer(0,!0),this.viewer.impl.invalidate(this.options.useSceneAfter,!1,!this.options.useSceneAfter),this.updateCanvasGizmos()}},{key:"updateCanvasGizmos",value:function(){for(var e=0;e<this.canvasGizmos.length;e++)this.canvasGizmos[e].update()}},{key:"addCanvasGizmo",value:function(e){this.canvasGizmos.push(e)}},{key:"removeCanvasGizmo",value:function(e){var t=this.canvasGizmos.indexOf(e);return-1!==t&&(this.canvasGizmos.splice(t,1),!0)}},{key:"getViewport",value:function(){return this.viewport}},{key:"hitTest",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=this.shapes.length-1;i>=0;i--){var n=this.shapes[i];if(n.visible){var o=this.getLineHitRadius(n,r),s=this.tmp_box.makeEmpty();if(s.min.set(e-o,t-o),s.max.set(e+o,t+o),n.updateBBox(),n.bbox.isIntersectionBox(s)&&n.hitTest(e,t,o))return n}}}},{key:"getLineHitRadius",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=this.getUnitsPerPixel(),i=(e.style.isScreenSpace?r:1)*e.style.lineWidth;return Math.max(i,t*r)}},{key:"addStyleModifier",value:function(e){this.styleModifiers.push(e),this._onModified()}},{key:"removeStyleModifier",value:function(e){var t=this.styleModifiers.indexOf(e);return-1!=t&&(this.styleModifiers.splice(t,1),this._onModified(),!0)}},{key:"layerToCanvas",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=this.tmp_pWorld.set(e,t,0).applyMatrix4(this.layerToWorld),n=this.viewer.impl.worldToClient(i,this.overlayCamera);return r.set(n.x,n.y,0)}},{key:"getPixelsPerUnit",value:function(){var e=this.getWindow(),t=this.layerToCanvas(0,0,this.tmp_p0),r=this.layerToCanvas(1,0,this.tmp_p1);return t.distanceTo(r)/e.devicePixelRatio}},{key:"getUnitsPerPixel",value:function(){return 1/this.getPixelsPerUnit()}},{key:"canvasToLayer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=this.viewer.impl.clientToViewport(e,t),n=this.viewer.impl.viewportToRay(i,this.tmp_ray,this.overlayCamera),o=n.intersectPlane(this.plane,this.tmp_pWorld);return o?(o.applyMatrix4(this.worldToLayer),r.set(o.x,o.y,0)):r.set(0,0)}},{key:"enumShapes",value:function(e,t){for(var r=0;r<this.shapes.length;r++){var i=this.shapes[r];i.updateBBox(),e.isIntersectionBox(i.bbox)&&t(i)}}},{key:"enumMeshes",value:function(e,t){for(var r=0;r<this.group.children.length;r++){var i=this.group.children[r],n=i.geometry.boundingBox;e.isIntersectionBox(n)&&t(i)}}},{key:"findShapeById",value:function(e){return this.shapes.find((function(t){return t.id==e}))}},{key:"setMatrix",value:function(e){this.layerToWorld.copy(e),this.worldToLayer.copy(e).invert(),this._updatePlane()}},{key:"setCutPlanesEnabled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e!=this.enableCutplanes&&(this.enableCutplanes=e,this.update())}},{key:"_processMesh",value:function(e){var t={mesh:e,is2d:!0,packId:"0",meshIndex:0};Autodesk.Viewing.Private.BufferGeometryUtils.meshToGeometry(t);var r=t.geometry,i=this.viewer.impl.getMaterials(),n=i.create2DMaterial(null,e.material),o=i.findMaterial(null,n);this.enableCutplanes||(o.cutplanes=void 0,o.doNotCut=!0);var s=new THREE.Mesh(r,o);s.matrix=this.layerToWorld,s.matrixAutoUpdate=!1,this.group.children.push(s)}},{key:"_onModified",value:function(){this.autoUpdate&&this.update()}},{key:"_getOverrideStyle",value:function(e){for(var t=e.style,r=0;r<this.styleModifiers.length;r++)t=(0,this.styleModifiers[r])(e,t)||t;return t}},{key:"_clearScene",value:function(){for(var e=this.group.children,t=0;t<e.length;t++)e[t].geometry.dispose();this.group.children.length=0}},{key:"_updatePlane",value:function(){this.plane.normal.set(0,0,1),this.plane.constant=0,this.plane.applyMatrix4(this.layerToWorld)}},{key:"setOverlayCamera",value:function(e){this.overlayCamera=e}}],r&&o(t.prototype,r),e}();function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}a.GlobalManagerMixin.call(l.prototype),l.SHAPE_ADDED="shapeAdded",l.SHAPE_REMOVED="shapeRemoved",l.LAYER_CLEARED="layerCleared";var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.shapes=[]}var t,r;return t=e,(r=[{key:"clear",value:function(){this.shapes=[],this._dispatchContentChangedEvent(this.shapes)}},{key:"hasShapes",value:function(){return 0!==this.shapes.length}},{key:"postShapes",value:function(e){this.shapes=e.map((function(e){return e.clone()})),this._dispatchContentChangedEvent(e)}},{key:"cloneShapes",value:function(){return this.shapes.map((function(e){return e.clone()}))}},{key:"_dispatchContentChangedEvent",value:function(t){this.dispatchEvent({type:e.CONTENT_CHANGED,shapes:t})}}])&&u(t.prototype,r),e}();c.CONTENT_CHANGED="CONTENT_CHANGED";var h,d=new THREE.Vector2,p=new THREE.Vector2,f=function(e,t,r){var i=(e.x-t.x)*r.x+(e.y-t.y)*r.y;e.set(t.x+i*r.x,t.y+i*r.y)},g=(h=new THREE.Vector2,function(e,t,r){return f(h.copy(e),t,r),e.distanceTo(h)}),v=function(e,t,r,i){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=r.x-t.x,s=r.y-t.y,a=Math.sqrt(o*o+s*s),l={v1:t,dx:o,dy:s,length:a,length2:a*a};return Autodesk.Extensions.CompGeom.pointOnLine(e.x,e.y,l,n,i)},y=function(e,t,r){return Math.abs(e-t)<r},m={getEdgeDirection:function(e,t,r){return(r=r||new THREE.Vector2).copy(t).sub(e).normalize()},projectToLine:f,pointLineDistance:g,intersectLines:function(e,t,r,i,n){var o=i.y*t.x-i.x*t.y;if(Math.abs(o)<1e-8)return!1;var s=e.x-r.x,a=e.y-r.y,l=i.x*a-i.y*s;return n&&(n.x=e.x+l/o*t.x,n.y=e.y+l/o*t.y),!0},rotateAround:function(e,t,r){var i=Math.cos(t),n=Math.sin(t);r&&e.sub(r);var o=e.x,s=e.y;return e.x=o*i-s*n,e.y=o*n+s*i,r&&e.add(r),e},angleBetweenDirections:function(e,t){var r=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return r<0&&(r+=2*Math.PI),r},getEdgeCenter:function(e,t,r){return(r=r||new THREE.Vector2).set(.5*(e.x+t.x),.5*(e.y+t.y))},getEdgeLength:function(e,t){var r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)},turnLeft:function(e){var t=e.x;return e.x=-e.y,e.y=t,e},isPointOnEdge:v,isPointOnLine:function(e,t,r,i){return v(e,t,r,i,!1)},pointDelta:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i={x:t.x-e.x,y:t.y-e.y};if(r){var n=Math.pow(10,r);i.x=Math.round(i.x*n)/n,i.y=Math.round(i.y*n)/n}if(i.x||i.y)return i},edgeIsDegenerated:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10;return e.distanceToSquared(t)<r},mirrorPointOnPoint:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(r=r||new THREE.Vector2).x=t.x-(e.x-t.x),r.y=t.y-(e.y-t.y),r},fuzzyEqual:y,collinear:function(e,t,r,i,n){var o=y(t.x,i.x,n)&&y(t.y,i.y,n),s=y(t.x,-i.x,n)&&y(t.y,-i.y,n);if(!o&&!s)return!1;var a=r.x-e.x,l=r.y-e.y,u=a*t.x+l*t.y;return Math.abs(u)<n},distance2D:function(e,t){var r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)},changesOrientation:function(e){return e.determinant()<0},getFitToBoxTransform:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Matrix4,n=e.size(d),o=t.size(p),s=o.x/n.x,a=o.y/n.y;r.preserveAspect&&(a=s=Math.min(s,a));var l=e.min.x,u=e.min.y;r.flipY&&(a*=-1,u=e.max.y);var c=-s*l+t.min.x,h=-a*u+t.min.y,f=i.makeScale(s,a,1);return f.elements[12]=c,f.elements[13]=h,f}};function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}var E=null,x="http://www.w3.org/2000/svg",b=Math.pow(10,4),A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||null===t)return e;var r=4===t?b:Math.pow(10,t);return Math.round(e*r)/r},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return'<circle cx="'.concat(A(e.centerX,t),'" cy="').concat(A(e.centerY,t),'" r="').concat(A(e.radius,t)).concat(r,'"/>')},T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e.vertexCount)return[];for(var i=function(e){return A(e,r)},n=[],o=new THREE.Vector2,s=new THREE.Vector2,a=new Se,l=new THREE.Vector2,u=new THREE.Vector2,c=e.loopCount,h=0;h<c;h++){var d=e.getEdgeCount(h);d>0&&(o=e.getPoint(0,h,o),n.push("M ".concat(i(o.x),",").concat(i(o.y))));for(var p=0;p<d;p++){var f=p,g=e.isPath()?e.getEdgeType(f,h):Ee.Line,v=e.nextIndex(f,h);o=e.getPoint(v,h,o);var y="";switch(g){case Ee.Ellipse:var _=(a=e.getEllipseArcParams(f,h,a)).largeArcFlag?1:0,E=a.sweepFlag?1:0;y="A ".concat(a.rx,",").concat(a.ry,",").concat(a.rotation,",").concat(_,",").concat(E,",").concat(o.x,",").concat(o.y);break;case Ee.Bezier:l=e.getControlPoint(f,1,h,l),u=e.getControlPoint(f,2,h,u),y="C ".concat(i(l.x,r),",").concat(i(l.y,r),",").concat(i(u.x,r),",").concat(i(u.y,r),",").concat(i(o.x,r),",").concat(i(o.y,r));break;default:s=e.getPoint(p,h,s);var x=m.pointDelta(s,o,r);if(!x)continue;y=Math.abs(x.x)<=t?"V ".concat(i(o.y)):Math.abs(x.y)<=t?"H ".concat(i(o.x)):"L ".concat(i(o.x),",").concat(i(o.y))}var b=0===v;b&&g===Ee.Line||n.push(y)}e.isClosed&&n.push("Z")}return n},P=function(e){var t={};return t.stroke=e.lineColor,t.fill=e.fillColor,t["stroke-width"]=e.lineWidth,1!=e.lineAlpha&&(t["stroke-opacity"]=e.lineAlpha),1!=e.fillAlpha&&(t["fill-opacity"]=e.fillAlpha),t},R=function(e){var t="";for(var r in e)t+=" ".concat(r,'="').concat(e[r],'"');return t},S=function(e,t){var r=t&&t.precision||0,i=t&&t.digits||0,n=t&&t.exportStyle||!0;if(e instanceof ve){var o=document.createElementNS(x,"path");return o.setAttribute("d",T(e,r,i)),n&&function(e,t){for(var r in t)e.setAttribute(r,t[r])}(o,P(e.style)),o}console.error("SVG serialization not supported for this shape: ",e)},V={toSvg:function(e,t){var r=t&&t.precision||0,i=t&&t.digits||null,n=t&&t.exportStyle||!1,o="";if(n){var s=P(e.style);o=R(s)}if("object"!==_(t)&&("number"==typeof arguments[1]&&(r=arguments[1]),"number"==typeof arguments[2]&&(i=arguments[2])),e instanceof Le)return C(e,i,o);if(e instanceof ve){var a=T(e,r,i);return'<path d="'.concat(a.join(" "),'"').concat(o,"/>")}console.error("SVG serialization not supported for this shape: ",e)},fromSvg:function(e){if(e){var t=(E=E||new DOMParser).parseFromString(e,"application/xml");if(1!==t.childNodes.length)throw"Function does only support svg with a single element: path, circle";var r=t.firstChild;if("circle"===r.nodeName)return function(e){if(!e.hasAttributes||!e.hasAttributes())throw"No attributes available on the <circle/> node";for(var t=new Le,r=e.attributes.length-1;r>=0;r--){var i=e.attributes[r];switch(i.name){case"cx":t.centerX=parseFloat(i.value);break;case"cy":t.centerY=parseFloat(i.value);break;case"r":t.radius=parseFloat(i.value)}}return t}(r);if("path"===r.nodeName)return function(e){var t=e.getAttribute("d");if(t)return function(e){for(var t=e.split(/ (?=[a-zA-Z])/gi),r=new Se,i=new THREE.Vector2,n=0,o=new Ve,s=0;s<t.length;s++){var a=t[s];if(-1==="MLHVCZA".indexOf(a[0]))throw'"'.concat(a[0],'" is not a supported or invalid glyph: ').concat(a);var l=o.getVertexCount(n)-1,u=a.substring(1);switch(a[0]){case"M":n=o.nextFreeLoop();case"L":var c=u.split(",");i.x=parseFloat(c[0]),i.y=parseFloat(c[1]);break;case"H":i.x=parseFloat(u);break;case"V":i.y=parseFloat(u);break;case"C":var h=u.split(",");i.x=parseFloat(h[4]),i.y=parseFloat(h[5]);var d=parseFloat(h[0]),p=parseFloat(h[1]),f=parseFloat(h[2]),g=parseFloat(h[3]);l>=0?o.setBezierArc(l,d,p,f,g,n):console.error('SVG Parse error: Path is not expected to start with "C" command');break;case"A":var v=u.split(",");i.x=parseFloat(v[5]),i.y=parseFloat(v[6]),r.rx=parseFloat(v[0]),r.ry=parseFloat(v[1]),r.rotation=parseFloat(v[2]),r.largeArcFlag=Boolean(parseFloat(v[3])),r.sweepFlag=Boolean(parseFloat(v[4])),l>=0?o.setEllipseArc(l,r,n):console.error('SVG Parse error: Path is not expected to start with "A" command');break;case"Z":o.isClosed=!0;continue}o.addPoint(i.x,i.y,n)}return function(e){if(e.isClosed)for(var t=new THREE.Vector2,r=new THREE.Vector2,i=e.loopCount,n=0;n<i;n++){var o=e.getVertexCount(n)-1;o<1||(t=e.getPoint(0,n,t),r=e.getPoint(o,n,r),m.pointDelta(t,r,0)||e.removePoint(o,n))}}(o),o}(t)}(r);throw"Unsupported svg node type: ".concat(r.nodeName)}},createSvgShape:S,createSvgElement:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new THREE.Box2;e.forEach((function(e){return r.union(e.getBBox())}));var i=t.srcBox||r,n=t.dstBox||r,o={preserveAspect:!0,flipY:!0},s=m.getFitToBoxTransform(i,n,o),a=n.max.x-n.min.x,l=n.max.y-n.min.y,u=document.createElementNS(x,"svg");return u.setAttribute("height",a),u.setAttribute("width",l),e.forEach((function(e){var r=e.clone().applyMatrix4(s),i=S(r,t);u.appendChild(i)})),u}},w=r(32230),M=new THREE.Vector3,L=new THREE.Vector3,O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new THREE.Vector3;return t.set(e[0],e[1],e[2])},k=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=e.getVertexCount(r);if(0==n){var o=t.getStartVertex().getPosition();e.addPoint(o[0],o[1],r)}if(!i){var s=t.getEndVertex().getPosition();e.addPoint(s[0],s[1],r)}var a=t instanceof w.Coedge,l=a?t.getEdge():t,u=!!a&&t.isReversed(),c=l.isReversed(),h=u!==c,d=l.getCurveType();if(d!==w.GEOMETRY_TYPES.LINE){var p=Math.max(n-1,0),f=l.getCurve();if(d!==w.GEOMETRY_TYPES.BCURVE){if(d===w.GEOMETRY_TYPES.ELLIPSE){var g=new Se;g.rx=f.getMajorRadius(),g.ry=f.getMinorRadius();var v=f.getMajorAxis(),y=Math.atan2(v[1],v[0]);g.rotation=THREE.Math.radToDeg(y);var m=t.getRange(),_=m[0],E=m[1];g.largeArcFlag=E-_>Math.PI,g.sweepFlag=!h;var x=f.getMinorAxis(),b=O(v,M),A=O(x,L),C=b.cross(A).z<0;return C&&(g.sweepFlag=!g.sweepFlag),void e.setEllipseArc(p,g,r)}console.error("Unexpected curve type")}else{var T=t.t0(),P=t.t1(),R=t.evaluatePosition(T),S=t.evaluatePosition(P),V=t.evaluateDt(T),k=t.evaluateDt(P),I=Math.abs(P-T);V[0]*=I,V[1]*=I,k[0]*=I,k[1]*=I;var F=R[0]+V[0]/3,N=R[1]+V[1]/3,D=S[0]-k[0]/3,B=S[1]-k[1]/3;e.setBezierArc(p,F,N,D,B,r)}}},I=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new we,r=t.nextFreeLoop(),i=e.getCoedges(),n=0;n<i.length;n++){var o=i[n],s=n==i.length-1;k(t,o,r,s)}return t},F=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new we;return e.getLoops().forEach((function(e){t=I(e,t)})),t},N=function(e){var t=new Ve;t.isClosed=e.isClosed();for(var r=e.getOrderedEdges().edges,i=0;i<r.length;i++){var n=r[i],o=e.isClosed()&&i==r.length-1;k(t,n,0,o)}return t},D={addCoedge:k,loopToShape:I,faceToShape:F,facesToShape:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new we;return e.forEach((function(e){t=F(e,t)})),t},wireToShape:N,pathToShape:function(e){var t=e.getWireBody().getWires();if(0==t.length)return new Ve;for(var r=N(t[0]),i=1;i<t.length;i++){var n=t[i],o=N(n);r.addLoop(o,0)}return r},toSolidDefPath:function(e){var t=new w.Path2D;return Te(t,e),t}};function B(e){throw new Error('"'+e+'" is read-only')}function z(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var U=function(e,t){var r=e.getFaces(),i=(0,w.getRegionEdges)(e,t);return(0,w.getBoundedRegionFaces)(r,i)},G=function(e){for(var t=0;t<e.length;t++)for(var r=e[t],i=t+1;i<e.length;i++)for(var n=e[i],o=(0,w.computeCurveCurveIntersections)(r,n,!1,!0),s=0;s<o.length;s++){var a=o[s],l=a.cutInfo.param,u=a.cutByInfo.param,c=r.getRange(),h=n.getRange(),d=Math.min(Math.abs(l-c[0]),Math.abs(l-c[1])),p=Math.min(Math.abs(u-h[0]),Math.abs(u-h[1]));if(Math.max(d,p)>1e-5)return!0}return!1},Y=function(e,t){var r,i=!1,n=!1,o=!1,s=function(r){var s=e.has(r),a=t.has(r);s&&a?i=!0:s?n=!0:a&&(o=!0)},a=z(e);try{for(a.s();!(r=a.n()).done;)s(r.value)}catch(e){a.e(e)}finally{a.f()}var l,u=z(t);try{for(u.s();!(l=u.n()).done;)s(l.value)}catch(e){u.e(e)}finally{u.f()}return i?n&&!o?0:o&&!n?1:n||o?3:4:2};function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function H(e,t,r){return H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Q(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},H(e,t,r||e)}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}function W(e,t){return W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},W(e,t)}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=Q(e);if(t){var n=Q(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return J(this,r)}}function J(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?Z(e):t}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e){return Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Q(e)}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function te(e,t,r){return t&&ee(e.prototype,t),r&&ee(e,r),e}var re=1,ie=Autodesk.Viewing,ne=function(e,t,r){return"rgb("+e+","+t+","+r+")"},oe=function(e){return e.map((function(e){return{x:e.x,y:e.y}}))},se={numIterations:100,minSegLenFraction:.01},ae=new THREE.Vector3,le=new THREE.Vector3,ue=new THREE.Box2,ce=new THREE.Vector2,he=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$(this,e),this.lineColor=t.lineColor||t.color||"rgb(0,0,128)",this.lineAlpha=void 0!==t.lineAlpha?t.lineAlpha:void 0!==t.alpha?t.alpha:1,this.lineWidth=void 0!==t.lineWidth?t.lineWidth:3,this.fillColor=t.fillColor||t.color||"rgb(0,0,128)",this.fillAlpha=void 0!==t.fillAlpha?t.fillAlpha:void 0!==t.alpha?t.alpha:.2,this.lineStyle=t.lineStyle||0,this.isScreenSpace=void 0===t.isScreenSpace||t.isScreenSpace,this.compositeOperation="source-over"}return te(e,[{key:"setFillColor",value:function(e,t,r){this.fillColor=ne(e,t,r)}},{key:"setLineColor",value:function(e,t,r){this.lineColor=ne(e,t,r)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.lineColor=e.lineColor,this.lineAlpha=e.lineAlpha,this.lineWidth=e.lineWidth,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.lineStyle=e.lineStyle,this.isScreenSpace=e.isScreenSpace,this.compositeOperation=e.compositeOperation,this}}]),e}();he.toColor=ne;var de=new he,pe=function(e,t){for(var r=0;r<e.length;r++)t.expandByPoint(e[r])},fe=function(e){q(r,e);var t=X(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de.clone();return $(this,r),(e=t.call(this)).style=i,e.id=re++,e.bbox=new THREE.Box2,e.bboxDirty=!0,e.visible=!0,e.movable=!0,e.selectable=!0,e.name=e.id.toString(),e}return te(r,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"applyMatrix4",value:function(e){return this}},{key:"clone",value:function(){return(new r).copy(this)}},{key:"copy",value:function(e){return this.style=e.style.clone(),this}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0,this.fireEvent({type:r.Events.MODIFIED})}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}},{key:"getBBox",value:function(){return this.updateBBox(),this.bbox}},{key:"toSVG",value:function(e,t){return V.toSvg(this,e,t)}},{key:"createSvgShape",value:function(e){return V.toSvgElement(this,e)}},{key:"setVisible",value:function(e){this.visible=e}}],[{key:"fromSVG",value:function(e){return V.fromSvg(e)}}]),r}(ie.EventDispatcher);fe.Events={MODIFIED:"modified"},ie.GlobalManagerMixin.call(fe.prototype);var ge={Empty:0,Inner:1,Outer:2,Overlapping:3},ve=function(e){q(r,e);var t=X(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:de.clone();return $(this,r),(e=t.call(this,n))._loops=i?[i]:[],e.isClosed=void 0,e._loopInfos=null,e}return te(r,[{key:"allocPoints",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<e;++r)this.addPoint(0,0,t);return this}},{key:"isPolygon",value:function(){return this.isClosed}},{key:"isPolyline",value:function(){return!this.isClosed}},{key:"isPath",value:function(){return this instanceof Ve}},{key:"addPoint",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._loops[r]||(this._loops[r]=[]),n={x:e,y:t};return i.push(n),this.modified(),n}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2;return"object"===K(t)&&(r=t,t=0),r.copy(this._loops[t][e])}},{key:"removePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._loops[t].splice(e,1)}},{key:"updatePoint",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this._loops[i][e];n.x=t,n.y=r,this.modified()}},{key:"insertPoint",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._loops[r].splice(e,0,t)}},{key:"getVertexCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._loops[e];return t?t.length:0}},{key:"clear",value:function(){this._loops=[],this.modified()}},{key:"enumEdges",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.getEdgeCount(t),i=0;i<r;i++){var n=i,o=this.nextIndex(i,t),s=this.getPoint(n,t),a=this.getPoint(o,t),l=e(s,a,n,o);if(l)return}}},{key:"findEdgeIndex",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=-1,n=function(r,n,o){var s=m.isPointOnEdge(e,r,n,t);return s&&(i=o),s};return this.enumEdges(n,r),i}},{key:"moveLoop",value:function(e,t,r){for(var i=this._loops[r],n=0;n<i.length;n++)i[n].x+=e,i[n].y+=t;this.modified()}},{key:"move",value:function(e,t){for(var r=0;r<this.loopCount;r++)this.moveLoop(e,t,r);return this}},{key:"applyMatrix4",value:function(e){for(var t=0;t<this.loopCount;t++)for(var r=this._loops[t],i=0;i<r.length;i++){var n=r[i],o=function(t,r,i){var n=ae.set(t,r,0).applyMatrix4(e);return i.x=n.x,i.y=n.y,i};if(o(n.x,n.y,n),this.isBezierArc(i,t)){var s=o(n.cp1x,n.cp1y,ae);n.cp1x=s.x,n.cp1y=s.y,s=o(n.cp2x,n.cp2y,ae),n.cp2x=s.x,n.cp2y=s.y}this.isEllipseArc(i,t)&&n.ellipseArcParams.applyMatrix4(e)}return this.modified(),this}},{key:"addLoop",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=e._loops[r],o=oe(n);return-1===i?(t=this.nextFreeLoop(),this._loops[t]=o):(t=i,this._loops.splice(t,0,o)),this.modified(),t}},{key:"copyGeometry",value:function(e){this.isClosed=e.isClosed,this._loops=[];for(var t=0;t<e.loopCount;t++)this.addLoop(e,t);return this}},{key:"copy",value:function(e){return H(Q(r.prototype),"copy",this).call(this,e),this.copyGeometry(e)}},{key:"computeBBox",value:function(){this.bbox.makeEmpty();for(var e=0;e<this.loopCount;e++){var t=this._loops[e];t&&pe(t,this.bbox)}return this.bbox}},{key:"indexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e>=0&&e<this.getVertexCount(t)}},{key:"nextIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return-1;var r=e===this.getVertexCount(t)-1;return r?this.isClosed?0:-1:e+1}},{key:"prevIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return-1;if(0===e){var r=this.getVertexCount(t);return this.isClosed?r-1:-1}return e-1}},{key:"edgeBeforeVertex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.prevIndex(e,t)}},{key:"edgeAfterVertex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)?e:-1}},{key:"nextEdgeIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&(this.isClosed||e!==this.getEdgeCount(t)-1)?this.nextIndex(e,t):-1}},{key:"prevEdgeIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&(this.isClosed||0!==e)?this.prevIndex(e,t):-1}},{key:"edgeIndexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.getEdgeCount(t);return e>=0&&e<r}},{key:"prevEdgeExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.getVertexCount(t);return this.edgeIndexValid(e,t)&&r>2&&(e>0||this.isClosed)}},{key:"nextEdgeExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.getVertexCount(t),i=e===r-2;return this.edgeIndexValid(e,t)&&r>2&&(!i||this.isClosed)}},{key:"getEdge",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=e,o=this.nextIndex(e,i);this.getPoint(n,i,t),this.getPoint(o,i,r)}},{key:"getEdgeDirection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=e,n=this.nextIndex(e,t),o=this._loops[t];return m.getEdgeDirection(o[i],o[n],r)}},{key:"getEdgeLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e,i=this.nextIndex(e,t),n=this._loops[t],o=n[r],s=n[i];return m.getEdgeLength(o,s)}},{key:"getEdgeCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.getVertexCount(e);return this.isClosed?t:t-1}},{key:"getLength",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new THREE.Vector2,i=new THREE.Vector2,n=0,o=0;o<this.getEdgeCount(t);o++)this.getEdge(o,r,i,t),e&&(e.apply(r),e.apply(i)),n+=r.distanceTo(i);return n}},{key:"fromBox2",value:function(e){return this.addPoint(e.min.x,e.min.y),this.addPoint(e.max.x,e.min.y),this.addPoint(e.max.x,e.max.y),this.addPoint(e.min.x,e.max.y),this}},{key:"getPointOnEdge",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Vector2,n=this._loops[r],o=n[e],s=n[this.nextIndex(e,r)];return i.lerpVectors(o,s,t)}},{key:"isCCW",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Autodesk.Extensions.CompGeom.polygonArea(this._loops[e])>0}},{key:"getLeftEdgeNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=this._loops[t],n=e,o=(e+1)%i.length,s=i[n],a=i[o];r.subVectors(a,s).normalize();var l=r.x;return r.x=-r.y,r.y=l,r}},{key:"getOuterNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=this.getLeftEdgeNormal(e,t,r);return this.isCCW(t)?i.multiplyScalar(-1):i}},{key:"nextFreeLoop",value:function(){var e=this._loops.findIndex((function(e){return!e||!e.length}));return e>=0?e:this.loopCount}},{key:"findVertex",value:function(e){for(var t=0;t<this.loopCount;t++)for(var r=this.getVertexCount(t),i=0;i<r;i++)if(e(i,t))return{vertexIndex:i,loopIndex:t};return null}},{key:"empty",value:function(){return!this._loops.some((function(e){return e&&e.length>0}))}},{key:"modified",value:function(){H(Q(r.prototype),"modified",this).call(this),this._loopInfos=null}},{key:"isSelfIntersecting",value:function(){var e=this._getLoopInfos();return e&&e.some((function(e){return e.error}))}},{key:"_getLoopInfos",value:function(){if(this.isClosed&&!(this.loopCount<1))return this._loopInfos||(this._loopInfos=function(e){for(var t=D.toSolidDefPath(e).getWireBody(),r=t.getWires(),n=t.getEdges(),o=[],s=0;s<r.length;s++){var a=r[s].getEdges();o[s]={containedLoops:[],rank:0,error:G(a)}}if(r.length<2)return o;var l=new w.SketchRegionSolver;l.compute(n),l.getFaces().forEach((function(e,t){return e.arrayIndex=t}));for(var u=[],c=function(e){var t=r[e].getEdges();if(G(t))return o[e].error=!0,u[e]=new Set,"continue";var i=new Set;U(l,t).forEach((function(e){i.add(e.arrayIndex)})),u[e]=i},h=0;h<r.length;h++)c(h);for(var d=0;d<u.length;d++)for(var p=u[d],f=d+1;f<u.length;f++){var g=u[f];switch(Y(p,g)){case 2:continue;case 0:o[d].containedLoops.push(f),o[f].rank++;break;case 1:o[f].containedLoops.push(f),o[d].rank++;break;default:o[d].error=!0,o[f].error=!0}}if(r.length!==e.loopCount){for(var v=[],y=0,m=0;m<e.loopCount;m++)e.getVertexCount(m)&&(v[i]=o[(B("srcIndex"),y++)]);B("loopInfos"),o=v}return o}(this)),this._loopInfos}},{key:"getLoopType",value:function(e){if(this.isClosed){if(!this.getVertexCount(e))return ge.Empty;var t=this._getLoopInfos()[e];return t.error?ge.Overlapping:1&t.rank?ge.Inner:ge.Outer}}},{key:"getChildLoops",value:function(e){var t=this._getLoopInfos(),r=t&&t[e];return r?r.containedLoops.slice():[]}},{key:"cleanupLoops",value:function(){this._loops=this._loops.filter((function(e){return e&&e.length>=0}))}},{key:"getMainLoops",value:function(){var e=this._getLoopInfos();if(!e)return[];for(var t=[],r=0;r<e.length;r++){var i=e[r];this.getLoopType(r)===ge.Outer&&0===i.rank&&t.push(r)}return t}},{key:"removeLoop",value:function(e){return this._loops.splice(e,1),this.modified(),this}},{key:"removeLoops",value:function(e){this._loops=this._loops.filter((function(t,r){return!e.includes(r)}))}},{key:"isPointFinite",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return!1;var r=this._loops[t],i=r[e];return isFinite(i.x)&&isFinite(i.y)}},{key:"isLoopFinite",value:function(e){for(var t=this._loops[e],r=t?t.length:0,i=0;i<r;i++)if(!this.isPointFinite(i,e))return!1;return!0}},{key:"points",get:function(){return this._loops[0]||(this._loops[0]=[])}},{key:"loopCount",get:function(){return this._loops.length}},{key:"length",get:function(){return console.warn("poly.length is deprecated and will be removed. Please use poly.vertexCount property instead."),this.points.length}},{key:"vertexCount",get:function(){return this.points.length}}]),r}(fe),ye=function(){function e(t){var r=t.vertex,i=void 0===r?0:r,n=t.loop,o=void 0===n?0:n;$(this,e),this.vertex=i,this.loop=o}return te(e,[{key:"equals",value:function(e){return e&&this.vertex===e.vertex&&this.loop===e.loop}}]),e}(),me=function(e){q(r,e);var t=X(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:de.clone();return $(this,r),(e=t.call(this,i,n)).isClosed=!0,e}return te(r,[{key:"draw",value:function(e,t){Pe(e,this,t)}},{key:"hitTest",value:function(e,t){if(!this.vertexCount)return!1;for(var r=0,i=0;i<this.loopCount;i++){var n=this._loops[i];if(n){for(var o=new Autodesk.Extensions.CompGeom.ComplexPolygon(n),s=[],a=0;a<n.length;a++)s.push(a);o.pointInContour(e,t,s)&&r++}}return Boolean(1&r)}},{key:"clone",value:function(){return(new r).copy(this)}},{key:"getArea",value:function(e){if(this.isClosed){for(var t=this._getLoopInfos(),r=0,i=0;i<this.loopCount;i++)if(!(this.points.length<3)){var n=t?t[i]:null,o=1&(n?n.rank:0)?-1:1,s=0;this.enumEdges((function(t,r){e&&e.apply(t),e&&e.apply(r),s+=t.x*r.y-r.x*t.y}),i),r+=o*Math.abs(.5*s)}return r}}}]),r}(ve),_e=function(e){q(r,e);var t=X(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:de.clone();return $(this,r),(e=t.call(this,i,n)).isClosed=!1,e}return te(r,[{key:"makeLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!==this.vertexCount?(this.clear(),this.addPoint(e,t),this.addPoint(r,i)):(this.updatePoint(0,e,t),this.updatePoint(1,r,i)),this}},{key:"draw",value:function(e,t){Pe(e,this,t)}},{key:"clone",value:function(){return(new r).copy(this)}},{key:"hitTest",value:function(e,t,r){return-1!==this.findEdgeIndex({x:e,y:t},r)}}]),r}(ve),Ee={Line:0,Bezier:1,Ellipse:2},xe=null,be=function(){return xe=xe||new Autodesk.Extensions.CompGeom.EllipseArc},Ae=new THREE.Vector2,Ce=function(e,t,r){var i=t._loops[r];if(i&&i.length)if(t.isLoopFinite(r)){e.moveTo(i[0].x,i[0].y);for(var n=function(i,n,o){switch(i.arcType){case Ee.Line:break;case Ee.Bezier:return void e.bezierCurveTo(i.cp1x,i.cp1y,i.cp2x,i.cp2y,n.x,n.y);case Ee.Ellipse:var s=i.ellipseArcParams,a=t.exportEllipseArc(o,r,be());if(!a.isValid())break;return void(e.ellipseArcTo?e.ellipseArcTo(s.rx,s.ry,THREE.Math.degToRad(s.rotation),s.largeArcFlag,s.sweepFlag,n.x,n.y):e.ellipse(a.cx,a.cy,a.rx,a.ry,a.rotation,a.startAngle,a.endAngle,a.ccw))}e.lineTo(n.x,n.y)},o=1;o<i.length;o+=1)n(i[o-1],i[o],o-1);t.isClosed&&(n(i[i.length-1],i[0],i.length-1),e.closePath())}else console.warn("Skipped loop, because it contains Inf or NaN values. Shape ID: ".concat(t.id,". LoopIndex: ").concat(r))},Te=function(e,t){for(var r=0;r<t.loopCount;r++)Ce(e,t,r)},Pe=function(e,t,r){if(t.vertexCount){var i=r||t.style,n=e.canvasContext;e.dbId=t.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace;var o=n.globalCompositeOperation;if(i.compositeOperation&&(n.globalCompositeOperation=i.compositeOperation,e.flushBuffer(0,!0)),e.beginPath(),Te(e,t),t.isClosed){if(n.fillStyle=i.fillColor,i.fillColor.hasOwnProperty("colorStops")){var s=e.createGradientData(i.fillColor).getFillStyle(n);n.fillStyle=s}n.globalAlpha=i.fillAlpha,e.fill()}n.strokeStyle=i.lineColor,n.globalAlpha=i.lineAlpha,n.lineWidth=i.lineWidth,i.isScreenSpace&&(n.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1,n.globalCompositeOperation=o}},Re=function(){function e(){$(this,e),this.cp1x=0,this.cp1y=0,this.cp2x=0,this.cp2y=0}return te(e,[{key:"copy",value:function(e){return this.cp1x=e.cp1x,this.cp1y=e.cp1y,this.cp2x=e.cp2x,this.cp2y=e.cp2y,this}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}(),Se=function(){function e(){$(this,e),this.rx=0,this.ry=0,this.rotation=0,this.largeArcFlag=!1,this.sweepFlag=!1}return te(e,[{key:"copy",value:function(e){return this.rx=e.rx,this.ry=e.ry,this.rotation=e.rotation,this.largeArcFlag=e.largeArcFlag,this.sweepFlag=e.sweepFlag,this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"rotate",value:function(e){this.rotation+=e,this.rotation-=360*Math.trunc(this.rotation/360)}},{key:"scale",value:function(e){this.rx*=e,this.ry*=e}},{key:"applyMatrix4",value:function(e){ae.set(1,0,0).applyMatrix4(e),le.set(0,0,0).applyMatrix4(e);var t=ae.sub(le),r=THREE.Math.radToDeg(Math.atan2(t.y,t.x)),i=t.length();this.rotate(r),this.scale(i),m.changesOrientation(e)&&(this.sweepFlag=!this.sweepFlag,this.rotation=360-this.rotation)}}]),e}(),Ve=function(e){q(r,e);var t=X(r);function r(e){var i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:de.clone();return $(this,r),(i=t.call(this,e,o)).isClosed=n,i}return te(r,[{key:"_updateEllipseArcParams",value:function(e,t,r,i){var n=this._loops[t][e].ellipseArcParams,o=this.getEdgeDirection(e,t),s=m.getEdgeDirection(r,i),a=m.angleBetweenDirections(s,o);n.rotate(THREE.Math.radToDeg(a));var l=this.getEdgeLength(e,t),u=m.distance2D(r,i)/l;isFinite(u)&&u>0&&n.scale(u)}},{key:"updatePoint",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this._loops[i],o=n[e],s=Ae.set(t,r),a=t-o.x,l=r-o.y;if(this.isBezierArc(e,i)&&(o.cp1x+=a,o.cp1y+=l),this.isEllipseArc(e,i)){var u=this.nextIndex(e,i),c=n[u];this._updateEllipseArcParams(e,i,s,c)}var h=this.edgeBeforeVertex(e,i);if(this.edgeIndexValid(h,i)){var d=n[h];this.isBezierArc(h,i)&&(d.cp2x+=a,d.cp2y+=l),this.isEllipseArc(h,i)&&this._updateEllipseArcParams(h,i,d,s)}o.x=t,o.y=r,this.modified()}},{key:"getEdgeType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._loops[t][e].arcType;return r||Ee.Line}},{key:"setBezierArc",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i="object"===K(t);i||(t={cp1x:t,cp1y:r,cp2x:arguments.length<=3?void 0:arguments[3],cp2y:arguments.length<=4?void 0:arguments[4]},r=(arguments.length<=5?void 0:arguments[5])||0);var n=this._loops[r][e];n.arcType=Ee.Bezier,Re.prototype.copy.call(n,t),this.modified()}},{key:"getBezierArcParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Re,i=this._loops[t][e],n=i&&i.arcType===Ee.Bezier&&i;return n&&r.copy(n)}},{key:"setEllipseArc",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._loops[r][e];i.arcType=Ee.Ellipse,i.ellipseArcParams=t.clone(),this.modified()}},{key:"getEllipseArcParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Se,i=this._loops[t][e],n=i&&i.arcType===Ee.Ellipse&&i.ellipseArcParams;return n&&r.copy(n)}},{key:"exportEllipseArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new EllipseArc,i=this._loops[t],n=this.nextIndex(e,t),o=i[e],s=i[n],a=o.ellipseArcParams;return r.setFromSvgArc(a.rx,a.ry,a.rotation,a.largeArcFlag,a.sweepFlag,o,s),r}},{key:"isBezierArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this._loops[t][e].arcType===Ee.Bezier}},{key:"isEllipseArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this._loops[t][e].arcType===Ee.Ellipse}},{key:"isArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.isBezierArc(e,t)||this.isEllipseArc(e,t)}},{key:"getStartTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=t||new THREE.Vector2,i=this.points[e];return r.x=i.cp1x-i.x,r.y=i.cp1y-i.y,r}},{key:"getEndTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=t||new THREE.Vector2,i=this.nextIndex(e),n=this.points[e],o=this.points[i];return r.x=n.cp2x-o.x,r.y=n.cp2y-o.y,r}},{key:"setStartTangent",value:function(e,t){var r=this.points[e];r.cp1x=r.x+t.x,r.cp1y=r.y+t.y,this.modified()}},{key:"setEndTangent",value:function(e,t){var r=this.points[e],i=this.points[this.nextIndex(e)];r.cp2x=i.x+t.x,r.cp2y=i.y+t.y,this.modified()}},{key:"removeArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._loops[t][e];r.arcType===Ee.Bezier&&(r.cp1x=void 0,r.cp1y=void 0,r.cp2x=void 0,r.cp2y=void 0),r.ellipseArcParams&&(r.ellipseArcParams=void 0),r.arcType=Ee.Line,this.modified()}},{key:"getControlPoint",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Vector2,n=this._loops[r][e];return 1===t?(i.x=n.cp1x,i.y=n.cp1y):(i.x=n.cp2x,i.y=n.cp2y),i}},{key:"updateControlPoint",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=this._loops[n][e];1===t?(o.cp1x=r,o.cp1y=i):(o.cp2x=r,o.cp2y=i),this.modified()}},{key:"draw",value:function(e,t){Pe(e,this,t)}},{key:"toPoly",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Autodesk.Extensions.CompGeom.DefaultTessParams,r=this.isClosed?new me:new _e,i=function(i){var n={moveTo:function(e,t){return r.addPoint(e,t,i)},lineTo:function(e,t){return r.addPoint(e,t,i)},bezierCurveTo:function(e,o,s,a,l,u){var c=r._loops[i],h=c[c.length-1],d=ue.makeEmpty();d.expandByPoint(h),d.expandByPoint(ce.set(l,u)),d.expandByPoint(ce.set(e,o)),d.expandByPoint(ce.set(s,a));var p=d.size(Ae).length();Autodesk.Extensions.CompGeom.TesselateCubic(n,h.x,h.y,e,o,s,a,l,u,p,t)},ellipse:function(e,r,i,o,s,a,l,u){var c=Math.max(i,o),h=t.numIterations,d=t.minSegLenFraction*c;be().set(e,r,i,o,s,a,l,u).tesselate(n,h,d)},closePath:function(){}};Ce(n,e,i)},n=0;n<this.loopCount;n++)i(n);return r}},{key:"computeBBox",value:function(){H(Q(r.prototype),"computeBBox",this).call(this);for(var e=new THREE.Vector2,t=0;t<this.loopCount;t++)for(var i=0;i<this.getVertexCount(t);i++)if(this.isBezierArc(i,t))this.getControlPoint(i,1,t,e),this.bbox.expandByPoint(e),this.getControlPoint(i,2,t,e),this.bbox.expandByPoint(e);else if(this.isEllipseArc(i,t)){var n=this.exportEllipseArc(i,t,be());this.bbox.union(n.computeBBox(ue))}}},{key:"hitTest",value:function(e,t,r){return this.toPoly().hitTest(e,t,r)}},{key:"clone",value:function(){return(new r).copy(this)}},{key:"addLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;i=H(Q(r.prototype),"addLoop",this).call(this,e,t,i);for(var n=e._loops[t],o=this._loops[i],s=0;s<n.length;s++){var a=e.getEdgeType(s,t);if(a!==Ee.Line){var l=n[s],u=o[s];switch(u.arcType=l.arcType,a){case Ee.Bezier:u.cp1x=l.cp1x,u.cp1y=l.cp1y,u.cp2x=l.cp2x,u.cp2y=l.cp2y;break;case Ee.Ellipse:u.ellipseArcParams=l.ellipseArcParams&&l.ellipseArcParams.clone()}}}return this.modified(),this}},{key:"moveLoop",value:function(e,t,i){H(Q(r.prototype),"moveLoop",this).call(this,e,t,i);for(var n=this._loops[i],o=0;o<n.length;o++)if(this.isBezierArc(o,i)){var s=n[o];s.cp1x+=e,s.cp1y+=t,s.cp2x+=e,s.cp2y+=t}}},{key:"getArea",value:function(e){if(this.isClosed){var t=this.toPoly(se);return t._loopInfos=this._getLoopInfos(),t.getArea(e)}}},{key:"getLength",value:function(e){return this.toPoly().getLength(e)}},{key:"getPointOnEdge",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Vector2,o=this._loops[i],s=this.getEdgeType(e,i);switch(s){case Ee.Line:break;case Ee.Bezier:var a=o[e],l=o[this.nextIndex(e)];return Autodesk.Extensions.CompGeom.getCubeBezierPoint(t,a.x,a.y,a.cp1x,a.cp1y,a.cp2x,a.cp2y,l.x,l.y,n);case Ee.Ellipse:var u=this.exportEllipseArc(e,i,be());if(!u.isValid())break;return u.getPoint(t,n);default:avp.logger.error("unexpected edge type")}return H(Q(r.prototype),"getPointOnEdge",this).call(this,e,t,i,n)}},{key:"runPathCommands",value:function(e){Te(e,this)}},{key:"hasArcs",value:function(){var e=this;return Boolean(this.findVertex((function(t,r){return e.isArc(t,r)})))}}]),r}(ve),we=function(e){q(r,e);var t=X(r);function r(e,i){return $(this,r),t.call(this,e,!0,i)}return r}(Ve),Me=function(e){q(r,e);var t=X(r);function r(e,i){return $(this,r),t.call(this,e,!1,i)}return r}(Ve),Le=function(e){q(r,e);var t=X(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:de.clone(),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return $(this,r),(e=t.call(this,s)).polygon=new me([],s),e.polygon.id=e.id,e.centerX=i,e.centerY=n,e.radius=o,e.tessSegments=a,e.needsUpdate=!0,e}return te(r,[{key:"draw",value:function(e,t){this.polygon.points.length=0;for(var r=360/this.tessSegments,i=0;i<360;i+=r){var n=i*Math.PI/180,o=this.radius*Math.cos(n),s=this.radius*Math.sin(n);this.polygon.addPoint(this.centerX+o,this.centerY+s)}this.needsUpdate=!1,this.polygon.draw(e,t)}},{key:"setCenter",value:function(e,t){this.centerX=e,this.centerY=t,this.modified()}},{key:"move",value:function(e,t){return this.centerX+=e,this.centerY+=t,this.modified(),this}},{key:"hitTest",value:function(e,t){var r=e-this.centerX,i=t-this.centerY;return r*r+i*i<this.radius*this.radius}},{key:"clone",value:function(){return(new r).copy(this)}},{key:"copy",value:function(e){return H(Q(r.prototype),"copy",this).call(this,e),this.polygon=e.polygon.clone(),this.centerX=e.centerX,this.centerY=e.centerY,this.radius=e.radius,this.tessSegments=e.tessSegments,this.modified(),this}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}]),r}(fe),Oe=function(e){q(r,e);var t=X(r);function r(e){var i;return $(this,r),(i=t.call(this)).shape=e,Object.defineProperty(Z(i),"bbox",{get:function(){return i.shape.bbox},set:function(e){i.shape.bbox=e}}),Object.defineProperty(Z(i),"id",{get:function(){return i.shape.id},set:function(e){i.shape.id=e}}),Object.defineProperty(Z(i),"bboxDirty",{get:function(){return i.shape.bboxDirty},set:function(e){i.shape.bboxDirty=e}}),Object.defineProperty(Z(i),"name",{get:function(){return i.shape.name},set:function(e){i.shape.name=e}}),i}return te(r,[{key:"draw",value:function(){var e;return(e=this.shape).draw.apply(e,arguments)}},{key:"hitTest",value:function(){var e;return(e=this.shape).hitTest.apply(e,arguments)}},{key:"move",value:function(){var e;return(e=this.shape).move.apply(e,arguments)}},{key:"modified",value:function(){var e;return(e=this.shape).modified.apply(e,arguments)}},{key:"computeBBox",value:function(){var e;return(e=this.shape).computeBBox.apply(e,arguments)}},{key:"updateBBox",value:function(){var e;return(e=this.shape).updateBBox.apply(e,arguments)}},{key:"clone",value:function(){return new r(this.shape.clone())}},{key:"copy",value:function(e){this.shape.copy(e.shape)}}]),r}(fe);function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Ie(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Fe(e,t,r){return Fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Be(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},Fe(e,t,r||e)}function Ne(e,t){return Ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ne(e,t)}function De(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Be(e){return Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Be(e)}var ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ne(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Be(i);if(n){var r=Be(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return De(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).from=new THREE.Vector2,e.to=new THREE.Vector2,e.headLength=2,e.headAngle=60,e.line=new _e,e.head=new me,e.headFilled=!0,e.head.style.lineAlpha=0,e.head.addPoint(0,0),e.head.addPoint(0,0),e.head.addPoint(0,0),e.dir=new THREE.Vector2,e.tmpVec1=new THREE.Vector2,e.tmpVec2=new THREE.Vector2,e.tmpVec3=new THREE.Vector2,e}return t=s,(r=[{key:"modified",value:function(){Fe(Be(s.prototype),"modified",this).call(this),this.needsUpdate=!0}},{key:"draw",value:function(e){this.update(),this.line.draw(e,this.line.style),this.head.draw(e,this.head.style)}},{key:"move",value:function(e,t){return this.from.x+=e,this.from.y+=t,this.to.x+=e,this.to.y+=t,this.modified(),this}},{key:"hitTest",value:function(e,t){return this.update(),this.line.hitTest(e,t)||this.head.hitTest(e,t)}},{key:"clone",value:function(){return(new s).copy(this)}},{key:"setFrom",value:function(e,t,r){"object"===ke(e)?this.from.copy(e):this.from.set(e,t,r),this.modified()}},{key:"setTo",value:function(e,t,r){"object"===ke(e)?this.to.copy(e):this.to.set(e,t,r)}},{key:"setHeadLength",value:function(e){this.headLength=e,this.modified()}},{key:"setHeadAngle",value:function(e){this.headAngle=e,this.modified()}},{key:"copy",value:function(e){return Fe(Be(s.prototype),"copy",this).call(this,e),this.from=e.from.clone(),this.to=e.to.clone(),this.headLength=e.headLength,this.headAngle=e.headAngle,this.headFilled=e.headFilled,this.modified(),this}},{key:"computeBBox",value:function(){this.line.computeBBox(),this.head.computeBBox(),this.bbox.makeEmpty(),this.bbox.union(this.line.bbox),this.bbox.union(this.head.bbox)}},{key:"getLength",value:function(){return this.to.distanceTo(this.from)}},{key:"setLength",value:function(e,t){var r=this.direction,i=r.x*e,n=r.y*e;t?this.setFrom(this.to.x-i,this.to.y-n):this.setTo(this.from.x+i,this.from.y+n)}},{key:"update",value:function(){if(this.needsUpdate){var e=this.direction,t=this.to.x-(this.headFilled?e.x*this.headLength:0),r=this.to.y-(this.headFilled?e.y*this.headLength:0);this.line.makeLine(this.from.x,this.from.y,t,r);var i=this.tmpVec2.copy(e);m.turnLeft(i);var n=.5*THREE.Math.degToRad(this.headAngle),o=Math.tan(n)*this.headLength,s=this.to.x-e.x*this.headLength+i.x*o,a=this.to.y-e.y*this.headLength+i.y*o,l=this.to.x-e.x*this.headLength-i.x*o,u=this.to.y-e.y*this.headLength-i.y*o;this.head.updatePoint(0,s,a),this.head.updatePoint(1,this.to.x,this.to.y),this.head.updatePoint(2,l,u),this.needsUpdate=!1}}},{key:"direction",get:function(){return this.dir.copy(this.to).sub(this.from).normalize()}}])&&Ie(t.prototype,r),s}(fe);function je(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ue=Autodesk.Viewing,Ge=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ue.EventDispatcher.prototype.apply(this),this.stack=[],this.current=0}var t,r;return t=e,(r=[{key:"run",value:function(t){this.stack.length=this.current,this.dispatchEvent({type:e.BEFORE_ACTION,action:t}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t}),this.stack.push(t),this.current=this.stack.length}},{key:"undo",value:function(){if(!this.current)return!1;this.current--;var t=this.stack[this.current];return this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!0}),t.undo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!0}),t.layer.update(),!0}},{key:"redo",value:function(){var t=this.stack[this.current];return!!t&&(this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!1}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!1}),this.current++,t.layer.update(),!0)}},{key:"clear",value:function(){this.stack.length=0,this.current=0}}])&&je(t.prototype,r),e}();function Ye(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ge.BEFORE_ACTION="beforeAction",Ge.AFTER_ACTION="afterAction";var Ke=Autodesk.Viewing,He=function(){function e(t,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ke.EventDispatcher.prototype.apply(this),this.isSelected={},this.hoveredId=0,this.tmpStyle=new he,this.modifier=function(e,t){var r=i.isSelected[e.id],n=e.id===i.hoveredId;if(r||n)return i.tmpStyle.copy(t),r?(i.tmpStyle.fillAlpha=Math.min(i.tmpStyle.fillAlpha+.3,1),i.tmpStyle.lineWidth*=1.5):(i.tmpStyle.fillAlpha=Math.min(i.tmpStyle.fillAlpha+.2,1),i.tmpStyle.lineWidth*=1.5),i.tmpStyle},this.layer=t,this.onShapeRemoved=this.onShapeRemoved.bind(this),this.onLayerCleared=this.onLayerCleared.bind(this),this.layer.addEventListener(l.SHAPE_REMOVED,this.onShapeRemoved),this.layer.addEventListener(l.LAYER_CLEARED,this.onLayerCleared),this.layer.addStyleModifier(this.modifier),this.undoStack=r,this.onActionCb=function(e){return i.onAction(e)},this.undoStack.addEventListener(Ge.AFTER_ACTION,this.onActionCb),this.selectionFilters=[this.defaultSelectionFilter]}var t,r;return t=e,(r=[{key:"dtor",value:function(){this.layer.removeStyleModifier(this.modifier),this.undoStack.removeEventListener(Ge.AFTER_ACTION,this.onActionCb),this.undoStack.removeEventListener(l.SHAPE_REMOVED,this.onShapeRemoved),this.undoStack.removeEventListener(l.LAYER_CLEARED,this.onLayerCleared)}},{key:"addSelectionFilter",value:function(e){this.selectionFilters.push(e)}},{key:"removeSelectionFilter",value:function(e){var t=this.selectionFilters.indexOf(e);return-1!=t&&(this.selectionFilters.splice(t,1),!0)}},{key:"defaultSelectionFilter",value:function(e){return e.every((function(e){return e.selectable}))}},{key:"setSelection",value:function(e){if(e=e||[],this.selectionFilters.every((function(t){return t(e)}))){var t=!1;if(this.getSelectedShapes().length!=e.length)t=!0;else for(var r=0;r<e.length;r++){var i=e[r];this.isSelected[i.id]||(t=!0)}if(t){this.isSelected={};for(var n=0;n<e.length;n++){var o=e[n];this.isSelected[o.id]=o}this.modified()}}}},{key:"empty",value:function(){return!Object.keys(this.isSelected).length}},{key:"selectOnly",value:function(e){this.setSelection(e&&[e])}},{key:"shapeIsSelected",value:function(e){return e&&Boolean(this.isSelected[e.id])}},{key:"toggleSelection",value:function(e){var t=Boolean(this.isSelected[e.id]);this.isSelected[e.id]=t?null:e,this.modified()}},{key:"clear",value:function(){this.setSelection([])}},{key:"getSelectedShapes",value:function(){return Object.values(this.isSelected).filter(Boolean)}},{key:"getSelectedIds",value:function(){return this.getSelectedShapes().map((function(e){return e.id}))}},{key:"modified",value:function(){this.layer.update(),this.dispatchEvent({type:e.Events.SELECTION_CHANGED})}},{key:"onAction",value:function(){if(!this.empty()){var e=this.getSelectedShapes();if(1!=e.length){var t={};this.layer.shapes.forEach((function(e){return t[e.id]=!0})),e=e.filter((function(e){return t[e.id]})),this.setSelection(e)}else this.layer.findShapeById(e[0].id)||this.clear()}}},{key:"onShapeRemoved",value:function(e){var t=e.shape;this.empty()||this.isSelected[t.id]&&(delete this.isSelected[t.id],this.modified())}},{key:"onLayerCleared",value:function(){this.empty()||this.clear()}},{key:"setHoveredId",value:function(t){t!==this.hoveredId&&(this.hoveredId=t,this.layer.update(),this.dispatchEvent({type:e.Events.SELECTION_HOVER_CHANGED}))}},{key:"getFirstSelected",value:function(){var e=this.getSelectedShapes();return e.length?e[0]:null}}])&&Ye(t.prototype,r),e}();function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}He.Events={SELECTION_CHANGED:"selectionChanged",SELECTION_HOVER_CHANGED:"selectionHoverChanged"};var We={Intersect:1,Union:2,Difference:3,Xor:4},Xe=function(e,t){var r=e.getFaces();return r.forEach((function(e){return e.rank=0})),t.getWires().forEach((function(t){var r=t.getEdges();U(e,r).forEach((function(e){return e.rank++}))})),r.filter((function(e){return Boolean(1&e.rank)}))},Je={Operator:We,apply:function(e,t,r,i){var n=function(e,t,r,i){var n=e.getWireBody(),o=t.getWireBody(),s=n.getEdges(),a=o.getEdges(),l=s.concat(a);i&&i.forEach((function(e){var t,r=e.getWireBody().getEdges();l.push.apply(l,function(e){if(Array.isArray(e))return qe(e)}(t=r)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}));var u=new w.SketchRegionSolver;u.compute(l);var c=u.getFaces(),h=Xe(u,n),d=Xe(u,o),p=i&&i.map((function(e){var t=e.getWireBody();return Xe(u,t)})),f=c.filter((function(e){var t=h.includes(e),i=d.includes(e),n=p&&p.some((function(t){return t.includes(e)}));switch(r){case We.Union:return t||i||n;case We.Intersect:return t&&i;case We.Difference:return t&&!i;case We.Xor:return t!==i}}));return(0,w.mergeConnectedFaces)(f)}(D.toSolidDefPath(e),D.toSolidDefPath(t),r,i&&i.map((function(e){return D.toSolidDefPath(e)}))),o=D.facesToShape(n);return o.style.copy(e.style),o}};function Ze(e){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(e)}function Qe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}function $e(e,t){return $e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$e(e,t)}function et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=rt(e);if(t){var n=rt(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return tt(this,r)}}function tt(e,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rt(e){return rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},rt(e)}function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ot(e,t,r){return t&&nt(e.prototype,t),r&&nt(e,r),e}var st=function(){function e(t){it(this,e),this.layer=t}return ot(e,[{key:"undo",value:function(){throw new Error("Abstract method invoked")}},{key:"redo",value:function(){throw new Error("Abstract method invoked")}},{key:"getSelectionHint",value:function(e){return null}}]),e}(),at=function(e){Qe(r,e);var t=et(r);function r(e,i){var n;return it(this,r),(n=t.call(this,e)).shape=i,n}return ot(r,[{key:"undo",value:function(){this.layer.removeShape(this.shape)}},{key:"redo",value:function(){this.layer.addShape(this.shape)}},{key:"getSelectionHint",value:function(e){return e?null:{shape:this.shape}}}]),r}(st),lt=function(e){Qe(r,e);var t=et(r);function r(e,i){var n;return it(this,r),(n=t.call(this,e)).shapes=i,n}return ot(r,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}},{key:"getSelectionHint",value:function(e){return e?null:{shapes:this.shapes}}}]),r}(st),ut=function(e){Qe(r,e);var t=et(r);function r(e,i,n,o){var s;return it(this,r),(s=t.call(this,e)).shapes=i,s.delta={x:n,y:o},s.beforeState=s.shapes.map((function(e){return e.clone()})),s.afterState=s.shapes.map((function(e){return e.clone()})),s.afterState.forEach((function(e){return e.move(n,o)})),s}return ot(r,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t,r){return t.copy(e.beforeState[r])}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t,r){return t.copy(e.afterState[r])}))}},{key:"getSelectionHint",value:function(e){return{shapes:this.shapes}}}]),r}(st),ct=function(e){Qe(r,e);var t=et(r);function r(e,i){var n;return it(this,r),(n=t.call(this,e)).shape=i,n}return ot(r,[{key:"undo",value:function(){this.layer.addShape(this.shape)}},{key:"redo",value:function(){this.layer.removeShape(this.shape)}},{key:"getSelectionHint",value:function(e){return e?{shape:this.shape}:null}}]),r}(st),ht=function(e){Qe(r,e);var t=et(r);function r(e,i){var n;return it(this,r),(n=t.call(this,e)).shapes=i.slice(),n}return ot(r,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}},{key:"getSelectionHint",value:function(e){return e?{shapes:this.shapes}:null}}]),r}(st),dt=function(e){Qe(r,e);var t=et(r);function r(e,i,n,o){var s;return it(this,r),(s=t.call(this,e)).poly=i,s.polyIndex=n,s.point=o.clone(),s}return ot(r,[{key:"undo",value:function(){this.poly.removePoint(this.polyIndex.vertex,this.polyIndex.loop)}},{key:"redo",value:function(){this.poly.insertPoint(this.polyIndex.vertex,this.point,this.polyIndex.loop)}},{key:"getSelectionHint",value:function(e){return{shape:this.poly,vertex:e?null:this.polyIndex}}}]),r}(st),pt=function(e){Qe(r,e);var t=et(r);function r(e,i,n,o){var s;return it(this,r),(s=t.call(this,e)).poly=i,s.polyIndex=n,s.posBefore=i.getPoint(n.vertex,n.loop),s.posAfter=o.clone(),s}return ot(r,[{key:"undo",value:function(){this.poly.updatePoint(this.polyIndex.vertex,this.posBefore.x,this.posBefore.y,this.polyIndex.loop)}},{key:"redo",value:function(){this.poly.updatePoint(this.polyIndex.vertex,this.posAfter.x,this.posAfter.y,this.polyIndex.loop)}},{key:"getSelectionHint",value:function(e){return{shape:this.poly,vertex:this.polyIndex}}}]),r}(st),ft=function(e,t,r){if(!e.isPath()||!e.edgeIndexValid(t,r))return null;switch(e.getEdgeType(t,r)){case Ee.Ellipse:return e.getEllipseArcParams(t,r);case Ee.Bezier:return{cp1:e.getControlPoint(t,1,r),cp2:e.getControlPoint(t,2,r)};case Ee.Line:return null;default:console.warn("unexpected edge type")}},gt=function(e,t,r,i){if(i)if(i instanceof Se)e.setEllipseArc(t,i);else if(i.cp1){var n=i.cp1,o=i.cp2;e.setBezierArc(t,n.x,n.y,o.x,o.y)}},vt=function(e){Qe(r,e);var t=et(r);function r(e,i,n){var o;return it(this,r),(o=t.call(this,e)).poly=i,o.vertex=n.vertex,o.loop=n.loop,o.point=i.getPoint(o.vertex,o.loop),o.arcBefore=ft(i,i.edgeBeforeVertex(o.vertex,o.loop),o.loop),o.arcAfter=ft(i,i.edgeAfterVertex(o.vertex,o.loop),o.loop),o}return ot(r,[{key:"undo",value:function(){this.poly.insertPoint(this.vertex,this.point,this.loop),this.poly.prevEdgeExists(this.vertex,this.loop)&&gt(this.poly,this.poly.edgeBeforeVertex(this.vertex,this.loop),this.loop,this.arcBefore),this.poly.nextEdgeExists(this.vertex,this.loop)&&gt(this.poly,this.poly.edgeAfterVertex(this.vertex,this.loop),this.loop,this.arcAfter)}},{key:"redo",value:function(){this.poly.isPath()&&(this.poly.prevEdgeExists(this.vertex,this.loop)&&this.poly.removeArc(this.poly.edgeBeforeVertex(this.vertex,this.loop),this.loop),this.poly.nextEdgeExists(this.vertex,this.loop)&&this.poly.removeArc(this.poly.edgeAfterVertex(this.vertex,this.loop),this.loop)),this.poly.removePoint(this.vertex,this.loop)}},{key:"getSelectionHint",value:function(e){return{shape:this.poly,vertex:e?this.polyIndex:null}}}]),r}(st),yt=function(e){Qe(r,e);var t=et(r);function r(e,i,n,o,s,a,l){var u;it(this,r),(u=t.call(this,e)).poly=i,u.edgeIndex=n.vertex,u.loopIndex=n.loop,u.duplicateStartVertex=a,u.duplicateEndVertex=l;var c=u.edgeIndex,h=i.nextIndex(c,u.loopIndex),d=i.getPoint(c,u.loopIndex),p=i.getPoint(h,u.loopIndex);return u.edgeBefore={a:d,b:p},u.edgeAfter={a:o.clone(),b:s.clone()},u}return ot(r,[{key:"undo",value:function(){var e=r.getNewEdgeIndex(this.poly,this.edgeIndex,this.loopIndex,this.duplicateStartVertex,this.duplicateEndVertex),t=this.poly.nextIndex(e,this.loopIndex);this.poly.updatePoint(e,this.edgeBefore.a.x,this.edgeBefore.a.y,this.loopIndex),this.poly.updatePoint(t,this.edgeBefore.b.x,this.edgeBefore.b.y,this.loopIndex),r.revertDuplicateVertices(this.poly,this.edgeIndex,this.loopIndex,this.duplicateStartVertex,this.duplicateEndVertex)}},{key:"redo",value:function(){r.duplicateVertices(this.poly,this.edgeIndex,this.loopIndex,this.duplicateStartVertex,this.duplicateEndVertex);var e=r.getNewEdgeIndex(this.poly,this.edgeIndex,this.loopIndex,this.duplicateStartVertex,this.duplicateEndVertex),t=this.poly.nextIndex(e,this.loopIndex);this.poly.updatePoint(e,this.edgeAfter.a.x,this.edgeAfter.a.y,this.loopIndex),this.poly.updatePoint(t,this.edgeAfter.b.x,this.edgeAfter.b.y,this.loopIndex)}},{key:"getSelectionHint",value:function(e){var t=e?this.edgeIndex:r.getNewEdgeIndex(this.poly,this.edgeIndex,this.loopIndex,this.duplicateStartVertex,this.duplicateEndVertex);return{shape:this.poly,edge:new ye({vertex:t,loop:this.loopIndex})}}}],[{key:"duplicateVertex",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e.getPoint(t,r);e.insertPoint(t,{x:i.x,y:i.y},r)}},{key:"duplicateVertices",value:function(e,t,i,n,o){var s=t;if(n&&(r.duplicateVertex(e,s,i),s++),o){var a=e.nextIndex(s,i);r.duplicateVertex(e,a,i)}}},{key:"revertDuplicateVertices",value:function(e,t,i,n,o){var s=r.getNewEdgeIndex(e,t,i,n,o);if(n){var a=s-1;e.removePoint(a,i),s--}if(o){var l=e.nextIndex(s,i);e.removePoint(l,i)}}},{key:"getNewEdgeIndex",value:function(e,t,r,i,n){var o=t;i&&o++;var s=e.getVertexCount(r)-(i?1:0)-(n?1:0);return n&&t===s-1&&o++,o}}]),r}(st),mt=function(e){Qe(r,e);var t=et(r);function r(e,i,n,o,s,a,l){var u;it(this,r),(u=t.call(this,e)).path=i,u.edgeIndex=n.vertex,u.loopIndex=n.loop;var c=i.isBezierArc(u.edgeIndex,u.loopIndex);return u.oldEdgeType=i.getEdgeType(u.edgeIndex,u.loopIndex),u.oldCp1=c&&i.getControlPoint(u.edgeIndex,1,u.loopIndex),u.oldCp2=c&&i.getControlPoint(u.edgeIndex,2,u.loopIndex),u.oldEllipseArcParams=i.getEllipseArcParams(u.edgeIndex,u.loopIndex),u.newEdgeType=o,u.newCp1=s,u.newCp2=a,u.newEllipseArcParams=l,u}return ot(r,[{key:"redo",value:function(){switch(this.newEdgeType){case Ee.Line:this.path.removeArc(this.edgeIndex,this.loopIndex);break;case Ee.Ellipse:this.path.setEllipseArc(this.edgeIndex,this.newEllipseArcParams,this.loopIndex);break;case Ee.Bezier:this.path.setBezierArc(this.edgeIndex,this.newCp1.x,this.newCp1.y,this.newCp2.x,this.newCp2.y,this.loopIndex)}}},{key:"undo",value:function(){switch(this.oldEdgeType){case Ee.Line:this.path.removeArc(this.edgeIndex,this.loopIndex);break;case Ee.Bezier:this.path.setBezierArc(this.edgeIndex,this.oldCp1.x,this.oldCp1.y,this.oldCp2.x,this.oldCp2.y,this.loopIndex);break;case Ee.Ellipse:this.path.setEllipseArc(this.edgeIndex,this.oldEllipseArcParams,this.loopIndex)}}},{key:"getSelectionHint",value:function(e){return{shape:this.path,edge:new ye({vertex:this.edgeIndex,loop:this.loopIndex})}}}]),r}(st),_t=function(e){Qe(r,e);var t=et(r);function r(e,i){var n;it(this,r),n=t.call(this,e);var o=i.getBBox();return n.paths=e.shapes.filter((function(e){if(e===i)return!1;if(!(e instanceof ve&&e.isClosed))return!1;var t=e.getBBox();return o.intersectsBox(t)})),n.clippedPaths=n.paths.map((function(e){return Je.apply(e,i,Je.Operator.Difference)})),n.originalShapes=n.paths.map((function(e){return e.clone()})),n.cutPath=i,n}return ot(r,[{key:"redo",value:function(){var e=this;this.paths.forEach((function(t,r){return t.copyGeometry(e.clippedPaths[r])})),this.layer.update()}},{key:"undo",value:function(){var e=this;this.paths.forEach((function(t,r){return t.copyGeometry(e.originalShapes[r])}))}},{key:"getSelectionHint",value:function(e){return{shape:this.cutPath}}}]),r}(st),Et=function(e){Qe(r,e);var t=et(r);function r(e,i,n){var o;return it(this,r),(o=t.call(this,e)).poly=i,o.loops=n,o.before=o.poly.clone(),o}return ot(r,[{key:"redo",value:function(){this.poly.removeLoops(this.loops)}},{key:"undo",value:function(){this.poly.copy(this.before)}},{key:"getSelectionHint",value:function(e){return{shape:this.poly}}}]),r}(st),xt=function(e){Qe(r,e);var t=et(r);function r(e,i,n,o,s){var a;return it(this,r),(a=t.call(this,e)).poly=i,a.loopIndex=n,a.before=a.poly.clone(),a.dx=o,a.dy=s,a}return ot(r,[{key:"redo",value:function(){this.poly.moveLoop(this.dx,this.dy,this.loopIndex)}},{key:"undo",value:function(){this.poly.copy(this.before)}},{key:"getSelectionHint",value:function(e){return{shape:this.poly}}}]),r}(st),bt={Action:st,AddShape:at,AddShapes:lt,MoveShapes:ut,RemoveShape:ct,RemoveShapes:ht,AddVertex:dt,MoveVertex:pt,RemoveVertex:vt,MoveEdge:yt,ChangeEdgeType:mt,ApplyCutOut:_t,RemoveLoops:Et,UnifyShapes:function(e){Qe(r,e);var t=et(r);function r(e,i,n){var o;return it(this,r),(o=t.call(this,e)).merged=Je.apply(i[0],i[1],Je.Operator.Union,i.slice(2)),o.before=i[n].clone(),o.mainShape=i[n],o.otherShapes=i.filter((function(e){return e!==o.mainShape})),o}return ot(r,[{key:"redo",value:function(){this.mainShape.copyGeometry(this.merged),this.layer.removeShapes(this.otherShapes)}},{key:"undo",value:function(){this.mainShape.copyGeometry(this.before),this.layer.addShapes(this.otherShapes)}},{key:"getSelectionHint",value:function(e){return{shape:this.mainShape}}}]),r}(st),MoveLoop:xt,ChangeBezierTangent:function(){function e(t,r,i,n,o,s){it(this,e),this.layer=t,this.path=r,this.index=i,this.loopIndex=n,this.pStart=o,this.pEnd=s,this.before=r.clone()}return ot(e,[{key:"setTangent",value:function(e,t){this.pStart=e,this.pEnd=t}},{key:"redo",value:function(){var e=this.path.edgeBeforeVertex(this.index,this.loopIndex);-1!==e&&this.path.isBezierArc(e,this.loopIndex)&&this.path.updateControlPoint(e,2,this.pStart.x,this.pStart.y,this.loopIndex);var t=this.path.edgeAfterVertex(this.index,this.loopIndex);-1!==t&&this.path.isBezierArc(t,this.loopIndex)&&this.path.updateControlPoint(this.index,1,this.pEnd.x,this.pEnd.y,this.loopIndex)}},{key:"undo",value:function(){this.path.copyGeometry(this.before)}},{key:"setSelectionItem",value:function(e,t){this.selectionHint={shape:this.path,vertex:e,edge:t}}},{key:"getSelectionHint",value:function(e){return this.selectionHint}}]),e}()};function At(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ct(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Tt(e,t,r){return t&&Ct(e.prototype,t),r&&Ct(e,r),e}var Pt=function(){function e(t,r){At(this,e),this.a=t.clone(),this.b=r.clone(),this.dir=m.getEdgeDirection(t,r)}return Tt(e,[{key:"intersect",value:function(e,t){return m.intersectLines(this.a,this.dir,e.a,e.dir,t)}},{key:"snapToLine",value:function(e){m.projectToLine(e,this.a,this.dir)}},{key:"isUsable",value:function(e,t){return m.pointLineDistance(e,this.a,this.dir)<t}},{key:"isEqual",value:function(e,t){return m.collinear(this.a,this.dir,e.a,e.dir,t)}}]),e}(),Rt=function(e,t,r){(t||r)&&(r?t?t.intersect(r,e):r.snapToLine(e):t.snapToLine(e))},St=function(e,t,r){var i=e.getVertexCount(r);return t=(t+i)%i,e.getPoint(t,r)},Vt=function(e,t,r,i,n){var o=new THREE.Vector2;return r.intersect(e,o)?o.distanceTo(i)>n?t:t?Math.abs(r.dir.dot(e.dir))>Math.abs(r.dir.dot(t.dir))?e:t:e:t},wt=new THREE.Vector2(1,0),Mt=Autodesk.Viewing,Lt=function(){function e(t){At(this,e),this.poly=null,this.vIndex=-1,this.loopIndex=-1,this.snapAngles=[0,45,90,135,180,225,270,315,360],this.snapAngleTolerance=2,this.snapRadius=10,this.gizmoLayer=t,this.setGlobalManager(t.globalManager),this.movedPoint=new THREE.Vector2,this.prevPoint=new THREE.Vector2,this.prevPoint2=new THREE.Vector2,this.edgeDir=new THREE.Vector2,this.alignAxis=new THREE.Vector2,this.edgeSnapLines=[],this.snapLine1=null,this.snapLine2=null,this.snapLineExt=null,this.snapLineStyle=new he({lineColor:"rgb(255, 0, 0)",lineWidth:1,lineStyle:10}),this.snapLineGizmos=[],this.snapLineGizmosUsed=0}return Tt(e,[{key:"onSetGlobalManager",value:function(e){this.globalManager=e,this.snapLineGizmos.forEach((function(t){return t.setGloblaManager(e)}))}},{key:"acquireSnapLineGizmo",value:function(){var e=this.snapLineGizmos[this.snapLineGizmosUsed];return e||((e=new _e([],this.snapLineStyle)).setGlobalManager(this.globalManager),this.snapLineGizmos[this.snapLineGizmosUsed]=e),this.snapLineGizmosUsed++,e}},{key:"clearSnappingGizmos",value:function(){var e=this;this.snapLineGizmos.forEach((function(t){return e.gizmoLayer.removeShape(t)})),this.snapLineGizmosUsed=0}},{key:"startSnapping",value:function(e,t,r){this.poly=e,this.vIndex=t,this.loopIndex=r,this.edgeSnapLines=function(e,t,r){for(var i=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,s=[],a=function(a){e.enumEdges((function(e,l,u,c){(a!==r||u!==t&&c!==t)&&(m.edgeIsDegenerated(e,l)||function(e,t){s.push(new Pt(e,t)),i=m.turnLeft(m.getEdgeDirection(e,t,i)),n=m.getEdgeCenter(e,t,n),o.copy(e).add(i),s.push(new Pt(e,o)),o.copy(n).add(i),s.push(new Pt(n,o)),o.copy(t).add(i),s.push(new Pt(t,o))}(e,l))}),a)},l=0;l<e.loopCount;l++)a(l);return s}(e,t,this.loopIndex)}},{key:"stopSnapping",value:function(){this.poly=null,this.vIndex=-1,this.loopIndex=-1,this.snapLine1=null,this.snapLine2=null,this.clearSnappingGizmos()}},{key:"clearSnappingResult",value:function(){this.snapLine1=null,this.snapLine2=null}},{key:"getPrevSnapLine",value:function(e){var t=St(this.poly,this.vIndex-1,this.loopIndex),r=St(this.poly,this.vIndex-2,this.loopIndex),i=m.getEdgeDirection(r,t);return this.computeAngleSnapLine(e,t,i)}},{key:"getNextSnapLine",value:function(e){if(this.poly.isPolyline()&&this.vIndex>=this.poly.getVertexCount(this.loopIndex)-2)return null;var t=St(this.poly,this.vIndex+1,this.loopIndex),r=St(this.poly,this.vIndex+2,this.loopIndex),i=m.getEdgeDirection(t,r);return this.computeAngleSnapLine(e,t,i)}},{key:"snapToAngle",value:function(e,t){var r=this;if(this.snapLine1=null,this.snapLine2=null,this.snapLineExt=t&&new Pt(t.a,t.b),this.active&&!(this.poly.vertexCount<=1)){var i=St(this.poly,this.vIndex-1,this.loopIndex),n=this.snapRadius*this.gizmoLayer.getUnitsPerPixel();if(2==this.poly.vertexCount){var o=this.computeAngleSnapLine(e,i,wt);return o&&this.snapLineExt?this.snapLine1=Vt(o,null,this.snapLineExt,e,n):this.snapLine1=o,void Rt(e,this.snapLine1,this.snapLineExt)}var s=this.getPrevSnapLine(e),a=this.getNextSnapLine(e),l=function(t){return!!t&&(r.snapLineExt?Boolean(Vt(t,null,r.snapLineExt,e,n)):t.isUsable(e,n))},u=this.edgeSnapLines.filter(l);if(s=l(s)&&s,a=l(a)&&a,this.snapLine1=s||a||u[0],this.snapLine1){if(this.snapLineExt)return Rt(e,this.snapLine1,this.snapLineExt);if(s&&a&&(this.snapLine2=Vt(a,null,this.snapLine1,e,n)),!this.snapLine2)for(var c=0;c<u.length;c++){var h=u[c];this.snapLine2=Vt(h,this.snapLine2,this.snapLine1,e,n)}return Rt(e,this.snapLine1,this.snapLine2)}}}},{key:"isSnapped",value:function(){return Boolean(this.snapLine1||this.snapLine2)}},{key:"updateSnapLineGizmos",value:function(e){var t=this;if(this.clearSnappingGizmos(),this.poly){var r=[],i=1e-4,n=function(t){return t&&t.isUsable(e,i)};if(2==this.poly.vertexCount){var o=St(this.poly,this.vIndex-1,this.loopIndex),s=this.computeAngleSnapLine(e,o,wt);s&&n(s)&&r.push(s)}else{r=this.edgeSnapLines.filter(n);var a=this.getPrevSnapLine(e),l=this.getNextSnapLine(e);n(a)&&r.push(a),n(l)&&r.push(l)}r=r.filter((function(e,t){for(var n=!1,o=0;o<t;o++){var s=r[o];if(e.isEqual(s,i)){n=!0;break}}return!n}));for(var u=this.gizmoLayer.viewer.canvas,c=Math.sqrt(u.width*u.width+u.height*u.height),h=this.gizmoLayer.getUnitsPerPixel()*c,d=function(e,r){if(e){var i=e.a;r.makeLine(i.x-h*e.dir.x,i.y-h*e.dir.y,i.x+h*e.dir.x,i.y+h*e.dir.y),t.gizmoLayer.addShape(r)}},p=0;p<r.length;p++)d(r[p],this.acquireSnapLineGizmo())}}},{key:"dtor",value:function(){this.clearSnapping()}},{key:"computeAngleSnapLine",value:function(e,t,r){if(m.edgeIsDegenerated(t,e))return null;for(var i=e.clone().sub(t),n=THREE.Math.radToDeg(m.angleBetweenDirections(i,r)),o=-1,s=0;s<this.snapAngles.length;s++){var a=this.snapAngles[s];if(Math.abs(a-n)<this.snapAngleTolerance){o=s;break}}if(-1==o)return null;var l=THREE.Math.degToRad(this.snapAngles[o]),u=m.rotateAround(r.clone(),l),c=t.distanceTo(e),h=u.multiplyScalar(c).add(t);return new Pt(t,h)}},{key:"active",get:function(){return this.poly}}]),e}();function Ot(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function It(e,t,r){return t&&kt(e.prototype,t),r&&kt(e,r),e}Mt.GlobalManagerMixin.call(Lt.prototype);var Ft,Nt=r(80227),Dt={Line:1,CircularArc:2,EllipticalArc:3},Bt=function(e,t,r,i,n,o){return{type:Dt.CirularArc,cx:e,cy:t,start:r,end:i,radius:n,vpId:o}},zt=function(e,t,r,i,n,o,s,a){return{type:Dt.EllipticalArc,cx:e,cy:t,start:r,end:i,major:n,minor:o,tilt:s,vpId:a}},jt=function(e,t){switch(e.type){case Dt.Line:t.onLineSegment(e.x1,e.y1,e.x2,e.y2,e.vpId);break;case Dt.CirularArc:t.onCircularArc(e.cx,e.cy,e.start,e.end,e.radius,e.vpId);break;case Dt.EllipticalArc:t.onEllipticalArc(e.cx,e.cy,e.tart,e.end,e.major,e.minor,e.tilt,e.vpId)}},Ut=function(){function e(){Ot(this,e),this.boundsCb=new Autodesk.Viewing.Private.BoundsCallback(new THREE.Box2),this.queryBox=new THREE.Box2,this.tmpPoint=new THREE.Vector2}return It(e,[{key:"getSegmentBox",value:function(e){return this.boundsCb.bounds.makeEmpty(),jt(e,this.boundsCb),this.boundsCb.bounds}},{key:"getQueryBox",value:function(e,t,r,i){return this.queryBox.min.set(e,t),this.queryBox.max.set(r,i),this.queryBox}},{key:"intersectsBox",value:function(e,t,r,i,n){var o=this.getQueryBox(t,r,i,n),s=this.getSegmentBox(e);return o.intersectsBox(s)}},{key:"getPoint",value:function(e,t){var r=this.getSegmentBox(e).getCenter(this.tmpPoint);t.x=r.x,t.y=r.y}}]),e}(),Gt=function(){function e(){Ot(this,e)}return It(e,[{key:"buildFromModel",value:function(e){var t=e.getBoundingBox(!0);this.tree=new Autodesk.Extensions.CompGeom.QuadTree(t.min.x,t.min.y,t.max.x,t.max.y,0,new Ut),Ft||(Ft=new Nt);var r=e.getFragmentList(),i=r.getCount();this.numProcessed=0,this.totalGeoms=i,Ft.postMessage({totalGeoms:i});for(var n=0;n<i;n++){var o=r.getGeometry(n);this.addGeometry(o)}}},{key:"addGeometry",value:function(e){var t=this,r={vb:e.vb,ib:e.ib,vbstride:e.vbstride,numInstances:e.numInstances,unpackXform:e.unpackXform,tIdColor:e.tIdColor,attributes:e.attributes};Ft.postMessage([r]),Ft.onmessage=function(e){for(var r,i,n,o,s,a=e.data,l=0;l<a.length;l+=9)switch(a[l]){case 1:t.tree.addItem((r=a[l+1],i=a[l+2],n=a[l+3],o=a[l+4],s=a[l+5],{type:Dt.Line,x1:r,y1:i,x2:n,y2:o,vpId:s}));break;case 2:t.tree.addItem(Bt(a[l+1],a[l+2],a[l+3],a[l+4],a[l+5],a[l+6]));break;case 3:t.tree.addItem(zt(a[l+1],a[l+2],a[l+3],a[l+4],a[l+5],a[l+6],a[l+7],a[l+8]));break;case 9:t.numProcessed++}}}},{key:"enumSegments",value:function(e,t,r,i,n){this.tree.enumInBox(e,t,r,i,(function(e){return jt(e,n)}))}}]),e}();function Yt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Kt=Autodesk.Viewing.MeasureCommon.SnapType,Ht=Autodesk.Viewing,qt=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.setGlobalManager(t.globalManager),this.layer=r,this.gizmoLayer=i,this.sheetSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.layerSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.angleSnapper=new Lt(i),this.snapBox=new THREE.Box2,this.sheetSnapper.activate(),this.layerSnapper.activate(),this.onCameraChangeCb=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb),this.initSegmentTrees(),this.tmpVec=new THREE.Vector3,this.raycaster=new THREE.Raycaster,this.ray=new THREE.Ray,this.geomSnapLine={a:new THREE.Vector3,b:new THREE.Vector3}}var t,r;return t=e,r=[{key:"dtor",value:function(){this.sheetSnapper.deactivate(),this.layerSnapper.deactivate(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb)}},{key:"onCameraChange",value:function(){this.updateSnapperIndicators()}},{key:"initSegmentTrees",value:function(){this.viewer.getVisibleModels().forEach((function(e){var t=e.isLeaflet();e.is2d()&&!t&&!e.segmentTree&&e.isLoadDone()&&(e.segmentTree=new Gt,e.segmentTree.buildFromModel(e))}))}},{key:"updateSnapperIndicators",value:function(){this.sheetSnapper.isSnapped()?this.sheetSnapper.indicator.render():this.layerSnapper.indicator.render()}},{key:"getSnapPosition",value:function(e,t,r){var i=this._getSnapPosition(e,t,r);return this.angleSnapper.updateSnapLineGizmos(i),this.updateSnapperIndicators(),i}},{key:"clearSnappingGizmos",value:function(){this.angleSnapper.clearSnappingGizmos(),this.sheetSnapper.clearSnapped(),this.sheetSnapper.indicator&&this.sheetSnapper.indicator.clearOverlays(),this.layerSnapper.clearSnapped(),this.layerSnapper.indicator&&this.layerSnapper.indicator.clearOverlays()}},{key:"startAngleSnapping",value:function(e,t,r){this.angleSnapper.startSnapping(e,t,r)}},{key:"stopAngleSnapping",value:function(){this.angleSnapper.stopSnapping()}},{key:"_getSnapPosition",value:function(e,t,r){this.angleSnapper.clearSnappingResult(),this.sheetSnapper.clearSnapped(),this.layerSnapper.clearSnapped();var i=this.layer.canvasToLayer(e,t),n=this._getGeomSnapPosition(e,t,r),o=this._getGeomSnapLine();if(n&&!o)return n;if(this.angleSnapper.snapToAngle(i,o),o&&!this.angleSnapper.isSnapped())return n;if(o&&this.angleSnapper.isSnapped()){var s=this._getGeomSnapResult(),a=new THREE.Vector3(i.x,i.y,0).applyMatrix4(this.layer.layerToWorld);s.geomType=Kt.SNAP_INTERSECTION,s.snapPoint=a,s.geomVertex=s.snapPoint}return i}},{key:"_getGeomSnapPosition",value:function(e,t,r){var i=this.layer.canvasToLayer(e,t),n=this._getSheetSnapPosition(e,t),o=this._getEditLayerSnapPosition(e,t,r);return n||o?o?n?THREE.Vector2.prototype.distanceToSquared.call(n,i)<THREE.Vector2.prototype.distanceToSquared.call(o,i)?(this.layerSnapper.clearSnapped(),n):(this.sheetSnapper.clearSnapped(),o):o:n:null}},{key:"_getGeomSnapResult",value:function(){var e=this.sheetSnapper.isSnapped(),t=this.layerSnapper.isSnapped();return e||t?(e?this.sheetSnapper:this.layerSnapper).getSnapResult():null}},{key:"_getGeomSnapLine",value:function(){var e=this._getGeomSnapResult();if(!e)return null;if(e.geomEdge){var t=e.geomEdge.vertices;return this.geomSnapLine.a.copy(t[0]),this.geomSnapLine.b.copy(t[1]),this.geomSnapLine.a.applyMatrix4(this.layer.worldToLayer),this.geomSnapLine.b.applyMatrix4(this.layer.worldToLayer),this.geomSnapLine}return null}},{key:"_getEditLayerSnapPosition",value:function(e,t,r){var i=this.layer.canvasToLayer(e,t,this.tmpVec),n=this.layerSnapper.detectRadiusInPixels*this.layer.getUnitsPerPixel();this.snapBox.min.set(i.x-n,i.y-n),this.snapBox.max.set(i.x+n,i.y+n);var o={};this.layer.enumShapes(this.snapBox,(function(e){r&&!r(e)||(o[e.id]=!0)}));var s=[];if(this.layer.enumMeshes(this.snapBox,(function(e){return s.push(e)})),this.layerSnapper.clearSnapped(),this.layerSnapper.snapping2DOverlay(i,s,(function(e){return Boolean(o[e])}),n),this.layerSnapper.isSnapped()){var a=this.layerSnapper.getSnapResult(),l=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(a,this.viewer);return l=(new THREE.Vector2).copy(l),a.applyMatrix4(this.layer.layerToWorld),l}}},{key:"_getSheetSnapPosition",value:function(e,t){var r=this;this.initSegmentTrees();var i=this.viewer.impl,n=function(e,t){var n=i.get2DModels();if(n.length){var o=i.clientToViewport(e,t);i.viewportToRay(o,r.ray),r.raycaster.set(r.ray.origin,r.ray.direction);var s=[];return n.forEach((function(e){s.push(e.rayIntersect2D(r.raycaster))})),s.sort((function(e,t){return e.distance-t.distance})),s[0]}}(e,t);if(n&&(this.sheetSnapper.snapping2D(n,{enumSegments:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=i.get2DModels();n.forEach((function(e){var r;e.segmentTree&&(r=e.segmentTree).enumSegments.apply(r,t)}))}}),this.sheetSnapper.isSnapped())){var o=this.sheetSnapper.getSnapResult(),s=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(o,this.viewer);return s=this.tmpVec.copy(s).applyMatrix4(this.layer.worldToLayer),(new THREE.Vector2).copy(s)}}}],r&&Yt(t.prototype,r),e}();function Wt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ht.GlobalManagerMixin.call(qt.prototype),Autodesk.Viewing;var Xt=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.toolSet=r,this.callbackId="Edit2D_".concat(r.name),this.callback=this.onContextMenu.bind(this)}var t,r;return t=e,(r=[{key:"register",value:function(){this.viewer.registerContextMenuCallback(this.callbackId,this.callback)}},{key:"unregister",value:function(){this.viewer.unregisterContextMenuCallback(this.callbackId)}},{key:"findGizmoUnderMouse",value:function(e,t,r){for(var i=document.elementFromPoint(t,r),n=0;n<e.length;n++){var o=e[n].findIndex((function(e){return e.container===i}));if(-1!==o)return new ye({vertex:o,loop:n})}return null}},{key:"vertexGizmoUnderMouse",value:function(e,t){var r=this.toolSet.tools.polygonEditTool.vertexMoveTool.vertexGizmos;return this.findGizmoUnderMouse(r,e,t)}},{key:"edgeGizmoUnderMouse",value:function(e,t){var r=this.toolSet.tools.polygonEditTool.edgeMoveTool.edgeGizmos,i=this.findGizmoUnderMouse([r],e,t);return i?i.vertex:-1}},{key:"onContextMenu",value:function(e,t){var r=this,i=this.toolSet.tools.polygonEditTool,n=this.toolSet.context.layer,o=t.event,s=this.toolSet.context.selection,a=this.toolSet.context.undoStack,l=n.canvasToLayer(t.canvasX,t.canvasY),u=i.findEdgeUnderMouse(l),c=u?i.poly:n.hitTest(l.x,l.y),h=s.getSelectedShapes(),d=h.includes(c);if(!d&&i.active&&s.selectOnly(c),d&&h.length>1&&(e.push({title:"Remove Shapes",target:function(){a.run(new bt.RemoveShapes(n,h))}}),i.enableUnify&&!h.find((function(e){return!e instanceof ve||!e.isClosed}))&&e.push({title:"Unify Shapes",target:function(){var e=h.indexOf(c);a.run(new bt.UnifyShapes(n,h,e))}})),Boolean(i.poly)){var p=this.vertexGizmoUnderMouse(o.clientX,o.clientY),f=Boolean(p),g=-1!==this.edgeGizmoUnderMouse(o.clientX,o.clientY),v=u&&u.vertex,y=u&&i.getNewVertexPosition(l,u),m=Boolean(y);if(c||f||m){if(e.length=0,i.enableCutout){var _=i.poly;_ instanceof ve&&_.isClosed&&e.push({title:"Apply as Cutout",target:function(){var e=new bt.ApplyCutOut(n,_);r.toolSet.context.undoStack.run(e)}})}f?e.push({title:"Remove Vertex",target:function(){i.removePoint(p)}}):u&&y&&e.push({title:"Insert Vertex",target:function(){var e=new ye({vertex:u.vertex+1,loop:u.loop});i.insertPoint(e,y)}});var E=g||m,x=i.poly instanceof Ve;if(!f&&E&&x){var b=i.poly.getEdgeType(v,u.loop);b!==Ee.Line&&e.push({title:"Change to Line Segment",target:function(){i.changeEdgeToLine(u)}}),b!==Ee.Bezier&&e.push({title:"Change to Arc Segment",target:function(){i.changeEdgeToBezier(u)}}),b!==Ee.Ellipse&&i.enableEllipseArcs&&e.push({title:"Change to Ellipse Segment",target:function(){i.changeEdgeToEllipse(u)}})}if(u&&i.poly.isClosed){var A,C=i.poly.getMainLoops(),T=1===C.length&&C[0]===u.loop;switch(i.poly.getLoopType(u.loop)){case ge.Outer:A="Remove Shape Part";break;case ge.Inner:A="Remove Hole";break;default:A="Remove Loop"}T||e.push({title:A,target:function(){i.removeLoop(u.loop)}})}c&&e.push({title:"Remove Shape",target:function(){a.run(new bt.RemoveShape(n,c))}})}}}}])&&Wt(t.prototype,r),e}();function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Zt(e,t){return Zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Zt(e,t)}function Qt(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $t(e){return $t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},$t(e)}function er(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function rr(e,t,r){return t&&tr(e.prototype,t),r&&tr(e,r),e}var ir=function(){function e(){er(this,e)}return rr(e,[{key:"apply",value:function(e){}}]),e}(),nr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zt(e,t)}(n,e);var t,r,i=(t=n,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=$t(t);if(r){var n=$t(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return Qt(this,e)});function n(e){var t;return er(this,n),(t=i.call(this)).viewer=e,t}return rr(n,[{key:"apply",value:function(e){var t=this.viewer.model;if(t){var r=function(e){var t=e.getData().viewports;if(!t)return-1;for(var r=-1,i=-1,n=0;n<t.length;n++){var o=t[n];if(o.transform){var s=o.geom_metrics.db_ids;s>i&&(r=n,i=s)}}return r}(t);t.pageToModel(e,null,r)}}}]),n}(ir);function or(e){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},or(e)}function sr(e,t,r){return sr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hr(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},sr(e,t,r||e)}function ar(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lr(e,t)}function lr(e,t){return lr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},lr(e,t)}function ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=hr(e);if(t){var n=hr(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return cr(this,r)}}function cr(e,t){return!t||"object"!==or(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hr(e){return hr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},hr(e)}function dr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function fr(e,t,r){return t&&pr(e.prototype,t),r&&pr(e,r),e}var gr=Autodesk.Viewing.Private,vr=function(){function e(){dr(this,e),this.measureTransform=null}return fr(e,[{key:"lengthToString",value:function(e){console.error("Not implemented")}},{key:"areaToString",value:function(e){console.error("Not implemented")}}]),e}(),yr="inch",mr=function(e){ar(r,e);var t=ur(r);function r(e){var i;return dr(this,r),(i=t.call(this)).viewer=e,i.config={layerUnits:yr,displayUnits:yr,precision:2,scaleFactor:1,areaSuffix:"^2",noMixedArea:!1,preferLetters:!1},i}return fr(r,[{key:"lengthToString",value:function(e){var t=this.config;return e=gr.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e),gr.formatValueWithUnits(e,t.displayUnits,3,t.precision,{preferLetters:t.preferLetters})}},{key:"areaToString",value:function(e){var t=this.config;e=gr.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e,"square");var r=t.displayUnits?"".concat(t.displayUnits).concat(t.areaSuffix):null;return gr.formatValueWithUnits(e,r,3,t.precision,{noMixedArea:t.noMixedArea,preferLetters:t.preferLetters})}}]),r}(vr),_r=function(e){ar(r,e);var t=ur(r);function r(e){var i;return dr(this,r),(i=t.call(this,e)).measureTransform=new nr(e),i}return fr(r,[{key:"updateConfig",value:function(){var e=this.config,t=this.viewer.model;e.layerUnits=t?t.getUnitString():yr;var r=this.viewer.getExtension("Autodesk.Measure"),i=r&&r.sharedMeasureConfig;i?(e.displayUnits=i.units,e.precision=i.precision,e.scaleFactor=i.calibrationFactor||1):(e.displayUnits=this.config.layerUnits,e.precision=2,e.scaleFactor=1)}},{key:"lengthToString",value:function(e){return this.updateConfig(),sr(hr(r.prototype),"lengthToString",this).call(this,e)}},{key:"areaToString",value:function(e){return this.updateConfig(),sr(hr(r.prototype),"areaToString",this).call(this,e)}},{key:"getPrecision",value:function(){return this.updateConfig(),this.config.precision}},{key:"fromDisplayUnits",value:function(e,t){return this.updateConfig(),gr.convertUnits(this.config.displayUnits,e,1/this.config.scaleFactor,t)}},{key:"fromDisplayUnitsVec3",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector3;return this.updateConfig(),r.x=this.fromDisplayUnits(e,t.x),r.y=this.fromDisplayUnits(e,t.y),r.z=this.fromDisplayUnits(e,t.z),r}},{key:"toDisplayUnits",value:function(e,t){return this.updateConfig(),gr.convertUnits(e,this.config.displayUnits,this.config.scaleFactor,t)}},{key:"toDisplayUnitsVec3",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector3;return this.updateConfig(),r.x=this.toDisplayUnits(e,t.x),r.y=this.toDisplayUnits(e,t.y),r.z=this.toDisplayUnits(e,t.z),r}},{key:"getDisplayUnit",value:function(){return this.updateConfig(),this.config.displayUnits}},{key:"getMainDisplayUnit",value:function(){var e=this.getDisplayUnit();return Autodesk.Viewing.Private.getMainUnit(e)}}]),r}(mr);function Er(e){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Er(e)}function xr(e,t,r){return xr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Rr(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},xr(e,t,r||e)}function br(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ar(e,t)}function Ar(e,t){return Ar=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ar(e,t)}function Cr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=Rr(e);if(t){var n=Rr(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return Tr(this,r)}}function Tr(e,t){return!t||"object"!==Er(t)&&"function"!=typeof t?Pr(e):t}function Pr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rr(e){return Rr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Rr(e)}function Sr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function wr(e,t,r){return t&&Vr(e.prototype,t),r&&Vr(e,r),e}var Mr=function(e){return e.toString()+"px"},Lr={Left:1,Center:2,Right:3},Or={Top:1,Center:2,Bottom:3},kr=Autodesk.Viewing,Ir=function(){function e(){Sr(this,e)}return wr(e,[{key:"update",value:function(){}}]),e}();kr.GlobalManagerMixin.call(Ir.prototype);var Fr=function(e){br(r,e);var t=Cr(r);function r(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0;Sr(this,r),(i=t.call(this)).layer=e,i.setGlobalManager(e.globalManager),i.layerPos=new THREE.Vector2,i.canvasPos=new THREE.Vector2;var s=i.getDocument();i.container=s.createElement("div"),i.container.style.position="absolute",i.container.style.transformOrigin="50% 50%",i.container.style.top="0px",i.container.style.left="0px",o&&i.container.classList.add(o),i.visible=!1,i.alignX=Lr.Center,i.alignY=Or.Center,i.angle=0,n&&i.setVisible(!0,!1);var a=function(e){i.container.style.opacity=e};return i.opacityParam=new Autodesk.Viewing.Private.AnimatedParam(1,a,.5),i.container.addEventListener("contextmenu",(function(e){1==e.buttons||i.layer.viewer.triggerContextMenu(e)})),i}return wr(r,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setVisible",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e!=this.visible&&(e?this.addToCanvas(t):this.removeFromCanvas(),this.visible=e)}},{key:"addToCanvas",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.layer.viewer.canvasWrap.appendChild(this.container),this.layer.addCanvasGizmo(this),e&&this.update()}},{key:"removeFromCanvas",value:function(){this.layer.viewer.canvasWrap.removeChild(this.container),this.layer.removeCanvasGizmo(this)}},{key:"setAlignX",value:function(e){this.alignX=e,this.update()}},{key:"setAlignY",value:function(e){this.alignY=e,this.update()}},{key:"setRotation",value:function(e){this.angle=e,this.update()}},{key:"update",value:function(){this.canvasPos.copy(this.layer.layerToCanvas(this.layerPos.x,this.layerPos.y));var e,t,r=this.canvasPos,i=this.container.style,n=Mr(r.x),o=Mr(r.y);switch(this.alignX){case Lr.Left:e="0%";break;case Lr.Center:e="-50%";break;case Lr.Right:e="-100%"}switch(this.alignY){case Or.Top:t="0%";break;case Or.Center:t="-50%";break;case Or.Bottom:t="-100%"}i.transform="translate(".concat(n,", ").concat(o,") translate(").concat(e,", ").concat(t,") rotate(").concat(this.angle,"deg)")}},{key:"setPosition",value:function(e,t){this.layerPos.set(e,t),this.update()}},{key:"setClassEnabled",value:function(e,t){t?this.container.classList.add(e):this.container.classList.remove(e)}},{key:"setSelected",value:function(e){this.setClassEnabled("selected",e)}},{key:"isSelected",value:function(){return this.container.classList.contains("selected")}},{key:"setHoverEnabled",value:function(e){this.setClassEnabled("enable-hover",e)}},{key:"setName",value:function(e){this.name=e,this.container.id=e||""}},{key:"setOpacity",value:function(e,t){t?this.opacityParam.fadeTo(e):this.opacityParam.setValue(e)}}]),r}(Ir),Nr=function(e){e.container.classList.add("edit2d-label"),e.container.classList.add("visible");var t=e.getDocument();e.textDiv=t.createElement("div"),e.textDiv.classList.add("edit2d-label-text"),e.container.appendChild(e.textDiv),e.setText=function(e){this.textDiv.textContent=e}.bind(e)},Dr=function(e){br(r,e);var t=Cr(r);function r(e,i,n){var o;return Sr(this,r),o=t.call(this,e,!0,n),Nr(Pr(o)),o}return r}(Fr),Br=function(e){br(r,e);var t=Cr(r);function r(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3?arguments[3]:void 0;return Sr(this,r),n=t.call(this,i,o,s),Nr(Pr(n)),n.shape=e,n.valueValid=!0,n.pixelOffset=new THREE.Vector2,n.update(),n}return wr(r,[{key:"update",value:function(){if(this.shape&&this.valueValid){if(this.container.style.visibility="visible",this.shape.isPolyline()){var e=this.shape.getEdgeCount(0),t=Math.floor(e/2);this.shape.edgeIndexValid(t)&&this.shape.getPointOnEdge(t,.5,0,this.layerPos)}else this.shape.computeBBox(),this.shape.bbox.getCenter(this.layerPos);if(this.pixelOffset){var i=this.layer.getUnitsPerPixel(),n=this.pixelOffset.x*i,o=this.pixelOffset.y*i;this.layerPos.x+=n,this.layerPos.y+=o}xr(Rr(r.prototype),"update",this).call(this)}else this.container.style.visibility="hidden"}},{key:"setShape",value:function(e){this.shape=e,this.update()}}]),r}(Fr),zr=function(e){br(r,e);var t=Cr(r);function r(e,i,n){var o,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Sr(this,r),(o=t.call(this,e,i,s)).unitHandler=n,o}return wr(r,[{key:"update",value:function(){var e=this.shape&&this.shape.getLength&&this.shape.getLength(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var t=this.unitHandler.lengthToString(e);this.setText(t)}xr(Rr(r.prototype),"update",this).call(this)}}]),r}(Br),jr=function(e){br(r,e);var t=Cr(r);function r(e,i,n){var o,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Sr(this,r),(o=t.call(this,e,i,s)).unitHandler=n,o.update(),o}return wr(r,[{key:"update",value:function(){if(this.unitHandler){if(this.shape&&this.shape.isSelfIntersecting&&this.shape.isSelfIntersecting())return this.setText(kr.i18n.t("Invalid shape")),this.container.classList.add("error-indicator"),this.valueValid=!0,void xr(Rr(r.prototype),"update",this).call(this);this.container.classList.remove("error-indicator");var e=this.shape&&this.shape.getArea&&this.shape.getArea(this.unitHandler.measureTransform);if(this.valueValid=Boolean(e),this.valueValid){var t=this.unitHandler.areaToString(e);this.setText(t)}xr(Rr(r.prototype),"update",this).call(this)}}}]),r}(Br),Ur=function(e){br(r,e);var t=Cr(r);function r(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0;return Sr(this,r),(i=t.call(this,e,n,o)).posA=new THREE.Vector2,i.posB=new THREE.Vector2,i.posValid=!1,i.edgeDir=new THREE.Vector2,i.poly=null,i.loopIndex=0,i.edgeIndex=0,i.container.classList.add("edge-gizmo"),i.ignoreArcs=!1,i.maxRelativeLength=void 0,i}return wr(r,[{key:"attachToEdge",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.poly=e,this.edgeIndex=t,this.loopIndex=r,this.update()}},{key:"detachFromEdge",value:function(){this.poly=null,this.edgeIndex=-1,this.loopIndex=-1,this.posValid=!1,this.update()}},{key:"edgeValid",value:function(){return this.poly&&this.poly.edgeIndexValid(this.edgeIndex,this.loopIndex)}},{key:"update",value:function(){this.poly&&this.poly.edgeIndexValid(this.edgeIndex,this.loopIndex)?(this.poly.getEdge(this.edgeIndex,this.posA,this.posB,this.loopIndex),this.posValid=!0):this.posValid=!1;var e=this._shouldBeShown();this.container.style.visibility=e?"visible":"hidden",e&&(this.ignoreArcs?ve.prototype.getPointOnEdge.call(this.poly,this.edgeIndex,.5,this.loopIndex,this.layerPos):this.poly.getPointOnEdge(this.edgeIndex,.5,this.loopIndex,this.layerPos),this._updateRotation(),xr(Rr(r.prototype),"update",this).call(this))}},{key:"_shouldBeShown",value:function(){if(!this.posValid)return!1;if(this.maxRelativeLength){var e=this.layer.layerToCanvas(this.posA.x,this.posA.y),t=this.layer.layerToCanvas(this.posB.x,this.posB.y),r=e.distanceTo(t)*this.maxRelativeLength,i=this.getWindow();return parseFloat(i.getComputedStyle(this.container).width)<r}return!0}},{key:"_updateRotation",value:function(){var e=this.layer.layerToCanvas(this.posA.x,this.posA.y),t=this.layer.layerToCanvas(this.posB.x,this.posB.y),r=m.getEdgeDirection(e,t,this.edgeDir),i=Math.atan2(r.y,r.x);r.x<0&&(i+=Math.PI),this.angle=THREE.Math.radToDeg(i)}}]),r}(Fr),Gr=function(e){br(r,e);var t=Cr(r);function r(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3?arguments[3]:void 0;return Sr(this,r),(n=t.call(this,e,o,s)).setName(i),n.container.classList.add("edge-move-gizmo"),n.ignoreArcs=!0,n.maxRelativeLength=.3,n}return r}(Ur),Yr=function(e){br(r,e);var t=Cr(r);function r(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Sr(this,r),i=t.call(this,e,n),Nr(Pr(i)),i.maxRelativeLength=1,i}return r}(Ur),Kr=function(e){br(r,e);var t=Cr(r);function r(e,i,n,o,s){var a;return Sr(this,r),(a=t.call(this,e,!0,s)).setPosition(i,n),a.setName(o),a.pos=new THREE.Vector2,a.poly=null,a.loopIndex=-1,a.vertexIndex=-1,a.container.classList.add("vertex-gizmo"),a}return wr(r,[{key:"attachToVertex",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.poly=e,this.vertexIndex=t,this.loopIndex=r,this.update()}},{key:"detachFromVertex",value:function(){this.poly=null,this.vertexIndex=-1,this.loopIndex=-1,this.posValid=!1,this.update()}},{key:"update",value:function(){if(this.poly){this.poly.indexValid(this.vertexIndex,this.loopIndex)?(this.poly.getPoint(this.vertexIndex,this.loopIndex,this.pos),this.posValid=!0):this.posValid=!1;var e=this.posValid;this.container.style.visibility=e?"visible":"hidden",e&&(this.layerPos.set(this.pos.x,this.pos.y),xr(Rr(r.prototype),"update",this).call(this))}else xr(Rr(r.prototype),"update",this).call(this)}}]),r}(Fr),Hr=function(e,t){e.updateBBox();var r=e.bbox,i=r.max.x-r.min.x;return i*t.getPixelsPerUnit()*i},qr=function(e){br(r,e);var t=Cr(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return Sr(this,r),(e=t.call(this)).minWidth=i,e}return wr(r,[{key:"accepts",value:function(e,t,r){var i=Hr(e,r);return Boolean(t)&&i>=this.minWidth}}]),r}(function(){function e(){Sr(this,e)}return wr(e,[{key:"accepts",value:function(e,t){return!0}}]),e}()),Wr=function(e){br(r,e);var t=Cr(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return Sr(this,r),(e=t.call(this)).rangeStart=i,e.rangeEnd=n,e}return wr(r,[{key:"apply",value:function(e,t,r){var i=(Hr(t,r)-this.rangeStart)/(this.rangeEnd-this.rangeStart),n=THREE.Math.clamp(i,0,1);e.container.style.opacity=n}}]),r}(function(){function e(){Sr(this,e)}return wr(e,[{key:"apply",value:function(e,t,r){}}]),e}()),Xr=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new qr,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Wr;Sr(this,e),this.layer=t,this.shapeToLabelText=r,this.labels={},this.layer.addCanvasGizmo(this),this.visible=!0,this.layer.update(),this.filter=i,this.styleRule=n}return wr(e,[{key:"setTextRule",value:function(e){this.shapeToLabelText=e,this.update()}},{key:"setVisible",value:function(e){e!==this.visible&&(e?(this.layer.addCanvasGizmo(this),this.update()):(this.clearLabels(),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"dtor",value:function(){this.setVisible(!1)}},{key:"removeLabelFromShape",value:function(e){this.labels[e.id]&&(this.clearLabel(this.labels[e.id]),delete this.labels[e.id])}},{key:"clearLabel",value:function(e){e.setShape(null),e.setVisible(!1)}},{key:"clearLabels",value:function(){var e=this;Object.values(this.labels).forEach((function(t){e.clearLabel(t)})),this.labels={}}},{key:"acquireLabel",value:function(e){var t=this.labels[e.id];return t||((t=new Br(null,this.layer)).setShape(e),this.labels[e.id]=t,t)}},{key:"update",value:function(){for(var e=this,t=this.layer.shapes,r=0;r<t.length;r++){var i=t[r],n=this.shapeToLabelText(i);if(!this.filter||this.filter.accepts(i,n,this.layer)){var o=this.acquireLabel(i);o.setText(n),o.setVisible(!0),this.styleRule&&this.styleRule.apply(o,i,this.layer)}else this.removeLabelFromShape(i)}Object.values(this.labels).forEach((function(r){-1===t.indexOf(r.shape)&&e.removeLabelFromShape(r.shape)}))}}]),e}(),Jr=function(e){br(r,e);var t=Cr(r);function r(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Sr(this,r),(i=t.call(this)).layer=e,i.textCb=n,i.viewer=i.layer.viewer,i.mousePos=null,i.distanceToBox=5,i.container=i.getDocument().createElement("div"),i.container.classList.add("adsk-control-tooltip"),i.viewer.canvasWrap.appendChild(i.container),i.layer.addCanvasGizmo(Pr(i)),i.onMouseMoved=i.onMouseMoved.bind(Pr(i)),i.viewer.canvasWrap.addEventListener("mousemove",i.onMouseMoved),i.layer.updateCanvasGizmos(),i}return wr(r,[{key:"dtor",value:function(){this.layer.removeCanvasGizmo(),this.viewer.canvasWrap.removeEventListener("mousemove",this.onMouseMoved),this.viewer.canvasWrap.removeChild(this.container)}},{key:"setTextCallback",value:function(e){this.textCb=e,this.update()}},{key:"onMouseMoved",value:function(e){this.viewer.toolController.__clientToCanvasCoords(e),this.mousePos=this.layer.canvasToLayer(e.canvasX,e.canvasY),this.update()}},{key:"update",value:function(){var e=this.mousePos&&this.textCb&&this.layer.hitTest(this.mousePos.x,this.mousePos.y),t=e&&this.textCb(e);if(this.container.textContent=t||"",t){this.container.style.visibility="visible",e.updateBBox();var r=e.bbox.max,i=this.layer.layerToCanvas(r.x,r.y);i.y-=this.distanceToBox;var n=this.viewer.canvas.width,o=this.viewer.canvas.height;this.container.style.right=n-i.x+"px",this.container.style.bottom=o-i.y+"px",this.container.style.left="auto",this.container.style.top="auto"}else this.container.style.visibility="hidden"}}]),r}(Ir),Zr=function(){function e(){Sr(this,e),this.elemUnderMouse=null}return wr(e,[{key:"update",value:function(e){this.elemUnderMouse=document.elementFromPoint(e.clientX,e.clientY)}},{key:"isUnderMouse",value:function(e){return e.container&&e.container===this.elemUnderMouse}},{key:"getGizmoIndex",value:function(e){var t=this;return e.findIndex((function(e){return t.isUnderMouse(e)}))}}]),e}(),Qr=function(){function e(t,r){Sr(this,e),this.layer=t,this.gizmoLayer=r,this.shapes=[],this.visibility=!1,this.setVisible(!0),this.highlightColor=void 0,this.highlightIndex=-1,this.highlightLoopIndex=-1}return wr(e,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setPoly",value:function(e){e!==this.poly&&(this.poly=e,this.clearEdgeHighlighting(),this.update())}},{key:"setVisible",value:function(e){this.visible!==e&&(this.visible=e,e?this.layer.addCanvasGizmo(this):this.layer.removeCanvasGizmo(this),this.update())}},{key:"clearShapes",value:function(){var e=this;this.shapes.forEach((function(t){return e.gizmoLayer.removeShape(t)})),this.shapes=[]}},{key:"edgeShapeName",value:function(e,t){return"ArcEdgeGizmo_"+t+"_"+e}},{key:"_addEdge",value:function(e,t){var r=new THREE.Vector2,i=new THREE.Vector2;this.poly.getEdge(e,r,i,t);var n=new _e([r,i]);n.name=this.edgeShapeName(e,t),n.style.lineStyle=11,n.style.lineWidth=this.poly.style.lineWidth/2,n.style.lineAlpha=this.poly.style.lineAlha/2,e==this.highlightIndex&&this.highlightColor&&(n.style.lineColor=this.highlightColor),this.gizmoLayer.addShape(n),this.shapes.push(n)}},{key:"clearEdgeHighlighting",value:function(){-1!==this.highlightIndex&&(this.highlightColor=null,this.highlightIndex=-1,this.highlight,this.update())}},{key:"setEdgeHighlighted",value:function(e,t,r){e===this.highlightIndex&&r===this.highlightColor||(this.highlightColor=r,this.highlightIndex=e,this.highlightLoopIndex=t,this.update())}},{key:"update",value:function(){if(this.clearShapes(),this.visible&&this.poly&&this.poly.isPath())for(var e=0;e<this.poly.loopCount;e++)for(var t=this.poly.getEdgeCount(e),r=0;r<t;r++)this.poly.isArc(r,e)&&this._addEdge(r,e)}}]),e}();function $r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ei=new THREE.Vector2,ti=function(){function e(t,r,i,n,o,s,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path=t,this.gizmoLayer=o,this.layer=n,this.gizmoManager=s,this.undoStack=a,this.index=r,this.loopIndex=i,this.line=new _e,this.lineVisible=!1,this.line.style.isScreenSpace=!0,this.line.style.lineColor="rgb(255, 0, 255)",this.line.style.lineWidth=1,this.line.style.lineStyle=10,this.line.style.lineAlpha=1,this.vertexGizmo1=new Kr(this.gizmoLayer,0,0,"TangentGizmo-$loopIndex-$vertexIndex-$sideIndex"),this.vertexGizmo2=new Kr(this.gizmoLayer,0,0,"TangentGizmo-$loopIndex-$vertexIndex-$sideIndex"),this.vertexGizmo1.setVisible(!1),this.vertexGizmo2.setVisible(!1),this.pStart=new THREE.Vector2,this.pEnd=new THREE.Vector2,this.layer.addCanvasGizmo(this),this.dragIndex=-1,this.lastDragPos=new THREE.Vector2,this.dragOffset=new THREE.Vector2(0,0),this.action=null,this.update()}var t,r;return t=e,(r=[{key:"dtor",value:function(){this.setVisible(!1),this.layer.removeCanvasGizmo(this)}},{key:"setVisible",value:function(e){this.vertexGizmo1.setVisible(e),this.vertexGizmo2.setVisible(e),e!==this.lineVisible&&(e?this.gizmoLayer.addShape(this.line):this.gizmoLayer.removeShape(this.line)),this.lineVisible=e}},{key:"update",value:function(){var e=this.path.edgeBeforeVertex(this.index,this.loopIndex),t=this.path.edgeAfterVertex(this.index,this.loopIndex),r=-1!==t,i=-1!==e&&this.path.isBezierArc(e,this.loopIndex),n=r&&this.path.isBezierArc(t,this.loopIndex);if(i||n){var o=this.path.getPoint(this.index,this.loopIndex,ei);n?(this.pEnd=this.path.getControlPoint(this.index,1,this.loopIndex,this.pEnd),m.mirrorPointOnPoint(this.pEnd,o,this.pStart)):(this.pStart=this.path.getControlPoint(e,2,this.loopIndex,this.pStart),m.mirrorPointOnPoint(this.pStart,o,this.pEnd)),this.vertexGizmo1.setPosition(this.pStart.x,this.pStart.y),this.vertexGizmo2.setPosition(this.pEnd.x,this.pEnd.y),this.line.makeLine(this.pStart.x,this.pStart.y,this.pEnd.x,this.pEnd.y),this.gizmoLayer.update(),this.setVisible(!0)}else this.setVisible(!1)}},{key:"updateAction",value:function(e,t){this.action?this.action.setTangent(e,t):this.action=new bt.ChangeBezierTangent(this.layer,this.path,this.index,this.loopIndex,e,t),this.action.redo(),this.update()}},{key:"onStartVertexMoved",value:function(e){var t=this.path.getPoint(this.index,this.loopIndex),r=m.mirrorPointOnPoint(e,t);this.updateAction(e,r)}},{key:"onEndVertexMoved",value:function(e){var t=this.path.getPoint(this.index,this.loopIndex),r=m.mirrorPointOnPoint(e,t);this.updateAction(r,e)}},{key:"startDrag",value:function(e,t,r){this.dragIndex=r;var i=0===r?this.pStart:this.pEnd,n=this.layer.layerToCanvas(i.x,i.y);this.dragOffset.set(n.x-e,n.y-t),this.lastDragPos.copy(i)}},{key:"endDrag",value:function(e,t){this.moveDrag(e,t),this.dragIndex=-1,this.action&&(this.undoStack.run(this.action),this.action=null)}},{key:"cancelDrag",value:function(){this.isDragging()&&(this.dragIndex=-1,this.action&&this.action.undo(),this.action=null)}},{key:"moveDrag",value:function(e,t){var r=e+this.dragOffset.x,i=t+this.dragOffset.y,n=this.layer.canvasToLayer(r,i);0===this.dragIndex?this.onStartVertexMoved(n):1===this.dragIndex&&this.onEndVertexMoved(n),this.layer.update()}},{key:"onButtonDown",value:function(e,t){var r=this.gizmoManager.isUnderMouse(this.vertexGizmo1),i=this.gizmoManager.isUnderMouse(this.vertexGizmo2);if(!r&&!i)return!1;var n=r?0:1;return this.startDrag(e,t,n),!0}},{key:"isDragging",value:function(){return-1!==this.dragIndex}}])&&$r(t.prototype,r),e}();function ri(e){return ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ri(e)}function ii(e,t,r){return ii="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=li(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},ii(e,t,r||e)}function ni(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oi(e,t)}function oi(e,t){return oi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},oi(e,t)}function si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=li(e);if(t){var n=li(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return ai(this,r)}}function ai(e,t){return!t||"object"!==ri(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function li(e){return li=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},li(e)}function ui(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ci(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function hi(e,t,r){return t&&ci(e.prototype,t),r&&ci(e,r),e}var di=Autodesk.Viewing.Private,pi=function(){function e(){ui(this,e),this.opacity=1,this.fullOpacity=1,this.fadeTime=.5,this.fadeAnim=null}return hi(e,[{key:"update",value:function(e){}},{key:"getShape",value:function(){}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"stopFadeAnim",value:function(){this.fadeAnim&&(this.fadeAnim.stop(),this.fadeAnim=null)}}]),e}(),fi=function(e){ni(r,e);var t=si(r);function r(e,i){var n;return ui(this,r),(n=t.call(this)).line2D=(new _e).makeLine(0,0,0,0),n.a=e||new THREE.Vector3,n.b=i||new THREE.Vector3,n}return hi(r,[{key:"update",value:function(e){var t=e.impl.worldToClient(this.a),r=e.impl.worldToClient(this.b);this.line2D.updatePoint(0,t.x,t.y),this.line2D.updatePoint(1,r.x,r.y)}},{key:"setOpacity",value:function(e){ii(li(r.prototype),"setOpacity",this).call(this,e),this.line2D.style.lineAlpha=e}},{key:"setLine",value:function(e,t){this.a.copy(e),this.b.copy(t)}},{key:"getShape",value:function(){return this.line2D}}]),r}(pi),gi=function(e){ni(r,e);var t=si(r);function r(e,i){var n;return ui(this,r),(n=t.call(this)).arrow=new ze,n.a=e||new THREE.Vector3,n.b=i||new THREE.Vector3,n}return hi(r,[{key:"update",value:function(e){var t=e.impl.worldToClient(this.a),r=e.impl.worldToClient(this.b);this.arrow.setFrom(t),this.arrow.setTo(r)}},{key:"getOpacity",value:function(){return this.arrow.style.lineAlpha}},{key:"setOpacity",value:function(e){this.arrow.line.style.lineAlpha=e,this.arrow.head.style.fillAlpha=e}},{key:"stopFadeAnim",value:function(){this.fadeAnim&&(this.fadeAnim.stop(),this.fadeAnim=null)}},{key:"setFrom",value:function(e){this.a.copy(e)}},{key:"setTo",value:function(e){this.b.copy(e)}},{key:"getShape",value:function(){return this.arrow}}]),r}(pi),vi=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Edit2D.ScreenOverlay";ui(this,e),this.viewer=t,this.overlayName=r,this.layer=new l(t);var i=t.canvas,n=i.clientWidth,o=i.clientHeight;this.camera=new THREE.OrthographicCamera(0,n,0,o,-1,1),this.viewer.impl.createOverlayScene(r,null,null,this.camera),this.viewer.impl.overlayScenes[r].scene.add(this.layer.scene),this.onResize=this.onResize.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),this.onCameraChange=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.gizmos=[],this.layer.setCutPlanesEnabled(!1),this.layer.setOverlayCamera(this.camera)}return hi(e,[{key:"dtor",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.viewer.removeOverlayScene(this.overlayName)}},{key:"onResize",value:function(){this.camera.right=this.viewer.canvas.clientWidth,this.camera.bottom=this.viewer.canvas.clientHeight,this.camera.updateProjectionMatrix(),this.update()}},{key:"gizmoVisible",value:function(e){return this.gizmos.includes(e)}},{key:"fadeInGizmo",value:function(e){var t=this,r=this.gizmoVisible(e)?e.getOpacity():0,i=e.fullOpacity;this.setGizmoVisible(e,!0),e.stopFadeAnim(),e.setOpacity(r),e.fadeAnim=di.fadeValue(0,1,e.fadeTime,(function(n){n=di.smootherStep(n);var o=di.lerp(r,i,n);e.setOpacity(o),t.layer.update()}))}},{key:"fadeOutGizmo",value:function(e){var t=this;if(this.gizmoVisible(e)){var r=e.getOpacity();e.stopFadeAnim(),e.fadeAnim=di.fadeValue(0,1,e.fadeTime,(function(i){i=di.smootherStep(i);var n=di.lerp(r,0,i);e.setOpacity(n),t.layer.update()}),(function(){t.setGizmoVisible(e,!1)}))}}},{key:"setGizmoVisible",value:function(e,t){e.stopFadeAnim(),e.setOpacity(e.fullOpacity);var r=this.gizmos.indexOf(e);if(t!=(-1!==r)){var i=e.getShape();t?(this.gizmos.push(e),this.layer.addShape(i)):(this.gizmos.splice(r,1),this.layer.removeShape(i)),this.update()}}},{key:"onCameraChange",value:function(){this.update()}},{key:"update",value:function(){var e=this;this.gizmos.forEach((function(t){return t.update(e.viewer)})),this.layer.update()}}]),e}();function yi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}vi.Line3DGizmo=fi,vi.Arrow3DGizmo=gi;var _i="rgb(0,0,0)",Ei=function(){function e(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};yi(this,e),this.layer=t,this.options=i,this.center=new THREE.Vector2,this.pStart=new THREE.Vector2,this.pEnd=new THREE.Vector2,this.arrowLength=150,this.arrowHeadLength=18,this.arcRadius=100,this.centerValid=!1,this.pStartValid=!1,this.pEndValid=!1,this.showExtendLines=!0,this.labelPosOffset=30,this.enableLabel=!0,this.arrowStart=new ze,this.arrowEnd=new ze,this.arrowStart.headAngle=45,this.arrowEnd.headAngle=45,this.arcLine=(new Ve).allocPoints(2),this.arcArrow=new ze,this.arcFill=(new Ve).allocPoints(3),this.arcFill.isClosed=!0,this.arcParams=new Se,this.onCameraChange=this.onCameraChange.bind(this),this.layer.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.arcFillOpacity=.2,this.arcFill.style.lineAlpha=0,this.arcFill.style.fillAlpha=this.arcFillOpacity,this.arcLine.style.lineWidth=2,this.arcLine.style.lineColor=this.options.arcColor||_i,this.arcArrow.line.style.lineColor=this.options.arcColor||_i,this.arcArrow.line.style.lineWidth=2,this.arcArrow.head.style.lineAlpha=0,this.arcArrow.head.style.fillColor=this.options.arcColor||_i,this.arcArrow.head.style.fillAlpha=1,this.arcArrowMaxHeadLength=.3,this.arrowStart.line.style.lineColor=this.options.startColor||_i,this.arrowStart.line.style.lineWidth=1.5,this.arrowEnd.line.style.lineColor=this.options.endColor||_i,this.arrowEnd.line.style.lineWidth=1.5,this.arrowStart.head.style.lineAlpha=0,this.arrowStart.head.style.fillColor=this.options.startColor||_i,this.arrowStart.head.style.fillAlpha=1,this.arrowEnd.head.style.lineAlpha=0,this.arrowEnd.head.style.fillColor=this.options.endColor||_i,this.arrowEnd.head.style.fillAlpha=1,this.label=new Dr(this.layer,"",this.options.labelClassName),this.labelPos=new THREE.Vector2,this.arcCurve=new Autodesk.Extensions.CompGeom.EllipseArc,this.visible=!1;var n=function(e){r.arrowStart.line.style.lineAlpha=e,r.arrowStart.head.style.fillAlpha=r.options.hideArrowHead?0:e,r.arrowEnd.line.style.lineAlpha=e,r.arrowEnd.head.style.fillAlpha=r.options.hideArrowHead?0:e,r.arcLine.style.lineAlpha=e,r.arcArrow.line.style.lineAlpha=e,r.arcArrow.head.style.fillAlpha=e,r.arcFill.style.fillAlpha=e*r.arcFillOpacity,r.opacity=e,r.layer.update()};this.opacityParam=new Autodesk.Viewing.Private.AnimatedParam(1,n,.5),this.opacity=1}var t,r;return t=e,(r=[{key:"setCenter",value:function(e){e?(this.center.copy(e),this.centerValid=!0):this.centerValid=!1}},{key:"setStart",value:function(e){e?(this.pStart.copy(e),this.pStartValid=isFinite(e.x)&&isFinite(e.y),this.pStartValid||console.warn("AngleGizmo: Invalid start point")):this.pStartValid=!1}},{key:"setEnd",value:function(e){e?(this.pEnd.copy(e),this.pEndValid=isFinite(e.x)&&isFinite(e.y),this.pEndValid||console.warn("AngleGizmo: Invalid end point")):this.pEndValid=!1}},{key:"dtor",value:function(){this.layer.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange)}},{key:"setVisible",value:function(e){this.visible!=e&&(this.visible=e,e?(this.layer.addShape(this.arrowStart),this.layer.addShape(this.arrowEnd),this.layer.addShape(this.arcLine),this.layer.addShape(this.arcArrow),this.layer.addShape(this.arcFill)):(this.layer.removeShape(this.arrowStart),this.layer.removeShape(this.arrowEnd),this.layer.removeShape(this.arcLine),this.layer.removeShape(this.arcArrow),this.layer.removeShape(this.arcFill)))}},{key:"setOpacity",value:function(e){this.opacityParam.setValue(e)}},{key:"skipFade",value:function(){this.opacityParam.skipAnim()}},{key:"fadeTo",value:function(e){this.opacityParam.fadeTo(e)}},{key:"updateLabel",value:function(e,t){var r,i=this.arcLine.exportEllipseArc(0,0,this.arcCurve);if(this.options.centerLabel)r=this.center;else{r=i.getPoint(.5,this.labelPos);var n=this.labelPosOffset/e;r.sub(this.center),r.normalize(),r.multiplyScalar(t+n),r.add(this.center)}this.label.setPosition(r.x,r.y);var o=THREE.Math.radToDeg(i.getAngleDelta());if(!isNaN(o)){var s=o.toFixed(1)+"°";this.label.setText(s)}}},{key:"update",value:function(){var e=1;if(!this.options.ignoreCameraDistance){var t=new THREE.Vector3(this.center.x,this.center.y,0).applyMatrix4(this.layer.layerToWorld);e=this.layer.viewer.impl.camera.pixelsPerUnitAtPoint(t)}var r=this.arrowHeadLength/e,i=this.arcRadius/e,n=this.centerValid&&this.pStartValid&&this.pEndValid;this.arrowStart.setVisible(n),this.arrowEnd.setVisible(n),this.arcLine.setVisible(n),this.arcArrow.setVisible(n),this.arcFill.setVisible(n);var o=n&&this.enableLabel;if(this.label.setOpacity(o?1:0,!0),n){this.arrowStart.setFrom(this.center),this.arrowEnd.setFrom(this.center),this.arrowStart.setTo(this.pStart),this.arrowEnd.setTo(this.pEnd),this.options.hideArrowHead||(this.arrowStart.setHeadLength(r),this.arrowEnd.setHeadLength(r));var s=this.pStart.clone().sub(this.center).normalize(),a=this.pEnd.clone().sub(this.center).normalize(),l=m.angleBetweenDirections(s,a);i=Math.min(i,this.pStart.distanceTo(this.center),this.pEnd.distanceTo(this.center)),this.arcParams.rx=i,this.arcParams.ry=i,this.arcParams.sweepFlag=l>Math.PI,this.arcParams.largeArcFlag=!1;var u=s.clone().multiplyScalar(i).add(this.center),c=a.clone().multiplyScalar(i).add(this.center);this.arcLine.updatePoint(0,u.x,u.y),this.arcLine.updatePoint(1,c.x,c.y),this.arcLine.setEllipseArc(0,this.arcParams);var h=this.arcLine.toPoly(),d=h.getPoint(h.getVertexCount()-2);this.arcArrow.setFrom(d),this.arcArrow.setTo(this.pEnd);var p=Math.min(r,this.arcArrowMaxHeadLength*this.pEnd.distanceTo(this.pStart));this.arcArrow.setHeadLength(p),this.arcFill.updatePoint(0,this.center.x,this.center.y),this.arcFill.updatePoint(1,u.x,u.y),this.arcFill.updatePoint(2,c.x,c.y),this.arcFill.setEllipseArc(1,this.arcParams),this.updateLabel(e,i),this.layer.update()}else this.layer.update()}},{key:"onCameraChange",value:function(){this.update()}},{key:"setLabelEnabled",value:function(e){this.enableLabel=e}}])&&mi(t.prototype,r),e}();function xi(e){return xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xi(e)}function bi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ai(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ci(e,t){return Ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ci(e,t)}function Ti(e,t){return!t||"object"!==xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pi(e){return Pi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pi(e)}var Ri=1,Si=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ci(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pi(i);if(n){var r=Pi(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ti(this,e)});function s(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return bi(this,s),(r=o.call(this,new l(e),t)).viewer=e,r.center3d=new THREE.Vector3,r.pStart3d=new THREE.Vector3,r.pEnd3d=new THREE.Vector3,r.id=Ri++,r.overlayName=i,r.overlayOwned=!1,i||(r.overlayName="Autodesk.Edit2d.AngleGizmo3d."+r.id,r.viewer.impl.createOverlayScene(r.overlayName),r.overlayOwned=!0),r.viewer.impl.addOverlay(r.overlayName,r.layer.scene),r.layerMatrix=new THREE.Matrix4,r}return t=s,(r=[{key:"dtor",value:function(){this.viewer.impl.removeOverlay(this.overlayName,this.layer.scene),this.overlayOwned&&this.viewer.impl.removeOverlayScene(this.overlayName)}},{key:"toLayer",value:function(e){return e&&e.clone().applyMatrix4(this.layer.worldToLayer)}},{key:"updateLayerTransform",value:function(){this.layerMatrix.makeTranslation(0,0,this.center3d.z),this.layer.setMatrix(this.layerMatrix)}},{key:"setCenter3d",value:function(e){e?(this.center3d.copy(e),this.updateLayerTransform(),this.pStartValid&&this.setStart(this.toLayer(this.pStart3d)),this.pEndValid&&this.setEnd(this.toLayer(this.pEnd3d)),this.setCenter(this.toLayer(this.center3d))):this.setCenter(null)}},{key:"setStart3d",value:function(e){e&&this.pStart3d.copy(e),this.setStart(this.toLayer(e))}},{key:"setEnd3d",value:function(e){e&&this.pEnd3d.copy(e),this.setEnd(this.toLayer(e))}}])&&Ai(t.prototype,r),s}(Ei);function Vi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var wi=Autodesk.Viewing,Mi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layer=t.layer,this.gizmoLayer=t.gizmoLayer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.shapes=null,this.loopIndex=-1,this.dragStartPoint=new THREE.Vector2,this.backupShapes=null,this.keyMap={CancelEdit:wi.KeyCode.ESCAPE},this.lastMousePos=new THREE.Vector2,this.mouseTracker=t.mouseTracker,this.moveFilters=[this.defaultMoveFilter]}var t,r;return t=e,r=[{key:"addMoveFilter",value:function(e){this.moveFilters.push(e)}},{key:"removeMoveFilter",value:function(e){var t=this.moveFilters.indexOf(e);return-1!=t&&(this.moveFilters.splice(t,1),!0)}},{key:"defaultMoveFilter",value:function(e){return e.every((function(e){return e.movable}))}},{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"Edit2_MoveTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleSingleClick",value:function(){var e=this.selection.getSelectedShapes();return e&&e.length>0}},{key:"handleDoubleClick",value:function(){var e=this.selection.getSelectedShapes();return e&&e.length>0}},{key:"handleButtonDown",value:function(e,t){if(0===t){var r=this.layer.canvasToLayer(e.canvasX,e.canvasY),i=this.layer.hitTest(r.x,r.y);if(!i)return this.selection.clear(),!1;i&&this.selection.shapeIsSelected(i)||this.selection.selectOnly(i);var n=this.selection.getSelectedShapes();return n.length>0&&this.startDrag(n,r),!0}}},{key:"startDrag",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=this.moveFilters.every((function(t){return t(e)}));if(!i)return!1;this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.shapes=e,this.loopIndex=r,this.dragStartPoint.copy(t),this.backupShapes=e.map((function(e){return e.clone()}))}},{key:"moveDrag",value:function(e){var t=this,r=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;this.shapes.forEach((function(e,n){e.copy(t.backupShapes[n]),-1===t.loopIndex?e.move(r,i):e.moveLoop(r,i,t.loopIndex)})),this.layer.update(),this.gizmoLayer.update()}},{key:"resetDragging",value:function(){this.shapes=null,this.loopIndex=-1,this.backupShapes=null}},{key:"endDrag",value:function(e){var t=this;if(this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.shapes){this.shapes.forEach((function(e,r){return e.copy(t.backupShapes[r])}));var r=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;return-1===this.loopIndex?this.undoStack.run(new bt.MoveShapes(this.layer,this.shapes,r,i)):this.undoStack.run(new bt.MoveLoop(this.layer,this.shapes[0],this.loopIndex,r,i)),this.shapes=null,this.loopIndex=-1,!0}}},{key:"cancelDrag",value:function(){var e=this;return this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),!!this.isDragging()&&(this.shapes.forEach((function(t,r){return t.copy(e.backupShapes[r])})),this.layer.update(),this.gizmoLayer.update(),this.resetDragging(),this.startedDragging=!0,!0)}},{key:"isDragging",value:function(){return Boolean(this.shapes)}},{key:"handleMouseMove",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.lastMousePos.copy(t),!!this.shapes&&(this.moveDrag(t),!0)}},{key:"handleButtonUp",value:function(e,t){if(0===t){var r=this.startedDragging;this.startedDragging=!1;var i=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.endDrag(i)||r}}},{key:"handleKeyDown",value:function(e,t){if(t===this.keyMap.CancelEdit)return this.cancelDrag()}},{key:"getCursor",value:function(){if(this.shapes)return"move";var e=this.layer.hitTest(this.lastMousePos.x,this.lastMousePos.y);return e&&this.moveFilters.every((function(t){return t([e])}))?"move":void 0}}],r&&Vi(t.prototype,r),e}();function Li(e){return Li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Li(e)}function Oi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ki=Autodesk.Viewing,Ii=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.layer=t.layer,this.gizmoLayer=t.gizmoLayer,this.snapper=t.snapper,this.selection=t.selection,this.undoStack=t.undoStack,this.unitHandler=t.unitHandler,this.nameSuffix="_".concat(t.toolSetName),this.mouseTracker=t.mouseTracker,this.ignoreDragging=!1,this.ignoreActions=!1,this.onActionCb=function(e){r.ignoreActions||r.handleExternalAction(e.action,e.isUndo)},this.suppressSnapping=!1,this.keyMap={SnapKey:ki.KeyCode.SHIFT,PanKey:ki.KeyCode.SPACE},this.selection&&(this.selectionCb=function(){r.active&&r.onSelectionChanged&&r.onSelectionChanged()},this.selection.addEventListener(He.Events.SELECTION_CHANGED,this.selectionCb)),this.active=!1,this.canvasPos=new THREE.Vector2,this.gizmoManager=new Zr,this.keyState={ctrl:!1,shift:!1,alt:!1}}var t,r;return t=e,(r=[{key:"getSnapPosition",value:function(e,t){var r=this;return this.snapper&&!this.suppressSnapping?this.snapper.getSnapPosition(e,t,(function(e){return r.snappingFilter(e)})):(this.snapper.clearSnappingGizmos(),this.layer.canvasToLayer(e,t))}},{key:"dtor",value:function(){this.selectionCb&&this.selection.removeEventListener(He.Events.SELECTION_CHANGED,this.selectionCb)}},{key:"getNames",value:function(){return[this.getName()]}},{key:"handleKeyDown",value:function(e,t){if(this.keyState[t]=!0,t!==this.keyMap.SnapKey||this.suppressSnapping||(this.suppressSnapping=!0,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===ki.KeyCode.BACKSPACE)return!0;t===this.keyMap.PanKey&&(this.ignoreDragging=!0)}},{key:"handleKeyUp",value:function(e,t){this.keyState[t]=!1,t===this.keyMap.SnapKey&&this.suppressSnapping&&(this.suppressSnapping=!1,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===this.keyMap.PanKey&&(this.ignoreDragging=!1)}},{key:"handleExternalAction",value:function(e,t){}},{key:"runAction",value:function(e){this.ignoreActions=!0,this.undoStack.run(e),this.ignoreActions=!1}},{key:"activate",value:function(){this.active=!0,this.undoStack.addEventListener(Ge.AFTER_ACTION,this.onActionCb)}},{key:"deactivate",value:function(){this.active=!1,this.undoStack.removeEventListener(Ge.AFTER_ACTION,this.onActionCb),this.snapper&&this.snapper.clearSnappingGizmos()}},{key:"register",value:function(){}},{key:"mapKey",value:function(e,t){for(var r in t){var i=t[r];if(null!==i){if(e.keyCode==i)return r;if(Array.isArray(i)&&i.includes(e.keyCode))return r;if("object"===Li(i)){var n=void 0===i.ctrlKey||i.ctrlKey===e.ctrlKey,o=void 0===i.shiftKey||i.shiftKey===e.shiftKey,s=void 0===i.altKey||i.altKey===e.altKey,a=void 0===i.meta||i.metaKey===e.metaKey;if(i.keyCode===e.keyCode&&n&&o&&s&&a)return r}if("function"==typeof i&&i(e))return r}}return null}},{key:"snappingFilter",value:function(){return!0}},{key:"trackMouseHook",value:function(e){if(this.mouseTracker){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY);this.mouseTracker.trackMouse(e,t)}}},{key:"trackMousePos",value:function(e){this.trackMouseHook(e),this.canvasPos.set(e.canvasX,e.canvasY),this.gizmoManager.update(e)}},{key:"handleMouseMove",value:function(e){this.trackMousePos(e)}},{key:"handleSingleClick",value:function(e){this.trackMousePos(e)}},{key:"handleDoubleClick",value:function(e){this.trackMousePos(e)}},{key:"handleButtonUp",value:function(e){this.trackMousePos(e)}},{key:"handleButtonDown",value:function(e){this.trackMousePos(e)}}])&&Oi(t.prototype,r),e}();function Fi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ki.GlobalManagerMixin.call(Ii.prototype);var Ni=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.checkedModifiers={}}var t,r;return t=e,(r=[{key:"addCondition",value:function(e,t){this.checkedModifiers[e]=t}},{key:"removeCondition",value:function(e){delete this.checkedModifiers[e]}},{key:"accepts",value:function(e){for(var t in this.checkedModifiers)if(e.getModifierState(t)!==this.checkedModifiers[t])return!1;return!0}}])&&Fi(t.prototype,r),e}();function Di(e){return Di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Di(e)}function Bi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ji(e,t){return ji=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ji(e,t)}function Ui(e,t){return!t||"object"!==Di(t)&&"function"!=typeof t?Gi(e):t}function Gi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yi(e){return Yi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Yi(e)}var Ki=Autodesk.Viewing,Hi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ji(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Yi(i);if(n){var r=Yi(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ui(this,e)});function s(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new he;return Bi(this,s),t=o.call(this,e),Autodesk.Viewing.EventDispatcher.prototype.apply(Gi(t)),t.style=r,t.rect=null,t.startPoint=new THREE.Vector2,t.endPoint=new THREE.Vector2,t.dragCanceled=!1,t.areaLabel=new jr(null,t.layer,e.unitHandler,!1),t.modifiers=new Ni,t.enableArcs=!0,t}return t=s,(r=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_RectangleTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(!this.modifiers.accepts(e))return!1;if(0==t){var r=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(r),!0}}},{key:"handleButtonUp",value:function(e,t){return 0==t&&(this.dragCanceled?(this.dragCanceled=!1,!0):(this.handleMouseMove(e),this.endDrag()))}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.rect&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag);var t=[e.clone(),e.clone(),e.clone(),e.clone()],r=this.style.clone();this.rect=this.enableArcs?new we(t,r):new me(t,r),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.rect)}},{key:"updateRect",value:function(e){if(this.isDragging()){var t=this.startPoint,r=this.endPoint;if(e){var i=r.x-t.x,n=r.y-t.y,o=Math.max(Math.abs(i),Math.abs(n)),s=Math.sign(i),a=Math.sign(n);this.rect.updatePoint(1,t.x+o*s,t.y),this.rect.updatePoint(2,t.x+o*s,t.y+o*a),this.rect.updatePoint(3,t.x,t.y+o*a)}else this.rect.updatePoint(1,r.x,t.y),this.rect.updatePoint(2,r.x,r.y),this.rect.updatePoint(3,t.x,r.y);this.gizmoLayer.update(),this.areaLabel.setShape(this.rect)}}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateRect(t)}},{key:"endDrag",value:function(){if(this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),!this.rect)return!1;var e=this.endPoint.x-this.startPoint.x,t=this.endPoint.y-this.startPoint.y,r=Math.abs(e)>1e-10&&Math.abs(t)>1e-10;return this.gizmoLayer.removeShape(this.rect),r&&this.undoStack.run(new bt.AddShape(this.layer,this.rect)),this.rect=null,this.areaLabel.setShape(null),!0}},{key:"cancelDrag",value:function(){this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.rect&&(this.gizmoLayer.removeShape(this.rect),this.rect=null,this.dragCanceled=!0,this.areaLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.rect)}},{key:"handleKeyDown",value:function(e,t){t==Ki.KeyCode.SHIFT&&this.updateRect(!0)}},{key:"handleKeyUp",value:function(e,t){t==Ki.KeyCode.SHIFT&&this.updateRect(!1)}}])&&zi(t.prototype,r),s}(Ii);function qi(e){return qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qi(e)}function Wi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ji(e,t){return Ji=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ji(e,t)}function Zi(e,t){return!t||"object"!==qi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qi(e){return Qi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Qi(e)}var $i=Autodesk.Viewing,en=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ji(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qi(i);if(n){var r=Qi(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Zi(this,e)});function s(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new he;return Wi(this,s),(t=o.call(this,e)).style=r,t.line=null,t.startPoint=new THREE.Vector2,t.endPoint=new THREE.Vector2,t.dragCanceled=!1,t.lengthLabel=new zr(null,t.layer,e.unitHandler,!1),t.enableArcs=!0,t}return t=s,(r=[{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_LineTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var r=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(r),!0}}},{key:"handleButtonUp",value:function(e,t){if(0==t)return this.handleMouseMove(e),this.dragCanceled?(this.dragCanceled=!1,!0):this.endDrag()}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.line&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag);var t=[e.clone(),e.clone()],r=this.style.clone();this.line=this.enableArcs?new Me(t,r):new _e(t,r),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.line)}},{key:"updateLine",value:function(){this.isDragging()&&(this.line.updatePoint(1,this.endPoint.x,this.endPoint.y),this.gizmoLayer.update(),this.lengthLabel.setShape(this.line))}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateLine()}},{key:"endDrag",value:function(){return this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),!!this.line&&(this.gizmoLayer.removeShape(this.line),!m.edgeIsDegenerated(this.startPoint,this.endPoint)&&this.undoStack.run(new bt.AddShape(this.layer,this.line)),this.line=null,this.lengthLabel.setShape(null),!0)}},{key:"cancelDrag",value:function(){this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.line&&(this.gizmoLayer.removeShape(this.line),this.line=null,this.dragCanceled=!0,this.lengthLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.line)}},{key:"handleKeyDown",value:function(e,t){t==$i.KeyCode.SHIFT&&this.updateLine(!0)}},{key:"handleKeyUp",value:function(e,t){t==$i.KeyCode.SHIFT&&this.updateLine(!1)}}])&&Xi(t.prototype,r),s}(Ii);function tn(e){return tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(e)}function rn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function on(e,t,r){return on="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=un(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},on(e,t,r||e)}function sn(e,t){return sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},sn(e,t)}function an(e,t){return!t||"object"!==tn(t)&&"function"!=typeof t?ln(e):t}function ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function un(e){return un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},un(e)}var cn={Polyline:1,Polygon:2},hn=Autodesk.Viewing,dn=new he,pn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sn(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=un(i);if(n){var r=un(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return an(this,e)});function s(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cn.Polygon,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new he;return rn(this,s),(t=o.call(this,e)).lineRectTool=r===cn.Polygon?new Hi(e,i):new en(e,i),Autodesk.Viewing.EventDispatcher.prototype.apply(ln(t)),t.vertexGizmos=[],t.poly=void 0,t.style=i,t.edgePreviewStyle=new he({lineWidth:2,isScreenSpace:!0,lineStyle:11}),t.mode=r,t.lastClickX=void 0,t.lastClickY=void 0,t.keyMap.CANCEL_EDIT=hn.KeyCode.ESCAPE,t.keyMap.REMOVE_LAST_VERTEX=hn.KeyCode.BACKSPACE,t.keyMap.FINISH_EDIT=[hn.KeyCode.ENTER,hn.KeyCode.c],t.fillGizmo=null,t.outlineGizmo=null,t.edgePreviewGizmo=null,t.mousePos=new THREE.Vector2,t.areaLabel=new jr(null,t.gizmoLayer,t.unitHandler,!1),t.lengthLabel=new Yr(t.gizmoLayer,!1),t.enableArcs=!0,t}return t=s,r=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"setArcsEnabled",value:function(e){this.enableArcs=e,this.lineRectTool.enableArcs=e}},{key:"deactivate",value:function(){on(un(s.prototype),"deactivate",this).call(this),this.cancelEdit()}},{key:"isPolygon",value:function(){return this.poly&&this.poly.isPolygon()}},{key:"setStyles",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.lineColor===dn.lineColor&&t||(this.style.lineColor=e.lineColor),e.lineAlpha===dn.lineAlpha&&t||(this.style.lineAlpha=e.lineAlpha),e.lineWidth===dn.lineWidth&&t||(this.style.lineWidth=e.lineWidth,this.lineRectTool.style.lineWidth=e.lineWidth,this.edgePreviewStyle.lineWidth=2*e.lineWidth/3),e.lineStyle===dn.lineStyle&&t||(this.style.lineStyle=e.lineStyle,this.lineRectTool.style.lineStyle=e.lineStyle),e.fillColor===dn.fillColor&&t||(this.style.fillColor=e.fillColor),e.fillAlpha===dn.fillAlpha&&t||(this.style.fillAlpha=e.fillAlpha)}},{key:"initGizmos",value:function(){this.isPolygon()&&(this.fillGizmo=new me([],this.style.clone()),this.fillGizmo.style.lineAlpha=0,this.gizmoLayer.addShape(this.fillGizmo)),this.outlineGizmo=new _e([],this.style.clone()),this.gizmoLayer.addShape(this.outlineGizmo),this.edgePreviewGizmo=new _e([],this.edgePreviewStyle),this.edgePreviewGizmo.style.lineColor=this.poly.style.lineColor,this.gizmoLayer.addShape(this.edgePreviewGizmo),this.areaLabel.setShape(this.fillGizmo),this.poly&&this.poly.isPolyline()&&this.lengthLabel.attachToEdge(this.edgePreviewGizmo,0)}},{key:"clearGizmos",value:function(){this.fillGizmo&&(this.gizmoLayer.removeShape(this.fillGizmo),this.fillGizmo=null),this.areaLabel.setShape(null),this.lengthLabel.detachFromEdge(),this.outlineGizmo&&(this.gizmoLayer.removeShape(this.outlineGizmo),this.outlineGizmo=null),this.edgePreviewGizmo&&(this.gizmoLayer.removeShape(this.edgePreviewGizmo),this.edgePreviewGizmo=null);for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"polyModified",value:function(){this.updateGizmos();var e=this.poly.clone();e.addPoint(this.mousePos.x,this.mousePos.y),this.snapper.startAngleSnapping(e,this.poly.vertexCount,0)}},{key:"updateGizmos",value:function(){if(this.fillGizmo){this.fillGizmo.clear();for(var e=0;e<this.poly.vertexCount;e++){var t=this.poly.getPoint(e);this.fillGizmo.addPoint(t.x,t.y)}this.fillGizmo.addPoint(this.mousePos.x,this.mousePos.y)}if(this.outlineGizmo.clear(),this.poly.vertexCount>=2)for(var r=0;r<this.poly.vertexCount;r++){var i=this.poly.getPoint(r);this.outlineGizmo.addPoint(i.x,i.y)}if(this.edgePreviewGizmo.clear(),this.poly.vertexCount>=1){var n=this.poly.getPoint(this.poly.vertexCount-1);this.edgePreviewGizmo.addPoint(n.x,n.y),this.edgePreviewGizmo.addPoint(this.mousePos.x,this.mousePos.y),this.updateLengthLabel()}this.gizmoLayer.update()}},{key:"updateLengthLabel",value:function(){if(this.poly&&this.poly.isPolyline()){var e=this.unitHandler.measureTransform,t=this.poly.getLength(e)+this.edgePreviewGizmo.getLength(e),r=this.unitHandler.lengthToString(t);this.lengthLabel.setText(r)}}},{key:"getName",value:function(){return(this.mode===cn.Polygon?"Edit2_PolygonTool":"Edit2_PolylineTool")+this.nameSuffix}},{key:"handleMouseMove",value:function(e){return on(un(s.prototype),"handleMouseMove",this).call(this,e),e.buttons?this.lineRectTool.handleMouseMove(e):(this.onHover(e.canvasX,e.canvasY),!1)}},{key:"onHover",value:function(e,t){if(this.poly){var r=this.layer.canvasToLayer(e,t),i=this.poly.vertexCount>=3&&this.gizmoManager.isUnderMouse(this.vertexGizmos[0]);this.setStartVertexHighlighted(i),i?(this.snapper.clearSnappingGizmos(),r.copy(this.vertexGizmos[0].layerPos)):r=this.getSnapPosition(e,t),this.mousePos.copy(r),this.edgePreviewGizmo.updatePoint(1,r.x,r.y),this.fillGizmo&&this.fillGizmo.updatePoint(this.fillGizmo.vertexCount-1,r.x,r.y),this.gizmoLayer.update(),this.updateLengthLabel()}else this.getSnapPosition(e,t)}},{key:"handleStartVertexClicked",value:function(e){if(this.poly||!(this.poly.vertexCount<3)){if(this.poly.isPolyline()){var t=this.poly.getPoint(0);this.addVertex(t.x,t.y)}this.finishPolygon(),e.stopPropagation()}}},{key:"handleSingleClick",value:function(e,t){return on(un(s.prototype),"handleSingleClick",this).call(this,e,t),0!=!t&&(this.vertexGizmos.length>0&&e.canvasX===this.lastClickX&&e.canvasY===this.lastClickY||(this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.mousePos.copy(this.getSnapPosition(e.canvasX,e.canvasY)),this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.Click),this.poly||this.startPoly(this.mousePos.x,this.mousePos.y),this.addVertex(this.mousePos.x,this.mousePos.y)),!0)}},{key:"handleButtonDown",value:function(e,t){return!this.ignoreDragging&&!this.poly&&(this.selection.clear(),this.lineRectTool.handleButtonDown(e,t))}},{key:"handleButtonUp",value:function(e,t){return this.lineRectTool.handleButtonUp(e,t)}},{key:"handleDoubleClick",value:function(e,t){return on(un(s.prototype),"handleDoubleClick",this).call(this,e,t),0!=!t&&(this.finishPolygon(),!0)}},{key:"startPoly",value:function(e,t){if(this.enableArcs){var r=this.mode===cn.Polygon;this.poly=new Ve([],r,this.style.clone())}else this.mode===cn.Polygon?this.poly=new me([],this.style.clone()):this.poly=new _e([],this.style.clone());this.initGizmos()}},{key:"addVertex",value:function(e,t){var r=this;this.poly.addPoint(e,t);var i="PolygonTool_vertexGizmo_"+this.vertexGizmos.length,n=new Kr(this.gizmoLayer,e,t,i);this.vertexGizmos.push(n),1===this.vertexGizmos.length&&n.container.addEventListener("click",(function(e){return r.handleStartVertexClicked(e)})),this.polyModified()}},{key:"removeLastVertex",value:function(){this.poly&&this.poly.vertexCount&&(this.poly.vertexCount<=1?this.cancelEdit():(this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Click),this.poly.removePoint(this.poly.vertexCount-1),this.vertexGizmos[this.vertexGizmos.length-1].dtor(),this.vertexGizmos.pop(),this.polyModified()))}},{key:"finishPolygon",value:function(){this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Click),this.clearGizmos(),this.snapper.stopAngleSnapping(),this.runAction(new bt.AddShape(this.layer,this.poly)),this.dispatchEvent({type:s.POLYGON_ADDED,polygon:this.poly}),this.poly=null}},{key:"cancelEdit",value:function(){this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Click),this.lineRectTool.isDragging()&&this.lineRectTool.cancelDrag(),this.poly&&(this.gizmoLayer.removeShape(this.poly),this.poly=null),this.clearGizmos(),this.snapper.stopAngleSnapping()}},{key:"handleFinishKey",value:function(e){return!(!this.poly||this.isPolygon()&&this.poly.vertexCount<3||(this.finishPolygon(),0))}},{key:"handleKeyDown",value:function(e,t){var r=on(un(s.prototype),"handleKeyDown",this).call(this,e,t);switch(r=this.lineRectTool.handleKeyDown(e,t)||r,this.mapKey(e,this.keyMap)){case"CANCEL_EDIT":this.cancelEdit(),r=!0;break;case"REMOVE_LAST_VERTEX":this.removeLastVertex(),r=!0;break;case"FINISH_EDIT":r=this.handleFinishKey(e)}return r}},{key:"handleKeyUp",value:function(e,t){on(un(s.prototype),"handleKeyUp",this).call(this,e,t),this.lineRectTool.handleKeyUp(e,t)}},{key:"onSnappingToggled",value:function(e,t){this.onHover(e,t)}},{key:"mouseOnStartVertex",value:function(){return!!this.vertexGizmos[0]&&this.gizmoManager(this.this.vertexGizmos[0])}},{key:"setStartVertexHighlighted",value:function(e){this.vertexGizmos[0]&&this.vertexGizmos[0].setSelected(e)}},{key:"getCursor",value:function(){return"crosshair"}}],r&&nn(t.prototype,r),s}(Ii);function fn(e){return fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fn(e)}function gn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function vn(e,t){return vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},vn(e,t)}function yn(e,t){return!t||"object"!==fn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function mn(e){return mn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},mn(e)}pn.POLYGON_ADDED="polygonAdded",pn.Mode=cn;var _n=new THREE.Vector2,En=function(e,t,r,i,n){var o=n||new Se,s=e.getEdgeDirection(t,r,_n),a=Math.atan2(s.y,s.x);return o.rotation=THREE.Math.radToDeg(a),o.rx=.5*e.getEdgeLength(t,r),o.ry=Math.abs(i),o.largeArcFlag=!1,o.sweepFlag=Boolean(e.isCCW(r)^i<0),o},xn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vn(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=mn(i);if(n){var r=mn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return yn(this,e)});function s(e,t,r,i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e,i)).container.classList.add("ellipse-arc-gizmo"),n.dragging=!1,n.dragStartParams=new Se,n.dragOffset=new THREE.Vector2,n.tmpVec=new THREE.Vector2,n.tmpVec2=new THREE.Vector2,n.tmpVec3=new THREE.Vector2,n.tmpParams=new Se,n.gizmoManager=t,n.undoStack=r,n}return t=s,(r=[{key:"isUnderMouse",value:function(){return this.visible&&this.edgeValid()&&this.gizmoManager.isUnderMouse(this)}},{key:"startDrag",value:function(e,t){if(!this.edgeValid()||!this.isUnderMouse())return!1;if(this.dragging)return!0;this.dragging=!0,this.setSelected(!0);var r=this.layerPos,i=this.layer.layerToCanvas(r.x,r.y);return this.dragOffset.set(i.x-e,i.y-t),this.poly.getEllipseArcParams(this.edgeIndex,this.loopIndex,this.dragStartParams),!0}},{key:"moveDrag",value:function(e,t){if(!this.dragging)return!1;var r=e+this.dragOffset.x,i=t+this.dragOffset.y,n=this.layer.canvasToLayer(r,i),o=this.poly.getPoint(this.edgeIndex,this.loopIndex,this.tmpVec),s=this.tmpVec2.copy(n).sub(o),a=this.poly.getOuterNormal(this.edgeIndex,this.loopIndex,this.tmpVec3),l=s.dot(a),u=En(this.poly,this.edgeIndex,this.loopIndex,l,this.tmpParams);return this.poly.setEllipseArc(this.edgeIndex,u,this.loopIndex),this.update(),this.layer.update(),!0}},{key:"endDrag",value:function(e,t){this.moveDrag(e,t),this.dragging=!1;var r=this.poly.getEllipseArcParams(this.edgeIndex,this.loopIndex,this.tmpParams);this.restoreArc();var i=new ye({vertex:this.edgeIndex,loop:this.loopIndex});this.undoStack.run(new bt.ChangeEdgeType(this.layer,this.poly,i,Ee.Ellipse,null,null,r)),this.setSelected(!1)}},{key:"cancelDrag",value:function(){this.restoreArc(),this.dragging=!1,this.layer.update()}},{key:"restoreArc",value:function(){this.poly.setEllipseArc(this.edgeIndex,this.dragStartParams,this.loopIndex)}}])&&gn(t.prototype,r),s}(Ur);function bn(e){return bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bn(e)}function An(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Cn(e,t,r){return Cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Rn(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},Cn(e,t,r||e)}function Tn(e,t){return Tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Tn(e,t)}function Pn(e,t){return!t||"object"!==bn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rn(e){return Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Rn(e)}var Sn=Autodesk.Viewing,Vn=function(e,t){return"PolygonEditTool_vertexGizmo_"+t.toString()+"_"+e.toString()},wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tn(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Rn(i);if(n){var r=Rn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Pn(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).layer=e.layer,t.selection=e.selection,t.nameSuffix="_".concat(e.toolSetName),t.keyMap.CancelEdit=Sn.KeyCode.ESCAPE,t.keyMap.DeleteSelectedVertex=Sn.KeyCode.BACKSPACE,t.mousePos=new THREE.Vector2,t.vertexGizmos=[],t.draggedVertex=null,t.dragVertexStartPos=new THREE.Vector2,t.gizmosEnabled=!0,t.selectedVertex=null,t.dragOffset=new THREE.Vector2(0,0),t.lastDragPoint=new THREE.Vector2,t}return t=s,(r=[{key:"getName",value:function(){return"Edit2_VertexMoveTool"+this.nameSuffix}},{key:"deactivate",value:function(){Cn(Rn(s.prototype),"deactivate",this).call(this),this.reset()}},{key:"setAllGizmosEnabled",value:function(e){this.gizmosEnabled=e,this.updateVertexGizmos()}},{key:"updateVertexGizmoLoop",value:function(e){for(var t=[],r=this.poly.getVertexCount(e),i=0;i<r;i++){var n=this.poly.getPoint(i,e),o=new Kr(this.gizmoLayer,n.x,n.y,Vn(i,e));o.attachToVertex(this.poly,i,e),t.push(o),o.setHoverEnabled(!0)}this.vertexGizmos[e]=t}},{key:"updateVertexGizmos",value:function(){if(this.clearVertexGizmos(),this.gizmosEnabled){if(this.poly)for(var e=0;e<this.poly.loopCount;e++)this.updateVertexGizmoLoop(e);this.updateVertexHighlighting()}}},{key:"clearVertexGizmos",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)for(var t=this.vertexGizmos[e],r=0;r<t.length;r++)t[r].dtor();this.vertexGizmos.length=0}},{key:"updateVertexHighlighting",value:function(){for(var e=this.selectedVertex,t=0;t<this.vertexGizmos.length;t++)for(var r=this.vertexGizmos[t],i=0;i<r.length;i++)r[i].setSelected(e&&e.vertex===i&&e.loop===t)}},{key:"updateAllGizmos",value:function(){this.updateVertexGizmos()}},{key:"setSelectedVertex",value:function(e){this.selectedVertex=this.poly?e:null,this.updateVertexHighlighting()}},{key:"findVertexUnderMouse",value:function(){for(var e=-1,t=0;t<this.vertexGizmos.length;t++){var r=this.vertexGizmos[t];if((e=this.gizmoManager.getGizmoIndex(r))>=0)return new ye({loop:t,vertex:e})}return null}},{key:"reset",value:function(){this.poly&&(this.poly=null,this.draggedVertex=null,this.selectedVertex=null,this.updateAllGizmos(),this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(e){this.reset(),e&&(this.poly=e,this.updateAllGizmos())}},{key:"onSelectionChanged",value:function(){var e=this.selection.getSelectedShapes(),t=1==e.length?e[0]:null;t instanceof ve?this.setEditPoly(t):this.setEditPoly(null)}},{key:"handleButtonDown",value:function(e,t){if(this.ignoreDragging)return!1;if(Cn(Rn(s.prototype),"handleButtonDown",this).call(this,e,t),0==!t)return!1;var r=this.layer.canvasToLayer(e.canvasX,e.canvasY);this.mousePos.copy(r);var i=this.findVertexUnderMouse();return!!i&&(this.startDragVertex(e,i),this.startedDragging=!0,!0)}},{key:"startDragVertex",value:function(e,t){this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.snapper.startAngleSnapping(this.poly.clone(),t.vertex,t.loop),this.draggedVertex=t;var r=this.poly.getPoint(this.draggedVertex.vertex,this.draggedVertex.loop),i=this.layer.layerToCanvas(r.x,r.y);this.dragOffset.set(i.x-e.canvasX,i.y-e.canvasY),this.setSelectedVertex(this.draggedVertex),this.lastDragPoint.copy(r),this.dragVertexStartPos.copy(r)}},{key:"moveDragVertex",value:function(e,t){var r=this.draggedVertex,i=r.loop,n=r.vertex,o=e+this.dragOffset.x,s=t+this.dragOffset.y,a=this.getSnapPosition(o,s),l=a.x-this.lastDragPoint.x,u=a.y-this.lastDragPoint.y,c=this.poly.getPoint(n,i);this.poly.updatePoint(n,c.x+l,c.y+u,i),this.vertexGizmos[i][n].setPosition(c.x,c.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(a)}},{key:"restoreDragVertex",value:function(){this.poly.updatePoint(this.draggedVertex.vertex,this.dragVertexStartPos.x,this.dragVertexStartPos.y,this.draggedVertex.loop)}},{key:"endDragVertex",value:function(){this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.restoreDragVertex();var e=this.dragVertexStartPos,t=this.lastDragPoint,r=.5*this.layer.getUnitsPerPixel();e.distanceTo(t)>r&&this.runAction(new bt.MoveVertex(this.layer,this.poly,this.draggedVertex,t)),this.draggedVertex=null,this.snapper.clearSnappingGizmos()}},{key:"handleMouseMove",value:function(e){return Cn(Rn(s.prototype),"handleMouseMove",this).call(this,e),this.mousePos.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY)),!!this.poly&&!!this.draggedVertex&&(this.moveDragVertex(e.canvasX,e.canvasY),!0)}},{key:"handleButtonUp",value:function(e,t){Cn(Rn(s.prototype),"handleButtonUp",this).call(this,e,t);var r=this.startedDragging;return this.startedDragging=!1,this.draggedVertex?(this.endDragVertex(),!0):!this.ignoreDragging&&r}},{key:"snappingFilter",value:function(e){return e!==this.poly}},{key:"handleKeyDown",value:function(e,t){var r=Cn(Rn(s.prototype),"handleKeyDown",this).call(this,e,t);return t===this.keyMap.CancelEdit&&(r=this.cancelDrag()),r}},{key:"cancelDrag",value:function(){var e=!1;return this.draggedVertex&&(this.restoreDragVertex(),this.draggedVertex=null,e=!0),e&&(this.updateAllGizmos(),this.layer.update()),this.snapper.clearSnappingGizmos(),e}},{key:"onSnappingToggled",value:function(e,t){this.draggedVertex&&this.moveDragVertex(e,t)}},{key:"updateSelectionState",value:function(e,t){var r=e.getSelectionHint(t);r?this.setSelectedVertex(r.vertex):(Boolean(this.poly&&this.layer.findShapeById(this.poly.id))||this.reset(),this.setSelectedVertex(null))}},{key:"handleExternalAction",value:function(e,t){this.updateSelectionState(e,t),this.cancelDrag(),this.updateAllGizmos(),this.snapper.clearSnappingGizmos()}},{key:"getCursor",value:function(){if(this.poly)return this.draggedVertex?"move":void 0}}])&&An(t.prototype,r),s}(Ii);function Mn(e){return Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mn(e)}function Ln(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function On(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function kn(e,t,r){return kn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nn(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},kn(e,t,r||e)}function In(e,t){return In=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},In(e,t)}function Fn(e,t){return!t||"object"!==Mn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Nn(e){return Nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Nn(e)}var Dn=Autodesk.Viewing,Bn=function(e,t,r){var i=e.getVertexCount(r);if(i<3)return!1;var n=e.isPolyline();if(n&&0===t||n&&t===i-1)return!1;var o=e.prevIndex(t,r),s=e.nextIndex(t,r),a=e.getPoint(o,r),l=e.getPoint(t,r),u=e.getPoint(s,r);return m.isPointOnLine(l,a,u,1e-5)},zn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&In(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Nn(i);if(n){var r=Nn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Fn(this,e)});function s(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ln(this,s),(t=o.call(this,e)).options=r,t.layer=e.layer,t.selection=e.selection,t.nameSuffix="_".concat(e.toolSetName),t.keyMap.CancelEdit=Dn.KeyCode.ESCAPE,t.dragEdgeStartPos={a:new THREE.Vector2,b:new THREE.Vector2},t.lastDragPoint=new THREE.Vector2,t.draggedEdge=null,t.selectedEdge=null,t.draggedEdgeBefore=null,t.draggedEdgeNormal=new THREE.Vector2,t.dragOffset=new THREE.Vector2(0,0),t.duplicateStartVertex=!1,t.duplicateEndVertex=!1,t.edgeGizmos=[],t.gizmosEnabled=!0,t.edgeGizmo=new _e,t.edgeGizmoShown=!1,t.arcEdgeGizmo=new Qr(e.layer,e.gizmoLayer),t.lengthLabel=new zr(null,t.layer,e.unitHandler,!1),t.edgeHighlightStyle=t.options.edgeHighlightStyle||new he({lineColor:"rgb(0, 255, 0)"}),t.gizmoClassName=t.options.gizmoClassName,t}return t=s,(r=[{key:"getName",value:function(){return"Edit2_EdgeMoveTool"+this.nameSuffix}},{key:"deactivate",value:function(){kn(Nn(s.prototype),"deactivate",this).call(this),this.reset()}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"handleButtonDown",value:function(e,t){if(this.ignoreDragging)return!1;if(kn(Nn(s.prototype),"handleButtonDown",this).call(this,e,t),0==!t)return!1;if(this.poly){this.setSelectedEdge(null);var r=this.getEdgeIndex();return!(!this.edgeMovePossible()||!r||(this.startedDragging=!0,this.startDragEdge(e,r),0))}}},{key:"handleMouseMove",value:function(e){return kn(Nn(s.prototype),"handleMouseMove",this).call(this,e),this.updateEdgeGizmo(),!!this.poly&&!!this.draggedEdge&&(this.moveDragEdge(e),!0)}},{key:"handleButtonUp",value:function(e,t){kn(Nn(s.prototype),"handleButtonUp",this).call(this,e,t);var r=this.startedDragging;if(this.startedDragging=!1,this.poly)return this.draggedEdge?(this.endDragEdge(),!0):!this.ignoreDragging&&r}},{key:"handleKeyDown",value:function(e,t){var r=kn(Nn(s.prototype),"handleKeyDown",this).call(this,e,t);return t===this.keyMap.CancelEdit&&(r=this.cancelDrag()),r}},{key:"getCursor",value:function(){if(this.poly)return this.draggedEdge?"move":void 0}},{key:"getEdgeIndex",value:function(){for(var e=0;e<this.edgeGizmos.length;e++){var t=this.edgeGizmos[e],r=this.gizmoManager.getGizmoIndex(t);if(-1!==r)return new ye({vertex:r,loop:e})}return null}},{key:"cancelDrag",value:function(){var e=!1;return this.draggedEdge&&(this.restoreDragEdge(),this.draggedEdge=null,e=!0),e&&(this.updateAllGizmos(),this.layer.update()),this.snapper.clearSnappingGizmos(),e}},{key:"handleExternalAction",value:function(e,t){this.updateSelectionState(e,t),this.cancelDrag(),this.updateAllGizmos(),this.snapper.clearSnappingGizmos()}},{key:"updateSelectionState",value:function(e,t){var r=e.getSelectionHint(t);r?this.setSelectedEdge(r.edge):(Boolean(this.poly&&this.layer.findShapeById(this.poly.id))||this.reset(),this.setSelectedEdge(null))}},{key:"startDragEdge",value:function(e,t){var r=t.vertex,i=t.loop;this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.draggedEdgeNormal=this.poly.getLeftEdgeNormal(r,i,this.draggedEdgeNormal);var n=new THREE.Vector2,o=new THREE.Vector2;this.poly.getEdge(r,n,o,i);var s=m.getEdgeDirection(n,o),a=this.layer.canvasToLayer(e.canvasX,e.canvasY);m.projectToLine(a,n,s),this.lastDragPoint.copy(a);var l=this.layer.layerToCanvas(a.x,a.y);this.dragOffset.set(l.x-e.canvasX,l.y-e.canvasY);var u=r,c=(r+1)%this.poly.getVertexCount(i);this.dragEdgeStartPos.a.copy(this.poly.getPoint(u,i)),this.dragEdgeStartPos.b.copy(this.poly.getPoint(c,i)),this.duplicateStartVertex=Bn(this.poly,u,i),this.duplicateEndVertex=Bn(this.poly,c,i),bt.MoveEdge.duplicateVertices(this.poly,r,i,this.duplicateStartVertex,this.duplicateEndVertex),this.draggedEdgeBefore=t;var h=bt.MoveEdge.getNewEdgeIndex(this.poly,r,i,this.duplicateStartVertex,this.duplicateEndVertex),d=new ye({vertex:h,loop:i});this.setSelectedEdge(d),this.draggedEdge=d,(this.duplicateStartVertex||this.duplicateEndVertex)&&this.updateAllGizmos()}},{key:"onSelectionChanged",value:function(){var e=this.selection.getSelectedShapes(),t=1==e.length?e[0]:null;t instanceof ve?this.setEditPoly(t):this.setEditPoly(null)}},{key:"reset",value:function(){this.poly&&(this.poly=null,this.draggedEdge=null,this.selectedEdge=null,this.updateAllGizmos(),this.lengthLabel.setShape(null),this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(e){this.reset(),e&&(this.poly=e,this.updateAllGizmos());var t=e&&e.isPolyline()?e:null;this.lengthLabel.setShape(t)}},{key:"createEdgeGizmos",value:function(){if(this.clearEdgeGizmos(),this.gizmosEnabled){for(var e=!1,t=this.poly?this.poly.loopCount:0,r=0;r<t;r++){var i=this.poly.getEdgeCount(r),n=[];if(i>=2){for(var o=0;o<i;o++){var s=new Gr(this.layer,"PolygonEditTool_edgeGizmo_"+o.toString(),void 0,this.gizmoClassName);s.attachToEdge(this.poly,o,r),n.push(s)}e=!0}this.edgeGizmos.push(n)}this.arcEdgeGizmo.setPoly(this.poly),this.updateEdgeGizmoHighlighting();var a=e?20:0;this.lengthLabel.pixelOffset.set(0,a)}}},{key:"moveDragEdge",value:function(e){if(this.draggedEdge){var t=this.draggedEdge.vertex,r=this.draggedEdge.loop,i=e.canvasX+this.dragOffset.x,n=e.canvasY+this.dragOffset.y,o=this.getSnapPosition(i,n),s=o.clone().sub(this.lastDragPoint),a=this.poly.prevEdgeIndex(t,r),l=this.poly.nextEdgeIndex(t,r),u=-1!==a,c=-1!==l,h=new THREE.Vector2,d=new THREE.Vector2,p=new THREE.Vector2,f=new THREE.Vector2;if(this.poly.getEdge(t,p,f,r),u||c){var g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,_=new THREE.Vector2;u&&this.poly.getEdge(a,g,v,r),c&&this.poly.getEdge(l,y,_,r),u||(v.copy(p),this.duplicateEndVertex?g.copy(p).add(this.draggedEdgeNormal):g.copy(_).sub(f).add(p)),c||(y.copy(f),this.duplicateStartVertex?_.copy(f).add(this.draggedEdgeNormal):_.copy(g).sub(p).add(f));var E=m.getEdgeDirection(g,v),x=m.getEdgeDirection(p,f),b=m.getEdgeDirection(y,_);if(p.add(s),f.add(s),this.duplicateStartVertex&&E.copy(this.draggedEdgeNormal),this.duplicateEndVertex&&b.copy(this.draggedEdgeNormal),!m.intersectLines(g,E,p,x,h)||!m.intersectLines(y,b,p,x,d))return}else h.copy(p).add(s),d.copy(f).add(s);var A=t,C=this.poly.nextIndex(A,r);this.poly.updatePoint(A,h.x,h.y,r),this.poly.updatePoint(C,d.x,d.y,r),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(o),this.updateEdgeGizmo()}}},{key:"restoreDragEdge",value:function(){if(this.draggedEdge){var e=this.draggedEdge.vertex,t=this.draggedEdge.loop,r=this.dragEdgeStartPos.a,i=this.dragEdgeStartPos.b,n=e,o=this.poly.nextIndex(n,t);this.poly.updatePoint(n,r.x,r.y,t),this.poly.updatePoint(o,i.x,i.y,t),bt.MoveEdge.revertDuplicateVertices(this.poly,this.draggedEdgeBefore.vertex,t,this.duplicateStartVertex,this.duplicateEndVertex),this.selectedEdge=this.draggedEdgeBefore}}},{key:"endDragEdge",value:function(){if(this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.draggedEdge){var e=this.draggedEdge.vertex,t=this.draggedEdge.loop,r=e,i=this.poly.nextIndex(r,t),n=this.poly.getPoint(r,t),o=this.poly.getPoint(i,t);this.restoreDragEdge(),this.dragEdgeStartPos.a.distanceTo(n)*this.layer.getPixelsPerUnit()>=3&&(this.runAction(new bt.MoveEdge(this.layer,this.poly,this.draggedEdgeBefore,n,o,this.duplicateStartVertex,this.duplicateEndVertex)),this.selectedEdge=this.draggedEdge),this.draggedEdge=null,this.updateAllGizmos()}}},{key:"edgeMovePossible",value:function(e){return this.poly&&this.poly.getVertexCount(e)>2}},{key:"updateEdgeGizmo",value:function(){var e=this.getEdgeIndex(),t=this.edgeMovePossible(),r=Boolean(this.poly&&this.selectedEdge),i=t&&e,n=i&&this.poly.isPath()&&this.poly.isArc(e.vertex,e.loop),o=!!this.gizmosEnabled&&(r||i&&!n);o&&!this.edgeGizmoShown?(this.gizmoLayer.addShape(this.edgeGizmo),this.edgeGizmoShown=!0):!o&&this.edgeGizmoShown&&(this.gizmoLayer.removeShape(this.edgeGizmo),this.edgeGizmoShown=!1);var s=r?this.selectedEdge:e,a=s?s.vertex:-1,l=s?s.loop:-1;if(this.edgeGizmoShown||n?this.arcEdgeGizmo.setEdgeHighlighted(a,l,this.edgeHighlightStyle.lineColor):this.arcEdgeGizmo.clearEdgeHighlighting(),o){var u=new THREE.Vector2,c=new THREE.Vector2;this.poly.getEdge(a,u,c,l),this.edgeGizmo.makeLine(u.x,u.y,c.x,c.y),this.edgeGizmo.style=this.edgeHighlightStyle,this.edgeGizmo.style.lineWidth=this.poly.style.lineWidth,this.edgeGizmo.style.isScreenSpace=this.poly.style.isScreenSpace,this.edgeGizmo.style.lineAlpha=r?1:.5,this.gizmoLayer.update()}}},{key:"setSelectedEdge",value:function(e){this.selectedEdge=e,this.updateEdgeGizmo(),this.updateEdgeGizmoHighlighting()}},{key:"clearEdgeGizmos",value:function(){for(var e=0;e<this.edgeGizmos.length;e++)for(var t=this.edgeGizmos[e],r=0;r<t.length;r++)t[r].dtor();this.edgeGizmos.length=0,this.arcEdgeGizmo.setPoly(null)}},{key:"snappingFilter",value:function(e){return e!==this.poly}},{key:"updateAllGizmos",value:function(){this.updateEdgeGizmo(),this.createEdgeGizmos(),this.updateEdgeGizmoHighlighting(),this.snapper.clearSnappingGizmos()}},{key:"setAllGizmosEnabled",value:function(e){this.gizmosEnabled=e,this.updateAllGizmos()}},{key:"updateEdgeGizmoHighlighting",value:function(){if(this.gizmosEnabled)for(var e=this.selectedEdge?this.selectedEdge.vertex:-1,t=this.selectedEdge?this.selectedEdge.loop:-1,r=0;r<this.edgeGizmos.length;r++)for(var i=this.edgeGizmos[r],n=0;n<i.length;n++){var o=n===e&&r===t;i[n].setSelected(o)}}}])&&On(t.prototype,r),s}(Ii);function jn(e){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jn(e)}function Un(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Gn(e,t,r){return Gn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Hn(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},Gn(e,t,r||e)}function Yn(e,t){return Yn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Yn(e,t)}function Kn(e,t){return!t||"object"!==jn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Hn(e){return Hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Hn(e)}var qn=Autodesk.Viewing,Wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yn(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Hn(i);if(n){var r=Hn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Kn(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).moveTool=new Mi(e),t.edgeMoveTool=new zn(e),t.vertexMoveTool=new wn(e),t.poly=null,t.keyMap.DeleteSelectedVertex=qn.KeyCode.BACKSPACE,t.keyMap.CancelEdit=qn.KeyCode.ESCAPE,t.keyMap.ChangeToArc=qn.KeyCode.a,t.keyMap.ChangeToLine=qn.KeyCode.l,t.keyMap.ChangeToEllipse=qn.KeyCode.e,t.mousePos=new THREE.Vector2,t.areaLabel=new jr(null,t.layer,e.unitHandler,!1),t.tangentGizmos=[],t.tangentGizmosEnabled=!0,t.ellipseArcGizmosEnabled=!0,t.hoverEnabled=!0,t.enableEllipseArcs=!1,t.ellipseArcGizmo=new xn(e.layer,t.gizmoManager,e.undoStack,!1),t.clickConsumed=!1,t}return t=s,(r=[{key:"setTangentGizmosEnabled",value:function(e){this.tangentGizmosEnabled=e,e?this.updateTangentGizmos():this.clearTangentGizmos()}},{key:"setEllipseArcGizmoEnabled",value:function(e){this.ellipseArcGizmosEnabled=e,this.updateEllipseArcGizmo()}},{key:"setAllGizmosEnabled",value:function(e){this.setTangentGizmosEnabled(e),this.setEllipseArcGizmoEnabled(e),this.vertexMoveTool.setAllGizmosEnabled(e),this.edgeMoveTool.setAllGizmosEnabled(e)}},{key:"setHoverEnabled",value:function(e){this.hoverEnabled&&!e&&this.selection.setHovered(null),this.hoverEnabled=e}},{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.edgeMoveTool.setLengthLabelVisible(e)}},{key:"getName",value:function(){return"Edit2_PolygonEditTool"+this.nameSuffix}},{key:"deactivate",value:function(){Gn(Hn(s.prototype),"deactivate",this).call(this),this.reset()}},{key:"updateAllGizmos",value:function(){this.updateTangentGizmos(),this.updateEllipseArcGizmo(),this.updateMouseOverHighlights(),this.vertexMoveTool.updateAllGizmos(),this.edgeMoveTool.updateAllGizmos()}},{key:"reset",value:function(){this.poly&&(this.poly=null,this.vertexMoveTool.reset(),this.edgeMoveTool.reset(),this.updateAllGizmos(),this.areaLabel.setShape(null),this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(e){this.reset(),e&&(this.poly=e,this.updateAllGizmos());var t=e&&e.isPolygon()?e:null;this.areaLabel.setShape(t)}},{key:"insertPoint",value:function(e,t){this.runAction(new bt.AddVertex(this.layer,this.poly,e,t)),this.updateAllGizmos(),this.layer.update()}},{key:"removeLoop",value:function(e){var t=this.poly.getChildLoops(e);t.push(e);var r=new bt.RemoveLoops(this.layer,this.poly,t);this.runAction(r),this.vertexMoveTool.setSelectedVertex(null),this.edgeMoveTool.setSelectedEdge(null),this.updateAllGizmos(),this.layer.update()}},{key:"removePoint",value:function(e){var t=e.loop,r=this.poly.isPolygon()?3:2;this.poly.getVertexCount(t)<=r?this.removeLoop(t):(this.runAction(new bt.RemoveVertex(this.layer,this.poly,e)),this.vertexMoveTool.updateVertexGizmos(),this.updateAllGizmos(),e.equals(this.vertexMoveTool.selectedVertex)&&this.vertexMoveTool.setSelectedVertex(null),this.edgeMoveTool.setSelectedEdge(null),this.layer.update())}},{key:"isSingleLine",value:function(){return this.poly&&1===this.poly.loopCount&&2===this.poly.getVertexCount(0)}},{key:"findEdgeUnderMouse",value:function(e){if(!this.poly)return null;for(var t=17*this.layer.getUnitsPerPixel(),r=0;r<this.poly.loopCount;r++){var i=this.poly.findEdgeIndex(e,t,r);if(-1!==i)return new ye({vertex:i,loop:r})}return null}},{key:"getNewVertexPosition",value:function(e,t){if(!this.poly||!t)return null;var r=t.vertex,i=t.loop;if(!this.poly.edgeIndexValid(r,i))return null;var n=new THREE.Vector2,o=new THREE.Vector2;this.poly.getEdge(r,n,o,i);var s=m.getEdgeDirection(n,o),a=e.clone();return m.projectToLine(a,n,s),m.isPointOnEdge(a,n,o,1e-4)?a:null}},{key:"handleButtonDown",value:function(e,t){if(this.ignoreDragging)return!1;if(Gn(Hn(s.prototype),"handleButtonDown",this).call(this,e,t),0==!t)return!1;var r=this.layer.canvasToLayer(e.canvasX,e.canvasY);if(this.mousePos.copy(r),this.vertexMoveTool.handleButtonDown(e,t))return this.edgeMoveTool.setSelectedEdge(null),!0;var i=e.ctrlKey||e.metaKey,n=-1;if(i){var o=this.findEdgeUnderMouse(this.mousePos),a=this.getNewVertexPosition(this.mousePos,o);if(a)return n=new ye({vertex:o.vertex+1,loop:o.loop}),this.insertPoint(n,a),this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.ButtonDown),this.vertexMoveTool.startDragVertex(e,n),!0}for(var l=0;l<this.tangentGizmos.length;l++)if(this.tangentGizmos[l].onButtonDown(e.canvasX,e.canvasY))return!0;if(this.ellipseArcGizmo.startDrag(e.canvasX,e.canvasY))return this.mouseTracker&&this.mouseTracker.startTracking(this.getName(),Autodesk.Edit2D.Trackings.ButtonDown),!0;if(this.vertexMoveTool.setSelectedVertex(null),this.edgeMoveTool.handleButtonDown(e,t))return this.updateTangentGizmos(),this.updateEllipseArcGizmo(),!0;var u=this.layer.hitTest(r.x,r.y);if(this.enableMultiselection&&i&&u)return this.selection.toggleSelection(u),this.clickConsumed=!0,!0;var c=this.poly&&this.findEdgeUnderMouse(this.mousePos);if(!u&&c&&(u=this.poly),this.selection.shapeIsSelected(u)){var h=c?c.loop:-1,d=this.poly&&this.poly.getMainLoops(),p=d&&1===d.length&&d[0]===h;if(c&&!p)this.moveTool.startDrag([this.poly],r,h);else{var f=this.selection.getSelectedShapes();this.moveTool.startDrag(f,r)}return!0}return u instanceof me||u instanceof _e||u instanceof Ve||(u=null),this.selection.selectOnly(u),!1}},{key:"handleSingleClick",value:function(e){Gn(Hn(s.prototype),"handleSingleClick",this).call(this,e);var t=this.clickConsumed||Boolean(this.poly);return this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Click),this.clickConsumed=!1,t}},{key:"handleMouseMove",value:function(e){if(Gn(Hn(s.prototype),"handleMouseMove",this).call(this,e),this.mousePos.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY)),this.updateMouseOverHighlights(),this.moveTool.isDragging()&&this.moveTool.moveDrag(this.mousePos),!this.poly)return!1;if(this.vertexMoveTool.handleMouseMove(e))return!0;if(this.edgeMoveTool.handleMouseMove(e))return!0;var t=this.findDraggedTangentGizmo();return t&&t.moveDrag(e.canvasX,e.canvasY),!!this.ellipseArcGizmo.dragging&&this.ellipseArcGizmo.moveDrag(e.canvasX,e.canvasY)}},{key:"handleButtonUp",value:function(e,t){Gn(Hn(s.prototype),"handleButtonUp",this).call(this,e,t),this.ignoreActions=!0;var r=this.vertexMoveTool.handleButtonUp(e,t);if(this.ignoreActions=!1,r)return!0;if(this.ignoreActions=!0,r=this.edgeMoveTool.handleButtonUp(e,t),this.ignoreActions=!1,r)return!0;if(this.moveTool.isDragging()){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.ignoreActions=!0,this.moveTool.endDrag(i),this.ignoreActions=!1,!0}var n=this.findDraggedTangentGizmo();return n&&(this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.ButtonUp),n.endDrag(e.canvasX,e.canvasY)),this.ellipseArcGizmo.dragging&&(this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.ButtonUp),this.ellipseArcGizmo.endDrag(e.canvasX,e.canvasY)),!1}},{key:"snappingFilter",value:function(e){return e!==this.poly}},{key:"onSelectionChanged",value:function(){var e=this.selection.getSelectedShapes(),t=1==e.length?e[0]:null;t instanceof ve?this.setEditPoly(t):this.setEditPoly(null),this.vertexMoveTool.onSelectionChanged(),this.edgeMoveTool.onSelectionChanged()}},{key:"handleKeyDown",value:function(e,t){var r=Gn(Hn(s.prototype),"handleKeyDown",this).call(this,e,t);if(this.vertexMoveTool.handleKeyDown(e,t),this.edgeMoveTool.handleKeyDown(e,t),t===this.keyMap.DeleteSelectedVertex&&this.poly&&this.vertexMoveTool.selectedVertex&&(this.removePoint(this.vertexMoveTool.selectedVertex),r=!0),t===this.keyMap.CancelEdit)return this.cancelDrag(),!0;var i=this.isSingleLine()?new ye({vertex:0,loop:0}):this.edgeMoveTool.selectedEdge,n=Boolean(this.poly&&i&&this.poly.edgeIndexValid(i.vertex,i.loop));return t===this.keyMap.ChangeToArc?(n&&!this.poly.isBezierArc(i.vertex,i.loop)&&this.changeEdgeToBezier(i),!0):t===this.keyMap.ChangeToEllipse?(n&&!this.poly.isEllipseArc(i.vertex,i.loop)&&this.changeEdgeToEllipse(i),!0):(t===this.keyMap.ChangeToLine&&n&&this.poly.isArc(i.vertex,i.loop)&&this.changeEdgeToLine(i),r)}},{key:"handleKeyUp",value:function(e,t){var r=Gn(Hn(s.prototype),"handleKeyUp",this).call(this,e,t);return this.vertexMoveTool.handleKeyUp(e,t),this.edgeMoveTool.handleKeyUp(e,t),r}},{key:"onSnappingToggled",value:function(e,t){this.vertexMoveTool.onSnappingToggled(e,t)}},{key:"cancelDrag",value:function(){var e=!1;this.vertexMoveTool.cancelDrag()&&(e=!0),this.edgeMoveTool.cancelDrag()&&(e=!0),this.moveTool.cancelDrag()&&(e=!0),this.tangentGizmos.forEach((function(t){t.isDragging()&&(t.cancelDrag(),e=!0)})),e&&(this.updateAllGizmos(),this.layer.update()),this.ellipseArcGizmo.dragging&&(this.mouseTracker&&this.mouseTracker.stopTracking(this.getName(),Autodesk.Edit2D.Trackings.Drag),this.ellipseArcGizmo.cancelDrag(),this.updateAllGizmos()),this.snapper.clearSnappingGizmos()}},{key:"updateSelectionState",value:function(e,t){e instanceof bt.ChangeBezierTangent&&(e.getSelectionHint(t)||e.setSelectionItem(this.vertexMoveTool.selectedVertex,this.edgeMoveTool.selectedEdge));var r=e.getSelectionHint(t);if(r){var i=r.shape?[r.shape]:r.shapes;return this.selection.setSelection(i),this.vertexMoveTool.setSelectedVertex(r.vertex),void this.edgeMoveTool.setSelectedEdge(r.edge)}Boolean(this.poly&&this.layer.findShapeById(this.poly.id))||this.reset(),this.vertexMoveTool.setSelectedVertex(null),this.edgeMoveTool.setSelectedEdge(null)}},{key:"handleExternalAction",value:function(e,t){this.updateSelectionState(e,t),this.cancelDrag(),this.updateAllGizmos(),this.snapper.clearSnappingGizmos()}},{key:"updateMouseOverHighlights",value:function(){if(this.hoverEnabled){var e=this.layer.hitTest(this.mousePos.x,this.mousePos.y);this.selection.setHoveredId(e?e.id:0)}}},{key:"getCursor",value:function(){if(this.poly){var e=this.mousePos;if(this.moveTool.isDragging())return"move";var t=this.vertexMoveTool.getCursor()||this.edgeMoveTool.getCursor();if(t)return t;if(this.ellipseArcGizmo.dragging)return"move";var r=17*this.layer.getUnitsPerPixel(),i=this.findEdgeUnderMouse(this.mousePos,r);if(this.keyState[qn.KeyCode.CONTROL]&&i)return"copy";var n=this.layer.getLineHitRadius(this.poly);return i||this.poly.hitTest(e.x,e.y,n)?"move":void 0}}},{key:"clearTangentGizmos",value:function(){this.tangentGizmos.forEach((function(e){return e.dtor()})),this.tangentGizmos.length=0}},{key:"updateTangentGizmos",value:function(){if(this.clearTangentGizmos(),this.poly&&this.poly.isPath())for(var e=0;e<this.poly.loopCount;e++)for(var t=this.poly.getVertexCount(e),r=0;r<t;r++){var i=this.vertexMoveTool.selectedVertex,n=Boolean(i&&i.vertex===r&&i.loop===e),o=this.poly.edgeBeforeVertex(r,e),s=this.poly.edgeAfterVertex(r,e),a=-1!==o,l=-1!==s,u=this.edgeMoveTool.selectedEdge,c=Boolean(a&&u&&u.vertex===o&&u.loop===e),h=Boolean(l&&u&&u.vertex===s&&u.loop===e),d=a&&this.poly.isBezierArc(o,e),p=l&&this.poly.isBezierArc(s,e);(this.isSingleLine()||n&&(d||p)||c&&d||h&&p)&&this.tangentGizmos.push(new ti(this.poly,r,e,this.layer,this.gizmoLayer,this.gizmoManager,this.undoStack))}}},{key:"updateEllipseArcGizmo",value:function(){var e=this.edgeMoveTool.selectedEdge,t=Boolean(e),r=!!this.ellipseArcGizmosEnabled&&t&&this.poly instanceof Ve&&this.poly.isEllipseArc(e.vertex,e.loop);this.ellipseArcGizmo.setVisible(r),r?this.ellipseArcGizmo.attachToEdge(this.poly,e.vertex,e.loop):this.ellipseArcGizmo.detachFromEdge()}},{key:"findDraggedTangentGizmo",value:function(){return this.tangentGizmos.find((function(e){return e.isDragging()}))}},{key:"getVertexTangentLength",value:function(e,t){return.5*(e+t)*(.551915024494/Math.SQRT2)}},{key:"getVertexTangent",value:function(e,t,r){var i=(new THREE.Vector2).copy(r).sub(e).normalize(),n=t.distanceTo(e),o=t.distanceTo(r),s=this.getVertexTangentLength(n,o);return i.multiplyScalar(s)}},{key:"changeEdgeToEllipse",value:function(e){var t=e.vertex,r=e.loop,i=.5*this.poly.getEdgeLength(t,r),n=En(this.poly,t,r,i);this.runAction(new bt.ChangeEdgeType(this.layer,this.poly,e,Ee.Ellipse,null,null,n)),this.layer.update(),this.edgeMoveTool.setSelectedEdge(e),this.updateAllGizmos()}},{key:"changeEdgeToBezier",value:function(e){var t=e.vertex,r=e.loop,i=this.poly,n=i.prevEdgeIndex(t,r),o=i.nextEdgeIndex(t,r),s=-1!==n,a=-1!==o,l=new THREE.Vector2,u=new THREE.Vector2;i.getEdge(t,l,u,r);var c=s&&i.getPoint(n,r),h=a&&i.getPoint(i.nextIndex(o,r),r);s||(c=m.mirrorPointOnPoint(u,l)),a||(h=m.mirrorPointOnPoint(l,u));var d=null,p=null,f=s&&i.isBezierArc(n,r),g=a&&i.isBezierArc(o,r);if(f){var v=i.getControlPoint(n,2,r);d=m.mirrorPointOnPoint(v,l)}else d=this.getVertexTangent(c,l,u).add(l);if(g){var y=i.getControlPoint(o,1,r);p=m.mirrorPointOnPoint(y,u)}else p=this.getVertexTangent(h,u,l).add(u);this.runAction(new bt.ChangeEdgeType(this.layer,this.poly,e,Ee.Bezier,d,p)),this.layer.update(),this.edgeMoveTool.setSelectedEdge(e),this.updateAllGizmos()}},{key:"changeEdgeToLine",value:function(e){this.runAction(new bt.ChangeEdgeType(this.layer,this.poly,e,Ee.Line)),this.layer.update(),this.edgeMoveTool.setSelectedEdge(e),this.updateAllGizmos()}}])&&Un(t.prototype,r),s}(Ii);function Xn(e){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xn(e)}function Jn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Zn(e,t){return Zn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Zn(e,t)}function Qn(e,t){return!t||"object"!==Xn(t)&&"function"!=typeof t?$n(e):t}function $n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eo(e){return eo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},eo(e)}var to=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zn(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=eo(i);if(n){var r=eo(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Qn(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=o.call(this,e),Autodesk.Viewing.EventDispatcher.prototype.apply($n(t)),t.symbol=new Le(0,0,.2,new he({fillAlpha:1,lineWidth:.01,fillColor:"rgb(255, 255, 0)"})),t}return t=s,(r=[{key:"getName",value:function(){return"Edit2_InsertSymbolTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"setSymbol",value:function(e){this.symbol=e}},{key:"handleMouseMove",value:function(e){}},{key:"handleSingleClick",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY),r=this.symbol.clone();return r.move(t.x,t.y),this.undoStack.run(new bt.AddShape(this.layer,r)),this.dispatchEvent({type:s.SYMBOL_INSERTED,symbol:r}),!0}},{key:"handleDoubleClick",value:function(){return!0}},{key:"getCursor",value:function(){return"crosshair"}}])&&Jn(t.prototype,r),s}(Ii);function ro(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}to.SYMBOL_INSERTED="symbolInserted";var io=Autodesk.Viewing,no=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.undoStack=t}var t,r;return t=e,(r=[{key:"handleKeyDown",value:function(e,t){return(e.ctrlKey||e.metaKey)&&t===io.KeyCode.z?(e.shiftKey?this.undoStack.redo():this.undoStack.undo(),!0):!(!e.ctrlKey||t!==io.KeyCode.y||(this.undoStack.redo(),0))}},{key:"getName",value:function(){return"Edit2_UndoTool"}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&ro(t.prototype,r),e}();function oo(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var so=Autodesk.Viewing,ao=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.viewer=t.viewer,this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.clipboard=t.clipboard,this.nameSuffix="_".concat(t.toolSetName),this.enableCut=!1,this.shapesBeingPosted=null,this.pasteCounter=0,this.onClipboardContentChanged=function(e){e.shapes!==r.shapesBeingPosted&&(r.pasteCounter=-1)}}var t,r;return t=e,(r=[{key:"register",value:function(){this.clipboard.addEventListener(c.CONTENT_CHANGED,this.onClipboardContentChanged)}},{key:"deregister",value:function(){this.clipboard.removeEventListener(c.CONTENT_CHANGED,this.onClipboardContentChanged)}},{key:"_postSelectedShapesToClipboard",value:function(){var e=this.selection.getSelectedShapes();return this.shapesBeingPosted=e,this.clipboard.postShapes(e),this.shapesBeingPosted=null,e}},{key:"copy",value:function(){this._postSelectedShapesToClipboard(),this.pasteCounter=0}},{key:"cut",value:function(){var e=this._postSelectedShapesToClipboard();this.pasteCounter=-1,this.undoStack.run(new bt.RemoveShapes(this.layer,e))}},{key:"paste",value:function(){this.pasteCounter++;var t=this.clipboard.cloneShapes(),r={type:e.BEFORE_PASTE,veto:!1};if(this.dispatchEvent(r),!r.veto){if(this.pasteCounter>0){var i=30*this.pasteCounter*this.layer.getUnitsPerPixel();t.forEach((function(e){return e.move(i,i)}))}this.undoStack.run(new bt.AddShapes(this.layer,t)),this.selection.setSelection(t),this.dispatchEvent({type:e.AFTER_PASTE,shapes:t})}}},{key:"delete",value:function(){var e=this.selection.getSelectedShapes();this.undoStack.run(new bt.RemoveShapes(this.layer,e)),this.selection.clear()}},{key:"handleKeyDown",value:function(e,t){var r=e.ctrlKey||e.metaKey;if(!this.selection.empty()){if(t===so.KeyCode.DELETE)return this.delete(),!0;if(r){if(t===so.KeyCode.c)return this.copy(),!0;if(this.enableCut&&t===so.KeyCode.x)return this.cut(),!0}}return!(!this.clipboard.hasShapes()||!r||t!==so.KeyCode.v||(this.paste(),0))}},{key:"getName",value:function(){return"Edit2_CopyTool"+this.nameSuffix}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}}])&&oo(t.prototype,r),e}();ao.BEFORE_PASTE="BEFORE_PASTE",ao.AFTER_PASTE="AFTER_PASTE";var lo={en:JSON.parse('{"@@locale":"en","@@context":"Edit2D Extension","Apply as Cutout":"Apply as Cutout","Remove Shapes":"Remove Shapes","Unify Shapes":"Unify Shapes","Remove Vertex":"Remove Vertex","Insert Vertex":"Insert Vertex","Change to Line Segment":"Change to Line Segment","Change to Arc Segment":"Change to Arc Segment","Change to Ellipse Segment":"Change to Ellipse Segment","Remove Shape":"Remove Shape","Remove Shape Part":"Remove Shape Part","Remove Hole":"Remove Hole","Remove Loop":"Remove Loop","Invalid shape":"Error: Invalid shape"}'),"en-GB":JSON.parse('{"@@locale":"en","@@context":"Edit2D Extension","Apply as Cutout":"Apply as Cutout","Remove Shapes":"Remove Shapes","Unify Shapes":"Unify Shapes","Remove Vertex":"Remove Vertex","Insert Vertex":"Insert Vertex","Change to Line Segment":"Change to Line Segment","Change to Arc Segment":"Change to Arc Segment","Change to Ellipse Segment":"Change to Ellipse Segment","Remove Shape":"Remove Shape","Remove Shape Part":"Remove Shape Part","Remove Hole":"Remove Hole","Remove Loop":"Remove Loop","Invalid shape":"Error: Invalid shape"}'),cs:JSON.parse('{"@@locale":"cs","@@context":"Rozšíření Edit2D","Apply as Cutout":"Použít jako výřez","Remove Shapes":"Odebrat tvary","Unify Shapes":"Sjednotit tvary","Remove Vertex":"Odebrat vrchol","Insert Vertex":"Vložit vrchol","Change to Line Segment":"Změnit na úsečkový segment","Change to Arc Segment":"Změnit na obloukový segment","Change to Ellipse Segment":"Změnit na segment elipsy","Remove Shape":"Odebrat tvar","Remove Shape Part":"Odebrat součást tvaru","Remove Hole":"Odebrat díru","Remove Loop":"Odebrat smyčku","Invalid shape":"Chyba: Neplatný tvar"}'),de:JSON.parse('{"@@locale":"de","@@context":"2D-Erweiterung bearbeiten","Apply as Cutout":"Als Aussparung anwenden","Remove Shapes":"Konturen entfernen","Unify Shapes":"Konturen vereinigen","Remove Vertex":"Scheitelpunkt entfernen","Insert Vertex":"Scheitelpunkt einfügen","Change to Line Segment":"In Liniensegment ändern","Change to Arc Segment":"In Bogensegment ändern","Change to Ellipse Segment":"In Ellipsensegment ändern","Remove Shape":"Kontur entfernen","Remove Shape Part":"Formteil entfernen","Remove Hole":"Aussparung entfernen","Remove Loop":"Schleife entfernen","Invalid shape":"Fehler: Ungültige Form"}'),es:JSON.parse('{"@@locale":"es","@@context":"Edit2D Extension","Apply as Cutout":"Aplicar como corte","Remove Shapes":"Eliminar formas","Unify Shapes":"Unificar formas","Remove Vertex":"Eliminar vértice","Insert Vertex":"Insertar vértice","Change to Line Segment":"Cambiar a segmento de línea","Change to Arc Segment":"Cambiar a segmento de arco","Change to Ellipse Segment":"Cambiar a segmento de elipse","Remove Shape":"Eliminar forma","Remove Shape Part":"Eliminar parte de forma","Remove Hole":"Eliminar agujero","Remove Loop":"Eliminar bucle","Invalid shape":"Error: forma no válida"}'),fr:JSON.parse('{"@@locale":"fr_fr","@@context":"Modifier l\'extension 2D","Apply as Cutout":"Appliquer comme découpe","Remove Shapes":"Supprimer les formes","Unify Shapes":"Unifier les formes","Remove Vertex":"Supprimer le sommet","Insert Vertex":"Insérer un sommet","Change to Line Segment":"Changer en segment de ligne","Change to Arc Segment":"Changer en segment d\'arc","Change to Ellipse Segment":"Changer en segment d\'ellipse","Remove Shape":"Supprimer la forme","Remove Shape Part":"Supprimer la pièce de forme","Remove Hole":"Supprimer le perçage","Remove Loop":"Supprimer la boucle","Invalid shape":"Erreur: forme incorrecte"}'),"fr-CA":JSON.parse('{"@@locale":"fr-CA","@@context":"Extension Edit2D","Apply as Cutout":"Appliquer en tant que découpe","Remove Shapes":"Supprimer les formes","Unify Shapes":"Unifier les formes","Remove Vertex":"Supprimer le sommet","Insert Vertex":"Insérer un sommet","Change to Line Segment":"Modifier en segment de ligne","Change to Arc Segment":"Modifier en segment d\'arc","Change to Ellipse Segment":"Modifier en segment d\'ellipse","Remove Shape":"Supprimer la forme","Remove Shape Part":"Supprimer la partie de la forme","Remove Hole":"Supprimer le trou","Remove Loop":"Supprimer la boucle","Invalid shape":"Erreur : forme incorrecte"}'),it:JSON.parse('{"@@locale":"it","@@context":"Modifica estensione 2D","Apply as Cutout":"Applica come ritaglio","Remove Shapes":"Rimuovi forme","Unify Shapes":"Unifica forme","Remove Vertex":"Rimuovi vertice","Insert Vertex":"Inserisci vertice","Change to Line Segment":"Cambia in segmento di linea","Change to Arc Segment":"Cambia in segmento di arco","Change to Ellipse Segment":"Cambia in segmento di ellisse","Remove Shape":"Rimuovi forma","Remove Shape Part":"Rimuovi parte forma","Remove Hole":"Rimuovi foro","Remove Loop":"Rimuovi linea chiusa","Invalid shape":"Errore: forma non valida"}'),ja:JSON.parse('{"@@locale":"ja","@@context":"2D Extension を編集","Apply as Cutout":"カットアウトとして適用","Remove Shapes":"シェイプを除去","Unify Shapes":"シェイプを統一","Remove Vertex":"頂点を除去","Insert Vertex":"頂点を挿入","Change to Line Segment":"線分セグメントに変更","Change to Arc Segment":"円弧セグメントに変更","Change to Ellipse Segment":"楕円セグメントに変更","Remove Shape":"シェイプを除去","Remove Shape Part":"シェイプ パーツを除去","Remove Hole":"穴を除去","Remove Loop":"ループを除去","Invalid shape":"エラー: 無効なシェイプ"}'),ko:JSON.parse('{"@@locale":"ko","@@context":"Edit2D 확장","Apply as Cutout":"절단부로 적용","Remove Shapes":"모양 제거","Unify Shapes":"쉐이프 통합","Remove Vertex":"정점 제거","Insert Vertex":"정점 삽입","Change to Line Segment":"선 세그먼트로 변경","Change to Arc Segment":"호 세그먼트로 변경","Change to Ellipse Segment":"타원 세그먼트로 변경","Remove Shape":"모양 제거","Remove Shape Part":"쉐이프 부품 제거","Remove Hole":"구멍 제거","Remove Loop":"루프 제거","Invalid shape":"오류: 잘못된 쉐이프"}'),pl:JSON.parse('{"@@locale":"pl","@@context":"Rozszerzenie Edit2D","Apply as Cutout":"Zastosuj jako wycięcie","Remove Shapes":"Usuń kształty","Unify Shapes":"Ujednolić kształty","Remove Vertex":"Usuń wierzchołek","Insert Vertex":"Wstaw wierzchołek","Change to Line Segment":"Zmień na segment linii","Change to Arc Segment":"Zmień na segment łuku","Change to Ellipse Segment":"Zmień na segment elipsy","Remove Shape":"Usuń kształt","Remove Shape Part":"Usuń część kształtu","Remove Hole":"Usuń otwór","Remove Loop":"Usuń pętlę","Invalid shape":"Błąd: nieprawidłowy kształt"}'),"pt-BR":JSON.parse('{"@@locale":"ptb","@@context":"Extensão Edit2D","Apply as Cutout":"Aplicar como corte","Remove Shapes":"Remover formas","Unify Shapes":"Unificar formas","Remove Vertex":"Remover vértice","Insert Vertex":"Inserir vértice","Change to Line Segment":"Alterar para segmento de linha","Change to Arc Segment":"Alterar para segmento de arco","Change to Ellipse Segment":"Alterar para segmento de elipse","Remove Shape":"Remover forma","Remove Shape Part":"Remover peça de forma","Remove Hole":"Remover furo","Remove Loop":"Remover loop","Invalid shape":"Erro: Forma inválida"}'),ru:JSON.parse('{"@@locale":"ru","@@context":"Расширение Edit2D","Apply as Cutout":"Применить как вырез","Remove Shapes":"Удалить формы","Unify Shapes":"Объединить формы","Remove Vertex":"Удалить вершину","Insert Vertex":"Вставить вершину","Change to Line Segment":"Изменить на сегмент линии","Change to Arc Segment":"Изменить на сегмент дуги","Change to Ellipse Segment":"Изменить на сегмент эллипса","Remove Shape":"Удалить форму","Remove Shape Part":"Удалить деталь формы","Remove Hole":"Удалить отверстие","Remove Loop":"Удалить контур","Invalid shape":"Ошибка: недопустимая форма"}'),tr:JSON.parse('{"@@locale":"tr","@@context":"Edit2D Uzantısı","Apply as Cutout":"Kesim Olarak Uygula","Remove Shapes":"Şekilleri Kaldır","Unify Shapes":"Şekilleri Birleştir","Remove Vertex":"Tepe Noktayı Kaldır","Insert Vertex":"Tepe Nokta Ekle","Change to Line Segment":"Çizgi Segmetine Değiştir","Change to Arc Segment":"Yay Segmentine Değiştir","Change to Ellipse Segment":"Elips Segmentine Değiştir","Remove Shape":"Şekli Kaldır","Remove Shape Part":"Şekil Parçasını Kaldır","Remove Hole":"Deliği Kaldır","Remove Loop":"Döngüyü Kaldır","Invalid shape":"Hata: Geçersiz şekil"}'),"zh-HANS":JSON.parse('{"@@locale":"zh-Hans","@@context":"编辑二维扩展","Apply as Cutout":"应用为裁切","Remove Shapes":"删除形状","Unify Shapes":"统一形状","Remove Vertex":"删除顶点","Insert Vertex":"插入顶点","Change to Line Segment":"更改为线段","Change to Arc Segment":"更改为圆弧段","Change to Ellipse Segment":"更改为椭圆段","Remove Shape":"删除形状","Remove Shape Part":"删除形状部件","Remove Hole":"删除孔","Remove Loop":"删除回路","Invalid shape":"错误: 形状无效"}'),"zh-HANT":JSON.parse('{"@@locale":"zh-Hant","@@context":"Edit2D 延伸","Apply as Cutout":"套用為凹口","Remove Shapes":"移除造型","Unify Shapes":"統一造型","Remove Vertex":"移除頂點","Insert Vertex":"插入頂點","Change to Line Segment":"變更為線段","Change to Arc Segment":"變更為弧線段","Change to Ellipse Segment":"變更為橢圓線段","Remove Shape":"移除造型","Remove Shape Part":"移除造型零件","Remove Hole":"移除孔","Remove Loop":"移除迴路","Invalid shape":"錯誤: 造型無效"}'),"zh-HK":JSON.parse('{"@@locale":"zh-hk","@@context":"編輯 2D 擴充程式","Apply as Cutout":"套用為剪裁圖樣","Remove Shapes":"移除形狀","Unify Shapes":"統一形狀","Remove Vertex":"移除頂點","Insert Vertex":"插入頂點","Change to Line Segment":"變更至線區段","Change to Arc Segment":"變更至弧形區段","Change to Ellipse Segment":"變更至橢圓形區段","Remove Shape":"移除形狀","Remove Shape Part":"移除形狀部分","Remove Hole":"移除洞孔","Remove Loop":"移除迴圈","Invalid shape":"錯誤：無效形狀"}'),nl:JSON.parse('{"@@locale":"nl","@@context":"Edit2D-uitbreiding","Apply as Cutout":"Toepassen als uitsnijding","Remove Shapes":"Vormen verwijderen","Unify Shapes":"Vormen uniform maken","Remove Vertex":"Vertex verwijderen","Insert Vertex":"Vertex invoegen","Change to Line Segment":"Wijzigen in lijnsegment","Change to Arc Segment":"Wijzigen in boogsegment","Change to Ellipse Segment":"Wijzigen in ellipssegment","Remove Shape":"Vorm verwijderen","Remove Shape Part":"Vormgedeelte verwijderen","Remove Hole":"Gat verwijderen","Remove Loop":"Lus verwijderen","Invalid shape":"Fout: Ongeldige vorm"}'),sv:JSON.parse('{"@@locale":"sv","@@context":"Edit2D-tillägg","Apply as Cutout":"Använd som utsnitt","Remove Shapes":"Ta bort former","Unify Shapes":"Unifiera former","Remove Vertex":"Ta bort Vertex","Insert Vertex":"Infoga Vertex","Change to Line Segment":"Ändra till linjesegment","Change to Arc Segment":"Ändra till bågsegment","Change to Ellipse Segment":"Ändra till ellipssegment","Remove Shape":"Ta bort form","Remove Shape Part":"Ta bort del av form","Remove Hole":"Ta bort hål","Remove Loop":"Ta bort slinga","Invalid shape":"Fel: felaktig form"}'),da:JSON.parse('{"@@locale":"da","@@context":"Edit2D-udvidelse","Apply as Cutout":"Anvend som udskæring","Remove Shapes":"Fjern former","Unify Shapes":"Ensret former","Remove Vertex":"Fjern toppunkt","Insert Vertex":"Indsæt toppunkt","Change to Line Segment":"Skift til linjesegment","Change to Arc Segment":"Skift til buesegment","Change to Ellipse Segment":"Skift til ellipsesegment","Remove Shape":"Fjern form","Remove Shape Part":"Fjern formdel","Remove Hole":"Fjern hul","Remove Loop":"Fjern loop","Invalid shape":"Fejl: Ugyldig form"}')},uo=r(93379),co=r.n(uo),ho=r(7795),po=r.n(ho),fo=r(90569),go=r.n(fo),vo=r(3565),yo=r.n(vo),mo=r(19216),_o=r.n(mo),Eo=r(44589),xo=r.n(Eo),bo=r(95443),Ao={};function Co(e){return Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Co(e)}function To(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Po(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Po(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function Po(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Ro(e,t,r,i,n,o,s){try{var a=e[o](s),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(i,n)}function So(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Vo(e,t,r){return t&&So(e.prototype,t),r&&So(e,r),e}function wo(e,t){return wo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},wo(e,t)}function Mo(e,t){return!t||"object"!==Co(t)&&"function"!=typeof t?Lo(e):t}function Lo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oo(e){return Oo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Oo(e)}function ko(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Ao.styleTagTransform=xo(),Ao.setAttributes=yo(),Ao.insert=go().bind(null,"head"),Ao.domAPI=po(),Ao.insertStyleElement=_o(),co()(bo.Z,Ao),bo.Z&&bo.Z.locals&&bo.Z.locals;var Io=AutodeskNamespace("Autodesk.Edit2D"),Fo=Autodesk.Viewing,No=function e(t,r){ko(this,e),this.name=t,this.autoReactivate=r,this.context=null,this.tools={}},Do=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wo(e,t)}(s,e);var t,r,i,n,o=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Oo(i);if(n){var r=Oo(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Mo(this,e)});function s(e,t){var r;return ko(this,s),(r=o.call(this,e,t)).extendLocalization(lo),r.undoStack=new Ge,r._registeredTools=new Map,r._boundOnModelAdded=r._onModelAdded.bind(Lo(r)),r._boundOnModelRemoved=r._onModelRemoved.bind(Lo(r)),r._boundOnSelectionChanged=r._onSelectionChanged.bind(Lo(r)),r}return Vo(s,[{key:"load",value:(t=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.viewer.impl.createOverlayScene("Edit2D"),e.next=3,this.viewer.loadExtension("Autodesk.Snapping");case 3:this.viewer.addEventListener(Fo.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.addEventListener(Fo.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),this.undoTool=new no(this.undoStack),this.viewer.toolController.registerTool(this.undoTool),this.viewer.toolController.activateTool(this.undoTool.getName());case 8:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,r=arguments;return new Promise((function(i,n){var o=t.apply(e,r);function s(e){Ro(o,i,n,s,a,"next",e)}function a(e){Ro(o,i,n,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"unload",value:function(){var e,t=To(this._registeredTools.keys());try{for(t.s();!(e=t.n()).done;){var r=e.value;this.unregisterTools(r)}}catch(e){t.e(e)}finally{t.f()}return this.viewer.toolController.deregisterTool(this.undoTool),this.undoTool=null,this.viewer.removeEventListener(Fo.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.removeEventListener(Fo.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),!0}},{key:"_onModelAdded",value:function(){var e=this;if(1===this.viewer.getVisibleModels().length){var t,r=To(this._registeredTools.values());try{for(r.s();!(t=r.n()).done;){var i,n=t.value;n.autoReactivate&&(null===(i=n.toolsToReactivate)||void 0===i||i.forEach((function(t){return e.viewer.toolController.activateTool(t)})))}}catch(e){r.e(e)}finally{r.f()}}}},{key:"_onModelRemoved",value:function(){if(0===this.viewer.getVisibleModels().length){var e,t=this.viewer.toolController,r=To(this._registeredTools.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;i.autoReactivate&&(i.toolsToReactivate=Object.values(i.tools).map((function(e){return e.getNames()})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return t.isToolActivated(e)})),i.toolsToReactivate.forEach((function(e){return t.deactivateTool(e)})))}}catch(e){r.e(e)}finally{r.f()}}}},{key:"_onSelectionChanged",value:function(e){var t,r=e.target,i=To(this._registeredTools.values());try{for(i.s();!(t=i.n()).done;){var n=t.value;r===n.context.selection||r.empty()||n.context.selection.clear()}}catch(e){i.e(e)}finally{i.f()}}},{key:"registerDefaultTools",value:function(){this.defaultContext=this.registerTools("default")}},{key:"getToolSet",value:function(e){return this._registeredTools.get(e)}},{key:"registerTools",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this._registeredTools.get(e);if(i)return console.warn("Edit 2D tools are already registered for tool set '".concat(e,"'")),i.context;i=new No(e,t),this._registeredTools.set(e,i);var n=i.context=new Bo(this,e,r);n.selection.addEventListener(He.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),i.tools.polygonTool=new pn(n,pn.Mode.Polygon),i.tools.polylineTool=new pn(n,pn.Mode.Polyline),i.tools.moveTool=new Mi(n),i.tools.polygonEditTool=new Wn(n),i.tools.insertSymbolTool=new to(n),i.tools.copyTool=new ao(n);var o=Boolean(this.options.enableArcs);i.tools.polygonTool.setArcsEnabled(o),i.tools.polylineTool.setArcsEnabled(o),this.options.enableEllipseArcs&&(i.tools.polygonEditTool.enableEllipseArcs=!0);var s=this.viewer.toolController;return s.registerTool(i.tools.polygonTool),s.registerTool(i.tools.polylineTool),s.registerTool(i.tools.moveTool),s.registerTool(i.tools.polygonEditTool),s.registerTool(i.tools.insertSymbolTool),s.registerTool(i.tools.copyTool),s.activateTool(i.tools.copyTool.getName()),i.contextMenu=new Xt(this.viewer,i),i.contextMenu.register(),n}},{key:"unregisterDefaultTools",value:function(){this.unregisterTools("default"),this.defaultContext=null}},{key:"unregisterTools",value:function(e){var t=this._registeredTools.get(e);if(t){var r=this.viewer.toolController;r.deregisterTool(t.tools.polygonTool),r.deregisterTool(t.tools.polylineTool),r.deregisterTool(t.tools.moveTool),r.deregisterTool(t.tools.polygonEditTool),r.deregisterTool(t.tools.insertSymbolTool),r.deregisterTool(t.tools.copyTool),t.context.selection.removeEventListener(He.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),t.contextMenu.unregister(),t.contextMenu=null,this._registeredTools.delete(e)}}},{key:"createLayer",value:function(e){this.viewer.model||console.error("A 2D model is needed to adjust viewport");var t=new l(this.viewer,e);return e.useSceneAfter||this.viewer.impl.overlayScenes.Edit2D.scene.add(t.scene),t}},{key:"defaultTools",get:function(){var e=this._registeredTools.get("default");return e&&e.tools}}]),s}(Fo.Extension),Bo=function(){function e(t,r){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};ko(this,e),this.toolSetName=r,this.ext=t,this.viewer=t.viewer,this.layer=t.createLayer(n),this.gizmoLayer=t.createLayer(n),this.undoStack=t.undoStack,this.clipboard=new c,this.selection=new He(this.layer,this.undoStack),this.snapper=new qt(this.viewer,this.layer,this.gizmoLayer),this.unitHandler=new _r(this.viewer),this.mouseTracker=t.options.mouseTracker;var o=function(){i.layer.updateCanvasGizmos(),i.gizmoLayer.updateCanvasGizmos()};this.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,o)}return Vo(e,[{key:"setAllGizmosEnabled",value:function(e){this.ext.getToolSet(this.toolSetName).tools.polygonEditTool.setAllGizmosEnabled(e)}},{key:"setMatrix",value:function(e){this.layer.setMatrix(e),this.gizmoLayer.setMatrix(e),this.layer.update(),this.gizmoLayer.update()}},{key:"clearLayer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e){var t=new bt.RemoveShapes(this.layer,this.layer.shapes);this.undoStack.run(t)}else this.layer.clear(),this.undoStack.clear()}},{key:"addShape",value:function(e){var t=new bt.AddShape(this.layer,e);this.undoStack.run(t)}},{key:"removeShape",value:function(e){var t=new bt.RemoveShape(this.layer,e);this.undoStack.run(t)}}]),e}();Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Edit2D",Do),Io.Shape=fe,Io.Polygon=me,Io.Polyline=_e,Io.PolyBase=ve,Io.Path=Ve,Io.PolygonPath=we,Io.PolylinePath=Me,Io.Circle=Le,Io.Style=he,Io.EllipseArcParams=Se,Io.PolygonTool=pn,Io.Selection=He,Io.MoveTool=Mi,Io.PolygonEditTool=Wn,Io.VertexMoveTool=wn,Io.EdgeMoveTool=zn,Io.InsertSymbolTool=to,Io.Math2D=m,Io.VertexGizmo=Kr,Io.RectangleTool=Hi,Io.LineTool=en,Io.CopyTool=ao,Io.Actions=bt,Io.UndoStack=Ge,Io.Clipboard=c,Io.UndoTool=no,Io.Edit2DContext=Bo,Io.CanvasGizmo=Fr,Io.CanvasGizmoBase=Ir,Io.ShapeLabel=Br,Io.AlignX=Lr,Io.AlignY=Or,Io.AreaLabel=jr,Io.EdgeLabel=Yr,Io.UnitHandler=vr,Io.SimpleUnitHandler=mr,Io.DefaultUnitHandler=_r,Io.ShapeLabelRule=Xr,Io.ShapeWrapper=Oe,Io.SegmentTree=Gt,Io.TangentGizmo=ti,Io.MeasureTransform=ir,Io.DefaultMeasureTransform=nr,Io.ShapeToolTip=Jr,Io.Svg=V,Io.SolidDefConvert=D,Io.BooleanOps=Je,Io.LoopType=ge,Io.EdgeType=Ee,Io.FadeOutStyleRule=Wr,Io.EditLayer=l,Io.ScreenOverlay=vi,Io.Arrow=ze,Io.AngleGizmo=Ei,Io.AngleGizmo3d=Si,Io.TextLabel=Dr,Io.Trackings={ButtonDown:"buttonDown",ButtonUp:"buttonUp",Click:"click",Drag:"drag"}},32230:function(module,exports){function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var e,t;e="undefined"!=typeof self?self:this,t=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=86)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=!1;"undefined"!=typeof window&&window.isJaguar&&(t.isSceneComposerEnv=i=!0);var n=!1;i&&(t.USE_LEGACY_LEIDS=n=window.isJaguar&&window.isJaguar()||!!JSON.parse(localStorage.getItem("USE_LEGACY_LEIDS"))),t.KERNEL_TOLERANCE=1e-6,t.KERNEL_ANGULAR_TOLERANCE=1e-10,t.PARAMETER_SPACE_TOLERANCE=1e-10,t.SPLINE_TANGENT_HANDLE_SCALE=1,t.SPLINE_DISTANCE_TOLERANCE=1e-4,t.DEFAULT_CURVE_RESOLUTION=64,t.isSceneComposerEnv=i,t.NO_ID="",t.USE_LEGACY_LEIDS=n,t.TESSELLATION={LINEAR_PRECISION:1e-4,ANGULAR_PRECISION:1e-5},t.GEOMETRY_TYPES={POINT:1,BCURVE:2,CIRCLE:3,ELLIPSE:4,HAPCURVE:5,LINE:6,BSURFACE:7,CONE:8,CYLINDER:9,ELLIPTICAL_CONE:10,ELLIPTICAL_CYLINDER:11,PLANE:12,SPHERE:13,TORUS:14,toString:function(e){switch(e){case this.POINT:return"Point";case this.BCURVE:return"BCurve";case this.CIRCLE:return"Circle";case this.ELLIPSE:return"Ellipse";case this.HAPCURVE:return"HapCurve";case this.LINE:return"Line";case this.BSURFACE:return"BSurface";case this.CONE:return"Cone";case this.CYLINDER:return"Cylinder";case this.ELLIPTICAL_CONE:return"EllipticalCone";case this.ELLIPTICAL_CYLINDER:return"EllipticalCylinder";case this.PLANE:return"Plane";case this.SPHERE:return"Sphere";case this.TORUS:return"Torus";default:return"unknown"}}},t.TOPOLOGY_TYPES={VERTEX:1,EDGE:2,COEDGE:3,LOOP:4,FACE:5,SHELL:6,LUMP:7,BODY:8,WIRE:9,WIREBODY:10,toString:function(e){switch(e){case this.VERTEX:return"Vertex";case this.EDGE:return"Edge";case this.COEDGE:return"Coedge";case this.LOOP:return"Loop";case this.FACE:return"Face";case this.SHELL:return"Shell";case this.LUMP:return"Lump";case this.BODY:return"Body";case this.WIRE:return"Wire";case this.WIREBODY:return"WireBody";default:return"unknown"}}}},function(e,t,r){"use strict";r.r(t),r.d(t,"Vector2",(function(){return s})),r.d(t,"Vector3",(function(){return l})),r.d(t,"Vector4",(function(){return c})),r.d(t,"Matrix22",(function(){return d})),r.d(t,"Matrix33",(function(){return f})),r.d(t,"Matrix44",(function(){return v})),r.d(t,"Quat",(function(){return m})),r.d(t,"ProjectionUtils",(function(){return _})),r.d(t,"FLOAT64_TOLERANCE",(function(){return i})),r.d(t,"FLOAT32_TOLERANCE",(function(){return n}));var i=1e-12,n=1e-6,o={createFloat32:function(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e},createFloat64:function(){var e=new Float64Array(2);return e[0]=0,e[1]=0,e},createNumber:function(){return[0,0]},clone:function(e){var t=new e.constructor(2);return t[0]=e[0],t[1]=e[1],t},createFloat32FromValues:function(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}};o.asFloat32=o.createFloat32FromValues,o.createFloat64FromValues=function(e,t){var r=new Float64Array(2);return r[0]=e,r[1]=t,r},o.asFloat64=o.createFloat64FromValues,o.createNumberFromValues=function(e,t){return[e,t]},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},o.set=function(e,t,r){return e[0]=t,e[1]=r,e},o.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},o.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},o.sub=o.subtract,o.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},o.mul=o.multiply,o.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},o.div=o.divide,o.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},o.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},o.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},o.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},o.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},o.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},o.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},o.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},o.len=o.length,o.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},o.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},o.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},o.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},o.lerp=function(e,t,r,i){var n=t[0],o=t[1];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e},o.random=function(e,t){t=t||1;var r=2*Math.random()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},o.transformMatrix22=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},o.transformMatrix33=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},o.transformMatrix44=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},o.angle=function(e,t){var r=o.clone(e),i=o.clone(t);o.normalize(r,r),o.normalize(i,i);var n=o.dot(r,i),s=Math.abs(r[0]*i[1]-r[1]*i[0]);return Math.atan2(s,n)},o.isParallel=function(e,t,r,n){n=n||i,r=r||0;var s=e[0]*t[1]-e[1]*t[0];return!(s*s>n*n*o.squaredLength(e)*o.squaredLength(t))&&(r>0?o.dot(e,t)>0:!(r<0)||o.dot(e,t)<0)},o.isOrthogonal=function(e,t,r){r=r||i;var n=o.dot(e,t);return n*n<=r*r*o.squaredLength(e)*o.squaredLength(t)},o.toString=function(e){return"["+e[0]+", "+e[1]+"]"},o.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},o.equals=function(e,t,r){return r=r||i,Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r};var s=o,a={createFloat32:function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e},createFloat64:function(){var e=new Float64Array(3);return e[0]=0,e[1]=0,e[2]=0,e},createNumber:function(){return[0,0,0]},clone:function(e){var t=new e.constructor(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},createFloat32FromValues:function(e,t,r){var i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}};a.asFloat32=a.createFloat32FromValues,a.createFloat64FromValues=function(e,t,r){var i=new Float64Array(3);return i[0]=e,i[1]=t,i[2]=r,i},a.asFloat64=a.createFloat64FromValues,a.createNumberFromValues=function(e,t,r){return[e,t,r]},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},a.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},a.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},a.sub=a.subtract,a.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},a.mul=a.multiply,a.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},a.div=a.divide,a.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},a.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},a.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},a.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},a.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},a.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},a.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},a.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)},a.dist=a.distance,a.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)},a.len=a.length,a.squaredLength=function(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},a.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.cross=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=r[0],a=r[1],l=r[2];return e[0]=n*l-o*a,e[1]=o*s-i*l,e[2]=i*a-n*s,e},a.lerp=function(e,t,r,i){var n=t[0],o=t[1],s=t[2];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=s+i*(r[2]-s),e},a.hermite=function(e,t,r,i,n,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,u=s*(o-1),c=s*(3-2*o);return e[0]=t[0]*a+r[0]*l+i[0]*u+n[0]*c,e[1]=t[1]*a+r[1]*l+i[1]*u+n[1]*c,e[2]=t[2]*a+r[2]*l+i[2]*u+n[2]*c,e},a.bezier=function(e,t,r,i,n,o){var s=1-o,a=s*s,l=o*o,u=a*s,c=3*o*a,h=3*l*s,d=l*o;return e[0]=t[0]*u+r[0]*c+i[0]*h+n[0]*d,e[1]=t[1]*u+r[1]*c+i[1]*h+n[1]*d,e[2]=t[2]*u+r[2]*c+i[2]*h+n[2]*d,e},a.random=function(e,t){t=t||1;var r=2*Math.random()*Math.PI,i=2*Math.random()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e},a.transformMatrix44=function(e,t,r){var i=t[0],n=t[1],o=t[2];return e[0]=r[0]*i+r[4]*n+r[8]*o+r[12],e[1]=r[1]*i+r[5]*n+r[9]*o+r[13],e[2]=r[2]*i+r[6]*n+r[10]*o+r[14],e},a.transformAsDirectionMatrix44=function(e,t,r){var i=t[0],n=t[1],o=t[2];return e[0]=r[0]*i+r[4]*n+r[8]*o,e[1]=r[1]*i+r[5]*n+r[9]*o,e[2]=r[2]*i+r[6]*n+r[10]*o,e},a.transformMatrix33=function(e,t,r){var i=t[0],n=t[1],o=t[2];return e[0]=i*r[0]+n*r[3]+o*r[6],e[1]=i*r[1]+n*r[4]+o*r[7],e[2]=i*r[2]+n*r[5]+o*r[8],e},a.transformQuat=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=r[0],a=r[1],l=r[2],u=r[3],c=u*i+a*o-l*n,h=u*n+l*i-s*o,d=u*o+s*n-a*i,p=-s*i-a*n-l*o;return e[0]=c*u+p*-s+h*-l-d*-a,e[1]=h*u+p*-a+d*-s-c*-l,e[2]=d*u+p*-l+c*-a-h*-s,e},a.setFromMatrixScale=function(e,t){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),n=Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);return e[0]=r,e[1]=i,e[2]=n,e},a.rotateX=function(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},a.rotateY=function(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},a.rotateZ=function(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},a.angle=function(e,t){var r=a.clone(e),i=a.clone(t);a.normalize(r,r),a.normalize(i,i);var n=a.dot(r,i),o=a.length(a.cross(r,r,i));return Math.atan2(o,n)},a.isParallel=function(e,t,r,n){n=n||i,r=r||0;var o=a.createFloat64();return a.cross(o,e,t),!(a.squaredLength(o)>n*n*a.squaredLength(e)*a.squaredLength(t))&&(r>0?a.dot(e,t)>0:!(r<0)||a.dot(e,t)<0)},a.isOrthogonal=function(e,t,r){r=r||i;var n=a.dot(e,t);return n*n<=r*r*a.squaredLength(e)*a.squaredLength(t)},a.computeOrthogonal=function(e,t){return t[0]*t[0]>t[2]*t[2]?a.set(e,t[1],-t[0],0):a.set(e,0,t[2],-t[1]),e},a.setEulerFromRotationMatrix=function(e,t,r){var n=1-i;function o(e){return Math.min(Math.max(e,-1),1)}var s=t[0],a=t[4],l=t[8],u=t[1],c=t[5],h=t[9],d=t[2],p=t[6],f=t[10];return void 0===r||"XYZ"===r?(e[1]=Math.asin(o(l)),Math.abs(l)<n?(e[0]=Math.atan2(-h,f),e[2]=Math.atan2(-a,s)):(e[0]=Math.atan2(p,c),e[2]=0)):"YXZ"===r?(e[0]=Math.asin(-o(h)),Math.abs(h)<n?(e[1]=Math.atan2(l,f),e[2]=Math.atan2(u,c)):(e[1]=Math.atan2(-d,s),e[2]=0)):"ZXY"===r?(e[0]=Math.asin(o(p)),Math.abs(p)<n?(e[1]=Math.atan2(-d,f),e[2]=Math.atan2(-a,c)):(e[1]=0,e[2]=Math.atan2(u,s))):"ZYX"===r?(e[1]=Math.asin(-o(d)),Math.abs(d)<n?(e[0]=Math.atan2(p,f),e[2]=Math.atan2(u,s)):(e[0]=0,e[2]=Math.atan2(-a,c))):"YZX"===r?(e[2]=Math.asin(o(u)),Math.abs(u)<n?(e[0]=Math.atan2(-h,c),e[1]=Math.atan2(-d,s)):(e[0]=0,e[1]=Math.atan2(l,f))):"XZY"===r&&(e[2]=Math.asin(-o(a)),Math.abs(a)<n?(e[0]=Math.atan2(p,c),e[1]=Math.atan2(l,s)):(e[0]=Math.atan2(-h,f),e[1]=0)),e},a.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},a.equals=function(e,t,r){return r=r||i,Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r};var l=a,u={createFloat32:function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},createFloat64:function(){var e=new Float64Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},createNumber:function(){return[0,0,0,0]},clone:function(e){var t=new e.constructor(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},createFloat32FromValues:function(e,t,r,i){var n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}};u.asFloat32=u.createFloat32FromValues,u.createFloat64FromValues=function(e,t,r,i){var n=new Float64Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},u.asFloat64=u.createFloat64FromValues,u.createNumberFromValues=function(e,t,r,i){return[e,t,r,i]},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},u.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},u.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},u.sub=u.subtract,u.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},u.mul=u.multiply,u.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},u.div=u.divide,u.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},u.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},u.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},u.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},u.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},u.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},u.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},u.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+o*o)},u.dist=u.distance,u.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return r*r+i*i+n*n+o*o},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)},u.len=u.length,u.squaredLength=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},u.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},u.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r*r+i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=o*s),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},u.lerp=function(e,t,r,i){var n=t[0],o=t[1],s=t[2],a=t[3];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=s+i*(r[2]-s),e[3]=a+i*(r[3]-a),e},u.random=function(e,t){return t=t||1,e[0]=Math.random(),e[1]=Math.random(),e[2]=Math.random(),e[3]=Math.random(),u.normalize(e,e),u.scale(e,e,t),e},u.transformMatrix44=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*s,e[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*s,e[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*s,e[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*s,e},u.transformQuat=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=r[0],a=r[1],l=r[2],u=r[3],c=u*i+a*o-l*n,h=u*n+l*i-s*o,d=u*o+s*n-a*i,p=-s*i-a*n-l*o;return e[0]=c*u+p*-s+h*-l-d*-a,e[1]=h*u+p*-a+d*-s-c*-l,e[2]=d*u+p*-l+c*-a-h*-s,e[3]=t[3],e},u.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},u.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},u.equals=function(e,t,r){return r=r||i,Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[2]-t[2])<=r};var c=u,h={createFloat32:function(){var e=new Float32Array(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},createFloat64:function(){var e=new Float64Array(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},createNumber:function(){return[1,0,0,1]},clone:function(e){var t=new e.constructor(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},createFloat32FromValues:function(e,t,r,i){var n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}};h.asFloat32=h.createFloat32FromValues,h.createFloat64FromValues=function(e,t,r,i){var n=new Float64Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},h.asFloat64=h.createFloat64FromValues,h.createNumberFromValues=function(e,t,r,i){return[e,t,r,i]},h.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},h.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},h.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},h.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r*o-n*i;return s?(s=1/s,e[0]=o*s,e[1]=-i*s,e[2]=-n*s,e[3]=r*s,e):null},h.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},h.multiply=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*a+o*l,e[1]=n*a+s*l,e[2]=i*u+o*c,e[3]=n*u+s*c,e},h.mul=h.multiply,h.scale=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=n*a,e[2]=o*l,e[3]=s*l,e},h.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},h.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},h.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},h.sub=h.subtract,h.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},h.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},h.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},h.equals=function(e,t,r){return r=r||i,Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r};var d=h,p={createFloat32:function(){var e=new Float32Array(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},createFloat64:function(){var e=new Float64Array(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},createNumber:function(){return[1,0,0,0,1,0,0,0,1]},fromMatrix44:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new e.constructor(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},createFloat32FromValues:function(e,t,r,i,n,o,s,a,l){var u=new Float32Array(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=i,u[4]=n,u[5]=o,u[6]=s,u[7]=a,u[8]=l,u}};p.asFloat32=p.createFloat32FromValues,p.createFloat64FromValues=function(e,t,r,i,n,o,s,a,l){var u=new Float64Array(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=i,u[4]=n,u[5]=o,u[6]=s,u[7]=a,u[8]=l,u},p.asFloat64=p.createFloat64FromValues,p.createNumberFromValues=function(e,t,r,i,n,o,s,a,l){return[e,t,r,i,n,o,s,a,l]},p.set=function(e,t,r,i,n,o,s,a,l,u){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=u,e},p.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},p.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=c*s-a*u,d=-c*o+a*l,p=u*o-s*l,f=r*h+i*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-c*i+n*u)*f,e[2]=(a*i-n*s)*f,e[3]=d*f,e[4]=(c*r-n*l)*f,e[5]=(-a*r+n*o)*f,e[6]=p*f,e[7]=(-u*r+i*l)*f,e[8]=(s*r-i*o)*f,e):null},p.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8];return t*(u*o-s*l)+r*(-u*n+s*a)+i*(l*n-o*a)},p.multiply=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],p=r[1],f=r[2],g=r[3],v=r[4],y=r[5],m=r[6],_=r[7],E=r[8];return e[0]=d*i+p*s+f*u,e[1]=d*n+p*a+f*c,e[2]=d*o+p*l+f*h,e[3]=g*i+v*s+y*u,e[4]=g*n+v*a+y*c,e[5]=g*o+v*l+y*h,e[6]=m*i+_*s+E*u,e[7]=m*n+_*a+E*c,e[8]=m*o+_*l+E*h,e},p.mul=p.multiply,p.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},p.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r+r,a=i+i,l=n+n,u=r*s,c=i*s,h=i*a,d=n*s,p=n*a,f=n*l,g=o*s,v=o*a,y=o*l;return e[0]=1-h-f,e[3]=c-y,e[6]=d+v,e[1]=c+y,e[4]=1-u-f,e[7]=p-g,e[2]=d-v,e[5]=p+g,e[8]=1-u-h,e},p.normalFromMatrix44=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],v=t[14],y=t[15],m=r*a-i*s,_=r*l-n*s,E=r*u-o*s,x=i*l-n*a,b=i*u-o*a,A=n*u-o*l,C=c*g-h*f,T=c*v-d*f,P=c*y-p*f,R=h*v-d*g,S=h*y-p*g,V=d*y-p*v,w=m*V-_*S+E*R+x*P-b*T+A*C;return w?(w=1/w,e[0]=(a*V-l*S+u*R)*w,e[1]=(l*P-s*V-u*T)*w,e[2]=(s*S-a*P+u*C)*w,e[3]=(n*S-i*V-o*R)*w,e[4]=(r*V-n*P+o*T)*w,e[5]=(i*P-r*S-o*C)*w,e[6]=(g*A-v*b+y*x)*w,e[7]=(v*E-f*A-y*_)*w,e[8]=(f*b-g*E+y*m)*w,e):null},p.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"},p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},p.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e},p.sub=p.subtract,p.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},p.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},p.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},p.equals=function(e,t,r){return r=r||i,Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r&&Math.abs(e[4]-t[4])<=r&&Math.abs(e[5]-t[5])<=r&&Math.abs(e[6]-t[6])<=r&&Math.abs(e[7]-t[7])<=r&&Math.abs(e[8]-t[8])<=r};var f=p,g={createFloat32:function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},createFloat64:function(){var e=new Float64Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},createNumber:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},clone:function(e){var t=new e.constructor(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},createFloat32FromValues:function(e,t,r,i,n,o,s,a,l,u,c,h,d,p,f,g){var v=new Float32Array(16);return v[0]=e,v[1]=t,v[2]=r,v[3]=i,v[4]=n,v[5]=o,v[6]=s,v[7]=a,v[8]=l,v[9]=u,v[10]=c,v[11]=h,v[12]=d,v[13]=p,v[14]=f,v[15]=g,v}};g.asFloat32=g.createFloat32FromValues,g.createFloat64FromValues=function(e,t,r,i,n,o,s,a,l,u,c,h,d,p,f,g){var v=new Float64Array(16);return v[0]=e,v[1]=t,v[2]=r,v[3]=i,v[4]=n,v[5]=o,v[6]=s,v[7]=a,v[8]=l,v[9]=u,v[10]=c,v[11]=h,v[12]=d,v[13]=p,v[14]=f,v[15]=g,v},g.asFloat64=g.createFloat64FromValues,g.createNumberFromValues=function(e,t,r,i,n,o,s,a,l,u,c,h,d,p,f,g){return[e,t,r,i,n,o,s,a,l,u,c,h,d,p,f,g]},g.set=function(e,t,r,i,n,o,s,a,l,u,c,h,d,p,f,g,v){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=u,e[9]=c,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=g,e[15]=v,e},g.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=n,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},g.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],v=t[14],y=t[15],m=r*a-i*s,_=r*l-n*s,E=r*u-o*s,x=i*l-n*a,b=i*u-o*a,A=n*u-o*l,C=c*g-h*f,T=c*v-d*f,P=c*y-p*f,R=h*v-d*g,S=h*y-p*g,V=d*y-p*v,w=m*V-_*S+E*R+x*P-b*T+A*C;return w?(w=1/w,e[0]=(a*V-l*S+u*R)*w,e[1]=(n*S-i*V-o*R)*w,e[2]=(g*A-v*b+y*x)*w,e[3]=(d*b-h*A-p*x)*w,e[4]=(l*P-s*V-u*T)*w,e[5]=(r*V-n*P+o*T)*w,e[6]=(v*E-f*A-y*_)*w,e[7]=(c*A-d*E+p*_)*w,e[8]=(s*S-a*P+u*C)*w,e[9]=(i*P-r*S-o*C)*w,e[10]=(f*b-g*E+y*m)*w,e[11]=(h*E-c*b-p*m)*w,e[12]=(a*T-s*R-l*C)*w,e[13]=(r*R-i*T+n*C)*w,e[14]=(g*_-f*x-v*m)*w,e[15]=(c*x-h*_+d*m)*w,e):null},g.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],g=e[14],v=e[15];return(t*s-r*o)*(h*v-d*g)-(t*a-i*o)*(c*v-d*f)+(t*l-n*o)*(c*g-h*f)+(r*a-i*s)*(u*v-d*p)-(r*l-n*s)*(u*g-h*p)+(i*l-n*a)*(u*f-c*p)},g.multiply=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],g=t[12],v=t[13],y=t[14],m=t[15],_=r[0],E=r[1],x=r[2],b=r[3];return e[0]=_*i+E*a+x*h+b*g,e[1]=_*n+E*l+x*d+b*v,e[2]=_*o+E*u+x*p+b*y,e[3]=_*s+E*c+x*f+b*m,_=r[4],E=r[5],x=r[6],b=r[7],e[4]=_*i+E*a+x*h+b*g,e[5]=_*n+E*l+x*d+b*v,e[6]=_*o+E*u+x*p+b*y,e[7]=_*s+E*c+x*f+b*m,_=r[8],E=r[9],x=r[10],b=r[11],e[8]=_*i+E*a+x*h+b*g,e[9]=_*n+E*l+x*d+b*v,e[10]=_*o+E*u+x*p+b*y,e[11]=_*s+E*c+x*f+b*m,_=r[12],E=r[13],x=r[14],b=r[15],e[12]=_*i+E*a+x*h+b*g,e[13]=_*n+E*l+x*d+b*v,e[14]=_*o+E*u+x*p+b*y,e[15]=_*s+E*c+x*f+b*m,e},g.mul=g.multiply,g.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},g.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromRotation=function(e,t,r){var n,o,s,a=r[0],l=r[1],u=r[2],c=Math.sqrt(a*a+l*l+u*u);return Math.abs(c)<i?null:(a*=c=1/c,l*=c,u*=c,n=Math.sin(t),s=1-(o=Math.cos(t)),e[0]=a*a*s+o,e[1]=l*a*s+u*n,e[2]=u*a*s-l*n,e[3]=0,e[4]=a*l*s-u*n,e[5]=l*l*s+o,e[6]=u*l*s+a*n,e[7]=0,e[8]=a*u*s+l*n,e[9]=l*u*s-a*n,e[10]=u*u*s+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},g.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromRotationTranslation=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=i+i,l=n+n,u=o+o,c=i*a,h=i*l,d=i*u,p=n*l,f=n*u,g=o*u,v=s*a,y=s*l,m=s*u;return e[0]=1-(p+g),e[1]=h+m,e[2]=d-y,e[3]=0,e[4]=h-m,e[5]=1-(c+g),e[6]=f+v,e[7]=0,e[8]=d+y,e[9]=f-v,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},g.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},g.extractRotation=function(e,t){var r=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=1/Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),n=1/Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=0,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=0,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},g.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},g.fromRotationTranslationScale=function(e,t,r,i){var n=t[0],o=t[1],s=t[2],a=t[3],l=n+n,u=o+o,c=s+s,h=n*l,d=n*u,p=n*c,f=o*u,g=o*c,v=s*c,y=a*l,m=a*u,_=a*c,E=i[0],x=i[1],b=i[2];return e[0]=(1-(f+v))*E,e[1]=(d+_)*E,e[2]=(p-m)*E,e[3]=0,e[4]=(d-_)*x,e[5]=(1-(h+v))*x,e[6]=(g+y)*x,e[7]=0,e[8]=(p+m)*b,e[9]=(g-y)*b,e[10]=(1-(h+f))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},g.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){var o=t[0],s=t[1],a=t[2],l=t[3],u=o+o,c=s+s,h=a+a,d=o*u,p=o*c,f=o*h,g=s*c,v=s*h,y=a*h,m=l*u,_=l*c,E=l*h,x=i[0],b=i[1],A=i[2],C=n[0],T=n[1],P=n[2];return e[0]=(1-(g+y))*x,e[1]=(p+E)*x,e[2]=(f-_)*x,e[3]=0,e[4]=(p-E)*b,e[5]=(1-(d+y))*b,e[6]=(v+m)*b,e[7]=0,e[8]=(f+_)*A,e[9]=(v-m)*A,e[10]=(1-(d+g))*A,e[11]=0,e[12]=r[0]+C-(e[0]*C+e[4]*T+e[8]*P),e[13]=r[1]+T-(e[1]*C+e[5]*T+e[9]*P),e[14]=r[2]+P-(e[2]*C+e[6]*T+e[10]*P),e[15]=1,e},g.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r+r,a=i+i,l=n+n,u=r*s,c=i*s,h=i*a,d=n*s,p=n*a,f=n*l,g=o*s,v=o*a,y=o*l;return e[0]=1-h-f,e[1]=c+y,e[2]=d-v,e[3]=0,e[4]=c-y,e[5]=1-u-f,e[6]=p+g,e[7]=0,e[8]=d+v,e[9]=p-g,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.setRotationFromEuler=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=Math.cos(i),a=Math.sin(i),l=Math.cos(n),u=Math.sin(n),c=Math.cos(o),h=Math.sin(o);if(void 0===r||"XYZ"===r){var d=s*c,p=s*h,f=a*c,g=a*h;e[0]=l*c,e[4]=-l*h,e[8]=u,e[1]=p+f*u,e[5]=d-g*u,e[9]=-a*l,e[2]=g-d*u,e[6]=f+p*u,e[10]=s*l}else if("YXZ"===r){var v=l*c,y=l*h,m=u*c,_=u*h;e[0]=v+_*a,e[4]=m*a-y,e[8]=s*u,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=y*a-m,e[6]=_+v*a,e[10]=s*l}else if("ZXY"===r)v=l*c,y=l*h,m=u*c,_=u*h,e[0]=v-_*a,e[4]=-s*h,e[8]=m+y*a,e[1]=y+m*a,e[5]=s*c,e[9]=_-v*a,e[2]=-s*u,e[6]=a,e[10]=s*l;else if("ZYX"===r)d=s*c,p=s*h,f=a*c,g=a*h,e[0]=l*c,e[4]=f*u-p,e[8]=d*u+g,e[1]=l*h,e[5]=g*u+d,e[9]=p*u-f,e[2]=-u,e[6]=a*l,e[10]=s*l;else if("YZX"===r){var E=s*l,x=s*u,b=a*l,A=a*u;e[0]=l*c,e[4]=A-E*h,e[8]=b*h+x,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-u*c,e[6]=x*h+b,e[10]=E-A*h}else"XZY"===r&&(E=s*l,x=s*u,b=a*l,A=a*u,e[0]=l*c,e[4]=-h,e[8]=u*c,e[1]=E*h+A,e[5]=s*c,e[9]=x*h-b,e[2]=b*h-x,e[6]=a*c,e[10]=A*h+E);return e},g.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"},g.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},g.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e},g.sub=g.subtract,g.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},g.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},g.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},g.equals=function(e,t,r){return r=r||i,Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r&&Math.abs(e[4]-t[4])<=r&&Math.abs(e[5]-t[5])<=r&&Math.abs(e[6]-t[6])<=r&&Math.abs(e[7]-t[7])<=r&&Math.abs(e[8]-t[8])<=r&&Math.abs(e[9]-t[9])<=r&&Math.abs(e[10]-t[10])<=r&&Math.abs(e[11]-t[11])<=r&&Math.abs(e[12]-t[12])<=r&&Math.abs(e[13]-t[13])<=r&&Math.abs(e[14]-t[14])<=r&&Math.abs(e[15]-t[15])<=r};var v=g,y={createFloat32:function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},createFloat64:function(){var e=new Float64Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},createNumber:function(){return[0,0,0,1]}};y.rotationTo=function(){var e=l.createFloat64(),t=l.createFloat64FromValues(1,0,0),r=l.createFloat64FromValues(0,1,0);return function(n,o,s){var a=l.dot(o,s);return a<-1+i?(l.cross(e,t,o),l.length(e)<i&&l.cross(e,r,o),l.normalize(e,e),y.setAxisAngle(n,e,Math.PI),n):a>1-i?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(l.cross(e,o,s),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+a,y.normalize(n,n))}}(),y.setAxes=function(){var e=f.createFloat64();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],y.normalize(t,y.fromMatrix33(t,e))}}(),y.clone=c.clone,y.createFloat32FromValues=c.createFloat32FromValues,y.createFloat64FromValues=c.createFloat64FromValues,y.createNumberFromValues=c.createNumberFromValues,y.asFloat32=c.createFloat32FromValues,y.asFloat64=c.createFloat64FromValues,y.copy=c.copy,y.set=c.set,y.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},y.setAxisAngle=function(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e},y.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return 0!==i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},y.add=c.add,y.multiply=function(e,t,r){var i=t[0],n=t[1],o=t[2],s=t[3],a=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*c+s*a+n*u-o*l,e[1]=n*c+s*l+o*a-i*u,e[2]=o*c+s*u+i*l-n*a,e[3]=s*c-i*a-n*l-o*u,e},y.mul=y.multiply,y.scale=c.scale,y.rotateX=function(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=n*l+o*a,e[2]=o*l-n*a,e[3]=s*l-i*a,e},y.rotateY=function(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-o*a,e[1]=n*l+s*a,e[2]=o*l+i*a,e[3]=s*l-n*a,e},y.rotateZ=function(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=n*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},y.calculateW=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},y.dot=c.dot,y.lerp=c.lerp,y.slerp=function(e,t,r,n){var o,s,a,l,u,c=t[0],h=t[1],d=t[2],p=t[3],f=r[0],g=r[1],v=r[2],y=r[3];return(s=c*f+h*g+d*v+p*y)<0&&(s=-s,f=-f,g=-g,v=-v,y=-y),1-s>i?(o=Math.acos(s),a=Math.sin(o),l=Math.sin((1-n)*o)/a,u=Math.sin(n*o)/a):(l=1-n,u=n),e[0]=l*c+u*f,e[1]=l*h+u*g,e[2]=l*d+u*v,e[3]=l*p+u*y,e},y.sqlerp=function(){var e=y.createFloat64(),t=y.createFloat64();return function(r,i,n,o,s,a){return y.slerp(e,i,s,a),y.slerp(t,n,o,a),y.slerp(r,e,t,2*a*(1-a)),r}}(),y.invert=function(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],s=r*r+i*i+n*n+o*o,a=s?1/s:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-n*a,e[3]=o*a,e},y.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},y.length=c.length,y.len=y.length,y.squaredLength=c.squaredLength,y.sqrLen=y.squaredLength,y.normalize=c.normalize,y.fromMatrix33=function(e,t){var r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*o+o]-t[3*s+s]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*o+s]-t[3*s+o])*r,e[o]=(t[3*o+n]+t[3*n+o])*r,e[s]=(t[3*s+n]+t[3*n+s])*r}return e},y.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},y.exactEquals=c.exactEquals,y.equals=c.equals;var m=y,_={frustum:function(e,t,r,i,n,o,s){var a=1/(r-t),l=1/(n-i),u=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(n+i)*l,e[10]=(s+o)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*u,e[15]=0,e},perspective:function(e,t,r,i,n){var o=1/Math.tan(t/2),s=1/(i-n);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*s,e[15]=0,e},ortho:function(e,t,r,i,n,o,s){var a=1/(t-r),l=1/(i-n),u=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*a,e[13]=(n+i)*l,e[14]=(s+o)*u,e[15]=1,e},lookAt:function(e,t,r,n){var o,s,a,l,u,c,h,d,p,f,g=t[0],y=t[1],m=t[2],_=n[0],E=n[1],x=n[2],b=r[0],A=r[1],C=r[2];return Math.abs(g-b)<i&&Math.abs(y-A)<i&&Math.abs(m-C)<i?v.identity(e):(h=g-b,d=y-A,p=m-C,o=E*(p*=f=1/Math.sqrt(h*h+d*d+p*p))-x*(d*=f),s=x*(h*=f)-_*p,a=_*d-E*h,(f=Math.sqrt(o*o+s*s+a*a))?(o*=f=1/f,s*=f,a*=f):(o=0,s=0,a=0),l=d*a-p*s,u=p*o-h*a,c=h*s-d*o,(f=Math.sqrt(l*l+u*u+c*c))?(l*=f=1/f,u*=f,c*=f):(l=0,u=0,c=0),e[0]=o,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=u,e[6]=d,e[7]=0,e[8]=a,e[9]=c,e[10]=p,e[11]=0,e[12]=-(o*g+s*y+a*m),e[13]=-(l*g+u*y+c*m),e[14]=-(h*g+d*y+p*m),e[15]=1,e)},transformProjectionMatrix:function(e,t,r){var i=t[0],n=t[1],o=t[2],s=r[3]*i+r[7]*n+r[11]*o+r[15];return s=s||1,e[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/s,e[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/s,e[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/s,e}};t.default={Vector2:s,Vector3:l,Vector4:c,Matrix22:d,Matrix33:f,Matrix44:v,Quat:m,ProjectionUtils:_,FLOAT64_TOLERANCE:i,FLOAT32_TOLERANCE:n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={assert:function(e,t){if(!e)throw new Error(t)}};t.ConsoleUtils=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.definePlaneThroughPoints=t.getPlaneTransforms=t.limitRange=t.PI2=t.sortedIndex=t.clamp=t.orient2D=t.signedDistanceTo2DLine=t.intersectIntervals=t.solveTwoEquationsTwoVariables=t.closestPointToTriangle=t.closestPointToPolyline=t.distancePointToLineSegment=t.projectPointToLineSegment=t.angleDifference=t.periodicDifference=t.minMaxCosSinFunc=t.convertToOtherPeriodicRange=t.adjustParameterToPeriodicRange=t.getShortestParametricRange=t.isParameterWithinPeriodicRange=t.normalizeSegmentsToPeriodicRange=t.normalizeParametricRange=t.normalizeParametricRangeToShiftedRange=t.normalizeParameterToShiftedRange=t.adjustAngleToRange=t.normalizeAngleRange=t.normalizeAngle=t.normalizeParameter=t.foldNearTo=t.foldAbove=t.fold=t.modulus=t.getSignedAngle=t.isPointInsidePolygon2D=t.binomialCoefficients=void 0;var i=r(1),n=r(0),o=r(2),s=2*Math.PI,a=[];!function(){for(var e=0;e<8;++e){a[e]=[1];for(var t=1;t<e;++t)a[e][t]=a[e-1][t-1]+a[e-1][t];a[e][e]=1}}();var l=function(e,t,r){return Math.min(Math.max(t,e),r)},u=function(e,t){return e-t*Math.floor(e/t)},c=function(e,t){var r=e%t;return r<0?r+t:r},h=function(e,t,r){return c(e-t,r)+t},d=function(e,t){return e<0?t+e%t:e%t},p=function(e,t){return d(e-t[0],t[1]-t[0])+t[0]},f=function(e,t){o.ConsoleUtils.assert(e[1]>=e[0],"normalizeParametricRange: in_range ends not in order.");var r=e[1]-e[0],i=d(e[0],t);return[i,i+r]},g=function(e,t,r,i,n){if(!isFinite(r))return e;var o=f(t,r),s=d(e,r),a=s+r;if(i=!!i,s>=o[0]&&s<=o[1])return t[0]+(s-o[0]);if(a>=o[0]&&a<=o[1])return t[0]+(a-o[0]);var l=Math.abs(o[0]-s),u=Math.abs(s-o[1]),c=Math.abs(o[0]-a),h=Math.abs(a-o[1]);return n?Math.min(l,c)<Math.min(u,h)?t[0]:t[1]:Math.min(l,u)>Math.min(c,h)&&!i?t[0]+(a-o[0]):t[0]+(s-o[0])},v=function(e,t,r){var i=Math.abs(e-t);return isFinite(r)&&(i%=r)>r/2?r-i:i},y=function(e,t,r){var o=i.Vector3.sub(i.Vector3.createFloat64(),t,e),s=i.Vector3.dot(o,o);if(s<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)return 0;var a=i.Vector3.sub(i.Vector3.createFloat64(),r,e);return i.Vector3.dot(a,o)/s};t.binomialCoefficients=a,t.isPointInsidePolygon2D=function(e,t){for(var r=!1,i=t.length,n=0,o=i-2;n<i;n+=2)t[n+1]>e[1]!=t[o+1]>e[1]&&e[0]<(t[o]-t[n])*(e[1]-t[n+1])/(t[o+1]-t[n+1])+t[n]&&(r=!r),o=n;return r},t.getSignedAngle=function(e,t){var r=l(i.Vector2.dot(e,t),-1,1),n=t[0]*e[1]-t[1]*e[0];return 0===n?.5*Math.PI*(r-1):n<0?-Math.acos(r):Math.acos(r)},t.modulus=u,t.fold=c,t.foldAbove=h,t.foldNearTo=function(e,t,r){return h(e,t-r/2,r)},t.normalizeParameter=d,t.normalizeAngle=function(e){return d(e,s)},t.normalizeAngleRange=function(e){return f(e,2*Math.PI)},t.adjustAngleToRange=function(e,t){return g(e,t,2*Math.PI)},t.normalizeParameterToShiftedRange=p,t.normalizeParametricRangeToShiftedRange=function(e,t){o.ConsoleUtils.assert(e[1]>=e[0],"normalizeParametricRangeToShiftedRange: in_range ends not in order.");var r=e[1]-e[0],i=p(e[0],t);return[i,i+r]},t.normalizeParametricRange=f,t.normalizeSegmentsToPeriodicRange=function(e,t,r,i,o){for(var s=void 0!==i?i:n.KERNEL_TOLERANCE,a=void 0!==o?o:t[1]-t[0],l=[],u=0;u<e.length;u++){var c=p(e[u][0],t),h=e[u][1]-e[u][0];if(h>=a)return[[t[0],t[1]]];var d=c+h;d<t[1]?l.push([c,d]):(l.push([c,t[1]]),l.push([t[0],d-t[1]+t[0]]))}var f=[];for(l.sort((function(e,t){return e[0]-t[0]})),u=0;u<l.length;u++){for(var g=l[u];u+1<l.length&&l[u+1][0]<g[1];)g[1]=Math.max(g[1],l[u+1][1]),u++;(Math.abs(g[1]-g[0])>s||!r)&&f.push(g)}return f},t.isParameterWithinPeriodicRange=function(e,t,r,i){var n=g(e,t,r);return i=i||0,n>t[0]-i&&n<t[1]+i},t.getShortestParametricRange=function(e,t,r){if((e=d(e,r))>(t=d(t,r))){var i=e;e=t,t=i}return e-t+r<t-e?[t,e+r]:[e,t]},t.adjustParameterToPeriodicRange=g,t.convertToOtherPeriodicRange=function(e,t,r,i){if(!isFinite(r))return o.ConsoleUtils.assert(e[0]>=t[0]-i,"The start of the input range doesn't lie in the target range."),o.ConsoleUtils.assert(e[1]<=t[1]+i,"The input range doesn't lie within the target range."),e;if(i=i||0,e[1]-e[0]>=r-i)return t[1]-t[0]<r-i&&console.error("The input range is larger than the target range."),t;var n=g(e[0],t,r);o.ConsoleUtils.assert(n>=t[0]-i,"The start of the input range doesn't lie in the target range.");var s=n+e[1]-e[0];return o.ConsoleUtils.assert(s<=t[1]+i,"The input range doesn't lie within the target range."),[n,s]},t.minMaxCosSinFunc=function(e,t,r,i){if(0===e&&0===t)return[r,r];var n,o=f(i,2*Math.PI),s=g(Math.atan(t/e),o,Math.PI,!0),a=[];for(n=0;n<3;++n)o[0]<=s&&o[1]>=s&&a.push(e*Math.cos(s)+t*Math.sin(s)),s+=Math.PI;if(i[1]-i[0]<2*Math.PI)for(n=0;n<2;n++)a.push(e*Math.cos(i[n])+t*Math.sin(i[n]));return[Math.min.apply(null,a)+r,Math.max.apply(null,a)+r]},t.periodicDifference=v,t.angleDifference=function(e,t){return v(e,t,2*Math.PI)},t.projectPointToLineSegment=y,t.distancePointToLineSegment=function(e,t,r,n){var o=y(e,t,r);o=l(o,0,1);var s=n||i.Vector3.createFloat64();return i.Vector3.lerp(s,e,t,o),i.Vector3.distance(s,r)},t.closestPointToPolyline=function(e,t,r,n,o){for(var s="number"==typeof t[0],a=s?t.length/3:t.length,u=void 0,c=Number.POSITIVE_INFINITY,h=i.Vector3.createFloat64(),d=0;d<a-1;++d){var p=r?r[d]:d,f=r?r[d+1]:d+1,g=0,v=1;if(!(n&&(n[0]>p&&(g=(n[0]-p)/(f-p)),n[1]<f&&(v=(n[1]-p)/(f-p)),v<g))){var m,_;s?(m=[t[3*d],t[3*d+1],t[3*d+2]],_=[t[3*d+3],t[3*d+4],t[3*d+5]]):(m=t[d],_=t[d+1]);var E=y(m,_,e);E=l(E,g,v),i.Vector3.lerp(h,m,_,E);var x=i.Vector3.squaredDistance(h,e);x<c&&(u=(1-E)*p+E*f,c=x,o&&i.Vector3.copy(o,h))}}return u},t.closestPointToTriangle=function(e,t,r,o,s){var a,u,c=i.Vector3.sub(i.Vector3.createFloat64(),r,t),h=i.Vector3.sub(i.Vector3.createFloat64(),o,t),d=i.Vector3.sub(i.Vector3.createFloat64(),e,t),p=i.Vector3.squaredLength(c),f=i.Vector3.squaredLength(h),g=i.Vector3.dot(c,h),v=i.Vector3.dot(d,c),m=i.Vector3.dot(d,h);if(p<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE&&f<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)a=u=0;else if(p<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)a=0,u=l(m/f,0,1);else if(f<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)a=l(v/p,0,1),u=0;else{var _=i.Matrix22.createFloat64FromValues(p,g,g,f);if(Math.abs(i.Matrix22.determinant(_))>i.FLOAT64_TOLERANCE){i.Matrix22.invert(_,_);var E=[v,m];i.Vector2.transformMatrix22(E,E,_),a=E[0],u=E[1]}else u=m/f,(a=v/p)<=0||u<=0?(a=l(a,0,1),u=l(u,0,1)):a<u?(a=l(a,0,1),u=0):(a=0,u=l(u,0,1))}if(a<0&&m>=0&&m<=f&&(a=0,u=m/f),u<0&&v>=0&&v<=p&&(a=v/p,u=0),a+u>1){var x=y(r,o,e);x>=0&&x<=1&&(a=1-x,u=x)}if(a<0||u<0||a+u>1){var b=i.Vector3.squaredLength(d),A=i.Vector3.squaredDistance(e,r),C=i.Vector3.squaredDistance(e,o);A<=b&&A<=C?(a=1,u=0):C<=b&&C<=A?(a=0,u=1):a=u=0}return s&&(i.Vector3.scaleAndAdd(s,t,c,a),i.Vector3.scaleAndAdd(s,s,h,u)),{coordA:a,coordB:u}},t.solveTwoEquationsTwoVariables=function(e){var t=e[0][0],r=e[0][1],i=e[1][0],n=e[1][1],o=t*n-r*i;if(0!==o){var s=n*e[0][2]-r*e[1][2],a=-i*e[0][2]+t*e[1][2];return[s/=o,a/=o]}},t.intersectIntervals=function(e,t,r){r=r||0;for(var i=[],n=0;n<e.length;n++)for(var o=0;o<t.length;o++){var s=Math.max(e[n][0],t[o][0]),a=Math.min(e[n][1],t[o][1]);a-r>s&&(a>s?i.push([s,a]):i.push([a,a]))}return i},t.signedDistanceTo2DLine=function(e,t,r){var i=r[0]-e[0],n=r[1]-e[1];return t[1]*i-t[0]*n},t.orient2D=function(e,t,r){var i=e[0]-r[0],n=t[0]-r[0],o=e[1]-r[1];return i*(t[1]-r[1])-o*n},t.clamp=l,t.sortedIndex=function(e,t){for(var r=0,i=e.length;i>r;){var n=Math.floor((r+i)/2);t>e[n]?r=n+1:i=n}return i},t.PI2=s,t.limitRange=function(e,t,r,n){if(o.ConsoleUtils.assert(2===t.length),o.ConsoleUtils.assert(t[0]<=t[1]),r)return t[1]-t[0]<n+i.FLOAT64_TOLERANCE?[t[0],t[1]]:(console.warn("limitRange : in_limitRange length cannot be greater than in_period"),[t[0],t[0]+n]);var s=Math.max(e[0],t[0]),a=Math.min(e[1],t[1]);return s>a&&(s>a+i.FLOAT64_TOLERANCE&&console.warn("limitRange : requested range must overlap in_oldRange"),s=a=t[0]>e[1]?e[1]:e[0]),[s,a]},t.getPlaneTransforms=function(e){var t,r,n=e.evaluateDu(0,0),o=e.evaluateDv(0,0),s=e.getOrigin();if(!i.Vector3.isParallel(n,[1,0,0],1)||!i.Vector3.isParallel(o,[0,1,0],1)||Math.abs(s[2])>i.FLOAT64_TOLERANCE){var a=e.evaluateNormal(0,0);t=i.Matrix44.createFloat64FromValues(n[0],n[1],n[2],0,o[0],o[1],o[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],1),r=i.Matrix44.createFloat64(),i.Matrix44.invert(r,t)}return{uvToThreeSpace:t,threeSpaceToUV:r}},t.definePlaneThroughPoints=function(e){var t,r,o,s=[0,0,0],a=[0,0,0];if(!(e.length<3)){var l=[0,0,0];for(t=0;t<e.length;++t)i.Vector3.add(l,l,e[t]);i.Vector3.scale(l,l,1/e.length);var c=[0,0,0];r=0;var h=0,d=0;for(t=0;t<e.length;++t){(o=i.Vector3.squaredDistance(l,e[t]))>d&&(d=o,h=t),(o/=100)>r&&(r=o,i.Vector3.sub(c,e[t],l));var p=(t+1)%e.length;(o=i.Vector3.squaredDistance(e[t],e[p]))>r&&(r=o,i.Vector3.sub(c,e[p],e[t]))}if(!(d<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)){i.Vector3.normalize(c,c);var f=[0,0,0];for(r=0,t=0;t<e.length;++t)i.Vector3.sub(s,e[t],l),i.Vector3.cross(s,s,c),(o=i.Vector3.squaredLength(s))>r&&(r=o,i.Vector3.copy(f,s));if(!(r<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)){i.Vector3.normalize(f,f);var g=e[h],v=e[u(h-1,e.length)],y=e[u(h+1,e.length)];i.Vector3.sub(s,v,g),i.Vector3.sub(a,y,g),i.Vector3.dot(i.Vector3.cross(a,a,s),f)<0&&i.Vector3.negate(f,f);var m=[0,0,0];i.Vector3.cross(m,f,c),i.Vector3.normalize(m,m);var _=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,x=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY;for(t=0;t<e.length;++t){i.Vector3.sub(s,e[t],l);var A=i.Vector3.dot(s,c),C=i.Vector3.dot(s,m);_=Math.min(_,A),E=Math.max(E,A),x=Math.min(x,C),b=Math.max(b,C)}return{origin:l,normal:f,uAxis:c,vAxis:m,uRange:[_,E],vRange:[x,b]}}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoundingBox=void 0;var i=r(1),n=r(0),o=function(e,t){this.min=e?i.Vector3.createFloat64FromValues(e[0],e[1],e[2]):i.Vector3.createFloat64FromValues(1/0,1/0,1/0),this.max=t?i.Vector3.createFloat64FromValues(t[0],t[1],t[2]):i.Vector3.createFloat64FromValues(-1/0,-1/0,-1/0)};o.prototype.toString=function(){return"(x:"+this.min[0]+", y:"+this.min[1]+", z:"+this.min[2]+") -> (x:"+this.max[0]+", y:"+this.max[1]+", z:"+this.max[2]+")"},o.prototype.copy=function(e){return i.Vector3.copy(this.min,e.min),i.Vector3.copy(this.max,e.max),this},o.prototype.clone=function(){return new o(this.min,this.max)},o.prototype.getWidth=function(e){var t=0;return 0<=e&&e<=2?(t=this.max[e]-this.min[e],isFinite(t)?t:0):(console.error("wrong axis argument supplied to BoundingBox.getWidth(): "+e),0)},o.prototype.getMaxMinAligned=function(e,t,r){for(var n,s,a,l=this.getCorners(),u=[],c=[],h=[],d=0;d<l.length;++d)n=i.Vector3.dot(l[d],e),s=i.Vector3.dot(l[d],t),a=i.Vector3.dot(l[d],r),u.push(n),c.push(s),h.push(a);var p=Math.min.apply(void 0,u),f=Math.min.apply(void 0,c),g=Math.min.apply(void 0,h),v=Math.max.apply(void 0,u),y=Math.max.apply(void 0,c),m=Math.max.apply(void 0,h);return new o([p,f,g],[v,y,m])},o.prototype.include=function(e){return this.includeX(e.min[0],e.max[0]),this.includeY(e.min[1],e.max[1]),this.includeZ(e.min[2],e.max[2]),this},o.prototype.includeX=function(e,t){return this.min[0]=Math.min(this.min[0],e),this.max[0]=Math.max(this.max[0],t),this},o.prototype.includeY=function(e,t){return this.min[1]=Math.min(this.min[1],e),this.max[1]=Math.max(this.max[1],t),this},o.prototype.includeZ=function(e,t){return this.min[2]=Math.min(this.min[2],e),this.max[2]=Math.max(this.max[2],t),this},o.prototype.includeSphere=function(e){var t=e.getCenter(),r=e.getRadius();return this.includeX(t[0]-r,t[0]+r),this.includeY(t[1]-r,t[1]+r),this.includeZ(t[2]-r,t[2]+r),this},o.prototype.translate=function(e){return i.Vector3.add(this.min,this.min,e),i.Vector3.add(this.max,this.max,e),this},o.prototype.getCorners=function(){var e=this.getDiagonal();return[i.Vector3.clone(this.min),i.Vector3.createFloat64FromValues(this.min[0]+e[0],this.min[1],this.min[2]),i.Vector3.createFloat64FromValues(this.min[0],this.min[1]+e[1],this.min[2]),i.Vector3.createFloat64FromValues(this.min[0],this.min[1],this.min[2]+e[2]),i.Vector3.createFloat64FromValues(this.min[0]+e[0],this.min[1]+e[1],this.min[2]),i.Vector3.createFloat64FromValues(this.min[0]+e[0],this.min[1],this.min[2]+e[2]),i.Vector3.createFloat64FromValues(this.min[0],this.min[1]+e[1],this.min[2]+e[2]),i.Vector3.clone(this.max)]},o.prototype.transform=function(e){if(!this.isEmpty()){var t=this.getCorners();this.max[0]=-1/0,this.max[1]=-1/0,this.max[2]=-1/0,this.min[0]=1/0,this.min[1]=1/0,this.min[2]=1/0;for(var r=0;r<t.length;++r)i.Vector3.transformMatrix44(t[r],t[r],e),i.Vector3.max(this.max,this.max,t[r]),i.Vector3.min(this.min,this.min,t[r])}return this},o.prototype.includePointXYZ=function(e){return this.includeX(e.x,e.x),this.includeY(e.y,e.y),this.includeZ(e.z,e.z),this},o.prototype.includePoint=function(e){return this.includeX(e[0],e[0]),this.includeY(e[1],e[1]),this.includeZ(e[2],e[2]),this},o.prototype.getCenter=function(){var e=i.Vector3.createFloat64();return i.Vector3.add(e,this.min,this.max),i.Vector3.scale(e,e,.5),e},o.prototype.getDiagonal=function(){var e=i.Vector3.createFloat64();return i.Vector3.sub(e,this.max,this.min),e},o.prototype.isPointInside=function(e){return!(e[0]<this.min[0]||e[0]>this.max[0]||e[1]<this.min[1]||e[1]>this.max[1]||e[2]<this.min[2]||e[2]>this.max[2])},o.prototype.isPointInsideWithTolerance=function(e,t){return t||(t=n.KERNEL_TOLERANCE),!(e[0]<this.min[0]-t||e[0]>this.max[0]+t||e[1]<this.min[1]-t||e[1]>this.max[1]+t||e[2]<this.min[2]-t||e[2]>this.max[2]+t)},o.prototype.intersects=function(e){return!(e.min[0]>this.max[0]||e.max[0]<this.min[0]||e.min[1]>this.max[1]||e.max[1]<this.min[1]||e.min[2]>this.max[2]||e.max[2]<this.min[2])},o.prototype.intersectsWithTolerance=function(e,t){return t||(t=n.KERNEL_TOLERANCE),!(e.min[0]>this.max[0]+t||e.max[0]<this.min[0]-t||e.min[1]>this.max[1]+t||e.max[1]<this.min[1]-t||e.min[2]>this.max[2]+t||e.max[2]<this.min[2]-t)},o.prototype.isEmpty=function(){return this.max[0]<this.min[0]||this.max[1]<this.min[1]||this.max[2]<this.min[2]},o.prototype.setEmpty=function(){return this.max[0]=-1/0,this.min[0]=1/0,this.max[1]=-1/0,this.min[1]=1/0,this.max[2]=-1/0,this.min[2]=1/0,this},o.prototype.isBounded=function(){return isFinite(this.max[0])&&isFinite(this.max[1])&&isFinite(this.max[2])&&isFinite(this.min[0])&&isFinite(this.min[1])&&isFinite(this.min[2])},t.BoundingBox=o},function(e,t,r){"use strict";var i,n,o=e.exports=r(10),s=r(61);o.codegen=r(99),o.fetch=r(100),o.path=r(101),o.fs=o.inquire("fs"),o.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]},o.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],n=e[r++];void 0!==n&&(t[i]=n)}return t};var a=/\\/g,l=/"/g;o.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},o.safeProp=function(e){return!/^[$\w_]+$/.test(e)||o.isReserved(e)?'["'+e.replace(a,"\\\\").replace(l,'\\"')+'"]':"."+e},o.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;o.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},o.compareFieldsById=function(e,t){return e.id-t.id},o.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(o.decorateRoot.remove(e.$type),e.$type.name=t,o.decorateRoot.add(e.$type)),e.$type;i||(i=r(63));var n=new i(t||e.name);return o.decorateRoot.add(n),n.ctor=e,Object.defineProperty(e,"$type",{value:n,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:n,enumerable:!1}),n};var c=0;o.decorateEnum=function(e){if(e.$type)return e.$type;n||(n=r(11));var t=new n("Enum"+c++,e);return o.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},Object.defineProperty(o,"decorateRoot",{get:function(){return s.decorated||(s.decorated=new(r(71)))}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Point=void 0;var i=r(1),n=r(43),o=r(4),s=r(0),a=function(e){n.BaseGeometry.call(this),this._position=i.Vector3.createFloat64(),e&&i.Vector3.copy(this._position,e)};(a.prototype=Object.create(n.BaseGeometry.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.POINT},a.prototype.clone=function(){var e=new a;return e.copy(this),e},a.prototype.copy=function(e){n.BaseGeometry.prototype.copy.call(this,e),this.copyPosition(e.getPosition())},a.prototype.getPosition=function(){return this._position},a.prototype.copyPosition=function(e){i.Vector3.copy(this._position,e)},a.prototype.setPosition=function(e,t,r){i.Vector3.set(this._position,e,t,r)},a.prototype.getBoundingBox=function(){var e=new o.BoundingBox;return e.includePoint(this.getPosition()),e},a.prototype.transform=function(e){i.Vector3.transformMatrix44(this._position,this._position,e)},a.prototype.toObject=function(){return{position:this.vectorToObject(this._position)}},t.Point=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;var i=r(1),n=r(4),o=r(34),s=r(0),a=r(32),l=r(3),u=r(2),c=function(){a.Curve.call(this),this._position=i.Vector3.createFloat64FromValues(0,0,0),this._direction=i.Vector3.createFloat64FromValues(1,0,0)};(c.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.LINE},c.prototype.set=function(e,t){u.ConsoleUtils.assert(i.Vector3.squaredLength(t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),i.Vector3.copy(this._position,e),i.Vector3.copy(this._direction,t)},c.prototype.clone=function(){var e=new c;return e.copy(this),e},c.prototype.tessellate=function(e,t){var r={positions:[],offsets:[],tolerance:0};r.offsets.push(0);var i=e[0];r.positions.push(this.evaluatePosition(i));for(var n=1;n<e.length;++n){var o=e[n];r.positions.push(this.evaluatePosition(o)),r.offsets.push(r.positions.length-1),i=o}return r},c.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),i.Vector3.copy(this._position,e._position),i.Vector3.copy(this._direction,e._direction)},c.prototype.getRangeUnlimited=function(){return[-1/0,1/0]},c.prototype.isPeriodicUnlimited=function(){return!1},c.prototype.isClosedUnlimited=function(){return!1},c.prototype.evaluatePosition=function(e){var t=i.Vector3.createFloat64();return i.Vector3.scaleAndAdd(t,this._position,this._direction,e)},c.prototype.evaluateDt=function(e){return i.Vector3.clone(this._direction)},c.prototype.tangentLength=function(e){return i.Vector3.length(this._direction)},c.prototype.getTangentCone=function(e){var t=i.Vector3.createFloat64();return new o.TangentCone(i.Vector3.normalize(t,this.evaluateDt(0)),0)},c.prototype.getArcLength=function(e){return void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited()),isFinite(e[0])&&isFinite(e[1])?(e[1]-e[0])*i.Vector3.length(this._direction):1/0},c.prototype.getParameterFromArcLength=function(e,t){if(void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited()),isFinite(t[0])&&isFinite(t[1])){var r=t[0]+e/i.Vector3.length(this._direction);return(0,l.clamp)(r,t[0],t[1])}return NaN},c.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=new n.BoundingBox;return isFinite(e[0])&&isFinite(e[1])?(t.includePoint(this.evaluatePosition(e[0])),t.includePoint(this.evaluatePosition(e[1]))):(t.includePoint([1/0,1/0,1/0]),t.includePoint([-1/0,-1/0,-1/0])),t},c.prototype.closestToRayParam=function(e,t,r,n){var o=i.Vector3.createFloat64();i.Vector3.sub(o,this._position,e);var s=i.Vector3.squaredLength(this._direction),a=i.Vector3.squaredLength(t),l=i.Vector3.dot(this._direction,t),u=i.Vector3.dot(o,this._direction),c=i.Vector3.dot(o,t),h=s*a-l*l,d=(l*c-a*u)/h,p=(l*u-s*c)/h;if(isFinite(d)&&isFinite(p)){if(r)if(d<r[0]){if(d=r[0],void 0!==n){var f=this.evaluatePosition(r[0]),g=i.Vector3.createFloat64();i.Vector3.sub(g,f,e),p=i.Vector3.dot(g,t)/a}}else if(d>r[1]&&(d=r[1],void 0!==n)){var v=this.evaluatePosition(r[1]);g=i.Vector3.createFloat64(),i.Vector3.sub(g,v,e),p=i.Vector3.dot(g,t)/a}if(void 0!==n){var y=this.evaluatePosition(d),m=i.Vector3.createFloat64();if(i.Vector3.scaleAndAdd(m,e,t,p),i.Vector3.squaredDistance(y,m)>n*n)return}return d}},c.prototype.setFromEndpoints=function(e,t){u.ConsoleUtils.assert(i.Vector3.squaredDistance(e,t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),this._position=i.Vector3.clone(e),i.Vector3.normalize(this._direction,i.Vector3.sub(this._direction,t,e)),this.unlimitRange()},c.prototype.transform=function(e){i.Vector3.transformMatrix44(this._position,this._position,e),i.Vector3.transformAsDirectionMatrix44(this._direction,this._direction,e)},c.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var r=i.Vector3.createFloat64();i.Vector3.sub(r,e,this._position);var n=this._direction,o=i.Vector3.dot(r,n)/i.Vector3.squaredLength(n);return isFinite(t[0])&&isFinite(t[1])?(0,l.clamp)(o,t[0],t[1]):o},c.prototype.suggestSplittingParam=function(e){},c.prototype.toObject=function(){return{position:this.vectorToObject(this._position),direction:this.vectorToObject(this._direction),range:this.rangeToObject(this.getRange(),this.isLimited())}},t.Line=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=!1,n=!1,o={},s={init3D:function(e){for(var t in i=!0,e)"function"==typeof e[t]&&(s[t]=e[t].bind(e))},setLevel:function(e,t){var r=o[e];return o[e]=t,console.log("Debug of "+e+" set to level "+t),r},level:function(e){if(!i)return 0;var t=o[e];return void 0===t?0:t},setConsoleWarnings:function(e){n=e},warn:function(e){n&&console.warn(e)}};t.DebugUtils=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTopology=void 0;var i=r(44),n=r(0),o=function(){i.Base.call(this),this._attributes=[]};(o.prototype=Object.create(i.Base.prototype)).getTopologyType=function(){console.warn("BaseTopology.getTopologyType : abstract method invoked!")},o.prototype.getBoundingBox=function(){console.warn("BaseTopology.getBoundingBox : abstract method invoked!")},o.prototype.getBody=function(){console.warn("BaseTopology.getBody : abstract method invoked!")},o.prototype.collectFaces=function(e){return console.warn("BaseTopology.collectFaces : abstract method invoked!"),e||new Set},o.prototype.collectEdges=function(e){return console.warn("BaseTopology.collectEdges : abstract method invoked!"),e||new Set},o.prototype.collectVertices=function(e){return console.warn("BaseTopology.collectVertices : abstract method invoked!"),e||new Set},o.prototype.getAttributes=function(){return this._attributes},o.prototype.addAttribute=function(e){this._attributes?this._attributes.push(e):this._attributes=[e],e.addTopology(this)},o.prototype.removeAttribute=function(e){var t=this._attributes.indexOf(e);return t>-1&&(this._attributes.splice(t,1),e.removeTopology(this),!0)},o.prototype.removeAllAttributes=function(){if(this._attributes)for(var e=0;e<this._attributes.length;e++)this.removeAttribute(this._attributes[e])},o.prototype.isVertex=function(){return this.getTopologyType()===n.TOPOLOGY_TYPES.VERTEX},o.prototype.getFaces=function(){return Array.from(this.collectFaces())},o.prototype.getEdges=function(){return Array.from(this.collectEdges())},o.prototype.getVertices=function(){return Array.from(this.collectVertices())},o.prototype.addAllToModelObject=function(e,t){if(!e.topologies[this.getGuid()]){var r={};r[n.TOPOLOGY_TYPES.toString(this.getTopologyType()).toLowerCase()]=this.toObject(),e.topologies[this.getGuid()]=r}t.forEach((function(t){null!=t&&(Array.isArray(t)?t.forEach((function(t){t.addToModelObject(e)})):t.addToModelObject(e))}))},t.BaseTopology=o},function(e,t,r){"use strict";(function(e){var i=t;function n(e,t,r){for(var i=Object.keys(t),n=0;n<i.length;++n)void 0!==e[i[n]]&&r||(e[i[n]]=t[i[n]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}i.asPromise=r(58),i.base64=r(90),i.EventEmitter=r(91),i.float=r(92),i.inquire=r(59),i.utf8=r(93),i.pool=r(94),i.LongBits=r(95),i.global="undefined"!=typeof window&&window||void 0!==e&&e||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isNode=Boolean(i.global.process&&i.global.process.versions&&i.global.process.versions.node),i.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString=function(e){return"string"==typeof e||e instanceof String},i.isObject=function(e){return e&&"object"==_typeof(e)},i.isset=i.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=_typeof(r)||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},i.Buffer=function(){try{var e=i.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(e){return"number"==typeof e?i.Buffer?i._Buffer_allocUnsafe(e):new i.Array(e):i.Buffer?i._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(e){return e?i.LongBits.from(e).toHash():i.LongBits.zeroHash},i.longFromHash=function(e,t){var r=i.LongBits.fromHash(e);return i.Long?i.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},i.merge=n,i.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},i.newError=o,i.ProtocolError=o("ProtocolError"),i.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},i.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var e=i.Buffer;e?(i._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},i._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}).call(this,r(57))},function(e,t,r){"use strict";e.exports=s;var i=r(21);((s.prototype=Object.create(i.prototype)).constructor=s).className="Enum";var n=r(30),o=r(5);function s(e,t,r,n,o){if(i.call(this,e,r),t&&"object"!=_typeof(t))throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=n,this.comments=o||{},this.reserved=void 0,t)for(var s=Object.keys(t),a=0;a<s.length;++a)"number"==typeof t[s[a]]&&(this.valuesById[this.values[s[a]]=t[s[a]]]=s[a])}s.fromJSON=function(e,t){var r=new s(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},s.prototype.add=function(e,t,r){if(!o.isString(e))throw TypeError("name must be a string");if(!o.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=r||null,this},s.prototype.remove=function(e){if(!o.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},s.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},s.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Surface=void 0;var i=r(1),n=r(43),o=r(0),s=r(3),a=function(){n.BaseGeometry.call(this),this._subrangeU=[],this._subrangeV=[]};(a.prototype=Object.create(n.BaseGeometry.prototype)).copy=function(e){n.BaseGeometry.prototype.copy.call(this,e),this._subrangeU=e.isLimitedU()?[e._subrangeU[0],e._subrangeU[1]]:[],this._subrangeV=e.isLimitedV()?[e._subrangeV[0],e._subrangeV[1]]:[]},a.prototype.isLimitedU=function(){return this._subrangeU.length>0},a.prototype.isLimitedV=function(){return this._subrangeV.length>0},a.prototype.getRangeU=function(){return this.isLimitedU()?this._subrangeU:this.getRangeUnlimitedU()},a.prototype.getRangeV=function(){return this.isLimitedV()?this._subrangeV:this.getRangeUnlimitedV()},a.prototype.getRangeUnlimitedU=function(){console.warn("Surface.getRangeUnlimitedU : abstract method invoked!")},a.prototype.getRangeUnlimitedV=function(){console.warn("Surface.getRangeUnlimitedV : abstract method invoked!")},a.prototype.limitRangeU=function(e){var t=this.getRangeU();this._subrangeU=(0,s.limitRange)(t,e,this.isPeriodicU(),this.getPeriodU())},a.prototype.limitRangeV=function(e){var t=this.getRangeV();this._subrangeV=(0,s.limitRange)(t,e,this.isPeriodicV(),this.getPeriodV())},a.prototype.unlimitRangeU=function(){this._subrangeU=[]},a.prototype.unlimitRangeV=function(){this._subrangeV=[]},a.prototype.isPeriodicU=function(){return this.isPeriodicUnlimitedU()&&!this.isLimitedU()},a.prototype.isPeriodicV=function(){return this.isPeriodicUnlimitedV()&&!this.isLimitedV()},a.prototype.isPeriodicUnlimitedU=function(){console.warn("Surface.isPeriodicUnlimitedU : abstract method invoked!")},a.prototype.isPeriodicUnlimitedV=function(){console.warn("Surface.isPeriodicUnlimitedV : abstract method invoked!")},a.prototype.getPeriodU=function(){return this.isLimitedU()?void 0:this.getPeriodUnlimitedU()},a.prototype.getPeriodV=function(){return this.isLimitedV()?void 0:this.getPeriodUnlimitedV()},a.prototype.getPeriodUnlimitedU=function(){if(this.isPeriodicUnlimitedU()){var e=this.getRangeUnlimitedU();return e[1]-e[0]}},a.prototype.getPeriodUnlimitedV=function(){if(this.isPeriodicUnlimitedV()){var e=this.getRangeUnlimitedV();return e[1]-e[0]}},a.prototype.isClosedU=function(){if(this.isClosedUnlimitedU()){if(this.isLimitedU()){var e=this.getRangeUnlimitedU(),t=e[1]-e[0];return this._subrangeU[1]-this._subrangeU[0]>t-o.PARAMETER_SPACE_TOLERANCE}return!0}return!1},a.prototype.isClosedV=function(){if(this.isClosedUnlimitedV()){if(this.isLimitedV()){var e=this.getRangeUnlimitedV(),t=e[1]-e[0];return this._subrangeV[1]-this._subrangeV[0]>t-o.PARAMETER_SPACE_TOLERANCE}return!0}return!1},a.prototype.isClosedUnlimitedU=function(){console.warn("Surface.isClosedUnlimitedU : abstract method invoked!")},a.prototype.isClosedUnlimitedV=function(){console.warn("Surface.isClosedUnlimitedV : abstract method invoked!")},a.prototype.evaluatePosition=function(e,t){console.warn("Surface.evaluatePosition : abstract method invoked")},a.prototype.evaluateDu=function(e,t){console.warn("Surface.evaluateDu : abstract method invoked")},a.prototype.evaluateDv=function(e,t){console.warn("Surface.evaluateDv : abstract method invoked")},a.prototype.evaluateNormal=function(e,t){var r=this.evaluateDu(e,t);return i.Vector3.cross(r,r,this.evaluateDv(e,t)),i.Vector3.normalize(r,r),r},a.prototype.closestParam=function(e){console.warn("Surface.closestParam : abstract method invoked")},a.prototype.vParamLine=function(e){console.warn("Surface.vParamLine : abstract method invoked, returning undefined")},a.prototype.uParamLine=function(e){console.warn("Surface.uParamLine : abstract method invoked, returning undefined")},a.prototype.getBoundingBox=function(e,t){console.warn("Surface.getBoundingBox : abstract method invoked, returning undefined")},a.prototype.transform=function(e){console.warn("Surface.transform : abstract method invoked")},t.Surface=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loop=void 0;var i=r(9),n=r(0),o=function(){i.BaseTopology.call(this),this._coedges=[],this._face=void 0};(o.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return n.TOPOLOGY_TYPES.LOOP},o.prototype.getFace=function(){return this._face},o.prototype.setFace=function(e){this._face=e},o.prototype.getCoedges=function(){return this._coedges},o.prototype.setCoedges=function(e){this._coedges=new Array(e.length);for(var t=0;t<e.length;++t)this._coedges[t]=e[t]},o.prototype.addCoedge=function(e){this._coedges?this._coedges.push(e):this._coedges=[e],e.setLoop(this)},o.prototype.addCoedges=function(e){this._coedges||(this._coedges=[]);for(var t=0;t<e.length;++t)e[t].setLoop(this);this._coedges=this._coedges.concat(e)},o.prototype.removeCoedge=function(e){var t=this._coedges.indexOf(e);return t>-1&&(this._coedges.splice(t,1),e.getLoop()===this&&e.setLoop(void 0),!0)},o.prototype.getBody=function(){return this._face?this._face.getBody():void 0},o.prototype.collectFaces=function(e){return e=e||new Set,this._face&&e.add(this._face),e},o.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._coedges.length;++t)this._coedges[t].collectEdges(e);return e},o.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._coedges.length;++t)this._coedges[t].collectVertices(e);return e},o.prototype.toString=function(){return"Loop"},o.prototype.toObject=function(){return{coedges:this.refsToStrings(this._coedges),attributes:this.refsToStrings(this._attributes)}},o.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._coedges,this._attributes])},t.Loop=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Circle=void 0;var i=r(1),n=r(4),o=r(34),s=r(0),a=r(32),l=r(3),u=r(2),c=r(50),h=function(){a.Curve.call(this),this._center=i.Vector3.createFloat64FromValues(0,0,0),this._normal=i.Vector3.createFloat64FromValues(0,0,1),this._xAxis=i.Vector3.createFloat64FromValues(1,0,0),this._yAxis=i.Vector3.createFloat64FromValues(0,1,0),this._radius=1};(h.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.CIRCLE},h.prototype.set=function(e,t,r){u.ConsoleUtils.assert(i.Vector3.squaredLength(t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.squaredLength(r)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.isOrthogonal(t,r,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.copy(this._center,e),i.Vector3.normalize(this._normal,t),i.Vector3.normalize(this._xAxis,r),this._radius=i.Vector3.length(r),this._computeYAxis()},h.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._normal,this._xAxis)},h.prototype.clone=function(){var e=new h;return e.copy(this),e},h.prototype.getCenter=function(){return this._center},h.prototype.getNormal=function(){return this._normal},h.prototype.setNormal=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),this._normal!==e&&(i.Vector3.normalize(this._normal,e),i.Vector3.isOrthogonal(this._xAxis,this._normal)||(i.Vector3.computeOrthogonal(this._xAxis,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis())},h.prototype.getRadius=function(){return this._radius},h.prototype.setRadius=function(e){u.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._radius=e},h.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},h.prototype.setOrigin=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.isOrthogonal(e,this._normal,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},h.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),this._radius=e._radius,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._normal,e._normal)},h.prototype.getRangeUnlimited=function(){return[-Math.PI,Math.PI]},h.prototype.isPeriodicUnlimited=function(){return!0},h.prototype.isClosedUnlimited=function(){return!0},h.prototype._computeRadiusVector=function(){return i.Vector3.scale(i.Vector3.createFloat64(),this._xAxis,this._radius)},h.prototype.tessellate=function(e,t){t=t||s.TESSELLATION.LINEAR_PRECISION;var r={positions:[],offsets:[],tolerance:0};r.offsets.push(0);for(var i=e[0],n=1;n<e.length;++n){var o=e[n],a=c.CurveTessellator.getCircularArcRenderPoints(this,[i,o],t,1===n,r.positions);r.offsets.push(r.positions.length-1),i=o,r.tolerance=Math.max(r.tolerance,a)}return r},h.prototype.evaluatePosition=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,Math.cos(e)*this._radius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.sin(e)*this._radius),i.Vector3.add(t,t,this._center),t},h.prototype.evaluateDt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.sin(e)*this._radius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.cos(e)*this._radius),t},h.prototype.evaluateDtt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.cos(e)*this._radius),i.Vector3.scaleAndAdd(t,t,this._yAxis,-Math.sin(e)*this._radius),t},h.prototype.tangentLength=function(e){return this.getRadius()},h.prototype.getArcLength=function(e){return void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited()),this.getRadius()*(e[1]-e[0])},h.prototype.getParameterFromArcLength=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var r=t[0]+e/this.getRadius();return(0,l.clamp)(r,t[0],t[1])},h.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=(0,l.minMaxCosSinFunc)(this._xAxis[0]*this._radius,this._yAxis[0]*this._radius,this._center[0],e),r=(0,l.minMaxCosSinFunc)(this._xAxis[1]*this._radius,this._yAxis[1]*this._radius,this._center[1],e),i=(0,l.minMaxCosSinFunc)(this._xAxis[2]*this._radius,this._yAxis[2]*this._radius,this._center[2],e),o=new n.BoundingBox;return o.min[0]=t[0],o.max[0]=t[1],o.min[1]=r[0],o.max[1]=r[1],o.min[2]=i[0],o.max[2]=i[1],o},h.prototype.getTangentCone=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=.5*(e[0]+e[1]),r=i.Vector3.createFloat64FromValues(0,0,0);i.Vector3.scaleAndAdd(r,r,this._xAxis,-Math.sin(t)),i.Vector3.scaleAndAdd(r,r,this._yAxis,Math.cos(t));var n=Math.min(Math.PI,.5*(e[1]-e[0]));return new o.TangentCone(r,n)},h.prototype.closestToRayParam=function(e,t,r){var n=i.Vector3.createFloat64();i.Vector3.sub(n,this._center,e);var o=i.Vector3.dot(n,this._normal)/i.Vector3.dot(t,this._normal);if(isFinite(o)){var s=i.Vector3.createFloat64();return i.Vector3.scaleAndAdd(s,e,t,o),this.closestToPointParam(s,r)}},h.prototype.getRadiusAndRangeFromEndpoints=function(e,t,r){var n=i.Vector3.createFloat64();i.Vector3.sub(n,e,this._center);var o=i.Vector3.createFloat64();i.Vector3.sub(o,t,this._center);var a,u=.5*(i.Vector3.length(n)+i.Vector3.length(o)),c=i.Vector3.dot(n,this._xAxis),h=i.Vector3.dot(n,this._yAxis),d=(0,l.normalizeAngle)(Math.atan2(h,c));if(e===t||i.Vector3.squaredDistance(e,t)<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE)a=d+l.PI2;else{var p=i.Vector3.dot(o,this._xAxis),f=i.Vector3.dot(o,this._yAxis);if((a=(0,l.normalizeAngle)(Math.atan2(f,p)))<d&&(a+=l.PI2),r){var g=a;a=d,d=g-l.PI2}}return{radius:u,range:[d,a]}},h.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var r=i.Vector3.createFloat64();i.Vector3.sub(r,e,this._center);var n,o=i.Vector3.dot(r,this._xAxis),a=i.Vector3.dot(r,this._yAxis);return n=o*o+a*a<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE?.5*Math.PI:Math.atan2(a,o),n=(0,l.foldNearTo)(n,.5*(t[0]+t[1]),2*Math.PI),(0,l.clamp)(n,t[0],t[1])},h.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._normal,this._normal,e),i.Vector3.scale(this._xAxis,this._xAxis,this._radius),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),this._radius=i.Vector3.length(this._xAxis),i.Vector3.normalize(this._normal,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis),this._computeYAxis()},h.prototype.suggestSplittingParam=function(e){},h.prototype.toObject=function(){var e=this.evaluatePosition(0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),radius:this.vectorToObject(e),normal:this.vectorToObject(this._normal),range:this.rangeToObject(this.getRange(),this.isLimited())}},t.Circle=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Face=void 0;var i=r(1),n=r(9),o=r(0),s=r(8),a=function(e){n.BaseTopology.call(this),this._surface=e,this._reversed=!1,this._loops=[],this._shell=void 0};(a.prototype=Object.create(n.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.FACE},a.prototype.getSurfaceType=function(){return this._surface?this._surface.getGeometryType():void 0},a.prototype.clone=function(){var e=new a;return e._surface=this._surface?this._surface.clone():void 0,e._reversed=this._reversed,e.setLoops(this._loops),e._shell=this._shell,e._vertexUvData=void 0,e},a.prototype.getSurface=function(){return this._surface},a.prototype.setSurface=function(e){this._surface=e},a.prototype.getShell=function(){return this._shell},a.prototype.setShell=function(e){this._shell=e},a.prototype.getLoops=function(){return this._loops},a.prototype.setLoops=function(e){this._loops=new Array(e.length);for(var t=0;t<e.length;++t)this._loops[t]=e[t]},a.prototype.addLoop=function(e){this._loops?this._loops.push(e):this._loops=[e],e.setFace(this)},a.prototype.addLoops=function(e){this._loops||(this._loops=[]);for(var t=0;t<e.length;++t)e[t].setFace(this);this._loops=this._loops.concat(e)},a.prototype.removeLoop=function(e){var t=this._loops.indexOf(e);return t>-1&&(this._loops.splice(t,1),e.getFace()===this&&e.setFace(void 0),!0)},a.prototype.isReversed=function(){return this._reversed},a.prototype.setReversed=function(e){this._reversed=e},a.prototype.getVertices=function(){return Array.from(this.collectVertices())},a.prototype.evaluatePosition=function(e,t){return this._surface.evaluatePosition(e,t)},a.prototype.evaluateNormal=function(e,t){var r=this._surface.evaluateNormal(e,t);return!0===this.isReversed()&&i.Vector3.negate(r,r),r},a.prototype.getBody=function(){return this._shell?this._shell.getBody():void 0},a.prototype.collectFaces=function(e){return(e=e||new Set).add(this),e},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._loops.length;++t)this._loops[t].collectEdges(e);return e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._loops.length;++t)this._loops[t].collectVertices(e);return e},a.prototype.getBoundingBox=function(){var e=this._surface.getRangeU(),t=this._surface.getRangeV();return isFinite(e[0])&&isFinite(e[1])||(s.DebugUtils.warn("Face.getBoundingBox: Surface is unbounded in u."),e=[0,1]),isFinite(t[0])&&isFinite(t[1])||(s.DebugUtils.warn("Face.getBoundingBox: Surface is unbounded in v."),t=[0,1]),this._surface.getBoundingBox(e,t)},a.prototype.closestParam=function(e){return this._surface.closestParam(e)},a.prototype.isPlanarFace=function(){return this.getSurfaceType()===o.GEOMETRY_TYPES.PLANE},a.prototype.toObject=function(){return{loops:this.refsToStrings(this._loops),reversed:this._reversed,geometry:this.refToString(this._surface),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._loops,this._surface,this._attributes])},t.Face=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vertex=void 0;var i=r(9),n=r(0),o=r(2),s=r(78),a=function(e){i.BaseTopology.call(this),this._point=e,this._precision=0,this._edges=[]};(a.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return n.TOPOLOGY_TYPES.VERTEX},a.prototype.getPoint=function(){return this._point},a.prototype.setPoint=function(e){this._point=e},a.prototype.getPrecision=function(){return this._precision},a.prototype.setPrecision=function(e){o.ConsoleUtils.assert(e>=0),this._precision=e},a.prototype.getEdges=function(){return this._edges},a.prototype.isAdjacentEdge=function(e){return-1!==this._edges.indexOf(e)},a.prototype.getOtherEdge=function(e){for(var t=0;t<this._edges.length;t++){var r=this._edges[t];if(r!==e)return r}return null},a.prototype.getOtherEdges=function(e){for(var t=[],r=0;r<this._edges.length;r++){var i=this._edges[r];i!==e&&t.push(i)}return t},a.prototype.getAdjacentVertices=function(){for(var e=[],t=0;t<this._edges.length;t++){var r=this._edges[t].getOtherVertex(this);r!==this&&e.indexOf(r)<0&&e.push(r)}return e},a.prototype.getCommonEdges=function(e){for(var t=[],r=0;r<this._edges.length;r++){var i=this._edges[r],n=i.getStartVertex(),o=i.getEndVertex();(n===this&&o===e||o===this&&n===e)&&t.push(i)}return t},a.prototype.addEdge=function(e){-1===this._edges.indexOf(e)&&this._edges.push(e)},a.prototype.removeEdge=function(e){var t=this._edges.indexOf(e);return t>=0&&(this._edges.splice(t,1),!0)},a.prototype.getPosition=function(){return this._point.getPosition()},a.prototype.getBody=function(){return this._edges.length>0?this._edges[0].getBody():void 0},a.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)this._edges[t].collectFaces(e);return e},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)e.add(this._edges[t]);return e},a.prototype.collectVertices=function(e){return(e=e||new Set).add(this),e},a.prototype.getBoundingBox=function(){return this._point.getBoundingBox()},a.prototype.toString=function(){return String(this._point.getPosition())},a.prototype.getOrderedFaces=function(){for(var e=[],t=(0,s.getOrderedFacesOnVertex)(this),r=0;r<t.length;r++)t[r].faces.forEach((function(t){e.push(t)}));return e},a.prototype.toObject=function(){return{geometry:this.refToString(this._point),precision:this.getPrecision(),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._point,this._attributes])},t.Vertex=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.controlPointsFromHomogeneous=t.controlPointsToHomogeneous=t.getUniqueKnots=t.findKnotSpanAndMultiplicity=t.findKnotSpan=void 0;var i=r(0),n=r(2),o=function(e,t){var r=0,i=t.length-1;if(e<=t[r]){for(;t[r]===t[r+1]&&r<i-1;)r+=1;return r}if(e>=t[i]){for(;t[i]===t[i-1]&&i>r+1;)i-=1;return i-1}for(var n=Math.floor((r+i)/2);e<t[n]||e>=t[n+1];)e<t[n]?i=n:r=n,n=Math.floor((r+i)/2);return n};t.findKnotSpan=o,t.findKnotSpanAndMultiplicity=function(e,t){var r=i.PARAMETER_SPACE_TOLERANCE,n=o(e,t),s=0,a=e,l=n;if(e<t[l]+r)for(a=t[l];l>=0&&Math.abs(t[l]-a)<r;)--l,++s;else if(e>t[l+1]-r){for(a=t[++l];l<t.length&&Math.abs(t[l]-a)<r;)++l,++s;a=l<t.length?t[n=l-1]:t[t.length-1]}return{span:n,multiplicity:s,knot:a}},t.getUniqueKnots=function(e){for(var t=[e[0]],r=1;r<e.length;++r)e[r]!==e[r-1]&&t.push(e[r]);return t},t.controlPointsToHomogeneous=function(e,t){n.ConsoleUtils.assert(e.length>0&&e.length===3*t.length);for(var r=t.length,i=new Array(4*r),o=0;o<r;++o){var s=t[o];i[4*o]=e[3*o]*s,i[4*o+1]=e[3*o+1]*s,i[4*o+2]=e[3*o+2]*s,i[4*o+3]=s}return i},t.controlPointsFromHomogeneous=function(e){n.ConsoleUtils.assert(e.length>0&&e.length%4==0);for(var t=e.length/4,r=new Array(3*t),i=new Array(t),o=0;o<t;++o){var s=e[4*o+3];r[3*o]=e[4*o]/s,r[3*o+1]=e[4*o+1]/s,r[3*o+2]=e[4*o+2]/s,i[o]=s}return{P:r,w:i}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plane=void 0;var i=r(1),n=r(4),o=r(0),s=r(12),a=r(7),l=r(2),u=function(){s.Surface.call(this),this._origin=i.Vector3.createFloat64(),this._normal=i.Vector3.createFloat64(),this._uAxis=i.Vector3.createFloat64(),this._vAxis=i.Vector3.createFloat64()};(u.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.PLANE},u.prototype.clone=function(){var e=new u;return e.copy(this),e},u.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),i.Vector3.copy(this._origin,e._origin),i.Vector3.copy(this._normal,e._normal),i.Vector3.copy(this._uAxis,e._uAxis),i.Vector3.copy(this._vAxis,e._vAxis)},u.prototype._computeVAxis=function(){i.Vector3.cross(this._vAxis,this._normal,this._uAxis)},u.prototype.set=function(e,t,r){i.Vector3.copy(this._origin,e),l.ConsoleUtils.assert(i.Vector3.squaredLength(t)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._normal,t),void 0===r||i.Vector3.squaredLength(r)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(i.Vector3.computeOrthogonal(this._uAxis,this._normal),i.Vector3.normalize(this._uAxis,this._uAxis)):(l.ConsoleUtils.assert(i.Vector3.isOrthogonal(r,t,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.copy(this._uAxis,r)),this._computeVAxis()},u.prototype.getOrigin=function(){return this._origin},u.prototype.setOrigin=function(e){i.Vector3.copy(this._origin,e)},u.prototype.getNormal=function(){return this._normal},u.prototype.setNormal=function(e){l.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._normal,e),(i.Vector3.squaredLength(this._uAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._uAxis,this._normal,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._uAxis,this._normal),i.Vector3.normalize(this._uAxis,this._uAxis)),this._computeVAxis()},u.prototype.getUAxis=function(){return this._uAxis},u.prototype.setUAxis=function(e){l.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.copy(this._uAxis,e),this._computeVAxis()},u.prototype.evaluatePosition=function(e,t){var r=i.Vector3.clone(this._origin);return i.Vector3.scaleAndAdd(r,r,this._uAxis,e),i.Vector3.scaleAndAdd(r,r,this._vAxis,t),r},u.prototype.evaluateNormal=function(e,t){return i.Vector3.clone(this._normal)},u.prototype.evaluateDu=function(e,t){return i.Vector3.clone(this._uAxis)},u.prototype.evaluateDv=function(e,t){return i.Vector3.clone(this._vAxis)},u.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();return i.Vector3.sub(t,e,this._origin),{u:i.Vector3.dot(t,this._uAxis)/i.Vector3.squaredLength(this._uAxis),v:i.Vector3.dot(t,this._vAxis)/i.Vector3.squaredLength(this._vAxis)}},u.prototype.vParamLine=function(e){var t=new a.Line;return t.set(this.evaluatePosition(e,0),this._vAxis),t},u.prototype.uParamLine=function(e){var t=new a.Line;return t.set(this.evaluatePosition(0,e),this._uAxis),t},u.prototype.getBoundingBox=function(e,t){var r=new n.BoundingBox;return e&&t?(r.includePoint(this.evaluatePosition(e[0],t[0])),r.includePoint(this.evaluatePosition(e[0],t[1])),r.includePoint(this.evaluatePosition(e[1],t[1])),r.includePoint(this.evaluatePosition(e[1],t[0]))):(r.includePoint([-1/0,-1/0,-1/0]),r.includePoint([1/0,1/0,1/0])),r},u.prototype.transform=function(e){i.Vector3.transformMatrix44(this._origin,this._origin,e),i.Vector3.transformAsDirectionMatrix44(this._uAxis,this._uAxis,e),i.Vector3.transformAsDirectionMatrix44(this._vAxis,this._vAxis,e),i.Vector3.transformAsDirectionMatrix44(this._normal,this._normal,e),i.Vector3.normalize(this._normal,this._normal)},u.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},u.prototype.getRangeUnlimitedV=function(){return[-1/0,1/0]},u.prototype.isPeriodicUnlimitedU=function(){return!1},u.prototype.isPeriodicUnlimitedV=function(){return!1},u.prototype.isClosedUnlimitedU=function(){return!1},u.prototype.isClosedUnlimitedV=function(){return!1},u.prototype.toObject=function(){return{origin:this.vectorToObject(this._origin),normal:this.vectorToObject(this._normal),uAxis:this.vectorToObject(this._uAxis),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Plane=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeConnectedFaces=t.mergeFaces=t.findConnectedFaces=t.findConnectedEdges=t.mergeCoincidentVertices=t.transformTopology=t.reverseFace=void 0;var i=r(1),n=r(0),o=r(13),s=r(2),a=function(e){e.setReversed(!e.isReversed())},l=function(e,t){var r=!1,i=!0,n=new Set;t&&(void 0!==t.inputFacesOnly&&(r=t.inputFacesOnly),void 0!==t.allowVertexConnections&&(i=t.allowVertexConnections),void 0!==t.barrierEdges&&(n=new Set(t.barrierEdges)));var o=new Set,s=new Set(e);function a(t){s.delete(t),o.add(t),o.forEach((function(t){var a=new Set;i?t.collectVertices().forEach((function(e){e.collectEdges(a)})):(t.collectEdges(a),n.forEach((function(e){a.delete(e)}))),a.forEach((function(t){for(var i=t.getCoedge(),n=i;n;){if(n.getLoop()){var a=n.getLoop().getFace();o.has(a)||r&&!(e.indexOf(a)>=0)||(o.add(a),s.delete(a))}(n=n.getPartner())===i&&(n=void 0)}}))}))}for(var l=[];s.size>0;)o.clear(),a(s.values().next().value),l.push(Array.from(o));return l},u=function(e){if(1!==e.length){var t=new Set;e.forEach((function(e){e.collectEdges(t)}));var r=new Set,i=[];t.forEach((function(t){var n=t.getCoedges(),o=n.map((function(t){return e.indexOf(t.getFace())>=0}));if(2===n.length&&o[0]&&o[1])i.push(t);else for(var s=0;s<n.length;s++)o[s]&&(r.add(n[s]),n[s].resetUVCurve())}));for(var n=[];r.size>0;){for(var a=[],l=r.values().next().value;l;){a.push(l),r.delete(l);var u=l,c=void 0,h=2*l.getEndVertex().getEdges().length;do{if(u=u.getNext(),r.has(u)){c=u;break}u=u.getPartner()}while(u&&u!==l&&--h>0);l=c}s.ConsoleUtils.assert(a[0].getStartVertex()===a[a.length-1].getEndVertex()),n.push(a)}i.forEach((function(e){e.setStartVertex(null),e.setEndVertex(null)}));var d=e[0];d.setLoops([]),n.forEach((function(e){var t=new o.Loop;t.addCoedges(e),d.addLoop(t)}));for(var p=1;p<e.length;p++)e[p].getShell()&&e[p].getShell().removeFace(e[p]);var f=d.getSurface();f.unlimitRangeU(),f.unlimitRangeV()}};t.reverseFace=function(e){e.setReversed(!e.isReversed());for(var t=e.getLoops(),r=0;r<t.length;++r){for(var i=t[r].getCoedges(),n=0;n<i.length;++n)a(i[n]);i.reverse()}},t.transformTopology=function(e,t){Array.isArray(e)||(e=[e]);for(var r=new Set,i=new Set,o=new Set,s=0;s<e.length;++s){var a=e[s],l=a.getTopologyType();a.collectVertices(r),l!==n.TOPOLOGY_TYPES.VERTEX&&a.collectEdges(i),l!==n.TOPOLOGY_TYPES.VERTEX&&l!==n.TOPOLOGY_TYPES.EDGE&&l!==n.TOPOLOGY_TYPES.COEDGE&&l!==n.TOPOLOGY_TYPES.LOOP&&a.collectFaces(o)}r.forEach((function(e){e.getPoint()&&e.getPoint().transform(t)})),i.forEach((function(e){e.getCurve()&&e.getCurve().transform(t)})),o.forEach((function(e){e.getSurface()&&e.getSurface().transform(t)}))},t.mergeCoincidentVertices=function(e){for(var t=n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE,r=[],o=0;o<e.length;++o){var s,a=e[o],l=a.getStartVertex(),u=a.getEndVertex();for(s=0;s<r.length&&!(i.Vector3.squaredDistance(l.getPosition(),r[s].getPosition())<t);++s);if(s===r.length?r.push(l):(r[s].setPrecision(Math.max(r[s].getPrecision(),l.getPrecision())),a.setStartVertex(r[s])),l!==u)for(s=0;s<r.length&&!(i.Vector3.squaredDistance(u.getPosition(),r[s].getPosition())<t);++s);s===r.length?r.push(u):(r[s].setPrecision(Math.max(r[s].getPrecision(),u.getPrecision())),a.setEndVertex(r[s]))}},t.findConnectedEdges=function(e,t){for(var r=t||!1,i=[],n=new Set,o=0;o<e.length;++o){var s=e[o];if(!n.has(s)){for(var a=[],l=[s],u=0;u<l.length;++u){var c=l[u];n.has(c)||r&&!(e.indexOf(c)>=0)||(n.add(c),a.push(c),l=l.concat(c.getStartVertex().getEdges(),c.getEndVertex().getEdges()))}i.push(a)}}return i},t.findConnectedFaces=l,t.mergeFaces=u,t.mergeConnectedFaces=function(e){var t=[];return l(e,{inputFacesOnly:!0,allowVertexConnections:!1}).forEach((function(e){u(e),t.push(e[0])})),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Edge=void 0;var i=r(1),n=r(9),o=r(0),s=r(2),a=function(e){n.BaseTopology.call(this),this._curve=e,this._reversed=!1,this._vertices=[null,null],this._range=[0,0],this._precision=0,this._coedge=void 0,this._wire=void 0,this._tessellationPoints=[]};(a.prototype=Object.create(n.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.EDGE},a.prototype.getCurveType=function(){return this._curve?this._curve.getGeometryType():void 0},a.prototype.clone=function(){var e=new a;return e._curve=this._curve?this._curve.clone():void 0,e._reversed=this._reversed,e._vertices[0]=this._vertices[0],e._vertices[1]=this._vertices[1],e._range[0]=this._range[0],e._range[1]=this._range[1],e._precision=this._precision,e._coedge=this._coedge,e._wire=this._wire,e._tessellationPoints=[],e},a.prototype.getCurve=function(){return this._curve},a.prototype.setCurve=function(e){this._curve=e},a.prototype.getArcLength=function(){var e=this.getRange();return this.isReversed()&&(e=[-e[1],-e[0]]),this._curve.getArcLength(e)},a.prototype.getVertices=function(){return this._vertices},a.prototype.getVertex=function(e){return s.ConsoleUtils.assert(0===e||1===e),this._vertices[e]},a.prototype.getStartVertex=function(){return this._vertices[0]},a.prototype.getEndVertex=function(){return this._vertices[1]},a.prototype.setCoedge=function(e){this._coedge=e},a.prototype.getCoedge=function(){return this._coedge},a.prototype.getCoedges=function(){for(var e=[],t=this._coedge;t;)e.push(t),(t=t.getPartner())===this._coedge&&(t=void 0);return e},a.prototype.setWire=function(e){this._wire=e},a.prototype.getWire=function(){return this._wire},a.prototype.getRange=function(){return this._range},a.prototype.setRange=function(e){s.ConsoleUtils.assert(2===e.length),this._range[0]=e[0],this._range[1]=e[1]},a.prototype.t0=function(){return this._range[0]},a.prototype.sett0=function(e){this._range[0]=e},a.prototype.t1=function(){return this._range[1]},a.prototype.sett1=function(e){this._range[1]=e},a.prototype.isClosed=function(){return this._curve&&this._vertices[0]&&this._vertices[0]===this._vertices[1]},a.prototype.getOtherVertex=function(e){return s.ConsoleUtils.assert(this._vertices[0]===e||this._vertices[1]===e),this._vertices[0]===e?this._vertices[1]:this._vertices[0]},a.prototype.getCommonVertex=function(e){var t=this.getStartVertex(),r=this.getEndVertex(),i=e.getStartVertex(),n=e.getEndVertex();return t===i||t===n?t:r===i||r===n?r:null},a.prototype.setVertex=function(e,t){s.ConsoleUtils.assert(0===e||1===e),t!==this._vertices[e]&&(this._vertices[e]&&this._vertices[0]!==this._vertices[1]&&this._vertices[e].removeEdge(this),this._vertices[e]=t,t&&this._vertices[e].addEdge(this))},a.prototype.setStartVertex=function(e){this.setVertex(0,e)},a.prototype.setEndVertex=function(e){this.setVertex(1,e)},a.prototype.getCoedgeForFace=function(e){for(var t=this._coedge;t;){if(t.getFace()===e)return t;if((t=t.getPartner())===this._coedge)break}},a.prototype.getOtherFace=function(e){var t=this.getCoedgeForFace(e);s.ConsoleUtils.assert(t);var r=t.getPartner();if(r&&r!==t)return r.getFace()},a.prototype.isReversed=function(){return this._reversed},a.prototype.setReversed=function(e){this._reversed=e},a.prototype.getPrecision=function(){return this._precision},a.prototype.setPrecision=function(e){s.ConsoleUtils.assert(e>=0),this._precision=e},a.prototype.evaluatePosition=function(e){return this.isReversed()&&(e=-e),this._curve.evaluatePosition(e)},a.prototype.evaluateDt=function(e){this.isReversed()&&(e=-e);var t=this._curve.evaluateDt(e);return this.isReversed()&&i.Vector3.negate(t,t),t},a.prototype.evaluateCurvature=function(e,t){return this.isReversed()&&(e=-e),this._curve.evaluateCurvature(e,t)},a.prototype.closestToPointParam=function(e,t){if(this._curve){var r=t||this.getRange();this.isReversed()&&(r=[-r[1],-r[0]]);var i=this._curve.closestToPointParam(e,r);return this.isReversed()?-i:i}},a.prototype.includesPoint=function(e){var t=Math.max(this.getPrecision(),o.KERNEL_TOLERANCE),r=this.closestToPointParam(e),n=this.evaluatePosition(r);return i.Vector3.squaredDistance(n,e)<t*t},a.prototype.distanceToPoint=function(e){var t=this.closestToPointParam(e),r=this.evaluatePosition(t);return i.Vector3.distance(r,e)},a.prototype.tessellate=function(e,t){var r,n;if(!1===this.isReversed())r=e||[this._range[0],this._range[1]];else if(e){r=new Array(e.length);for(var o=0;o<e.length;++o)r[o]=-e[e.length-1-o]}else r=[-this._range[1],-this._range[0]];var s,a=this._curve.tessellate(r,t);if(this._tessellationPoints.length!==a.positions.length)for(this._tessellationPoints=new Array(a.positions.length),o=0;o<a.positions.length;o++)this._tessellationPoints[o]=i.Vector3.createFloat64();if(!1===this.isReversed())for(s=a.offsets,n=0;n<a.positions.length;++n)i.Vector3.copy(this._tessellationPoints[n],a.positions[n]);else{for(n=0;n<a.positions.length;++n)i.Vector3.copy(this._tessellationPoints[n],a.positions[a.positions.length-1-n]);for(s=new Array(a.offsets.length),n=0;n<a.offsets.length;++n)s[n]=a.positions.length-1-a.offsets[a.offsets.length-1-n]}return{positions:this._tessellationPoints,offsets:s,tolerance:a.tolerance}},a.prototype.getBody=function(){return s.ConsoleUtils.assert(void 0===this._coedge||void 0===this._wire),this._coedge?this._coedge.getBody():this._wire?this._wire.getBody():void 0},a.prototype.collectFaces=function(e){e=e||new Set;for(var t=this._coedge;t;)t.collectFaces(e),(t=t.getPartner())===this._coedge&&(t=void 0);return e},a.prototype.collectEdges=function(e){return(e=e||new Set).add(this),e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._vertices.length;++t)this._vertices[t]&&e.add(this._vertices[t]);return e},a.prototype.getBoundingBox=function(){var e=this.getRange();return!0===this.isReversed()&&(e=[-e[1],-e[0]]),this._curve.getBoundingBox(e)},a.prototype.closestToRayParam=function(e,t,r){var i=this.getRange();!0===this.isReversed()&&(i=[-i[1],-i[0]]);var n=this._curve.closestToRayParam(e,t,i,r);return!0===this.isReversed()?-n:n},a.prototype.toString=function(){return o.GEOMETRY_TYPES.toString(this.getCurveType())+" "+String(this.getStartVertex())+" -> "+String(this.getEndVertex())},a.prototype.getLoops=function(){for(var e=this.getCoedges(),t=new Set,r=0;r<e.length;r++)t.add(e[r].getLoop());return Array.from(t)},a.prototype.toObject=function(){return{vertex0:this.refToString(this._vertices[0]),vertex1:this.refToString(this._vertices[1]),precision:this._precision,range:this.rangeToObject(this._range,!0),reversed:this._reversed,geometry:this.refToString(this._curve),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._vertices[0],this._vertices[1],this._curve,this._attributes])},t.Edge=a},function(e,t,r){"use strict";e.exports=o,o.className="ReflectionObject";var i,n=r(5);function o(e,t){if(!n.isString(e))throw TypeError("name must be a string");if(t&&!n.isObject(t))throw TypeError("options must be an object");this.options=t,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},o.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},o.prototype.getOption=function(e){if(this.options)return this.options[e]},o.prototype.setOption=function(e,t,r){return r&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},o.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o._configure=function(e){i=e}},function(e,t,r){"use strict";e.exports=u;var i=r(21);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var n,o=r(11),s=r(31),a=r(5),l=/^required|optional|repeated$/;function u(e,t,r,n,o,u,c){if(a.isObject(n)?(c=o,u=n,n=o=void 0):a.isObject(o)&&(c=u,u=o,o=void 0),i.call(this,e,u),!a.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!a.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==o&&!a.isString(o))throw TypeError("extend must be a string");this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=o||void 0,this.required="required"===n,this.optional=!this.required,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&void 0!==s.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=c}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,r){return"packed"===e&&(this._packed=null),i.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return a.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=s.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,e=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,e=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.d=function(e,t,r,i){return"function"==typeof t?t=a.decorateType(t).name:t&&"object"==_typeof(t)&&(t=a.decorateEnum(t).name),function(n,o){a.decorateType(n.constructor).add(new u(o,e,t,r,{default:i}))}},u._configure=function(e){n=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ellipse=void 0;var i=r(1),n=r(4),o=r(34),s=r(0),a=r(32),l=r(3),u=r(35),c=r(2),h=r(50),d=function(){a.Curve.call(this),this._center=i.Vector3.createFloat64FromValues(0,0,0),this._normal=i.Vector3.createFloat64FromValues(0,0,1),this._xAxis=i.Vector3.createFloat64FromValues(1,0,0),this._yAxis=i.Vector3.createFloat64FromValues(0,1,0),this._majorRadius=0,this._minorRadius=0,this._tessellationCache=new h.TessellationCache};(d.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.ELLIPSE},d.prototype.set=function(e,t,r,n){c.ConsoleUtils.assert(i.Vector3.squaredLength(t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),c.ConsoleUtils.assert(i.Vector3.squaredLength(r)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),c.ConsoleUtils.assert(i.Vector3.isOrthogonal(t,r,s.KERNEL_ANGULAR_TOLERANCE)),c.ConsoleUtils.assert(n>i.FLOAT64_TOLERANCE&&n<=1,"Invalid radius ratio"),i.Vector3.copy(this._center,e),i.Vector3.normalize(this._normal,t),i.Vector3.normalize(this._xAxis,r),this._majorRadius=i.Vector3.length(r),this._minorRadius=this._majorRadius*n,this._computeYAxis(),this._dirtyTessellation()},d.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._normal,this._xAxis)},d.prototype.getCenter=function(){return this._center},d.prototype.getNormal=function(){return this._normal},d.prototype.setCenter=function(e){i.Vector3.copy(this._center,e),this._dirtyTessellation()},d.prototype.setNormal=function(e){c.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),this._normal!==e&&(i.Vector3.normalize(this._normal,e),i.Vector3.isOrthogonal(this._xAxis,this._normal)||(i.Vector3.computeOrthogonal(this._xAxis,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis(),this._dirtyTessellation())},d.prototype.setMajorAxis=function(e){c.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),c.ConsoleUtils.assert(i.Vector3.isOrthogonal(e,this._normal,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,e),this._computeYAxis(),this._dirtyTessellation()},d.prototype.getMajorAxis=function(){return this._xAxis},d.prototype.getMinorAxis=function(){return this._yAxis},d.prototype.clone=function(){var e=new d;return e.copy(this),e},d.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._normal,e._normal)},d.prototype.getMajorRadius=function(){return this._majorRadius},d.prototype.getMinorRadius=function(){return this._minorRadius},d.prototype.setMajorRadius=function(e){c.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._majorRadius=e,this._dirtyTessellation()},d.prototype.setMinorRadius=function(e){c.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._minorRadius=e,this._dirtyTessellation()},d.prototype.getRangeUnlimited=function(){return[-Math.PI,Math.PI]},d.prototype.isPeriodicUnlimited=function(){return!0},d.prototype.isClosedUnlimited=function(){return!0},d.prototype._dirtyTessellation=function(){this._tessellationCache.setDirty(!0)},d.prototype._evaluateArcLengthIntegrand=function(e){var t=this._majorRadius*Math.sin(e),r=this._minorRadius*Math.cos(e);return Math.sqrt(t*t+r*r)},d.prototype.getArcLength=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());for(var t=e[0],r=0;t<e[1]+s.PARAMETER_SPACE_TOLERANCE;){for(var i=t,n=[this._evaluateArcLengthIntegrand(t)];n.length<5&&t<e[1]+s.PARAMETER_SPACE_TOLERANCE;)t+=.01,n.push(this._evaluateArcLengthIntegrand(t));switch(i=t-i,n.length){case 1:break;case 2:r+=(n[0]+n[1])*i/2;break;case 3:r+=(n[0]+4*n[1]+n[2])*i/6;break;case 4:r+=(n[0]+3*n[1]+3*n[2]+n[3])*i/8;break;default:r+=(7*n[0]+32*n[1]+12*n[2]+32*n[3]+7*n[4])*i/90}(i=t-e[1])>s.PARAMETER_SPACE_TOLERANCE&&(r-=this._evaluateArcLengthIntegrand(e[1])*i)}return r},d.prototype.getParameterFromArcLength=function(e,t){return void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited()),(0,u.invertIntegral1D)(this._evaluateArcLengthIntegrand.bind(this),e,t)},d.prototype.evaluatePosition=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,Math.cos(e)*this._majorRadius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.sin(e)*this._minorRadius),i.Vector3.add(t,t,this._center),t},d.prototype.evaluateDt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.sin(e)*this._majorRadius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.cos(e)*this._minorRadius),t},d.prototype.evaluateDtt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.cos(e)*this._majorRadius),i.Vector3.scaleAndAdd(t,t,this._yAxis,-Math.sin(e)*this._minorRadius),t},d.prototype._getFullTessellation=function(e){var t=[-Math.PI,-Math.PI/2,0,Math.PI/2,Math.PI],r=h.CurveTessellator.getAdaptiveRenderPoints(this,e,[-Math.PI,Math.PI],t);return r.didRetessellate=!0,r},d.prototype.tessellate=function(e,t){return t=t||s.TESSELLATION.LINEAR_PRECISION,this._tessellationCache.getTessellation(e,this,t,this._getFullTessellation.bind(this))},d.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=(0,l.minMaxCosSinFunc)(this._xAxis[0]*this._majorRadius,this._yAxis[0]*this._minorRadius,this._center[0],e),r=(0,l.minMaxCosSinFunc)(this._xAxis[1]*this._majorRadius,this._yAxis[1]*this._minorRadius,this._center[1],e),i=(0,l.minMaxCosSinFunc)(this._xAxis[2]*this._majorRadius,this._yAxis[2]*this._minorRadius,this._center[2],e),o=new n.BoundingBox;return o.min[0]=t[0],o.max[0]=t[1],o.min[1]=r[0],o.max[1]=r[1],o.min[2]=i[0],o.max[2]=i[1],o},d.prototype.getTangentCone=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=this.evaluateDt(e[0]);i.Vector3.normalize(t,t);var r=this.evaluateDt(e[1]);i.Vector3.normalize(r,r);var n=i.Vector3.createFloat64(),a=i.Vector3.dot(t,r),u=i.Vector3.dot(i.Vector3.cross(n,t,r),this._normal),c=Math.atan2(u,a);c<0?c+=l.PI2:e[1]-e[0]>l.PI2-s.PARAMETER_SPACE_TOLERANCE&&(c=l.PI2),c*=.5,a=Math.cos(c),u=Math.sin(c);var h=i.Vector3.clone(t);return i.Vector3.scale(h,h,a),i.Vector3.cross(n,this._normal,t),i.Vector3.scaleAndAdd(h,h,n,u),new o.TangentCone(h,c)},d.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._normal,this._normal,e),i.Vector3.scale(this._xAxis,this._xAxis,this._majorRadius),i.Vector3.scale(this._yAxis,this._yAxis,this._minorRadius),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),this._majorRadius=i.Vector3.length(this._xAxis),this._minorRadius=i.Vector3.length(this._yAxis),i.Vector3.normalize(this._normal,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis),this._computeYAxis(),this._dirtyTessellation()},d.prototype.closestToRayParam=function(e,t,r){var n=i.Vector3.createFloat64();i.Vector3.sub(n,this._center,e);var o=i.Vector3.dot(n,this._normal)/i.Vector3.dot(t,this._normal);if(isFinite(o)){var s=i.Vector3.createFloat64();return i.Vector3.scaleAndAdd(s,e,t,o),this.closestToPointParam(s,r)}},d.prototype.isCircular=function(){return Math.abs(this._majorRadius-this._minorRadius)<s.KERNEL_TOLERANCE},d.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var r=i.Vector3.createFloat64();i.Vector3.sub(r,e,this._center);var n=i.Vector3.dot(r,this._xAxis),o=i.Vector3.dot(r,this._yAxis);if(n*n+o*o<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE){var a=.5*Math.PI;if(((a=(0,l.adjustParameterToPeriodicRange)(a,t,l.PI2))<t[0]||a>t[1])&&(a=(0,l.adjustParameterToPeriodicRange)(.5*-Math.PI,t,l.PI2)),a<t[0]||a>t[1]){var c=this.evaluatePosition(t[0]),h=this.evaluatePosition(t[1]);a=i.Vector3.squaredDistance(this._center,c)<i.Vector3.squaredDistance(this._center,h)?t[0]:t[1]}return a}var d=this._majorRadius,p=this._minorRadius,f=Math.atan2(d*o,p*n),g=this.evaluatePosition(f);i.Vector3.sub(g,g,this._center),n*n+o*o<i.Vector3.squaredLength(g)&&(f=(o<s.KERNEL_TOLERANCE?-1:1)*Math.acos(n/d));var v,y=i.FLOAT64_TOLERANCE,m=function(t){var r=this.evaluatePosition(t),i=this.evaluateDt(t),n=this.evaluateDtt(t),o=[r[0]-e[0],r[1]-e[1],r[2]-e[2]];return{val:2*(o[0]*i[0]+o[1]*i[1]+o[2]*i[2]),deriv:2*(o[0]*n[0]+o[1]*n[1]+o[2]*n[2]+(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]))}},_=(0,u.newtonRaphson1D)(m.bind(this),void 0,f,y,32);(_=(0,l.adjustParameterToPeriodicRange)(_,t,l.PI2))<t[0]||_>t[1]?(_=(0,u.newtonRaphson1D)(m.bind(this),void 0,-_,y,32),v=(_=(0,l.adjustParameterToPeriodicRange)(_,t,l.PI2))<t[0]||_>t[1]?1/0:i.Vector3.squaredDistance(e,this.evaluatePosition(_))):v=i.Vector3.squaredDistance(e,this.evaluatePosition(_));var E=i.Vector3.squaredDistance(e,this.evaluatePosition(t[0])),x=i.Vector3.squaredDistance(e,this.evaluatePosition(t[1]));return E<v&&(v=E,_=t[0]),x<v&&(_=t[1]),_},d.prototype.suggestSplittingParam=function(e){},d.prototype.toObject=function(){var e=this.evaluatePosition(0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),majorRadius:this.vectorToObject(e),normal:this.vectorToObject(this._normal),radiusRatio:this.getMinorRadius()/this.getMajorRadius(),range:this.rangeToObject(this.getRange(),this.isLimited())}},t.Ellipse=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Body=void 0;var i=r(9),n=r(0),o=r(4),s=r(19),a=function(){i.BaseTopology.call(this),this._lumps=[]};(a.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return n.TOPOLOGY_TYPES.BODY},a.prototype.getLumps=function(){return this._lumps},a.prototype.setLumps=function(e){this._lumps=new Array(e.length);for(var t=0;t<e.length;++t)this._lumps[t]=e[t]},a.prototype.addLump=function(e){this._lumps?this._lumps.push(e):this._lumps=[e],e.setBody(this)},a.prototype.addLumps=function(e){this._lumps||(this._lumps=[]);for(var t=0;t<e.length;++t)e[t].setBody(this);this._lumps=this._lumps.concat(e)},a.prototype.removeLump=function(e){var t=this._lumps.indexOf(e);return t>-1&&(this._lumps.splice(t,1),e.getBody()===this&&e.setBody(void 0),!0)},a.prototype.getBody=function(){return this},a.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._lumps.length;++t)this._lumps[t].collectFaces(e);return e},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._lumps.length;++t)this._lumps[t].collectEdges(e);return e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._lumps.length;++t)this._lumps[t].collectVertices(e);return e},a.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._lumps.length;++t)e.include(this._lumps[t].getBoundingBox());return e},a.prototype.transform=function(e){(0,s.transformTopology)(this,e)},a.prototype.toObject=function(){return{lumps:this.refsToStrings(this._lumps),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._lumps,this._attributes])},t.Body=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lump=void 0;var i=r(9),n=r(0),o=r(4),s=function(){i.BaseTopology.call(this),this._shells=[],this._body=void 0};(s.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return n.TOPOLOGY_TYPES.LUMP},s.prototype.getBody=function(){return this._body},s.prototype.setBody=function(e){this._body=e},s.prototype.getShells=function(){return this._shells},s.prototype.setShells=function(e){this._shells=new Array(e.length);for(var t=0;t<e.length;++t)this._shells[t]=e[t]},s.prototype.addShell=function(e){this._shells?this._shells.push(e):this._shells=[e],e.setLump(this)},s.prototype.addShells=function(e){this._shells||(this._shells=[]);for(var t=0;t<e.length;++t)e[t].setLump(this);this._shells=this._shells.concat(e)},s.prototype.removeShell=function(e){var t=this._shells.indexOf(e);return t>-1&&(this._shells.splice(t,1),e.getLump()===this&&e.setLump(void 0),!0)},s.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._shells.length;++t)this._shells[t].collectFaces(e);return e},s.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._shells.length;++t)this._shells[t].collectEdges(e);return e},s.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._shells.length;++t)this._shells[t].collectVertices(e);return e},s.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._shells.length;++t)e.include(this._shells[t].getBoundingBox());return e},s.prototype.toString=function(){return"Lump"},s.prototype.toObject=function(){return{shells:this.refsToStrings(this._shells),attributes:this.refsToStrings(this._attributes)}},s.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._shells,this._attributes])},t.Lump=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Shell=void 0;var i=r(9),n=r(0),o=r(4),s=function(){i.BaseTopology.call(this),this._faces=[],this._lump=void 0};(s.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return n.TOPOLOGY_TYPES.SHELL},s.prototype.getLump=function(){return this._lump},s.prototype.setLump=function(e){this._lump=e},s.prototype.getFaces=function(){return this._faces},s.prototype.setFaces=function(e){this._faces=new Array(e.length);for(var t=0;t<e.length;++t)this._faces[t]=e[t]},s.prototype.addFace=function(e){this._faces?this._faces.push(e):this._faces=[e],e.setShell(this)},s.prototype.addFaces=function(e){this._faces||(this._faces=[]);for(var t=0;t<e.length;++t)e[t].setShell(this);this._faces=this._faces.concat(e)},s.prototype.removeFace=function(e){var t=this._faces.indexOf(e);return t>-1&&(this._faces.splice(t,1),e.getShell()===this&&e.setShell(void 0),!0)},s.prototype.getBody=function(){return this._lump?this._lump.getBody():void 0},s.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._faces.length;++t)e.add(this._faces[t]);return e},s.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._faces.length;++t)this._faces[t].collectEdges(e);return e},s.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._faces.length;++t)this._faces[t].collectVertices(e);return e},s.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._faces.length;++t)e.include(this._faces[t].getBoundingBox());return e},s.prototype.toString=function(){return"Shell"},s.prototype.toObject=function(){return{faces:this.refsToStrings(this._faces),attributes:this.refsToStrings(this._attributes)}},s.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._faces,this._attributes])},t.Shell=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Coedge=void 0;var i=r(1),n=r(9),o=r(0),s=r(2),a=r(3),l=r(36),u=function(e){n.BaseTopology.call(this),this._reversed=!1,this._edge=e,this._loop=void 0,this._partner=void 0,this._uvCurve=void 0};(u.prototype=Object.create(n.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.COEDGE},u.prototype.getEdge=function(){return this._edge},u.prototype.getLoop=function(){return this._loop},u.prototype.getPartner=function(){return this._partner},u.prototype.setEdge=function(e){this._edge=e},u.prototype.setLoop=function(e){this._loop=e},u.prototype.setPartner=function(e){this._partner=e},u.prototype.getStartVertex=function(){return this._reversed?this._edge.getEndVertex():this._edge.getStartVertex()},u.prototype.getEndVertex=function(){return this._reversed?this._edge.getStartVertex():this._edge.getEndVertex()},u.prototype.getFace=function(){return this._loop?this._loop.getFace():void 0},u.prototype.getNext=function(){if(this._loop){var e=this._loop.getCoedges(),t=e.indexOf(this);return s.ConsoleUtils.assert(t>=0),e[(t+1)%e.length]}},u.prototype.getPrevious=function(){if(this._loop){var e=this._loop.getCoedges(),t=e.indexOf(this);return s.ConsoleUtils.assert(t>=0),e[(0,a.modulus)(t-1,e.length)]}},u.prototype.isReversed=function(){return this._reversed},u.prototype.setReversed=function(e){this._reversed=e},u.prototype.getRange=function(){if(this._edge)return this._reversed?[-this._edge.t1(),-this._edge.t0()]:[this._edge.t0(),this._edge.t1()]},u.prototype.t0=function(){if(this._edge)return this._reversed?-this._edge.t1():this._edge.t0()},u.prototype.t1=function(){if(this._edge)return this._reversed?-this._edge.t0():this._edge.t1()},u.prototype.evaluatePosition=function(e){if(this._edge)return this.isReversed()&&(e=-e),this._edge.evaluatePosition(e)},u.prototype.evaluateDt=function(e){if(this._edge){this.isReversed()&&(e=-e);var t=this._edge.evaluateDt(e);return this.isReversed()&&i.Vector3.negate(t,t),t}},u.prototype.evaluateCurvature=function(e,t){if(this._edge)return this.isReversed()&&(e=-e),this._edge.evaluateCurvature(e,t)},u.prototype.evaluateFaceUV=function(e){var t=this.getFace();if(t){var r=this.evaluatePosition(e);return t.closestParam(r)}},u.prototype.evaluateInwardDirection=function(e){var t=this.getFace();if(t){var r=this.evaluateDt(e),n=this.evaluateFaceUV(e),o=t.evaluateNormal(n.u,n.v),s=[0,0,0];return i.Vector3.cross(s,o,r),i.Vector3.normalize(s,s),s}},u.prototype.getBoundingBox=function(){if(this._edge)return this._edge.getBoundingBox()},u.prototype.generateUVCurve=function(e){if(!this._uvCurve&&this._edge){var t=this._edge.getCurve();if(t&&this._loop&&this._loop.getFace()){var r=this._loop.getFace().getSurface();r&&r.getGeometryType()===o.GEOMETRY_TYPES.PLANE&&(e||(e=(0,a.getPlaneTransforms)(r).threeSpaceToUV),e?(this._uvCurve=t.clone(),this._uvCurve.transform(e)):this._uvCurve=t)}}},u.prototype.resetUVCurve=function(){this._uvCurve=void 0},u.prototype.uvAngleSubtended=function(e){var t=this._loop.getFace().getSurface().closestParam(e),r=[t.u,t.v,0];this.generateUVCurve(),s.ConsoleUtils.assert(this._uvCurve);var n=this.getRange(),u=1;this.isReversed()!==this._edge.isReversed()&&(n=[-n[1],-n[0]],u=-1),this._loop&&this._loop.getFace()&&this._loop.getFace().isReversed()&&(u*=-1);var c=!1,h=this._uvCurve.getRange();this._uvCurve.isClosed()&&n[1]-n[0]>=h[1]-h[0]-2*o.PARAMETER_SPACE_TOLERANCE&&(c=!0);var d=this._uvCurve.evaluatePosition(n[0]),p=this._uvCurve.evaluatePosition(n[1]),f=i.Vector3.createFloat64();i.Vector3.sub(f,d,r),i.Vector3.normalize(f,f);var g=i.Vector3.createFloat64();i.Vector3.sub(g,p,r),i.Vector3.normalize(g,g);var v=(0,a.getSignedAngle)(f,g),y=v<0,m=!1,_=!1;switch(this._edge.getCurveType()){case o.GEOMETRY_TYPES.LINE:break;case o.GEOMETRY_TYPES.CIRCLE:_=this._uvCurve.getNormal()[2]>0,m=i.Vector3.distance(r,this._uvCurve.getCenter())<this._uvCurve.getRadius(),c||(m=m&&y!==_);break;case o.GEOMETRY_TYPES.ELLIPSE:_=this._uvCurve.getNormal()[2]>0;var E=i.Vector3.sub([0,0,0],r,this._uvCurve.getCenter()),x=i.Vector3.dot(E,this._uvCurve.getMajorAxis())/this._uvCurve.getMajorRadius(),b=i.Vector3.dot(E,this._uvCurve.getMinorAxis())/this._uvCurve.getMinorRadius();m=x*x+b*b<=1,c||(m=m&&y!==_);break;case o.GEOMETRY_TYPES.BCURVE:this._uvCurve.isPlanarXY()||console.warn("Unsupported non-planar curve for uvAngleSubtended");var A=[r[0],r[1]];m=l.SplineCurveHelper.isPointInsideSplineRegionXYPlanar3D(A,this._uvCurve,n),_=!0;break;default:throw new Error("Unsupported curve type for uvAngleSubtended")}return c?v=m?2*Math.PI*(_?-1:1):0:m&&(v<0?v=2*Math.PI+v:v-=2*Math.PI),v*u},u.prototype.getBody=function(){return this._loop?this._loop.getBody():void 0},u.prototype.collectFaces=function(e){return e=e||new Set,this._loop&&this._loop.collectFaces(e),e},u.prototype.collectEdges=function(e){return e=e||new Set,this._edge&&e.add(this._edge),e},u.prototype.collectVertices=function(e){return e=e||new Set,this._edge&&this._edge.collectVertices(e),e},u.prototype.toString=function(){return"Coedge"},u.prototype.toObject=function(){return{edge:this.refToString(this._edge),partner:this.refToString(this._partner),reversed:this._reversed,attributes:this.refsToStrings(this._attributes)}},u.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._edge,this._attributes])},t.Coedge=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createShellsFromFaces=t.createWiresFromEdges=t.createEdgesFromCurves=t.createEdgeFromCurve=t.createLoopFromPolyline=t.createFaceFromPolyline=t.makeConeOrCylinderVParamLoop=t.createCoedgeOnEdge=t.createLineEdge=t.createLineEdgeBetweenVertices=void 0;var i=r(1),n=r(0),o=r(2),s=r(6),a=r(7),l=r(18),u=r(27),c=r(16),h=r(26),d=r(20),p=r(13),f=r(15),g=r(40),v=r(3),y=r(19),m=function(e,t){var r=e.getPosition(),n=t.getPosition(),o=new a.Line;o.setFromEndpoints(r,n);var s=new d.Edge(o);return s.setRange([0,i.Vector3.distance(r,n)]),s.setStartVertex(e),s.setEndVertex(t),s},_=function(e){var t=new u.Coedge;t.setEdge(e);var r=e.getCoedge();return r?(o.ConsoleUtils.assert(!r.getPartner()),r.setPartner(t),t.setPartner(r),t.setReversed(!r.isReversed())):e.setCoedge(t),t},E=function(e){for(var t=e.length,r=new Array(t),i=0;i<t;++i)r[i]=new c.Vertex(new s.Point(e[i]));var n=new Array(t);for(i=0;i<t;++i){var o=(i+1)%t,a=m(r[i],r[o]);n[i]=_(a)}var l=new p.Loop;return l.addCoedges(n),l},x=function(e){var t=new d.Edge(e),r=e.getRange();r[0]!==-1/0&&r[1]!==1/0?(t.sett0(r[0]),t.sett1(r[1])):(t.sett0(0),t.sett1(1));var i=t.evaluatePosition(t.t0());if(t.setStartVertex(new c.Vertex(new s.Point(i))),e.isClosed())t.setEndVertex(t.getStartVertex());else{var n=t.evaluatePosition(t.t1());t.setEndVertex(new c.Vertex(new s.Point(n)))}return t};t.createLineEdgeBetweenVertices=m,t.createLineEdge=function(e,t){var r=new c.Vertex(new s.Point(e)),i=new c.Vertex(new s.Point(t));return m(r,i)},t.createCoedgeOnEdge=_,t.makeConeOrCylinderVParamLoop=function(e,t){o.ConsoleUtils.assert(e.getGeometryType()===n.GEOMETRY_TYPES.CYLINDER||e.getGeometryType()===n.GEOMETRY_TYPES.CONE||e.getGeometryType()===n.GEOMETRY_TYPES.ELLIPTICAL_CYLINDER||e.getGeometryType()===n.GEOMETRY_TYPES.ELLIPTICAL_CONE),o.ConsoleUtils.assert(e.isPeriodicV());var r,i=new d.Edge,a=e.vParamLine(t);a.getGeometryType()===n.GEOMETRY_TYPES.POINT?r=a:(r=new s.Point(a.evaluatePosition(a.getRange()[0])),i.setCurve(a),i.setRange(a.getRange()));var l=new c.Vertex(r);i.setStartVertex(l),i.setEndVertex(l);var u=new p.Loop;return u.addCoedge(_(i)),u},t.createFaceFromPolyline=function(e){var t=E(e),r=(0,v.definePlaneThroughPoints)(e),i=new l.Plane;i.set(r.origin,r.normal,r.uAxis),i.limitRangeU(r.uRange),i.limitRangeV(r.vRange);var n=new f.Face(i);return n.addLoop(t),n},t.createLoopFromPolyline=E,t.createEdgeFromCurve=x,t.createEdgesFromCurves=function(e){for(var t=[],r=0;r<e.length;++r)t.push(x(e[r]));return(0,y.mergeCoincidentVertices)(t),t},t.createWiresFromEdges=function(e){for(var t=(0,y.findConnectedEdges)(e),r=[],i=0;i<t.length;++i){var n=new g.Wire;n.addEdges(t[i]),r.push(n)}return r},t.createShellsFromFaces=function(e){for(var t=(0,y.findConnectedFaces)(e),r=new Array(t.length),i=0;i<t.length;++i){var n=new h.Shell;n.addFaces(t[i]),r[i]=n}return r}},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"default",(function(){return y})),r.d(t,"VERSION",(function(){return m})),r.d(t,"iteratee",(function(){return x})),r.d(t,"restArguments",(function(){return A})),r.d(t,"each",(function(){return M})),r.d(t,"forEach",(function(){return M})),r.d(t,"map",(function(){return L})),r.d(t,"collect",(function(){return L})),r.d(t,"reduce",(function(){return k})),r.d(t,"foldl",(function(){return k})),r.d(t,"inject",(function(){return k})),r.d(t,"reduceRight",(function(){return I})),r.d(t,"foldr",(function(){return I})),r.d(t,"find",(function(){return F})),r.d(t,"detect",(function(){return F})),r.d(t,"filter",(function(){return N})),r.d(t,"select",(function(){return N})),r.d(t,"reject",(function(){return D})),r.d(t,"every",(function(){return B})),r.d(t,"all",(function(){return B})),r.d(t,"some",(function(){return z})),r.d(t,"any",(function(){return z})),r.d(t,"contains",(function(){return j})),r.d(t,"includes",(function(){return j})),r.d(t,"include",(function(){return j})),r.d(t,"invoke",(function(){return U})),r.d(t,"pluck",(function(){return G})),r.d(t,"where",(function(){return Y})),r.d(t,"findWhere",(function(){return K})),r.d(t,"max",(function(){return H})),r.d(t,"min",(function(){return q})),r.d(t,"shuffle",(function(){return W})),r.d(t,"sample",(function(){return X})),r.d(t,"sortBy",(function(){return J})),r.d(t,"groupBy",(function(){return Q})),r.d(t,"indexBy",(function(){return $})),r.d(t,"countBy",(function(){return ee})),r.d(t,"toArray",(function(){return re})),r.d(t,"size",(function(){return ie})),r.d(t,"partition",(function(){return ne})),r.d(t,"first",(function(){return oe})),r.d(t,"head",(function(){return oe})),r.d(t,"take",(function(){return oe})),r.d(t,"initial",(function(){return se})),r.d(t,"last",(function(){return ae})),r.d(t,"rest",(function(){return le})),r.d(t,"tail",(function(){return le})),r.d(t,"drop",(function(){return le})),r.d(t,"compact",(function(){return ue})),r.d(t,"flatten",(function(){return he})),r.d(t,"without",(function(){return de})),r.d(t,"uniq",(function(){return pe})),r.d(t,"unique",(function(){return pe})),r.d(t,"union",(function(){return fe})),r.d(t,"intersection",(function(){return ge})),r.d(t,"difference",(function(){return ve})),r.d(t,"unzip",(function(){return ye})),r.d(t,"zip",(function(){return me})),r.d(t,"object",(function(){return _e})),r.d(t,"findIndex",(function(){return xe})),r.d(t,"findLastIndex",(function(){return be})),r.d(t,"sortedIndex",(function(){return Ae})),r.d(t,"indexOf",(function(){return Te})),r.d(t,"lastIndexOf",(function(){return Pe})),r.d(t,"range",(function(){return Re})),r.d(t,"chunk",(function(){return Se})),r.d(t,"bind",(function(){return we})),r.d(t,"partial",(function(){return Me})),r.d(t,"bindAll",(function(){return Le})),r.d(t,"memoize",(function(){return Oe})),r.d(t,"delay",(function(){return ke})),r.d(t,"defer",(function(){return Ie})),r.d(t,"throttle",(function(){return Fe})),r.d(t,"debounce",(function(){return Ne})),r.d(t,"wrap",(function(){return De})),r.d(t,"negate",(function(){return Be})),r.d(t,"compose",(function(){return ze})),r.d(t,"after",(function(){return je})),r.d(t,"before",(function(){return Ue})),r.d(t,"once",(function(){return Ge})),r.d(t,"keys",(function(){return qe})),r.d(t,"allKeys",(function(){return We})),r.d(t,"values",(function(){return Xe})),r.d(t,"mapObject",(function(){return Je})),r.d(t,"pairs",(function(){return Ze})),r.d(t,"invert",(function(){return Qe})),r.d(t,"functions",(function(){return $e})),r.d(t,"methods",(function(){return $e})),r.d(t,"extend",(function(){return tt})),r.d(t,"extendOwn",(function(){return rt})),r.d(t,"assign",(function(){return rt})),r.d(t,"findKey",(function(){return it})),r.d(t,"pick",(function(){return ot})),r.d(t,"omit",(function(){return st})),r.d(t,"defaults",(function(){return at})),r.d(t,"create",(function(){return lt})),r.d(t,"clone",(function(){return ut})),r.d(t,"tap",(function(){return ct})),r.d(t,"isMatch",(function(){return ht})),r.d(t,"isEqual",(function(){return dt})),r.d(t,"isEmpty",(function(){return pt})),r.d(t,"isElement",(function(){return ft})),r.d(t,"isArray",(function(){return vt})),r.d(t,"isObject",(function(){return yt})),r.d(t,"isArguments",(function(){return mt})),r.d(t,"isFunction",(function(){return _t})),r.d(t,"isString",(function(){return Et})),r.d(t,"isNumber",(function(){return xt})),r.d(t,"isDate",(function(){return bt})),r.d(t,"isRegExp",(function(){return At})),r.d(t,"isError",(function(){return Ct})),r.d(t,"isSymbol",(function(){return Tt})),r.d(t,"isMap",(function(){return Pt})),r.d(t,"isWeakMap",(function(){return Rt})),r.d(t,"isSet",(function(){return St})),r.d(t,"isWeakSet",(function(){return Vt})),r.d(t,"isFinite",(function(){return Mt})),r.d(t,"isNaN",(function(){return Lt})),r.d(t,"isBoolean",(function(){return Ot})),r.d(t,"isNull",(function(){return kt})),r.d(t,"isUndefined",(function(){return It})),r.d(t,"has",(function(){return Ft})),r.d(t,"identity",(function(){return Nt})),r.d(t,"constant",(function(){return Dt})),r.d(t,"noop",(function(){return Bt})),r.d(t,"property",(function(){return zt})),r.d(t,"propertyOf",(function(){return jt})),r.d(t,"matcher",(function(){return Ut})),r.d(t,"matches",(function(){return Ut})),r.d(t,"times",(function(){return Gt})),r.d(t,"random",(function(){return Yt})),r.d(t,"now",(function(){return Kt})),r.d(t,"escape",(function(){return Xt})),r.d(t,"unescape",(function(){return Jt})),r.d(t,"result",(function(){return Zt})),r.d(t,"uniqueId",(function(){return $t})),r.d(t,"templateSettings",(function(){return er})),r.d(t,"template",(function(){return or})),r.d(t,"chain",(function(){return sr})),r.d(t,"mixin",(function(){return lr}));var i="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self.self===self&&self||"object"==_typeof(e)&&e.global===e&&e||Function("return this")()||{},n=Array.prototype,o=Object.prototype,s="undefined"!=typeof Symbol?Symbol.prototype:null,a=n.push,l=n.slice,u=o.toString,c=o.hasOwnProperty,h=Array.isArray,d=Object.keys,p=Object.create,f=i.isNaN,g=i.isFinite,v=function(){};function y(e){return e instanceof y?e:this instanceof y?void(this._wrapped=e):new y(e)}var m=y.VERSION="1.10.2";function _(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,i,n){return e.call(t,r,i,n)};case 4:return function(r,i,n,o){return e.call(t,r,i,n,o)}}return function(){return e.apply(t,arguments)}}function E(e,t,r){return null==e?Nt:_t(e)?_(e,t,r):yt(e)&&!vt(e)?Ut(e):zt(e)}function x(e,t){return E(e,t,1/0)}function b(e,t,r){return y.iteratee!==x?y.iteratee(e,t):E(e,t,r)}function A(e,t){return t=null==t?e.length-1:+t,function(){for(var r=Math.max(arguments.length-t,0),i=Array(r),n=0;n<r;n++)i[n]=arguments[n+t];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,arguments[0],i);case 2:return e.call(this,arguments[0],arguments[1],i)}var o=Array(t+1);for(n=0;n<t;n++)o[n]=arguments[n];return o[t]=i,e.apply(this,o)}}function C(e){if(!yt(e))return{};if(p)return p(e);v.prototype=e;var t=new v;return v.prototype=null,t}function T(e){return function(t){return null==t?void 0:t[e]}}function P(e,t){return null!=e&&c.call(e,t)}function R(e,t){for(var r=t.length,i=0;i<r;i++){if(null==e)return;e=e[t[i]]}return r?e:void 0}y.iteratee=x;var S=Math.pow(2,53)-1,V=T("length");function w(e){var t=V(e);return"number"==typeof t&&t>=0&&t<=S}function M(e,t,r){var i,n;if(t=_(t,r),w(e))for(i=0,n=e.length;i<n;i++)t(e[i],i,e);else{var o=qe(e);for(i=0,n=o.length;i<n;i++)t(e[o[i]],o[i],e)}return e}function L(e,t,r){t=b(t,r);for(var i=!w(e)&&qe(e),n=(i||e).length,o=Array(n),s=0;s<n;s++){var a=i?i[s]:s;o[s]=t(e[a],a,e)}return o}function O(e){return function(t,r,i,n){var o=arguments.length>=3;return function(t,r,i,n){var o=!w(t)&&qe(t),s=(o||t).length,a=e>0?0:s-1;for(n||(i=t[o?o[a]:a],a+=e);a>=0&&a<s;a+=e){var l=o?o[a]:a;i=r(i,t[l],l,t)}return i}(t,_(r,n,4),i,o)}}var k=O(1),I=O(-1);function F(e,t,r){var i=(w(e)?xe:it)(e,t,r);if(void 0!==i&&-1!==i)return e[i]}function N(e,t,r){var i=[];return t=b(t,r),M(e,(function(e,r,n){t(e,r,n)&&i.push(e)})),i}function D(e,t,r){return N(e,Be(b(t)),r)}function B(e,t,r){t=b(t,r);for(var i=!w(e)&&qe(e),n=(i||e).length,o=0;o<n;o++){var s=i?i[o]:o;if(!t(e[s],s,e))return!1}return!0}function z(e,t,r){t=b(t,r);for(var i=!w(e)&&qe(e),n=(i||e).length,o=0;o<n;o++){var s=i?i[o]:o;if(t(e[s],s,e))return!0}return!1}function j(e,t,r,i){return w(e)||(e=Xe(e)),("number"!=typeof r||i)&&(r=0),Te(e,t,r)>=0}var U=A((function(e,t,r){var i,n;return _t(t)?n=t:vt(t)&&(i=t.slice(0,-1),t=t[t.length-1]),L(e,(function(e){var o=n;if(!o){if(i&&i.length&&(e=R(e,i)),null==e)return;o=e[t]}return null==o?o:o.apply(e,r)}))}));function G(e,t){return L(e,zt(t))}function Y(e,t){return N(e,Ut(t))}function K(e,t){return F(e,Ut(t))}function H(e,t,r){var i,n,o=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=_typeof(e[0])&&null!=e)for(var a=0,l=(e=w(e)?e:Xe(e)).length;a<l;a++)null!=(i=e[a])&&i>o&&(o=i);else t=b(t,r),M(e,(function(e,r,i){((n=t(e,r,i))>s||n===-1/0&&o===-1/0)&&(o=e,s=n)}));return o}function q(e,t,r){var i,n,o=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=_typeof(e[0])&&null!=e)for(var a=0,l=(e=w(e)?e:Xe(e)).length;a<l;a++)null!=(i=e[a])&&i<o&&(o=i);else t=b(t,r),M(e,(function(e,r,i){((n=t(e,r,i))<s||n===1/0&&o===1/0)&&(o=e,s=n)}));return o}function W(e){return X(e,1/0)}function X(e,t,r){if(null==t||r)return w(e)||(e=Xe(e)),e[Yt(e.length-1)];var i=w(e)?ut(e):Xe(e),n=V(i);t=Math.max(Math.min(t,n),0);for(var o=n-1,s=0;s<t;s++){var a=Yt(s,o),l=i[s];i[s]=i[a],i[a]=l}return i.slice(0,t)}function J(e,t,r){var i=0;return t=b(t,r),G(L(e,(function(e,r,n){return{value:e,index:i++,criteria:t(e,r,n)}})).sort((function(e,t){var r=e.criteria,i=t.criteria;if(r!==i){if(r>i||void 0===r)return 1;if(r<i||void 0===i)return-1}return e.index-t.index})),"value")}function Z(e,t){return function(r,i,n){var o=t?[[],[]]:{};return i=b(i,n),M(r,(function(t,n){var s=i(t,n,r);e(o,t,s)})),o}}var Q=Z((function(e,t,r){P(e,r)?e[r].push(t):e[r]=[t]})),$=Z((function(e,t,r){e[r]=t})),ee=Z((function(e,t,r){P(e,r)?e[r]++:e[r]=1})),te=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function re(e){return e?vt(e)?l.call(e):Et(e)?e.match(te):w(e)?L(e,Nt):Xe(e):[]}function ie(e){return null==e?0:w(e)?e.length:qe(e).length}var ne=Z((function(e,t,r){e[r?0:1].push(t)}),!0);function oe(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[0]:se(e,e.length-t)}function se(e,t,r){return l.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))}function ae(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[e.length-1]:le(e,Math.max(0,e.length-t))}function le(e,t,r){return l.call(e,null==t||r?1:t)}function ue(e){return N(e,Boolean)}function ce(e,t,r,i){for(var n=(i=i||[]).length,o=0,s=V(e);o<s;o++){var a=e[o];if(w(a)&&(vt(a)||mt(a)))if(t)for(var l=0,u=a.length;l<u;)i[n++]=a[l++];else ce(a,t,r,i),n=i.length;else r||(i[n++]=a)}return i}function he(e,t){return ce(e,t,!1)}var de=A((function(e,t){return ve(e,t)}));function pe(e,t,r,i){Ot(t)||(i=r,r=t,t=!1),null!=r&&(r=b(r,i));for(var n=[],o=[],s=0,a=V(e);s<a;s++){var l=e[s],u=r?r(l,s,e):l;t&&!r?(s&&o===u||n.push(l),o=u):r?j(o,u)||(o.push(u),n.push(l)):j(n,l)||n.push(l)}return n}var fe=A((function(e){return pe(ce(e,!0,!0))}));function ge(e){for(var t=[],r=arguments.length,i=0,n=V(e);i<n;i++){var o=e[i];if(!j(t,o)){var s;for(s=1;s<r&&j(arguments[s],o);s++);s===r&&t.push(o)}}return t}var ve=A((function(e,t){return t=ce(t,!0,!0),N(e,(function(e){return!j(t,e)}))}));function ye(e){for(var t=e&&H(e,V).length||0,r=Array(t),i=0;i<t;i++)r[i]=G(e,i);return r}var me=A(ye);function _e(e,t){for(var r={},i=0,n=V(e);i<n;i++)t?r[e[i]]=t[i]:r[e[i][0]]=e[i][1];return r}function Ee(e){return function(t,r,i){r=b(r,i);for(var n=V(t),o=e>0?0:n-1;o>=0&&o<n;o+=e)if(r(t[o],o,t))return o;return-1}}var xe=Ee(1),be=Ee(-1);function Ae(e,t,r,i){for(var n=(r=b(r,i,1))(t),o=0,s=V(e);o<s;){var a=Math.floor((o+s)/2);r(e[a])<n?o=a+1:s=a}return o}function Ce(e,t,r){return function(i,n,o){var s=0,a=V(i);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(r&&o&&a)return i[o=r(i,n)]===n?o:-1;if(n!=n)return(o=t(l.call(i,s,a),Lt))>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&o<a;o+=e)if(i[o]===n)return o;return-1}}var Te=Ce(1,xe,Ae),Pe=Ce(-1,be);function Re(e,t,r){null==t&&(t=e||0,e=0),r||(r=t<e?-1:1);for(var i=Math.max(Math.ceil((t-e)/r),0),n=Array(i),o=0;o<i;o++,e+=r)n[o]=e;return n}function Se(e,t){if(null==t||t<1)return[];for(var r=[],i=0,n=e.length;i<n;)r.push(l.call(e,i,i+=t));return r}function Ve(e,t,r,i,n){if(!(i instanceof t))return e.apply(r,n);var o=C(e.prototype),s=e.apply(o,n);return yt(s)?s:o}var we=A((function(e,t,r){if(!_t(e))throw new TypeError("Bind must be called on a function");var i=A((function(n){return Ve(e,i,t,this,r.concat(n))}));return i})),Me=A((function(e,t){var r=Me.placeholder;return function i(){for(var n=0,o=t.length,s=Array(o),a=0;a<o;a++)s[a]=t[a]===r?arguments[n++]:t[a];for(;n<arguments.length;)s.push(arguments[n++]);return Ve(e,i,this,this,s)}}));Me.placeholder=y;var Le=A((function(e,t){var r=(t=ce(t,!1,!1)).length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var i=t[r];e[i]=we(e[i],e)}}));function Oe(e,t){var r=function r(i){var n=r.cache,o=""+(t?t.apply(this,arguments):i);return P(n,o)||(n[o]=e.apply(this,arguments)),n[o]};return r.cache={},r}var ke=A((function(e,t,r){return setTimeout((function(){return e.apply(null,r)}),t)})),Ie=Me(ke,y,1);function Fe(e,t,r){var i,n,o,s,a=0;r||(r={});var l=function(){a=!1===r.leading?0:Kt(),i=null,s=e.apply(n,o),i||(n=o=null)},u=function(){var u=Kt();a||!1!==r.leading||(a=u);var c=t-(u-a);return n=this,o=arguments,c<=0||c>t?(i&&(clearTimeout(i),i=null),a=u,s=e.apply(n,o),i||(n=o=null)):i||!1===r.trailing||(i=setTimeout(l,c)),s};return u.cancel=function(){clearTimeout(i),a=0,i=n=o=null},u}function Ne(e,t,r){var i,n,o=function(t,r){i=null,r&&(n=e.apply(t,r))},s=A((function(s){if(i&&clearTimeout(i),r){var a=!i;i=setTimeout(o,t),a&&(n=e.apply(this,s))}else i=ke(o,t,this,s);return n}));return s.cancel=function(){clearTimeout(i),i=null},s}function De(e,t){return Me(t,e)}function Be(e){return function(){return!e.apply(this,arguments)}}function ze(){var e=arguments,t=e.length-1;return function(){for(var r=t,i=e[t].apply(this,arguments);r--;)i=e[r].call(this,i);return i}}function je(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function Ue(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}}var Ge=Me(Ue,2),Ye=!{toString:null}.propertyIsEnumerable("toString"),Ke=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function He(e,t){var r=Ke.length,i=e.constructor,n=_t(i)&&i.prototype||o,s="constructor";for(P(e,s)&&!j(t,s)&&t.push(s);r--;)(s=Ke[r])in e&&e[s]!==n[s]&&!j(t,s)&&t.push(s)}function qe(e){if(!yt(e))return[];if(d)return d(e);var t=[];for(var r in e)P(e,r)&&t.push(r);return Ye&&He(e,t),t}function We(e){if(!yt(e))return[];var t=[];for(var r in e)t.push(r);return Ye&&He(e,t),t}function Xe(e){for(var t=qe(e),r=t.length,i=Array(r),n=0;n<r;n++)i[n]=e[t[n]];return i}function Je(e,t,r){t=b(t,r);for(var i=qe(e),n=i.length,o={},s=0;s<n;s++){var a=i[s];o[a]=t(e[a],a,e)}return o}function Ze(e){for(var t=qe(e),r=t.length,i=Array(r),n=0;n<r;n++)i[n]=[t[n],e[t[n]]];return i}function Qe(e){for(var t={},r=qe(e),i=0,n=r.length;i<n;i++)t[e[r[i]]]=r[i];return t}function $e(e){var t=[];for(var r in e)_t(e[r])&&t.push(r);return t.sort()}function et(e,t){return function(r){var i=arguments.length;if(t&&(r=Object(r)),i<2||null==r)return r;for(var n=1;n<i;n++)for(var o=arguments[n],s=e(o),a=s.length,l=0;l<a;l++){var u=s[l];t&&void 0!==r[u]||(r[u]=o[u])}return r}}var tt=et(We),rt=et(qe);function it(e,t,r){t=b(t,r);for(var i,n=qe(e),o=0,s=n.length;o<s;o++)if(t(e[i=n[o]],i,e))return i}function nt(e,t,r){return t in r}var ot=A((function(e,t){var r={},i=t[0];if(null==e)return r;_t(i)?(t.length>1&&(i=_(i,t[1])),t=We(e)):(i=nt,t=ce(t,!1,!1),e=Object(e));for(var n=0,o=t.length;n<o;n++){var s=t[n],a=e[s];i(a,s,e)&&(r[s]=a)}return r})),st=A((function(e,t){var r,i=t[0];return _t(i)?(i=Be(i),t.length>1&&(r=t[1])):(t=L(ce(t,!1,!1),String),i=function(e,r){return!j(t,r)}),ot(e,i,r)})),at=et(We,!0);function lt(e,t){var r=C(e);return t&&rt(r,t),r}function ut(e){return yt(e)?vt(e)?e.slice():tt({},e):e}function ct(e,t){return t(e),e}function ht(e,t){var r=qe(t),i=r.length;if(null==e)return!i;for(var n=Object(e),o=0;o<i;o++){var s=r[o];if(t[s]!==n[s]||!(s in n))return!1}return!0}function dt(e,t){return function e(t,r,i,n){if(t===r)return 0!==t||1/t==1/r;if(null==t||null==r)return!1;if(t!=t)return r!=r;var o=_typeof(t);return("function"===o||"object"===o||"object"==_typeof(r))&&function(t,r,i,n){t instanceof y&&(t=t._wrapped),r instanceof y&&(r=r._wrapped);var o=u.call(t);if(o!==u.call(r))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+r;case"[object Number]":return+t!=+t?+r!=+r:0==+t?1/+t==1/r:+t==+r;case"[object Date]":case"[object Boolean]":return+t==+r;case"[object Symbol]":return s.valueOf.call(t)===s.valueOf.call(r)}var a="[object Array]"===o;if(!a){if("object"!=_typeof(t)||"object"!=_typeof(r))return!1;var l=t.constructor,c=r.constructor;if(l!==c&&!(_t(l)&&l instanceof l&&_t(c)&&c instanceof c)&&"constructor"in t&&"constructor"in r)return!1}n=n||[];for(var h=(i=i||[]).length;h--;)if(i[h]===t)return n[h]===r;if(i.push(t),n.push(r),a){if((h=t.length)!==r.length)return!1;for(;h--;)if(!e(t[h],r[h],i,n))return!1}else{var d,p=qe(t);if(h=p.length,qe(r).length!==h)return!1;for(;h--;)if(!P(r,d=p[h])||!e(t[d],r[d],i,n))return!1}return i.pop(),n.pop(),!0}(t,r,i,n)}(e,t)}function pt(e){return null==e||(w(e)&&(vt(e)||Et(e)||mt(e))?0===e.length:0===qe(e).length)}function ft(e){return!(!e||1!==e.nodeType)}function gt(e){return function(t){return u.call(t)==="[object "+e+"]"}}var vt=h||gt("Array");function yt(e){var t=_typeof(e);return"function"===t||"object"===t&&!!e}var mt=gt("Arguments"),_t=gt("Function"),Et=gt("String"),xt=gt("Number"),bt=gt("Date"),At=gt("RegExp"),Ct=gt("Error"),Tt=gt("Symbol"),Pt=gt("Map"),Rt=gt("WeakMap"),St=gt("Set"),Vt=gt("WeakSet");!function(){mt(arguments)||(mt=function(e){return P(e,"callee")})}();var wt=i.document&&i.document.childNodes;function Mt(e){return!Tt(e)&&g(e)&&!f(parseFloat(e))}function Lt(e){return xt(e)&&f(e)}function Ot(e){return!0===e||!1===e||"[object Boolean]"===u.call(e)}function kt(e){return null===e}function It(e){return void 0===e}function Ft(e,t){if(!vt(t))return P(e,t);for(var r=t.length,i=0;i<r;i++){var n=t[i];if(null==e||!c.call(e,n))return!1;e=e[n]}return!!r}function Nt(e){return e}function Dt(e){return function(){return e}}function Bt(){}function zt(e){return vt(e)?function(t){return R(t,e)}:T(e)}function jt(e){return null==e?function(){}:function(t){return vt(t)?R(e,t):e[t]}}function Ut(e){return e=rt({},e),function(t){return ht(t,e)}}function Gt(e,t,r){var i=Array(Math.max(0,e));t=_(t,r,1);for(var n=0;n<e;n++)i[n]=t(n);return i}function Yt(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}"object"!=("undefined"==typeof Int8Array?"undefined":_typeof(Int8Array))&&"function"!=typeof wt&&(_t=function(e){return"function"==typeof e||!1});var Kt=Date.now||function(){return(new Date).getTime()},Ht={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},qt=Qe(Ht);function Wt(e){var t=function(t){return e[t]},r="(?:"+qe(e).join("|")+")",i=RegExp(r),n=RegExp(r,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(n,t):e}}var Xt=Wt(Ht),Jt=Wt(qt);function Zt(e,t,r){vt(t)||(t=[t]);var i=t.length;if(!i)return _t(r)?r.call(e):r;for(var n=0;n<i;n++){var o=null==e?void 0:e[t[n]];void 0===o&&(o=r,n=i),e=_t(o)?o.call(e):o}return e}var Qt=0;function $t(e){var t=++Qt+"";return e?e+t:t}var er=y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},tr=/(.)^/,rr={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},ir=/\\|'|\r|\n|\u2028|\u2029/g,nr=function(e){return"\\"+rr[e]};function or(e,t,r){!t&&r&&(t=r),t=at({},t,y.templateSettings);var i,n=RegExp([(t.escape||tr).source,(t.interpolate||tr).source,(t.evaluate||tr).source].join("|")+"|$","g"),o=0,s="__p+='";e.replace(n,(function(t,r,i,n,a){return s+=e.slice(o,a).replace(ir,nr),o=a+t.length,r?s+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":n&&(s+="';\n"+n+"\n__p+='"),t})),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(t.variable||"obj","_",s)}catch(e){throw e.source=s,e}var a=function(e){return i.call(this,e,y)},l=t.variable||"obj";return a.source="function("+l+"){\n"+s+"}",a}function sr(e){var t=y(e);return t._chain=!0,t}function ar(e,t){return e._chain?y(t).chain():t}function lr(e){return M($e(e),(function(t){var r=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),ar(this,r.apply(y,e))}})),y}M(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=n[e];y.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==e&&"splice"!==e||0!==r.length||delete r[0],ar(this,r)}})),M(["concat","join","slice"],(function(e){var t=n[e];y.prototype[e]=function(){return ar(this,t.apply(this._wrapped,arguments))}})),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return String(this._wrapped)}}.call(this,r(57))},function(e,t,r){"use strict";e.exports=c;var i=r(21);((c.prototype=Object.create(i.prototype)).constructor=c).className="Namespace";var n,o,s,a=r(22),l=r(5);function u(e,t){if(e&&e.length){for(var r={},i=0;i<e.length;++i)r[e[i].name]=e[i].toJSON(t);return r}}function c(e,t){i.call(this,e,t),this.nested=void 0,this._nestedArray=null}function h(e){return e._nestedArray=null,e}c.fromJSON=function(e,t){return new c(e,t.options).addJSON(t.nested)},c.arrayToJSON=u,c.isReservedId=function(e,t){if(e)for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>=t)return!0;return!1},c.isReservedName=function(e,t){if(e)for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1},Object.defineProperty(c.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),c.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},c.prototype.addJSON=function(e){if(e)for(var t,r=Object.keys(e),i=0;i<r.length;++i)t=e[r[i]],this.add((void 0!==t.fields?n.fromJSON:void 0!==t.values?s.fromJSON:void 0!==t.methods?o.fromJSON:void 0!==t.id?a.fromJSON:c.fromJSON)(r[i],t));return this},c.prototype.get=function(e){return this.nested&&this.nested[e]||null},c.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},c.prototype.add=function(e){if(!(e instanceof a&&void 0!==e.extend||e instanceof n||e instanceof s||e instanceof o||e instanceof c))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof c&&e instanceof c)||t instanceof n||t instanceof o)throw Error("duplicate name '"+e.name+"' in "+this);for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),h(this)},c.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),h(this)},c.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(!((r=r.nested[i])instanceof c))throw Error("path conflicts with non-namespace objects")}else r.add(r=new c(i))}return t&&r.addJSON(t),r},c.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof c?e[t++].resolveAll():e[t++].resolve();return this.resolve()},c.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(1===e.length){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof c&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var n=0;n<this.nestedArray.length;++n)if(this._nestedArray[n]instanceof c&&(i=this._nestedArray[n].lookup(e,t,!0)))return i;return null===this.parent||r?null:this.parent.lookup(e,t)},c.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},c.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},c.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},c.prototype.lookupService=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},c._configure=function(e,t,r){n=e,o=t,s=r}},function(e,t,r){"use strict";var i=t,n=r(5),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function s(e,t){var r=0,i={};for(t|=0;r<e.length;)i[o[r+t]]=e[r++];return i}i.basic=s([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),i.defaults=s([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",n.emptyArray,null]),i.long=s([0,0,0,1,1],7),i.mapKey=s([0,0,0,5,5,0,0,0,1,1,0,2],2),i.packed=s([1,5,0,0,0,5,5,0,0,0,1,1,0])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Curve=void 0;var i=r(1),n=r(43),o=r(0),s=r(3),a=r(2),l=function(){n.BaseGeometry.call(this),this._subrange=[]};(l.prototype=Object.create(n.BaseGeometry.prototype)).copy=function(e){n.BaseGeometry.prototype.copy.call(this,e),this._subrange=e.isLimited()?[e._subrange[0],e._subrange[1]]:[]},l.prototype.isLimited=function(){return this._subrange.length>0},l.prototype.getRange=function(){return this.isLimited()?this._subrange:this.getRangeUnlimited()},l.prototype.getRangeUnlimited=function(){console.warn("Curve.getRangeUnlimited : abstract method invoked!")},l.prototype.limitRange=function(e){this._subrange=(0,s.limitRange)(this.getRange(),e,this.isPeriodic(),this.getPeriod())},l.prototype.unlimitRange=function(){this._subrange=[]},l.prototype.isPeriodic=function(){return this.isPeriodicUnlimited()&&!this.isLimited()},l.prototype.isPeriodicUnlimited=function(){console.warn("Curve.isPeriodicUnlimited : abstract method invoked!")},l.prototype.getPeriod=function(){return this.isLimited()?void 0:this.getPeriodUnlimited()},l.prototype.getPeriodUnlimited=function(){if(this.isPeriodicUnlimited()){var e=this.getRangeUnlimited();return e[1]-e[0]}},l.prototype.isClosed=function(){if(this.isClosedUnlimited()){if(this.isLimited()){var e=this.getRangeUnlimited(),t=e[1]-e[0];return this._subrange[1]-this._subrange[0]>t-o.PARAMETER_SPACE_TOLERANCE}return!0}return!1},l.prototype.isClosedUnlimited=function(){console.warn("Curve.isClosedUnlimited : abstract method invoked!")},l.prototype._restrictRangeToUnlimited=function(e){a.ConsoleUtils.assert(2===e.length),a.ConsoleUtils.assert(e[0]<=e[1]);var t=this.getRangeUnlimited(),r=[];if(this.isPeriodicUnlimited()){var n=t[1]-t[0];if(e[1]-e[0]>n-o.PARAMETER_SPACE_TOLERANCE)r.push([t[0],t[1]]);else{var l=(0,s.foldAbove)(e[0],t[0],n)-e[0];r.push([e[0]+l,e[1]+l]),r[0][1]>t[1]+o.PARAMETER_SPACE_TOLERANCE&&(r.push([t[0],r[0][1]-n]),r[0][1]=t[1])}}else{var u=Math.max(e[0],t[0]),c=Math.min(e[1],t[1]);u>t[1]?u<t[1]+i.FLOAT64_TOLERANCE&&r.push([t[1],t[1]]):c<t[0]?c>t[0]-i.FLOAT64_TOLERANCE&&r.push([t[0],t[0]]):r.push([u,c])}return r},l.prototype.transform=function(e){console.warn("Curve.transform : abstract method invoked! Doing nothing.")},l.prototype.evaluatePosition=function(e){console.warn("Curve.evaluatePosition : abstract method invoked! Returning undefined.")},l.prototype.evaluateDt=function(e){console.warn("Curve.evaluateDt : abstract method invoked! Returning undefined.")},l.prototype.evaluateCurvature=function(e,t){var r=this.evaluateDt(e),n=this.evaluateDt(e+o.KERNEL_TOLERANCE);i.Vector3.sub(n,n,r);var s=i.Vector3.createFloat64();i.Vector3.scale(s,n,1/o.KERNEL_TOLERANCE),t&&(i.Vector3.copy(t,s),i.Vector3.normalize(t,t));var a=i.Vector3.squaredLength(r);return i.Vector3.cross(s,r,s),i.Vector3.length(s)/Math.pow(a,1.5)},l.prototype.tangentLength=function(e){return i.Vector3.length(this.evaluateDt(e))},l.prototype.suggestSplittingParam=function(e){console.warn("Curve.suggestSplittingParam : abstract method invoked! Returning undefined.")},l.prototype.getTangentCone=function(e){console.warn("Curve.getTangentCone : abstract method invoked! Returning undefined.")},l.prototype.closestToRayParam=function(e,t,r){console.warn("Curve.closestToRayParam : abstract method invoked! Returning undefined.")},l.prototype.closestToPointParam=function(e,t){console.warn("Curve.closestToPointParam : abstract method invoked! Returning undefined.")},l.prototype.getArcLength=function(e){console.warn("Curve.getArcLength : abstract method invoked!")},l.prototype.getParameterFromArcLength=function(e,t){console.warn("Curve.getParameterFromArcLength : abstract method invoked!")},l.prototype.getBoundingBox=function(e){console.warn("Curve.getBoundingBox : abstract method invoked! Returning undefined.")},l.prototype.tessellate=function(e,t){console.warn("Curve.tessellate : abstract method invoked! Returning undefined.")},t.Curve=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BCurve=void 0;var i=r(1),n=r(4),o=r(34),s=r(0),a=r(32),l=r(7),u=r(3),c=r(35),h=r(2),d=r(8),p=r(50),f=r(36),g=r(17),v=r(37),y=r(102),m=r(73),_=function(){a.Curve.call(this),this._controlPoints=[],this._weights=[],this._degree=0,this._knots=[],this._isRational=void 0,this._isPeriodic=void 0,this._isClosed=void 0,this._isPlanarXY=void 0,this._discretizationCache=void 0,this._segments=void 0,this._hasDirtySegments=!0,this._isDirtyControlPoint=[],this._tessellationCache=new p.TessellationCache};(_.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.BCURVE},_.prototype.clone=function(){var e=new _;return e.copy(this),e},_.prototype.getControlPointsVector3=function(){for(var e=new Array(this._controlPoints.length/3),t=0;t<this._controlPoints.length/3;t++)e[t]=i.Vector3.createFloat64FromValues(this._controlPoints[3*t],this._controlPoints[3*t+1],this._controlPoints[3*t+2]);return e},_.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),this._isRational=e._isRational,this._weights=e._weights.slice(0),this._degree=e._degree,this._knots=e._knots.slice(0),this._isPeriodic=e._isPeriodic,this._isClosed=e._isClosed,this._weights=e._weights.slice(0),this._controlPoints=e._controlPoints.slice(0),this._isPlanarXY=e._isPlanarXY,this._hasDirtySegments=!0,this._tessellationCache.reset()},_.prototype.set=function(e,t,r,n){this.dirtyCurveRepresentation(),this._weights=Array.prototype.slice.call(t),this._degree=r;var o=0;if(this._isRational=!1,this._weights.length!==t.length){this._weights=Array.prototype.slice.call(t);var s=this._weights[0];for(o=1;o<this._weights.length;++o)if(Math.abs(this._weights[o]-s)>i.FLOAT64_TOLERANCE){this._isRational=!0;break}}else for(s=this._weights[0],o=1;o<this._weights.length;++o)this._weights[o]=t[o],Math.abs(this._weights[o]-s)>i.FLOAT64_TOLERANCE&&(this._isRational=!0);if(this._knots.length!==n.length)this._knots=Array.prototype.slice.call(n);else for(o=0;o<this._knots.length;++o)this._knots[o]=n[o];var a=e.length/3;if(0===this._weights.length)for(this._weights=new Array(a),o=0;o<a;++o)this._weights[o]=1;if(this._controlPoints.length!==e.length)this._controlPoints=Array.prototype.slice.call(e);else for(o=0;o<e.length;++o)this._controlPoints[o]=e[o];this._isDirtyControlPoint.length!==a&&(this._isDirtyControlPoint=new Array(a)),this._isDirtyControlPoint.fill(!1)},_.prototype.dirtyCurveRepresentation=function(){this._isPlanarXY=void 0,this._isRational=void 0,this._isClosed=void 0,this._isPeriodic=void 0,this._discretizationCache=void 0,this._hasDirtySegments=!0,this._tessellationCache.setDirty(!0)},_.prototype.hasDirtyTessellation=function(){return this._tessellationCache.isDirty()},_.prototype.getTessellationCacheTolerance=function(){return this._tessellationCache.getTolerance()},_.prototype.weightedControlPoints=function(){for(var e=[],t=0;t<this._controlPoints.length/3;++t){var r=this._weights[t];e.push(this._controlPoints[3*t]*r,this._controlPoints[3*t+1]*r,this._controlPoints[3*t+2]*r,r)}return e},_.prototype.getControlPoints=function(){return this._controlPoints},_.prototype._findChangedControlPoints=function(e){var t=e.length===this._controlPoints.length;t||(this._isDirtyControlPoint=new Array(e.length/3),this._isDirtyControlPoint.fill(!0));for(var r=0;r<e.length/3;++r)if(t){var i=e[3*r]-this._controlPoints[3*r],n=e[3*r+1]-this._controlPoints[3*r+1],o=e[3*r+2]-this._controlPoints[3*r+2];i*i+n*n+o*o>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE&&(this._isDirtyControlPoint[r]=!0)}else this._isDirtyControlPoint[r]=!0},_.prototype.setControlPoints=function(e){this._findChangedControlPoints(e),this._controlPoints=e,this.dirtyCurveRepresentation()},_.prototype.copyControlPoints=function(e){if(this._findChangedControlPoints(e),e!==this._controlPoints){this._controlPoints.length=e.length;for(var t=0;t<e.length;++t)this._controlPoints[t]=e[t]}this.dirtyCurveRepresentation()},_.prototype.transform=function(e){for(var t=[],r=i.Vector3.createFloat64(),n=0;n<this._controlPoints.length;n+=3)i.Vector3.set(r,this._controlPoints[n],this._controlPoints[n+1],this._controlPoints[n+2]),i.Vector3.transformMatrix44(r,r,e),t.push(r[0],r[1],r[2]);this.setControlPoints(t)},_.prototype.getControlPointPosition=function(e){return i.Vector3.createFloat64FromValues(this._controlPoints[3*e],this._controlPoints[3*e+1],this._controlPoints[3*e+2])},_.prototype.extendBBoxFromControlPoints=function(e){for(var t=i.Vector3.createFloat64(),r=0;r<this._controlPoints.length;r+=3)i.Vector3.set(t,this._controlPoints[r],this._controlPoints[r+1],this._controlPoints[r+2]),e.includePoint(t)},_.prototype.setControlPointPosition=function(e,t,r,i){this._controlPoints[3*e]=t,this._controlPoints[3*e+1]=r,this._controlPoints[3*e+2]=i,this._isDirtyControlPoint[e]=!0,this.dirtyCurveRepresentation()},_.prototype.getWeights=function(){return this._weights},_.prototype.setWeights=function(e){this._weights=e,this.dirtyCurveRepresentation()},_.prototype.getKnotVector=function(){return this._knots},_.prototype.setKnotVector=function(e){this._knots=e,this.dirtyCurveRepresentation()},_.prototype.getDegree=function(){return this._degree},_.prototype.isRational=function(){if(void 0===this._isRational&&(this._isRational=!1,this._weights))for(var e=this._weights[0],t=0;t<this._weights.length;++t)if(Math.abs(this._weights[t]-e)>i.FLOAT64_TOLERANCE)return this._isRational=!0,!0;return this._isRational},_.prototype.isSimpleBezier=function(){return this._knots.length===2*this._degree+2},_.prototype.getNumControlPoints=function(){return this._controlPoints.length/3},_.prototype.getTessellationCache=function(){return this._tessellationCache.getCache()},_.prototype.getEvaluationCache=function(){return void 0===this._discretizationCache&&this.evaluate(),this._discretizationCache},_.prototype.getRangeUnlimited=function(){return[this._knots[0],this._knots[this._knots.length-1]]},_.prototype.isPeriodicUnlimited=function(){return this._checkClosure(),this._isPeriodic},_.prototype.isClosedUnlimited=function(){return this._checkClosure(),this._isClosed},_.prototype._checkClosure=function(){if(void 0===this._isClosed||void 0===this._isPeriodic){this._isClosed=this._isPeriodic=!1;var e=this.getRangeUnlimited(),t=this.evaluatePosition(e[0]),r=this.evaluatePosition(e[1]);if(i.Vector3.equals(t,r,s.KERNEL_TOLERANCE)){this._isClosed=!0;var n=this.evaluateDt(e[0]),o=this.evaluateDt(e[1]);i.Vector3.isParallel(n,o,1,s.KERNEL_ANGULAR_TOLERANCE)&&(this._isPeriodic=!0)}}},_.prototype.getBezierSegments=function(){return this._decomposeCurve(),this.isSimpleBezier()?[this]:this._segments},_.prototype.isPlanarXY=function(){if(void 0===this._isPlanarXY){var e=s.SPLINE_DISTANCE_TOLERANCE;this._isPlanarXY=!0;for(var t=1/0,r=-1/0,i=2;i<this._controlPoints.length;i+=3)t=Math.min(t,this._controlPoints[i]),r=Math.max(r,this._controlPoints[i]);Math.abs(r-t)>2*e&&(this._isPlanarXY=!1)}return this._isPlanarXY},_.prototype.getBezierSegmentsInRange=function(e,t){for(var r=this.getBezierSegments(),i=e||this._knots[0],n=t||this._knots[this._knots.length-1],o=[],s=0;s<r.length;++s){var a=r[s].getKnotVector();i<=a[a.length-1]&&a[0]>=n&&o.push(r[s])}return o},_.prototype.getApproxParameterSpaceTolerance=function(){if(12===this.getControlPoints().length)return f.SplineCurveHelper.getApproxBezierParameterSpaceTolerance(this.getBoundingBox(),s.KERNEL_TOLERANCE);this._decomposeCurve();for(var e=0,t=0;t<this._segments.size();++t)e+=f.SplineCurveHelper.getApproxBezierParameterSpaceTolerance(this._segments[t].getBoundingBox(),s.KERNEL_TOLERANCE);return e},_.prototype.getArcLength=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());for(var t=this._restrictRangeToUnlimited(e),r=0,n=this.getBezierSegments(),o=0;o<n.length;++o)for(var a=n[o],l=a.getRangeUnlimited(),u=0;u<t.length;++u){var h=[Math.max(l[0],t[u][0]),Math.min(l[1],t[u][1])];h[1]-h[0]>s.PARAMETER_SPACE_TOLERANCE&&(r+=(0,c.integrateFunction1D)((function(e){return i.Vector3.length(a.evaluateDt(e))}),h))}return r},_.prototype.getParameterFromArcLength=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var r=this;return(0,c.invertIntegral1D)((function(e){return i.Vector3.length(r.evaluateDt(e))}),e,t)},_.prototype._decomposeCurve=function(){if(this._hasDirtySegments)if(this._hasDirtySegments=!1,this.isSimpleBezier())this._segments=void 0;else{var e;this._isDirtyControlPoint.length===this.getNumControlPoints()?e=(0,y.decomposeBCurveFlags)(this.getKnotVector(),this._isDirtyControlPoint):(this._isDirtyControlPoint=new Array(this.getNumControlPoints()),(e=new Array(this.getNumControlPoints())).fill(!0)),this._isDirtyControlPoint.fill(!1);var t=(0,y.decomposeBCurveToBezier)(this._knots,this._controlPoints,this.isRational()?this._weights:void 0);this._segments&&this._segments.length===t.P.length||(this._segments=[]);for(var r=0;r<t.P.length;++r)void 0===this._segments[r]&&(this._segments[r]=new _,e[r]=!0),e[r]&&this._segments[r].set(t.P[r],t.w?t.w[r]:new Array(2*this._degree+2).fill(1),this._degree,t.U[r])}},_.prototype.evaluatePosition=function(e){this.isPeriodicUnlimited()&&(e=(0,u.normalizeParameterToShiftedRange)(e,[this._knots[0],this._knots[this._knots.length-1]]));var t=this.isRational()?this._weights:void 0;return(0,v.evaluateBCurvePoint)(e,this._degree,this._knots,this._controlPoints,t)},_.prototype.evaluateDt=function(e){this.isPeriodicUnlimited()&&(e=(0,u.normalizeParameterToShiftedRange)(e,[this._knots[0],this._knots[this._knots.length-1]]));var t=this.isRational()?this._weights:void 0;return(0,v.evaluateBCurveDerivs)(e,1,this._degree,this._knots,this._controlPoints,t)[1]},_.prototype.closestToRayParam=function(e,t,r,n){if(!(this._controlPoints.length<9)){if(this.isPlanarXY()){var o=t[2],a=i.Vector3.createFloat64();if(Math.abs(o)<s.KERNEL_ANGULAR_TOLERANCE)i.Vector3.copy(a,e);else{var l=(this._controlPoints[2]-e[2])/o;i.Vector3.add(a,i.Vector3.scale(a,t,l),e)}return this.closestToPointParam(a)}d.DebugUtils.warn("BCurve.closestToRayParam() only defined for planar curves")}},_.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());for(var r=this._restrictRangeToUnlimited(t),n=i.FLOAT64_TOLERANCE,o=this.getBezierSegments(),s=(0,m.closestBCurveSegments)(e,o,void 0,r),a=Number.POSITIVE_INFINITY,l=void 0,c=0;c<s.length;++c)if(!(s[c].minDistSqr>a))for(var h=o[s[c].index],d=h.getRangeUnlimited(),p=0;p<r.length;++p){var f=[Math.max(d[0],r[p][0]),Math.min(d[1],r[p][1])];if(!(f[1]-f[0]<=i.FLOAT64_TOLERANCE)){var g=h.getEvaluationCache(),v=(0,u.closestPointToPolyline)(e,g.points,g.offset,f),y=(0,m.relaxBCurveToPerpendicular)(this._knots,this._controlPoints,this.isRational()?this._weights:void 0,e,v,f,n,32),_=h.evaluatePosition(y),E=i.Vector3.squaredDistance(_,e);E<a&&(a=E,l=y);var x=h.evaluatePosition(f[0]),b=i.Vector3.squaredDistance(x,e);b<a&&(a=b,l=f[0]);var A=h.evaluatePosition(f[1]),C=i.Vector3.squaredDistance(A,e);C<a&&(a=C,l=f[1])}}return this.isPeriodicUnlimited()&&(l=(0,u.foldNearTo)(l,.5*(t[0]+t[1]),this.getPeriodUnlimited())),l},_.prototype.evaluate=function(){var e=this.getBezierSegments();if(e[0]===this)void 0===this._discretizationCache&&(this._discretizationCache=f.SplineCurveHelper.evaluateCurve(this.getDegree(),this.getKnotVector(),this.getControlPoints(),this.getWeights(),!0));else for(var t=0;t<e.length;++t){var r=e[t];void 0===r._discretizationCache&&(r._discretizationCache=f.SplineCurveHelper.evaluateCurve(r.getDegree(),r.getKnotVector(),r.getControlPoints(),r.getWeights(),!0))}},_.prototype._getFullTessellation=function(e){var t,r,n=this.getBezierSegments(),o=0,s=!1;if(n[0]===this){s=!0;var a=p.CurveTessellator.getAdaptiveRenderPoints(this,e,this.getRangeUnlimited());t=a.positions,r=a.params,o=Math.max(o,a.tolerance)}else{t=[],r=[];for(var l=0;l<n.length;++l){var u=n[l];if(u.hasDirtyTessellation()||u.getTessellationCacheTolerance()>e+i.FLOAT64_TOLERANCE){s=!0;var c=p.CurveTessellator.getAdaptiveRenderPoints(u,e,u.getRangeUnlimited());u._tessellationCache.setCache(c),o=Math.max(o,c.tolerance)}u._tessellationCache&&(0===l?(t.push.apply(t,u._tessellationCache.getCache().positions),r.push.apply(r,u._tessellationCache.getCache().params)):(t.push.apply(t,u._tessellationCache.getCache().positions.slice(1)),r.push.apply(r,u._tessellationCache.getCache().params.slice(1))))}}return{positions:t,params:r,didRetessellate:s,tolerance:o}},_.prototype.tessellate=function(e,t){return t=t||s.TESSELLATION.LINEAR_PRECISION,this._tessellationCache.getTessellation(e,this,t,this._getFullTessellation.bind(this))},_.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=this._restrictRangeToUnlimited(e),r=new n.BoundingBox,i=this.getRangeUnlimited();if(t[0][0]<i[0]+s.PARAMETER_SPACE_TOLERANCE&&t[0][1]>i[1]-s.PARAMETER_SPACE_TOLERANCE)this.extendBBoxFromControlPoints(r);else for(var o=this.getBezierSegments(),a=0;a<t.length;a++)for(var l=0;l<o.length;l++){var u=o[l];(u=u._getSubset(t[a][0],t[a][1]))&&u.extendBBoxFromControlPoints(r)}return r},_.prototype.getTangentCone=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=this.evaluatePosition(e[0]),r=this.evaluatePosition(e[1]);i.Vector3.sub(r,r,t),i.Vector3.squaredLength(r)<.01*s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE&&(r=this.evaluateDt(.5*(e[0]+e[1]))),i.Vector3.normalize(r,r);for(var n=new o.TangentCone(r,0),a=this._restrictRangeToUnlimited(e),l=i.Vector3.createFloat64FromValues(0,0,0),u=this.getBezierSegments(),c=0;c<a.length;c++)for(var h=0;h<u.length;h++){var d=u[h];if(d=d._getSubset(a[c][0],a[c][1]))for(var p=d._controlPoints,f=0;f<p.length-3;f+=3)l[0]=p[f+3]-p[f],l[1]=p[f+4]-p[f+1],l[2]=p[f+5]-p[f+2],i.Vector3.dot(l,r)>=0?n.includeVector(l):n.angle=Math.PI}return n},_.prototype._getSubset=function(e,t){var r;if(this.isPeriodicUnlimited())return t-e>this.getPeriodUnlimited()-s.PARAMETER_SPACE_TOLERANCE?this:((r=this.clone())._periodicTrimToParams(e,t),r);var i=this.getRangeUnlimited();return e>i[1]-s.PARAMETER_SPACE_TOLERANCE||t<i[0]+s.PARAMETER_SPACE_TOLERANCE?void 0:e<i[0]+s.PARAMETER_SPACE_TOLERANCE&&t>i[1]-s.PARAMETER_SPACE_TOLERANCE?this:(r=this.clone(),e>i[0]+s.PARAMETER_SPACE_TOLERANCE&&r.trimToParam(!0,e),t<i[1]-s.PARAMETER_SPACE_TOLERANCE&&r.trimToParam(!1,t),r)},_.prototype._periodicTrimToParams=function(e,t){h.ConsoleUtils.assert(this._isPeriodic);var r=this.getRangeUnlimited(),i=(0,u.normalizeParametricRangeToShiftedRange)([e,t],r);if(i[1]>r[1])this._isClosed=this._isPeriodic=!1,this.trimToParam(!0,i[1]-(r[1]-r[0]),void 0),this.trimToParam(!1,i[0],void 0);else{var n,o,s=this.getControlPoints(),a=this.getKnotVector(),l=this.getWeights(),c=this.getDegree(),d=this.getPeriodUnlimited(),p=[],g=a.slice(),v=a.slice(),y=[];for(o=0;o<s.length/3;++o)p[4*o+0]=s[3*o+0]*l[o],p[4*o+1]=s[3*o+1]*l[o],p[4*o+2]=s[3*o+2]*l[o],p[4*o+3]=l[o];for(n=p.slice(),f.SplineCurveHelper.extractCurveSegment(c,i[1],r[1],g,p),f.SplineCurveHelper.extractCurveSegment(c,r[0],i[0],v,n),o=0;o<v.length;++o)v[o]=v[o]+d;f.SplineCurveHelper.joinCurves(c,g,p,v,n);var m=p.length/4,_=[];for(y.length=m,_.length=3*m,o=0;o<m;++o){var E=p[4*o+3];_[3*o]=p[4*o]/E,_[3*o+1]=p[4*o+1]/E,_[3*o+2]=p[4*o+2]/E,y[o]=E}this.set(_,y,c,g),this._isClosed=this._isPeriodic=!1}},_.prototype.trimToParam=function(e,t,r){if(this.isPeriodicUnlimited())return h.ConsoleUtils.assert(void 0!==r),void this._periodicTrimToParams(t,r);var i,n,o=this.getControlPoints(),s=this.getKnotVector(),a=this.getWeights(),l=this.getDegree(),u=[];for(i=0;i<o.length/3;++i)u[4*i+0]=o[3*i+0]*a[i],u[4*i+1]=o[3*i+1]*a[i],u[4*i+2]=o[3*i+2]*a[i],u[4*i+3]=a[i];var c=[],d=0,p=f.SplineCurveHelper.insertKnot(l,s,u,t,l),v=(0,g.findKnotSpan)(t,p.U);for(e?(p.U.splice(0,v-l+1,t),n=p.U.length-l-1,d=4*(p.Pw.length/4-n)):(p.U.splice(v+1,p.U.length,t),n=p.U.length-l-1),u.length=3*n,c.length=n,i=0;i<n;++i){var y=p.Pw[4*i+3+d];u[3*i]=p.Pw[4*i+0+d]/y,u[3*i+1]=p.Pw[4*i+1+d]/y,u[3*i+2]=p.Pw[4*i+2+d]/y,c[i]=y}this.set(u,c,l,p.U)},_.prototype.addControlPoint=function(e,t){var r=this.getControlPoints(),n=this.getNumControlPoints(),o=this.getKnotVector(),a=this.getWeights(),u=this.getDegree(),c=this.getControlPointPosition(e),h=this.getControlPointPosition(e+1),d=new l.Line;d.setFromEndpoints(c,h);var p=d.closestToPointParam(t),g=d.evaluatePosition(p),v=i.Vector3.distance(g,c),y=i.Vector3.distance(g,h),m=a[e]*v+a[e+1]*y;if(Math.abs(m)<s.KERNEL_TOLERANCE)console.warn("numerical error in addControlPoints -- coincident control points / negative weights?");else{for(var _=a[e]*v/m,E=o[e+1]+_*(o[e+u+1]-o[e+1]),x=[],b=0;b<r.length/3;++b)x[4*b]=r[3*b]*a[b],x[4*b+1]=r[3*b+1]*a[b],x[4*b+2]=r[3*b+2]*a[b],x[4*b+3]=a[b];var A=f.SplineCurveHelper.findKnotMultiplicity(E,o),C=f.SplineCurveHelper.insertKnot(u,o,x,E,A+1),T=[];for(x.length=3*(n+1),T.length=n+1,b=0;b<=n;++b){var P=C.Pw[4*b+3];x[3*b]=C.Pw[4*b]/P,x[3*b+1]=C.Pw[4*b+1]/P,x[3*b+2]=C.Pw[4*b+2]/P,T[b]=P}this.set(x,T,u,C.U)}},_.prototype.addControlPointOnCurve=function(e){for(var t=this.getNumControlPoints(),r=Number.MAX_VALUE,n=-1,o=i.Vector3.createFloat64FromValues(0,0,0),s=i.Vector3.createFloat64FromValues(0,0,0),a=0;a<t-1;++a){o[0]=this._controlPoints[3*a+0],o[1]=this._controlPoints[3*a+1],s[0]=this._controlPoints[3*a+3],s[1]=this._controlPoints[3*a+4];var l=(0,u.distancePointToLineSegment)(o,s,e);l<r&&(r=l,n=a)}-1!==n&&this.addControlPoint(n,e)},_.prototype.makePeriodic=function(){if(!this.isPeriodicUnlimited()){for(var e=this.getControlPoints(),t=this.getKnotVector(),r=this.getWeights(),i=this.getDegree(),n=[],o=0;o<e.length/3;++o)n[4*o]=e[3*o]*r[o],n[4*o+1]=e[3*o+1]*r[o],n[4*o+2]=e[3*o+2]*r[o],n[4*o+3]=r[o];var s=t.slice();f.SplineCurveHelper.makePeriodic(i,s,n);var a=[],l=[],u=n.length/4;for(a.length=u,l.length=3*u,o=0;o<u;++o){var c=n[4*o+3];l[3*o]=n[4*o]/c,l[3*o+1]=n[4*o+1]/c,l[3*o+2]=n[4*o+2]/c,a[o]=c}this.set(l,a,i,s),this._isClosed=this._isPeriodic=!0}},_.prototype.suggestSplittingParam=function(e){var t,r=this.getKnotVector(),i=.5*(e[0]+e[1]),n=(0,u.sortedIndex)(r,i);if(0===n)t=r[n];else if(n===r.length)t=r[n-1];else{var o=r[n-1],s=r[n];t=i-o<s-i?o:s}return t>=e[0]&&t<=e[1]?t:void 0},_.prototype.toObject=function(){return{degree:this._degree,knots:this._knots,controlPoints:this._controlPoints,weights:this._weights,range:this.rangeToObject(this.getRange(),this.isLimited())}},t.BCurve=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TangentCone=void 0;var i=r(1),n=r(0),o=r(3),s=function(e,t){this.set(e,t)};s.prototype.set=function(e,t){void 0===e||void 0===t?(this.axis=void 0,this.angle=void 0):(this.axis=i.Vector3.clone(e),this.angle=t)},s.prototype.toString=function(){return this.isDegenerate()?"degenerate":"(x:"+this.axis[0]+", y:"+this.axis[1]+", z:"+this.axis[2]+", radians:"+this.angle+")"},s.prototype.copy=function(e){return e.isDegenerate()?(this.axis=void 0,this.angle=void 0):(this.axis=i.Vector3.clone(e.axis),this.angle=e.angle),this},s.prototype.clone=function(){return new s(this.axis,this.angle)},s.prototype.isDegenerate=function(){return void 0===this.axis||void 0===this.angle},s.prototype.includeVector=function(e){if(i.Vector3.squaredLength(e)<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)return this;if(this.isDegenerate())return this.axis||(this.axis=i.Vector3.createFloat64()),i.Vector3.normalize(this.axis,e),this.angle=0,this;var t=i.Vector3.dot(this.axis,e)/i.Vector3.length(e);t=(0,o.clamp)(t,-1,1);var r=Math.acos(t);return this.angle=Math.max(this.angle,r),this},s.prototype.includeCone=function(e){if(e.isDegenerate())return this;if(this.isDegenerate())return this.copy(e);var t=i.Vector3.dot(this.axis,e.axis),r=Math.acos((0,o.clamp)(t,-1,1));if(this.angle>=e.angle+r)return this;if(e.angle>=this.angle+r)return this.copy(e);if(r>Math.PI-n.KERNEL_ANGULAR_TOLERANCE)return this.angle=Math.PI,this;var s=(this.angle+e.angle+r)/2;if(s>=Math.PI)return this.angle=Math.PI,this;var a=Math.sin(s-e.angle),l=Math.sin(s-this.angle);return i.Vector3.scale(this.axis,this.axis,a),i.Vector3.scaleAndAdd(this.axis,this.axis,e.axis,l),i.Vector3.normalize(this.axis,this.axis),this.angle=s,this},s.prototype.contains=function(e,t){if(t="number"==typeof t?t:n.KERNEL_ANGULAR_TOLERANCE,!this.isDegenerate())return i.Vector3.squaredLength(e)<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE||i.Vector3.angle(this.axis,e)<this.angle+t},t.TangentCone=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.invertIntegral1D=t.integrateFunction1D=t.newtonRaphson1D=void 0;var i=r(0),n=r(3),o=r(8),s=function(){var e=[.9914553711208126,.9491079123427585,.8648644233597691,.7415311855993945,.5860872354676911,.4058451513773972,.20778495500789848,0],t=[.022935322010529224,.06309209262997856,.10479001032225019,.14065325971552592,.1690047266392679,.19035057806478542,.20443294007529889,.20948214108472782],r=[.1294849661688697,.27970539148927664,.3818300505051189,.4179591836734694];return function(n,a,l){var u=function(i,n,o){for(var s=.5*(n+o),a=.5*(o-n),l=i(s),u=l*t[7],c=l*r[3],h=0;h<7;++h){var d=a*e[h],p=i(s-d)+i(s+d);u+=p*t[h],h%2==1&&(c+=p*r[Math.floor(h/2)])}var f=200*Math.abs(u-c)*a;return{length:u*a,error:f*=Math.sqrt(f)}}(n,a[0],a[1]);if(void 0===l)l=0;else if(l>8)return o.DebugUtils.warn("Max depth reached in integrateFunction1D!"),u.length;if(u.error>i.KERNEL_TOLERANCE){var c=.5*(a[0]+a[1]);return s(n,[a[0],c],l+1)+s(n,[c,a[1]],l+1)}return u.length}}();t.newtonRaphson1D=function(e,t,r,i,s){var a,l=r;t&&(l=(0,n.clamp)(l,t[0],t[1]));var u=0;do{++u;var c=e(l),h=l-c.val/c.deriv;t&&(h=(0,n.clamp)(h,t[0],t[1])),a=Math.abs(h-l),l=h}while(a>i&&u<s);return u>=s&&o.DebugUtils.warn("Maximum number of iterations reached. Something wrong is going on here !!!"),l},t.integrateFunction1D=s,t.invertIntegral1D=function(e,t,r){var o=i.KERNEL_TOLERANCE,a=s(e,r);if(t<o)return r[0];if(t>a-o)return r[1];for(var l=r[0],u=r[1],c=t;u-l>i.PARAMETER_SPACE_TOLERANCE;){var h=c/a,d=l+(h=(0,n.clamp)(h,.01,.99))*(u-l),p=s(e,[l,d]),f=a-(p=(0,n.clamp)(p,0,a));if(Math.abs(c-p)<o)return d;p>c?(u=d,a=p):(l=d,c-=p,a=f)}return.5*(l+u)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SplineCurveHelper=void 0;var i=r(1),n=r(0),o=r(3),s=r(8),a=r(17),l=r(37),u=r(72),c=function(){};c.getApproxBezierParameterSpaceTolerance=function(e,t){var r=e.getDiagonal(),o=2*t/i.Vector3.length(r);return o<.01*n.PARAMETER_SPACE_TOLERANCE?.01*n.PARAMETER_SPACE_TOLERANCE:o},c.solve_cubic_uniqueRoots=function(e,t){var r=e[2]*e[2]-3*e[1],i=e[2]*(2*e[2]*e[2]-9*e[1])+27*e[0];if(0===i&&0===r)return t[0]=-e[2]/3,1;if(i*i/4<r*r*r){var n=-2*Math.sqrt(r),o=Math.acos(-i/(r*n));return t[0]=(n*Math.cos(o/3)-e[2])/3,t[1]=(n*Math.cos((o+2*Math.PI)/3)-e[2])/3,t[2]=(n*Math.cos((o-2*Math.PI)/3)-e[2])/3,3}var s=Math.pow(Math.abs(i)/2+Math.sqrt(i*i/4-r*r*r),1/3)/3;return i>0&&(s=-s),t[0]=s+r/(9*s)-e[2]/3,1};var h=function(e,t,r){return 6*((1-r)*(e[6+t]-2*e[3+t]+e[t])+r*(e[9+t]-2*e[6+t]+e[3+t]))},d=function(e,t){return 6*(e[9+t]-e[t]+3*(e[3+t]-e[6+t]))},p=function(e,t){var r=new Array(3);!function(e,t,r){r[0]=3*(e[3+t]-e[t]),r[1]=6*(e[t]+e[6+t]-2*e[3+t]),r[2]=3*(e[9+t]-e[t]+3*(e[3+t]-e[6+t]))}(e,t,r);var i,n=new Array(2),o=function(e,t){var r=e[1]*e[1]-4*e[2]*e[0];if(r<0)return 0;if(0===r)return t[0]=-.5*e[1]/e[2],1;var i=e[1]>0?-.5*(e[1]+Math.sqrt(r)):-.5*(e[1]-Math.sqrt(r));return t[0]=i/e[2],t[1]=e[0]/i,2}(r,n);2===o&&n[0]>n[1]&&(i=n[0],n[0]=n[1],n[1]=i);for(var s=[],a=0;a<o;a++)n[a]>0&&n[a]<1&&((i=Math.abs(h(e,t,n[a]))<1e-12)?(i=Math.abs(d(e,t))<1e-12)&&s.push(n[a]):s.push(n[a]));return s},f=function(e,t,r){return e+t[0]+t[1]*r+t[2]*r*r+t[3]*r*r*r};c.intersect_xAxis_NonRationalCubicBSpline_XYPlanar3D=function(e,t,r,i){var o=new Float64Array(4),s=new Float64Array(4);o[0]=t[0]-e[0],o[1]=3*(t[3]-t[0]),o[2]=3*(t[0]+t[6]-2*t[3]),o[3]=t[9]-t[0]+3*(t[3]-t[6]),s[0]=t[1]-e[1],s[1]=3*(t[4]-t[1]),s[2]=3*(t[1]+t[7]-2*t[4]),s[3]=t[10]-t[1]+3*(t[4]-t[7]);var a,l=s;if(Math.abs(l[3])>1e-4)l[0]/=l[3],l[1]/=l[3],l[2]/=l[3],l[3]=1,a=this.solve_cubic_uniqueRoots(l,r);else{var c=[].slice.call(l).reverse();0===c[0]&&(c=c.slice(1));var h=(0,u.getRealPolynomialRoots)(c);a=h.length;for(var d=0;d<a;d++)r[d]=h[d]}if(1===a)return(g=r[0])<0||g>1?0:(r[0]=f(e[0],o,g),1);d=0;for(var p=0;p<a;++p)(g=r[p])>=0&&g<=1&&(r[d]=f(e[0],o,g),++d);if(void 0!==i){var g,v;if(Math.abs(s[3])<1e-12)Math.abs(s[2])<1e-12?v=-1:(g=-s[1]/(2*s[2]),v=0);else{var y=2/3*s[2]/s[3];v=y*y/4-1/3*s[1]/s[3],g=-y/2}if(0===v)if(g<0||g>1){var m=f(e[0],s,0),_=f(e[0],s,1);Math.abs(m)>Math.abs(_)?i.push([f(e[0],o,0),m]):i.push([f(e[0],o,1),_])}else i.push([f(e[0],o,g),f(e[0],s,g)]);else if(v>0){for(p=0;p<2;p++)(g=-y/2+(0===p?-1:1)*Math.sqrt(v))<-n.PARAMETER_SPACE_TOLERANCE||g>1+n.PARAMETER_SPACE_TOLERANCE||(g=Math.max(Math.min(1,g),0),i.push([f(e[0],o,g),f(e[0],s,g)]));if(i.length>1&&i[0][0]>i[1][0]){var E=i[0];i[0]=i[1],i[1]=E}}}return d},c.isPointInsideSplineRegionXYPlanar3D=function(e,t,r){var n,s,a=new Float64Array(3),l=t.getBezierSegments();if(t.isRational()||!l||3!==t.getDegree()){for(var u=t.tessellate().positions,c=new Float64Array(2*u.length),h=0;h<u.length;++h)c[2*h]=u[h].x,c[2*h+1]=u[h].y;return(0,o.isPointInsidePolygon2D)(e,c)}var d,p=0,f=i.Vector3.createFloat64();for(h=0;h<l.length;++h){s=l[h].getControlPoints(),n=this.intersect_xAxis_NonRationalCubicBSpline_XYPlanar3D(e,s,a);for(var g=0;g<n;++g)i.Vector3.set(f,a[g],e[1],0),(d=t.closestToPointParam(f))>=r[0]&&d<=r[1]&&a[g]>e[0]&&++p}var v=t.evaluatePosition(r[0]),y=t.evaluatePosition(r[1]),m=i.Vector3.createFloat64();i.Vector3.normalize(m,i.Vector3.sub(m,y,v)),m[1]<0&&i.Vector3.negate(m,m);var _=i.Vector2.createFloat64FromValues(e[0],e[1]);return(0,o.signedDistanceTo2DLine)(v,m,_)<=0&&e[1]>=Math.min(v[1],y[1])&&e[1]<=Math.max(v[1],y[1])&&++p,1&p},c.insertKnot=function(e,t,r,i,n){var o,s,l,u=[],c=[],h=[],d=r.length/4,p=d+e+1,f=(0,a.findKnotSpanAndMultiplicity)(i,t),g=n-f.multiplicity;if(g<1)return{U:u=t.slice(),Pw:c=r.slice()};for(o=0;o<=f.span;++o)u[o]=t[o];for(o=1;o<=g;++o)u[f.span+o]=i;for(o=f.span+1;o<p;++o)u[o+g]=t[o];for(o=0;o<=f.span-e;++o)for(s=0;s<4;++s)c[4*o+s]=r[4*o+s];for(o=f.span-f.multiplicity;o<d;++o)for(s=0;s<4;++s)c[4*(o+g)+s]=r[4*o+s];for(o=0;o<=e-f.multiplicity;++o)for(s=0;s<4;++s)h[4*o+s]=r[4*(f.span-e+o)+s];for(var v=1;v<=g;++v){for(l=f.span-e+v,o=0;o<=e-v-f.multiplicity;++o){var y=(i-t[l+o])/(t[o+f.span+1]-t[l+o]);for(s=0;s<4;++s)h[4*o+s]=h[4*(o+1)+s]*y+h[4*o+s]*(1-y)}for(s=0;s<4;++s)c[4*l+s]=h[s],c[4*(f.span+g-v-f.multiplicity)+s]=h[4*(e-v-f.multiplicity)+s]}for(o=l+1;o<f.span-f.multiplicity;++o)for(s=0;s<4;++s)c[4*o+s]=h[4*(o-l)+s];return{U:u,Pw:c}},c.refineKnotVector=function(e,t,r,i){var o,s,l=[],u=[],c=r.length/4-1,h=i.length-1,d=c+e+1,p=(0,a.findKnotSpan)(i[0],t),f=(0,a.findKnotSpan)(i[h],t)+1;for(o=0;o<=p-e;++o)for(s=0;s<4;++s)u[4*o+s]=r[4*o+s];for(o=f-1;o<=c;++o)for(s=0;s<4;++s)u[4*(o+h+1)+s]=r[4*o+s];for(o=0;o<=p;++o)l[o]=t[o];for(o=f+e;o<=d;++o)l[o+h+1]=t[o];var g=f+e-1,v=f+e+h;for(o=h;o>=0;--o){for(;i[o]<=t[g]&&g>p;){for(s=0;s<4;++s)u[4*(v-e-1)+s]=r[4*(g-e-1)+s];l[v]=t[g],--v,--g}for(s=0;s<4;++s)u[4*(v-e-1)+1]=u[4*(v-e)+s];for(var y=1;y<=e;++y){var m=v-e+y,_=l[v+y]-i[o];if(Math.abs(_)<n.KERNEL_TOLERANCE)for(s=0;s<4;++s)u[4*(m-1)+s]=u[4*m+s];else for(_/=l[v+y]-t[g-e+y],s=0;s<4;++s)u[4*(m-1)+s]=u[4*(m-1)+s]*_+u[4*m+s]*(1-_)}l[v]=i[o],--v}return{U:l,Pw:u}};var g=function(e,t,r,n){var s=(0,o.projectPointToLineSegment)(t,r,e);return n&&(s=(0,o.clamp)(s,0,1)),i.Vector3.lerp(i.Vector3.createFloat64(),t,r,s)};c.validControlPolygon=function(e){for(var t=e.length/3,r=e.length,n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),s=i.Vector3.createFloat64(),a=3,l=1;l<t-1;++l){i.Vector3.set(n,e[a],e[a+1],e[a+2]),i.Vector3.set(o,e[a-3],e[a-2],e[a-1]),i.Vector3.set(s,e[a+3],e[a+4],e[a+5]);var u=g(n,o,s,!1);if(i.Vector3.sub(n,n,u),l<t/2?i.Vector3.sub(o,[e[r-3],e[r-2],e[r-1]],u):i.Vector3.sub(o,[e[0],e[1],e[2]],u),i.Vector3.dot(n,o)>0)return!1;a+=3}return!0};var v=function(e){if(e)for(var t=0;t<e.length;++t)if(Math.abs(e[t]-1)>i.FLOAT64_TOLERANCE)return!0;return!1},y=function(){var e=new Float64Array(4),t=new Float64Array(4),r=new Float64Array(4),i=new Float64Array(16);return function(n,o,s,a,l){var u,c,h,d,p,f,g=1-s;if(e[0]=g*g*g,e[1]=3*s*g*g,e[2]=3*s*s*g,e[3]=s*s*s,t[0]=-3*g*g,t[1]=3*(s-1)*(3*s-1),t[2]=3*s*(2-3*s),t[3]=3*s*s,r[0]=6*g,r[1]=6*(3*s-2),r[2]=6*(1-3*s),r[3]=6*s,void 0===l?v(o):l){for(var y=0;y<4;++y)i[4*y+a]=n[3*y+a]*o[y],i[4*y+3]=o[y];for(u=i[a]*e[0],c=i[a]*t[0],h=i[a]*r[0],y=1;y<4;++y)u+=i[4*y+a]*e[y],c+=i[4*y+a]*t[y],h+=i[4*y+a]*r[y];for(d=i[3]*e[0],p=i[3]*t[0],f=i[3]*r[0],y=1;y<4;++y)d+=i[4*y+3]*e[y],p+=i[4*y+3]*t[y],f+=i[4*y+3]*r[y];u/=d,c/=p,h/=f}else for(u=n[a]*e[0],c=n[a]*t[0],h=n[a]*r[0],y=1;y<4;++y)u+=n[3*y+a]*e[y],c+=n[3*y+a]*t[y],h+=n[3*y+a]*r[y];return[u,c,h]}}(),m=function(e,t,r,i){var n=i;n[0]=r[0]-t[0],n[1]=r[1]-t[1];var o=n[0]*n[0]+n[1]*n[1],s=(e[0]-t[0])*n[0]+(e[1]-t[1])*n[1];if(0===o||s<=0)i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[1]=i[0]*i[0]+i[1]*i[1],i[0]=0;else if(s>o)i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[1]=i[0]*i[0]+i[1]*i[1],i[0]=1;else{var a=s/o;i[0]=t[0]+a*n[0]-e[0],i[1]=t[1]+a*n[1]-e[1],i[1]=i[0]*i[0]+i[1]*i[1],i[0]=a}},_=function(e,t,r,i){var n=i;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];var o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],s=(e[0]-t[0])*n[0]+(e[1]-t[1])*n[1]+(e[2]-t[2])*n[2];if(0===o||s<=0)i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[1]=i[0]*i[0]+i[1]*i[1]+i[1]*i[1],i[0]=0;else if(s>o)i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i[1]=i[0]*i[0]+i[1]*i[1]+i[1]*i[1],i[0]=1;else{var a=s/o;i[0]=t[0]+a*n[0]-e[0],i[1]=t[1]+a*n[1]-e[1],i[2]=t[2]+a*n[2]-e[2],i[1]=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],i[0]=a}};c.closestStartPoint=function(){var e,t,r,i,n=new Float64Array(3),o=new Float64Array(3),s=new Float64Array(3),a=new Float64Array(2);return function(l,u,c,h){if(c)for(a[0]=0,a[1]=1/0,r=u.points.length,i=0;i<r-3;i+=3)n[0]=u.points[i],n[1]=u.points[i+1],o[0]=u.points[i+3],o[1]=u.points[i+4],m(l,n,o,s),s[1]<a[1]&&(e=i/3,t=(1-s[0])*u.offset[e]+s[0]*u.offset[e+1],(!h||t>=h[0]&&t<=h[1])&&(a[0]=t,a[1]=s[1]));else for(a[1]=1/0,r=u.points.length,i=0;i<r-3;i+=3)n[0]=u.points[i],n[1]=u.points[i+1],n[2]=u.points[i+2],o[0]=u.points[i+3],o[1]=u.points[i+4],o[2]=u.points[i+5],_(l,n,o,s),s[1]<a[1]&&(e=i/3,t=(1-s[0])*u.offset[e]+s[0]*u.offset[e+1],(!h||t>=h[0]&&t<=h[1])&&(a[0]=t,a[1]=s[1]));return a[0]}}(),c.extremalParams=function(e,t){if(3!==e.getDegree())return s.DebugUtils.warn("SplineCurveHelper.extremalParams called with non-degree 3 curve"),[];var r,o,a=e.getBezierSegments(),l=[];for(r=0;r<a.length;++r){var u=a[r].getControlPoints(),h=a[r].getWeights(),d=a[r].getKnotVector(),p=c.extremalParamsXYPlanarBezierCurve(u,h,t),f=[];for(o=0;o<p.length;o++)f.push(d[0]*(1-p[o])+d[d.length-1]*p[o]);l.push(f)}var g=[];for(r=0;r<a.length;++r)if(g=g.concat(l[r]),r<a.length-1||e.isPeriodicUnlimited()){var v=a[r],y=a[(r+1)%a.length],m=l[r],_=l[(r+1)%a.length],E=v.getRangeUnlimited()[1],x=y.getRangeUnlimited()[0],b=0===m.length||E-m[m.length-1]>n.PARAMETER_SPACE_TOLERANCE,A=0===_.length||_[0]-x>n.PARAMETER_SPACE_TOLERANCE;if(b&&A){var C=v.evaluateDt(E)[t],T=y.evaluateDt(x)[t];(Math.abs(C)<i.FLOAT64_TOLERANCE||Math.abs(T)<i.FLOAT64_TOLERANCE||Math.sign(C)!==Math.sign(T))&&g.push(E)}}return g},c.extremalParamsXYPlanarBezierCurve=function(e,t,r,i,n){var o=v(t);if(!o)return p(e,r);for(var s,a,l=i||16,u=n||1e-12,c=[],h=void 0,d=0;d<8;d++){if(a=y(e,t,d/7,r,o),void 0!==h&&Math.sign(a[1])!==h){var f=(d-1+Math.abs(s)/(Math.abs(a[1])+Math.abs(s)))/7;c.push(f)}h=Math.sign(a[1]),s=a[1]}0===c.length&&(c[0]=0+u,c[1]=1-u),c.length>2&&console.error("More than two roots in the second derivative of a cubic polynomial. This should not happen.");var g,m,_,E=[],x=[];for(d=0;d<c.length;d++){var b=0;do{++b,_=0!==(a=y(e,t,c[d],r,o))[2]?c[d]-a[1]/a[2]:c[d],g=Math.abs(a[1]),m=Math.abs(c[d]-_),c[d]=_}while((g>u||m>1e-6)&&b<l);E[d]=g,x[d]=a[2]}for(d=0;d<c.length;d++)if(c[d]<0||c[d]>1||E[d]>u)c.splice(d,1),d--;else if(Math.abs(x[d])<1e-6){var A=(y(e,t,c[d]+5e-7,r,o)[2]-y(e,t,c[d]-5e-7,r,o)[2])/1e-6;Math.abs(A)>1e-6&&(c.splice(d,1),d--)}if(2===c.length){if(Math.abs(c[0]-c[1])<1e-6){var C=E[0]/(E[0]+E[1]);return[c[0]*(1-C)+c[1]*C]}return c}return c},c.evaluateNURBSCurvePointWithFactors=function(e,t,r,i,n,o){var s,u,c,h=(0,a.findKnotSpan)(n,t),d=(0,l.evaluateBasisFunctions)(h,n,e,t),p=new Float64Array(3),f=0,g=3*(h-e);for(o.rangeMin=h-e,o.rangeMax=h,u=0;u<=e;++u){for(s=i[h-e+u]*d[u],o.factors[u]=s,c=0;c<3;++c)p[c]+=r[g+c]*s;f+=s,g+=3}for(u=0;u<3;++u)p[u]/=f;for(u=0;u<=e;++u)o.factors[u]/=f;return p};var E=function e(t,r,n,o,s,a,u,h,d,p,f,v,y){var m=.5*(n+s),_=(0,l.evaluateBCurvePoint)(m,t,r,u,d?h:void 0);if(v>y)f.push({offset:m,point:_});else{var E=g(_,o,a,!1),x=i.Vector3.squaredDistance(a,o),b=i.Vector3.squaredDistance(E,_);c.validControlPolygon(u)&&b<p*x?f.push({offset:m,point:_}):(e(t,r,n,o,m,_,u,h,d,p,f,v+1,y),e(t,r,m,_,s,a,u,h,d,p,f,v+1,y))}};c.renderNURBSCurve=function(e,t,r,o,s,a,u,c){var h=a||n.DEFAULT_CURVE_RESOLUTION,d=u||[t[0],t[t.length-1]];c=void 0===c||c;var p,f=v(o);if(s){var g,y,m=[];g=(0,l.evaluateBCurvePoint)(d[0],e,t,r,f?o:void 0),y=(0,l.evaluateBCurvePoint)(d[1],e,t,r,f?o:void 0),m.push({offset:d[0],point:g}),E(e,t,d[0],g,d[1],y,r,o,f,n.SPLINE_DISTANCE_TOLERANCE,m,0,4),m.push({offset:d[1],point:y}),p=new Array(4*m.length);for(var _=c?0:1,x=c?0:1;x<m.length;x++)p[_]=m[x].point[0],p[_+1]=m[x].point[1],p[_+2]=m[x].point[2],p[_+3]=m[x].offset,_+=4}else{for(var b=0,A=3;A<r.length;A+=3)b+=i.Vector3.distance([r[A-3],r[A-2],r[A-1]],[r[A],r[A+1],r[A+2]]);for(h=10*Math.round(b),c?(A=0,p=new Float32Array(3*h)):(A=1,p=new Float32Array(3*(h-1)));A<h;++A){var C,T=d[0]+(d[1]-d[0])*A/(h-1);C=(0,l.evaluateBCurvePoint)(T,e,t,r,f?o:void 0);for(var P=3*A,R=0;R<3;++R)p[P+R]=C[R]}}return p},c.evaluateCurve=function(e,t,r,i,o,s){if(o){var a=(0,l.evaluateBCurvePoint)(t[0],e,t,r,i),u=(0,l.evaluateBCurvePoint)(t[t.length-1],e,t,r,i),c=[];c.push({offset:t[0],point:a}),E(e,t,t[0],a,t[t.length-1],u,r,i,!0,n.SPLINE_DISTANCE_TOLERANCE,c,0,3),c.push({offset:t[t.length-1],point:u});for(var h=[],d=[],p=0;p<c.length;++p)h.push(c[p].offset),d.push(c[p].point[0],c[p].point[1],c[p].point[2])}else{var f=s||.01,g=t[0],v=0;h=[],d=[];do{var y=(0,l.evaluateBCurvePoint)(g,e,t,r,i);for(h[v]=g,p=0;p<3;++p)d[3*v+p]=y[p];++v,g+=f}while(g<=t[t.length-1])}return{offset:h,points:d}};var x=function(e,t,r){var i=new Float64Array(2);i[0]=r[0]-t[0],i[1]=r[1]-t[1];var n=i[0]*i[0]+i[1]*i[1];if(0===n)return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[0]*i[0]+i[1]*i[1];var o=(e[0]-t[0])*i[0]+(e[1]-t[1])*i[1];return o<0?(i[0]=e[0]-t[0],i[1]=e[1]-t[1]):o>n?(i[0]=e[0]-r[0],i[1]=e[1]-r[1]):(o/=n,i[0]=t[0]+o*i[0]-e[0],i[1]=t[1]+o*i[1]-e[1]),i[0]*i[0]+i[1]*i[1]},b=function(e,t){var r,i=!1,n=t.length;r=0;for(var o=n-3;r<n;r+=3)t[r+1]>e[1]!=t[o+1]>e[1]&&e[0]<(t[o]-t[r])*(e[1]-t[r+1])/(t[o+1]-t[r+1])+t[r]&&(i=!i),o=r;return i},A=function(e,t){for(var r,i=new Float64Array(2),n=Number.NEGATIVE_INFINITY,o=0;o<t.length;o+=3)i[0]=t[o]-e[0],i[1]=t[o+1]-e[1],(r=i[0]*i[0]+i[1]*i[1])>n&&(n=r);return n},C=function(e,t,r){for(var i,n=t.length,o=new Float64Array(2),s=new Float64Array(2),a=Number.POSITIVE_INFINITY,l=0;l<n-3;l+=3)o[0]=t[l],o[1]=t[l+1],s[0]=t[l+3],s[1]=t[l+4],(i=x(e,o,s))<a&&(a=i);return void 0!==r&&r&&(o[0]=t[n-3],o[1]=t[n-2],s[0]=t[0],s[1]=t[1],(i=x(e,o,s))<a&&(a=i)),a};c.closestSegmentsXYPlanar=function(e,t,r,i){for(var n=Number.POSITIVE_INFINITY,o=[],s=0;s<t.length;++s){var a,l=t[s],u=l.getRangeUnlimited();if(i){a=!1;for(var c=0;c<i.length;++c)if(u[1]>=i[c][0]&&u[0]<=i[c][1]){a=!0;break}}else a=!0;if(a){var h,d,p=r?r[s]:0,f=l.getControlPoints();b(e,f)?h=0:(h=C(e,f,!0),h=Math.max(0,h-p)),h<=n&&(d=A(e,f)+p,o.push({index:s,minDistSqr:h,maxDistSqr:d}),d<n&&(n=d))}}var g=[];for(s=0;s<o.length;++s)o[s].minDistSqr<=n&&g.push(o[s]);return g.sort((function(e,t){var r=e.minDistSqr-t.minDistSqr;return 0===r?e.maxDistSqr-t.maxDistSqr:r})),g},c.findKnotMultiplicity=function(e,t){for(var r=0,i=0;i<t.length;++i){if(t[i]>e+1e-8)return r;Math.abs(t[i]-e)<1e-8&&r++}return r},c.unclampCurve=function(e,t,r,i){var n,o,s,a,l,u=r.length/4-1,c=i||1;for(n=0;n<e-1;++n)for(t[e-n-1]=t[e-n]-(t[u-n+1]-t[u-n])*c,s=e-1,o=n;o>=0;--o){for(a=(t[e]-t[s])/(t[e+o+1]-t[s]),l=0;l<4;++l)r[4*o+l]=(r[4*o+l]-a*r[4*(o+1)+l])/(1-a);s-=1}for(t[0]=t[1]-(t[u-e+2]-t[u-e+1])*c,n=0;n<e-1;++n)for(t[u+n+2]=t[u+n+1]+(t[e+n+1]-t[e+n])*c,o=n;o>=0;--o)for(a=(t[u+1]-t[u-o])/(t[u-o+n+2]-t[u-o]),l=0;l<4;++l)r[4*(u-o)+l]=(r[4*(u-o)+l]-(1-a)*r[4*(u-o-1)+l])/a;t[u+e+1]=t[u+e]+(t[2*e]-t[2*e-1])*c},c.extractCurveSegment=function(e,t,r,i,n){var o=this.insertKnot(e,i,n,t,e);o=this.insertKnot(e,o.U,o.Pw,r,e);var s,l=(0,a.findKnotSpan)(t,o.U);for(i.length=o.U.length-(l-e),i[0]=t,s=1;s<i.length;++s)i[s]=o.U[s+l-e];var u=i.length-e-1,c=4*(o.Pw.length/4-u);for(n.length=o.Pw.length-c,s=0;s<n.length;++s)n[s]=o.Pw[s+c];l=(0,a.findKnotSpan)(r,i),i.length=l+1,i.push(r),n.length=4*(i.length-e-1)};var T=function(e,t,r,i){for(var n=0,o=0;o<4;++o)n+=(e[t+o]-r[i+o])*(e[t+o]-r[i+o]);return Math.sqrt(n)};c.removeKnot=function(e,t,r,i,o){if(t<=i[0]||t>=i[i.length-1])return 0;var s,l,u,c,h,d=[],p=e+1,f=(0,a.findKnotSpanAndMultiplicity)(t,i);if(f.multiplicity<1)return 0;for(var g,v,y,m,_=(2*f.span-f.multiplicity-e)/2,E=n.KERNEL_TOLERANCE,x=f.span-f.multiplicity,b=f.span-e,A=!1,C=[0,0,0,0],P=0;P<r;++P){for(g=b-1,h=0;h<4;++h)d[0+h]=o[4*g+h],d[4*(x+1-g)+h]=o[4*(x+1)+h];for(s=b,l=x,u=1,c=x-g,A=!1;l-s>P;){for(v=(t-i[s])/(i[s+p+P]-i[s]),y=(t-i[l-P])/(i[l+p]-i[l-P]),h=0;h<4;++h)d[4*u+h]=(o[4*s+h]-(1-v)*d[4*(u-1)+h])/v,d[4*c+h]=(o[4*l+h]-y*d[4*(c+1)+h])/(1-y);++s,++u,--l,--c}if(l-s<P)T(d,4*(u-1),d,4*(c+1))<=E&&(A=!0);else{for(v=(t-i[s])/(i[s+p+P]-i[s]),h=0;h<4;++h)C[h]=v*d[4*(u+P+1)+h]+(1-v)*d[4*(u-1)+h];T(o,4*s,C,0)<=E&&(A=!0)}if(!A)break;for(s=b,l=x;l-s>P;){for(h=0;h<4;++h)o[4*s+h]=d[4*(s-g)+h],o[4*l+h]=d[4*(l-g)+h];++s,--l}--b,++x}if(0===P)return 0;for(m=f.span+1;m<i.length;++m)i[m-P]=i[m];for(i.length=i.length-P,s=l=_,m=1;m<P;++m)m%2==1?s+=1:l-=1;for(m=s+1;m<o.length/4;++m){for(h=0;h<4;++h)o[4*l+h]=o[4*m+h];l+=1}return o.length=o.length-4*P,P},c.joinCurves=function(e,t,r,i,n){var o,s=t[t.length-1];for(t.length=t.length-1,o=e+1;o<i.length;++o)t.push(i[o]);for(o=4;o<n.length;++o)r.push(n[o]);var a=this.removeKnot(e,s,e-1,t,r);a!==e-1&&console.warn("Failed knot removal, only removed seam knot "+a+" times.")},c.clampCurve=function(e,t,r){var i=t[e],n=t[t.length-e-1];this.extractCurveSegment(e,i,n,t,r)},c.makePeriodic=function(e,t,r){var i,n,o=function(e,t,r){var i,n,o,s=0;for(i=1;i<r.length/4;++i){for(o=0,n=0;n<3;++n)o+=(r[4*i+n]-r[4*(i-1)+n])*(r[4*i+n]-r[4*(i-1)+n]);s+=Math.sqrt(o)}for(o=0,n=0;n<3;++n)o+=(r[n]-r[r.length-4+n])*(r[n]-r[r.length-4+n]);var a=Math.sqrt(o),l=(t[t.length-1]-t[0])/s,u=r.length/4-1,c=t.slice();for(i=0;i<e-1;++i)c[e-i-1]=c[e-i]-(c[u-i+1]-c[u-i]),c[u+i+2]=c[u+i+1]+(c[e+i+1]-c[e+i]);var h=c[1]-(c[u-e+2]-c[u-e+1]),d=c[u+e]+(c[2*e]-c[2*e-1]);return l/((t[0]-h+d-t[t.length-1])/a)}(e,t,r);this.unclampCurve(e,t,r,o);var s=t.length;for(i=e-1;i>=0;--i)t[s-i]=t[s-i-1]+(t[e-(i-1)]-t[e-i]);var a=r.length/4;for(r.length=4*a+4*e,t.length=s+e,i=0;i<e;++i){for(n=0;n<4;++n)r[4*(a+i)+n]=r[4*i+n];t[s+i]=t[s+i-1]+(t[e+i+1]-t[e+i])}this.clampCurve(e,t,r)},t.SplineCurveHelper=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateBCurveDerivs=t.evaluateBCurvePoint=t.evaluateBasisDerivatives=t.evaluateBasisFunctions=void 0;var i=r(1),n=r(3),o=r(17),s=function(){var e=null,t=null;return function(r,i,n,o){(null===e||e.length<n+1)&&(e=new Float64Array(n+1),t=new Float64Array(n+1));var s=new Float64Array(n+1);s[0]=1;for(var a=1;a<=n;++a){e[a]=i-o[r+1-a],t[a]=o[r+a]-i;for(var l=0,u=0;u<a;++u){var c=s[u]/(t[u+1]+e[a-u]);s[u]=l+t[u+1]*c,l=e[a-u]*c}s[a]=l}return s}}(),a=function(){var e=null,t=null,r=null,i=null;return function(n,o,s,a,l,u){var c,h,d;if(null===t||t.length<s+1){for(e=[new Float64Array(s+1),new Float64Array(s+1)],t=new Array(s+1),c=0;c<s+1;++c)t[c]=new Float64Array(s+1);r=new Float64Array(s+1),i=new Float64Array(s+1)}if(!u)for(u=new Array(a+1),c=0;c<=a;++c)u[c]=new Float64Array(s+1);for(t[0][0]=1,c=1;c<=s;++c){r[c]=o-l[n+1-c],i[c]=l[n+c]-o;var p=0;for(d=0;d<c;++d){t[c][d]=i[d+1]+r[c-d];var f=t[d][c-1]/t[c][d];t[d][c]=p+i[d+1]*f,p=r[c-d]*f}t[c][c]=p}for(c=0;c<=s;++c)u[0][c]=t[c][s];for(d=0;d<=s;++d){var g=0,v=1;for(e[0][0]=1,h=1;h<=a;++h){var y,m=0,_=d-h,E=s-h;for(d>=h&&(e[v][0]=e[g][0]/t[E+1][_],m=e[v][0]*t[_][E]),y=d-1<=E?h-1:s-d,c=_>=-1?1:-_;c<=y;++c)e[v][c]=(e[g][c]-e[g][c-1])/t[E+1][_+c],m+=e[v][c]*t[_+c][E];d<=E&&(e[v][h]=-e[g][h-1]/t[E+1][d],m+=e[v][h]*t[d][E]),u[h][d]=m,c=g,g=v,v=c}}for(d=s,h=1;h<=a;++h){for(c=0;c<=s;++c)u[h][c]*=d;d*=s-h}return u}}(),l=function(){var e=null,t=null;return function(r,s,l,u,c,h){var d,p,f;if(null===e||e.length<l+1){for(e=new Array(l+1),d=0;d<=l;++d)e[d]=new Float64Array(l+1);t=new Float64Array(l+1)}var g=Math.min(s,l),v=h&&h.length>0,y=(0,o.findKnotSpan)(r,u);a(y,r,l,g,u,e);var m=new Array(s+1);for(d=0;d<=s;++d)m[d]=i.Vector3.createFloat64();for(p=0;p<=g;++p){var _=3*(y-l);if(v)for(t[p]=0,d=0;d<=l;++d)f=h[y-l+d]*e[p][d],m[p][0]+=c[_]*f,m[p][1]+=c[_+1]*f,m[p][2]+=c[_+2]*f,t[p]+=f,_+=3;else for(d=0;d<=l;++d)f=e[p][d],m[p][0]+=c[_]*f,m[p][1]+=c[_+1]*f,m[p][2]+=c[_+2]*f,_+=3}if(v)for(p=0;p<=g;++p){var E=m[p];for(d=1;d<=p;++d)f=-n.binomialCoefficients[p][d]*t[d],i.Vector3.scaleAndAdd(E,E,m[p-d],f);i.Vector3.scale(E,E,1/t[0])}return m}}();t.evaluateBasisFunctions=s,t.evaluateBasisDerivatives=a,t.evaluateBCurvePoint=function(e,t,r,n,a){var l,u,c=(0,o.findKnotSpan)(e,r),h=s(c,e,t,r),d=a&&a.length>0,p=i.Vector3.createFloat64(),f=0,g=3*(c-t);if(d){for(l=0;l<=t;++l)u=a[c-t+l]*h[l],p[0]+=n[g]*u,p[1]+=n[g+1]*u,p[2]+=n[g+2]*u,f+=u,g+=3;i.Vector3.scale(p,p,1/f)}else for(l=0;l<=t;++l)u=h[l],p[0]+=n[g]*u,p[1]+=n[g+1]*u,p[2]+=n[g+2]*u,g+=3;return p},t.evaluateBCurveDerivs=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cylinder=void 0;var i=r(1),n=r(4),o=r(0),s=r(12),a=r(7),l=r(14),u=r(2),c=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._radius=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(c.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.CYLINDER},c.prototype.clone=function(){var e=new c;return e.copy(this),e},c.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._radius=e._radius,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},c.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},c.prototype.set=function(e,t,r,n,s){i.Vector3.copy(this._center,e),u.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._radius=t,u.ConsoleUtils.assert(i.Vector3.squaredLength(r)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,r),void 0!==n&&i.Vector3.squaredLength(n)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(u.ConsoleUtils.assert(i.Vector3.isOrthogonal(r,n,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,n)):(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._uScale=s||1,u.ConsoleUtils.assert(this._uScale>o.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},c.prototype.getRadius=function(){return this._radius},c.prototype.setRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._radius=e},c.prototype.getCenter=function(){return this._center},c.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},c.prototype.getAxisDir=function(){return this._zAxis},c.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},c.prototype.getUvOriginDir=function(){return this._xAxis},c.prototype.setUvOriginDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},c.prototype.getUScale=function(){return this._uScale},c.prototype.setUScale=function(e){u.ConsoleUtils.assert(e>o.PARAMETER_SPACE_TOLERANCE),this._uScale=e},c.prototype.evaluatePosition=function(e,t){var r=this._radius*Math.cos(t),n=this._radius*Math.sin(t),o=this._uScale*e,s=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(s,s,this._xAxis,r),i.Vector3.scaleAndAdd(s,s,this._yAxis,n),i.Vector3.scaleAndAdd(s,s,this._zAxis,o),s},c.prototype.evaluateNormal=function(e,t){var r=Math.cos(t),n=Math.sin(t),o=i.Vector3.createFloat64();return i.Vector3.scale(o,this._xAxis,r),i.Vector3.scaleAndAdd(o,o,this._yAxis,n),o},c.prototype.evaluateDu=function(e,t){var r=i.Vector3.createFloat64();return i.Vector3.scale(r,this._zAxis,this._uScale),r},c.prototype.evaluateDv=function(e,t){var r=-this._radius*Math.sin(t),n=this._radius*Math.cos(t),o=i.Vector3.createFloat64();return i.Vector3.scale(o,this._xAxis,r),i.Vector3.scaleAndAdd(o,o,this._yAxis,n),o},c.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var r=i.Vector3.dot(t,this._xAxis),n=i.Vector3.dot(t,this._yAxis),s=i.Vector3.dot(t,this._zAxis)/this._uScale,a=0;return r*r+n*n>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE&&(a=Math.atan2(n,r)),{u:s,v:a}},c.prototype.vParamLine=function(e){var t=new l.Circle,r=i.Vector3.clone(this._center),n=e*this._uScale;i.Vector3.scaleAndAdd(r,r,this._zAxis,n);var o=i.Vector3.clone(this._xAxis);i.Vector3.scale(o,o,this._radius);var s=i.Vector3.clone(this._zAxis);return i.Vector3.negate(s,s),t.set(r,s,o),t},c.prototype.uParamLine=function(e){var t=new a.Line,r=i.Vector3.clone(this._center),n=this._radius*Math.cos(e),o=this._radius*Math.sin(e);return i.Vector3.scaleAndAdd(r,r,this._xAxis,n),i.Vector3.scaleAndAdd(r,r,this._yAxis,o),t.set(r,this.evaluateDu(0,e)),t},c.prototype.getBoundingBox=function(e,t){if(e){var r=e[0],i=e[1],o=this.vParamLine(r).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new n.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},c.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._radius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},c.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},c.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},c.prototype.isPeriodicUnlimitedU=function(){return!1},c.prototype.isPeriodicUnlimitedV=function(){return!0},c.prototype.isClosedUnlimitedU=function(){return!1},c.prototype.isClosedUnlimitedV=function(){return!0},c.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),radius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Cylinder=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipticalCylinder=void 0;var i=r(1),n=r(4),o=r(0),s=r(12),a=r(7),l=r(23),u=r(2),c=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._majorRadius=0,this._minorRadius=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(c.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.ELLIPTICAL_CYLINDER},c.prototype.clone=function(){var e=new c;return e.copy(this),e},c.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},c.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},c.prototype.set=function(e,t,r,n,s){i.Vector3.copy(this._center,e),this._majorRadius=i.Vector3.length(t),u.ConsoleUtils.assert(this._majorRadius>o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,t),u.ConsoleUtils.assert(r<=1),this._minorRadius=r*this._majorRadius,u.ConsoleUtils.assert(this._minorRadius>o.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.squaredLength(n)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.isOrthogonal(n,t,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._zAxis,n),this._uScale=s||1,u.ConsoleUtils.assert(this._uScale>o.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},c.prototype.getMajorRadius=function(){return this._majorRadius},c.prototype.setMajorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._majorRadius=e},c.prototype.getMinorRadius=function(){return this._minorRadius},c.prototype.setMinorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._minorRadius=e},c.prototype.getMajorAxis=function(){return this._xAxis},c.prototype.setMajorAxis=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},c.prototype.getCenter=function(){return this._center},c.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},c.prototype.getAxisDir=function(){return this._zAxis},c.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),this._computeYAxis()},c.prototype.getUScale=function(){return this._uScale},c.prototype.setUScale=function(e){u.ConsoleUtils.assert(e>o.PARAMETER_SPACE_TOLERANCE),this._uScale=e},c.prototype.evaluatePosition=function(e,t){var r=this._majorRadius*Math.cos(t),n=this._minorRadius*Math.sin(t),o=this._uScale*e,s=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(s,s,this._xAxis,r),i.Vector3.scaleAndAdd(s,s,this._yAxis,n),i.Vector3.scaleAndAdd(s,s,this._zAxis,o),s},c.prototype.evaluateNormal=function(e,t){var r=this._minorRadius*Math.cos(t),n=this._majorRadius*Math.sin(t),o=Math.sqrt(r*r+n*n),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,r/o),i.Vector3.scaleAndAdd(s,s,this._yAxis,n/o),s},c.prototype.evaluateDu=function(e,t){var r=i.Vector3.createFloat64();return i.Vector3.scale(r,this._zAxis,this._uScale),r},c.prototype.evaluateDv=function(e,t){var r=-this._majorRadius*Math.sin(t),n=this._minorRadius*Math.cos(t),o=i.Vector3.createFloat64();return i.Vector3.scale(o,this._xAxis,r),i.Vector3.scaleAndAdd(o,o,this._yAxis,n),o},c.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var r=i.Vector3.dot(t,this._zAxis)/this._uScale;return{u:r,v:this.vParamLine(r).closestToPointParam(e)}},c.prototype.vParamLine=function(e){var t=new l.Ellipse,r=i.Vector3.clone(this._center),n=e*this._uScale;i.Vector3.scaleAndAdd(r,r,this._zAxis,n);var o=i.Vector3.clone(this._xAxis);i.Vector3.scale(o,o,this._majorRadius);var s=i.Vector3.clone(this._zAxis);return i.Vector3.negate(s,s),t.set(r,s,o,this._minorRadius/this._majorRadius),t},c.prototype.uParamLine=function(e){var t=new a.Line,r=i.Vector3.clone(this._center),n=this._majorRadius*Math.cos(e),o=this._minorRadius*Math.sin(e);return i.Vector3.scaleAndAdd(r,r,this._xAxis,n),i.Vector3.scaleAndAdd(r,r,this._yAxis,o),t.set(r,this.evaluateDu(0,e)),t},c.prototype.getBoundingBox=function(e,t){if(e){var r=e[0],i=e[1],o=this.vParamLine(r).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new n.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},c.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._majorRadius*=t,this._minorRadius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},c.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},c.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},c.prototype.isPeriodicUnlimitedU=function(){return!1},c.prototype.isPeriodicUnlimitedV=function(){return!0},c.prototype.isClosedUnlimitedU=function(){return!1},c.prototype.isClosedUnlimitedV=function(){return!0},c.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),majorRadius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),radiusRatio:this.getMinorRadius()/this.getMajorRadius(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.EllipticalCylinder=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wire=void 0;var i=r(9),n=r(4),o=r(0),s=function(){i.BaseTopology.call(this),this._wireBody=void 0,this._edges=[]};(s.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.WIRE},s.prototype.getWireBody=function(){return this._wireBody},s.prototype.setWireBody=function(e){this._wireBody=e},s.prototype.getEdges=function(){return this._edges},s.prototype.setEdges=function(e){this._edges=new Array(e.length);for(var t=0;t<e.length;++t)this._edges[t]=e[t]},s.prototype.addEdge=function(e){this._edges?this._edges.push(e):this._edges=[e],e.setWire(this),e.setCoedge(void 0)},s.prototype.addEdges=function(e){this._edges||(this._edges=[]);for(var t=0;t<e.length;++t)e[t].setWire(this),e[t].setCoedge(void 0);this._edges=this._edges.concat(e)},s.prototype.removeEdge=function(e){var t=this._edges.indexOf(e);return t>-1&&(this._edges.splice(t,1),e.getWire()===this&&e.setWire(void 0),!0)},s.prototype.getBody=function(){return this._wireBody},s.prototype.collectFaces=function(e){return e||new Set},s.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)e.add(this._edges[t]);return e},s.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)this._edges[t].collectVertices(e);return e},s.prototype.isBranched=function(){for(var e=0;e<this._edges.length;++e){var t=this._edges[e],r=t.getStartVertex(),i=t.getEndVertex();if(r===i&&r.getOtherEdge(t))return!0;if(r.getEdges().length>2||i.getEdges().length>2)return!0}return!1},s.prototype.getOrderedEdges=function(){if(0===this._edges.length)return{edges:[],start:void 0,end:void 0};var e=[];e.push(this._edges[0]);for(var t=new Set(this._edges.slice(1)),r=e[0].getStartVertex(),i=e[0].getEndVertex();t.size>0;){var n=t.size;if(t.forEach((function(n){n.getEndVertex()===r?(e.unshift(n),r=n.getStartVertex(),t.delete(n)):n.getStartVertex()===r?(e.unshift(n),r=n.getEndVertex(),t.delete(n)):n.getEndVertex()===i?(e.push(n),i=n.getStartVertex(),t.delete(n)):n.getStartVertex()===i&&(e.push(n),i=n.getEndVertex(),t.delete(n))})),n===t.size){console.warn("Wire is disconnected or branching.");break}}return{edges:e,start:r,end:i}},s.prototype.isClosed=function(){if(1===this._edges.length)return this._edges[0].getStartVertex()===this._edges[0].getEndVertex();for(var e=this._edges[0],t=void 0,r=0;r<this._edges.length;++r){var i,n=e.getStartVertex(),o=e.getEndVertex();if(n===o||2!==n.getEdges().length||2!==o.getEdges().length)return!1;if(t&&n.getOtherEdge(e)!==t){if(o.getOtherEdge(e)!==t)return!1;i=n.getOtherEdge(e)}else i=o.getOtherEdge(e);t=e,e=i}return e===this._edges[0]},s.prototype.getBoundingBox=function(){for(var e=new n.BoundingBox,t=0;t<this._edges.length;++t)e.include(this._edges[t].getBoundingBox());return e},s.prototype.toString=function(){return"Wire"},s.prototype.toObject=function(){return{edges:this.refsToStrings(this._edges),attributes:this.refsToStrings(this._attributes)}},s.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._edges,this._attributes])},t.Wire=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgenitorMap=void 0;var i=r(0),n=r(2),o=function(){this._newToOldMap=new Map,this._oldToNewMap=new Map,this._labelMap=new Map};o.prototype.addEntry=function(e,t,r){t=Array.from(new Set(t)),n.ConsoleUtils.assert(!this._newToOldMap.has(e)),this._newToOldMap.set(e,t),r&&this._labelMap.set(e,r);for(var i=0;i<t.length;i++){var o=t[i],s=this._oldToNewMap.get(o);s?s.indexOf(e)<0&&s.push(e):this._oldToNewMap.set(o,[e])}},o.prototype.hasEntry=function(e){return this._newToOldMap.has(e)},o.prototype.removeEntry=function(e){var t=this._newToOldMap.get(e);if(t){this._newToOldMap.delete(e),this._labelMap.delete(e);for(var r=0;r<t.length;r++){var i=this._oldToNewMap.get(t[r]),o=i.indexOf(e);n.ConsoleUtils.assert(o>=0),i.splice(o,1),0===i.length&&this._oldToNewMap.delete(t[r])}}},o.prototype.size=function(){return this._newToOldMap.size},o.prototype.getProgenitors=function(e){return this._newToOldMap.get(e)},o.prototype.getDescendants=function(e){return this._oldToNewMap.get(e)||[]},o.prototype.getLabel=function(e){return this._labelMap.get(e)||""},o.prototype.getAllNewTopology=function(){return Array.from(this._newToOldMap.keys())},o.prototype.getAllOldTopology=function(){return Array.from(this._oldToNewMap.keys())},o.prototype.clear=function(){this._newToOldMap.clear(),this._oldToNewMap.clear(),this._labelMap.clear()},o.prototype.mergeMaps=function(e){var t=new o,r=new Set(this._newToOldMap.keys());return e._newToOldMap.keys().forEach((function(e){r.add(e)})),r.forEach((function(r){var i=this.getProgenitors(r)||[],n=e.getProgenitors(r)||[],o=this.getLabel(r)||e.getLabel(r);t.addEntry(r,i.concat(n),o)})),t},o.prototype.collapseMaps=function(e,t){var r=!1,i=!1;t&&(void 0!==t.keepIntermediates&&(r=t.keepIntermediates),void 0!==t.keepAllDescendants&&(i=t.keepAllDescendants));var n=new o,s=void 0;return i&&(s=new Set(e._newToOldMap.keys())),this._newToOldMap.forEach((function(t,o){for(var a=new Set,l=0;l<t.length;l++){var u=t[l],c=e.getProgenitors(u);c&&c.length>0?(c.forEach((function(e){a.add(e)})),r&&a.add(u)):a.add(u),i&&s.delete(u)}n.addEntry(o,Array.from(a))})),i&&s.forEach((function(t){var r=e.getProgenitors(t);n.hasEntry(t)&&(r=r.concat(n.getProgenitors(t)),n.removeEntry(t)),n.addEntry(t,r)})),n},o.prototype.toString=function(){for(var e="ProgenitorMap:\n",t=this.getAllNewTopology(),r=0;r<t.length;r++){var n=t[r];e+=i.TOPOLOGY_TYPES.toString(n.getTopologyType())+":"+n.getGuid();var o=this.getLabel(n);o&&(e+=" '"+o+"'"),e+=" -> [ ";for(var s=this.getProgenitors(n),a=0;a<s.length;a++)a>0&&(e+=", "),e+=i.TOPOLOGY_TYPES.toString(s[a].getTopologyType())+":"+s[a].getGuid();e+=" ]\n"}return e},t.ProgenitorMap=o},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o})),r.d(t,"VERSION",(function(){return i.VERSION})),r.d(t,"iteratee",(function(){return i.iteratee})),r.d(t,"restArguments",(function(){return i.restArguments})),r.d(t,"each",(function(){return i.each})),r.d(t,"forEach",(function(){return i.forEach})),r.d(t,"map",(function(){return i.map})),r.d(t,"collect",(function(){return i.collect})),r.d(t,"reduce",(function(){return i.reduce})),r.d(t,"foldl",(function(){return i.foldl})),r.d(t,"inject",(function(){return i.inject})),r.d(t,"reduceRight",(function(){return i.reduceRight})),r.d(t,"foldr",(function(){return i.foldr})),r.d(t,"find",(function(){return i.find})),r.d(t,"detect",(function(){return i.detect})),r.d(t,"filter",(function(){return i.filter})),r.d(t,"select",(function(){return i.select})),r.d(t,"reject",(function(){return i.reject})),r.d(t,"every",(function(){return i.every})),r.d(t,"all",(function(){return i.all})),r.d(t,"some",(function(){return i.some})),r.d(t,"any",(function(){return i.any})),r.d(t,"contains",(function(){return i.contains})),r.d(t,"includes",(function(){return i.includes})),r.d(t,"include",(function(){return i.include})),r.d(t,"invoke",(function(){return i.invoke})),r.d(t,"pluck",(function(){return i.pluck})),r.d(t,"where",(function(){return i.where})),r.d(t,"findWhere",(function(){return i.findWhere})),r.d(t,"max",(function(){return i.max})),r.d(t,"min",(function(){return i.min})),r.d(t,"shuffle",(function(){return i.shuffle})),r.d(t,"sample",(function(){return i.sample})),r.d(t,"sortBy",(function(){return i.sortBy})),r.d(t,"groupBy",(function(){return i.groupBy})),r.d(t,"indexBy",(function(){return i.indexBy})),r.d(t,"countBy",(function(){return i.countBy})),r.d(t,"toArray",(function(){return i.toArray})),r.d(t,"size",(function(){return i.size})),r.d(t,"partition",(function(){return i.partition})),r.d(t,"first",(function(){return i.first})),r.d(t,"head",(function(){return i.head})),r.d(t,"take",(function(){return i.take})),r.d(t,"initial",(function(){return i.initial})),r.d(t,"last",(function(){return i.last})),r.d(t,"rest",(function(){return i.rest})),r.d(t,"tail",(function(){return i.tail})),r.d(t,"drop",(function(){return i.drop})),r.d(t,"compact",(function(){return i.compact})),r.d(t,"flatten",(function(){return i.flatten})),r.d(t,"without",(function(){return i.without})),r.d(t,"uniq",(function(){return i.uniq})),r.d(t,"unique",(function(){return i.unique})),r.d(t,"union",(function(){return i.union})),r.d(t,"intersection",(function(){return i.intersection})),r.d(t,"difference",(function(){return i.difference})),r.d(t,"unzip",(function(){return i.unzip})),r.d(t,"zip",(function(){return i.zip})),r.d(t,"object",(function(){return i.object})),r.d(t,"findIndex",(function(){return i.findIndex})),r.d(t,"findLastIndex",(function(){return i.findLastIndex})),r.d(t,"sortedIndex",(function(){return i.sortedIndex})),r.d(t,"indexOf",(function(){return i.indexOf})),r.d(t,"lastIndexOf",(function(){return i.lastIndexOf})),r.d(t,"range",(function(){return i.range})),r.d(t,"chunk",(function(){return i.chunk})),r.d(t,"bind",(function(){return i.bind})),r.d(t,"partial",(function(){return i.partial})),r.d(t,"bindAll",(function(){return i.bindAll})),r.d(t,"memoize",(function(){return i.memoize})),r.d(t,"delay",(function(){return i.delay})),r.d(t,"defer",(function(){return i.defer})),r.d(t,"throttle",(function(){return i.throttle})),r.d(t,"debounce",(function(){return i.debounce})),r.d(t,"wrap",(function(){return i.wrap})),r.d(t,"negate",(function(){return i.negate})),r.d(t,"compose",(function(){return i.compose})),r.d(t,"after",(function(){return i.after})),r.d(t,"before",(function(){return i.before})),r.d(t,"once",(function(){return i.once})),r.d(t,"keys",(function(){return i.keys})),r.d(t,"allKeys",(function(){return i.allKeys})),r.d(t,"values",(function(){return i.values})),r.d(t,"mapObject",(function(){return i.mapObject})),r.d(t,"pairs",(function(){return i.pairs})),r.d(t,"invert",(function(){return i.invert})),r.d(t,"functions",(function(){return i.functions})),r.d(t,"methods",(function(){return i.methods})),r.d(t,"extend",(function(){return i.extend})),r.d(t,"extendOwn",(function(){return i.extendOwn})),r.d(t,"assign",(function(){return i.assign})),r.d(t,"findKey",(function(){return i.findKey})),r.d(t,"pick",(function(){return i.pick})),r.d(t,"omit",(function(){return i.omit})),r.d(t,"defaults",(function(){return i.defaults})),r.d(t,"create",(function(){return i.create})),r.d(t,"clone",(function(){return i.clone})),r.d(t,"tap",(function(){return i.tap})),r.d(t,"isMatch",(function(){return i.isMatch})),r.d(t,"isEqual",(function(){return i.isEqual})),r.d(t,"isEmpty",(function(){return i.isEmpty})),r.d(t,"isElement",(function(){return i.isElement})),r.d(t,"isArray",(function(){return i.isArray})),r.d(t,"isObject",(function(){return i.isObject})),r.d(t,"isArguments",(function(){return i.isArguments})),r.d(t,"isFunction",(function(){return i.isFunction})),r.d(t,"isString",(function(){return i.isString})),r.d(t,"isNumber",(function(){return i.isNumber})),r.d(t,"isDate",(function(){return i.isDate})),r.d(t,"isRegExp",(function(){return i.isRegExp})),r.d(t,"isError",(function(){return i.isError})),r.d(t,"isSymbol",(function(){return i.isSymbol})),r.d(t,"isMap",(function(){return i.isMap})),r.d(t,"isWeakMap",(function(){return i.isWeakMap})),r.d(t,"isSet",(function(){return i.isSet})),r.d(t,"isWeakSet",(function(){return i.isWeakSet})),r.d(t,"isFinite",(function(){return i.isFinite})),r.d(t,"isNaN",(function(){return i.isNaN})),r.d(t,"isBoolean",(function(){return i.isBoolean})),r.d(t,"isNull",(function(){return i.isNull})),r.d(t,"isUndefined",(function(){return i.isUndefined})),r.d(t,"has",(function(){return i.has})),r.d(t,"identity",(function(){return i.identity})),r.d(t,"constant",(function(){return i.constant})),r.d(t,"noop",(function(){return i.noop})),r.d(t,"property",(function(){return i.property})),r.d(t,"propertyOf",(function(){return i.propertyOf})),r.d(t,"matcher",(function(){return i.matcher})),r.d(t,"matches",(function(){return i.matches})),r.d(t,"times",(function(){return i.times})),r.d(t,"random",(function(){return i.random})),r.d(t,"now",(function(){return i.now})),r.d(t,"escape",(function(){return i.escape})),r.d(t,"unescape",(function(){return i.unescape})),r.d(t,"result",(function(){return i.result})),r.d(t,"uniqueId",(function(){return i.uniqueId})),r.d(t,"templateSettings",(function(){return i.templateSettings})),r.d(t,"template",(function(){return i.template})),r.d(t,"chain",(function(){return i.chain})),r.d(t,"mixin",(function(){return i.mixin}));var i=r(29),n=Object(i.mixin)(i);n._=n;var o=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseGeometry=void 0;var i=r(44),n=r(0),o=function(){i.Base.call(this)};(o.prototype=Object.create(i.Base.prototype)).getGeometryType=function(){console.warn("BaseGeometry.getGeometryType : abstract method invoked!")},o.prototype.clone=function(){console.warn("BaseGeometry.clone : abstract method invoked")},o.prototype.copy=function(e){this._guid=""},o.prototype.addToModelObject=function(e){if(!e.geometries[this.getGuid()]){var t={};t[n.GEOMETRY_TYPES.toString(this.getGeometryType()).toLowerCase()]=this.toObject(),e.geometries[this.getGuid()]=t}},t.BaseGeometry=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base=void 0;var i=r(56),n=r(45).Autodesk.lookup("SolidDef.paramrange_1_0_0.typeEnum"),o=function(){this._guid=""};o.prototype.setGuid=function(e){this._guid=e},o.prototype.getGuid=function(){return this._guid||(this._guid=(0,i.generateGUID)()),this._guid},o.prototype.refsToStrings=function(e){if(e){for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=e[r].getGuid();return t}return[]},o.prototype.refToString=function(e){return e?e.getGuid():""},o.prototype.toObject=function(){return console.warn("Base.toObject : abstract method invoked!"),{}},o.prototype.vectorToObject=function(e){return{x:e[0],y:e[1],z:e[2]}},o.prototype.rangeToObject=function(e,t){var r=1,i=0;t&&void 0!==e&&2===e.length&&isFinite(e[0])&&isFinite(e[1])&&(r=e[0],i=e[1]);var o=r<=i?"finite":"infinite";return{low:r,high:i,type:n.values[o]}},o.prototype.addToModelObject=function(e){console.warn("Base.addToModelObject : abstract method invoked!")},t.Base=o},function(e,t,r){"use strict";var i=r(87),n=(i.roots.default||(i.roots.default=new i.Root)).addJSON({Autodesk:{nested:{SolidDef:{nested:{SolidDef_grpc:{methods:{}},point3d_1_0_0:{fields:{x:{type:"double",id:1},y:{type:"double",id:2},z:{type:"double",id:3}}},vector3d_1_0_0:{fields:{x:{type:"double",id:1},y:{type:"double",id:2},z:{type:"double",id:3}}},geometry_1_0_0:{fields:{}},geometry_1_0_0_Type:{oneofs:{geometry:{oneof:["point","bsurface","cone","cylinder","ellipticalcone","ellipticalcylinder","plane","sphere","surface","torus","bcurve","circle","curve","ellipse","line"]}},fields:{point:{type:"point_1_0_0",id:1},bsurface:{type:"bsurface_1_0_0",id:2},cone:{type:"cone_1_0_0",id:3},cylinder:{type:"cylinder_1_0_0",id:4},ellipticalcone:{type:"ellipticalcone_1_0_0",id:5},ellipticalcylinder:{type:"ellipticalcylinder_1_0_0",id:6},plane:{type:"plane_1_0_0",id:7},sphere:{type:"sphere_1_0_0",id:8},surface:{type:"surface_1_0_0",id:9},torus:{type:"torus_1_0_0",id:10},bcurve:{type:"bcurve_1_0_0",id:11},circle:{type:"circle_1_0_0",id:12},curve:{type:"curve_1_0_0",id:13},ellipse:{type:"ellipse_1_0_0",id:14},line:{type:"line_1_0_0",id:15}}},paramrange_1_0_0:{fields:{low:{type:"double",id:1},high:{type:"double",id:2},type:{type:"typeEnum",id:3}},nested:{typeEnum:{values:{infinite:0,finite:1,boundBelow:2,boundAbove:3}}}},point_1_0_0:{fields:{position:{type:"point3d_1_0_0",id:1}}},bsurface_1_0_0:{fields:{uDegree:{type:"uint32",id:1},vDegree:{type:"uint32",id:2},uKnots:{rule:"repeated",type:"double",id:3},vKnots:{rule:"repeated",type:"double",id:4},controlPoints:{rule:"repeated",type:"double",id:5},weights:{rule:"repeated",type:"double",id:6},uRange:{type:"paramrange_1_0_0",id:7},vRange:{type:"paramrange_1_0_0",id:8}}},cone_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},radius:{type:"vector3d_1_0_0",id:3},angle:{type:"double",id:4},uCoordScale:{type:"double",id:5},uRange:{type:"paramrange_1_0_0",id:6},vRange:{type:"paramrange_1_0_0",id:7}}},cylinder_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},radius:{type:"vector3d_1_0_0",id:3},uCoordScale:{type:"double",id:4},uRange:{type:"paramrange_1_0_0",id:5},vRange:{type:"paramrange_1_0_0",id:6}}},ellipticalcone_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"vector3d_1_0_0",id:3},radiusRatio:{type:"double",id:4},angle:{type:"double",id:5},uCoordScale:{type:"double",id:6},uRange:{type:"paramrange_1_0_0",id:7},vRange:{type:"paramrange_1_0_0",id:8}}},ellipticalcylinder_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"vector3d_1_0_0",id:3},radiusRatio:{type:"double",id:4},uCoordScale:{type:"double",id:5},uRange:{type:"paramrange_1_0_0",id:6},vRange:{type:"paramrange_1_0_0",id:7}}},plane_1_0_0:{fields:{origin:{type:"point3d_1_0_0",id:1},normal:{type:"vector3d_1_0_0",id:2},uAxis:{type:"vector3d_1_0_0",id:3},uRange:{type:"paramrange_1_0_0",id:4},vRange:{type:"paramrange_1_0_0",id:5}}},sphere_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},radius:{type:"vector3d_1_0_0",id:2},axis:{type:"vector3d_1_0_0",id:3},uRange:{type:"paramrange_1_0_0",id:4},vRange:{type:"paramrange_1_0_0",id:5}}},surface_1_0_0:{fields:{uRange:{type:"paramrange_1_0_0",id:1},vRange:{type:"paramrange_1_0_0",id:2}}},surface_1_0_0_Type:{oneofs:{surface:{oneof:["bsurface","cone","cylinder","ellipticalcone","ellipticalcylinder","plane","sphere","torus"]}},fields:{bsurface:{type:"bsurface_1_0_0",id:1},cone:{type:"cone_1_0_0",id:2},cylinder:{type:"cylinder_1_0_0",id:3},ellipticalcone:{type:"ellipticalcone_1_0_0",id:4},ellipticalcylinder:{type:"ellipticalcylinder_1_0_0",id:5},plane:{type:"plane_1_0_0",id:6},sphere:{type:"sphere_1_0_0",id:7},torus:{type:"torus_1_0_0",id:8}}},torus_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"double",id:3},minorRadius:{type:"double",id:4},coordAxis:{type:"vector3d_1_0_0",id:5},lemon:{type:"bool",id:6},uRange:{type:"paramrange_1_0_0",id:7},vRange:{type:"paramrange_1_0_0",id:8}}},bcurve_1_0_0:{fields:{degree:{type:"uint32",id:1},knots:{rule:"repeated",type:"double",id:2},controlPoints:{rule:"repeated",type:"double",id:3},weights:{rule:"repeated",type:"double",id:4},range:{type:"paramrange_1_0_0",id:5}}},circle_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},normal:{type:"vector3d_1_0_0",id:2},radius:{type:"vector3d_1_0_0",id:3},range:{type:"paramrange_1_0_0",id:4}}},curve_1_0_0:{fields:{range:{type:"paramrange_1_0_0",id:1}}},curve_1_0_0_Type:{oneofs:{curve:{oneof:["bcurve","circle","ellipse","line"]}},fields:{bcurve:{type:"bcurve_1_0_0",id:1},circle:{type:"circle_1_0_0",id:2},ellipse:{type:"ellipse_1_0_0",id:3},line:{type:"line_1_0_0",id:4}}},ellipse_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},normal:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"vector3d_1_0_0",id:3},radiusRatio:{type:"double",id:4},range:{type:"paramrange_1_0_0",id:5}}},line_1_0_0:{fields:{position:{type:"point3d_1_0_0",id:1},direction:{type:"vector3d_1_0_0",id:2},range:{type:"paramrange_1_0_0",id:3}}},attribute_1_0_0:{fields:{}},attribute_1_0_0_Type:{oneofs:{attribute:{oneof:["nmiattribute","nmiattributearr","nmiattributestr","textattribute"]}},fields:{nmiattribute:{type:"nmiattribute_1_0_0",id:1},nmiattributearr:{type:"nmiattributearr_1_0_0",id:4},nmiattributestr:{type:"nmiattributestr_1_0_0",id:2},textattribute:{type:"textattribute_1_0_0",id:3}}},body_1_0_0:{fields:{lumps:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},coedge_1_0_0:{fields:{edge:{type:"string",id:1},partner:{type:"string",id:2},reversed:{type:"bool",id:3},attributes:{rule:"repeated",type:"string",id:4}}},edge_1_0_0:{fields:{vertex0:{type:"string",id:1},vertex1:{type:"string",id:2},precision:{type:"double",id:3},range:{type:"paramrange_1_0_0",id:4},reversed:{type:"bool",id:5},geometry:{type:"string",id:6},attributes:{rule:"repeated",type:"string",id:7}}},face_1_0_0:{fields:{loops:{rule:"repeated",type:"string",id:1},reversed:{type:"bool",id:2},geometry:{type:"string",id:3},attributes:{rule:"repeated",type:"string",id:4}}},loop_1_0_0:{fields:{coedges:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},lump_1_0_0:{fields:{shells:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},model_1_0_0:{fields:{geometries:{keyType:"string",type:"geometry_1_0_0_Type",id:1},topologies:{keyType:"string",type:"topology_1_0_0_Type",id:2},attributes:{keyType:"string",type:"attribute_1_0_0_Type",id:3}}},shell_1_0_0:{fields:{faces:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},topology_1_0_0:{fields:{attributes:{rule:"repeated",type:"string",id:1}}},topology_1_0_0_Type:{oneofs:{topology:{oneof:["body","coedge","edge","face","loop","lump","shell","vertex","wire","wirebody"]}},fields:{body:{type:"body_1_0_0",id:1},coedge:{type:"coedge_1_0_0",id:2},edge:{type:"edge_1_0_0",id:3},face:{type:"face_1_0_0",id:4},loop:{type:"loop_1_0_0",id:5},lump:{type:"lump_1_0_0",id:6},shell:{type:"shell_1_0_0",id:7},vertex:{type:"vertex_1_0_0",id:8},wire:{type:"wire_1_0_0",id:9},wirebody:{type:"wirebody_1_0_0",id:10}}},vertex_1_0_0:{fields:{precision:{type:"double",id:1},geometry:{type:"string",id:2},attributes:{rule:"repeated",type:"string",id:3}}},wire_1_0_0:{fields:{edges:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},wirebody_1_0_0:{fields:{wires:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},nmiattribute_1_0_0:{fields:{primaryId:{type:"uint64",id:1},secondaryId:{type:"int64",id:2},approachId:{type:"int64",id:3},operationIds:{rule:"repeated",type:"int64",id:4}}},nmiattributearr_1_0_0:{fields:{tagInfo:{rule:"repeated",type:"nmiattributestr_1_0_0",id:1}}},nmiattributestr_1_0_0:{fields:{primaryId:{type:"string",id:1},secondaryId:{type:"string",id:2},approachId:{type:"string",id:3},operationIds:{rule:"repeated",type:"string",id:4}}},textattribute_1_0_0:{fields:{text:{type:"string",id:1}}},entity:{oneofs:{entity:{oneof:["point3d","vector3d","geometry","paramrange","point","bsurface","cone","cylinder","ellipticalcone","ellipticalcylinder","plane","sphere","surface","torus","bcurve","circle","curve","ellipse","line","attribute","body","coedge","edge","face","loop","lump","model","shell","topology","vertex","wire","wirebody","nmiattribute","nmiattributearr","nmiattributestr","textattribute"]}},fields:{id:{type:"string",id:1},point3d:{type:"point3d_1_0_0",id:2},vector3d:{type:"vector3d_1_0_0",id:3},geometry:{type:"geometry_1_0_0",id:4},paramrange:{type:"paramrange_1_0_0",id:5},point:{type:"point_1_0_0",id:6},bsurface:{type:"bsurface_1_0_0",id:7},cone:{type:"cone_1_0_0",id:8},cylinder:{type:"cylinder_1_0_0",id:9},ellipticalcone:{type:"ellipticalcone_1_0_0",id:10},ellipticalcylinder:{type:"ellipticalcylinder_1_0_0",id:11},plane:{type:"plane_1_0_0",id:12},sphere:{type:"sphere_1_0_0",id:13},surface:{type:"surface_1_0_0",id:14},torus:{type:"torus_1_0_0",id:15},bcurve:{type:"bcurve_1_0_0",id:16},circle:{type:"circle_1_0_0",id:17},curve:{type:"curve_1_0_0",id:18},ellipse:{type:"ellipse_1_0_0",id:19},line:{type:"line_1_0_0",id:20},attribute:{type:"attribute_1_0_0",id:21},body:{type:"body_1_0_0",id:22},coedge:{type:"coedge_1_0_0",id:23},edge:{type:"edge_1_0_0",id:24},face:{type:"face_1_0_0",id:25},loop:{type:"loop_1_0_0",id:26},lump:{type:"lump_1_0_0",id:27},model:{type:"model_1_0_0",id:28},shell:{type:"shell_1_0_0",id:29},topology:{type:"topology_1_0_0",id:30},vertex:{type:"vertex_1_0_0",id:31},wire:{type:"wire_1_0_0",id:32},wirebody:{type:"wirebody_1_0_0",id:33},nmiattribute:{type:"nmiattribute_1_0_0",id:34},nmiattributearr:{type:"nmiattributearr_1_0_0",id:37},nmiattributestr:{type:"nmiattributestr_1_0_0",id:35},textattribute:{type:"textattribute_1_0_0",id:36}}}}}}}});e.exports=n},function(e,t,r){"use strict";e.exports=c;var i,n=r(10),o=n.LongBits,s=n.base64,a=n.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}function h(e,t,r){t[r]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function p(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function f(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}c.create=n.Buffer?function(){return(c.create=function(){return new i})()}:function(){return new c},c.alloc=function(e){return new n.Array(e)},n.Array!==Array&&(c.alloc=n.pool(c.alloc,n.Array.prototype.subarray)),c.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},d.prototype=Object.create(l.prototype),d.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},c.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},c.prototype.int32=function(e){return e<0?this._push(p,10,o.fromNumber(e)):this.uint32(e)},c.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},c.prototype.uint64=function(e){var t=o.from(e);return this._push(p,t.length(),t)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(p,t.length(),t)},c.prototype.bool=function(e){return this._push(h,1,e?1:0)},c.prototype.fixed32=function(e){return this._push(f,4,e>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(e){var t=o.from(e);return this._push(f,4,t.lo)._push(f,4,t.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(e){return this._push(n.float.writeFloatLE,4,e)},c.prototype.double=function(e){return this._push(n.float.writeDoubleLE,8,e)};var g=n.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};c.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(h,1,0);if(n.isString(e)){var r=c.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(g,t,e)},c.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(h,1,0)},c.prototype.fork=function(){return this.states=new function(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}(this),this.head=this.tail=new l(u,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},c.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},c.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},c._configure=function(e){i=e}},function(e,t,r){"use strict";e.exports=l;var i,n=r(10),o=n.LongBits,s=n.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")};function c(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new o(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}l.create=n.Buffer?function(e){return(l.create=function(e){return n.Buffer.isBuffer(e)?new i(e):u(e)})(e)}:u,l.prototype._slice=n.Array.prototype.subarray||n.Array.prototype.slice,l.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return h(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|h(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=n.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=n.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){i=e;var t=n.Long?"toLong":"toNumber";n.merge(l.prototype,{int64:function(){return c.call(this)[t](!1)},uint64:function(){return c.call(this)[t](!0)},sint64:function(){return c.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},function(e,t,r){"use strict";e.exports=s;var i=r(21);((s.prototype=Object.create(i.prototype)).constructor=s).className="OneOf";var n=r(22),o=r(5);function s(e,t,r,n){if(Array.isArray(t)||(r=t,t=void 0),i.call(this,e,r),void 0!==t&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=n}function a(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}s.fromJSON=function(e,t){return new s(e,t.oneof,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},s.prototype.add=function(e){if(!(e instanceof n))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,a(this),this},s.prototype.remove=function(e){if(!(e instanceof n))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},s.prototype.onAdd=function(e){i.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var r=e.get(this.oneof[t]);r&&!r.partOf&&(r.partOf=this,this.fieldsArray.push(r))}a(this)},s.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);i.prototype.onRemove.call(this,e)},s.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){o.decorateType(t.constructor).add(new s(r,e)),Object.defineProperty(t,r,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},function(e,t,r){"use strict";e.exports=n;var i=r(10);function n(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}n.create=function(e){return this.$type.create(e)},n.encode=function(e,t){return this.$type.encode(e,t)},n.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},n.decode=function(e){return this.$type.decode(e)},n.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},n.verify=function(e){return this.$type.verify(e)},n.fromObject=function(e){return this.$type.fromObject(e)},n.toObject=function(e,t){return this.$type.toObject(e,t)},n.prototype.toJSON=function(){return this.$type.toObject(this,i.toJSONOptions)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TessellationCache=t.CurveTessellator=void 0;var i=r(1),n=r(0),o=r(3),s=r(8),a={getCircularArcRenderPoints:function(e,t,r,i,n){var o=e.getRadius(),s=2*Math.acos((o-r)/o),a=t[1]-t[0],l=Math.ceil(a/s),u=0;for(!1===i&&u++;u<=l;++u){var c=u/l,h=t[0]*(1-c)+t[1]*c;n.push(e.evaluatePosition(h))}return o*(1-Math.cos(a/l*.5))},getAdaptiveRenderPoints:function(e,t,r,o){for(var a=t||.001,l=a*a,u=[],c=[],h=i.Vector3.createFloat64(),d=0,p=function t(r,o,a,p,f){var g=a-r,v=.5*(r+a),y=e.evaluatePosition(v);i.Vector3.scaleAndAdd(h,[0,0,0],o,.5),i.Vector3.scaleAndAdd(h,h,p,.5);var m=i.Vector3.squaredDistance(h,y);if(f>64)s.DebugUtils.warn("Max recursion depth reach in getAdaptiveRenderPoints");else if(g>10*n.PARAMETER_SPACE_TOLERANCE&&m>l)return t(r,o,v,y,f+1),void t(v,y,a,p,f+1);d=Math.max(d,m),u.push(o),c.push(r)},f=o||function(e,t,r){for(var i=new Array(7),n=t,o=(r-t)/6,s=0;s<7;s++){var a=n;s>0&&s<6&&(a+=Math.sin(s)*o*.1),i[s]=a,n+=o}return i}(0,r[0],r[1]),g=0;g<f.length-1;++g){var v=f[g],y=f[g+1],m=e.evaluatePosition(v),_=e.evaluatePosition(y);p(v,m,y,_,0),g===f.length-2&&(u.push(_),c.push(y))}return{positions:u,params:c,tolerance:Math.sqrt(d)}}},l=function(){this._hasDirtyTessellation=!0,this._tessellationCache=void 0,this._trimmedTessellationCache={positions:void 0,offsets:void 0,transitions:[1,-1]}};l.prototype.setDirty=function(e){this._hasDirtyTessellation=e},l.prototype.isDirty=function(){return this._hasDirtyTessellation},l.prototype.reset=function(){this._hasDirtyTessellation=!0,this._tessellationCache=void 0,this._trimmedTessellationCache={positions:void 0,offsets:void 0,transitions:[1,-1]}},l.prototype.setCache=function(e){this._tessellationCache=e,this._hasDirtyTessellation=!1},l.prototype.getCache=function(){return this._tessellationCache},l.prototype.getTolerance=function(){if(this._tessellationCache)return this._tessellationCache.tolerance},l.prototype.getTessellation=function(e,t,r,s){var a=!1;if(!1===this._hasDirtyTessellation&&this._tessellationCache.tolerance>r+i.FLOAT64_TOLERANCE&&(this._hasDirtyTessellation=!0),this._hasDirtyTessellation){this._hasDirtyTessellation=!1;var l=s(r);this._tessellationCache={positions:l.positions,params:l.params,tolerance:l.tolerance},a=l.didRetessellate}var u=[e[0],e[e.length-1]],c=0,h=t.getRangeUnlimited();t.isPeriodicUnlimited()&&(c=(u=(0,o.normalizeParametricRangeToShiftedRange)(u,h))[0]-e[0]);var d=this._trimmedTessellationCache,p=d.transitions[0]-u[0],f=d.transitions[d.transitions.length-1]-u[1],g=p*p+f*f<i.FLOAT64_TOLERANCE;if(g&&e.length>2){g=d.transitions.length===e.length;for(var v=1;g&&v<e.length-1;++v)g=d.transitions[v-1]===e[v-1]+c}if(!g||a){var y;for(d.transitions.length=e.length,y=0;y<e.length;++y)d.transitions[y]=e[y]+c;d.positions=[t.evaluatePosition(e[0])],d.offsets=[0];var m,_,E=1,x=u[0];for(y=1;y<e.length;y++){var b=e[y]+c;for(_=0;_<this._tessellationCache.positions.length;_++)if((m=this._tessellationCache.params[_])>x+n.PARAMETER_SPACE_TOLERANCE){if(m>=b-n.PARAMETER_SPACE_TOLERANCE)break;i.Vector3.sqrDist(d.positions[E-1],this._tessellationCache.positions[_])>n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE&&(d.positions[E++]=i.Vector3.clone(this._tessellationCache.positions[_]))}if(t.isPeriodicUnlimited()&&b>h[1])for(_=1;_<this._tessellationCache.positions.length&&(m=this._tessellationCache.params[_])<b-(h[1]-h[0])-n.PARAMETER_SPACE_TOLERANCE;_++)i.Vector3.sqrDist(d.positions[E-1],this._tessellationCache.positions[_])>n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE&&(d.positions[E++]=i.Vector3.clone(this._tessellationCache.positions[_]));var A=t.evaluatePosition(b);i.Vector3.sqrDist(d.positions[E-1],A)<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE&&E>d.offsets[d.offsets.length-1]+1&&E--,d.positions[E++]=A,d.offsets.push(d.positions.length-1),x=b}}return{positions:d.positions,offsets:d.offsets,tolerance:this._tessellationCache.tolerance}},t.CurveTessellator=a,t.TessellationCache=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cone=void 0;var i=r(1),n=r(4),o=r(0),s=r(12),a=r(6),l=r(7),u=r(14),c=r(2),h=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._radius=0,this._angle=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(h.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.CONE},h.prototype.clone=function(){var e=new h;return e.copy(this),e},h.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._radius=e._radius,this._angle=e._angle,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},h.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},h.prototype.set=function(e,t,r,n,s,a){i.Vector3.copy(this._center,e),c.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._radius=t,c.ConsoleUtils.assert(i.Vector3.squaredLength(r)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,r),c.ConsoleUtils.assert(Math.abs(n)<Math.PI/2),this._angle=n,void 0!==s&&i.Vector3.squaredLength(s)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(c.ConsoleUtils.assert(i.Vector3.isOrthogonal(r,s,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,s)):(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._uScale=a||1,c.ConsoleUtils.assert(this._uScale>o.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},h.prototype.getRadius=function(){return this._radius},h.prototype.setRadius=function(e){c.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._radius=e},h.prototype.getCenter=function(){return this._center},h.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},h.prototype.getAxisDir=function(){return this._zAxis},h.prototype.setAxisDir=function(e){c.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},h.prototype.getUvOriginDir=function(){return this._xAxis},h.prototype.setUvOriginDir=function(e){c.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},h.prototype.getUScale=function(){return this._uScale},h.prototype.setUScale=function(e){c.ConsoleUtils.assert(e>o.PARAMETER_SPACE_TOLERANCE),this._uScale=e},h.prototype.getAngle=function(){return this._angle},h.prototype.setAngle=function(e){c.ConsoleUtils.assert(Math.abs(e)<Math.PI/2-o.KERNEL_ANGULAR_TOLERANCE),this._angle=e},h.prototype.isCylinder=function(){return Math.abs(this._angle)<o.KERNEL_ANGULAR_TOLERANCE},h.prototype.getApexParam=function(){return this.isCylinder()?void 0:-this._radius/(this._uScale*Math.sin(this._angle))},h.prototype.getApexPosition=function(){if(!this.isCylinder()){var e=-this._radius/Math.tan(this._angle),t=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(t,t,this._zAxis,e),t}},h.prototype.evaluatePosition=function(e,t){var r=this._radius+e*this._uScale*Math.sin(this._angle),n=r*Math.cos(t),o=r*Math.sin(t),s=e*this._uScale*Math.cos(this._angle),a=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(a,a,this._xAxis,n),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},h.prototype.evaluateNormal=function(e,t){var r=Math.sin(this._angle),n=Math.cos(this._angle),o=n*Math.cos(t),s=n*Math.sin(t),a=-r,l=i.Vector3.createFloat64();return i.Vector3.scale(l,this._xAxis,o),i.Vector3.scaleAndAdd(l,l,this._yAxis,s),i.Vector3.scaleAndAdd(l,l,this._zAxis,a),l},h.prototype.evaluateDu=function(e,t){var r=this._uScale*Math.sin(this._angle),n=r*Math.cos(t),o=r*Math.sin(t),s=this._uScale*Math.cos(this._angle),a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,n),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},h.prototype.evaluateDv=function(e,t){var r=this._radius+e*this._uScale*Math.sin(this._angle),n=-r*Math.sin(t),o=r*Math.cos(t),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,n),i.Vector3.scaleAndAdd(s,s,this._yAxis,o),s},h.prototype.closestParam=function(e){var t=Math.sin(this._angle),r=Math.cos(this._angle),n=i.Vector3.createFloat64();i.Vector3.sub(n,e,this._center);var s=i.Vector3.dot(n,this._xAxis),a=i.Vector3.dot(n,this._yAxis),l=i.Vector3.dot(n,this._zAxis),u=Math.sqrt(s*s+a*a),c=this.getApexParam();if(void 0!==c){var h=c*this._uScale*r;(h>0&&l>h||h<0&&l<h)&&(s=-s,a=-a,u=-u)}return{u:((u-this._radius)*t+l*r)/this._uScale,v:Math.abs(u)>o.KERNEL_TOLERANCE?Math.atan2(a,s):0}},h.prototype.vParamLine=function(e){var t=this._radius+e*this._uScale*Math.sin(this._angle);if(Math.abs(t)>o.KERNEL_TOLERANCE){var r=new u.Circle,n=i.Vector3.clone(this._center),s=e*this._uScale*Math.cos(this._angle);i.Vector3.scaleAndAdd(n,n,this._zAxis,s);var l=i.Vector3.clone(this._xAxis);i.Vector3.scale(l,l,t);var c=i.Vector3.clone(this._zAxis);return i.Vector3.negate(c,c),r.set(n,c,l),r}return new a.Point(this.getApexPosition())},h.prototype.uParamLine=function(e){var t=new l.Line,r=i.Vector3.clone(this._center),n=this._radius*Math.cos(e),o=this._radius*Math.sin(e);return i.Vector3.scaleAndAdd(r,r,this._xAxis,n),i.Vector3.scaleAndAdd(r,r,this._yAxis,o),t.set(r,this.evaluateDu(0,e)),t},h.prototype.getBoundingBox=function(e,t){if(e){var r=e[0],i=e[1],o=this.vParamLine(r).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new n.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},h.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._radius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},h.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},h.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},h.prototype.isPeriodicUnlimitedU=function(){return!1},h.prototype.isPeriodicUnlimitedV=function(){return!0},h.prototype.isClosedUnlimitedU=function(){return!1},h.prototype.isClosedUnlimitedV=function(){return!0},h.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),radius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),angle:this.getAngle(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Cone=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipticalCone=void 0;var i=r(1),n=r(4),o=r(35),s=r(0),a=r(12),l=r(6),u=r(7),c=r(23),h=r(2),d=function(){a.Surface.call(this),this._center=i.Vector3.createFloat64(),this._majorRadius=0,this._minorRadius=0,this._angle=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(d.prototype=Object.create(a.Surface.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.ELLIPTICAL_CONE},d.prototype.clone=function(){var e=new d;return e.copy(this),e},d.prototype.copy=function(e){a.Surface.prototype.copy.call(this,e),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,this._angle=e._angle,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},d.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},d.prototype.set=function(e,t,r,n,o,a){i.Vector3.copy(this._center,e),this._majorRadius=i.Vector3.length(t),h.ConsoleUtils.assert(this._majorRadius>s.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,t),h.ConsoleUtils.assert(r<=1),this._minorRadius=r*this._majorRadius,h.ConsoleUtils.assert(this._minorRadius>s.KERNEL_TOLERANCE),h.ConsoleUtils.assert(i.Vector3.squaredLength(n)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),h.ConsoleUtils.assert(i.Vector3.isOrthogonal(n,t,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._zAxis,n),h.ConsoleUtils.assert(Math.abs(o)<Math.PI/2),this._angle=o,this._uScale=a||1,h.ConsoleUtils.assert(this._uScale>s.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},d.prototype.getMajorRadius=function(){return this._majorRadius},d.prototype.setMajorRadius=function(e){h.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._majorRadius=e},d.prototype.getMinorRadius=function(){return this._minorRadius},d.prototype.setMinorRadius=function(e){h.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._minorRadius=e},d.prototype.getMajorAxis=function(){return this._xAxis},d.prototype.setMajorAxis=function(e){h.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},d.prototype.getCenter=function(){return this._center},d.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},d.prototype.getAxisDir=function(){return this._zAxis},d.prototype.setAxisDir=function(e){h.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),this._computeYAxis()},d.prototype.getUScale=function(){return this._uScale},d.prototype.setUScale=function(e){h.ConsoleUtils.assert(e>s.PARAMETER_SPACE_TOLERANCE),this._uScale=e},d.prototype.getAngle=function(){return this._angle},d.prototype.setAngle=function(e){h.ConsoleUtils.assert(Math.abs(e)<Math.PI/2-s.KERNEL_ANGULAR_TOLERANCE),this._angle=e},d.prototype.isCylinder=function(){return Math.abs(this._angle)<s.KERNEL_ANGULAR_TOLERANCE},d.prototype.getApexParam=function(){return this.isCylinder()?void 0:-this._majorRadius/(this._uScale*Math.sin(this._angle))},d.prototype.getApexPosition=function(){if(!this.isCylinder()){var e=-this._majorRadius/Math.tan(this._angle),t=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(t,t,this._zAxis,e),t}},d.prototype.evaluatePosition=function(e,t){var r=1+e*this._uScale*Math.sin(this._angle)/this._majorRadius,n=r*this._majorRadius*Math.cos(t),o=r*this._minorRadius*Math.sin(t),s=e*this._uScale*Math.cos(this._angle),a=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(a,a,this._xAxis,n),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},d.prototype.evaluateNormal=function(e,t){var r=Math.cos(this._angle),n=r*this._minorRadius*Math.cos(t),o=r*this._majorRadius*Math.sin(t),s=-Math.sin(this._angle)*this._minorRadius,a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,n),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),i.Vector3.normalize(a,a),a},d.prototype.evaluateDu=function(e,t){var r=this._uScale*Math.sin(this._angle)/this._majorRadius,n=r*this._majorRadius*Math.cos(t),o=r*this._minorRadius*Math.sin(t),s=this._uScale*Math.cos(this._angle),a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,n),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},d.prototype.evaluateDv=function(e,t){var r=1+e*this._uScale*Math.sin(this._angle)/this._majorRadius,n=-r*this._majorRadius*Math.sin(t),o=r*this._minorRadius*Math.cos(t),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,n),i.Vector3.scaleAndAdd(s,s,this._yAxis,o),s},d.prototype.closestParam=function(e){var t,r;if(this.isCylinder()){var n=i.Vector3.createFloat64();i.Vector3.sub(n,e,this._center),t=i.Vector3.dot(n,this._zAxis)/this._uScale,r=this.vParamLine(t).closestToPointParam(e)}else{var a=i.Vector3.createFloat64();i.Vector3.sub(a,e,this.getApexPosition());var l=i.Vector3.dot(a,this._xAxis),u=i.Vector3.dot(a,this._yAxis),c=i.Vector3.dot(a,this._zAxis),h=this._uScale*Math.sin(this._angle),d=h*this._minorRadius/this._majorRadius,p=this._uScale*Math.cos(this._angle),f=this._majorRadius/h,g=function(e,t,r,n,a,l){if(n*n+a*a+l*l<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE)return{u:0,v:0};var u=i.FLOAT64_TOLERANCE,c=l*e>=0?1:-1,h=(n*c>=0?.25:.75)*(a*c>=0?1:-1),d=h*Math.PI,p=[(h-.25)*Math.PI,(h+.25)*Math.PI],f=(0,o.newtonRaphson1D)((function(i){var o=Math.sin(i),s=Math.cos(i),u=e*(t*t+r*r)*n,c=t*(e*e+r*r)*a,h=r*(e*e-t*t)*l;return{val:u*o-c*s-h*o*s,deriv:u*s+c*o-h*(s*s-o*o)}}),p,d,u,32),g=e*Math.cos(f),v=t*Math.sin(f);return{u:(g*n+v*a+r*l)/(g*g+v*v+r*r),v:f}}(h,d,p,l,u,c);t=g.u-f,r=g.v}return{u:t,v:r}},d.prototype.vParamLine=function(e){var t=this._majorRadius+e*this._uScale*Math.sin(this._angle);if(Math.abs(t)>s.KERNEL_TOLERANCE){var r=new c.Ellipse,n=i.Vector3.clone(this._center),o=e*this._uScale*Math.cos(this._angle);i.Vector3.scaleAndAdd(n,n,this._zAxis,o);var a=i.Vector3.clone(this._xAxis);i.Vector3.scale(a,a,t);var u=i.Vector3.clone(this._zAxis);return i.Vector3.negate(u,u),r.set(n,u,a,this._minorRadius/this._majorRadius),r}return new l.Point(this.getApexPosition())},d.prototype.uParamLine=function(e){var t=new u.Line,r=i.Vector3.clone(this._center),n=this._majorRadius*Math.cos(e),o=this._minorRadius*Math.sin(e);return i.Vector3.scaleAndAdd(r,r,this._xAxis,n),i.Vector3.scaleAndAdd(r,r,this._yAxis,o),t.set(r,this.evaluateDu(0,e)),t},d.prototype.getBoundingBox=function(e,t){if(e){var r=e[0],i=e[1],o=this.vParamLine(r).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new n.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},d.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._majorRadius*=t,this._minorRadius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},d.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},d.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},d.prototype.isPeriodicUnlimitedU=function(){return!1},d.prototype.isPeriodicUnlimitedV=function(){return!0},d.prototype.isClosedUnlimitedU=function(){return!1},d.prototype.isClosedUnlimitedV=function(){return!0},d.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),majorRadius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),radiusRatio:this.getMinorRadius()/this.getMajorRadius(),angle:this.getAngle(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.EllipticalCone=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BSurface=void 0;var i=r(1),n=r(4),o=r(0),s=r(12),a=r(33),l=r(3),u=r(76),c=r(103),h=r(104),d=r(105),p=r(77),f=r(2),g=function(){s.Surface.call(this),this._uDegree=0,this._vDegree=0,this._uKnots=[],this._vKnots=[],this._controlPoints=[],this._weights=[],this._isClosedU=void 0,this._isClosedV=void 0,this._isPeriodicU=void 0,this._isPeriodicV=void 0,this._patches=void 0};(g.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.BSURFACE},g.prototype.clone=function(){var e=new g;return e.copy(this),e},g.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._uDegree=e._uDegree,this._vDegree=e._vDegree,this._uKnots=e._uKnots.slice(0),this._vKnots=e._vKnots.slice(0),this._controlPoints=e._controlPoints.slice(0),this._weights=e._weights.slice(0),this._clearCaches()},g.prototype.set=function(e,t,r,i,n,o){f.ConsoleUtils.assert(e>=1),this._uDegree=e,f.ConsoleUtils.assert(t>=1),this._vDegree=t,f.ConsoleUtils.assert(r.length>=2*(e+1)),this._uKnots=Array.prototype.slice.call(r),f.ConsoleUtils.assert(i.length>=2*(t+1)),this._vKnots=Array.prototype.slice.call(i);var s=r.length-e-1,a=i.length-t-1;f.ConsoleUtils.assert(n.length===3*s*a),this._controlPoints=Array.prototype.slice.call(n),o&&o.length>0?(f.ConsoleUtils.assert(o.length===s*a),this._weights=Array.prototype.slice.call(o)):this._weights=[],this._clearCaches()},g.prototype.getDegreeU=function(){return this._uDegree},g.prototype.getDegreeV=function(){return this._vDegree},g.prototype.setDegreeU=function(e){f.ConsoleUtils.assert(e>=1),this._uDegree=e,this._clearCaches()},g.prototype.setDegreeV=function(e){f.ConsoleUtils.assert(e>=1),this._vDegree=e,this._clearCaches()},g.prototype.getNumKnotsU=function(){return this._uKnots.length},g.prototype.getNumKnotsV=function(){return this._vKnots.length},g.prototype.getKnotsU=function(){return this._uKnots},g.prototype.getKnotsV=function(){return this._vKnots},g.prototype.setKnotsU=function(e){this._uKnots=e,this._clearCaches()},g.prototype.setKnotsV=function(e){this._vKnots=e,this._clearCaches()},g.prototype.getNumControlPointsU=function(){return this._uKnots.length-this._uDegree-1},g.prototype.getNumControlPointsV=function(){return this._vKnots.length-this._vDegree-1},g.prototype.getControlPoints=function(){return this._controlPoints},g.prototype.setControlPoints=function(e){this._controlPoints=e,this._clearCaches()},g.prototype.getWeights=function(){return this._weights},g.prototype.setWeights=function(e){e&&e.length>0?this._weights=e:this._weights=[],this._clearCaches()},g.prototype.isRational=function(){return this._weights.length>0},g.prototype.evaluate=function(e,t,r,i,n){f.ConsoleUtils.assert(r>=0),this.isPeriodicUnlimitedU()&&(e=(0,l.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,l.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV()));var o=(0,u.evaluateBSurfaceDerivs)(e,t,Math.min(r,3),this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights),s={pos:o[0][0]};return r>=1&&(s.du=o[1][0],s.dv=o[0][1]),r>=2&&(s.duu=o[2][0],s.duv=o[1][1],s.dvv=o[0][2]),r>=3&&(s.duuu=o[3][0],s.duuv=o[2][1],s.duvv=o[1][2],s.dvvv=o[0][3]),s},g.prototype.evaluatePosition=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,l.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,l.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),(0,u.evaluateBSurfacePoint)(e,t,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights)},g.prototype.evaluateNormal=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,l.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,l.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),s.Surface.prototype.evaluateNormal.call(this,e,t)},g.prototype.evaluateDu=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,l.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,l.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),(0,u.evaluateBSurfaceDerivs)(e,t,1,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights)[1][0]},g.prototype.evaluateDv=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,l.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,l.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),(0,u.evaluateBSurfaceDerivs)(e,t,1,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights)[0][1]},g.prototype.insertKnotU=function(e,t){var r=(0,c.insertBSurfaceKnotU)(e,t,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights);this._uKnots=r.uknots,this._controlPoints=r.P,this._weights=r.weights||[],this._clearCaches()},g.prototype.insertKnotV=function(e,t){var r=(0,c.insertBSurfaceKnotV)(e,t,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights);this._vKnots=r.vknots,this._controlPoints=r.P,this._weights=r.weights||[],this._clearCaches()},g.prototype.relaxToPerpendicular=function(e,t,r,n,o,s,a){var l=this;n&&0!==n.length||(n=this.getRangeU()),o&&0!==o.length||(o=this.getRangeV());var u=(0,p.newtonRaphson2D)((function(t){var r=l.evaluate(t[0],t[1],2);i.Vector3.sub(r.pos,r.pos,e);var n=i.Vector3.dot(r.du,r.pos),o=i.Vector3.dot(r.dv,r.pos),s=i.Vector3.dot(r.duu,r.pos)+i.Vector3.dot(r.du,r.du),a=i.Vector3.dot(r.duv,r.pos)+i.Vector3.dot(r.du,r.dv);return{val:[n,o],deriv1:[s,a],deriv2:[a,i.Vector3.dot(r.dvv,r.pos)+i.Vector3.dot(r.dv,r.dv)]}}),[t,r],[n,o]);return{u:u.param[0],v:u.param[1],status:u.status}},g.prototype.closestParam=function(e){for(var t=i.FLOAT64_TOLERANCE,r=[[this.getRangeU(),this.getRangeV()]],n=this.getBezierPatches(),o=(0,d.closestBSurfacePatches)(e,n,r),s=Number.POSITIVE_INFINITY,a={u:void 0,v:void 0},u=0;u<o.length;++u)if(!(o[u].minDistSqr>s))for(var c=o[u].index,h=n[c[0]][c[1]],p=h.getRangeUnlimitedU(),f=h.getRangeUnlimitedV(),g=0;g<r.length;++g){var v=[Math.max(p[0],r[g][0][0]),Math.min(p[1],r[g][0][1])],y=[Math.max(f[0],r[g][1][0]),Math.min(f[1],r[g][1][1])];if(!(v[1]-v[0]<=i.FLOAT64_TOLERANCE||y[1]-y[0]<=i.FLOAT64_TOLERANCE)){var m=(0,d.closestBSurfacePointApprox)(e,h.getDegreeU(),h.getDegreeV(),h.getKnotsU(),h.getKnotsV(),h.getControlPoints(),h.isRational()?h.getWeights():void 0,v,y),_=this.relaxToPerpendicular(e,m.u,m.v,v,y,t,64),E=h.evaluatePosition(_.u,_.v),x=i.Vector3.squaredDistance(E,e);x<s&&(s=x,a.u=_.u,a.v=_.v)}}return this.isPeriodicUnlimitedU()&&(a.u=(0,l.foldNearTo)(a.u,.5*(this.getRangeU()[0]+this.getRangeU()[1]),this.getPeriodUnlimitedU())),this.isPeriodicUnlimitedV()&&(a.v=(0,l.foldNearTo)(a.v,.5*(this.getRangeV()[0]+this.getRangeV()[1]),this.getPeriodUnlimitedV())),a},g.prototype.vParamLine=function(e){var t=(0,c.extractBSurfaceParamLineV)(e,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights),r=t.ctrlPts.length/3;t.weights&&0!==t.weights.length||(t.weights=new Array(r),t.weights.fill(1));var i=new a.BCurve;return i.set(t.ctrlPts,t.weights,this._vDegree,this._vKnots),i},g.prototype.uParamLine=function(e){var t=(0,c.extractBSurfaceParamLineU)(e,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights),r=t.ctrlPts.length/3;t.weights&&0!==t.weights.length||(t.weights=new Array(r),t.weights.fill(1));var i=new a.BCurve;return i.set(t.ctrlPts,t.weights,this._uDegree,this._uKnots),i},g.prototype.getBoundingBox=function(e,t){for(var r=new n.BoundingBox,o=i.Vector3.createFloat64(),s=0;s<this._controlPoints.length;s+=3)i.Vector3.set(o,this._controlPoints[s],this._controlPoints[s+1],this._controlPoints[s+2]),r.includePoint(o);return r},g.prototype.transform=function(e){for(var t=i.Vector3.createFloat64(),r=0;r<this._controlPoints.length;r+=3)i.Vector3.set(t,this._controlPoints[r],this._controlPoints[r+1],this._controlPoints[r+2]),i.Vector3.transformMatrix44(t,t,e),this._controlPoints[r]=t[0],this._controlPoints[r+1]=t[1],this._controlPoints[r+2]=t[2];this._clearCaches()},g.prototype.getRangeUnlimitedU=function(){return[this._uKnots[0],this._uKnots[this._uKnots.length-1]]},g.prototype.getRangeUnlimitedV=function(){return[this._vKnots[0],this._vKnots[this._vKnots.length-1]]},g.prototype.isPeriodicUnlimitedU=function(){return this._checkClosure(),this._isPeriodicU},g.prototype.isPeriodicUnlimitedV=function(){return this._checkClosure(),this._isPeriodicV},g.prototype.isClosedUnlimitedU=function(){return this._checkClosure(),this._isClosedU},g.prototype.isClosedUnlimitedV=function(){return this._checkClosure(),this._isClosedV},g.prototype._checkClosure=function(){void 0!==this._isClosedU&&void 0!==this._isPeriodicU||(this._isClosedU=this._isPeriodicU=!1),void 0!==this._isClosedV&&void 0!==this._isPeriodicV||(this._isClosedV=this._isPeriodicV=!1)},g.prototype.isSimpleBezier=function(){return this._uKnots.length===2*this._uDegree+2&&this._vKnots.length===2*this._vDegree+2},g.prototype.getBezierPatches=function(){if(this.isSimpleBezier())return this._patches=void 0,[[this]];if(!this._patches){var e=(0,h.decomposeBSurfaceToBezier)(this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights);this._patches=[];for(var t=0;t<e.U.length;++t){this._patches[t]=[];for(var r=0;r<e.V.length;++r){var i=new g;i.set(this._uDegree,this._vDegree,e.U[t],e.V[r],e.P[t][r],e.w?e.w[t][r]:void 0),this._patches[t][r]=i}}}return this._patches},g.prototype._clearCaches=function(){this._isClosedU=void 0,this._isClosedV=void 0,this._isPeriodicU=void 0,this._isPeriodicV=void 0,this._patches=void 0},g.prototype.toObject=function(){return{uDegree:this._uDegree,vDegree:this._vDegree,uKnots:this._uKnots,vKnots:this._vKnots,controlPoints:this._controlPoints,weights:this._weights,uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.BSurface=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WireBody=void 0;var i=r(9),n=r(0),o=r(4),s=r(19),a=function(){i.BaseTopology.call(this),this._wires=[]};(a.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return n.TOPOLOGY_TYPES.WIREBODY},a.prototype.getWires=function(){return this._wires},a.prototype.setWires=function(e){this._wires=new Array(e.length);for(var t=0;t<e.length;++t)this._wires[t]=e[t]},a.prototype.addWire=function(e){this._wires?this._wires.push(e):this._wires=[e],e.setWireBody(this)},a.prototype.addWires=function(e){this._wires||(this._wires=[]);for(var t=0;t<e.length;++t)e[t].setWireBody(this);this._wires=this._wires.concat(e)},a.prototype.removeWire=function(e){var t=this._wires.indexOf(e);return t>-1&&(this._wires.splice(t,1),e.getWireBody()===this&&e.setWireBody(void 0),!0)},a.prototype.getBody=function(){return this},a.prototype.collectFaces=function(e){return e||new Set},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._wires.length;++t)this._wires[t].collectEdges(e);return e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._wires.length;++t)this._wires[t].collectVertices(e);return e},a.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._wires.length;++t)e.include(this._wires[t].getBoundingBox());return e},a.prototype.transform=function(e){(0,s.transformTopology)(this,e)},a.prototype.toString=function(){return"WireBody"},a.prototype.toObject=function(){return{wires:this.refsToStrings(this._wires),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._wires,this._attributes])},t.WireBody=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TopologyCloner=void 0;var i=r(16),n=r(20),o=r(27),s=r(13),a=r(15),l=r(26),u=r(25),c=r(24),h=r(41),d=function(){this._edgeMap={},this._vertexMap={},this._coedgeMap={},this._progenitorMap=new h.ProgenitorMap};d.prototype.cloneVertex=function(e){var t=this._vertexMap[e.getGuid()];return t||(t=new i.Vertex(e.getPoint().clone()),this._vertexMap[e.getGuid()]=t,t.setPrecision(e.getPrecision()),this._progenitorMap.addEntry(t,[e])),t},d.prototype.cloneEdge=function(e){var t=this._edgeMap[e.getGuid()];return t||(t=new n.Edge(e.getCurve().clone()),this._edgeMap[e.getGuid()]=t,t.setReversed(e.isReversed()),t.setRange(e.getRange()),t.setStartVertex(this.cloneVertex(e.getStartVertex())),t.setEndVertex(this.cloneVertex(e.getEndVertex())),t.setPrecision(e.getPrecision()),this._progenitorMap.addEntry(t,[e])),t},d.prototype.cloneCoedge=function(e){var t,r,i=new o.Coedge;this._coedgeMap[e.getGuid()]=i,i.setReversed(e.isReversed()),i.setEdge(this.cloneEdge(e.getEdge())),i.getEdge().setCoedge(i);for(var n=e.getPartner();n;){var s=this._coedgeMap[n.getGuid()];s&&(t||(t=s),r=s,e.getEdge().getCoedge()===n&&i.getEdge().setCoedge(s)),(n=n.getPartner())===e&&(n=void 0)}return t&&r&&(i.setPartner(t),r.setPartner(i)),this._progenitorMap.addEntry(i,[e]),i},d.prototype.cloneLoop=function(e){for(var t=new s.Loop,r=e.getCoedges(),i=new Array(r.length),n=0;n<r.length;++n)i[n]=this.cloneCoedge(r[n]);return t.addCoedges(i),this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneFace=function(e){for(var t=new a.Face,r=e.getLoops(),i=new Array(r.length),n=0;n<r.length;++n)i[n]=this.cloneLoop(r[n]);return t.addLoops(i),t.setSurface(e.getSurface().clone()),t.setReversed(e.isReversed()),this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneFaces=function(e){for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=this.cloneFace(e[r]);return t},d.prototype.cloneShell=function(e){var t=new l.Shell;return t.addFaces(this.cloneFaces(e.getFaces())),this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneLump=function(e){for(var t=new u.Lump,r=e.getShells(),i=0;i<r.length;++i)t.addShell(this.cloneShell(r[i]));return this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneBody=function(e){for(var t=new c.Body,r=e.getLumps(),i=0;i<r.length;++i)t.addLump(this.cloneLump(r[i]));return this._progenitorMap.addEntry(t,[e]),t},d.prototype.getProgenitorMap=function(){return this._progenitorMap},t.TopologyCloner=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(t<1)return"";for(var r="";t>1;)1&t&&(r+=e),t>>=1,e+=e;return r+e},n={isInitialized:!1,rngA:4027999010,rngB:3993266363,rngC:3605298456,rotl32:function(e,t){return(e<<t>>>0|e>>>32-t)>>>0},initialize:function(e,t){return n.isInitialized&&!t?0:(n.isInitialized&&(n.rngA=4027999010,n.rngB=3993266363,n.rngC=3605298456),n.isInitialized=!0,void 0!==e?r=e:(r=(new Date).getTime(),r^=Math.floor(2147483647*Math.random()+1)),n.rngA+=2097151&r,n.rngB+=r>>7&524287,n.rngC+=r>>13,r);var r},genRandUInt32:function(){return n.rngA=~(2911329625*n.rngA),n.rngA=n.rotl32(n.rngA,17),n.rngB=4031235431*n.rngB,n.rngB=n.rotl32(n.rngB,15),n.rngC=3286325185-n.rotl32(n.rngC,19),n.rngA+n.rngB^n.rngC}},o=function(e){for(var t="",r=0;r<4;r++){var n=e[r].toString(16);t+=i("0",8-n.length)+n}return t.substr(0,8)+"-"+t.substr(8,4)+"-"+t.substr(12,4)+"-"+t.substr(16,4)+"-"+t.substr(20,12)},s=function(e,t){var r=t;return void 0===r&&(r=new Uint32Array(4)),r[0]=parseInt("0x"+e.substr(0,8),16),r[1]=parseInt("0x"+e.substr(9,4)+e.substr(14,4),16),r[2]=parseInt("0x"+e.substr(19,4)+e.substr(24,4),16),r[3]=parseInt("0x"+e.substr(28,8),16),r},a=function(e,t){var r=new Uint32Array(t);return r[0]+=2654435769,r[1]+=104395303,r[2]+=452930477,r[3]+=982451653,r[0]+=e[3]<<6,r[1]+=e[0]<<6,r[2]+=e[1]<<6,r[3]+=e[2]<<6,r[0]+=e[2]>>2,r[1]+=e[3]>>2,r[2]+=e[0]>>2,r[3]+=e[1]>>2,r[0]=16777619*(r[0]^e[1])>>>0,r[1]=16777619*(r[1]^e[2])>>>0,r[2]=16777619*(r[2]^e[3])>>>0,r[3]=16777619*(r[3]^e[0])>>>0,r};n.initialize(),t.uint32x4ToGUID=o,t.guidToUint32x4=s,t.generateGUID=function(){var e=new Uint32Array(4);return e[0]=n.genRandUInt32(),e[1]=n.genRandUInt32(),e[2]=n.genRandUInt32(),e[3]=n.genRandUInt32(),o(e)},t.isGUID=function(e){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)},t.combineGuids=function(e,t){var r=s(e),i=s(t),n=a(r,i);return o(n)},t.hashCombine4xUint32=a},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==("undefined"==typeof window?"undefined":_typeof(window))&&(r=window)}e.exports=r},function(e,t,r){"use strict";e.exports=function(e,t){for(var r=new Array(arguments.length-1),i=0,n=2,o=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise((function(n,s){r[i]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];n.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,s(e))}}))}},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){"use strict";t.Service=r(98)},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";e.exports=function(e){for(var t,r=o.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),a=e.fieldsArray.slice().sort(o.compareFieldsById),l=0;l<a.length;++l){var u=a[l].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof i?"int32":u.type,d=n.basic[h];t="m"+o.safeProp(u.name),u.map?(r("if(%s!=null&&m.hasOwnProperty(%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|n.mapKey[u.keyType],u.keyType),void 0===d?r("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,t):r(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,t),r("}")("}")):u.repeated?(r("if(%s!=null&&%s.length){",t,t),u.packed&&void 0!==n.packed[h]?r("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",h,t)("w.ldelim()"):(r("for(var i=0;i<%s.length;++i)",t),void 0===d?s(r,u,c,t+"[i]"):r("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,t)),r("}")):(u.optional&&r("if(%s!=null&&m.hasOwnProperty(%j))",t,u.name),void 0===d?s(r,u,c,t):r("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,t))}return r("return w")};var i=r(11),n=r(31),o=r(5);function s(e,t,r,i){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,i,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,i,(t.id<<3|2)>>>0)}},function(e,t,r){"use strict";e.exports=m;var i=r(30);((m.prototype=Object.create(i.prototype)).constructor=m).className="Type";var n=r(11),o=r(48),s=r(22),a=r(64),l=r(65),u=r(49),c=r(47),h=r(46),d=r(5),p=r(62),f=r(67),g=r(68),v=r(69),y=r(70);function m(e,t){i.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function _(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(m.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],i=r.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=m.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var i={};for(r=0;r<this.oneofsArray.length;++r)i[this._oneofsArray[r].resolve().name]={get:d.oneOfGetter(this._oneofsArray[r].oneof),set:d.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,i)}}}),m.generateConstructor=function(e){for(var t,r=d.codegen(["p"],e.name),i=0;i<e.fieldsArray.length;++i)(t=e._fieldsArray[i]).map?r("this%s={}",d.safeProp(t.name)):t.repeated&&r("this%s=[]",d.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},m.fromJSON=function(e,t){var r=new m(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)r.add((void 0!==t.fields[u[c]].keyType?a.fromJSON:s.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)r.add(o.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];r.add((void 0!==h.id?s.fromJSON:void 0!==h.fields?m.fromJSON:void 0!==h.values?n.fromJSON:void 0!==h.methods?l.fromJSON:i.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r},m.prototype.toJSON=function(e){var t=i.prototype.toJSON.call(this,e),r=!!e&&Boolean(e.keepComments);return d.toObject(["options",t&&t.options||void 0,"oneofs",i.arrayToJSON(this.oneofsArray,e),"fields",i.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},m.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return i.prototype.resolveAll.call(this)},m.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},m.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof s&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),_(this)}return e instanceof o?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),_(this)):i.prototype.add.call(this,e)},m.prototype.remove=function(e){if(e instanceof s&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),_(this)}if(e instanceof o){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),_(this)}return i.prototype.remove.call(this,e)},m.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},m.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)},m.prototype.create=function(e){return new this.ctor(e)},m.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=p(this)({Writer:h,types:t,util:d}),this.decode=f(this)({Reader:c,types:t,util:d}),this.verify=g(this)({types:t,util:d}),this.fromObject=v.fromObject(this)({types:t,util:d}),this.toObject=v.toObject(this)({types:t,util:d});var i=y[e];if(i){var n=Object.create(this);n.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(n),n.toObject=this.toObject,this.toObject=i.toObject.bind(n)}return this},m.prototype.encode=function(e,t){return this.setup().encode(e,t)},m.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},m.prototype.decode=function(e,t){return this.setup().decode(e,t)},m.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},m.prototype.verify=function(e){return this.setup().verify(e)},m.prototype.fromObject=function(e){return this.setup().fromObject(e)},m.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},m.d=function(e){return function(t){d.decorateType(t,e)}}},function(e,t,r){"use strict";e.exports=s;var i=r(22);((s.prototype=Object.create(i.prototype)).constructor=s).className="MapField";var n=r(31),o=r(5);function s(e,t,r,n,s,a){if(i.call(this,e,t,n,void 0,void 0,s,a),!o.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}s.fromJSON=function(e,t){return new s(e,t.id,t.keyType,t.type,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},s.prototype.resolve=function(){if(this.resolved)return this;if(void 0===n.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return i.prototype.resolve.call(this)},s.d=function(e,t,r){return"function"==typeof r?r=o.decorateType(r).name:r&&"object"==_typeof(r)&&(r=o.decorateEnum(r).name),function(i,n){o.decorateType(i.constructor).add(new s(n,e,t,r))}}},function(e,t,r){"use strict";e.exports=a;var i=r(30);((a.prototype=Object.create(i.prototype)).constructor=a).className="Service";var n=r(66),o=r(5),s=r(60);function a(e,t){i.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}a.fromJSON=function(e,t){var r=new a(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),o=0;o<i.length;++o)r.add(n.fromJSON(i[o],t.methods[i[o]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r},a.prototype.toJSON=function(e){var t=i.prototype.toJSON.call(this,e),r=!!e&&Boolean(e.keepComments);return o.toObject(["options",t&&t.options||void 0,"methods",i.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=o.toArray(this.methods))}}),a.prototype.get=function(e){return this.methods[e]||i.prototype.get.call(this,e)},a.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return i.prototype.resolve.call(this)},a.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof n?(this.methods[e.name]=e,e.parent=this,l(this)):i.prototype.add.call(this,e)},a.prototype.remove=function(e){if(e instanceof n){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return i.prototype.remove.call(this,e)},a.prototype.create=function(e,t,r){for(var i,n=new s.Service(e,t,r),a=0;a<this.methodsArray.length;++a){var l=o.lcFirst((i=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");n[l]=o.codegen(["r","c"],o.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:i,q:i.resolvedRequestType.ctor,s:i.resolvedResponseType.ctor})}return n}},function(e,t,r){"use strict";e.exports=o;var i=r(21);((o.prototype=Object.create(i.prototype)).constructor=o).className="Method";var n=r(5);function o(e,t,r,o,s,a,l,u){if(n.isObject(s)?(l=s,s=a=void 0):n.isObject(a)&&(l=a,a=void 0),void 0!==t&&!n.isString(t))throw TypeError("type must be a string");if(!n.isString(r))throw TypeError("requestType must be a string");if(!n.isString(o))throw TypeError("responseType must be a string");i.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!s||void 0,this.responseType=o,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u}o.fromJSON=function(e,t){return new o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return n.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),i.prototype.resolve.call(this))}},function(e,t,r){"use strict";e.exports=function(e){var t=o.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var r=0;r<e.fieldsArray.length;++r){var a=e._fieldsArray[r].resolve(),l=a.resolvedType instanceof i?"int32":a.type,u="m"+o.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",u)("%s={}",u)("k=r.%s()",a.keyType)("r.pos++"),void 0!==n.long[a.keyType]?void 0===n.basic[l]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',u,r):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',u,l):void 0===n.basic[l]?t("%s[k]=types[%i].decode(r,r.uint32())",u,r):t("%s[k]=r.%s()",u,l)):a.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==n.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===n.basic[l]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,l)):void 0===n.basic[l]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,l),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var c=e._fieldsArray[r];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",s(c))}return t("return m")};var i=r(11),n=r(31),o=r(5);function s(e){return"missing required '"+e.name+"'"}},function(e,t,r){"use strict";e.exports=function(e){var t=n.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r={};e.oneofsArray.length&&t("var p={}");for(var i=0;i<e.fieldsArray.length;++i){var l=e._fieldsArray[i].resolve(),u="m"+n.safeProp(l.name);if(l.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,l.name),l.map)t("if(!util.isObject(%s))",u)("return%j",o(l,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),a(t,l,"k[i]"),s(t,l,i,u+"[k[i]]")("}");else if(l.repeated)t("if(!Array.isArray(%s))",u)("return%j",o(l,"array"))("for(var i=0;i<%s.length;++i){",u),s(t,l,i,u+"[i]")("}");else{if(l.partOf){var c=n.safeProp(l.partOf.name);1===r[l.partOf.name]&&t("if(p%s===1)",c)("return%j",l.partOf.name+": multiple values"),r[l.partOf.name]=1,t("p%s=1",c)}s(t,l,i,u)}l.optional&&t("}")}return t("return null")};var i=r(11),n=r(5);function o(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function s(e,t,r,n){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(%s){",n)("default:")("return%j",o(t,"enum value"));for(var s=Object.keys(t.resolvedType.values),a=0;a<s.length;++a)e("case %i:",t.resolvedType.values[s[a]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,n)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",n)("return%j",o(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",n,n,n,n)("return%j",o(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',n)("return%j",o(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',n)("return%j",o(t,"boolean"));break;case"string":e("if(!util.isString(%s))",n)("return%j",o(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',n,n,n)("return%j",o(t,"buffer"))}return e}function a(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",o(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",o(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",o(t,"boolean key"))}return e}},function(e,t,r){"use strict";var i=t,n=r(11),o=r(5);function s(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(d%s){",i);for(var o=t.resolvedType.values,s=Object.keys(o),a=0;a<s.length;++a)t.repeated&&o[s[a]]===t.typeDefault&&e("default:"),e("case%j:",s[a])("case %i:",o[s[a]])("m%s=%j",i,o[s[a]])("break");e("}")}else e('if(typeof d%s!=="object")',i)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,r,i);else{var l=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",i,i);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,l)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,l?"true":"");break;case"bytes":e('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length)",i)("m%s=d%s",i,i);break;case"string":e("m%s=String(d%s)",i,i);break;case"bool":e("m%s=Boolean(d%s)",i,i)}}return e}function a(e,t,r,i){if(t.resolvedType)t.resolvedType instanceof n?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",i,r,i,i):e("d%s=types[%i].toObject(m%s,o)",i,r,i);else{var o=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,o?"true":"",i);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:e("d%s=m%s",i,i)}}return e}i.fromObject=function(e){var t=e.fieldsArray,r=o.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var a=t[i].resolve(),l=o.safeProp(a.name);a.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),s(r,a,i,l+"[ks[i]]")("}")("}")):a.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),s(r,a,i,l+"[i]")("}")("}")):(a.resolvedType instanceof n||r("if(d%s!=null){",l),s(r,a,i,l),a.resolvedType instanceof n||r("}"))}return r("return m")},i.toObject=function(e){var t=e.fieldsArray.slice().sort(o.compareFieldsById);if(!t.length)return o.codegen()("return {}");for(var r=o.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?i:t[u].map?s:l).push(t[u]);if(i.length){for(r("if(o.arrays||o.defaults){"),u=0;u<i.length;++u)r("d%s=[]",o.safeProp(i[u].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),u=0;u<s.length;++u)r("d%s={}",o.safeProp(s[u].name));r("}")}if(l.length){for(r("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=o.safeProp(c.name);if(c.resolvedType instanceof n)r("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else r("d%s=%j",h,c.typeDefault)}r("}")}var p=!1;for(u=0;u<t.length;++u){c=t[u];var f=e._fieldsArray.indexOf(c);h=o.safeProp(c.name),c.map?(p||(p=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),a(r,c,f,h+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),a(r,c,f,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),a(r,c,f,h),c.partOf&&r("if(o.oneofs)")("d%s=%j",o.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}},function(e,t,r){"use strict";var i=t,n=r(49);i[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=this.lookup(e["@type"]);if(t){var r="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return this.create({type_url:"/"+r,value:t.encode(t.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){if(t&&t.json&&e.type_url&&e.value){var r=e.type_url.substring(e.type_url.lastIndexOf("/")+1),i=this.lookup(r);i&&(e=i.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof n){var o=e.$type.toObject(e,t);return o["@type"]=e.$type.fullName,o}return this.toObject(e,t)}}},function(e,t,r){"use strict";e.exports=h;var i=r(30);((h.prototype=Object.create(i.prototype)).constructor=h).className="Root";var n,o,s,a=r(22),l=r(11),u=r(48),c=r(5);function h(e){i.call(this,"",e),this.deferred=[],this.files=[]}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},h.prototype.resolvePath=c.path.resolve,h.prototype.load=function e(t,r,i){"function"==typeof r&&(i=r,r=void 0);var n=this;if(!i)return c.asPromise(e,n,t,r);var a=i===d;function l(e,t){if(i){var r=i;if(i=null,a)throw e;r(e,t)}}function u(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){o.filename=e;var i,s=o(t,n,r),u=0;if(s.imports)for(;u<s.imports.length;++u)(i=n.resolvePath(e,s.imports[u]))&&h(i);if(s.weakImports)for(u=0;u<s.weakImports.length;++u)(i=n.resolvePath(e,s.weakImports[u]))&&h(i,!0)}else n.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}a||p||l(null,n)}function h(e,t){var r=e.lastIndexOf("google/protobuf/");if(r>-1){var o=e.substring(r);o in s&&(e=o)}if(!(n.files.indexOf(e)>-1))if(n.files.push(e),e in s)a?u(e,s[e]):(++p,setTimeout((function(){--p,u(e,s[e])})));else if(a){var h;try{h=c.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||l(e))}u(e,h)}else++p,c.fetch(e,(function(r,o){--p,i&&(r?t?p||l(null,n):l(r):u(e,o))}))}var p=0;c.isString(t)&&(t=[t]);for(var f,g=0;g<t.length;++g)(f=n.resolvePath("",t[g]))&&h(f);if(a)return n;p||l(null,n)},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return i.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function f(e,t){var r=t.parent.lookup(t.extend);if(r){var i=new a(t.fullName,t.id,t.type,t.rule,void 0,t.options);return i.declaringField=t,t.extensionField=i,r.add(i),!0}return!1}h.prototype._handleAdd=function(e){if(e instanceof a)void 0===e.extend||e.extensionField||f(0,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof n)for(var t=0;t<this.deferred.length;)f(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);p.test(e.name)&&(e.parent[e.name]=e)}},h.prototype._handleRemove=function(e){if(e instanceof a){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof i){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);p.test(e.name)&&delete e.parent[e.name]}},h._configure=function(e,t,r){n=e,o=t,s=r}},function(e,t,r){"use strict";function i(e,t,r,i,n,o){n[0]=o.b=i[0],n[1]=o.a=-t*o.b+i[1];for(var s=2;s<e;s++)n[s]=-(t*o.a+r*o.b)+i[s],o.b=o.a,o.a=n[s]}function n(e,t,r,n,o,s,a,l,u){var c=new Object,h=3;return c.b=c.a=0,i(t,a,l,s,u,c),o.c=c.a,o.d=c.b,Math.abs(o.c)<=100*e*Math.abs(s[t-1])&&Math.abs(o.d)<=100*e*Math.abs(s[t-2])||(o.h=l*n,Math.abs(o.d)>=Math.abs(o.c)?(h=2,o.e=r/o.d,o.f=o.c/o.d,o.g=a*n,o.a3=o.e*(o.g+r)+o.h*(n/o.d),o.a1=-r+o.f*n,o.a7=o.h+(o.f+a)*r):(h=1,o.e=r/o.c,o.f=o.d/o.c,o.g=o.e*a,o.a3=o.e*r+(o.g+o.h/o.c)*n,o.a1=-r*(o.d/o.c)+n,o.a7=o.g*o.d+o.h*o.f+r)),h}function o(e,t,r,i,n,o,s,a,l){var u;if(3!=r)if(u=1==r?n:i,Math.abs(o.a1)>10*e*Math.abs(u))for(o.a7/=o.a1,o.a3/=o.a1,s[0]=l[0],s[1]=-l[0]*o.a7+l[1],c=2;c<t;c++)s[c]=-l[c-1]*o.a7+a[c-2]*o.a3+l[c];else for(s[0]=0,s[1]=-l[0]*o.a7,c=2;c<t;c++)s[c]=-l[c-1]*o.a7+a[c-2]*o.a3;else{s[1]=s[0]=0;for(var c=2;c<t;c++)s[c]=a[c-2]}}function s(e,t,r,i,n,o,s,a,l,u,c,h,d,p,f,g,v){var y,m,_,E,x,b,A,C;t.b=t.a=0,3!=e&&(2!=e?(y=r+d*s+h*u,m=a+(d+p*u)*l):(y=(r+c)*u+h,m=(u+d)*a+p*l),0!=(C=-(A=-((x=(_=-f[g-1]/v[g])*o)+(b=_*_*n))+p*(E=-(f[g-2]+_*v[g-1])/v[g])*i)+m+_*y)&&(t.a=-(d*(b+x)+p*(_*i+E*o))/C+d,t.b=p*(1+A/C)))}function a(e,t,r,i){var n,o,s;i.sr=i.si=i.lr=i.li=0,0!=e?0!=r?(n=t/2,Math.abs(n)<Math.abs(r)?(s=-(s=r>=0?e:-e)+n*(n/Math.abs(r)),o=Math.sqrt(Math.abs(s))*Math.sqrt(Math.abs(r))):(s=-e/n*(r/n)+1,o=Math.sqrt(Math.abs(s))*Math.abs(n)),s>=0?(o=n>=0?-o:o,i.lr=(-n+o)/e,i.sr=0!=i.lr?r/i.lr/e:i.sr):(i.lr=i.sr=-n/e,i.si=Math.abs(o/e),i.li=-i.si)):i.lr=-t/e:i.sr=0!=t?-r/t:i.sr}function l(e,t,r,l,u,c,h,d,p,f,g,v){var y,m,_,E,x,b,A,C,T,P,R,S=new Object,V=0,w=0;r.NZ=0,b=l,C=u;do{if(S.li=S.lr=S.si=S.sr=0,a(1,b,C,S),r.szr=S.sr,r.szi=S.si,r.lzr=S.lr,r.lzi=S.li,Math.abs(Math.abs(r.szr)-Math.abs(r.lzr))>.01*Math.abs(r.lzr))break;for(i(h,b,C,p,c,d),m=Math.abs(-r.szr*d.b+d.a)+Math.abs(r.szi*d.b),P=Math.sqrt(Math.abs(C)),y=2*Math.abs(c[0]),x=-r.szr*d.b,R=1;R<t;R++)y=y*P+Math.abs(c[R]);if(m<=20*(y=(9*(y=y*P+Math.abs(x+d.a))+2*Math.abs(x)-7*(Math.abs(d.a+x)+P*Math.abs(d.b)))*e)){r.NZ=2;break}if(++V>20)break;if(V>=2&&E<=.01&&m>=_&&!w){for(i(h,b-=b*(E=E<e?Math.sqrt(e):Math.sqrt(E)),C+=C*E,p,c,d),R=0;R<5;R++)o(e,t,n(e,t,d.a,d.b,g,v,b,C,f),d.a,d.b,g,v,f,c);w=1,V=0}_=m,o(e,t,n(e,t,d.a,d.b,g,v,b,C,f),d.a,d.b,g,v,f,c),s(n(e,t,d.a,d.b,g,v,b,C,f),d,d.a,g.a1,g.a3,g.a7,d.b,g.c,g.d,g.f,g.g,g.h,b,C,v,t,p),A=d.a,0!=(T=d.b)&&(E=Math.abs((-C+T)/T),b=A,C=T)}while(0!=T)}function u(e,t,r,i,n,o,s,a,l){var u,c,h,d,p,f,g,v,y,m,_,E=i-1;for(t.NZ=_=y=0,g=r.a;;){for(s[0]=f=n[0],m=1;m<o;m++)s[m]=f=f*g+n[m];for(h=Math.abs(f),d=Math.abs(g),u=.5*Math.abs(s[0]),m=1;m<o;m++)u=u*d+Math.abs(s[m]);if(h<=20*e*(2*u-h)){t.NZ=1,t.szr=g,t.szi=0;break}if(++_>10)break;if(_>=2&&Math.abs(v)<=.001*Math.abs(-v+g)&&h>p){y=1,t.a=g;break}for(p=h,l[0]=c=a[0],m=1;m<i;m++)l[m]=c=c*g+a[m];if(Math.abs(c)>10*Math.abs(a[E])*e)for(v=-f/c,a[0]=s[0],m=1;m<i;m++)a[m]=v*l[m-1]+s[m];else for(a[0]=0,m=1;m<i;m++)a[m]=l[m-1];for(c=a[0],m=1;m<i;m++)c=c*g+a[m];g+=v=Math.abs(c)>10*Math.abs(a[E])*e?-f/c:0}return y}function c(e,t,r,a,c,h,d,p,f,g,v){var y,m,_,E,x,b,A,C,T,P,R,S,V,w,M,L,O,k,I,F,N,D,B,z,j,U,G,Y,K=new Object,H=new Object,q=new Array(t),W=new Array(t);for(v.NZ=0,E=_=.25,M=-2*a,x=a,C=O=c,H.h=H.g=H.f=H.e=H.d=H.c=H.a7=H.a3=H.a1=K.b=K.a=0,i(f,M,O,p,g,K),U=n(e,d,y=K.a,m=K.b,H,h,M,O,q),B=0;B<r;B++){if(o(e,d,U,y,m,H,h,q,g),s(U=n(e,d,y,m,H,h,M,O,q),K,y,H.a1,H.a3,H.a7,m,H.c,H.d,H.f,H.g,H.h,M,O,h,d,p),L=K.a,I=k=K.b,P=0!=h[d-1]?-p[d]/h[d-1]:0,R=V=1,0!=B&&3!=U&&(G=(w=(V=0!=I?Math.abs((I-C)/I):V)<A?V*A:1)<E?1:0,(z=(S=(R=0!=P?Math.abs((P-x)/P):R)<b?R*b:1)<_?1:0)||G)){for(N=0;N<d;N++)W[N]=h[N];T=P,j=Y=0,F=1;do{if(D=1,F&&0==(F=0)&&z&&(!G||S<w));else{if(l(e,d,v,L,k,g,f,K,p,q,H,h),y=K.a,m=K.b,v.NZ>0)return;if(Y=1,E*=.25,j||!z)D=0;else for(N=0;N<d;N++)h[N]=W[N]}if(0!=D){if(K.a=T,D=u(e,v,K,d,p,f,g,h,q),T=K.a,v.NZ>0)return;if(j=1,_*=.25,0!=D){L=-(T+T),k=T*T;continue}}for(N=0;N<d;N++)h[N]=W[N]}while(G&&!Y);i(f,M,O,p,g,K),U=n(e,d,y=K.a,m=K.b,H,h,M,O,q)}C=I,x=P,A=V,b=R}}Object.defineProperty(t,"__esModule",{value:!0}),t.getRealPolynomialRoots=function(e){var t={Degree:e.length-1},r=new Array(e.length),i=new Array(e.length);!function(e,t,r,i){var n,o,s,l,u,h,d,p,f,g,v,y,m,_,E,x,b,A,C,T,P,R,S=e.Degree,V=Math.LN2,w=e.Degree+1,M=new Array(w),L=new Array(w),O=new Array(w),k=new Array(w),I=new Object,F=new Object;y=1;do{o=y,m=1+(y/=2)}while(m>1);var N=117549435082229e-52/o,D=Math.cos(1.6406094968746698),B=Math.sin(1.6406094968746698),z=Math.sqrt(.5),j=-z;for(F.NZ=b=0,F.szr=F.szi=F.lzr=F.lzi=0;0==t[S];)r[b]=i[b]=0,S--,b++;for(P=S+1;S>=1;){if(S<=2){S<2?(r[e.Degree-1]=-t[1]/t[0],i[e.Degree-1]=0):(I.li=I.lr=I.si=I.sr=0,a(t[0],t[1],t[2],I),r[e.Degree-2]=I.sr,i[e.Degree-2]=I.si,r[e.Degree-1]=I.lr,i[e.Degree-1]=I.li);break}for(d=0,p=340282346638529e24,U=0;U<P;U++)(g=Math.abs(t[U]))>d&&(d=g),0!=g&&g<p&&(p=g);if(((f=N/p)<=1&&d>=10||f>1&&340282346638529e24/f>=d)&&(f=0==f?117549435082229e-52:f,C=Math.floor(Math.log(f)/V+.5),1!=(u=Math.pow(2,C))))for(U=0;U<P;U++)t[U]*=u;for(var U=0;U<P;U++)L[U]=Math.abs(t[U]);L[S]=-L[S],T=S-1,g=Math.exp((Math.log(-L[S])-Math.log(L[0]))/S),0!=L[T]&&(g=(v=-L[S]/L[T])<g?v:g),v=g;do{for(v=.1*(g=v),h=L[0],U=1;U<P;U++)h=h*v+L[U]}while(h>0);for(l=g;Math.abs(l/g)>.005;){for(s=h=L[0],U=1;U<S;U++)s=g*s+(h=g*h+L[U]);g-=l=(h=g*h+L[S])/s}for(n=g,U=1;U<S;U++)M[U]=(S-U)*t[U]/S;for(M[0]=t[0],y=t[S],m=t[T],R=0==M[T]?1:0,A=0;A<5;A++)if(_=M[T],R){for(U=0;U<T;U++)M[b=T-U]=M[b-1];M[0]=0,R=0==M[T]?1:0}else{for(E=-y/_,U=0;U<T;U++)M[b=T-U]=E*M[b-1]+t[b];M[0]=t[0],R=Math.abs(M[T])<=Math.abs(m)*o*10?1:0}for(U=0;U<S;U++)k[U]=M[U];for(A=1;A<=20;A++){if(x=-B*j+D*z,j=B*z+D*j,c(o,w,20*A,n*(z=x),n,M,S,t,P,O,F),0!=F.NZ){for(r[b=e.Degree-S]=F.szr,i[b]=F.szi,S=(P-=F.NZ)-1,U=0;U<P;U++)t[U]=O[U];1!=F.NZ&&(r[b+1]=F.lzr,i[b+1]=F.lzi);break}for(U=0;U<S;U++)M[U]=k[U]}if(A>20){e.Degree-=S;break}}}(t,e,r,i);for(var n=[],o=e.length-t.Degree-1;o<e.length;o++)Math.abs(i[o])<1e-8&&n.push(r[o]);return n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.relaxBCurveToPerpendicular=t.closestBCurveSegments=t.maxDistanceSqrToHull=t.minDistanceSqrToHull=void 0;var i=r(1),n=r(0),o=r(37),s=r(35),a=function(e,t){var r,o=t.length/3,s=i.Vector3.asFloat64(0,0,0);for(r=0;r<o;++r)s[0]+=t[3*r],s[1]+=t[3*r+1],s[2]+=t[3*r+2];i.Vector3.scale(s,s,1/o),i.Vector3.sub(s,s,e);var a=i.Vector3.squaredLength(s);if(a<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)return 0;var l=Number.POSITIVE_INFINITY;for(r=0;r<o;++r){var u=s[0]*(t[3*r]-e[0])+s[1]*(t[3*r+1]-e[1])+s[2]*(t[3*r+2]-e[2]);u<l&&(l=u)}return l<=0?0:l*l/a},l=function(e,t){for(var r=t.length/3,i=0,n=0;n<r;++n){var o=t[3*n]-e[0],s=t[3*n+1]-e[1],a=t[3*n+2]-e[2],l=o*o+s*s+a*a;l>i&&(i=l)}return i};t.minDistanceSqrToHull=a,t.maxDistanceSqrToHull=l,t.closestBCurveSegments=function(e,t,r,n){for(var o=Number.POSITIVE_INFINITY,s=[],u=0;u<t.length;++u){var c,h=t[u],d=h.getRangeUnlimited();if(n){c=!1;for(var p=0;p<n.length;++p)if(d[1]>=n[p][0]+i.FLOAT64_TOLERANCE&&d[0]<=n[p][1]-i.FLOAT64_TOLERANCE){c=!0;break}}else c=!0;if(c){var f=r?r[u]:0,g=h.getControlPoints(),v=a(e,g);if((v=Math.max(0,v-f))<=o){var y=l(e,g)+f;s.push({index:u,minDistSqr:v,maxDistSqr:y}),y<o&&(o=y)}}}return(s=s.filter((function(e){return e.minDistSqr<=o}))).sort((function(e,t){var r=e.minDistSqr-t.minDistSqr;return 0===r?e.maxDistSqr-t.maxDistSqr:r})),s},t.relaxBCurveToPerpendicular=function(e,t,r,n,a,l,u,c){var h=u||i.FLOAT64_TOLERANCE,d=c||32,p=t.length/3,f=e.length-p-1;return(0,s.newtonRaphson1D)((function(i){var s=(0,o.evaluateBCurveDerivs)(i,2,f,e,t,r),a=s[0],l=s[1],u=s[2],c=[a[0]-n[0],a[1]-n[1],a[2]-n[2]];return{val:2*(c[0]*l[0]+c[1]*l[1]+c[2]*l[2]),deriv:2*(c[0]*u[0]+c[1]*u[1]+c[2]*u[2]+(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]))}}),l,a,h,d)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sphere=void 0;var i=r(1),n=r(3),o=r(0),s=r(12),a=r(6),l=r(14),u=r(2),c=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._radius=0,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(c.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.SPHERE},c.prototype.clone=function(){var e=new c;return e.copy(this),e},c.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._radius=e._radius,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},c.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},c.prototype.set=function(e,t,r,n){i.Vector3.copy(this._center,e),u.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._radius=t;var s=void 0===r||i.Vector3.squaredLength(r)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE,a=void 0===n||i.Vector3.squaredLength(n)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE;s&&a?(i.Vector3.set(this._xAxis,1,0,0),i.Vector3.set(this._zAxis,0,0,1)):s?(i.Vector3.normalize(this._xAxis,n),i.Vector3.computeOrthogonal(this._zAxis,this._xAxis),i.Vector3.normalize(this._zAxis,this._zAxis)):a?(i.Vector3.normalize(this._zAxis,r),i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)):(u.ConsoleUtils.assert(i.Vector3.isOrthogonal(r,n,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,n),i.Vector3.normalize(this._zAxis,r)),this._computeYAxis()},c.prototype.getRadius=function(){return this._radius},c.prototype.setRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._radius=e},c.prototype.getCenter=function(){return this._center},c.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},c.prototype.getAxisDir=function(){return this._zAxis},c.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},c.prototype.getUvOriginDir=function(){return this._xAxis},c.prototype.setUvOriginDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),(i.Vector3.squaredLength(this._zAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._zAxis,this._xAxis),i.Vector3.normalize(this._zAxis,this._zAxis)),this._computeYAxis()},c.prototype.evaluatePosition=function(e,t){var r=Math.sin(e),n=Math.cos(e),o=Math.sin(t),s=Math.cos(t),a=this._radius*n*s,l=this._radius*n*o,u=this._radius*r,c=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(c,c,this._xAxis,a),i.Vector3.scaleAndAdd(c,c,this._yAxis,l),i.Vector3.scaleAndAdd(c,c,this._zAxis,u),c},c.prototype.evaluateNormal=function(e,t){var r=Math.sin(e),n=Math.cos(e),o=Math.sin(t),s=n*Math.cos(t),a=n*o,l=r,u=i.Vector3.createFloat64();return i.Vector3.scale(u,this._xAxis,s),i.Vector3.scaleAndAdd(u,u,this._yAxis,a),i.Vector3.scaleAndAdd(u,u,this._zAxis,l),u},c.prototype.evaluateDu=function(e,t){var r=Math.sin(e),n=Math.cos(e),o=Math.sin(t),s=Math.cos(t),a=-this._radius*r*s,l=-this._radius*r*o,u=this._radius*n,c=i.Vector3.createFloat64();return i.Vector3.scale(c,this._xAxis,a),i.Vector3.scaleAndAdd(c,c,this._yAxis,l),i.Vector3.scaleAndAdd(c,c,this._zAxis,u),c},c.prototype.evaluateDv=function(e,t){var r=Math.cos(e),n=Math.sin(t),o=Math.cos(t),s=-this._radius*r*n,a=this._radius*r*o,l=i.Vector3.createFloat64();return i.Vector3.scale(l,this._xAxis,s),i.Vector3.scaleAndAdd(l,l,this._yAxis,a),l},c.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var r=i.Vector3.length(t);if(r<o.KERNEL_TOLERANCE)return{u:0,v:0};var s=i.Vector3.dot(t,this._xAxis),a=i.Vector3.dot(t,this._yAxis),l=i.Vector3.dot(t,this._zAxis);return{u:Math.asin((0,n.clamp)(l/r,-1,1)),v:Math.atan2(a,s)}},c.prototype.vParamLine=function(e){var t=Math.cos(e),r=Math.sin(e),n=this._radius*t,s=this._radius*r;if(Math.abs(n)>o.KERNEL_TOLERANCE){var u=new l.Circle,c=i.Vector3.clone(this._center);i.Vector3.scaleAndAdd(c,c,this._zAxis,s);var h=i.Vector3.clone(this._xAxis);i.Vector3.scale(h,h,n);var d=i.Vector3.clone(this._zAxis);return i.Vector3.negate(d,d),u.set(c,d,h),u}var p=i.Vector3.clone(this._center);return s=s<0?-this._radius:this._radius,i.Vector3.scaleAndAdd(p,p,this._zAxis,s),new a.Point(p)},c.prototype.uParamLine=function(e){var t=new l.Circle,r=Math.sin(e),n=Math.cos(e),o=this._radius*n,s=this._radius*r,a=i.Vector3.clone(this._xAxis);i.Vector3.scale(a,a,-s),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.normalize(a,a);var u=i.Vector3.clone(this._xAxis);return i.Vector3.scale(u,u,o),i.Vector3.scaleAndAdd(u,u,this._yAxis,s),t.set(this._center,a,u),t},c.prototype.getBoundingBox=function(e,t){e=e||[-Math.PI/2,Math.PI/2],t=t||[-Math.PI,Math.PI];var r=e[0],o=e[1],s=t[0],a=t[1],l=this.vParamLine(r).getBoundingBox(t);l.include(this.vParamLine(o).getBoundingBox(t)),l.include(this.uParamLine(s).getBoundingBox(e)),l.include(this.uParamLine(a).getBoundingBox(e));for(var u=i.Vector3.createFloat64(),c=0;c<3;++c)for(var h=0;h<2;++h){var d=0===h?1:-1,p=Math.atan2(d*this._yAxis[c],d*this._xAxis[c]),f=Math.asin(d*this._zAxis[c]);p=(0,n.adjustParameterToPeriodicRange)(p,t,n.PI2),f>r&&f<o&&p>s&&p<a&&(i.Vector3.set(u,0,0,0),u[c]=d*this._radius,l.includePoint(i.Vector3.add(u,this._center,u)))}return l},c.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._radius*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},c.prototype.getRangeUnlimitedU=function(){return[-Math.PI/2,Math.PI/2]},c.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},c.prototype.isPeriodicUnlimitedU=function(){return!1},c.prototype.isPeriodicUnlimitedV=function(){return!0},c.prototype.isClosedUnlimitedU=function(){return!1},c.prototype.isClosedUnlimitedV=function(){return!0},c.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this.getCenter()),radius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Sphere=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Torus=void 0;var i=r(1),n=r(3),o=r(0),s=r(12),a=r(6),l=r(14),u=r(2),c=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._majorRadius=0,this._minorRadius=0,this._lemon=!1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(c.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.TORUS},c.prototype.clone=function(){var e=new c;return e.copy(this),e},c.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,this._lemon=e._lemon,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},c.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},c.prototype.set=function(e,t,r,n,s,a){i.Vector3.copy(this._center,e),u.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._majorRadius=t,u.ConsoleUtils.assert(r>o.KERNEL_TOLERANCE),this._minorRadius=r,u.ConsoleUtils.assert(i.Vector3.squaredLength(n)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,n),void 0!==s&&i.Vector3.squaredLength(s)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(u.ConsoleUtils.assert(i.Vector3.isOrthogonal(n,s,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,s)):(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._lemon=!0===a,this._computeYAxis()},c.prototype.getMajorRadius=function(){return this._majorRadius},c.prototype.setMajorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._majorRadius=e},c.prototype.getMinorRadius=function(){return this._minorRadius},c.prototype.setMinorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._minorRadius=e},c.prototype.getCenter=function(){return this._center},c.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},c.prototype.getAxisDir=function(){return this._zAxis},c.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},c.prototype.getUvOriginDir=function(){return this._xAxis},c.prototype.setUvOriginDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},c.prototype.isDoughnut=function(){return this._majorRadius>this._minorRadius+o.KERNEL_TOLERANCE},c.prototype.isVortex=function(){return Math.abs(this._majorRadius-this._minorRadius)<=o.KERNEL_TOLERANCE},c.prototype.isApple=function(){return this._majorRadius<this._minorRadius-o.KERNEL_TOLERANCE&&!this._lemon},c.prototype.isLemon=function(){return this._majorRadius<this._minorRadius-o.KERNEL_TOLERANCE&&this._lemon},c.prototype.setLemon=function(e){this._lemon=e},c.prototype.getSingularUParams=function(){var e,t,r;return this.isDoughnut()?[]:this.isApple()?(e=-this._majorRadius,t=this._minorRadius,[-(r=Math.acos(e/t)),r]):this.isLemon()?(e=this._minorRadius-this._majorRadius,t=this._minorRadius,[-(r=Math.acos(e/t)),r]):[-Math.PI,Math.PI]},c.prototype.evaluatePosition=function(e,t){var r=this._minorRadius*Math.cos(e);this.isLemon()?r-=this._majorRadius:r+=this._majorRadius;var n=r*Math.cos(t),o=r*Math.sin(t),s=this._minorRadius*Math.sin(e),a=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(a,a,this._xAxis,n),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},c.prototype.evaluateNormal=function(e,t){var r=Math.sin(e),n=Math.cos(e),o=Math.sin(t),s=n*Math.cos(t),a=n*o,l=r,u=i.Vector3.createFloat64();return i.Vector3.scale(u,this._xAxis,s),i.Vector3.scaleAndAdd(u,u,this._yAxis,a),i.Vector3.scaleAndAdd(u,u,this._zAxis,l),u},c.prototype.evaluateDu=function(e,t){var r=-this._minorRadius*Math.sin(e),n=r*Math.cos(t),o=r*Math.sin(t),s=this._minorRadius*Math.cos(e),a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,n),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},c.prototype.evaluateDv=function(e,t){var r=this._minorRadius*Math.cos(e);this.isLemon()?r-=this._majorRadius:r+=this._majorRadius;var n=-r*Math.sin(t),o=r*Math.cos(t),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,n),i.Vector3.scaleAndAdd(s,s,this._yAxis,o),s},c.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var r=i.Vector3.dot(t,this._xAxis),n=i.Vector3.dot(t,this._yAxis),s=i.Vector3.dot(t,this._zAxis),a=Math.sqrt(r*r+n*n);return this.isLemon()?a+=this._majorRadius:a-=this._majorRadius,{u:s*s+a*a>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?Math.atan2(s,a):0,v:r*r+n*n>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?Math.atan2(n,r):0}},c.prototype.vParamLine=function(e){var t=this._minorRadius*Math.cos(e);this.isLemon()?t-=this._majorRadius:t+=this._majorRadius;var r=this._minorRadius*Math.sin(e);if(Math.abs(t)>o.KERNEL_TOLERANCE){var n=new l.Circle,s=i.Vector3.clone(this._center);i.Vector3.scaleAndAdd(s,s,this._zAxis,r);var u=i.Vector3.clone(this._xAxis);i.Vector3.scale(u,u,t);var c=i.Vector3.clone(this._zAxis);return i.Vector3.negate(c,c),n.set(s,c,u),n}var h=i.Vector3.clone(this._center),d=this.getSingularUParams();return d[0]&&r<0?r=this._minorRadius*Math.sin(d[0]):d[1]&&r>0&&(r=this._minorRadius*Math.sin(d[1])),i.Vector3.scaleAndAdd(h,h,this._zAxis,r),new a.Point(h)},c.prototype.uParamLine=function(e){var t=new l.Circle,r=Math.sin(e),n=Math.cos(e),o=this._majorRadius*n,s=this._majorRadius*r;this.isLemon()&&(o=-o,s=-s);var a=i.Vector3.clone(this._center);i.Vector3.scaleAndAdd(a,a,this._xAxis,o),i.Vector3.scaleAndAdd(a,a,this._yAxis,s);var u=this._minorRadius*n,c=this._minorRadius*r,h=i.Vector3.clone(this._xAxis);i.Vector3.scale(h,h,-c),i.Vector3.scaleAndAdd(h,h,this._yAxis,u),i.Vector3.normalize(h,h);var d=i.Vector3.clone(this._xAxis);return i.Vector3.scale(d,d,u),i.Vector3.scaleAndAdd(d,d,this._yAxis,c),t.set(a,h,d),t},c.prototype.getBoundingBox=function(e,t){e=e||(this.isDoughnut()?[-Math.PI,Math.PI]:this.getSingularUParams()),t=t||[-Math.PI,Math.PI];var r=e[0],o=e[1],s=t[0],a=t[1],l=this.vParamLine(r).getBoundingBox(t);l.include(this.vParamLine(o).getBoundingBox(t)),l.include(this.uParamLine(s).getBoundingBox(e)),l.include(this.uParamLine(a).getBoundingBox(e));for(var u=i.Vector3.createFloat64(),c=i.Vector3.createFloat64(),h=0;h<3;++h)for(var d=0;d<2;++d){var p=0===d?-1:1,f=Math.atan2(p*this._yAxis[h],p*this._xAxis[h]);if((f=(0,n.adjustParameterToPeriodicRange)(f,t,n.PI2))>s&&f<a){var g=this.uParamLine(f);u=g.evaluatePosition(0),i.Vector3.sub(u,u,g.getCenter()),c=g.evaluatePosition(Math.PI/2),i.Vector3.sub(c,c,g.getCenter());var v=(0,n.minMaxCosSinFunc)(u[h],c[h],g.getCenter()[h],e);0===h?l.includeX(v[d]):1===h?l.includeY(v[d]):l.includeZ(v[d])}}return l},c.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._majorRadius*=t,this._minorRadius*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},c.prototype.getRangeUnlimitedU=function(){return this.isDoughnut()?[-Math.PI,Math.PI]:this.getSingularUParams()},c.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},c.prototype.isPeriodicUnlimitedU=function(){return this.isDoughnut()},c.prototype.isPeriodicUnlimitedV=function(){return!0},c.prototype.isClosedUnlimitedU=function(){return this.isDoughnut()||this.isVortex()},c.prototype.isClosedUnlimitedV=function(){return!0},c.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this.getCenter()),coordAxis:this.vectorToObject(this.getUvOriginDir()),axis:this.vectorToObject(this.getAxisDir()),majorRadius:this.getMajorRadius(),minorRadius:this.getMinorRadius(),lemon:this.isLemon(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Torus=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateBSurfaceDerivs=t.evaluateBSurfacePoint=void 0;var i=r(1),n=r(3),o=r(17),s=r(37);t.evaluateBSurfacePoint=function(e,t,r,n,a,l,u,c){return c&&c.length>0?function(e,t,r,n,a,l,u,c){for(var h,d=l.length-n-1,p=(0,o.findKnotSpan)(e,a),f=(0,s.evaluateBasisFunctions)(p,e,r,a),g=(0,o.findKnotSpan)(t,l),v=(0,s.evaluateBasisFunctions)(g,t,n,l),y=p-r,m=i.Vector4.createFloat64(),_=i.Vector4.createFloat64(),E=0;E<=n;E++){i.Vector4.set(_,0,0,0,0),h=g-n+E;for(var x=0;x<=r;x++){var b=(y+x)*d+h,A=f[x]*c[b];_[0]+=A*u[3*b],_[1]+=A*u[3*b+1],_[2]+=A*u[3*b+2],_[3]+=A}m[0]+=v[E]*_[0],m[1]+=v[E]*_[1],m[2]+=v[E]*_[2],m[3]+=v[E]*_[3]}return i.Vector3.createFloat64FromValues(m[0]/m[3],m[1]/m[3],m[2]/m[3])}(e,t,r,n,a,l,u,c):function(e,t,r,n,a,l,u){for(var c,h=l.length-n-1,d=(0,o.findKnotSpan)(e,a),p=(0,s.evaluateBasisFunctions)(d,e,r,a),f=(0,o.findKnotSpan)(t,l),g=(0,s.evaluateBasisFunctions)(f,t,n,l),v=d-r,y=i.Vector3.createFloat64(),m=i.Vector3.createFloat64(),_=0;_<=n;_++){i.Vector3.set(m,0,0,0),c=f-n+_;for(var E=0;E<=r;E++){var x=(v+E)*h+c;m[0]+=p[E]*u[3*x],m[1]+=p[E]*u[3*x+1],m[2]+=p[E]*u[3*x+2]}y[0]+=g[_]*m[0],y[1]+=g[_]*m[1],y[2]+=g[_]*m[2]}return y}(e,t,r,n,a,l,u)},t.evaluateBSurfaceDerivs=function(e,t,r,a,l,u,c,h,d){return function(e,t,r,a,l,u,c,h,d){var p,f,g,v,y,m,_=new Array(r+1),E=new Array(r+1),x=new Array(r+1),b=new Array(r+1);for(p=0;p<=r;p++){for(_[p]=new Array(r+1-p),E[p]=new Array(r+1-p),f=0;f<=r-p;f++)_[p][f]=i.Vector3.createFloat64(),E[p][f]=0;x[p]=new Array(a+1),b[p]=new Array(l+1)}var A=Math.min(r,a),C=(0,o.findKnotSpan)(e,u);(0,s.evaluateBasisDerivatives)(C,e,a,A,u,x);var T=Math.min(r,l),P=(0,o.findKnotSpan)(t,c);(0,s.evaluateBasisDerivatives)(P,t,l,T,c,b);var R=d&&d.length>0,S=c.length-l-1,V=new Array(l+1);for(p=0;p<=A;p++){for(g=0;g<=l;g++)for(V[g]=[0,0,0,0],v=0;v<=a;v++){var w=(C-a+v)*S+(P-l+g),M=x[p][v];R&&(M*=d[w],V[g][3]+=M),V[g][0]+=M*h[3*w],V[g][1]+=M*h[3*w+1],V[g][2]+=M*h[3*w+2]}var L=Math.min(r-p,T);for(f=0;f<=L;f++)for(g=0;g<=l;g++)_[p][f][0]+=b[f][g]*V[g][0],_[p][f][1]+=b[f][g]*V[g][1],_[p][f][2]+=b[f][g]*V[g][2],R&&(E[p][f]+=b[f][g]*V[g][3])}if(R){var O=n.binomialCoefficients,k=i.Vector3.createFloat64();for(p=0;p<=r;p++)for(f=0;f<=r-p;f++){var I=_[p][f];for(m=1;m<=f;m++)i.Vector3.scaleAndAdd(I,I,_[p][f-m],-O[f][m]*E[0][m]);for(y=1;y<=p;y++){for(i.Vector3.scaleAndAdd(I,I,_[p-y][f],-O[p][y]*E[y][0]),i.Vector3.set(k,0,0,0),m=1;m<=f;m++)i.Vector3.scaleAndAdd(k,k,_[p-y][f-m],O[f][m]*E[y][m]);i.Vector3.scaleAndAdd(I,I,k,-O[p][y])}i.Vector3.scale(I,I,1/E[0][0])}}return _}(e,t,r,a,l,u,c,h,d)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newtonRaphson2D=t.RelaxResult=void 0;var i=r(1),n={};n[n.Success=0]="Success",n[n.OutOfRange=1]="OutOfRange",n[n.DegenerateStep=2]="DegenerateStep",n[n.TooManySteps=3]="TooManySteps",n[n.RootNotFound=4]="RootNotFound",t.RelaxResult=n,t.newtonRaphson2D=function(e,t,r,o,s){o=o||1e-12,s=s||100;var a=[void 0,void 0];r&&2===r.length&&(r[0]&&2===r[0].length&&(a[0]=r[0]),r[1]&&2===r[1].length&&(a[1]=r[1])),a[0]&&(a[0][0],a[0][1]),a[1]&&(a[1][0],a[1][1]);for(var l=[0,0],u=1/0,c=1/0,h=!1,d=i.Matrix22.createFloat64(),p=i.Matrix22.createFloat64(),f=i.Vector2.clone(t),g=n.Success,v=0;v<=s;v++){var y=e(f);if(u=i.Vector2.squaredLength(y.val),f[0],f[1],u<i.FLOAT64_TOLERANCE*i.FLOAT64_TOLERANCE){g=n.Success;break}if(v>0&&Math.max(Math.abs(l[0]),Math.abs(l[1]))<o){u>=c&&(i.Vector2.sub(f,f,l),u=c,y=e(f));var m=10*o*(i.Vector2.len(y.deriv1)+i.Vector2.len(y.deriv2));g=u>m*m?h?n.OutOfRange:n.RootNotFound:n.Success;break}if(v===s){u>=c&&(i.Vector2.sub(f,f,l),u=c),g=n.TooManySteps;break}if(v>0&&u>=c){var _=c/(c+u);_=Math.max(_,.1),i.Vector2.sub(f,f,l),i.Vector2.scale(l,l,_),i.Vector2.add(f,f,l),u=c}else{if(c=u,i.Matrix22.set(d,-y.deriv1[0],-y.deriv1[1],-y.deriv2[0],-y.deriv2[1]),Math.abs(i.Matrix22.determinant(d))<i.FLOAT64_TOLERANCE){g=n.DegenerateStep;break}i.Matrix22.invert(p,d),i.Vector2.transformMatrix22(l,y.val,p),l[0],l[1],i.Vector2.add(f,f,l),h=!1;for(var E=0;E<3;E++){var x=E>=2,b=E%2;if(a[b]){var A=0;if(f[b]<a[b][0]?(A=f[b]-a[b][0],f[b]=a[b][0]):f[b]>a[b][1]&&(A=f[b]-a[b][1],f[b]=a[b][1]),0!==A){f[b];var C=l[b];if(l[b]-=A,x);else{var T=1-b;if(f[T]-=l[T],Math.abs(l[b])>o){var P=l[b]/C;l[T]*=P}else{h=!0;var R=0===T?y.deriv1:y.deriv2;l[T]=-i.Vector2.dot(y.val,R)/Math.max(i.Vector2.dot(R,R),i.FLOAT64_TOLERANCE)}f[T]+=l[T],l[0],l[1]}}}}}}return n[g],f[0],f[1],{param:f,status:g}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOrderedFacesOnVertex=function(e){var t=e.getEdges(),r=new i(e),n=[];return t.forEach((function(t){for(var i=t.getCoedges(),o=0;o<i.length;++o)if(i[o].getStartVertex()===e){var s=r.marchFan(i[o]);s.faces.length>0&&n.push(s);break}})),n};var i=function(){function e(t){_classCallCheck(this,e),this._vertex=t,this._visitedCoeds=new Set,this._unvisitedCoeds=new Set,this._faces=[],this._type="unset"}return _createClass(e,[{key:"addVisitedCoedge",value:function(e){this._visitedCoeds.add(e),this._unvisitedCoeds.delete(e)}},{key:"getNextFace",value:function(e){var t=e.getFace();t&&this._faces.push(t),this.addVisitedCoedge(e)}},{key:"getPrevFace",value:function(e){var t=e.getFace();t&&this._faces.unshift(t),this.addVisitedCoedge(e)}},{key:"collectUnvisitedCoeds",value:function(e){var t=this;e.getEdge().getCoedges().forEach((function(e){t._visitedCoeds.has(e)||e.getStartVertex()!==t._vertex||t._unvisitedCoeds.add(e)}))}},{key:"nextFace",value:function(e){var t=e.getPartner();if(t){if(!this._visitedCoeds.has(t)){if(t.getPartner()!==e&&(this._type="unordered",this.collectUnvisitedCoeds(e)),t.getEndVertex()!==this._vertex)return this._type="unordered",void this.collectUnvisitedCoeds(t);this.addVisitedCoedge(t);var r=t.getNext();if(!this._visitedCoeds.has(r))return this.getNextFace(r),r;"unset"===this._type&&(this._type="cycle")}}else"unset"===this._type&&(this._type="chain")}},{key:"prevFace",value:function(e){var t=e.getPrevious();if(!this._visitedCoeds.has(t)){var r=t.getPartner();return r&&!this._visitedCoeds.has(r)?(r.getPartner()!==t&&(this._type="unordered",this.collectUnvisitedCoeds(t)),r.getStartVertex()!==this._vertex?(this._type="unordered",void this.collectUnvisitedCoeds(r.getNext())):(this.addVisitedCoedge(t),this.getPrevFace(r),r)):void 0}}},{key:"collectFanFaces",value:function(e){if(!this._visitedCoeds.has(e)){var t=e;this.getNextFace(t);for(var r=t;r;)r=this.nextFace(r);for(r=t;r;)r=this.prevFace(r)}}},{key:"marchFan",value:function(e){for(this._faces=[],this._type="unset",this.collectFanFaces(e);this._unvisitedCoeds.size>0;){var t=this._unvisitedCoeds.values();this.collectFanFaces(t.next().value)}return{faces:this._faces,type:this._type}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Attribute=void 0;var i=r(44),n={"autodesk.brep:nmiattributestr-1.0.0":"nmiattributestr","autodesk.brep:nmiattributearr-1.0.0":"nmiattributearr","autodesk.brep:textattribute-1.0.0":"textattribute"},o=function(e,t){i.Base.call(this),this._topologies=[],this.typeid=e,this.values=t||{}};(o.prototype=Object.create(i.Base.prototype)).getValues=function(){return this.values},o.prototype.getTypeid=function(){return this.typeid},o.prototype.getTopologies=function(){return this._topologies},o.prototype.addTopology=function(e){this._topologies?this._topologies.push(e):this._topologies=[e]},o.prototype.removeTopology=function(e){var t=this._topologies.indexOf(e);return t>-1&&(this._topologies.splice(t,1),!0)},o.prototype.toObject=function(){return this.values},o.prototype.addToModelObject=function(e){if(!e.attributes[this.getGuid()]){var t=n[this.typeid];if(t){var r={};r[t]=this.toObject(),e.attributes[this.getGuid()]=r}else console.warn("Attribute.addToModelObject : Unknown attribute type for proto object!")}},t.Attribute=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SketchRegionSolver=void 0;var i=r(1),n=r(3),o=r(0),s=r(18),a=r(7),l=r(14),u=r(33),c=r(23),h=r(6),d=r(13),p=r(27),f=r(81),g=r(82),v=r(56),y=r(36),m=r(55),_=r(41),E=r(112),x=r(113),b=r(2),A=r(8),C=function(e){return e&&e.__esModule?e:{default:e}}(r(42)),T=function(){this.SIDE={LEFT:0,RIGHT:1},this._sketch=void 0,this._intersectionVertices=[],this._edgeSegments=[],this._cells=[],this._faces=[],this._workspace={edgeIntersections:[],edgeOverlapRegions:[],segmentBlackList:[],edges:[],edgeIDs:[],sweepLineIntersections:void 0,sweepLineRegions:void 0,currentVertex:void 0,nextVertex:void 0,edgesPerCell:void 0},this._sketchRegionTopologies={},this._planeGeometry=new s.Plane,this._planeGeometry.set([0,0,0],[0,0,1],[1,0,0]),this._sketchSummary={},this._internalToFinalMap=null,this._finalFaces=[],this._progenitorMap=null};T.prototype.compute=function(e){this._sketchEdges=e,this._initializeWorkspace(),this._findIntersections(),this._addGraphEdges(),this._mergeCoincidentSegments(),this._sortEdgesAroundVertex(),this._assignAdjacentEdges(),this._sweepRegions(),this._assignleftmostEdges(),this._removeGrazingIntersectionVertices(),this._updateVertexGuidLists(),this._removeTemporaryVertices(),this._assignLoops(),this._updateSketchRegionTopology(),this._clearWorkspace(),this._prepareResult()},T.prototype._initializeWorkspace=function(){var e=this._workspace;e.edges={};for(var t=0;t<this._sketchEdges.length;++t)e.edges[this._sketchEdges[t].getGuid()]=this._sketchEdges[t];for(e.edgeIDs=Object.getOwnPropertyNames(e.edges).sort(),e.edgeIntersections={},e.edgeOverlapRegions={},e.segmentBlackList={},t=0;t<e.edgeIDs.length;t++)e.edgeIntersections[e.edgeIDs[t]]=[],e.edgeOverlapRegions[e.edgeIDs[t]]=[],e.segmentBlackList[e.edgeIDs[t]]=[];e.sweepLineIntersections=void 0,e.sweepLineRegions=void 0,e.edgesPerCell=[],this._faces=[]},T.prototype._clearWorkspace=function(){this._workspace={edgeIntersections:[],edgeOverlapRegions:[],segmentBlackList:[],edges:[],edgeIDs:[],sweepLineIntersections:void 0,sweepLineRegions:void 0,currentVertex:void 0,nextVertex:void 0,sweepLinePosition:void 0,edgesPerCell:[]}},T.prototype._findIntersections=function(){for(var e=this._workspace,t=0;t<e.edgeIDs.length;t++){for(var r=e.edges[e.edgeIDs[t]],s=t;s<e.edgeIDs.length;s++){var a=e.edges[e.edgeIDs[s]];if(s>t||r.getCurveType()===o.GEOMETRY_TYPES.BCURVE)for(var l=(0,f.computeCurveCurveIntersections)(r,a,!0,!1,o.KERNEL_TOLERANCE),u=0;u<l.length;u++){var c=l[u];if(c.rangeInfo)e.edgeIntersections[e.edgeIDs[t]].push(C.default.extend(c.rangeInfo[0],{temporary:!1})),e.edgeIntersections[e.edgeIDs[t]].push(C.default.extend(c.rangeInfo[1],{temporary:!1})),e.edgeIntersections[e.edgeIDs[s]].push(C.default.extend(c.rangeByInfo[0],{temporary:!1})),e.edgeIntersections[e.edgeIDs[s]].push(C.default.extend(c.rangeByInfo[1],{temporary:!1})),e.edgeOverlapRegions[e.edgeIDs[t]].push({overlapRange:(0,n.convertToOtherPeriodicRange)([c.rangeInfo[0].param,c.rangeInfo[1].param],r.getRange(),r.getCurve().getPeriod(),o.KERNEL_TOLERANCE),otherEdge:e.edgeIDs[s],otherRange:(0,n.convertToOtherPeriodicRange)([c.rangeByInfo[0].param,c.rangeByInfo[1].param],a.getRange(),a.getCurve().getPeriod(),o.KERNEL_TOLERANCE)}),e.edgeOverlapRegions[e.edgeIDs[s]].push({overlapRange:(0,n.convertToOtherPeriodicRange)([c.rangeByInfo[0].param,c.rangeByInfo[1].param],a.getRange(),a.getCurve().getPeriod(),o.KERNEL_TOLERANCE),otherEdge:e.edgeIDs[t],otherRange:(0,n.convertToOtherPeriodicRange)([c.rangeInfo[0].param,c.rangeInfo[1].param],r.getRange(),r.getCurve().getPeriod(),o.KERNEL_TOLERANCE)});else{if(c.cutInfo.param<r.t0()||c.cutInfo.param>r.t1()){A.DebugUtils.warn("Intersection outside the bounds of the edge, ignoring");continue}e.edgeIntersections[e.edgeIDs[t]].push(C.default.defaults(c.cutInfo,{temporary:!1,virtualIntersection:!1})),e.edgeIntersections[e.edgeIDs[s]].push(C.default.defaults(c.cutByInfo,{temporary:!1,virtualIntersection:!1}))}}}var h=r.getStartVertex(),d=r.getEndVertex(),p=r.t0();h&&void 0!==C.default.findWhere(e.edgeIntersections[e.edgeIDs[t]],{param:p,atVertex:h})||e.edgeIntersections[e.edgeIDs[t]].push({param:p,atVertex:h,temporary:!1,virtualIntersection:void 0});var g=r.t1();d&&void 0!==C.default.findWhere(e.edgeIntersections[e.edgeIDs[t]],{param:g,atVertex:d})||e.edgeIntersections[e.edgeIDs[t]].push({param:g,atVertex:d,temporary:!1,virtualIntersection:void 0}),this._makeEdgeXMonotone(r,e.edgeIntersections[e.edgeIDs[t]])}var v=[];for(t=0;t<e.edgeIDs.length;t++)for(s=0;s<e.edgeIntersections[e.edgeIDs[t]].length;s++)v.push({position:e.edges[e.edgeIDs[t]].evaluatePosition(e.edgeIntersections[e.edgeIDs[t]][s].param),virtualIntersection:e.edgeIntersections[e.edgeIDs[t]][s].virtualIntersection});for(t=0;t<e.edgeIDs.length;t++){var y=e.edges[e.edgeIDs[t]];for(s=0;s<v.length;s++){var m=v[s];if(y.getBoundingBox().isPointInsideWithTolerance(m.position,o.KERNEL_TOLERANCE)){var _=y.closestToPointParam(m.position);i.Vector3.distance(m.position,y.evaluatePosition(_))<o.KERNEL_TOLERANCE&&_>y.t0()+o.PARAMETER_SPACE_TOLERANCE&&_<y.t1()-o.PARAMETER_SPACE_TOLERANCE&&e.edgeIntersections[e.edgeIDs[t]].push({param:_,atVertex:null,temporary:!0,virtualIntersection:m.virtualIntersection})}}}},T.prototype._addGraphEdges=function(){var e=this._workspace;this._intersectionVertices=[],this._edgeSegments=[];for(var t=function(t,r){var i=e.segmentBlackList[t],s=e.edges[t].getCurve(),a=s.getPeriod(),l=e.edges[t].isReversed()?-1:1,u=o.KERNEL_TOLERANCE/s.tangentLength(l*r[0]),c=o.KERNEL_TOLERANCE/s.tangentLength(l*r[1]);if(e.edges[t].getCurve().isPeriodic()){for(var h=0;h<i.length;h++)if((0,n.periodicDifference)(i[h].range[0],r[0],a)<u&&(0,n.periodicDifference)(i[h].range[1],r[1],a)<c)return i[h].edge}else for(h=0;h<i.length;h++)if(Math.abs(i[h].range[0]-r[0])<u&&Math.abs(i[h].range[1]-r[1])<c)return i[h].edge},r=0;r<e.edgeIDs.length;r++){var s=e.edges[e.edgeIDs[r]],a=1,l=this._createGUIDfromEdgeAndLocalID(s,a);e.edgeIntersections[e.edgeIDs[r]]=e.edgeIntersections[e.edgeIDs[r]].sort((function(e,t){return e.param-t.param}));for(var u=e.edgeIntersections[e.edgeIDs[r]],c=void 0,h=0;h<u.length;h++){var d=s.evaluatePosition(u[h].param),p=this._findVertexIndex(d);void 0===p?(p=this._intersectionVertices.length,this._intersectionVertices.push({position:d,adjacentEdges:[],vertices:[],index:p,guidList:[],mergedPositions:[],topologyVertex:void 0,temporary:u[h].temporary,virtualIntersection:u[h].virtualIntersection})):(this._intersectionVertices[p].temporary=this._intersectionVertices[p].temporary&&u[h].temporary,void 0!==u[h].virtualIntersection&&(void 0===this._intersectionVertices[p].virtualIntersection?this._intersectionVertices[p].virtualIntersection=u[h].virtualIntersection:this._intersectionVertices[p].virtualIntersection=this._intersectionVertices[p].virtualIntersection&&u[h].virtualIntersection),this._intersectionVertices[p].mergedPositions.push(d));var f=this._intersectionVertices[p];if(u[h].atVertex&&-1===f.vertices.indexOf(u[h].atVertex)&&f.vertices.push(u[h].atVertex),h>0&&c!==p){l=this._createGUIDfromEdgeAndLocalID(s,a),a++;var g=[u[h-1].param,u[h].param],v=t(s.getGuid(),g);if(void 0===v){var y={originalEdge:s,parameterRange:g,startVertex:this._intersectionVertices[c],endVertex:this._intersectionVertices[p],coincidentRanges:[],adjacent:[{prevEdge:void 0,nextEdge:void 0,face:void 0},{prevEdge:void 0,nextEdge:void 0,face:void 0}],index:this._edgeSegments.length,localGuid:l,topologyEdge:void 0};this._edgeSegments.push(y),this._intersectionVertices[c].adjacentEdges.push(y),this._intersectionVertices[p].adjacentEdges.push(y);for(var m=0;m<e.edgeOverlapRegions[e.edgeIDs[r]].length;m++){var _=e.edgeOverlapRegions[e.edgeIDs[r]][m],E=g,x=o.KERNEL_TOLERANCE;if(s.getCurve().isPeriodic()&&(s.getCurveType()===o.GEOMETRY_TYPES.CIRCLE&&(x/=s.getCurve().getRadius()),E=(0,n.convertToOtherPeriodicRange)(E,s.getRange(),s.getCurve().getPeriod(),x)),E[0]>=_.overlapRange[0]-o.KERNEL_TOLERANCE&&E[1]<=_.overlapRange[1]+o.KERNEL_TOLERANCE){var b=_.otherEdge,A=[e.edges[b].getCurve().closestToPointParam(y.startVertex.position),e.edges[b].getCurve().closestToPointParam(y.endVertex.position)];if(e.edges[b].getCurve().isPeriodic()){var C=y.originalEdge.getCurve().evaluateDt(y.parameterRange[0]),T=e.edges[b].getCurve().evaluateDt(A[0]);for(i.Vector3.dot(C,T)<0&&(P=A[0],A[0]=A[1],A[1]=P);A[1]<A[0];)A[1]+=e.edges[b].getCurve().getPeriod()}else if(A[0]>A[1]){var P=A[0];A[0]=A[1],A[1]=P}e.segmentBlackList[_.otherEdge].push({range:A,edge:y})}}}else{var R,S=i.Vector3.distance(v.startVertex.position,s.evaluatePosition(g[0]))>i.Vector3.distance(v.startVertex.position,s.evaluatePosition(g[1]));if(v.coincidentRanges.push({originalEdge:s,parameterRange:g,localGuid:l,flipped:S}),0===f.adjacentEdges.length&&((R=i.Vector3.distance(d,v.startVertex.position)<i.Vector3.distance(d,v.endVertex.position)?v.startVertex:v.endVertex).mergedPositions.push(d),d=R.position,p=R.index,u[h].atVertex&&-1===R.vertices.indexOf(u[h].atVertex)&&R.vertices.push(u[h].atVertex),this._intersectionVertices.pop()),v.startVertex.index!==c&&v.endVertex.index!==c){var V=v.startVertex.index===p?v.endVertex:v.startVertex,w=this._intersectionVertices[c];for(m=0;m<w.adjacentEdges.length;m++){var M=w.adjacentEdges[m];M.startVertex===w&&(M.startVertex=V),M.endVertex===w&&(M.endVertex=V),V.adjacentEdges.push(M)}for(V.mergedPositions.push(w.position),m=0;m<w.mergedPositions.length;m++)V.mergedPositions.push(w.mergedPositions[m]);for(u[h].atVertex&&-1===V.vertices.indexOf(u[h].atVertex)&&V.vertices.push(u[h].atVertex),this._intersectionVertices.splice(c,1),m=c;m<this._intersectionVertices.length;m++)this._intersectionVertices[m].index=m}}}c=p}}},T.prototype._mergeCoincidentSegments=function(){for(var e,t={},r=0;r<this._intersectionVertices.length;r++){for(var i=this._intersectionVertices[r],n={},s=0;s<i.adjacentEdges.length;s++){var a=(e=i.adjacentEdges[s]).startVertex===i?e.endVertex:e.startVertex;t[String(i.index)+"_"+String(a.index)]||(n[String(a.index)]=n[String(a.index)]||[],n[String(a.index)].push(e))}var l=C.default.keys(n);for(s=0;s<l.length;s++)if(t[l[s]+"_"+String(i.index)]=!0,n[l[s]].length>1)for(var u=n[l[s]],c=0;c<u.length;c++){for(var h=[],d=c+1;d<u.length;d++)(0,g.curvesAreCoincident)(u[c].originalEdge.getCurve(),u[d].originalEdge.getCurve(),u[c].parameterRange,u[d].parameterRange,o.KERNEL_TOLERANCE)&&(h.push(u[d]),u.splice(d,1),d--);for(d=0;d<h.length;d++){var p=h[d];u[c].coincidentRanges.push({originalEdge:p.originalEdge,parameterRange:p.parameterRange,localGuid:p.localGuid,flipped:p.startVertex!==u[c].startVertex}),p.startVertex.adjacentEdges.splice(p.startVertex.adjacentEdges.indexOf(p),1),p.endVertex.adjacentEdges.splice(p.endVertex.adjacentEdges.indexOf(p),1);var f=this._edgeSegments.indexOf(p);this._edgeSegments.splice(f,1);for(var v=f;v<this._edgeSegments.length;v++)this._edgeSegments[v].index=v}}}},T.prototype._sortEdgesAroundVertex=function(){for(var e=0;e<this._intersectionVertices.length;e++){for(var t=this._intersectionVertices[e],r=[],s=0;s<t.adjacentEdges.length;s++){var a=this._computeAngleAndPositionForEdge(s,t);r.push({index:s,originalAngle:a.angle,angle:a.angle,position:a.position,derivative:void 0})}for(var l=0,u=!1;!u;){u=!0;var c=-Math.PI+l;for(s=0;s<r.length;s++)if((0,n.angleDifference)(c,r[s].angle)<1e-5){u=!1;break}if(u)break;l+=2e-5}for(s=0;s<t.adjacentEdges.length;s++)r[s].angle=(0,n.normalizeParameterToShiftedRange)(r[s].angle-l,[-Math.PI,Math.PI]);var h=this;r=r.sort((function(e,r){if((0,n.angleDifference)(e.angle,r.angle)>1e-5)return e.angle-r.angle;var s=t.adjacentEdges[e.index],a=t.adjacentEdges[r.index],l=s.startVertex===t?s.parameterRange[0]:s.parameterRange[1],u=a.startVertex===t?a.parameterRange[0]:a.parameterRange[1],c=s.originalEdge.evaluatePosition(l),d=a.originalEdge.evaluatePosition(u),p=i.Vector3.distance(c,d),f=i.Vector3.createFloat64(),g=i.Vector3.createFloat64(),v=s.originalEdge.evaluateCurvature(l,f),y=a.originalEdge.evaluateCurvature(u,g);if(0===v&&0===y)return e.angle-r.angle;if(0===v||0===y){var m=1/Math.max(v,y);p+=1.5*Math.sqrt(Math.pow(m,2)-Math.pow(m-p,2))+o.KERNEL_TOLERANCE}else{var _=1/v,E=1/y;if(_<E){var x=_;_=E,E=x}i.Vector3.dot(f,g)<0?p+=-Math.sqrt(-.25*Math.pow(p,4)+Math.pow(p,3)*_-p*p*_*_-(p*p-2*p*_)*E*E+(p*p*p-3*p*p*_+2*p*_*_)*E)/(p-_-E)*1.5:p+=Math.sqrt(-.25*Math.pow(p,4)-Math.pow(p,3)*_-p*p*_*_-(p*p+2*p*_)*E*E+(p*p*p+3*p*p*_+2*p*_*_)*E)/(p+_-E)*1.5}var b=Math.min(i.Vector3.distance(s.endVertex.position,s.startVertex.position),i.Vector3.distance(a.endVertex.position,a.startVertex.position));p=Math.max(o.KERNEL_TOLERANCE,p),p=Math.min(.9*b,p);var A=!1;do{var C=h._computeEdgeDirectionAtVertex(e,t,p),T=h._computeEdgeDirectionAtVertex(r,t,p);A=(0,n.angleDifference)(C,T)>1e-8,p*=5}while(!A&&p<b);var P=C-T;return P>Math.PI?P-=n.PI2:P<-Math.PI&&(P+=n.PI2),P})),t.adjacentEdges=C.default.map(r,(function(e){return t.adjacentEdges[e.index]}))}},T.prototype._assignAdjacentEdges=function(){for(var e=0;e<this._edgeSegments.length;e++){var t=this._edgeSegments[e];this._assignAdjacentEdgesToSegment(t)}},T.prototype._assignAdjacentEdgesToSegment=function(e){var t=e.startVertex.adjacentEdges,r=t.indexOf(e);b.ConsoleUtils.assert(-1!==r,"Error in topology");for(var i=0,o=e.endVertex.adjacentEdges;i<o.length&&o[i]!==e;)i++;b.ConsoleUtils.assert(i<o.length,"Error in topology"),e.adjacent[this.SIDE.LEFT].nextEdge=o[(0,n.modulus)(i-1,o.length)],e.adjacent[this.SIDE.LEFT].prevEdge=t[(0,n.modulus)(r+1,t.length)],e.adjacent[this.SIDE.RIGHT].nextEdge=o[(0,n.modulus)(i+1,o.length)],e.adjacent[this.SIDE.RIGHT].prevEdge=t[(0,n.modulus)(r-1,t.length)]},T.prototype._sweepRegions=function(){var e=this._workspace,t=C.default.clone(this._intersectionVertices).sort((function(e,t){if(Math.abs(e.position[0]-t.position[0])<1e-9){for(var r=0;r<e.adjacentEdges.length;r++)for(var n=0;n<t.adjacentEdges.length;n++)if(e.adjacentEdges[r].originalEdge===t.adjacentEdges[n].originalEdge){var s=e.adjacentEdges[r],a=t.adjacentEdges[n],l=s.startVertex===e?s.parameterRange[0]:s.parameterRange[1],u=a.startVertex===t?a.parameterRange[0]:a.parameterRange[1],c=!0,h=i.Vector3.createFloat64();i.Vector3.normalize(h,s.originalEdge.evaluateDt(l));var d=i.Vector3.createFloat64();if(i.Vector3.normalize(d,a.originalEdge.evaluateDt(u)),Math.sign(h[0])!==Math.sign(d[0]))continue;if(Math.abs(h[0])>o.KERNEL_TOLERANCE&&Math.abs(d[0])>o.KERNEL_TOLERANCE)c=h[0]>0;else{if(Math.abs(e.position[1]-t.position[1])<o.KERNEL_TOLERANCE)continue;c=h[1]>0}return(l-u)*(c?1:-1)}return e.position[1]-t.position[1]}return e.position[0]-t.position[0]}));this._cells=[];var r={index:-1,loops:[],loopOrientations:[],dangling:[],leftmostVertex:void 0};e.sweepLineIntersections=[-1/0,1/0],e.sweepLineRegions=e.sweepLineRegions=[r];for(var n=[],s=0;s<t.length;s++){e.sweepLineRegions.length!==e.sweepLineIntersections.length-1&&console.error("Error during sweep computation");var a=t[s],l=C.default.clone(a.adjacentEdges),u=void 0;if(n[a.index]){for(var c=n[a.index],h=[],d=0;d<e.sweepLineIntersections.length-1;d++)C.default.contains(c,e.sweepLineIntersections[d])&&(void 0===u&&(u=d-1),C.default.contains(c,e.sweepLineIntersections[d+1])&&h.push(d));for(d=0;d<c.length;d++){for(var p=c[d],f=0;f<e.sweepLineIntersections.length;f++)e.sweepLineIntersections[f]===p&&e.sweepLineIntersections.splice(f,1);for(f=0;f<l.length;f++)l[f]===p&&l.splice(f,1)}for(d=h.length-1;d>=0;d--)e.sweepLineRegions.splice(h[d],1)}else u=this._findVertexOnSweepLine(a),e.sweepLineRegions.splice(u+1,0,e.sweepLineRegions[u]);if(l.length>0){var g=u+1;for(d=0;d<l.length;d++){var v=l[d];e.sweepLineIntersections.splice(g,0,v);var y=v.startVertex===a?v.endVertex:v.startVertex;if(void 0===n[y.index]&&(n[y.index]=[]),n[y.index].push(v),d>0){var m={index:this._cells.length,loops:[],loopOrientations:[],dangling:[],leftmostVertex:a};this._cells.push(m),e.sweepLineRegions.splice(g-1,0,m)}g++}for(g=u,d=0;d<l.length;d++){var _=(v=l[d]).startVertex!==a;v.adjacent[_?this.SIDE.RIGHT:this.SIDE.LEFT].face=e.sweepLineRegions[g+1],v.adjacent[_?this.SIDE.LEFT:this.SIDE.RIGHT].face=e.sweepLineRegions[g],g++}}else if(e.sweepLineRegions[u]!==e.sweepLineRegions[u+1]){var E=e.sweepLineRegions[u+1],x=e.sweepLineRegions[u];for(x===r?(x=E,E=r,e.sweepLineRegions.splice(u,1)):(void 0!==x.leftmostVertex&&(void 0===E.leftmostVertex||E.leftmostVertex.position[0]>x.leftmostVertex.position[0])&&(E.leftmostVertex=x.leftmostVertex),e.sweepLineRegions.splice(u+1,1)),d=0;d<this._edgeSegments.length;d++)this._edgeSegments[d].adjacent[this.SIDE.LEFT].face===x&&(this._edgeSegments[d].adjacent[this.SIDE.LEFT].face=E),this._edgeSegments[d].adjacent[this.SIDE.RIGHT].face===x&&(this._edgeSegments[d].adjacent[this.SIDE.RIGHT].face=E);for(d=0;d<e.sweepLineRegions.length;d++)e.sweepLineRegions[d]===x&&(e.sweepLineRegions[d]=E);this._cells[x.index]=void 0}else e.sweepLineRegions.splice(u+1,1)}for(s=0;s<this._cells.length;s++)void 0===this._cells[s]&&(this._cells.splice(s,1),s--);for(s=0;s<this._cells.length;s++)this._cells[s].index=s},T.prototype._assignleftmostEdges=function(){for(var e=this,t=0;t<this._cells.length;t++){var r=this._cells[t],i=r.leftmostVertex,n=C.default.filter(i.adjacentEdges,(function(t){var i=t.adjacent[e.SIDE.LEFT].face,n=t.adjacent[e.SIDE.RIGHT].face;return(i===r||n===r)&&i!==n}));if(b.ConsoleUtils.assert(n.length>=2,"In each loop there should be at least two adjacent edges"),n.length>2)for(var o=0;o<n.length;o++){var s=n[o].adjacent[e.SIDE.LEFT].face===r?e.SIDE.LEFT:e.SIDE.RIGHT,a=n[o].adjacent[s],l=n[o].startVertex===i?a.prevEdge:a.nextEdge;if(C.default.contains(n,l)){n=[n[o],l];break}}var u=n[0];u.loopsCurveAligned=!!(u.startVertex===i^n[0].adjacent[e.SIDE.RIGHT].face===r),r.leftmostEdge=u,r.leftmostVertex=void 0}},T.prototype._removeGrazingIntersectionVertices=function(){for(var e={},t=0,r=this._intersectionVertices.slice();r.length>0;){var i=r.pop();if(2===i.adjacentEdges.length&&(1===i.adjacentEdges[0].coincidentRanges.length||1===i.adjacentEdges[1].coincidentRanges.length)&&i.virtualIntersection){var o,s,a=1===i.adjacentEdges[0].coincidentRanges.length&&1===i.adjacentEdges[1].coincidentRanges.length,l=i.adjacentEdges.slice();if(a){if(o=[l[0].originalEdge,l[0].coincidentRanges[0].originalEdge],s=[l[1].originalEdge,l[1].coincidentRanges[0].originalEdge],!(o[0]===s[0]&&o[1]===s[1]||o[0]===s[1]&&o[1]===s[0]))continue;e[l[0].originalEdge.getGuid()]=!0,e[l[0].coincidentRanges[0].originalEdge.getGuid()]=!0,e[l[1].originalEdge.getGuid()]=!0,e[l[1].coincidentRanges[0].originalEdge]=!0;var u=[l[0].startVertex===i?l[0].endVertex:l[0].startVertex,i,l[1].startVertex===i?l[1].endVertex:l[1].startVertex]}else{var c;l[0].coincidentRanges.length>0?(c=0,o=[l[0].originalEdge,l[0].coincidentRanges[0].originalEdge]):(c=1,o=[l[1].originalEdge,l[1].coincidentRanges[0].originalEdge]),e[o[0].getGuid()]=!0,e[o[1].getGuid()]=!0,u=[l[c].startVertex===i?l[c].endVertex:l[c].startVertex,i],l=[l[c]]}var h=void 0,d=void 0;if(u[0].vertices.length>0?(h=u[0],d=a?[u[1],u[2]]:[u[1]]):a&&u[2].vertices.length>0?(h=u[2],d=[u[0],u[1]]):(h=u[1],d=a?[u[0],u[2]]:[u[0]]),d[0].vertices.length>0||d[1]&&(d[1].vertices.length>0||d[0]===d[1]))continue;for(var p=!0,f=C.default.without(d,i),g=0;g<f.length;g++){var v=f[g].adjacentEdges;if((v=C.default.difference(v,l)).length>2){p=!1;break}for(var y=0;y<v.length;y++)if(v[y].coincidentRanges.length>0||v[y].originalEdge!==o[0]&&v[y].originalEdge!==o[1]){p=!1;break}}if(!p)continue;for(g=0;g<f.length;g++){var m=f[g],_=C.default.intersection(l,m.adjacentEdges)[0],E=i!==h&&a?C.default.without(l,_)[0]:_,x=C.default.without(m.adjacentEdges,_);for(m.adjacentEdges[1]===_&&(x=x.reverse()),y=0;y<x.length;y++){var b=x[y],A=E.startVertex===h?0:1,T=void 0;if(E.originalEdge===b.originalEdge)T=E.parameterRange[A];else{var P=E.coincidentRanges[0].flipped?1-A:A;T=E.coincidentRanges[0].parameterRange[P]}b.startVertex===m?(b.startVertex=h,b.parameterRange[0]=T):(b.endVertex=h,b.parameterRange[1]=T);for(var R=0;R<b.adjacent.length;R++){var S=b.adjacent[R].face;S.leftmostEdge!==_&&S.leftmostEdge!==E||(b.loopsCurveAligned=S.leftmostEdge.loopsCurveAligned,S.leftmostEdge=b),(S.leftmostVertex===d[0]||void 0!==d[1]&&S.leftmostVertex===d[1])&&(S.leftmostVertex=h)}}var V=h.adjacentEdges.indexOf(E);Array.prototype.splice.apply(h.adjacentEdges,[V,1].concat(x));var w=h.adjacentEdges.length,M=[(0,n.modulus)(V-1,w),V,V+1,(V+2)%w];for(y=0;y<M.length;y++){var L=h.adjacentEdges[M[y]];this._assignAdjacentEdgesToSegment(L)}}this._intersectionVertices=C.default.difference(this._intersectionVertices,d),r=C.default.difference(r,d),this._edgeSegments=C.default.difference(this._edgeSegments,l),t++}}if(t>0){for(var O=0;O<this._intersectionVertices.length;O++)this._intersectionVertices[O].index=O;for(O=0;O<this._edgeSegments.length;O++)this._edgeSegments[O].index=O}var k=C.default.keys(e);for(O=0;O<k.length;O++){var I=k[O],F=[];for(g=0;g<this._edgeSegments.length;g++)for((N=this._edgeSegments[g]).originalEdge.getGuid()===I&&F.push([N,N.parameterRange[0]]),y=0;y<N.coincidentRanges.length;y++)N.coincidentRanges[y].originalEdge.getGuid()===I&&F.push([N,N.coincidentRanges[y].parameterRange[0]]);for(F.sort((function(e,t){return e[1]-t[1]})),g=0;g<F.length;g++){var N;for((N=F[g][0]).originalEdge.getGuid()===I&&(N.localGuid=this._createGUIDfromEdgeAndLocalID(N.originalEdge,g+1)),y=0;y<N.coincidentRanges.length;y++)N.coincidentRanges[y].originalEdge.getGuid()===I&&(N.coincidentRanges[y].localGuid=this._createGUIDfromEdgeAndLocalID(N.coincidentRanges[y].originalEdge,g+1))}}},T.prototype._removeTemporaryVertices=function(){for(var e=0,t=0;t<this._intersectionVertices.length;t++){var r=this._intersectionVertices[t];if(r.temporary&&2===r.adjacentEdges.length&&r.adjacentEdges[0].originalEdge===r.adjacentEdges[1].originalEdge&&r.adjacentEdges[0]!==r.adjacentEdges[1]){var i,n;r.adjacentEdges[0].endVertex===r?(i=r.adjacentEdges[0],n=r.adjacentEdges[1]):(i=r.adjacentEdges[1],n=r.adjacentEdges[0]),b.ConsoleUtils.assert(i.adjacent[this.SIDE.LEFT].face===n.adjacent[this.SIDE.LEFT].face),b.ConsoleUtils.assert(i.adjacent[this.SIDE.RIGHT].face===n.adjacent[this.SIDE.RIGHT].face);var s=i.parameterRange[1]-n.parameterRange[0],a=(i.originalEdge.isReversed()?-1:1)*i.parameterRange[0],l=o.KERNEL_TOLERANCE/i.originalEdge.getCurve().tangentLength(a);if(i.originalEdge.getCurve().isPeriodic()&&Math.abs(s-i.originalEdge.getCurve().getPeriod())<l)i.parameterRange[1]=n.parameterRange[1]+s;else{if(Math.abs(s)>l)continue;i.parameterRange[1]=n.parameterRange[1]}i.endVertex=n.endVertex,i.adjacent[this.SIDE.LEFT].nextEdge=n.adjacent[this.SIDE.LEFT].nextEdge,i.adjacent[this.SIDE.RIGHT].nextEdge=n.adjacent[this.SIDE.RIGHT].nextEdge,i.adjacent[this.SIDE.LEFT].prevEdge===n&&(i.adjacent[this.SIDE.LEFT].prevEdge=i),i.adjacent[this.SIDE.RIGHT].prevEdge===n&&(i.adjacent[this.SIDE.RIGHT].prevEdge=i);var u=i.adjacent[this.SIDE.LEFT].nextEdge;u.adjacent[this.SIDE.LEFT].prevEdge===n&&(u.adjacent[this.SIDE.LEFT].prevEdge=i),u.adjacent[this.SIDE.LEFT].nextEdge===n&&(u.adjacent[this.SIDE.LEFT].nextEdge=i),u.adjacent[this.SIDE.RIGHT].prevEdge===n&&(u.adjacent[this.SIDE.RIGHT].prevEdge=i),u.adjacent[this.SIDE.RIGHT].nextEdge===n&&(u.adjacent[this.SIDE.RIGHT].nextEdge=i);var c=i.adjacent[this.SIDE.RIGHT].nextEdge;c.adjacent[this.SIDE.LEFT].prevEdge===n&&(c.adjacent[this.SIDE.LEFT].prevEdge=i),c.adjacent[this.SIDE.LEFT].nextEdge===n&&(c.adjacent[this.SIDE.LEFT].nextEdge=i),c.adjacent[this.SIDE.RIGHT].prevEdge===n&&(c.adjacent[this.SIDE.RIGHT].prevEdge=i),c.adjacent[this.SIDE.RIGHT].nextEdge===n&&(c.adjacent[this.SIDE.RIGHT].nextEdge=i),n.adjacent[this.SIDE.LEFT].face.leftmostEdge===n&&(n.adjacent[this.SIDE.LEFT].face.leftmostEdge=i),n.adjacent[this.SIDE.RIGHT].face.leftmostEdge===n&&(n.adjacent[this.SIDE.RIGHT].face.leftmostEdge=i),void 0===i.loopsCurveAligned&&(i.loopsCurveAligned=n.loopsCurveAligned),(0,v.hashCombine4xUint32)(i.localGuid,n.localGuid,i.localGuid);var h=i.endVertex.adjacentEdges.indexOf(n);i.endVertex.adjacentEdges[h]=i,this._intersectionVertices.splice(t,1),this._edgeSegments.splice(n.index-e,1),t--,e++}else this._intersectionVertices[t].index-=e}for(t=0;t<this._edgeSegments.length;t++)this._edgeSegments[t].index=t},T.prototype._updateVertexGuidLists=function(){for(var e=0;e<this._intersectionVertices.length;e++){var t=this._intersectionVertices[e];if(t.vertices.length>0)for(var r=0;r<t.vertices.length;r++)t.guidList.push((0,v.guidToUint32x4)(t.vertices[r].getGuid()));else{var i={};for(r=0;r<t.adjacentEdges.length;r++){var n=t.adjacentEdges[r];if(!i[n.index]){i[n.index]=!0,t.guidList.push(n.localGuid);for(var o=0;o<n.coincidentRanges.length;o++)t.guidList.push(n.coincidentRanges[o].localGuid)}}}}},T.prototype._assignLoops=function(){var e=this._workspace;e.edgesPerCell=[];for(var t=0;t<this._cells.length;t++)e.edgesPerCell[t]=[];for(t=0;t<this._edgeSegments.length;t++){var r=this._edgeSegments[t],i=r.adjacent[this.SIDE.LEFT].face.index;i>=0&&e.edgesPerCell[i].push(r);var n=r.adjacent[this.SIDE.RIGHT].face.index;n>=0&&i!==n&&e.edgesPerCell[n].push(r)}var o=[];for(t=0;t<this._cells.length;t++){var s=[];o[t]=s;for(var a=this._followLoopFromEdge(this._cells[t].leftmostEdge,this._cells[t],!1,!0),l=0;l<a.loop.length;l++)s[a.loop[l].index]=!0;this._cells[t].loops.push(a.loop),this._cells[t].loopOrientations.push(a.orientations)}for(t=0;t<this._cells.length;t++){s=o[t];for(var u=0;u<e.edgesPerCell[t].length;u++){var c=e.edgesPerCell[t][u];if(c.adjacent[this.SIDE.LEFT].face!==c.adjacent[this.SIDE.RIGHT].face){if(!0!==s[c.index]){for(a=this._followLoopFromEdge(c,this._cells[t],!0,!1),l=0;l<a.loop.length;l++)s[a.loop[l].index]=!0;this._cells[t].loops.push(a.loop),this._cells[t].loopOrientations.push(a.orientations)}}else this._cells[t].dangling.push(c)}}},T.prototype._updateSketchRegionTopology=function(){for(var e=this._workspace,t=C.default.keys(this._sketchRegionTopologies),r=0;r<t.length;r++){var i=t[r];this._sketchRegionTopologies[i].updated=!1,"FaceID"===this._sketchRegionTopologies[i].topology.tuid&&this._sketchRegionTopologies[i].topology.removeAllEdges()}var n={},s={};for(r=0;r<this._intersectionVertices.length;r++){var a=this._addOrFindTopologySubcomponent("VertexID",o.GEOMETRY_TYPES.POINT,this._intersectionVertices[r].guidList,s);a.setPoint(new h.Point(this._intersectionVertices[r].position)),a.setAssociatedEntities(C.default.clone(this._intersectionVertices[r].vertices));for(var l=0;l<this._intersectionVertices[r].vertices.length;++l){var u=this._intersectionVertices[r].vertices[l].getGuid();b.ConsoleUtils.assert(!n[u],"vertex should only map to one topology vertex"),n[u]=a}this._intersectionVertices[r].topologyVertex=a}for(r=0;r<this._edgeSegments.length;r++){var c=this._edgeSegments[r],f=[c.localGuid];for(l=0;l<c.coincidentRanges.length;l++)f.push(c.coincidentRanges[l].localGuid);(T=this._addOrFindTopologySubcomponent("EdgeID",c.originalEdge.getCurveType(),f,s)).setToEdgeSegment(c.originalEdge,c.parameterRange),T.setStartVertex(c.startVertex.topologyVertex),T.setEndVertex(c.endVertex.topologyVertex);var g=[{edge:c.originalEdge,range:C.default.clone(c.parameterRange),flipped:!1}];for(l=0;l<c.coincidentRanges.length;l++)g.push({edge:c.coincidentRanges[l].originalEdge,range:C.default.clone(c.coincidentRanges[l].parameterRange),flipped:c.coincidentRanges[l].flipped});T.setAssociatedEdges(g),c.topologyEdge=T}for(r=0;r<this._cells.length;r++){var y=this._cells[r];for(f=[],l=0;l<e.edgesPerCell[r].length;l++)f.push((0,v.guidToUint32x4)(e.edgesPerCell[r][l].topologyEdge.getGuid()));var m=this._addOrFindTopologySubcomponent("FaceID",o.GEOMETRY_TYPES.PLANE,f,s);m.setSurface(this._planeGeometry);var _=[];for(l=0;l<y.loops.length;l++){var E=new d.Loop;E.setFace(m),_.push(E);for(var x=[],A=0;A<y.loops[l].length;A++){var T=y.loops[l][A].topologyEdge,P=new p.Coedge;P.setLoop(E),x.push(P),P.setEdge(T),P.setReversed(!y.loopOrientations[l][A]),T.getCoedge()?T.getCoedge().getPartner()||(T.getCoedge().setPartner(P),P.setPartner(T.getCoedge())):T.setCoedge(P),y.loops[l][A].topologyEdge.setIsDangling(!1)}E.setCoedges(x)}for(m.setLoops(_),this._faces.push(m),l=0;l<y.dangling.length;l++)m.addDanglingEdge(y.dangling[l].topologyEdge),y.dangling[l].topologyEdge.setIsDangling(!0)}for(r=0;r<t.length;r++)this._sketchRegionTopologies[t[r]].updated||delete this._sketchRegionTopologies[t[r]]},T.prototype._followLoopFromEdge=function(e,t,r,i){var n=[],o=[],s=e,a=[],l=e.adjacent[this.SIDE.LEFT].face===t?this.SIDE.LEFT:this.SIDE.RIGHT,u=!!(s.loopsCurveAligned^l!==this.SIDE.LEFT),c=u?e.startVertex:e.endVertex;do{if(s.adjacent[l].face!==t){console.error("REGION: Adjacent edge face does not match cell! FIXME!");break}if(a[s.index]){console.error("REGION: Malformed edges; walking edge lead us to despair");break}a[s.index]=!0,n.push(s),o.push(u);do{u?(c=s.endVertex,s=s.adjacent[l].nextEdge):(c=s.startVertex,s=s.adjacent[l].prevEdge),s.startVertex===s.endVertex?l=s.adjacent[this.SIDE.LEFT].face===t?this.SIDE.LEFT:this.SIDE.RIGHT:(l=s.startVertex===c?this.SIDE.LEFT:this.SIDE.RIGHT,s.adjacent[this.SIDE.LEFT].face===s.adjacent[this.SIDE.RIGHT].face&&(l=1-l,c=s.startVertex===c?s.endVertex:s.startVertex)),u=l===this.SIDE.LEFT}while(s.adjacent[this.SIDE.LEFT].face===s.adjacent[this.SIDE.RIGHT].face);i&&void 0===s.loopsCurveAligned&&(s.loopsCurveAligned=!!(u^l!==this.SIDE.LEFT))}while(s!==e);return{loop:n,orientations:o}},T.prototype._addNewRegionTopology=function(e){switch(e.tuid){case"VertexID":var t=new E.RegionTopologyVertex(new h.Point);return t.setGuid(e.guid),t;case"EdgeID":var r=void 0;switch(e.minortype){case o.GEOMETRY_TYPES.LINE:r=new a.Line;break;case o.GEOMETRY_TYPES.CIRCLE:r=new l.Circle;break;case o.GEOMETRY_TYPES.ELLIPSE:r=new c.Ellipse;break;case o.GEOMETRY_TYPES.BCURVE:r=new u.BCurve;break;default:console.error("Unhandled curve type")}var i=new E.RegionTopologyEdge(r);return i.setGuid(e.guid),i;case"FaceID":r=void 0,e.minortype===o.GEOMETRY_TYPES.PLANE?r=new s.Plane:console.error("Unhandled surface type");var n=new E.RegionTopologyFace(r);return n.setGuid(e.guid),n;default:console.error("Unhandled topology type")}},T.prototype._addOrFindTopologySubcomponent=function(e,t,r,i){var n=this._createNameFromGuidList(e,t,r,i);if(this._sketchRegionTopologies[n]){var o=this._sketchRegionTopologies[n];return o.updated=!0,o.topology}var s=this._addNewRegionTopology({tuid:e,minortype:t,guid:n});return this._sketchRegionTopologies[n]={topology:s,updated:!0},s};var P={VertexID:[1168004130,3764602020,2270554856,1368826480],EdgeID:[2942887333,1472546498,2159971906,413489693],FaceID:[2166479754,2329626594,2838556660,1584616933]},R={};R[o.GEOMETRY_TYPES.POINT]=[2299429810,2248164535,3202574069,2684287321],R[o.GEOMETRY_TYPES.LINE]=[910992607,3428993096,3010390753,2966835859],R[o.GEOMETRY_TYPES.CIRCLE]=[2229232555,842549819,2526558959,4217038233],R[o.GEOMETRY_TYPES.PLANE]=[2122299449,3667741317,2812958731,939246365],R[o.GEOMETRY_TYPES.BCURVE]=[420548527,2703575863,2792852189,2595995847],R[o.GEOMETRY_TYPES.ELLIPSE]=[902753991,1129557208,9277753211,1913737389];var S=function(e,t){var r=2166136261;return t&&(r=16777619*(r^t)>>>0),16777619*(((r=16777619*(((r=16777619*(((r=16777619*((r^255&e)>>>0)>>>0)^e>>8&255)>>>0)>>>0)^e>>16&255)>>>0)>>>0)^e>>24&255)>>>0)>>>0},V=function(){var e=new Uint32Array(4);return function(t){return e[0]=t,e[1]=16777619,e[2]=t,e[3]=t,(0,v.hashCombine4xUint32)(e,e)}}(),w=function(e,t){for(var r=0;r<e.length;r++)e[r]=(e[r]^t[r])>>>0};T.prototype._createNameFromGuidList=function(e,t,r,i){var n=C.default.clone(P[e]),o=R[t];b.ConsoleUtils.assert(n&&o,"Unsupported tuid or minortype!"),w(n,o);for(var s=0;s<r.length;s++)w(n,r[s]);var a=(0,v.uint32x4ToGUID)(n);if(i[a]){var l=++i[a];return(r=C.default.clone(r)).push(V(S(l))),this._createNameFromGuidList(e,t,r,i)}return i[a]=1,a},T.prototype._createGUIDfromEdgeAndLocalID=function(e,t){var r=(0,v.guidToUint32x4)(e.getGuid()),i=V(S(t));return(0,v.hashCombine4xUint32)(r,i)},T.prototype._findVertexIndex=function(e){for(var t=0;t<this._intersectionVertices.length;t++){if(i.Vector3.distance(this._intersectionVertices[t].position,e)<o.KERNEL_TOLERANCE)return t;for(var r=0;r<this._intersectionVertices[t].mergedPositions.length;r++)if(i.Vector3.distance(this._intersectionVertices[t].mergedPositions[r],e)<o.KERNEL_TOLERANCE)return t}},T.prototype._findVertexOnSweepLine=function(e){for(var t=this._workspace,r=0,i=t.sweepLineIntersections.length-1;i>=r;){if(r+1>=i)return r;var n=Math.floor((r+i)/2);this._isVertexAboveEdgeSegment(t.sweepLineIntersections[n],e)?r=n:i=n}console.error("Error in binary search function!")},T.prototype._isVertexAboveEdgeSegment=function(e,t){if(e===-1/0)return!0;if(e===1/0)return!1;var r=e.originalEdge;switch(r.getCurveType()){case o.GEOMETRY_TYPES.LINE:var n=r.getStartVertex().getPosition(),s=i.Vector3.createFloat64();i.Vector3.subtract(s,r.getEndVertex().getPosition(),n);var a=i.Vector3.createFloat64();return i.Vector3.subtract(a,t.position,n),(s[0]<0||0===s[0]&&s[1]<0)&&i.Vector3.negate(s,s),a[1]*s[0]-a[0]*s[1]>0;case o.GEOMETRY_TYPES.CIRCLE:var l=t.position[0]-r.getCurve().getCenter()[0],u=.5*(e.parameterRange[0]+e.parameterRange[1]),c=r.getCurve().evaluateDtt(u)[1]>0?-1:1;return Math.abs(l)>r.getCurve().getRadius()?r.getCurve().getCenter()[1]<t.position[1]:r.getCurve().getCenter()[1]+c*Math.sqrt(r.getCurve().getRadius()*r.getCurve().getRadius()-l*l)<t.position[1];default:return this.getYvalueForX(e,t.position[0])<t.position[1]}},T.prototype._makeEdgeXMonotone=function(e,t){var r=e.getCurve(),s=[];switch(e.getCurveType()){case o.GEOMETRY_TYPES.LINE:break;case o.GEOMETRY_TYPES.CIRCLE:var a=r.evaluatePosition(0);i.Vector3.subtract(a,a,r.getCenter());var l=r.getNormal()[2]>0?-1:1;s[0]=l*Math.atan2(a[1],a[0]),s[1]=s[0]-Math.PI;break;case o.GEOMETRY_TYPES.ELLIPSE:var u=r.getMajorAxis()[0]*r.getMajorRadius(),c=r.getMinorAxis()[0]*r.getMinorRadius();s[0]=Math.atan2(c,u),s[1]=s[0]-Math.PI;break;case o.GEOMETRY_TYPES.BCURVE:s=y.SplineCurveHelper.extremalParams(r,0);break;default:console.warn("Unsupported edge type in sketch region op")}for(var h=0;h<s.length;h++){var d=s[h];e.isReversed()&&(d=-d),r.isPeriodicUnlimited()&&(d=(0,n.adjustParameterToPeriodicRange)(d,e.getRange(),r.getPeriodUnlimited())),d>=e.t0()&&d<=e.t1()&&(t.push({param:d,atVertex:null,temporary:!0}),A.DebugUtils.level("region3D")>0&&A.DebugUtils.drawPoint3D(e.evaluatePosition(d),{color:16711935,label:"x monotonic"}))}},T.prototype.plotSegments=function(e,t){var r=this._workspace;Debug.hold("on"),Debug.clearFigure(),Debug.delayUpdates(!0);for(var n=0;n<this._intersectionVertices.length;n++){var o=Debug.plotColorForIndex(this._intersectionVertices[n].adjacentEdges.length);if("sweepLineState"===e&&(o="k",this._intersectionVertices[n]===r.currentVertex&&(o="g"),this._intersectionVertices[n]===r.nextVertex&&(o="b")),Debug.plot([this._intersectionVertices[n].position],o+"o"),"orderColored"===e)for(var s=this._intersectionVertices[n],a=[],l=0;l<s.adjacentEdges.length;l++){o=Debug.plotColorForIndex(l);var u=s.adjacentEdges[l],c=C.default.clone(u.parameterRange);u.startVertex!==s||a[u.index]?c[0]=.5*(c[0]+c[1]):c[1]=.5*(c[0]+c[1]),a[u.index]=!0;var h=u.originalEdge.tessellate(c).positions;Debug.plot(h,o+"-")}}if("orderColored"!==e)for(n=0;n<this._edgeSegments.length;n++){if(u=this._edgeSegments[n],"coincidenceCount"===e){var d=u.coincidentRanges.length+1;o=Debug.plotColorForIndex(d)}else o=Debug.plotColorForIndex(n);if("sweepLineState"===e&&(o=r.sweepLineIntersections.indexOf(u)>-1?"r":"k"),t&&t.highlightLoop&&(o=C.default.contains(t.highlightLoop,u)?"R":"k"),h=u.originalEdge.tessellate(u.parameterRange).positions,"regions"===e){var p=[],f=[];for(l=0;l<h.length;l++){if(l<h.length-1){var g=i.Vector3.createFloat64();i.Vector3.subtract(g,h[l+1],h[l])}else g=i.Vector3.createFloat64(),i.Vector3.subtract(g,h[l],h[l-1]);i.Vector3.normalize(g,g),i.Vector3.scale(g,g,.05),i.Vector3.cross(g,[0,0,1],g);var v=i.Vector3.clone(h[l]);p.push(i.Vector3.add(v,v,g));var y=i.Vector3.clone(h[l]);f.push(i.Vector3.subtract(y,y,g))}var m=u.adjacent[this.SIDE.LEFT].face.index;o=Debug.plotColorForIndex(m),Debug.plot(p,o+"-");var _=u.adjacent[this.SIDE.RIGHT].face.index;o=Debug.plotColorForIndex(_),Debug.plot(f,o+"-")}else Debug.plot(h,o+"-")}if("sweepLineState"===e&&r.sweepLinePosition){var E=r.sweepLinePosition,x=void 0;for(n=0;n<r.sweepLineIntersections.length;n++){var b,A=r.sweepLineIntersections[n];void 0!==(b=A===1/0?5:A===-1/0?-5:this.getYvalueForX(A,E))&&(Debug.plot([E],[b],"y."),void 0!==x&&(o=Debug.plotColorForIndex(r.sweepLineRegions[n-1].index),Debug.plot([E,E],[x,b],o+"-")),x=b)}}if(t&&t.showOrientation){h=[];var T=[],P=[];for(n=0;n<this._edgeSegments.length;n++){var R=!(void 0===(u=this._edgeSegments[n]).loopsCurveAligned||!0===u.loopsCurveAligned),S=R?.05:.95,V=u.parameterRange[0]*(1-S)+u.parameterRange[1]*S,w=u.originalEdge.evaluatePosition(V);h.push(w);var M=t.arrowSize||.1,L=R?-M:M;if(u.adjacent[this.SIDE.LEFT].face.index>=0){var O=u.originalEdge.evaluateDt(V);i.Vector3.normalize(O,O);var k=[w[0]-M*O[1],w[1]+M*O[0]];T.push(k),P.push([L*O[0],L*O[1]])}if(u.adjacent[this.SIDE.RIGHT].face.index>=0){var I=u.parameterRange[0]*S+u.parameterRange[1]*(1-S),F=u.originalEdge.evaluatePosition(I),N=u.originalEdge.evaluateDt(I);i.Vector3.normalize(N,N);var D=[F[0]+M*N[1],F[1]-M*N[0]];T.push(D),P.push([-L*N[0],-L*N[1]])}}Debug.plot(h,"k."),Debug.quiver(T,P,"g","c")}Debug.delayUpdates(!1),Debug.equalAxis()},T.prototype.plotEdgeSegment=function(e,t){Debug.plotEdgeList([e.originalEdge],!1,t+"-",{ranges:[e.parameterRange]})},T.prototype.plotEdgesAroundVertex=function(e,t){Debug.plot([e.position],"gx");for(var r=0;r<e.adjacentEdges.length;r++){var i,n=e.adjacentEdges[r];console.log(r),i=n.startVertex===e?[n.parameterRange[0],n.parameterRange[0]+t/n.originalEdge.getCurve().tangentLength(n.parameterRange[0])]:[n.parameterRange[1]-t/n.originalEdge.getCurve().tangentLength(n.parameterRange[0]),n.parameterRange[1]],Debug.plotEdgeList([n.originalEdge],!1,"-"+Debug.plotColorForIndex(r),{ranges:[i],showOrientation:!1,resolution:1e4})}},T.prototype.getYvalueForX=function(e,t){var r=e.parameterRange[0],i=e.parameterRange[1],n=e.originalEdge.evaluatePosition(r),s=e.originalEdge.evaluatePosition(i),a=n[0],l=s[0];if(a>l){var u=r;r=i,i=u,u=a,a=l,l=u,u=n,n=s,s=u}if(t<=a+o.KERNEL_TOLERANCE||t>=l-o.KERNEL_TOLERANCE)return Math.abs(t-a)<=o.KERNEL_TOLERANCE?n[1]:Math.abs(t-l)<=o.KERNEL_TOLERANCE?s[1]:void console.warn("Failure in getYvalueForX, in_x oustide segment range, returning undefined");for(;l>=a;){if(a+o.KERNEL_TOLERANCE>=l)return h[1];var c=(r+i)/2,h=e.originalEdge.evaluatePosition(c);if(Math.abs(r-i)<=o.PARAMETER_SPACE_TOLERANCE)return b.ConsoleUtils.assert(!1,"Could not converge to a solution for getYvalueForX"),h[1];h[0]<t?(a=h[0],r=c):(l=h[0],i=c)}console.warn("Failure in getYvalueForX, returning undefined")},T.prototype._computeAngleAndPositionForEdge=function(e,t,r){var n=t.adjacentEdges[e],o=n.startVertex===t,s=n.parameterRange[o?0:1];if(void 0===r||!((s+=(o?1:-1)*r)<n.parameterRange[0]||s>n.parameterRange[1])){var a=i.Vector3.createFloat64();return i.Vector3.normalize(a,n.originalEdge.evaluateDt(s)),o||i.Vector3.negate(a,a),{angle:Math.atan2(a[1],a[0]),position:n.originalEdge.evaluatePosition(s)}}},T.prototype._computeEdgeDirectionAtVertex=function(e,t,r){var n=t.adjacentEdges[e.index],o=n.startVertex===t,s=n.parameterRange[o?0:1],a=s+(o?1:-1)*r/i.Vector3.length(n.originalEdge.evaluateDt(s)),l=n.originalEdge.evaluatePosition(a),u=i.Vector3.subtract(l,l,t.position);return Math.atan2(u[1],u[0])},T.prototype._prepareResult=function(){var e=new m.TopologyCloner;this._finalFaces=e.cloneFaces(this._faces),this._internalToFinalMap=e.getProgenitorMap(),this._progenitorMap=new _.ProgenitorMap;for(var t=e.getProgenitorMap().getAllNewTopology(),r=0;r<t.length;r++){var i=t[r],n=e.getProgenitorMap().getProgenitors(i)[0],s=void 0;i.getTopologyType()===o.TOPOLOGY_TYPES.FACE?(s=new Set,n.collectEdges().forEach((function(e){e.getAssociatedEntities().forEach((function(e){s.add(e)}))})),s=Array.from(s)):(i.getTopologyType()===o.TOPOLOGY_TYPES.EDGE||i.getTopologyType()===o.TOPOLOGY_TYPES.VERTEX)&&(s=n.getAssociatedEntities()),s&&this._progenitorMap.addEntry(i,s)}this._sketchSummary={regionFaces:[],regionEdges:[],regionVertices:[],sketchEdges:{}};for(var a=C.default.keys(this._sketchRegionTopologies),l=0;l<a.length;l++){var u=this._sketchRegionTopologies[a[l]].topology;u instanceof E.RegionTopologyFace?this._sketchSummary.regionFaces.push(u):u instanceof E.RegionTopologyEdge?this._sketchSummary.regionEdges.push(u):u instanceof E.RegionTopologyVertex?this._sketchSummary.regionVertices.push(u):b.ConsoleUtils.assert(!1)}for(var c=0;c<this._sketchEdges.length;c++){var h=this._sketchEdges[c];this._sketchSummary.sketchEdges[h.getGuid()]=h}},T.prototype.getFaces=function(){return this._finalFaces},T.prototype.getRegionTopologyFaces=function(){return this._faces},T.prototype.getProgenitorMap=function(){return this._progenitorMap},T.prototype.createFaceRecipe=function(e){var t=this._finalFaces.indexOf(e);if(t<0)return"";var r=this._faces[t],i=(0,x.createRecipeFromRegionFace)(r,this._sketchSummary);return(0,x.serializeRegionFaceRecipe)(i)},T.prototype.matchFaceRecipe=function(e){for(var t=(0,x.deserializeRegionFaceRecipe)(e),r=(0,x.matchRegionFaceRecipe)(t,this._sketchSummary),i=[],n=0;n<r.regions.length;n++){var o=this._faces.indexOf(r.regions[n]);b.ConsoleUtils.assert(o>=0),i.push(this._finalFaces[o])}return i},T.prototype.createEdgeRecipe=function(e){var t=this._internalToFinalMap.getProgenitors(e);if(!t||1!==t.length)return"";var r=(0,x.createRecipeFromRegionEdge)(t[0],this._sketchSummary);return(0,x.serializeRegionEdgeRecipe)(r)},T.prototype.matchEdgeRecipe=function(e){for(var t=(0,x.deserializeRegionEdgeRecipe)(e),r=(0,x.matchRegionEdgeRecipe)(t,this._sketchSummary),i=[],n=0;n<r.edges.length;n++){var o=this._internalToFinalMap.getDescendants(r.edges[n]);b.ConsoleUtils.assert(1===o.length),i.push(o[0])}return i},t.SketchRegionSolver=T},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeCurveCurveIntersections=void 0;var i=r(1),n=r(0),o=r(6),s=r(7),a=r(20),l=r(16),u=r(72),c=r(36),h=r(3),d=r(110),p=n.KERNEL_TOLERANCE,f=function(e,t,r,n){var o=t,s=e.getRange();if(e.getCurve().isPeriodicUnlimited()&&(o<s[0]-i.FLOAT64_TOLERANCE||o>s[1]+i.FLOAT64_TOLERANCE)){var a=e.getCurve().getPeriodUnlimited();o=(0,h.foldNearTo)(o,.5*(s[0]+s[1]),a)}var l=Math.abs(o-s[0])<Math.abs(o-s[1])?0:1,u=i.Vector3.length(e.evaluateDt(o));return Math.abs(o-s[l])*u<r?{param:s[l],atVertex:e.getVertex(l)}:o>=s[0]&&o<=s[1]?{param:o,atVertex:void 0}:!e.isClosed()&&n.distanceToPoint(e.getVertex(l).getPosition())<r?{param:s[l],atVertex:e.getVertex(l)}:void 0},g=function(e,t,r,n,o){var s=f(e,t,o,r);if(s){if(s.atVertex){var a=r.getRange();e===r&&(a=[n-.1*(u=Math.abs(a[1]-a[0])),n+.1*u]);var l=r.closestToPointParam(s.atVertex.getPosition(),a);i.Vector3.distance(r.evaluatePosition(l),s.atVertex.getPosition())<o&&(n=l)}var u,c=f(r,n,o,e);if(c&&(c.atVertex&&(a=e.getRange(),e===r&&(a=[t-.1*(u=Math.abs(a[1]-a[0])),t+.1*u]),l=e.closestToPointParam(c.atVertex.getPosition(),a),i.Vector3.distance(e.evaluatePosition(l),c.atVertex.getPosition())<o&&(s=f(e,t=l,o,r))),s))return{cutInfo:s,cutByInfo:c}}},v=function(e,t,r){var i=[t-e.getRange()[0],t-e.getRange()[1]];if(i[0]>=r&&i[1]<=-r)return{param:t,atVertex:void 0};var n=Math.abs(i[0])<Math.abs(i[1])?0:1;return Math.abs(i[n])<r?{param:e.getRange()[n],atVertex:e.getVertex(n)}:void 0},y=function(e,t,r,o,s,a,l){var u=e.getCurve().getPeriodUnlimited(),c=t.getCurve().getPeriodUnlimited(),d=[r[0],r[2]],p=[o[0],o[2]],g=[s/i.Vector3.length(e.evaluateDt(d[0])),s/i.Vector3.length(e.evaluateDt(d[1]))],v=[s/i.Vector3.length(t.evaluateDt(p[0])),s/i.Vector3.length(t.evaluateDt(p[1]))];if(((0,h.isParameterWithinPeriodicRange)(d[0],e.getRange(),u,g[0])||(0,h.isParameterWithinPeriodicRange)(d[1],e.getRange(),u,g[1]))&&((0,h.isParameterWithinPeriodicRange)(p[0],t.getRange(),c,v[0])||(0,h.isParameterWithinPeriodicRange)(p[1],t.getRange(),c,v[1]))){for(var y=0;y<2;y++){d[y]=(0,h.adjustParameterToPeriodicRange)(d[y],e.getRange(),u,!1,!0),p[y]=(0,h.adjustParameterToPeriodicRange)(p[y],t.getRange(),c,!1,!0);var m=(0,h.periodicDifference)(d[y],e.getRange()[0],u)<3e-15||(0,h.periodicDifference)(d[y],e.getRange()[1],u)<3e-15,_=(0,h.periodicDifference)(p[y],t.getRange()[0],c)<3e-15||(0,h.periodicDifference)(p[y],t.getRange()[1],c)<3e-15;if(d[y]-e.getRange()[0]<g[y]&&(d[y]=e.getRange()[0],m=!0),e.getRange()[1]-d[y]<g[y]&&(d[y]=e.getRange()[1],m=!0),p[y]-t.getRange()[0]<v[y]&&(p[y]=t.getRange()[0],_=!0),t.getRange()[1]-p[y]<v[y]&&(p[y]=t.getRange()[1],_=!0),m){var E=t.closestToPointParam(e.evaluatePosition(d[y]));p[y]=(0,h.adjustParameterToPeriodicRange)(E,t.getRange(),c,!1,!0)}if(_){var x=e.closestToPointParam(t.evaluatePosition(p[y]));d[y]=(0,h.adjustParameterToPeriodicRange)(x,e.getRange(),u,!1,!0),((0,h.periodicDifference)(d[y],e.getRange()[0],u)<3e-15||(0,h.periodicDifference)(d[y],e.getRange()[1],u)<3e-15)&&(E=t.closestToPointParam(e.evaluatePosition(d[y])),p[y]=(0,h.adjustParameterToPeriodicRange)(E,t.getRange(),c,!1,!0))}}var b,A;if((0,h.periodicDifference)(d[0],d[1],u)<Math.min(g[0],g[1])&&(0,h.periodicDifference)(p[0],p[1],c)<Math.min(v[0],v[1]))b=f(e,.5*(d[0]+d[1]),s,e),A=f(t,.5*(p[0]+p[1]),s,t);else for(b=f(e,r[1],s,e),A=f(t,o[1],s,t),y=0;y<2;y++)if(!((0,h.periodicDifference)(d[y],b.param,u)<g[y]&&(0,h.periodicDifference)(p[y],A.param,c)<v[y])){var C,T,P=f(e,d[y],s,e),R=f(t,p[y],s,t);if(isFinite(u)){var S=(0,h.getShortestParametricRange)(P.param,b.param,u);C=(0,h.periodicDifference)(b.param,S[0],u)<=n.KERNEL_ANGULAR_TOLERANCE}else C=P.param>b.param;isFinite(c)?(S=(0,h.getShortestParametricRange)(R.param,A.param,c),T=(0,h.periodicDifference)(A.param,S[0],c)<=n.KERNEL_ANGULAR_TOLERANCE):T=R.param>A.param,a.push({rangeInfo:C?[b,P]:[P,b],rangeByInfo:T?[A,R]:[R,A]})}l&&l.push({firstParam:b.param,secondParam:A.param})}},m=function(e,t,r,n){var o=e.getRange(),s=e.evaluatePosition(0),a=e.evaluateDt(0),l=i.Vector2.length(a),u=t.getRange(),c=t.evaluatePosition(0),d=t.evaluateDt(0),p=i.Vector2.length(d),f=[a[1]/l,-a[0]/l],y=t.evaluatePosition(u[0]);i.Vector2.subtract(y,y,s);var m=i.Vector2.dot(y,f),_=t.evaluatePosition(u[1]);i.Vector2.subtract(_,_,s);var E=i.Vector2.dot(_,f);if(Math.abs(m)<=n&&Math.abs(E)<=n){var x=i.Vector2.dot(y,a)/(l*l),b=i.Vector2.dot(_,a)/(l*l),A=[Math.min(x,b),Math.max(x,b)],C=n/l,T=n/p;if(A[1]<o[0]-C||A[0]>o[1]+C)return[];var P=[Math.max(o[0],A[0]),Math.min(o[1],A[1])];if(P[1]-P[0]<C){var R=.5*(P[0]+P[1]),S=Math.abs(b-x)>i.FLOAT64_TOLERANCE?u[0]+(u[1]-u[0])*(R-x)/(b-x):.5*(u[0]+u[1]);return[{cutInfo:v(e,R,C),cutByInfo:v(t,S,T)}]}if(!r)return[];var V=u[0]+(u[1]-u[0])*(P[0]-x)/(b-x),w=u[0]+(u[1]-u[0])*(P[1]-x)/(b-x);return[{rangeInfo:[v(e,P[0],C),v(e,P[1],C)],rangeByInfo:[v(t,Math.min(V,w),T),v(t,Math.max(V,w),T)]}]}if(m>n&&E>n||m<-n&&E<-n)return[];var M=[[a[0],-d[0],c[0]-s[0]],[a[1],-d[1],c[1]-s[1]]],L=(0,h.solveTwoEquationsTwoVariables)(M);if(L){var O=g(e,L[0],t,L[1],n);if(O)return[O]}return[]},_=function(e,t,r){var n,o=t.getCenter(),s=e.closestToPointParam(o,[]),a=e.evaluatePosition(s),l=i.Vector3.squaredDistance(a,o),u=[],c=t.getRadius(),h=c-Math.sqrt(l);if(h<-r);else if(h<r)n=t.closestToPointParam(a,[]),u.push({lineParam:s,circleParam:n});else for(var d=Math.sqrt(c*c-l)/i.Vector3.length(e.evaluateDt(0)),p=0;p<2;++p){var f=s+(0===p?-1:1)*d,g=e.evaluatePosition(f);n=t.closestToPointParam(g,[]),u.push({lineParam:f,circleParam:n})}return u},E=function(e,t,r,i,n,o){var s=[r[0]+t*i[0]-e*i[1],r[1]+t*i[1]+e*i[0],0];return{firstParam:n.closestToPointParam(s,[0,2*Math.PI]),secondParam:o.closestToPointParam(s,[0,2*Math.PI])}},x=function(e,t){t||(t=n.KERNEL_TOLERANCE);for(var r=[],i=!1,o=[],s=[],a=0;a<e.length;++a)e[a].hasOwnProperty("rangeInfo")?(!1===i?(o=e[a].rangeInfo,s=e[a].rangeByInfo):Math.abs(o[1].param-e[a].rangeInfo[0].param)<t&&Math.abs(s[1].param-e[a].rangeByInfo[0].param)<t?(o[1]=e[a].rangeInfo[1],s[1]=e[a].rangeByInfo[1]):(r.push({rangeInfo:o,rangeByInfo:s}),o=e[a].rangeInfo,s=e[a].rangeByInfo),i=!0):e[a].hasOwnProperty("cutInfo")?(i&&r.push({rangeInfo:o,rangeByInfo:s}),r.push(e[a]),i=!1):console.warn("unknown segment type in intersection code");return i&&r.push({rangeInfo:o,rangeByInfo:s}),r},b=function(e,t,r,n,o){var s=r.getControlPoints(),a=r.getKnotVector(),l=e.getBoundingBox(),u=[];if(!r.getBoundingBox([a[0],a[a.length-1]]).intersectsWithTolerance(l,o))return u;var d=new Float64Array(s.length),p=s.length/3-1,m=i.Vector2.createFloat64FromValues(e.getStartVertex().getPosition()[0],e.getStartVertex().getPosition()[1]),_=i.Vector3.createFloat64();i.Vector3.sub(_,e.getEndVertex().getPosition(),e.getStartVertex().getPosition()),i.Vector3.normalize(_,_);for(var E=i.Vector2.createFloat64FromValues(_[0],_[1]),x=i.Vector2.createFloat64(),b=!0,A=0;A<=p;++A)x[0]=s[3*A+0],x[1]=s[3*A+1],d[3*A+0]=A/p,d[3*A+1]=(0,h.signedDistanceTo2DLine)(m,E,x),Math.abs(d[3*A+1])>o&&(b=!1),d[3*A+2]=0;if(b)return n?u=function(e,t,r,n,o){var s=n.length/3-1,a=i.Vector3.createFloat64FromValues(n[0],n[1],n[2]),l=e.closestToPointParam(a),u=i.Vector3.createFloat64FromValues(n[3*s+0],n[3*s+1],n[3*s+2]),c=e.closestToPointParam(u),h=[v(e,l,r),v(e,c,r)];if(h[0].param>h[1].param){var d=h[0];h[0]=h[1],h[1]=d}var p=o[0],g=o[o.length-1];if(t.isReversed()){var y=p;p=-g,g=-y}var m=[f(t,p,r,e),f(t,g,r,e)];return h[0]&&h[1]&&m[0]&&m[1]?[{rangeInfo:h,rangeByInfo:m}]:(console.warn("Error in intersection computation."),[])}(e,t,o,s,a):[];var C=new Float64Array(3),T=[];return function(e,t,r,i,n,o,s,a,l){var u,c=[],h=i.length/3-1;3===o?(s[0]>s[1]&&(u=s[0],s[0]=s[1],s[1]=u),s[1]>s[2]&&(u=s[1],s[1]=s[2],s[2]=u),s[0]>s[1]&&(u=s[0],s[0]=s[1],s[1]=u)):2===o&&s[0]>s[1]&&(u=s[0],s[0]=s[1],s[1]=u);var d=[!1,!1,!1],p=n[n.length-1]-n[0],v=t.getCurve().tangentLength(n[0])*p;Math.abs(i[1])<r&&(0===o||s[0]>r/v)&&(o++,s[2]=s[1],s[1]=s[0],s[0]=0,d[0]=!0);var m=t.getCurve().tangentLength(n[n.length-1])*p;Math.abs(i[3*h+1])<r&&(0===o||1-s[o-1]>r/m)&&(s[o]=1,d[o]=!0,o++);for(var _=e.isReversed()?-1:1,E=t.isReversed()?-1:1,x=0,b=0;b<o+1;++b){var A=!1;if(b!==o){var C=s[b];s[b]=n[0]+(n[n.length-1]-n[0])*s[b];var T=t.getCurve().evaluatePosition(s[b]),P=e.getCurve().closestToPointParam(T,[]),R=g(e,P*_,t,s[b]*E,r);R&&(R.cutInfo.virtualIntersection=d[b],R.cutByInfo.virtualIntersection=d[b],c.push(R))}else C=n[n.length-1],A=Math.abs(i[3*h+1])>r;if(0===b&&C>0&&Math.abs(i[0])>r&&(A=!0),l){var S=void 0;if(a.length>0&&a[0][0]>=x&&a[0][0]<=C&&(S=a[0]),a.length>1&&a[1][0]>=x&&a[1][0]<=C&&(S=a[1]),void 0!==S&&Math.abs(S[1])<r&&!A){var V=[n[0]+(n[n.length-1]-n[0])*x,n[0]+(n[n.length-1]-n[0])*C],w=[e.getCurve().closestToPointParam(t.getCurve().evaluatePosition(V[0]),[]),e.getCurve().closestToPointParam(t.getCurve().evaluatePosition(V[1]),[])];if(Math.abs(w[0]-w[1])>r){var M=[f(e,w[0]*_,r,t),f(e,w[1]*_,r,t)],L=[f(t,V[0]*E,r,e),f(t,V[1]*E,r,e)];if(M[0]&&M[1]&&L[0]&&L[1]){var O=n[0]+(n[n.length-1]-n[0])*S[0];O!==V[0]&&O!==V[1]||(O=.5*(V[0]+V[1]));var k=e.getCurve().closestToPointParam(t.getCurve().evaluatePosition(O),[]);y(e,t,[w[0]*_,k*_,w[1]*_],[V[0]*E,O*E,V[1]*E],r,c);var I={cutInfo:f(e,k*_,r,e),cutByInfo:f(t,O*E,r,e)};I.cutInfo.virtualIntersection=!0,I.cutByInfo.virtualIntersection=!0,c.push(I)}}}}x=C}return c}(e,t,o,d,a,c.SplineCurveHelper.intersect_xAxis_NonRationalCubicBSpline_XYPlanar3D([0,0,0],d,C,T),C,T,n)},A=function(e,t,r,i){var n=e.getBoundingBox(),o=[];if(!t.getBoundingBox().intersectsWithTolerance(n,i))return o;for(var s=t.getCurve().getBezierSegments(),a=s.length,l=0;l<a;l++)for(var u=b(e,t,s[l],r,i),c=0;c<u.length;++c)o.push(u[c]);return x(o)},C=function(e,t,r,n,o){var a=r.getControlPoints(),l=r.getKnotVector(),c=e.getBoundingBox(),d=[];if(!r.getBoundingBox([l[0],l[l.length-1]]).intersectsWithTolerance(c,o))return d;for(var v=!0,y=i.Vector2.createFloat64(),m=i.Vector2.createFloat64(),E=i.Vector2.createFloat64(),x=0;x<a.length/3-2&&v;++x)y[0]=a[3*x+0],y[1]=a[3*x+1],m[0]=a[3*x+3],m[1]=a[3*x+4],E[0]=a[3*x+6],E[1]=a[3*x+7],v=Math.abs((0,h.orient2D)(y,m,E))<p;if(v){var b=new s.Line,A=i.Vector3.createFloat64FromValues(a[0],a[1],a[2]),C=i.Vector3.createFloat64FromValues(a[a.length-3],a[a.length-2],a[a.length-1]);b.setFromEndpoints(A,C);var T=i.Vector3.distance(C,A),P=_(b,e.getCurve(),o);for(x=0;x<P.length;++x)if(P[x].lineParam>=0&&P[x].lineParam<=T){P[x].lineParam=t.getCurve().closestToPointParam(b.evaluatePosition(P[x].lineParam),[]);var R=f(e,P[x].circleParam*(e.isReversed()?-1:1),o,t),S=f(t,P[x].lineParam*(t.isReversed()?-1:1),o,e);S&&R&&d.push({cutInfo:R,cutByInfo:S})}return d}var V=i.Vector2.createFloat64(),w=i.Vector2.createFloat64(),M=i.Vector2.createFloat64(),L=i.Vector2.createFloat64();V[0]=-a[0]+3*a[3]-3*a[6]+a[9],V[1]=-a[1]+3*a[4]-3*a[7]+a[10],w[0]=3*a[0]-6*a[3]+3*a[6],w[1]=3*a[1]-6*a[4]+3*a[7],M[0]=-3*a[0]+3*a[3],M[1]=-3*a[1]+3*a[4],L[0]=a[0],L[1]=a[1];var O=e.getCurve().getCenter(),k=e.getCurve().getRadius()*e.getCurve().getRadius(),I=k,F=new Float64Array(7);F[0]=I*V[0]*V[0]+k*V[1]*V[1],F[1]=2*I*V[0]*w[0]+2*w[1]*k*V[1],F[2]=2*M[0]*I*V[0]+w[1]*w[1]*k+I*w[0]*w[0]+2*M[1]*k*V[1],F[3]=-2*O[1]*k*V[1]+2*w[1]*M[1]*k+2*M[0]*I*w[0]-2*I*V[0]*O[0]+2*I*V[0]*L[0]+2*L[1]*k*V[1],F[4]=-2*I*O[0]*w[0]+M[1]*M[1]*k-2*O[1]*w[1]*k+2*I*L[0]*w[0]+M[0]*M[0]*I+2*L[1]*w[1]*k,F[5]=-2*O[1]*M[1]*k-2*M[0]*I*O[0]+2*M[0]*I*L[0]+2*L[1]*M[1]*k,F[6]=I*O[0]*O[0]-2*L[1]*O[1]*k-I*k+O[1]*O[1]*k+L[1]*L[1]*k-2*I*O[0]*L[0]+I*L[0]*L[0];var N=(0,u.getRealPolynomialRoots)(F);for(x=0;x<N.length;++x)if(N[x]>=0&&N[x]<=1){N[x]=l[0]+(l[l.length-1]-l[0])*N[x];var D=t.getCurve().evaluatePosition(N[x]),B=e.getCurve().closestToPointParam(D,[]),z=g(e,B*(e.isReversed()?-1:1),t,N[x]*(t.isReversed()?-1:1),o);z&&d.push(z)}return d},T=function(e,t,r,i,n){var o=e.getBoundingBox(),s=[];if(!t.getBoundingBox().intersectsWithTolerance(o,n))return s;var a=0;e.isClosed()&&i&&(a=1);for(var l=t.getCurve().getBezierSegments(),u=l.length,c=0;c<u;c++)for(var h=C(e,t,l[c],0,n),d=0;d<h.length;++d)for(var p=-a;p<=a;++p)s.push({cutInfo:{atVertex:h[d].cutInfo.atVertex,param:h[d].cutInfo.param+p*Math.PI*2},cutByInfo:h[d].cutByInfo});return x(s)},P=function(e,t,r,c,d,v,y){var _=r.getControlPoints(),E=r.getKnotVector(),x=c.getControlPoints(),A=c.getKnotVector(),C=r.getBoundingBox([E[0],E[E.length-1]]),T=c.getBoundingBox([A[0],A[A.length-1]]),P=e===t,R=!1,S=!1;P&&Math.abs(_[_.length-3]-x[0])<v&&Math.abs(_[x.length-2]-x[1])<v&&Math.abs(_[x.length-1]-x[2])<v&&(R=!0),P&&Math.abs(_[0]-x[_.length-3])<v&&Math.abs(_[1]-x[x.length-2])<v&&Math.abs(_[2]-x[x.length-1])<v&&(S=!0);var V=[];if(!C.intersectsWithTolerance(T,v))return V;var w=!0,M=!0,L=i.Vector2.createFloat64(),O=i.Vector2.createFloat64(),k=i.Vector2.createFloat64();for(Oe=0;Oe<_.length/3-2&&w;++Oe)L[0]=_[3*Oe+0],L[1]=_[3*Oe+1],O[0]=_[3*Oe+3],O[1]=_[3*Oe+4],k[0]=_[3*Oe+6],k[1]=_[3*Oe+7],w=Math.abs((0,h.orient2D)(L,O,k))<p;for(Oe=0;Oe<x.length/3-2&&M;++Oe)L[0]=x[3*Oe+0],L[1]=x[3*Oe+1],O[0]=x[3*Oe+3],O[1]=x[3*Oe+4],k[0]=x[3*Oe+6],k[1]=x[3*Oe+7],M=Math.abs((0,h.orient2D)(L,O,k))<p;if(w||M)return function(e,t,r,u,c,h,d,p,v){var y=c.getControlPoints(),_=h.getControlPoints(),E=[];if(e&&!t||!e&&t){var x,A,C=new s.Line;e?(x=i.Vector3.createFloat64FromValues(y[0],y[1],y[2]),A=i.Vector3.createFloat64FromValues(y[y.length-3],y[y.length-2],y[y.length-1])):(x=i.Vector3.createFloat64FromValues(_[0],_[1],_[2]),A=i.Vector3.createFloat64FromValues(_[_.length-3],_[_.length-2],_[_.length-1])),C.setFromEndpoints(x,A);var T=new a.Edge(C),P=i.Vector3.distance(A,x);T.setRange([0,P]);var R=new o.Point;R.setPosition(x[0],x[1],x[2]);var S=new o.Point;S.setPosition(A[0],A[1],A[2]);var V,w=new l.Vertex(R),M=new l.Vertex(S);T.setStartVertex(w),T.setEndVertex(M),ee=e?b(T,u,h,d,p):b(T,r,c,d,p);for(var L=0;L<ee.length;++L)if(ee[L].hasOwnProperty("cutInfo")&&ee[L].hasOwnProperty("cutByInfo")){if(ee[L].cutInfo.param>=0&&ee[L].cutInfo.param<=P&&(e?(ee[L].cutInfo.param=r.closestToPointParam(C.evaluatePosition(ee[L].cutInfo.param)),V=g(r,ee[L].cutInfo.param,u,ee[L].cutByInfo.param,p)):(ee[L].cutInfo.param=u.closestToPointParam(C.evaluatePosition(ee[L].cutInfo.param)),V=g(r,ee[L].cutByInfo.param,u,ee[L].cutInfo.param,p)),V))if(v){var O=V.cutInfo.param,k=V.cutByInfo.param;(I=Math.abs(O-k)*i.Vector3.length(r.evaluateDt(O)))>n.KERNEL_TOLERANCE&&!ee[L].cutInfo.virtualIntersection&&E.push(V)}else E.push(V)}else if(ee[L].hasOwnProperty("rangeInfo")&&ee[L].hasOwnProperty("rangeByInfo")&&ee[L].rangeInfo[0].param>=0&&ee[L].rangeInfo[0].param<=P&&ee[L].rangeInfo[1].param>=0&&ee[L].rangeInfo[1].param<=P)if(e?(ee[L].rangeInfo[0].param=r.closestToPointParam(C.evaluatePosition(ee[L].rangeInfo[0].param)),ee[L].rangeInfo[1].param=r.closestToPointParam(C.evaluatePosition(ee[L].rangeInfo[1].param))):(ee[L].rangeInfo[0].param=u.closestToPointParam(C.evaluatePosition(ee[L].rangeInfo[0].param)),ee[L].rangeInfo[1].param=u.closestToPointParam(C.evaluatePosition(ee[L].rangeInfo[1].param))),e?(te=[f(r,ee[L].rangeInfo[0].param,p,u),f(r,ee[L].rangeInfo[1].param,p,u)],re=[f(u,ee[L].rangeByInfo[0].param,p,r),f(u,ee[L].rangeByInfo[1].param,p,r)]):(te=[f(r,ee[L].rangeByInfo[0].param,p,u),f(r,ee[L].rangeByInfo[1].param,p,u)],re=[f(u,ee[L].rangeInfo[0].param,p,r),f(u,ee[L].rangeInfo[1].param,p,r)]),te[0]&&te[1]&&re[0]&&re[1]){var I=Math.abs(te[1].param-re[0].param)*i.Vector3.length(r.evaluateDt(te[1]));(!v||v&&I>n.KERNEL_TOLERANCE)&&E.push({rangeInfo:te,rangeByInfo:re})}else console.warn("Error in intersection computation.")}else{var F=new s.Line,N=new s.Line,D=i.Vector3.createFloat64FromValues(y[0],y[1],y[2]),B=i.Vector3.createFloat64FromValues(y[y.length-3],y[y.length-2],y[y.length-1]),z=i.Vector3.createFloat64FromValues(_[0],_[1],_[2]),j=i.Vector3.createFloat64FromValues(_[_.length-3],_[_.length-2],_[_.length-1]);F.setFromEndpoints(D,B),N.setFromEndpoints(z,j);var U=new a.Edge(F),G=i.Vector3.distance(B,D),Y=new a.Edge(N),K=i.Vector3.distance(j,z);U.setRange([0,G]),Y.setRange([0,K]);var H=new o.Point;H.setPosition(D[0],D[1],D[2]);var q=new o.Point;q.setPosition(B[0],B[1],B[2]);var W=new o.Point;W.setPosition(z[0],z[1],z[2]);var X=new o.Point;X.setPosition(j[0],j[1],j[2]);var J=new l.Vertex(H),Z=new l.Vertex(q),Q=new l.Vertex(W),$=new l.Vertex(X);U.setStartVertex(J),U.setEndVertex(Z),Y.setStartVertex(Q),Y.setEndVertex($);var ee=m(U,Y,d,p);for(L=0;L<ee.length;++L)if(ee[L].hasOwnProperty("cutInfo")&&ee[L].hasOwnProperty("cutByInfo"))ee[L].cutInfo.param>=0&&ee[L].cutInfo.param<=G&&ee[L].cutByInfo.param>=0&&ee[L].cutByInfo.param<=K&&(ee[L].cutInfo.param=r.closestToPointParam(F.evaluatePosition(ee[L].cutInfo.param)),ee[L].cutByInfo.param=u.closestToPointParam(N.evaluatePosition(ee[L].cutByInfo.param)),V=g(r,ee[L].cutInfo.param,u,ee[L].cutByInfo.param,p))&&(O=V.cutInfo.param,k=V.cutByInfo.param,I=Math.abs(O-k)*i.Vector3.length(r.evaluateDt(O)),(!v||v&&I>n.KERNEL_TOLERANCE)&&E.push(V));else if(ee[L].hasOwnProperty("rangeInfo")&&ee[L].hasOwnProperty("rangeByInfo")&&ee[L].rangeInfo[0].param>=0&&ee[L].rangeInfo[0].param<=G&&ee[L].rangeInfo[1].param>=0&&ee[L].rangeInfo[1].param<=G&&ee[L].rangeByInfo[0].param>=0&&ee[L].rangeByInfo[0].param<=K&&ee[L].rangeByInfo[1].param>=0&&ee[L].rangeByInfo[1].param<=K){ee[L].rangeInfo[0].param=r.closestToPointParam(F.evaluatePosition(ee[L].rangeInfo[0].param)),ee[L].rangeInfo[1].param=r.closestToPointParam(F.evaluatePosition(ee[L].rangeInfo[1].param)),ee[L].rangeByInfo[0].param=u.closestToPointParam(N.evaluatePosition(ee[L].rangeByInfo[0].param)),ee[L].rangeByInfo[1].param=u.closestToPointParam(N.evaluatePosition(ee[L].rangeByInfo[1].param));var te=[f(r,ee[L].rangeInfo[0].param,p,u),f(r,ee[L].rangeInfo[1].param,p,u)],re=[f(u,ee[L].rangeByInfo[0].param,p,r),f(u,ee[L].rangeByInfo[1].param,p,r)];te[0]&&te[1]&&re[0]&&re[1]?(I=Math.abs(te[1].param-re[0].param)*i.Vector3.length(r.evaluateDt(te[1])),(!v||v&&I>n.KERNEL_TOLERANCE)&&E.push({rangeInfo:te,rangeByInfo:re})):console.warn("Error in intersection computation.")}}return E}(w,M,e,t,r,c,d,v,y);var I=-_[0]+3*_[3]-3*_[6]+_[9],F=3*_[0]-6*_[3]+3*_[6],N=-3*_[0]+3*_[3],D=_[0],B=-_[1]+3*_[4]-3*_[7]+_[10],z=3*_[1]-6*_[4]+3*_[7],j=-3*_[1]+3*_[4],U=_[1],G=D*D,Y=N*N,K=F*F,H=I*I,q=D*D*D,W=N*N*N,X=F*F*F,J=I*I*I,Z=U*U,Q=j*j,$=z*z,ee=B*B,te=U*U*U,re=j*j*j,ie=z*z*z,ne=B*B*B,oe=-x[0]+3*x[3]-3*x[6]+x[9],se=3*x[0]-6*x[3]+3*x[6],ae=-3*x[0]+3*x[3],le=x[0],ue=-x[1]+3*x[4]-3*x[7]+x[10],ce=3*x[1]-6*x[4]+3*x[7],he=-3*x[1]+3*x[4],de=x[1],pe=le*le,fe=le*le*le,ge=de*de,ve=de*de*de,ye=ae*ae,me=ae*ae*ae,_e=he*he,Ee=he*he*he,xe=se*se,be=se*se*se,Ae=ce*ce,Ce=ce*ce*ce,Te=oe*oe,Pe=ue*ue,Re=new Float64Array(10),Se=I*ue-B*oe;Re[0]=Se*Se*Se,Re[1]=3*(I*ce-B*se)*Se*Se,Re[2]=3*(I*ue-B*oe)*(H*he*ue+H*Ae-I*B*ae*ue-2*I*B*se*ce-I*B*oe*he+ee*ae*oe+ee*xe),Re[3]=3*D*H*B*Pe-6*D*I*ee*oe*ue+3*D*ne*Te-3*N*F*I*B*Pe+3*N*F*ee*oe*ue+2*N*H*z*Pe-N*I*z*B*oe*ue-N*z*ee*Te+X*B*Pe-K*I*z*Pe-2*K*z*B*oe*ue+F*H*j*Pe+F*I*j*B*oe*ue+2*F*I*$*oe*ue-2*F*j*ee*Te+F*$*B*Te-3*J*U*Pe+3*J*de*Pe+6*J*he*ce*ue+J*Ce+6*H*U*B*oe*ue-3*H*j*z*oe*ue-3*H*B*le*Pe-6*H*B*ae*ce*ue-6*H*B*se*he*ue-3*H*B*se*Ae-6*H*B*oe*de*ue-6*H*B*oe*he*ce-3*I*U*ee*Te+3*I*j*z*B*Te-I*ie*Te+6*I*ee*le*oe*ue+6*I*ee*ae*se*ue+6*I*ee*ae*oe*ce+3*I*ee*xe*ce+6*I*ee*se*oe*he+3*I*ee*Te*de-3*ne*le*Te-6*ne*ae*se*oe-ne*be,Re[4]=6*D*H*B*ce*ue-6*D*I*ee*se*ue-6*D*I*ee*oe*ce+6*D*ne*se*oe-6*N*F*I*B*ce*ue+3*N*F*ee*se*ue+3*N*F*ee*oe*ce+4*N*H*z*ce*ue-N*I*z*B*se*ue-N*I*z*B*oe*ce-2*N*z*ee*se*oe+2*X*B*ce*ue-2*K*I*z*ce*ue-2*K*z*B*se*ue-2*K*z*B*oe*ce+2*F*H*j*ce*ue+F*I*j*B*se*ue+F*I*j*B*oe*ce+2*F*I*$*se*ue+2*F*I*$*oe*ce-4*F*j*ee*se*oe+2*F*$*B*se*oe-6*J*U*ce*ue+6*J*de*ce*ue+3*J*_e*ue+3*J*he*Ae+6*H*U*B*se*ue+6*H*U*B*oe*ce-3*H*j*z*se*ue-3*H*j*z*oe*ce-6*H*B*le*ce*ue-6*H*B*ae*he*ue-3*H*B*ae*Ae-6*H*B*se*de*ue-6*H*B*se*he*ce-6*H*B*oe*de*ce-3*H*B*oe*_e-6*I*U*ee*se*oe+6*I*j*z*B*se*oe-2*I*ie*se*oe+6*I*ee*le*se*ue+6*I*ee*le*oe*ce+3*I*ee*ye*ue+6*I*ee*ae*se*ce+6*I*ee*ae*oe*he+3*I*ee*xe*he+6*I*ee*se*oe*de-6*ne*le*se*oe-3*ne*ye*oe-3*ne*ae*xe,Re[5]=6*D*H*B*he*ue+3*D*H*B*Ae-6*D*I*ee*ae*ue-6*D*I*ee*se*ce-6*D*I*ee*oe*he+6*D*ne*ae*oe+3*D*ne*xe-6*N*F*I*B*he*ue-3*N*F*I*B*Ae+3*N*F*ee*ae*ue+3*N*F*ee*se*ce+3*N*F*ee*oe*he+4*N*H*z*he*ue+2*N*H*z*Ae-N*I*z*B*ae*ue-N*I*z*B*se*ce-N*I*z*B*oe*he-2*N*z*ee*ae*oe-N*z*ee*xe+2*X*B*he*ue+X*B*Ae-2*K*I*z*he*ue-K*I*z*Ae-2*K*z*B*ae*ue-2*K*z*B*se*ce-2*K*z*B*oe*he+2*F*H*j*he*ue+F*H*j*Ae+F*I*j*B*ae*ue+F*I*j*B*se*ce+F*I*j*B*oe*he+2*F*I*$*ae*ue+2*F*I*$*se*ce+2*F*I*$*oe*he-4*F*j*ee*ae*oe-2*F*j*ee*xe+2*F*$*B*ae*oe+F*$*B*xe-6*J*U*he*ue-3*J*U*Ae+6*J*de*he*ue+3*J*de*Ae+3*J*_e*ce+6*H*U*B*ae*ue+6*H*U*B*se*ce+6*H*U*B*oe*he-3*H*j*z*ae*ue-3*H*j*z*se*ce-3*H*j*z*oe*he-6*H*B*le*he*ue-3*H*B*le*Ae-6*H*B*ae*de*ue-6*H*B*ae*he*ce-6*H*B*se*de*ce-3*H*B*se*_e-6*H*B*oe*de*he-6*I*U*ee*ae*oe-3*I*U*ee*xe+6*I*j*z*B*ae*oe+3*I*j*z*B*xe-2*I*ie*ae*oe-I*ie*xe+6*I*ee*le*ae*ue+6*I*ee*le*se*ce+6*I*ee*le*oe*he+3*I*ee*ye*ce+6*I*ee*ae*se*he+6*I*ee*ae*oe*de+3*I*ee*xe*de-6*ne*le*ae*oe-3*ne*le*xe-3*ne*ye*se,Re[6]=3*G*I*ee*ue-3*G*ne*oe-3*D*N*F*ee*ue+D*N*I*z*B*ue+2*D*N*z*ee*oe+2*D*K*z*B*ue-D*F*I*j*B*ue-2*D*F*I*$*ue+4*D*F*j*ee*oe-2*D*F*$*B*oe-6*D*H*U*B*ue+3*D*H*j*z*ue+6*D*H*B*de*ue+6*D*H*B*he*ce+6*D*I*U*ee*oe-6*D*I*j*z*B*oe+2*D*I*ie*oe-6*D*I*ee*le*ue-6*D*I*ee*ae*ce-6*D*I*ee*se*he-6*D*I*ee*oe*de+6*D*ne*le*oe+6*D*ne*ae*se+W*ee*ue-Y*F*z*B*ue-2*Y*I*j*B*ue+Y*I*$*ue-Y*j*ee*oe+N*K*j*B*ue+6*N*F*I*U*B*ue-N*F*I*j*z*ue-6*N*F*I*B*de*ue-6*N*F*I*B*he*ce-3*N*F*U*ee*oe+N*F*j*z*B*oe+3*N*F*ee*le*ue+3*N*F*ee*ae*ce+3*N*F*ee*se*he+3*N*F*ee*oe*de-4*N*H*U*z*ue+N*H*Q*ue+4*N*H*z*de*ue+4*N*H*z*he*ce+N*I*U*z*B*oe+2*N*I*Q*B*oe-N*I*j*$*oe-N*I*z*B*le*ue-N*I*z*B*ae*ce-N*I*z*B*se*he-N*I*z*B*oe*de-2*N*z*ee*le*oe-2*N*z*ee*ae*se-2*X*U*B*ue+2*X*B*de*ue+2*X*B*he*ce+2*K*I*U*z*ue-2*K*I*z*de*ue-2*K*I*z*he*ce+2*K*U*z*B*oe-K*Q*B*oe-2*K*z*B*le*ue-2*K*z*B*ae*ce-2*K*z*B*se*he-2*K*z*B*oe*de-2*F*H*U*j*ue+2*F*H*j*de*ue+2*F*H*j*he*ce-F*I*U*j*B*oe-2*F*I*U*$*oe+F*I*Q*z*oe+F*I*j*B*le*ue+F*I*j*B*ae*ce+F*I*j*B*se*he+F*I*j*B*oe*de+2*F*I*$*le*ue+2*F*I*$*ae*ce+2*F*I*$*se*he+2*F*I*$*oe*de-4*F*j*ee*le*oe-4*F*j*ee*ae*se+2*F*$*B*le*oe+2*F*$*B*ae*se+3*J*Z*ue-6*J*U*de*ue-6*J*U*he*ce+3*J*ge*ue+6*J*de*he*ce+J*Ee-3*H*Z*B*oe+3*H*U*j*z*oe+6*H*U*B*le*ue+6*H*U*B*ae*ce+6*H*U*B*se*he+6*H*U*B*oe*de-H*re*oe-3*H*j*z*le*ue-3*H*j*z*ae*ce-3*H*j*z*se*he-3*H*j*z*oe*de-6*H*B*le*de*ue-6*H*B*le*he*ce-6*H*B*ae*de*ce-3*H*B*ae*_e-6*H*B*se*de*he-3*H*B*oe*ge-6*I*U*ee*le*oe-6*I*U*ee*ae*se+6*I*j*z*B*le*oe+6*I*j*z*B*ae*se-2*I*ie*le*oe-2*I*ie*ae*se+3*I*ee*pe*ue+6*I*ee*le*ae*ce+6*I*ee*le*se*he+6*I*ee*le*oe*de+3*I*ee*ye*he+6*I*ee*ae*se*de-3*ne*pe*oe-6*ne*le*ae*se-ne*me,Re[7]=3*G*I*ee*ce-3*G*ne*se-3*D*N*F*ee*ce+D*N*I*z*B*ce+2*D*N*z*ee*se+2*D*K*z*B*ce-D*F*I*j*B*ce-2*D*F*I*$*ce+4*D*F*j*ee*se-2*D*F*$*B*se-6*D*H*U*B*ce+3*D*H*j*z*ce+6*D*H*B*de*ce+3*D*H*B*_e+6*D*I*U*ee*se-6*D*I*j*z*B*se+2*D*I*ie*se-6*D*I*ee*le*ce-6*D*I*ee*ae*he-6*D*I*ee*se*de+6*D*ne*le*se+3*D*ne*ye+W*ee*ce-Y*F*z*B*ce-2*Y*I*j*B*ce+Y*I*$*ce-Y*j*ee*se+N*K*j*B*ce+6*N*F*I*U*B*ce-N*F*I*j*z*ce-6*N*F*I*B*de*ce-3*N*F*I*B*_e-3*N*F*U*ee*se+N*F*j*z*B*se+3*N*F*ee*le*ce+3*N*F*ee*ae*he+3*N*F*ee*se*de-4*N*H*U*z*ce+N*H*Q*ce+4*N*H*z*de*ce+2*N*H*z*_e+N*I*U*z*B*se+2*N*I*Q*B*se-N*I*j*$*se-N*I*z*B*le*ce-N*I*z*B*ae*he-N*I*z*B*se*de-2*N*z*ee*le*se-N*z*ee*ye-2*X*U*B*ce+2*X*B*de*ce+X*B*_e+2*K*I*U*z*ce-2*K*I*z*de*ce-K*I*z*_e+2*K*U*z*B*se-K*Q*B*se-2*K*z*B*le*ce-2*K*z*B*ae*he-2*K*z*B*se*de-2*F*H*U*j*ce+2*F*H*j*de*ce+F*H*j*_e-F*I*U*j*B*se-2*F*I*U*$*se+F*I*Q*z*se+F*I*j*B*le*ce+F*I*j*B*ae*he+F*I*j*B*se*de+2*F*I*$*le*ce+2*F*I*$*ae*he+2*F*I*$*se*de-4*F*j*ee*le*se-2*F*j*ee*ye+2*F*$*B*le*se+F*$*B*ye+3*J*Z*ce-6*J*U*de*ce-3*J*U*_e+3*J*ge*ce+3*J*de*_e-3*H*Z*B*se+3*H*U*j*z*se+6*H*U*B*le*ce+6*H*U*B*ae*he+6*H*U*B*se*de-H*re*se-3*H*j*z*le*ce-3*H*j*z*ae*he-3*H*j*z*se*de-6*H*B*le*de*ce-3*H*B*le*_e-6*H*B*ae*de*he-3*H*B*se*ge-6*I*U*ee*le*se-3*I*U*ee*ye+6*I*j*z*B*le*se+3*I*j*z*B*ye-2*I*ie*le*se-I*ie*ye+3*I*ee*pe*ce+6*I*ee*le*ae*he+6*I*ee*le*se*de+3*I*ee*ye*de-3*ne*pe*se-3*ne*le*ye,Re[8]=3*G*I*ee*he-3*G*ne*ae-3*D*N*F*ee*he+D*N*I*z*B*he+2*D*N*z*ee*ae+2*D*K*z*B*he-D*F*I*j*B*he-2*D*F*I*$*he+4*D*F*j*ee*ae-2*D*F*$*B*ae-6*D*H*U*B*he+3*D*H*j*z*he+6*D*H*B*de*he+6*D*I*U*ee*ae-6*D*I*j*z*B*ae+2*D*I*ie*ae-6*D*I*ee*le*he-6*D*I*ee*ae*de+6*D*ne*le*ae+W*ee*he-Y*F*z*B*he-2*Y*I*j*B*he+Y*I*$*he-Y*j*ee*ae+N*K*j*B*he+6*N*F*I*U*B*he-N*F*I*j*z*he-6*N*F*I*B*de*he-3*N*F*U*ee*ae+N*F*j*z*B*ae+3*N*F*ee*le*he+3*N*F*ee*ae*de-4*N*H*U*z*he+N*H*Q*he+4*N*H*z*de*he+N*I*U*z*B*ae+2*N*I*Q*B*ae-N*I*j*$*ae-N*I*z*B*le*he-N*I*z*B*ae*de-2*N*z*ee*le*ae-2*X*U*B*he+2*X*B*de*he+2*K*I*U*z*he-2*K*I*z*de*he+2*K*U*z*B*ae-K*Q*B*ae-2*K*z*B*le*he-2*K*z*B*ae*de-2*F*H*U*j*he+2*F*H*j*de*he-F*I*U*j*B*ae-2*F*I*U*$*ae+F*I*Q*z*ae+F*I*j*B*le*he+F*I*j*B*ae*de+2*F*I*$*le*he+2*F*I*$*ae*de-4*F*j*ee*le*ae+2*F*$*B*le*ae+3*J*Z*he-6*J*U*de*he+3*J*ge*he-3*H*Z*B*ae+3*H*U*j*z*ae+6*H*U*B*le*he+6*H*U*B*ae*de-H*re*ae-3*H*j*z*le*he-3*H*j*z*ae*de-6*H*B*le*de*he-3*H*B*ae*ge-6*I*U*ee*le*ae+6*I*j*z*B*le*ae-2*I*ie*le*ae+3*I*ee*pe*he+6*I*ee*le*ae*de-3*ne*pe*ae,Re[9]=q*ne-G*N*z*ee-2*G*F*j*ee+G*F*$*B-3*G*I*U*ee+3*G*I*j*z*B-G*I*ie+3*G*I*ee*de-3*G*ne*le+D*Y*j*ee+3*D*N*F*U*ee-D*N*F*j*z*B-3*D*N*F*ee*de-D*N*I*U*z*B-2*D*N*I*Q*B+D*N*I*j*$+D*N*I*z*B*de+2*D*N*z*ee*le-2*D*K*U*z*B+D*K*Q*B+2*D*K*z*B*de+D*F*I*U*j*B+2*D*F*I*U*$-D*F*I*Q*z-D*F*I*j*B*de-2*D*F*I*$*de+4*D*F*j*ee*le-2*D*F*$*B*le+3*D*H*Z*B-3*D*H*U*j*z-6*D*H*U*B*de+D*H*re+3*D*H*j*z*de+3*D*H*B*ge+6*D*I*U*ee*le-6*D*I*j*z*B*le+2*D*I*ie*le-6*D*I*ee*le*de+3*D*ne*pe-W*U*ee+W*ee*de+Y*F*U*z*B-Y*F*z*B*de+2*Y*I*U*j*B-Y*I*U*$-2*Y*I*j*B*de+Y*I*$*de-Y*j*ee*le-N*K*U*j*B+N*K*j*B*de-3*N*F*I*Z*B+N*F*I*U*j*z+6*N*F*I*U*B*de-N*F*I*j*z*de-3*N*F*I*B*ge-3*N*F*U*ee*le+N*F*j*z*B*le+3*N*F*ee*le*de+2*N*H*Z*z-N*H*U*Q-4*N*H*U*z*de+N*H*Q*de+2*N*H*z*ge+N*I*U*z*B*le+2*N*I*Q*B*le-N*I*j*$*le-N*I*z*B*le*de-N*z*ee*pe+X*Z*B-2*X*U*B*de+X*B*ge-K*I*Z*z+2*K*I*U*z*de-K*I*z*ge+2*K*U*z*B*le-K*Q*B*le-2*K*z*B*le*de+F*H*Z*j-2*F*H*U*j*de+F*H*j*ge-F*I*U*j*B*le-2*F*I*U*$*le+F*I*Q*z*le+F*I*j*B*le*de+2*F*I*$*le*de-2*F*j*ee*pe+F*$*B*pe-J*te+3*J*Z*de-3*J*U*ge+J*ve-3*H*Z*B*le+3*H*U*j*z*le+6*H*U*B*le*de-H*re*le-3*H*j*z*le*de-3*H*B*le*ge-3*I*U*ee*pe+3*I*j*z*B*pe-I*ie*pe+3*I*ee*pe*de-ne*fe;var Ve=(0,u.getRealPolynomialRoots)(Re),we=c.getApproxParameterSpaceTolerance(),Me=-we,Le=1+we;R&&(Me=we),S&&(Le=1-we);for(var Oe=0;Oe<Ve.length;++Oe)if(Ve[Oe]>=Me&&Ve[Oe]<=Le){Ve[Oe]<0?Ve[Oe]=0:Ve[Oe]>1&&(Ve[Oe]=1),Ve[Oe]=A[0]+(A[A.length-1]-A[0])*Ve[Oe];var ke=t.getCurve().evaluatePosition(Ve[Oe]);if(C.isPointInsideWithTolerance(ke)){var Ie=r.closestToPointParam(ke,[]);if(Ie>=E[0]&&Ie<=E[E.length-1]){var Fe=e.getCurve().evaluatePosition(Ie);if(i.Vector3.squaredDistance(Fe,ke)<=v*v){var Ne=g(e,Ie*(e.isReversed()?-1:1),t,Ve[Oe]*(t.isReversed()?-1:1),v);Ne&&V.push(Ne)}}}}return V},R=function(e,t,r,n){var o=[],a=t.getControlPoints(),l=e.isReversed()?-1:1,u=new s.Line,h=i.Vector3.createFloat64FromValues(a[0],a[1],a[2]),d=i.Vector3.createFloat64FromValues(a[a.length-3],a[a.length-2],a[a.length-1]);u.setFromEndpoints(h,d);var p=i.Vector3.distance(d,h),f=i.Vector3.createFloat64FromValues(a[3],a[4],a[5]),v=i.Vector3.createFloat64FromValues(a[6],a[7],a[8]);if(u.closestToPointParam(f,[])>0&&u.closestToPointParam(f,[])<p&&u.closestToPointParam(v,[])>0&&u.closestToPointParam(v,[])<p)return o;var y,m=-a[0]+3*a[3]-3*a[6]+a[9],_=-a[1]+3*a[4]-3*a[7]+a[10],E=3*a[0]-6*a[3]+3*a[6],x=3*a[1]-6*a[4]+3*a[7],b=-3*a[0]+3*a[3],A=-3*a[1]+3*a[4],C=E/m,T=b/m,P=x/_,R=A/_;if(Math.abs(C-P)<n||Math.abs(R-T)<n)return o;var S=new Float64Array(4);if(Math.abs(m)<n&&Math.abs(_)<n)return o;Math.abs(m)<n?(y=-b/E,C=P,T=R):y=Math.abs(_)<n?-A/x:(R-T)/(C-P),S[0]=(-y*y*y-C*y*y-T*y)/2,S[1]=(3*y*y+2*y*C+2*T)/2,S[2]=-1.5*y,S[3]=1;var V,w=new Float64Array(3);if(3!==c.SplineCurveHelper.solve_cubic_uniqueRoots(S,w))return o;if(w[1]<w[0]&&(V=w[0],w[0]=w[1],w[1]=V),w[2]<w[0]&&(V=w[0],w[0]=w[2],w[2]=V),w[2]<w[1]&&(V=w[1],w[1]=w[2],w[2]=V),w[0]>=0&&w[0]<=1&&w[2]>=0&&w[2]<=1){var M=t.getKnotVector();w[0]=M[0]+(M[M.length-1]-M[0])*w[0],w[2]=M[0]+(M[M.length-1]-M[0])*w[2];var L=g(e,w[0]*l,e,w[2]*l,n);L&&o.push(L)}return o};t.computeCurveCurveIntersections=function(e,t,r,o,s){s=void 0===s?n.KERNEL_TOLERANCE:s;var a=e.getCurveType(),l=a===n.GEOMETRY_TYPES.CIRCLE,u=a===n.GEOMETRY_TYPES.LINE,c=a===n.GEOMETRY_TYPES.BCURVE&&!e.getCurve().isRational()&&3===e.getCurve().getDegree(),p=t.getCurveType(),v=p===n.GEOMETRY_TYPES.CIRCLE,b=p===n.GEOMETRY_TYPES.LINE,C=p===n.GEOMETRY_TYPES.BCURVE&&!t.getCurve().isRational()&&3===t.getCurve().getDegree();return u&&v?function(e,t,r){for(var i=_(e.getCurve(),t.getCurve(),r),n=[],o=0;o<i.length;++o){var s=(e.isReversed()?-1:1)*i[o].lineParam,a=(t.isReversed()?-1:1)*i[o].circleParam,l=g(e,s,t,a,r);l&&n.push(l)}return n}(e,t,s):l&&b?function(e,t,r,i){var n=_(t.getCurve(),e.getCurve(),i),o=[],s=0;e.isClosed()&&r&&(s=1);for(var a=0;a<n.length;++a){var l=(e.isReversed()?-1:1)*n[a].circleParam,u=(t.isReversed()?-1:1)*n[a].lineParam,c=g(e,l,t,u,i);if(c)for(var h=-s;h<=s;++h)o.push({cutInfo:{atVertex:c.cutInfo.atVertex,param:c.cutInfo.param+h*Math.PI*2},cutByInfo:c.cutByInfo})}return o}(e,t,o,s):u&&b?m(e,t,r,s):l&&v?function(e,t,r,n,o){var s=[],a=e.getCurve().getCenter(),l=e.getCurve().getRadius(),u=t.getCurve().getCenter(),c=t.getCurve().getRadius(),d=2*Math.PI,p=i.Vector3.createFloat64();i.Vector3.sub(p,u,a);var v=i.Vector3.length(p),m=Math.abs(l-c);if(v<m-o)return s;if(v+m<o){var _=o/l;if(e.getRange()[1]-e.getRange()[0]>d-_&&t.getRange()[1]-t.getRange()[0]>d-_)return s.push({rangeInfo:[f(e,e.getRange()[0],o,t),f(e,e.getRange()[1],o,t)],rangeByInfo:[f(t,t.getRange()[0],o,e),f(t,t.getRange()[1],o,e)]}),s;var x=[],b=e.closestToPointParam(t.evaluatePosition(0),[0,d]),A=i.Vector3.dot(e.evaluateDt(b),t.evaluateDt(0))<0,C=e.getRange(),T=t.getRange();T=A?[b-T[1],b-T[0]]:[b+T[0],b+T[1]];var P=(0,h.foldAbove)(T[0],C[0],d)-T[0];if((T=[T[0]+P,T[1]+P])[0]<C[1]+_&&x.push([Math.min(T[0],C[1]),Math.min(C[1],T[1])]),T[1]>C[0]+d-_&&x.push([C[0],Math.max(C[0],Math.min(C[1],T[1]-d))]),C[1]-C[0]>d-_||T[1]-T[0]>d-_)for(var R=x.length-1;R>=0&&1!==x.length;--R)x[R][1]-x[R][0]<_&&x.splice(R,1);for(R=0;R<x.length;++R){var S=x[R],V=A?[b-S[1],b-S[0]]:[S[0]-b,S[1]-b],w=(0,h.foldAbove)(V[0],t.getRange()[0],d)-V[0];if(V=[V[0]+w,V[1]+w],S[1]-S[0]<_){var M=.5*(S[0]+S[1]),L=.5*(V[0]+V[1]),O=f(e,M,o,t),k=f(t,L,o,e);O&&k&&s.push({cutInfo:O,cutByInfo:k})}else{var I=[f(e,S[0],o,t),f(e,S[1],o,t)],F=[f(t,V[0],o,e),f(t,V[1],o,e)];I[0]&&I[1]&&F[0]&&F[1]&&s.push({rangeInfo:I,rangeByInfo:F})}}return s}var N=(l*l-c*c+v*v)/(2*v),D=l*l-N*N,B=l-Math.abs(N),z=[],j=[];if(B<-o);else{var U=Math.sqrt(Math.max(0,D));if(i.Vector3.scale(p,p,1/v),U<2*o)z.push(E(0,N,a,p,e,t)),j.push(!1);else if(B<o)if(j.push(!1),r){j[j.length-1]=!0;var G=E(0,N,a,p,e,t),Y=[E(U,N,a,p,e,t),E(-U,N,a,p,e,t)];y(e,t,[Y[0].firstParam,G.firstParam,Y[1].firstParam],[Y[0].secondParam,G.secondParam,Y[1].secondParam],o,s,z)}else z.push(E(0,N,a,p,e,t));else z.push(E(U,N,a,p,e,t)),z.push(E(-U,N,a,p,e,t))}var K=0;for(e.isClosed()&&n&&(K=1),R=0;R<z.length;++R){var H=g(e,z[R].firstParam,t,z[R].secondParam,o);if(H)for(var q=-K;q<=K;++q)s.push({cutInfo:{atVertex:H.cutInfo.atVertex,param:H.cutInfo.param+q*Math.PI*2},cutByInfo:H.cutByInfo}),j[R]&&(s[s.length-1].cutInfo.virtualIntersection=!0,s[s.length-1].cutByInfo.virtualIntersection=!0)}return s}(e,t,r,o,s):u&&C?A(e,t,r,s):c&&b?function(e,t,r,i,n){var o=A(t,e,r,n),s=[],a=0,l=0;i&&e.getCurve().isPeriodicUnlimited()&&(a=1,l=e.getCurve().getPeriodUnlimited());for(var u=0;u<o.length;++u)if(o[u].hasOwnProperty("cutInfo")&&o[u].hasOwnProperty("cutByInfo"))for(var c=-a;c<=a;++c)s.push({cutInfo:{atVertex:o[u].cutByInfo.atVertex,param:o[u].cutByInfo.param+c*l},cutByInfo:o[u].cutInfo});else o[u].hasOwnProperty("rangeInfo")&&o[u].hasOwnProperty("rangeByInfo")&&s.push({rangeInfo:o[u].rangeByInfo,rangeByInfo:o[u].rangeInfo});return s}(e,t,r,o,s):l&&C?T(e,t,0,o,s):c&&v?function(e,t,r,i,n){var o=T(t,e,0,!1,n),s=[],a=0,l=0;i&&e.getCurve().isPeriodicUnlimited()&&(a=1,l=e.getCurve().getPeriodUnlimited());for(var u=0;u<o.length;++u)if(o[u].hasOwnProperty("cutInfo")&&o[u].hasOwnProperty("cutByInfo"))for(var c=-a;c<=a;++c)s.push({cutInfo:{atVertex:o[u].cutByInfo.atVertex,param:o[u].cutByInfo.param+c*l},cutByInfo:o[u].cutInfo});else o[u].hasOwnProperty("rangeInfo")&&o[u].hasOwnProperty("rangeByInfo")&&s.push({rangeInfo:o[u].rangeByInfo,rangeByInfo:o[u].rangeInfo});return s}(e,t,0,o,s):c&&C?function(e,t,r,i,n){var o=e===t,s=e.getBoundingBox(),a=t.getBoundingBox(),l=[];if(!s.intersectsWithTolerance(a,n))return l;var u,c,h,d,p=e.getCurve().getBezierSegments(),f=p.length,g=t.getCurve().getBezierSegments(),v=g.length,y=[],m=0,_=0,E=0;for(i&&e.getCurve().isPeriodic()&&e.isClosed()&&(_=1,E=e.getCurve().getPeriod()),u=0;u<f;u++)for(o&&(m=u+1),c=m;c<v;c++){var b=o&&c===u+1;for(y=P(e,t,p[u],g[c],r,n,b),h=0;h<y.length;++h)for(d=-_;d<=_;++d)y[h].cutInfo&&l.push({cutInfo:{atVertex:y[h].cutInfo.atVertex,param:y[h].cutInfo.param+d*E},cutByInfo:y[h].cutByInfo}),y[h].rangeInfo&&l.push(y[h])}if(o)for(u=0;u<f;++u)for(y=R(e,p[u],0,n),h=0;h<y.length;++h)for(d=-_;d<=_;++d)y[h].cutInfo&&l.push({cutInfo:{atVertex:y[h].cutInfo.atVertex,param:y[h].cutInfo.param+d*E},cutByInfo:y[h].cutByInfo}),y[h].rangeInfo&&l.push(y[h]);return x(l)}(e,t,r,o,s):function(e,t,r,i,o){var s=e.getBoundingBox(),a=t.getBoundingBox(),l=[];if(!s.intersectsWithTolerance(a,o))return l;var u=e.isReversed(),c=t.isReversed(),h=e.getRange();u&&(h=[-h[1],-h[0]]);var p=t.getRange();c&&(p=[-p[1],-p[0]]),l=new d.CCI(e.getCurve(),h,t.getCurve(),p,n.KERNEL_TOLERANCE).intersect();for(var f=0;f<l.length;++f)u&&(l[f].cutInfo?l[f].cutInfo.param*=-1:l[f].rangeInfo&&(l[f].rangeInfo=[l[f].rangeInfo[1],l[f].rangeInfo[0]],l[f].rangeInfo[0].param*=-1,l[f].rangeInfo[1].param*=-1)),c&&(l[f].cutByInfo?l[f].cutByInfo.param*=-1:l[f].rangeByInfo&&(l[f].rangeByInfo[0].param*=-1,l[f].rangeByInfo[1].param*=-1));return l}(e,t,0,0,s)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.edgesAreCoincident=t.curvesAreCoincident=void 0;var i=r(1),n=r(0),o=r(2),s=r(8);function a(e,t,r,n,o){var s=e.evaluatePosition(t),a=r.closestToPointParam(s,n),l=r.evaluatePosition(a);return i.Vector3.squaredDistance(s,l)<o*o}function l(e,t,r,n,o,s){var l=[0,0,0];if(i.Vector3.isParallel(e,t.getNormal()))return!0;i.Vector3.add(l,t.getCenter(),e);var u=t.closestToPointParam(l,n);if(u>n[0]&&u<n[1]&&!a(t,u,r,o,s))return!1;i.Vector3.sub(l,t.getCenter(),e);var c=t.closestToPointParam(l,n);return!(c>n[0]&&c<n[1]&&!a(t,c,r,o,s))}function u(e,t,r,i,n){if(!a(e,.5*(r[0]+r[1]),t,i,n))return!1;var o=t.closestToPointParam(e.getCenter(),i);return!(o>i[0]&&o<i[1]&&!a(t,o,e,r,n))}var c=function(e,t,r,c,h){r?0===r.length&&(r=e.getRangeUnlimited()):r=e.getRange(),c?0===c.length&&(c=t.getRangeUnlimited()):c=t.getRange(),h||(h=n.KERNEL_TOLERANCE);var d=e.getGeometryType(),p=t.getGeometryType();if(!(isFinite(r[0])&&isFinite(r[1])&&isFinite(c[0])&&isFinite(c[1]))){var f=r[0]===Number.NEGATIVE_INFINITY&&r[1]===Number.POSITIVE_INFINITY,g=c[0]===Number.NEGATIVE_INFINITY&&c[1]===Number.POSITIVE_INFINITY;return!(!f||!g)&&(o.ConsoleUtils.assert(d===n.GEOMETRY_TYPES.LINE&&p===n.GEOMETRY_TYPES.LINE),function(e,t,r){if(e===t)return!0;if(!a(e,0,t,[],r)||!a(t,0,e,[],r))return!1;var n=e.evaluateDt(0);i.Vector3.normalize(n,n);var o=t.evaluateDt(0);return i.Vector3.normalize(o,o),i.Vector3.dot(n,o)<0&&i.Vector3.negate(o,o),i.Vector3.equals(n,o,i.FLOAT64_TOLERANCE)}(e,t,h))}return e===t&&Math.abs(r[0]-c[0])<i.FLOAT64_TOLERANCE&&Math.abs(r[1]-c[1])<i.FLOAT64_TOLERANCE||!!(a(e,r[0],t,c,h)&&a(e,r[1],t,c,h)&&a(t,c[0],e,r,h)&&a(t,c[1],e,r,h))&&(d===n.GEOMETRY_TYPES.LINE&&p===n.GEOMETRY_TYPES.LINE||(d===n.GEOMETRY_TYPES.CIRCLE&&p===n.GEOMETRY_TYPES.CIRCLE?function(e,t,r,n,o){var s=.5*(r[0]+r[1]),u=.5*(n[0]+n[1]);if(!a(e,s,t,n,o)||!a(t,u,e,r,o))return!1;var c=i.Vector3.sub([0,0,0],t.getCenter(),e.getCenter());if(i.Vector3.squaredLength(c)>i.FLOAT64_TOLERANCE*i.FLOAT64_TOLERANCE){if(i.Vector3.normalize(c,c),!l(c,e,t,r,n,o))return!1;if(!l(c,t,e,n,r,o))return!1}if(i.Vector3.dot(e.getNormal(),t.getNormal())<0?i.Vector3.add(c,e.getNormal(),t.getNormal()):i.Vector3.sub(c,e.getNormal(),t.getNormal()),i.Vector3.squaredLength(c)>i.FLOAT64_TOLERANCE*i.FLOAT64_TOLERANCE){if(i.Vector3.normalize(c,c),!l(c,e,t,r,n,o))return!1;if(!l(c,t,e,n,r,o))return!1}if(r[1]-r[0]<2*Math.PI-i.FLOAT64_TOLERANCE){var h=e.evaluatePosition(s+Math.PI),d=t.closestToPointParam(h,n);if(d>n[0]&&d<n[1]&&!a(t,d,e,r,o))return!1}if(n[1]-n[0]<2*Math.PI-i.FLOAT64_TOLERANCE){var p=t.evaluatePosition(u+Math.PI),f=e.closestToPointParam(p,r);if(f>r[0]&&f<r[1]&&!a(e,f,t,n,o))return!1}return!0}(e,t,r,c,h):d===n.GEOMETRY_TYPES.CIRCLE&&p===n.GEOMETRY_TYPES.LINE?u(e,t,r,c,h):d===n.GEOMETRY_TYPES.LINE&&p===n.GEOMETRY_TYPES.CIRCLE?u(t,e,c,r,h):function(e,t,r,n,o){for(var a=[r[0],r[1]],l=[e.evaluatePosition(r[0]),e.evaluatePosition(r[1])],u=0;u<100;++u){var c=.5*(a[0]+a[1]),h=e.evaluatePosition(c),d=t.closestToPointParam(h,n),p=t.evaluatePosition(d),f=i.Vector3.sub([0,0,0],p,h);if(i.Vector3.squaredLength(f)>o*o)return!1;if(i.Vector3.distance(l[0],h)+i.Vector3.distance(h,l[1])<o)return!0;var g=e.evaluateDt(c);i.Vector3.dot(g,f)<0?(a[0]=c,l[0]=h):(a[1]=c,l[1]=h)}return s.DebugUtils.warn("Binary search in coincidence check exceeded maximum iterations"),!0}(e,t,r,c,h)))};t.curvesAreCoincident=c,t.edgesAreCoincident=function(e,t){if(e===t)return!0;var r=Math.max(n.KERNEL_TOLERANCE,e.getPrecision(),t.getPrecision()),o=e.getCurve(),s=t.getCurve();if(!o||!s){if(o||s)return!1;var a=e.getStartVertex(),l=t.getStartVertex();r=Math.max(r,a.getPrecision(),l.getPrecision());var u=a.getPosition(),h=l.getPosition();return i.Vector3.squaredDistance(u,h)<r*r}var d=e.getRange();e.isReversed()&&(d=[-d[1],-d[0]]);var p=t.getRange();return t.isReversed()&&(p=[-p[1],-p[0]]),c(o,s,d,p,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extrudeFace=void 0;var i=r(1),n=r(0),o=r(2),s=r(18),a=r(38),l=r(39),u=r(53),c=r(13),h=r(15),d=r(26),p=r(25),f=r(24),g=r(55),v=r(19),y=r(28);function m(e,t,r){var o=i.Vector3.length(r),s=i.Vector3.dot(e.getAxisDir(),r)>0?[0,o]:[-o,0];e.limitRangeU(s),t[1]-t[0]<2*Math.PI-n.PARAMETER_SPACE_TOLERANCE&&e.limitRangeV(t)}var _=function(e,t){var r=e.getEdge().getCurve(),o=e.getRange(),c=!0;e.isReversed()!==e.getEdge().isReversed()&&(o=[-o[1],-o[0]],c=!1);var h,d=c?e.t0():e.t1(),p=e.evaluateDt(d);if(i.Vector3.cross(p,p,t),i.Vector3.normalize(p,p),i.Vector3.negate(p,p),r.getGeometryType()===n.GEOMETRY_TYPES.LINE)h=function(e,t,r){var n=new s.Plane,o=e.evaluateDt(0),a=i.Vector3.createFloat64();i.Vector3.normalize(a,r);var l=i.Vector3.createFloat64();i.Vector3.cross(l,a,o),n.set(e.evaluatePosition(0),l,a);var u=i.Vector3.length(r),c=i.Vector3.dot(a,r)>0?[0,u]:[-u,0];return n.limitRangeV(t),n.limitRangeU(c),n}(r,o,t);else if(r.getGeometryType()===n.GEOMETRY_TYPES.CIRCLE)h=function(e,t,r){var n=e.evaluatePosition(0);i.Vector3.subtract(n,n,e.getCenter());var o=i.Vector3.createFloat64();i.Vector3.negate(o,e.getNormal());var s=new a.Cylinder;return s.set(e.getCenter(),e.getRadius(),o,n,1),m(s,t,r),s}(r,o,t);else if(r.getGeometryType()===n.GEOMETRY_TYPES.ELLIPSE)h=function(e,t,r){var n=e.evaluatePosition(0);i.Vector3.subtract(n,n,e.getCenter());var o=i.Vector3.createFloat64();i.Vector3.negate(o,e.getNormal());var s=new l.EllipticalCylinder;return s.set(e.getCenter(),n,e.getMinorRadius()/e.getMajorRadius(),o,1),m(s,t,r),s}(r,o,t);else{if(r.getGeometryType()!==n.GEOMETRY_TYPES.BCURVE)throw new Error("createSideFaceRuledSurface: Curve type not supported.");h=function(e,t,r){for(var i=new u.BSurface,n=e.getDegree(),o=e.getKnotVector().slice(0),s=e.getControlPoints().slice(0),a=(s=s.concat(s)).length/2;a<s.length;a+=3)s[a]+=r[0],s[a+1]+=r[1],s[a+2]+=r[2];var l=void 0;return e.isRational()&&(l=(l=e.getWeights().slice(0)).concat(l)),i.set(1,n,[0,0,1,1],o,s,l),i.limitRangeU([0,1]),i.limitRangeV(t),i}(r,o,t)}var f=h.evaluateNormal(0,o[0]);return{surface:h,isReversed:i.Vector3.dot(f,p)<0}};t.extrudeFace=function(e,t){o.ConsoleUtils.assert(e.getSurfaceType()===n.GEOMETRY_TYPES.PLANE);var r=e.evaluateNormal(0,0);i.Vector3.scale(r,r,t);var s=(new g.TopologyCloner).cloneFace(e),a=i.Matrix44.fromTranslation(i.Matrix44.createFloat64(),r);(0,v.transformTopology)(s,a),t>0?(0,v.reverseFace)(e):(0,v.reverseFace)(s);var l=function(e,t,r){for(var i=[],n=e.getLoops(),o=t.getLoops(),s=0;s<n.length;++s)for(var a=n[s].getCoedges(),l=o[s].getCoedges(),u=new Array(a.length),d=0;d<a.length;++d){var p=new Array(4),f=a[d],g=l[a.length-1-d],v=f.getStartVertex(),m=f.getEndVertex(),E=g.getStartVertex(),x=g.getEndVertex();p[0]=(0,y.createCoedgeOnEdge)(f.getEdge()),0===d&&(u[d]=(0,y.createLineEdgeBetweenVertices)(v,x)),p[1]=(0,y.createCoedgeOnEdge)(u[d]),p[2]=(0,y.createCoedgeOnEdge)(g.getEdge()),d!==a.length-1&&(u[d+1]=(0,y.createLineEdgeBetweenVertices)(E,m)),p[3]=(0,y.createCoedgeOnEdge)(u[(d+1)%a.length]);var b=new c.Loop;b.addCoedges(p);var A=_(f,r),C=new h.Face(A.surface);C.setReversed(A.isReversed),C.addLoop(b),i.push(C)}return i}(e,s,r),u=e.getShell();u||(u=new d.Shell).addFace(e),o.ConsoleUtils.assert(1===u.getFaces().length),u.addFaces(l),u.addFace(s);var m=u.getLump();m||(m=new p.Lump).addShell(u);var E=m.getBody();return E||(E=new f.Body).addLump(m),E}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundedRegionFaces=t.getRegionEdges=t.mergeSketchRegions=void 0;var i=r(0),n=r(19),o=r(80),s=function(e,t){var r=e.getProgenitorMap(),n=new Set;return t.forEach((function(e){r.getDescendants(e).forEach((function(e){e.getTopologyType()===i.TOPOLOGY_TYPES.EDGE&&n.add(e)}))})),Array.from(n)},a=function(e,t){var r=[];return(0,n.findConnectedFaces)(e,{allowVertexConnections:!1,barrierEdges:t}).forEach((function(e){(function(e,t){e=new Set(e),t=new Set(t);var r=new Set;e.forEach((function(e){e.collectEdges(r)})),r=Array.from(r);for(var i=0;i<r.length;i++){var n=r[i];if(!t.has(n)){var o=n.getCoedges();if(o.length<2)return!1;for(var s=0;s<o.length;s++)if(!e.has(o[s].getFace()))return!1}}return!0})(e,t)&&(r=r.concat(e))})),r},l=function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])<0)return!1;return!0};t.mergeSketchRegions=function(e){var t,r,i=[];e.forEach((function(e){i=i.concat(e.getEdges())}));var u=new o.SketchRegionSolver;u.compute(i);var c=u.getFaces(),h=[],d=[];for(t=0;t<e.length;t++){var p=s(u,e[t].getEdges());if(0!==p.length){var f=a(c,p);0!==f.length&&(d.push(p),h.push(f))}}for(var g=[],v=new Set(c),y=!0;h.length>0;){var m=[];for(t=0;t<h.length;t++){var _=!1;for(r=0;r<h.length;r++)if(t!==r&&l(h[t],h[r])){_=!0;break}m.push(_)}var E=new Set;for(t=h.length-1;t>=0;t--)m[t]?h[t].forEach((function(e){E.add(e),v.delete(e)})):(h.splice(t,1),d.splice(t,1));y&&(g=g.concat(Array.from(v))),v=E,y=!y}return(0,n.mergeConnectedFaces)(g)},t.getRegionEdges=s,t.getBoundedRegionFaces=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.propertyToRange=t.GeometrySetters=void 0;var i=r(1),n=function(e,t,r){var i=t[r];e[0]=i.x,e[1]=i.y,e[2]=i.z},o=function(e,t){var r=e[t],i=r.type;return"infinite"===i||0===i?[]:[r.low,r.high]},s=function(e,t){var r=o(e,"uRange");t.unlimitRangeU(),r.length>0&&t.limitRangeU(r);var i=o(e,"vRange");t.unlimitRangeV(),i.length>0&&t.limitRangeV(i)},a=function(e,t){var r=o(e,"range");t.unlimitRange(),r.length>0&&t.limitRange(r)},l={setBCurveFromProperty:function(e,t){var r,i,n=t.degree,o=t.knots,s=t.controlPoints,l=t.weights,u=s.length/3;if(0===l.length)for(i=new Array(u),r=0;r<u;++r)i[r]=1;else i=l;e.set(s,i,n,o),a(t,e)},setBSurfaceFromProperty:function(e,t){var r,i,n=t.uDegree,o=t.vDegree,a=t.uKnots,l=t.vKnots,u=t.controlPoints,c=t.weights;if(0===c.length){var h=u.length/3;for(i=new Array(h),r=0;r<h;++r)i[r]=1}else i=c;e.set(n,o,a,l,u,i),s(t,e)},setCircleFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),s=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"normal"),n(s,t,"radius"),e.set(r,o,s),a(t,e)},setConeFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"axis"),n(a,t,"radius");var l=i.Vector3.length(a);i.Vector3.normalize(a,a);var u=t.angle,c=t.uCoordScale;e.set(r,l,o,u,a,c),s(t,e)},setCylinderFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"axis"),n(a,t,"radius");var l=i.Vector3.length(a);i.Vector3.normalize(a,a);var u=t.uCoordScale;e.set(r,l,o,a,u),s(t,e)},setEllipseFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),s=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"normal"),n(s,t,"majorRadius");var l=t.radiusRatio;e.set(r,o,s,l),a(t,e)},setEllipticalConeFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"axis"),n(a,t,"majorRadius");var l=t.angle,u=t.radiusRatio,c=t.uCoordScale;e.set(r,a,u,o,l,c),s(t,e)},setEllipticalCylinderFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"axis"),n(a,t,"majorRadius");var l=t.radiusRatio,u=t.uCoordScale;e.set(r,a,l,o,u),s(t,e)},setLineFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64();n(r,t,"position"),n(o,t,"direction"),e.set(r,o),a(t,e)},setPlaneFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();n(r,t,"origin"),n(o,t,"normal"),n(a,t,"uAxis"),e.set(r,o,a),s(t,e)},setPointFromProperty:function(e,t){e.setPosition(t.position.x,t.position.y,t.position.z)},setSphereFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"radius"),n(a,t,"axis");var l=i.Vector3.length(o);i.Vector3.normalize(o,o),e.set(r,l,a,o),s(t,e)},setTorusFromProperty:function(e,t){var r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();n(r,t,"center"),n(o,t,"axis"),n(a,t,"coordAxis");var l=t.majorRadius,u=t.minorRadius,c=t.lemon;e.set(r,l,u,o,a,c),s(t,e)},setHapCurveFromProperty:function(e,t){for(var r=t.spans,i=new Array(r.length),n=0;n<r.length;++n)i[n]={},i[n].polyOrder=r[n].polyOrder,i[n].lowParam=r[n].lowParam,i[n].highParam=r[n].highParam,i[n].coefs=r[n].coefs.slice(0);var o={};o.spans=i;var s=t.periodic;void 0===s&&(s=!1),o.periodic=s,o.closed=s,e.setHapDefinition(o),a(t,e)},setCurveRangeFromProperty:a,setSurfaceRangeFromProperty:s};t.GeometrySetters=l,t.propertyToRange=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundedRegionFaces=t.getRegionEdges=t.mergeConnectedFaces=t.getOrderedFacesOnVertex=t.saveToProtoMessage=t.saveToProtoBinary=t.SolidDefSaver=t.SolidDefLoader=t.Path2D=t.DebugUtils=t.svgFromWire=t.transformTopology=t.TopologyStitcher=t.TopologyCloner=t.extrudeFace=t.createEdgeFromCurve=t.createFaceFromPolyline=t.createShellsFromFaces=t.createPolyhedron=t.createLineEdgeBetweenVertices=t.createLineEdge=t.createCylinder=t.createCone=t.createBlock=t.computeCurveCurveIntersections=t.SketchRegionSolver=t.facetPlanarFace=t.checkValidity=t.BoundingBox=t.Attribute=t.Wire=t.WireBody=t.Vertex=t.Edge=t.Coedge=t.Loop=t.Face=t.Shell=t.Lump=t.Body=t.BSurface=t.Torus=t.EllipticalCone=t.Cone=t.Sphere=t.EllipticalCylinder=t.Cylinder=t.Plane=t.BCurve=t.Ellipse=t.Circle=t.Line=t.Point=t.TOPOLOGY_TYPES=t.GEOMETRY_TYPES=t.KERNEL_TOLERANCE=void 0;var i=r(0),n=r(4),o=r(6),s=r(7),a=r(14),l=r(23),u=r(33),c=r(18),h=r(38),d=r(39),p=r(74),f=r(51),g=r(52),v=r(75),y=r(53),m=r(24),_=r(25),E=r(26),x=r(15),b=r(13),A=r(27),C=r(20),T=r(16),P=r(54),R=r(40),S=r(79),V=r(106),w=r(107),M=r(80),L=r(81),O=r(115),k=r(116),I=r(117),F=r(28),N=r(83),D=r(55),B=r(118),z=r(19),j=r(121),U=r(8),G=r(122),Y=r(123),K=r(126),H=r(84),q=r(78);t.KERNEL_TOLERANCE=i.KERNEL_TOLERANCE,t.GEOMETRY_TYPES=i.GEOMETRY_TYPES,t.TOPOLOGY_TYPES=i.TOPOLOGY_TYPES,t.Point=o.Point,t.Line=s.Line,t.Circle=a.Circle,t.Ellipse=l.Ellipse,t.BCurve=u.BCurve,t.Plane=c.Plane,t.Cylinder=h.Cylinder,t.EllipticalCylinder=d.EllipticalCylinder,t.Sphere=p.Sphere,t.Cone=f.Cone,t.EllipticalCone=g.EllipticalCone,t.Torus=v.Torus,t.BSurface=y.BSurface,t.Body=m.Body,t.Lump=_.Lump,t.Shell=E.Shell,t.Face=x.Face,t.Loop=b.Loop,t.Coedge=A.Coedge,t.Edge=C.Edge,t.Vertex=T.Vertex,t.WireBody=P.WireBody,t.Wire=R.Wire,t.Attribute=S.Attribute,t.BoundingBox=n.BoundingBox,t.checkValidity=V.checkValidity,t.facetPlanarFace=w.facetPlanarFace,t.SketchRegionSolver=M.SketchRegionSolver,t.computeCurveCurveIntersections=L.computeCurveCurveIntersections,t.createBlock=O.createBlock,t.createCone=k.createCone,t.createCylinder=k.createCylinder,t.createLineEdge=F.createLineEdge,t.createLineEdgeBetweenVertices=F.createLineEdgeBetweenVertices,t.createPolyhedron=I.createPolyhedron,t.createShellsFromFaces=F.createShellsFromFaces,t.createFaceFromPolyline=F.createFaceFromPolyline,t.createEdgeFromCurve=F.createEdgeFromCurve,t.extrudeFace=N.extrudeFace,t.TopologyCloner=D.TopologyCloner,t.TopologyStitcher=B.TopologyStitcher,t.transformTopology=z.transformTopology,t.svgFromWire=j.svgFromWire,t.DebugUtils=U.DebugUtils,t.Path2D=G.Path2D,t.SolidDefLoader=Y.SolidDefLoader,t.SolidDefSaver=K.SolidDefSaver,t.saveToProtoBinary=K.saveToProtoBinary,t.saveToProtoMessage=K.saveToProtoMessage,t.getOrderedFacesOnVertex=q.getOrderedFacesOnVertex,t.mergeConnectedFaces=z.mergeConnectedFaces,t.getRegionEdges=H.getRegionEdges,t.getBoundedRegionFaces=H.getBoundedRegionFaces},function(e,t,r){"use strict";e.exports=r(88)},function(e,t,r){"use strict";var i=e.exports=r(89);i.build="light",i.load=function(e,t,r){return"function"==typeof t?(r=t,t=new i.Root):t||(t=new i.Root),t.load(e,r)},i.loadSync=function(e,t){return t||(t=new i.Root),t.loadSync(e)},i.encoder=r(62),i.decoder=r(67),i.verifier=r(68),i.converter=r(69),i.ReflectionObject=r(21),i.Namespace=r(30),i.Root=r(71),i.Enum=r(11),i.Type=r(63),i.Field=r(22),i.OneOf=r(48),i.MapField=r(64),i.Service=r(65),i.Method=r(66),i.Message=r(49),i.wrappers=r(70),i.types=r(31),i.util=r(5),i.ReflectionObject._configure(i.Root),i.Namespace._configure(i.Type,i.Service,i.Enum),i.Root._configure(i.Type),i.Field._configure(i.Type)},function(e,t,r){"use strict";var i=t;function n(){i.Reader._configure(i.BufferReader),i.util._configure()}i.build="minimal",i.Writer=r(46),i.BufferWriter=r(96),i.Reader=r(47),i.BufferReader=r(97),i.util=r(10),i.rpc=r(60),i.roots=r(61),i.configure=n,i.Writer._configure(i.BufferWriter),n()},function(e,t,r){"use strict";var i=t;i.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=new Array(64),o=new Array(123),s=0;s<64;)o[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(e,t,r){for(var i,o=null,s=[],a=0,l=0;t<r;){var u=e[t++];switch(l){case 0:s[a++]=n[u>>2],i=(3&u)<<4,l=1;break;case 1:s[a++]=n[i|u>>4],i=(15&u)<<2,l=2;break;case 2:s[a++]=n[i|u>>6],s[a++]=n[63&u],l=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return l&&(s[a++]=n[i],s[a++]=61,1===l&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))},i.decode=function(e,t,r){for(var i,n=r,s=0,a=0;a<e.length;){var l=e.charCodeAt(a++);if(61===l&&s>1)break;if(void 0===(l=o[l]))throw Error("invalid encoding");switch(s){case 0:i=l,s=1;break;case 1:t[r++]=i<<2|(48&l)>>4,i=l,s=2;break;case 2:t[r++]=(15&i)<<4|(60&l)>>2,i=l,s=3;break;case 3:t[r++]=(3&i)<<6|l,s=0}}if(1===s)throw Error("invalid encoding");return r-n},i.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){"use strict";function i(){this._listeners={}}e.exports=i,i.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},i.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this},i.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}},function(e,t,r){"use strict";function i(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),i=128===r[3];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3]}function o(e,i,n){t[0]=e,i[n]=r[3],i[n+1]=r[2],i[n+2]=r[1],i[n+3]=r[0]}function s(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],t[0]}function a(e,i){return r[3]=e[i],r[2]=e[i+1],r[1]=e[i+2],r[0]=e[i+3],t[0]}e.writeFloatLE=i?n:o,e.writeFloatBE=i?o:n,e.readFloatLE=i?s:a,e.readFloatBE=i?a:s}():function(){function t(e,t,r,i){var n=t<0?1:0;if(n&&(t=-t),0===t)e(1/t>0?0:2147483648,r,i);else if(isNaN(t))e(2143289344,r,i);else if(t>34028234663852886e22)e((n<<31|2139095040)>>>0,r,i);else if(t<11754943508222875e-54)e((n<<31|Math.round(t/1401298464324817e-60))>>>0,r,i);else{var o=Math.floor(Math.log(t)/Math.LN2);e((n<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,i)}}function r(e,t,r){var i=e(t,r),n=2*(i>>31)+1,o=i>>>23&255,s=8388607&i;return 255===o?s?NaN:n*(1/0):0===o?1401298464324817e-60*n*s:n*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,s),e.readFloatBE=r.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),i=128===r[7];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3],i[n+4]=r[4],i[n+5]=r[5],i[n+6]=r[6],i[n+7]=r[7]}function o(e,i,n){t[0]=e,i[n]=r[7],i[n+1]=r[6],i[n+2]=r[5],i[n+3]=r[4],i[n+4]=r[3],i[n+5]=r[2],i[n+6]=r[1],i[n+7]=r[0]}function s(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],r[4]=e[i+4],r[5]=e[i+5],r[6]=e[i+6],r[7]=e[i+7],t[0]}function a(e,i){return r[7]=e[i],r[6]=e[i+1],r[5]=e[i+2],r[4]=e[i+3],r[3]=e[i+4],r[2]=e[i+5],r[1]=e[i+6],r[0]=e[i+7],t[0]}e.writeDoubleLE=i?n:o,e.writeDoubleBE=i?o:n,e.readDoubleLE=i?s:a,e.readDoubleBE=i?a:s}():function(){function t(e,t,r,i,n,o){var s=i<0?1:0;if(s&&(i=-i),0===i)e(0,n,o+t),e(1/i>0?0:2147483648,n,o+r);else if(isNaN(i))e(0,n,o+t),e(2146959360,n,o+r);else if(i>17976931348623157e292)e(0,n,o+t),e((s<<31|2146435072)>>>0,n,o+r);else{var a;if(i<22250738585072014e-324)e((a=i/5e-324)>>>0,n,o+t),e((s<<31|a/4294967296)>>>0,n,o+r);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=i*Math.pow(2,-l))>>>0,n,o+t),e((s<<31|l+1023<<20|1048576*a&1048575)>>>0,n,o+r)}}}function r(e,t,r,i,n){var o=e(i,n+t),s=e(i,n+r),a=2*(s>>31)+1,l=s>>>20&2047,u=4294967296*(1048575&s)+o;return 2047===l?u?NaN:a*(1/0):0===l?5e-324*a*u:a*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,s,0,4),e.readDoubleBE=r.bind(null,a,4,0)}(),e}function n(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=i(i)},function(e,t,r){"use strict";var i=t;i.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)(r=e.charCodeAt(i))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},i.read=function(e,t,r){if(r-t<1)return"";for(var i,n=null,o=[],s=0;t<r;)(i=e[t++])<128?o[s++]=i:i>191&&i<224?o[s++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(i>>10),o[s++]=56320+(1023&i)):o[s++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),s=0);return n?(s&&n.push(String.fromCharCode.apply(String,o.slice(0,s))),n.join("")):String.fromCharCode.apply(String,o.slice(0,s))},i.write=function(e,t,r){for(var i,n,o=r,s=0;s<e.length;++s)(i=e.charCodeAt(s))<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&56320==(64512&(n=e.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&n),++s,t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128);return r-o}},function(e,t,r){"use strict";e.exports=function(e,t,r){var i=r||8192,n=i>>>1,o=null,s=i;return function(r){if(r<1||r>n)return e(r);s+r>i&&(o=e(i),s=0);var a=t.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},function(e,t,r){"use strict";e.exports=n;var i=r(10);function n(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=n.zero=new n(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new n(r,i)},n.from=function(e){if("number"==typeof e)return n.fromNumber(e);if(i.isString(e)){if(!i.Long)return n.fromNumber(parseInt(e,10));e=i.Long.fromString(e)}return e.low||e.high?new n(e.low>>>0,e.high>>>0):o},n.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},n.prototype.toLong=function(e){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;n.fromHash=function(e){return e===s?o:new n((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},n.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},n.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){"use strict";e.exports=s;var i=r(46);(s.prototype=Object.create(i.prototype)).constructor=s;var n=r(10),o=n.Buffer;function s(){i.call(this)}s.alloc=function(e){return(s.alloc=n._Buffer_allocUnsafe)(e)};var a=o&&o.prototype instanceof Uint8Array&&"set"===o.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]};function l(e,t,r){e.length<40?n.utf8.write(e,t,r):t.utf8Write(e,r)}s.prototype.bytes=function(e){n.isString(e)&&(e=n._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(a,t,e),this},s.prototype.string=function(e){var t=o.byteLength(e);return this.uint32(t),t&&this._push(l,t,e),this}},function(e,t,r){"use strict";e.exports=o;var i=r(47);(o.prototype=Object.create(i.prototype)).constructor=o;var n=r(10);function o(e){i.call(this,e)}n.Buffer&&(o.prototype._slice=n.Buffer.prototype.slice),o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},function(e,t,r){"use strict";e.exports=n;var i=r(10);function n(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(n.prototype=Object.create(i.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function e(t,r,n,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return i.asPromise(e,a,t,r,n,o);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof n))try{r=n[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},n.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){"use strict";function i(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function n(e){if("string"!=typeof e){var t=o();if(i.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var s=Object.keys(e),a=new Array(s.length+1),l=new Array(s.length),u=0;u<s.length;)a[u]=s[u],l[u]=e[s[u++]];return a[u]=t,Function.apply(null,a).apply(null,l)}return Function(t)()}for(var c=new Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var r=c[h++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"})),h!==c.length)throw Error("parameter count mismatch");return r.push(e),n}function o(i){return"function "+(i||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return n.toString=o,n}e.exports=i,i.verbose=!1},function(e,t,r){"use strict";e.exports=o;var i=r(58),n=r(59)("fs");function o(e,t,r){return"function"==typeof t?(r=t,t={}):t||(t={}),r?!t.xhr&&n&&n.readFile?n.readFile(e,(function(i,n){return i&&"undefined"!=typeof XMLHttpRequest?o.xhr(e,t,r):i?r(i):r(null,t.binary?n:n.toString("utf8"))})):o.xhr(e,t,r):i(o,this,e,t)}o.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState){if(0!==i.status&&200!==i.status)return r(Error("status "+i.status));if(t.binary){var e=i.response;if(!e){e=[];for(var n=0;n<i.responseText.length;++n)e.push(255&i.responseText.charCodeAt(n))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}},function(e,t,r){"use strict";var i=t,n=i.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},o=i.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=n(e),i="";r&&(i=t.shift()+"/");for(var o=0;o<t.length;)".."===t[o]?o>0&&".."!==t[o-1]?t.splice(--o,2):r?t.splice(o,1):++o:"."===t[o]?t.splice(o,1):++o;return i+t.join("/")};i.resolve=function(e,t,r){return r||(t=o(t)),n(t)?t:(r||(e=o(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?o(e+"/"+t):t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decomposeBCurveFlags=t.decomposeBCurveToBezier=t.decomposeBCurveControlPoints=void 0;var i=r(17),n=r(2),o=function(e,t,r){n.ConsoleUtils.assert(t.length%r==0);var i,o,s,a=e.length-t.length/r-1;n.ConsoleUtils.assert(a>0);var l=e.length-1,u=a,c=a+1,h=0,d=[],p=[];for(p[h]=new Array((a+1)*r),i=0;i<=a;++i)for(s=0;s<r;++s)p[h][i*r+s]=t[i*r+s];for(;c<l;){for(var f=1;c<l&&e[c+1]===e[c];)++c,++f;var g=c===l;if(g||(p[h+1]=new Array((a+1)*r)),f<a){var v=e[c]-e[u];for(o=a;o>f;--o)d[o-f-1]=v/(e[u+o]-e[u]);var y=a-f;for(o=1;o<=y;++o){for(var m=y-o,_=f+o,E=a;E>=_;--E){var x=d[E-_];for(s=0;s<r;++s)p[h][E*r+s]=p[h][E*r+s]*x+p[h][(E-1)*r+s]*(1-x)}if(!g)for(s=0;s<r;++s)p[h+1][m*r+s]=p[h][a*r+s]}}if(g)break;for(++h,i=a-f;i<=a;++i)for(s=0;s<r;++s)p[h][i*r+s]=t[(c-a+i)*r+s];u=c,++c}return p};t.decomposeBCurveControlPoints=o,t.decomposeBCurveToBezier=function(e,t,r){var s,a=r&&r.length>0;n.ConsoleUtils.assert(t.length>0&&t.length%3==0),n.ConsoleUtils.assert(!a||t.length===3*r.length);var l,u,c=e.length-t.length/3-1;if(n.ConsoleUtils.assert(c>0),a){var h=(0,i.controlPointsToHomogeneous)(t,r);for(l=o(e,h,4),u=[],s=0;s<l.length;++s){var d=(0,i.controlPointsFromHomogeneous)(l[s]);l[s]=d.P,u[s]=d.w}}else l=o(e,t,3),u=void 0;var p=(0,i.getUniqueKnots)(e);n.ConsoleUtils.assert(p.length===l.length+1);var f=new Array(p.length-1);for(s=0;s<f.length;++s)f[s]=new Array(2*c+2),f[s].fill(p[s],0,c+1),f[s].fill(p[s+1],c+1);return{U:f,P:l,w:u}},t.decomposeBCurveFlags=function(e,t){var r,i=e.length-t.length-1,n=new Array(t.length);n.fill(!1);var o=i-1;for(r=0;r<t.length;++r)if(t[r]){var s=Math.max(r-o,0),a=Math.min(r+o,n.length-1);n.fill(!0,s,a+1)}var l=[],u=e.length-1,c=i+1,h=0;for(l[h]=!1,r=0;r<=i;++r)n[r]&&(l[h]=!0);for(;c<u;){for(var d=1;c<u&&e[c+1]===e[c];)++c,++d;if(c===u)break;for(l[++h]=!1,r=i-d;r<=i;++r)n[c-i+r]&&(l[h]=!0);++c}return l}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractBSurfaceParamLineV=t.extractBSurfaceParamLineU=t.insertBSurfaceKnotV=t.insertBSurfaceKnotU=void 0;var i=r(1),n=r(17),o=r(0),s=function(e,t,r,n,o,s,a){var l,u,c=new Array(n);for(u=0;u<n;++u){c[u]=new Array(o-u-r);var h=t-o+u+1;for(l=0;l<o-u-r;++l)c[u][l]=(e-s[h+l])/(s[l+t+1]-s[h+l])}for(var d=a.length,p=new Array(d),f=new Array(o-r+1),g=0;g<d;++g){for(p[g]=new Array(o-r+n-1),l=0;l<=o-r;++l)f[l]=i.Vector4.clone(a[g][l]);for(u=0;u<n;++u){for(l=0;l<o-u-r;++l)i.Vector4.lerp(f[l],f[l],f[l+1],c[u][l]);p[g][u]=i.Vector4.clone(f[0]),p[g][o+n-r-u-2]=i.Vector4.clone(f[o-u-r-1])}for(l=n;l<o-r-1;l++)p[g][l]=i.Vector4.clone(f[l-n+1])}return p};t.insertBSurfaceKnotU=function(e,t,r,a,l,u,c,h){t=Math.min(t,r);var d=h&&h.length>0,p=(0,n.findKnotSpanAndMultiplicity)(e,l);e=p.knot;var f=p.span,g=p.multiplicity,v=t-g;if(e<l[0]+o.PARAMETER_SPACE_TOLERANCE||e>l[l.length-1]-o.PARAMETER_SPACE_TOLERANCE||g>=t)return{uknots:l.slice(),P:c.slice(),weights:d?h.slice():void 0};var y,m,_=l.length-r-1,E=u.length-a-1,x=new Array(E),b=f-r,A=f-g;for(m=0;m<E;++m)for(x[m]=new Array(A-b+1),y=b;y<=A;++y){var C=y*E+m,T=d?h[C]:1;x[m][y-b]=i.Vector4.createFloat64FromValues(T*c[3*C],T*c[3*C+1],T*c[3*C+2],T)}var P=s(e,f,g,v,r,l,x),R=l.slice(0,f+1);for(y=0;y<v;++y)R.push(e);R=R.concat(l.slice(f+1));var S,V=new Array(3*(_+v)*E),w=new Array((_+v)*E);for(m=0;m<E;++m){for(y=0;y<=b;++y)C=S=y*E+m,V[3*S]=c[3*C],V[3*S+1]=c[3*C+1],V[3*S+2]=c[3*C+2],w[S]=h[C];for(y=0;y<P[m].length;++y){S=(y+b+1)*E+m;var M=P[m][y];V[3*S]=M[0]/M[3],V[3*S+1]=M[1]/M[3],V[3*S+2]=M[2]/M[3],w[S]=M[3]}for(y=A;y<_;++y)C=y*E+m,V[3*(S=(y+v)*E+m)]=c[3*C],V[3*S+1]=c[3*C+1],V[3*S+2]=c[3*C+2],w[S]=h[C]}return{uknots:R,P:V,weights:d?w:void 0}},t.insertBSurfaceKnotV=function(e,t,r,a,l,u,c,h){t=Math.min(t,a);var d=h&&h.length>0,p=(0,n.findKnotSpanAndMultiplicity)(e,u);e=p.knot;var f=p.span,g=p.multiplicity,v=t-g;if(e<u[0]+o.PARAMETER_SPACE_TOLERANCE||e>u[u.length-1]-o.PARAMETER_SPACE_TOLERANCE||g>=t)return{vknots:u.slice(),P:c.slice(),weights:d?h.slice():void 0};var y,m,_=l.length-r-1,E=u.length-a-1,x=new Array(_),b=f-a,A=f-g;for(y=0;y<_;++y)for(x[y]=new Array(A-b+1),m=b;m<=A;++m){var C=y*E+m,T=d?h[C]:1;x[y][m-b]=i.Vector4.createFloat64FromValues(T*c[3*C],T*c[3*C+1],T*c[3*C+2],T)}var P=s(e,f,g,v,a,u,x),R=u.slice(0,f+1);for(m=0;m<v;++m)R.push(e);R=R.concat(u.slice(f+1));var S,V=new Array(3*_*(E+v)),w=new Array(_*(E+v));for(y=0;y<_;++y){for(m=0;m<=b;++m)C=y*E+m,V[3*(S=y*(E+v)+m)]=c[3*C],V[3*S+1]=c[3*C+1],V[3*S+2]=c[3*C+2],w[S]=h[C];for(m=0;m<P[y].length;++m){S=y*(E+v)+(m+b+1);var M=P[y][m];V[3*S]=M[0]/M[3],V[3*S+1]=M[1]/M[3],V[3*S+2]=M[2]/M[3],w[S]=M[3]}for(m=A;m<E;++m)C=y*E+m,V[3*(S=y*(E+v)+(m+v))]=c[3*C],V[3*S+1]=c[3*C+1],V[3*S+2]=c[3*C+2],w[S]=h[C]}return{vknots:R,P:V,weights:d?w:void 0}},t.extractBSurfaceParamLineU=function(e,t,r,o,a,l,u){var c=u&&u.length>0,h=(0,n.findKnotSpanAndMultiplicity)(e,a);e=h.knot;var d,p,f,g=h.span,v=e===a[a.length-1],y=v?r+1:h.multiplicity,m=r-y,_=o.length-t-1,E=a.length-r-1,x=new Array(3*_),b=new Array(_);if(y>=r)for(p=v?E-1:g-r,d=0;d<_;++d)f=d*E+p,x[3*d]=l[3*f],x[3*d+1]=l[3*f+1],x[3*d+2]=l[3*f+2],b[d]=c?u[f]:1;else{var A=new Array(_),C=g-r,T=g-y;for(d=0;d<_;++d)for(A[d]=new Array(T-C+1),p=C;p<=T;++p){f=d*E+p;var P=c?u[f]:1;A[d][p-C]=i.Vector4.createFloat64FromValues(P*l[3*f],P*l[3*f+1],P*l[3*f+2],P)}var R=s(e,g,y,m,r,a,A);for(p=m-1,d=0;d<_;++d){var S=R[d][p];x[3*d]=S[0]/S[3],x[3*d+1]=S[1]/S[3],x[3*d+2]=S[2]/S[3],b[d]=S[3]}}return{ctrlPts:x,weights:c?b:void 0}},t.extractBSurfaceParamLineV=function(e,t,r,o,a,l,u){var c=u&&u.length>0,h=(0,n.findKnotSpanAndMultiplicity)(e,o);e=h.knot;var d,p,f,g=h.span,v=e===o[o.length-1],y=v?t+1:h.multiplicity,m=t-y,_=o.length-t-1,E=a.length-r-1,x=new Array(3*E),b=new Array(E);if(y>=t)for(d=v?_-1:g-t,p=0;p<E;++p)f=d*E+p,x[3*p]=l[3*f],x[3*p+1]=l[3*f+1],x[3*p+2]=l[3*f+2],b[p]=c?u[f]:1;else{var A=new Array(E),C=g-t,T=g-y;for(p=0;p<E;++p)for(A[p]=new Array(T-C+1),d=C;d<=T;++d){f=d*E+p;var P=c?u[f]:1;A[p][d-C]=i.Vector4.createFloat64FromValues(P*l[3*f],P*l[3*f+1],P*l[3*f+2],P)}var R=s(e,g,y,m,t,o,A);for(d=m-1,p=0;p<E;++p){var S=R[p][d];x[3*p]=S[0]/S[3],x[3*p+1]=S[1]/S[3],x[3*p+2]=S[2]/S[3],b[p]=S[3]}}return{ctrlPts:x,weights:c?b:void 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decomposeBSurfaceToBezier=t.decomposeBSurfaceControlPoints=t.decomposeBSurfaceControlPointsV=t.decomposeBSurfaceControlPointsU=void 0;var i=r(17),n=r(2),o=function(e,t,r,i){n.ConsoleUtils.assert(r.length%i==0);var o=t.length-e-1;n.ConsoleUtils.assert(r.length/i%o==0);var s,a,l,u,c=r.length/(i*o),h=e+1,d=c,p=t.length-1,f=e,g=e+1,v=0,y=[],m=[];for(m[v]=new Array(h*d*i),s=0;s<=e;++s)for(l=0;l<c;++l)for(u=0;u<i;++u)m[v][(s*d+l)*i+u]=r[(s*c+l)*i+u];for(;g<p;){for(var _=1;g<p&&t[g+1]===t[g];)++g,++_;var E=g===p;if(E||(m[v+1]=new Array(h*d*i)),_<e){var x=t[g]-t[f];for(a=e;a>_;--a)y[a-_-1]=x/(t[f+a]-t[f]);var b=e-_;for(a=1;a<=b;++a){for(var A=b-a,C=_+a,T=e;T>=C;--T){var P=y[T-C];for(l=0;l<c;++l)for(u=0;u<i;++u)m[v][(T*d+l)*i+u]=m[v][(T*d+l)*i+u]*P+m[v][((T-1)*d+l)*i+u]*(1-P)}if(!E)for(l=0;l<c;++l)for(u=0;u<i;++u)m[v+1][(A*d+l)*i+u]=m[v][(e*d+l)*i+u]}}if(E)break;for(++v,s=e-_;s<=e;++s)for(l=0;l<c;++l)for(u=0;u<i;++u)m[v][(s*d+l)*i+u]=r[((g-e+s)*c+l)*i+u];f=g,++g}return m},s=function(e,t,r,i){n.ConsoleUtils.assert(r.length%i==0);var o=t.length-e-1;n.ConsoleUtils.assert(r.length/i%o==0);var s,a,l,u,c=r.length/(i*o),h=c,d=e+1,p=t.length-1,f=e,g=e+1,v=0,y=[],m=[];for(m[v]=new Array(h*d*i),s=0;s<=e;++s)for(l=0;l<c;++l)for(u=0;u<i;++u)m[v][(s+l*d)*i+u]=r[(s+l*o)*i+u];for(;g<p;){for(var _=1;g<p&&t[g+1]===t[g];)++g,++_;var E=g===p;if(E||(m[v+1]=new Array(h*d*i)),_<e){var x=t[g]-t[f];for(a=e;a>_;--a)y[a-_-1]=x/(t[f+a]-t[f]);var b=e-_;for(a=1;a<=b;++a){for(var A=b-a,C=_+a,T=e;T>=C;--T){var P=y[T-C];for(l=0;l<c;++l)for(u=0;u<i;++u)m[v][(T+l*d)*i+u]=m[v][(T+l*d)*i+u]*P+m[v][(T-1+l*d)*i+u]*(1-P)}if(!E)for(l=0;l<c;++l)for(u=0;u<i;++u)m[v+1][(A+l*d)*i+u]=m[v][(e+l*d)*i+u]}}if(E)break;for(++v,s=e-_;s<=e;++s)for(l=0;l<c;++l)for(u=0;u<i;++u)m[v][(s+l*d)*i+u]=r[(g-e+s+l*o)*i+u];f=g,++g}return m},a=function(e,t,r,i,a,l){n.ConsoleUtils.assert(a.length%l==0),n.ConsoleUtils.assert(a.length/l==(r.length-e-1)*(i.length-t-1));var u,c=r.length>2*e+2,h=i.length>2*t+2;if(!c&&!h)return[[a.slice()]];u=c?o(e,r,a,l):[a];for(var d=0;d<u.length;++d)u[d]=h?s(t,i,u[d],l):[u[d]];return u};t.decomposeBSurfaceControlPointsU=o,t.decomposeBSurfaceControlPointsV=s,t.decomposeBSurfaceControlPoints=a,t.decomposeBSurfaceToBezier=function(e,t,r,o,s,l){var u,c,h,d,p=l&&l.length>0;if(n.ConsoleUtils.assert(s.length>0&&s.length%3==0),n.ConsoleUtils.assert(!p||s.length===3*l.length),p){var f=(0,i.controlPointsToHomogeneous)(s,l);for(h=a(e,t,r,o,f,4),d=[],u=0;u<h.length;++u)for(d[u]=[],c=0;c<h[u].length;++c){var g=(0,i.controlPointsFromHomogeneous)(h[u][c]);h[u][c]=g.P,d[u][c]=g.w}}else h=a(e,t,r,o,s,3),d=void 0;var v=(0,i.getUniqueKnots)(r);n.ConsoleUtils.assert(v.length===h.length+1);var y=new Array(v.length-1);for(u=0;u<y.length;++u)y[u]=new Array(2*e+2),y[u].fill(v[u],0,e+1),y[u].fill(v[u+1],e+1);var m=(0,i.getUniqueKnots)(o);n.ConsoleUtils.assert(m.length===h[0].length+1);var _=new Array(m.length-1);for(u=0;u<_.length;++u)_[u]=new Array(2*t+2),_[u].fill(m[u],0,t+1),_[u].fill(m[u+1],t+1);return{U:y,V:_,P:h,w:d}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closestBSurfacePointApprox=t.closestBSurfacePatches=void 0;var i=r(1),n=r(3),o=r(73),s=r(76);t.closestBSurfacePatches=function(e,t,r){for(var n=Number.POSITIVE_INFINITY,s=[],a=0;a<t.length;++a)for(var l=0;l<t[a].length;++l){var u,c=t[a][l],h=c.getRangeUnlimitedU(),d=c.getRangeUnlimitedV();if(r){u=!1;for(var p=0;p<r.length;++p)if(h[1]>=r[p][0][0]+i.FLOAT64_TOLERANCE&&h[0]<=r[p][0][1]-i.FLOAT64_TOLERANCE&&d[1]>=r[p][1][0]+i.FLOAT64_TOLERANCE&&d[0]<=r[p][1][1]-i.FLOAT64_TOLERANCE){u=!0;break}}else u=!0;if(u){var f=c.getControlPoints(),g=(0,o.minDistanceSqrToHull)(e,f,!0);if(g<=n){var v=(0,o.maxDistanceSqrToHull)(e,f);s.push({index:[a,l],minDistSqr:g,maxDistSqr:v}),v<n&&(n=v)}}}return(s=s.filter((function(e){return e.minDistSqr<=n}))).sort((function(e,t){var r=e.minDistSqr-t.minDistSqr;return 0===r?e.maxDistSqr-t.maxDistSqr:r})),s},t.closestBSurfacePointApprox=function(e,t,r,o,a,l,u,c,h){var d=t>1?2*t:1,p=r>1?2*r:1,f=(c[1]-c[0])/(o[o.length-1]-o[0]),g=(h[1]-h[0])/(a[a.length-1]-a[0]);d=Math.max(1,Math.round(d*f)),p=Math.max(1,Math.round(p*g));for(var v=(c[1]-c[0])/d,y=(h[1]-h[0])/p,m=Number.POSITIVE_INFINITY,_={u:void 0,v:void 0},E=void 0,x=i.Vector3.createFloat64(),b=0;b<=p;++b){for(var A=h[0]+b*y,C=[],T=0;T<=d;++T){var P,R,S=c[0]+T*v;C[T]=(0,s.evaluateBSurfacePoint)(S,A,t,r,o,a,l,u),T>0&&b>0&&(P=(0,n.closestPointToTriangle)(e,E[T-1],E[T],C[T-1],x),(R=i.Vector3.squaredDistance(e,x))<m&&(m=R,_.u=S+v*(P.coordA-1),_.v=A+y*(P.coordB-1)),P=(0,n.closestPointToTriangle)(e,C[T],C[T-1],E[T],x),(R=i.Vector3.squaredDistance(e,x))<m&&(m=R,_.u=S-v*P.coordA,_.v=A-y*P.coordB))}E=C}return _}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkValidity=void 0;var i=r(1),n=r(0),o=r(32),s=r(6),a=r(12),l=r(19);function u(e){var t=[],r=e.getGuid();return r&&"string"==typeof r||t.push({error:"BaseTopology has invalid GUID",source:[e]}),t}function c(e){var t=u(e),r=0,i=0,o=0,s=e.getLumps();if(s.length>0){for(var a=new Set,l=0;l<s.length;++l){var c=s[l];a.add(c),c&&c.getTopologyType()===n.TOPOLOGY_TYPES.LUMP?c.getBody()!==e&&t.push({error:"Body is not the parent of child Lump",source:[e,c]}):t.push({error:"Body has invalid element in Lump array",source:[e,c]}),r+=c.collectFaces().size,i+=c.collectEdges().size,o+=c.collectVertices().size}a.size!==s.length&&t.push({error:"Body has non-unique Lumps",source:[e]})}return r!==e.collectFaces().size&&t.push({error:"Body has Lumps which share Faces",source:[e]}),i!==e.collectEdges().size&&t.push({error:"Body has Lumps which share Edges",source:[e]}),o!==e.collectVertices().size&&t.push({error:"Body has Lumps which share Vertices",source:[e]}),t}function h(e){var t=u(e),r=e.getBody();r&&r.getTopologyType()!==n.TOPOLOGY_TYPES.BODY&&t.push({error:"Lump has invalid parent Body",source:[e]});var i=0,o=0,s=0,a=e.getShells();if(a.length>0){for(var l=new Set,c=0;c<a.length;++c){var h=a[c];l.add(h),h&&h.getTopologyType()===n.TOPOLOGY_TYPES.SHELL?h.getLump()!==e&&t.push({error:"Lump is not the parent of child Shell",source:[e,h]}):t.push({error:"Lump has invalid element in Shell array",source:[e,h]}),i+=h.collectFaces().size,o+=h.collectEdges().size,s+=h.collectVertices().size}l.size!==a.length&&t.push({error:"Lump has non-unique Shells",source:[e]})}else t.push({error:"Lump has no Shells",source:[e]});return i!==e.collectFaces().size&&t.push({error:"Lump has Shells which share Faces",source:[e]}),o!==e.collectEdges().size&&t.push({error:"Lump has Shells which share Edges",source:[e]}),s!==e.collectVertices().size&&t.push({error:"Lump has Shells which share Vertices",source:[e]}),t}function d(e){var t=u(e),r=e.getLump();r&&r.getTopologyType()!==n.TOPOLOGY_TYPES.LUMP&&t.push({error:"Shell has invalid parent Lump",source:[e]});var i=e.getFaces();if(i.length>0){for(var o=new Set,s=0;s<i.length;++s){var a=i[s];o.add(a),a&&a.getTopologyType()===n.TOPOLOGY_TYPES.FACE?a.getShell()!==e&&t.push({error:"Shell is not the parent of child Face",source:[e,a]}):t.push({error:"Shell has invalid element in Face array",source:[e,a]})}o.size!==i.length&&t.push({error:"Shell has non-unique Faces",source:[e]})}else t.push({error:"Shell has no Faces",source:[e]});1!==(0,l.findConnectedFaces)(e.getFaces()).length&&t.push({error:"Shell is disconnected",source:[e]});var c=e.collectVertices(),h=e.collectEdges(),d=new Set,p=new Set;return c.forEach((function(e){e.collectEdges(d),e.collectFaces(p)})),d.size!==h.size&&t.push({error:"Shell has rogue edges",source:[e]}),c.size>0&&p.size!==e.getFaces().length&&t.push({error:"Shell has rogue faces",source:[e]}),t}function p(e){var t=u(e),r=e.getShell();r&&r.getTopologyType()!==n.TOPOLOGY_TYPES.SHELL&&t.push({error:"Face has invalid parent Shell",source:[e]});var i=0,o=0,s=e.getLoops(),l=e.getSurface();if(s.length>0){for(var c=new Set,h=0;h<s.length;++h){var d=s[h];c.add(d),d&&d.getTopologyType()===n.TOPOLOGY_TYPES.LOOP?d.getFace()!==e&&t.push({error:"Face is not the parent of child Loop",source:[e,d]}):t.push({error:"Face has invalid element in Loop array",source:[e,d]}),i+=d.collectEdges().size,o+=d.collectVertices().size}c.size!==s.length&&t.push({error:"Face has non-unique Loops",source:[e]})}else{var p=l.getGeometryType()===n.GEOMETRY_TYPES.SPHERE,f=l.getGeometryType()===n.GEOMETRY_TYPES.TORUS&&l.isDoughnut();p||f||t.push({error:"Face has no Loops",source:[e]})}return i!==e.collectEdges().size&&t.push({error:"Face has Loops which share Edges",source:[e]}),o!==e.collectVertices().size&&t.push({error:"Face has Loops which share Vertices",source:[e]}),l?l instanceof a.Surface||t.push({error:"Face has invalid Surface geometry",source:[e,l]}):t.push({error:"Face has no Surface geometry",source:[e]}),t}function f(e){var t=u(e),r=e.getFace();r&&r.getTopologyType()!==n.TOPOLOGY_TYPES.FACE&&t.push({error:"Loop has invalid parent Face",source:[e]});var i=e.getCoedges();if(i.length>0){for(var o=new Set,s=0;s<i.length;++s){var a=i[s];if(o.add(a),a&&a.getTopologyType()===n.TOPOLOGY_TYPES.COEDGE){a.getLoop()!==e&&t.push({error:"Loop is not the parent of child Coedge",source:[e,a]});var l=i[(s+1)%i.length];a.getEndVertex()!==l.getStartVertex()&&t.push({error:"Loop has disconnected Coedges",source:[e,a,l]})}else t.push({error:"Loop has invalid element in Coedge array",source:[e,a]})}o.size!==i.length&&t.push({error:"Loop has non-unique Coedges",source:[e]})}else t.push({error:"Loop has no Coedges",source:[e]});return t}function g(e){var t=u(e),r=e.getLoop();r&&r.getTopologyType()!==n.TOPOLOGY_TYPES.LOOP&&t.push({error:"Coedge has invalid parent Loop",source:[e]});var i=e.getBody(),o=new Set,s=e;do{if(o.has(s)){t.push({error:"Coedge partner list does not form a loop",source:[e]});break}if(o.add(s),!s.getPartner()){s!==e&&t.push({error:"Coedge has no partner",source:[e,s]});break}if((s=s.getPartner()).getTopologyType()!==n.TOPOLOGY_TYPES.COEDGE){t.push({error:"Coedge has invalid entry in partner list",source:[e,s]});break}s.getEdge()!==e.getEdge()&&t.push({error:"Coedge partner refers to a different Edge",source:[e,s]}),s.getBody()!==i&&t.push({error:"Coedge partner is part of a different Body",source:[e,s]})}while(s!==e);var a=e.getEdge();return a?a.getTopologyType()!==n.TOPOLOGY_TYPES.EDGE?t.push({error:"Coedge has invalid Edge",source:[e,a]}):(s=a.getCoedge())&&o.has(s)||t.push({error:"Coedge partner list does not include parent of Edge",source:[e,a]}):t.push({error:"Coedge has no Edge",source:[e]}),t}function v(e){var t=u(e),r=e.getCoedge(),s=e.getWire();s&&r?t.push({error:"Edge has too many parents, both Wire and Coedge",source:[e]}):s?s.getTopologyType()!==n.TOPOLOGY_TYPES.WIRE&&t.push({error:"Edge has invalid parent Wire",source:[e]}):r&&r.getTopologyType()!==n.TOPOLOGY_TYPES.COEDGE&&t.push({error:"Edge has invalid parent Coedge",source:[e]});for(var a=e.getVertices(),l=0;l<a.length;++l){var c=a[l];c&&c.getTopologyType()===n.TOPOLOGY_TYPES.VERTEX?c.isAdjacentEdge(e)||t.push({error:"Edge is not adjacent to own Vertex",source:[e,c]}):t.push({error:"Edge has invalid Vertex",source:[e,c]})}var h=e.getCurve();return h?h instanceof o.Curve?t=t.concat(function(e,t){var r=[],o=e.isReversed(),s=e.getRange();if(void 0===s||2!==s.length||void 0===s[0]||void 0===s[1]||s[1]<s[0])return r.push({error:"Edge range is not defined",source:[e,s]}),r;var a=e.getStartVertex(),l=o?-e.t0():e.t0(),u=t.evaluatePosition(l),c=Math.max(n.KERNEL_TOLERANCE,a.getPrecision());i.Vector3.equals(a.getPosition(),u,c)||r.push({error:"Edge start position not consistent with Vertex",source:[e,a,u]});var h=e.getEndVertex(),d=o?-e.t1():e.t1(),p=t.evaluatePosition(d),f=Math.max(n.KERNEL_TOLERANCE,h.getPrecision());return i.Vector3.equals(h.getPosition(),p,f)||r.push({error:"Edge end position not consistent with Vertex",source:[e,h,p]}),e.isClosed()?(a!==h&&r.push({error:"Edge is closed but has different start and end Vertices",source:[e]}),i.Vector3.equals(u,p,n.KERNEL_TOLERANCE)||r.push({error:"Edge is closed but has different start and end positions",source:[e,u,p]}),t.isClosed()||r.push({error:"Edge is closed but its curve is not",source:[e]})):(a===h&&r.push({error:"Edge is open but has same start and end Vertices",source:[e]}),i.Vector3.equals(u,p,n.KERNEL_TOLERANCE)&&r.push({error:"Edge is open but has same start and end positions",source:[e,u,p]})),t.isPeriodic()?Math.abs(d-l)>t.getPeriod()+n.PARAMETER_SPACE_TOLERANCE&&r.push({error:"Edge parameter range is longer than curve period",source:[e]}):((l+n.PARAMETER_SPACE_TOLERANCE<t.getRange()[0]||l-n.PARAMETER_SPACE_TOLERANCE>t.getRange()[1])&&r.push({error:"Edge start parameter is outside of curve range",source:[e]}),(d+n.PARAMETER_SPACE_TOLERANCE<t.getRange()[0]||d-n.PARAMETER_SPACE_TOLERANCE>t.getRange()[1])&&r.push({error:"Edge end parameter is outside of curve range",source:[e]})),r}(e,h)):t.push({error:"Edge has invalid Curve geometry",source:[e,h]}):t=t.concat(function(e){if(e.getWire())return[{error:"Degenerate Edge is part of a Wire",source:[e]}];if(e.getStartVertex()!==e.getEndVertex())return[{error:"Degenerate Edge has different start and end vertices",source:[e]}];var t=Array.from(e.collectFaces());if(0===t.length)return[];if(1!==t.length)return[{error:"Degenerate Edge is part of multiple Faces",source:[e]}];var r=e.getStartVertex().getPosition(),o=t[0].getSurface(),s=o.getGeometryType();if(s===n.GEOMETRY_TYPES.PLANE||s===n.GEOMETRY_TYPES.CYLINDER||s===n.GEOMETRY_TYPES.ELLIPTICAL_CYLINDER||s===n.GEOMETRY_TYPES.SPHERE)return[{error:"Degenerate Edge is on a surface with no singularities",source:[e,o]}];if(s===n.GEOMETRY_TYPES.CONE||s===n.GEOMETRY_TYPES.ELLIPTICAL_CONE){if(!(c=o.getApexPosition()))return[{error:"Degenerate Edge is on a surface with no singularities",source:[e,o]}];if(!i.Vector3.equals(r,c,n.KERNEL_TOLERANCE))return[{error:"Degenerate Edge is not at a surface singularity",source:[e,o]}]}else{if(s!==n.GEOMETRY_TYPES.TORUS)return[{error:"Degenerate Edge is not on an analytic surface",source:[e]}];for(var a=!1,l=o.getSingularUParams(),u=0;u<l.length;++u){var c=o.evaluatePosition(l[u],0);i.Vector3.equals(r,c,n.KERNEL_TOLERANCE)&&(a=!0)}if(!a)return[{error:"Degenerate Edge is not at a surface singularity",source:[e,o]}]}return[]}(e)),t}function y(e){var t=u(e),r=e.getEdges();if(r.length>0)for(var i=e.getBody(),o=0;o<r.length;++o){var a=r[o];a&&a.getTopologyType()===n.TOPOLOGY_TYPES.EDGE?a.getStartVertex()!==e&&a.getEndVertex()!==e?t.push({error:"Vertex is not an end-point of adjacent Edge",source:[e,a]}):a.getBody()!==i&&t.push({error:"Vertex has adjacent Edge from a different body",source:[e,a]}):t.push({error:"Vertex has invalid entry in Edge list",source:[e,a]})}else t.push({error:"Vertex has no adjacent Edges",source:[e]});var l=e.getPoint();return l?l instanceof s.Point||t.push({error:"Vertex has invalid Point geometry",source:[e,l]}):t.push({error:"Vertex has no Point geometry",source:[e]}),t}function m(e){var t=u(e),r=0,i=0,o=e.getWires();if(o.length>0){for(var s=new Set,a=0;a<o.length;++a){var l=o[a];s.add(l),l&&l.getTopologyType()===n.TOPOLOGY_TYPES.WIRE?l.getWireBody()!==e&&t.push({error:"WireBody is not the parent of child Wire",source:[e,l]}):t.push({error:"WireBody has invalid element in Wire array",source:[e,l]}),r+=l.collectEdges().size,i+=l.collectVertices().size}s.size!==o.length&&t.push({error:"WireBody has non-unique Wires",source:[e]})}else t.push({error:"WireBody has no Wires",source:[e]});return r!==e.collectEdges().size&&t.push({error:"WireBody has Wires which share Edges",source:[e]}),i!==e.collectVertices().size&&t.push({error:"WireBody has Wires which share Vertices",source:[e]}),t}function _(e){var t=u(e),r=e.getWireBody();r&&r.getTopologyType()!==n.TOPOLOGY_TYPES.WIREBODY&&t.push({error:"Wire has invalid parent WireBody",source:[e]});var i=e.getEdges();if(i.length>0){for(var o=new Set,s=0;s<i.length;++s){var a=i[s];o.add(a),a&&a.getTopologyType()===n.TOPOLOGY_TYPES.EDGE?a.getWire()!==e&&t.push({error:"Wire is not the parent of child Edge",source:[e,a]}):t.push({error:"Wire has invalid element in Edge array",source:[e,a]})}o.size!==i.length&&t.push({error:"Wire has non-unique Edges",source:[e]});var c=(0,l.findConnectedEdges)(i);1!==c.length?t.push({error:"Wire is not a connected set of Edges",source:[e]}):c[0].length!==i.length&&t.push({error:"Wire is connected to other unknown Edges",source:[e]})}else t.push({error:"Wire has no Edges",source:[e]});return t}t.checkValidity=function(e){for(var t,r,i,o=[],s=[e],a=new Set,l=new Map;s.length>0;){a.clear();var u=new Set;for(t=0;t<s.length;++t){switch((r=s[t]).getTopologyType()){case n.TOPOLOGY_TYPES.BODY:o=o.concat(c(r)),r.getLumps().forEach((function(e){a.add(e)}));break;case n.TOPOLOGY_TYPES.LUMP:o=o.concat(h(r)),r.getShells().forEach((function(e){a.add(e)}));break;case n.TOPOLOGY_TYPES.SHELL:o=o.concat(d(r)),r.getFaces().forEach((function(e){a.add(e)}));break;case n.TOPOLOGY_TYPES.FACE:o=o.concat(p(r)),r.getLoops().forEach((function(e){a.add(e)})),r.getSurface()&&u.add(r.getSurface());break;case n.TOPOLOGY_TYPES.LOOP:o=o.concat(f(r)),r.getCoedges().forEach((function(e){a.add(e)}));break;case n.TOPOLOGY_TYPES.COEDGE:o=o.concat(g(r)),a.add(r.getEdge());break;case n.TOPOLOGY_TYPES.EDGE:o=o.concat(v(r)),r.getVertices().forEach((function(e){e&&a.add(e)})),r.getCurve()&&u.add(r.getCurve());break;case n.TOPOLOGY_TYPES.VERTEX:o=o.concat(y(r)),r.getPoint()&&u.add(r.getPoint());break;case n.TOPOLOGY_TYPES.WIREBODY:o=o.concat(m(r)),r.getWires().forEach((function(e){a.add(e)}));break;case n.TOPOLOGY_TYPES.WIRE:o=o.concat(_(r)),r.getEdges().forEach((function(e){a.add(e)}))}i=r.getGuid(),l.has(i)?o.push({error:"Objects have clashing GUIDs",source:[r,l.get(i)]}):l.set(i,r)}for(u=Array.from(u),t=0;t<u.length;++t)i=(r=u[t]).getGuid(),l.has(i)?o.push({error:"Objects have clashing GUIDs",source:[r,l.get(i)]}):l.set(i,r);s=Array.from(a)}return o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.facetPlanarFace=void 0;var i=r(1),n=r(0),o=r(108),s=r(3),a=r(109),l=function(e){return e&&e.__esModule?e:{default:e}}(r(42)),u=r(8),c=1e-8,h=n.KERNEL_TOLERANCE,d=function(e,t,r){var n,o=e[(0,s.modulus)(t-1,e.length)],a=e[(0,s.modulus)(t+1,e.length)],l=e[t],u=l[0]-o[0],c=l[1]-o[1],d=a[0]-l[0],p=a[1]-l[1],f=Math.sqrt(u*u+c*c),g=Math.sqrt(d*d+p*p);u*d+c*p<-.95*f*g?(u*=-1,c*=-1):r?(n=u,u=-c,c=n,n=d,d=-p,p=n):(n=u,u=c,c=-n,n=d,d=p,p=-n);var v=.5*(u/f+d/g),y=.5*(c/f+p/g),m=Math.sqrt(v*v+y*y);e[t]=i.Vector3.clone(l),e[t][0]+=h*v/m,e[t][1]+=h*y/m},p=function(e){return String(e[0])+String(e[1])},f=function(e){for(var t=!1,r={},i=0;i<e.length;i++){var n=p(e[i]);void 0===r[n]?r[n]=[]:t=!0,r[n].push(i)}return{table:r,foundSelfIntersection:t}},g=function(e){var t=f(e);if(t.foundSelfIntersection){for(var r=(0,o.isLoopCCW)(e),i=[],n=0;n<e.length-1;n++)i[n]=!1;var a=[];for(n=0;n<e.length-1;n++)if(!i[n]){var l=[],u=n;i[u]=!0,l.push(e[u]);var c=p(l[0]),h=e[(0,s.modulus)(u+1,e.length)],g=p(h),v=[];for(t.table[c].length>1&&v.push(0);g!==c;){if(l.push(h),l.length>e.length)throw new Error("splitHole failure");var y=t.table[g];if(1===y.length)u++;else{v.push(l.length-1);for(var m=[],_=0;_<y.length;_++)y[_]!==u&&m.push(y[_]);var E=Math.atan2(e[u+1][1]-e[u][1],e[u+1][0]-e[u][0]);E=(0,s.normalizeParameterToShiftedRange)(E-Math.PI,[-Math.PI,Math.PI]);var x=-1,b=0;for(_=0;_<m.length;_++){var A=Math.atan2(e[(0,s.modulus)(m[_]+1,e.length)][1]-e[m[_]][1],e[(0,s.modulus)(m[_]+1,e.length)][0]-e[m[_]][0]);A<E&&r?A+=s.PI2:A>E&&!r&&(A-=s.PI2);var C=Math.abs(A-E);C>b&&(b=C,x=m[_])}u=x}h=e[(0,s.modulus)(u+1,e.length)],g=p(h),i[u]=!0}for(_=0;_<v.length;_++)d(l,v[_],r);a.push(l)}return a}return[e]},v=function(e,t){for(var r=[],i=0;i<e.length;i++){r[i]={index:void 0,loop:void 0};for(var n=e[i],o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++)if(s[a][0]===n[0]&&s[a][1]===n[1]){r[i].index=a,r[i].loop=s;break}}return r};function y(e,t){var r,i=!1,n=t.length,o=n-1;for(r=0;r<n;r+=2)t[r][1]>e[1]!=t[o][1]>e[1]&&e[0]<(t[o][0]-t[r][0])*(e[1]-t[r][1])/(t[o][1]-t[r][1])+t[r][0]&&(i=!i),o=r;return i}function m(e,t,r){for(var n,s,a=v(e,[t].concat(r)),l=[],h=[],d=void 0,p=void 0,f=0;f<4;++f)a[f]&&void 0!==a[f].index&&(d?p||a[f].loop===d||(p=a[f].loop):d=a[f].loop,a[f].loop===d?(n=d,s=l):(n=p,s=h),(C=[a[f].index-1,a[f].index])[0]<0&&(C[0]=n.length-1),s.push(C),s.push([a[f].index,(a[f].index+1)%n.length]));p||(p=d,h=l);var g,m,_=void 0,E=d,x=l;for(f=0;f<3;++f){for(g=0;g<l.length;++g){for(m=0;m<h.length&&(l===h&&m>=g||!(_=(0,o.intersectSegments)(d[l[g][0]],d[l[g][1]],p[h[m][0]],p[h[m][1]],0))||!_.intersection);++m);if(_&&_.intersection)break}if(_&&_.intersection||d===p)break;0===f?(d=p,l=h):1===f&&(d=E,l=x,p=E,h=x)}if(void 0!==_&&_.intersection){var b=i.Vector3.subtract(i.Vector3.createFloat64(),d[l[g][1]],d[l[g][0]]);i.Vector3.scale(b,b,_.solutions[0]);var A=i.Vector3.add(b,b,d[l[g][0]]);if(l[g][0]>l[g][1]){var C=l[g][1];l[g][1]=l[g][0],l[g][0]=C}if(0===l[g][0]&&1!==l[g][1]&&(l[g][0]=l[g][1],l[g][1]=0),h[m][0]>h[m][1]&&0!==h[m][1]&&(C=h[m][1],h[m][1]=h[m][0],h[m][0]=C),0===h[m][0]&&1!==h[m][1]&&(h[m][0]=h[m][1],h[m][1]=0),d===p){if(d.length<4)return void console.error("REGION: Failed to fix loop tessellation! [loop too short]");console.log("REGION: Fixing self-intersection");var T=new Array(4);l[g][0]<h[m][0]?(T[0]=l[g][0],T[1]=l[g][1],T[2]=h[m][0],T[3]=h[m][1]):(T[0]=h[m][0],T[1]=h[m][1],T[2]=l[g][0],T[3]=l[g][1]);var P=[];for(f=0;f<=T[0];++f)P.push(d[f]);var R=i.Vector3.subtract(i.Vector3.createFloat64(),d[T[0]],d[T[1]]);i.Vector3.normalize(R,R),i.Vector3.scale(R,R,c);var S=i.Vector3.add(i.Vector3.createFloat64(),A,R);for(P.push(S),f=T[2];f>=T[1];--f)P.push(d[f]);var V=i.Vector3.subtract(i.Vector3.createFloat64(),A,R);if(P.push(V),T[3]>T[2])for(f=T[3];f<d.length;++f)P.push(d[f]);for(d.length=P.length,f=0;f<P.length;++f)d[f]=P[f]}else{console.log("REGION: Fixing loop-loop intersection");var w=d,M=p,L=h[m][0],O=h[m][1],k=l[g][0],I=l[g][1];(t===M||M.length>w.length&&t!==w)&&(w=p,M=d,L=l[g][0],O=l[g][1],k=h[m][0],I=h[m][1]);var F=1;t!==M&&t!==w&&(F=-1);var N=1;y(M[O],w)&&(N=-1,C=L,L=O,O=C),i.Vector3.subtract(M[O],M[L],M[O]),i.Vector3.normalize(M[O],M[O]),i.Vector3.scale(M[O],M[O],F*c),i.Vector3.add(M[O],A,M[O]);var D,B,z=O;do{(O+=N)<0?O=M.length-1:O%=M.length}while(O!==L&&!y(M[O],w));(L=O-N)<0&&(L=M.length-1),I=k;do{D=w[I],B=w[I=++I%w.length],_=(0,o.intersectSegments)(D,B,M[L],M[O],0)}while(k!==I&&!_.intersection);_.intersection&&(i.Vector3.scale(b,i.Vector3.subtract(b,B,D),_.solutions[0]),i.Vector3.add(A,b,D),i.Vector3.subtract(M[L],M[O],M[L]),i.Vector3.normalize(M[L],M[L]),i.Vector3.scale(M[L],M[L],F*c),i.Vector3.add(M[L],A,M[L])),Math.min(Math.abs(z-L),Math.abs(z-L-M.length))>1&&console.warn("REGION: Remove loop segment! FIXME!")}}else u.DebugUtils.warn("REGION: Failed to fix loop tessellation! [no intersected segments]")}var _=function(e,t){var r=e;for(r<0?r+=t.length:r%=t.length;t[r]!==r;)r=t[r];return r},E=function(e,t,r,n){return i.Vector3.distance(r[e],r[t])<1e-6?(n[0]=e,n[1]=e,1):0},x=function(e,t,r,n,o){var s=new Array(2);if(s[0]=n[e],s[1]=n[r],i.Vector3.length(i.Vector3.subtract(i.Vector3.createFloat64(),s[0],s[1]))<1e-6)return o[0]=e,o[1]=e,o[2]=e,2;var a=(s[0][0]-s[1][0])*(n[t][1]-s[1][1])-(s[0][1]-s[1][1])*(n[t][0]-s[1][0]);return a>-c*c&&a<c*c?(o[0]=e,o[1]=e,o[2]=r,1):0},b=function(e,t,r,i,n,s){return(0,o.intersectSegments)(n[e],n[t],n[r],n[i]).intersection?(s[0]=e,s[1]=t,s[2]=t,s[3]=i,1):(s[0]=-1,0)},A=function(e){if(e.length<4)return e;for(var t,r,i,n,o=e.length,s=new Int32Array(o),a=0;a<o;++a)s[a]=a;var l,u=new Array(3),c=new Array(3);for(c[0]=0,c[1]=0,c[2]=0,a=0;a<o;++a)t=_(a,s),r=_(a+1,s),(l=E(t,r,e,u))&&(++c[0],s[t]=u[0],s[r]=u[1],t=_(a+=l,s),r=_(a+1,s)),i=_(a+2,s),(l=x(t,r,i,e,u))&&(++c[1],s[t]=u[0],s[r]=u[1],s[i]=u[2],t=_(a+=l,s),r=_(a+1,s),i=_(a+2,s)),n=_(a+3,s),(l=b(t,r,i,n,e,u))&&(++c[2],s[t]=u[0],s[r]=u[1],s[i]=u[2],s[n]=u[3],a+=l);var h=[];for(a=0;a<e.length;++a)s[a]===a&&h.push(e[a]);return h},C=function(e,t,r){for(var i=v(e,[t].concat(r)),n=0;n<i.length;n++)d(i[n].loop,i[n].index,(0,o.isLoopCCW)(i[n].loop))},T=function(e,t){var r=!1;!function(e){var t=f(e);if(t.foundSelfIntersection)for(var r=(0,o.isLoopCCW)(e),i=l.default.keys(t.table),n=0;n<i.length;n++)if(t.table[i[n]].length>1)for(var s=t.table[i[n]],a=0;a<s.length;a++)d(e,s[a],r)}(e);for(var i=[],n=0;n<t.length;n++)i.push.apply(i,g(t[n]));var s=A(e),c=[];for(n=0;n<i.length;n++)c.push(A(i[n]));var h=8;do{r=!0;var p=(0,l.default)(s).map((function(e){return new a.poly2tri.Point(e[0],e[1])})),v=new a.poly2tri.SweepContext(p);for(n=0;n<c.length;n++){var y=(0,l.default)(c[n]).map((function(e){return new a.poly2tri.Point(e[0],e[1])}));v.addHole(y)}try{v.triangulate()}catch(e){if("poly2tri Intersecting Constraints"===e.message.substr(0,33))r=!1,m(e.points,s,c);else if("poly2tri EdgeEvent: Collinear not supported"===e.message.substr(0,43))r=!1,C(e.points,s,c);else{if(!e.points)throw e;r=!1,m(e.points,s,c)}}}while(!r&&h-- >0);return h<=0&&u.DebugUtils.warn("Computation of region tessellation failed, due to too many intersections."),v};t.facetPlanarFace=function(e,t){var r=e.getSurface(),n=(0,s.getPlaneTransforms)(r),a=new o.LoopCalculator(e,n.threeSpaceToUV).getRank0Loops();if(1!==a.length)throw new Error("Each region should have exactly one top-loop");var l=a[0],u=(0,o.tessellateLoop)(l._loop,t);if(n.threeSpaceToUV)for(var c=0;c<u.length;c++)i.Vector3.transformMatrix44(u[c],u[c],n.threeSpaceToUV);for(var h=[],d=l.getImmediatelyInsideLoops(),p=0;p<d.length;p++){var f=(0,o.tessellateLoop)(d[p]._loop,t);if(h.push(f),n.threeSpaceToUV)for(c=0;c<f.length;c++)i.Vector3.transformMatrix44(f[c],f[c],n.threeSpaceToUV)}var g=T(u,h),v=g.getTriangles(),y=new Uint32Array(3*v.length),m=new Float32Array(3*g.pointCount()),_=i.Vector3.createFloat64();for(c=0;c<g.pointCount();c++){var E=g.getPoint(c);i.Vector3.set(_,E.x,E.y,0),n.uvToThreeSpace&&i.Vector3.transformMatrix44(_,_,n.uvToThreeSpace),m[3*c]=_[0],m[3*c+1]=_[1],m[3*c+2]=_[2],E.index=c}for(c=0;c<v.length;c++){var x=v[c].getPoints();for(e.isReversed()&&x.reverse(),p=0;p<x.length;p++){var b=x[p];y[3*c+p]=b.index}}return{indexBuffer:y,vertexBuffer:m}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoopCalculator=t.intersectSegments=t.isLoopCCW=t.tessellateLoop=void 0;var i=r(1),n=r(0),o=r(3),s=function(e,t){this._loop=e,this._enclosureRank=0,this._isOuterLoop=!1,this._insideLoops=[],this._isOpen=!1,this._coedges=this._loop.getCoedges();for(var r=0;r<this._coedges.length;++r)this._coedges[r].generateUVCurve(t)};s.prototype.addInsideLoop=function(e){this._insideLoops.push(e)},s.prototype.uvAngleSubtended=function(e){if(!this.isClosedLoop())throw new Error("uvAngleSubtended cannot work with open loops");for(var t=0,r=0;r<this._coedges.length;r++)t+=this._coedges[r].uvAngleSubtended(e);return t},s.prototype.getArbitraryPointOnLoop=function(){if(1===this._coedges.length){var e=this._coedges[0].t0();return this._coedges[0].evaluatePosition(e)}var t=this._coedges[0].getStartVertex();if(t)return t.getPosition()},s.prototype.isInside=function(e){var t=this.getArbitraryPointOnLoop(),r=Math.abs(e.uvAngleSubtended(t)),i=Math.floor(r/(2*Math.PI)),o=r-2*i*Math.PI;return!!(Math.abs(o)<n.KERNEL_TOLERANCE&&i||Math.abs(o-2*Math.PI)<n.KERNEL_TOLERANCE)},s.prototype.getEnclosureRank=function(){return this._enclosureRank},s.prototype.resetEnclosureRank=function(){this._enclosureRank=0},s.prototype.decreaseEnclosureRank=function(){this._enclosureRank--},s.prototype.setIsOuterLoop=function(e){this._isOuterLoop=e},s.prototype.isOuterLoop=function(){return this._isOuterLoop},s.prototype.isClosedLoop=function(){return!this._isOpen},s.prototype.addInsideLoop=function(e){this._insideLoops.push(e)},s.prototype.getImmediatelyInsideLoops=function(){for(var e=[],t=0;t<this._insideLoops.length;t++)this._insideLoops[t].getEnclosureRank()===this._enclosureRank-1&&e.push(this._insideLoops[t]);return e};var a=function(e,t){this._face=e,this._loops=[];for(var r=0;r<this._face.getLoops().length;++r)this._loops.push(new s(this._face.getLoops()[r],t));this._calcSenses()};a.prototype._calcSenses=function(){for(var e=this._loops.length,t=0;t<e;t++)this._loops[t].resetEnclosureRank();for(t=0;t<e;t++)if(this._loops[t].isClosedLoop())for(var r=0;r<e;r++)this._loops[r].isClosedLoop()&&t!==r&&this._loops[t].isInside(this._loops[r])&&!this._loops[r].isInside(this._loops[t])&&(this._loops[t].decreaseEnclosureRank(),this._loops[r].addInsideLoop(this._loops[t]));for(t=0;t<e;t++){var i=0-this._loops[t].getEnclosureRank();this._loops[t].setIsOuterLoop(i%2==0)}},a.prototype.getRank0Loops=function(){var e=[];return this._loops.forEach((function(t){0===t.getEnclosureRank()&&e.push(t)})),e},t.tessellateLoop=function(e,t){for(var r=[],n=0,o=e.getCoedges().length;n<o;++n){var s=e.getCoedges()[n],a=s.getEdge(),l=a.tessellate(void 0,t).positions;l=l.slice(1,l.length-1),(l=[i.Vector3.clone(a.getStartVertex().getPosition())].concat(l)).push(i.Vector3.clone(a.getEndVertex().getPosition())),s.isReversed()&&l.reverse(),r=r.concat(l.slice(0,l.length-1))}return r},t.isLoopCCW=function(e){for(var t=0,r=0;r<e.length;r++){var i=(r+1)%e.length;t+=e[r][0]*e[i][1]-e[r][1]*e[i][0]}return t>0},t.intersectSegments=function(e,t,r,n,s){var a=[[t[0]-e[0],-(n[0]-r[0]),r[0]-e[0]],[t[1]-e[1],-(n[1]-r[1]),r[1]-e[1]]],l=(0,o.solveTwoEquationsTwoVariables)(a);if(void 0===l)return!1;var u=i.Vector3.distance(e,t),c=i.Vector3.distance(r,n);return{intersection:-s<l[0]*u&&(l[0]-1)*u<s&&-s<l[1]*c&&(l[1]-1)*c<s,solutions:l}},t.LoopCalculator=a},function(e,t,r){"use strict";var i,n;if(Object.defineProperty(t,"__esModule",{value:!0}),void 0===o)var o={},s={exports:{}};!function(a){"object"==_typeof(o)?s.exports=a():void 0===(n="function"==typeof(i=a)?i.call(t,r,t,e):i)||(e.exports=n)}((function(){return function e(t,r,i){function n(s,a){if(!r[s]){if(!t[s]){if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=r[s]={exports:{}};t[s][0].call(l.exports,(function(e){return n(t[s][1][e]||e)}),l,l.exports,e,t,r,i)}return r[s].exports}for(var o=!1,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(e,t,r){t.exports={version:"1.3.5"}},{}],2:[function(e,t,r){var i=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(e){this.head_=e},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(e){this.tail_=e},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(e){this.search_node_=e},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},i.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),i=r.point.x;if(t===i){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<i)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=i,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,r){t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,r){var i=e("./xy"),n=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};n.prototype.toString=function(){return i.toStringBase(this)},n.prototype.toJSON=function(){return{x:this.x,y:this.y}},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set_zero=function(){return this.x=0,this.y=0,this},n.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.mul=function(e){return this.x*=e,this.y*=e,this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},n.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},n.negate=function(e){return new n(-e.x,-e.y)},n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)},n.sub=function(e,t){return new n(e.x-t.x,e.y-t.y)},n.mul=function(e,t){return new n(e*t.x,e*t.y)},n.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new n(-e*t.y,e*t.x):"number"==typeof t?new n(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},n.toString=i.toString,n.compare=i.compare,n.cmp=i.compare,n.equals=i.equals,n.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=n},{"./xy":11}],5:[function(e,t,r){var i=e("./xy"),n=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+i.toString(t[r])};(n.prototype=new Error).constructor=n,t.exports=n},{"./xy":11}],6:[function(e,t,r){(function(t){var i=t.poly2tri;r.noConflict=function(){return t.poly2tri=i,r},r.VERSION=e("../dist/version.json").version,r.PointError=e("./pointerror"),r.Point=e("./point"),r.Triangle=e("./triangle"),r.SweepContext=e("./sweepcontext");var n=e("./sweep");r.triangulate=n.triangulate,r.sweep={Triangulate:n.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){var i=e("./assert"),n=e("./pointerror"),o=e("./triangle"),s=e("./advancingfront").Node,a=e("./utils"),l=a.EPSILON,u=a.Orientation,c=a.orient2d,h=a.inScanArea,d=a.isAngleObtuse;function p(e,t){var r=e.locateNode(t),n=function(e,t,r){var i=new o(t,r.point,r.next.point);i.markNeighbor(r.triangle),e.addToMap(i);var n=new s(t);return n.next=r.next,n.prev=r,r.next.prev=n,r.next=n,m(e,i)||e.mapTriangleToNodes(i),n}(e,t,r);return t.x<=r.point.x+l&&y(e,r),function(e,t){for(var r=t.next;r.next&&!d(r.point,r.next.point,r.prev.point);)y(e,r),r=r.next;for(r=t.prev;r.prev&&!d(r.point,r.next.point,r.prev.point);)y(e,r),r=r.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return i(r>=0,"unordered y"),t>=0||Math.abs(t)<r}(t)&&function(e,t){for(c(t.point,t.next.point,t.next.next.point)===u.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,r){if(!function(e,t){var r;return r=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>r}(t,r)&&(y(t,r),r.prev!==t.basin.left_node||r.next!==t.basin.right_node)){if(r.prev===t.basin.left_node){if(c(r.point,r.next.point,r.next.next.point)===u.CW)return;r=r.next}else if(r.next===t.basin.right_node){if(c(r.point,r.prev.point,r.prev.prev.point)===u.CCW)return;r=r.prev}else r=r.prev.point.y<r.next.point.y?r.prev:r.next;e(t,r)}}(e,e.basin.bottom_node))}}(e,t)}(e,n),n}function f(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,v(r.triangle,t.p,t.q)||(function(e,t,r){e.edge_event.right?function(e,t,r){for(;r.next.point.x<t.p.x;)c(t.q,r.next.point,t.p)===u.CCW?x(e,t,r):r=r.next}(e,t,r):function(e,t,r){for(;r.prev.point.x>t.p.x;)c(t.q,r.prev.point,t.p)===u.CW?A(e,t,r):r=r.prev}(e,t,r)}(e,t,r),g(e,t.p,t.q,r.triangle,t.q))}function g(e,t,r,i,o){if(!v(i,t,r)){var s=i.pointCCW(o),a=c(r,s,t);if(a===u.COLLINEAR)throw new n("poly2tri EdgeEvent: Collinear not supported!",[r,s,t]);var l=i.pointCW(o),h=c(r,l,t);if(h===u.COLLINEAR)throw new n("poly2tri EdgeEvent: Collinear not supported!",[r,l,t]);a===h?g(e,t,r,i=a===u.CW?i.neighborCCW(o):i.neighborCW(o),o):T(e,t,r,i,o)}}function v(e,t,r){var i=e.edgeIndex(t,r);if(-1!==i){e.markConstrainedEdgeByIndex(i);var n=e.getNeighbor(i);return n&&n.markConstrainedEdgeByPoints(t,r),!0}return!1}function y(e,t){var r=new o(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,m(e,r)||e.mapTriangleToNodes(r)}function m(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var i=t.getNeighbor(r);if(i){var n=t.getPoint(r),o=i.oppositePoint(t,n),s=i.index(o);if(i.constrained_edge[s]||i.delaunay_edge[s]){t.constrained_edge[r]=i.constrained_edge[s];continue}if(_(n,t.pointCCW(n),t.pointCW(n),o)){t.delaunay_edge[r]=!0,i.delaunay_edge[s]=!0,E(t,n,i,o);var a=!m(e,t);return a&&e.mapTriangleToNodes(t),(a=!m(e,i))&&e.mapTriangleToNodes(i),t.delaunay_edge[r]=!1,i.delaunay_edge[s]=!1,!0}}}return!1}function _(e,t,r,i){var n=e.x-i.x,o=e.y-i.y,s=t.x-i.x,a=t.y-i.y,l=n*a-s*o;if(l<=0)return!1;var u=r.x-i.x,c=r.y-i.y,h=u*o-n*c;return!(h<=0)&&(n*n+o*o)*(s*c-u*a)+(s*s+a*a)*h+(u*u+c*c)*l>0}function E(e,t,r,i){var n,o,s,a,l,u,c,h,d,p,f,g;n=e.neighborCCW(t),o=e.neighborCW(t),s=r.neighborCCW(i),a=r.neighborCW(i),l=e.getConstrainedEdgeCCW(t),u=e.getConstrainedEdgeCW(t),c=r.getConstrainedEdgeCCW(i),h=r.getConstrainedEdgeCW(i),d=e.getDelaunayEdgeCCW(t),p=e.getDelaunayEdgeCW(t),f=r.getDelaunayEdgeCCW(i),g=r.getDelaunayEdgeCW(i),e.legalize(t,i),r.legalize(i,t),r.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,p),e.setDelaunayEdgeCCW(i,f),r.setDelaunayEdgeCW(i,g),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,u),e.setConstrainedEdgeCCW(i,c),r.setConstrainedEdgeCW(i,h),e.clearNeighbors(),r.clearNeighbors(),n&&r.markNeighbor(n),o&&e.markNeighbor(o),s&&e.markNeighbor(s),a&&r.markNeighbor(a),e.markNeighbor(r)}function x(e,t,r){r.point.x<t.p.x&&(c(r.point,r.next.point,r.next.next.point)===u.CCW?b(e,t,r):(function e(t,r,i){c(i.next.point,i.next.next.point,i.next.next.next.point)===u.CCW?b(t,r,i.next):c(r.q,i.next.next.point,r.p)===u.CCW&&e(t,r,i.next)}(e,t,r),x(e,t,r)))}function b(e,t,r){y(e,r.next),r.next.point!==t.p&&c(t.q,r.next.point,t.p)===u.CCW&&c(r.point,r.next.point,r.next.next.point)===u.CCW&&b(e,t,r)}function A(e,t,r){r.point.x>t.p.x&&(c(r.point,r.prev.point,r.prev.prev.point)===u.CW?C(e,t,r):(function e(t,r,i){c(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===u.CW?C(t,r,i.prev):c(r.q,i.prev.prev.point,r.p)===u.CW&&e(t,r,i.prev)}(e,t,r),A(e,t,r)))}function C(e,t,r){y(e,r.prev),r.prev.point!==t.p&&c(t.q,r.prev.point,t.p)===u.CW&&c(r.point,r.prev.point,r.prev.prev.point)===u.CW&&C(e,t,r)}function T(e,t,r,o,s){var a=o.neighborAcross(s);i(a,"FLIP failed due to missing triangle!");var l=a.oppositePoint(o,s);if(o.getConstrainedEdgeAcross(s)){var d=o.index(s);throw new n("poly2tri Intersecting Constraints",[s,l,o.getPoint((d+1)%3),o.getPoint((d+2)%3)])}h(s,o.pointCCW(s),o.pointCW(s),l)?(E(o,s,a,l),e.mapTriangleToNodes(o),e.mapTriangleToNodes(a),s===r&&l===t?r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(o.markConstrainedEdgeByPoints(t,r),a.markConstrainedEdgeByPoints(t,r),m(e,o),m(e,a)):T(e,t,r,o=function(e,t,r,i,n,o){var s;return t===u.CCW?(s=i.edgeIndex(n,o),i.delaunay_edge[s]=!0,m(e,i),i.clearDelaunayEdges(),r):(s=r.edgeIndex(n,o),r.delaunay_edge[s]=!0,m(e,r),r.clearDelaunayEdges(),i)}(e,c(r,l,t),o,a,s,l),s)):(function e(t,r,n,o,s,a){var l=s.neighborAcross(a);i(l,"FLIP failed due to missing triangle");var u=l.oppositePoint(s,a);h(n,o.pointCCW(n),o.pointCW(n),u)?T(t,n,u,l,u):e(t,r,n,o,l,P(r,n,l,u))}(e,t,r,o,a,P(t,r,a,l)),g(e,t,r,o,s))}function P(e,t,r,i){var o=c(t,i,e);if(o===u.CW)return r.pointCCW(i);if(o===u.CCW)return r.pointCW(i);throw new n("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,i,e])}r.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var i=e.getPoint(t),n=p(e,i),o=i._p2t_edge_list,s=0;o&&s<o.length;++s)f(e,o[s],n)}(e),function(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){var i=e("./pointerror"),n=e("./point"),o=e("./triangle"),s=e("./sweep"),a=e("./advancingfront"),l=a.Node,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new i("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},c=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};c.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new c,this.edge_event=new function(){this.constrained_edge=null,this.right=!1},this.initEdges(this.points_)};h.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},h.prototype.AddHole=h.prototype.addHole,h.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},h.prototype.addPoint=function(e){return this.points_.push(e),this},h.prototype.AddPoint=h.prototype.addPoint,h.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},h.prototype.triangulate=function(){return s.triangulate(this),this},h.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},h.prototype.getTriangles=function(){return this.triangles_},h.prototype.GetTriangles=h.prototype.getTriangles,h.prototype.front=function(){return this.front_},h.prototype.pointCount=function(){return this.points_.length},h.prototype.head=function(){return this.head_},h.prototype.setHead=function(e){this.head_=e},h.prototype.tail=function(){return this.tail_},h.prototype.setTail=function(e){this.tail_=e},h.prototype.getMap=function(){return this.map_},h.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,i=this.points_[0].y,o=this.points_[0].y,s=this.points_.length;for(e=1;e<s;e++){var a=this.points_[e];a.x>t&&(t=a.x),a.x<r&&(r=a.x),a.y>i&&(i=a.y),a.y<o&&(o=a.y)}this.pmin_=new n(r,o),this.pmax_=new n(t,i);var l=.3*(t-r),u=.3*(i-o);this.head_=new n(t+l,o-u),this.tail_=new n(r-l,o-u),this.points_.sort(n.compare)},h.prototype.initEdges=function(e,t){var r,i=e.length,n=t?e.length-1:e.length;for(r=0;r<n;++r)this.edge_list.push(new u(e[r],e[(r+1)%i]))},h.prototype.getPoint=function(e){return this.points_[e]},h.prototype.addToMap=function(e){this.map_.push(e)},h.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},h.prototype.createAdvancingFront=function(){var e,t,r,i=new o(this.points_[0],this.tail_,this.head_);this.map_.push(i),e=new l(i.getPoint(1),i),t=new l(i.getPoint(0),i),r=new l(i.getPoint(2)),this.front_=new a(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t},h.prototype.removeNode=function(e){},h.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},h.prototype.removeFromMap=function(e){var t,r=this.map_,i=r.length;for(t=0;t<i;t++)if(r[t]===e){r.splice(t,1);break}},h.prototype.meshClean=function(e){for(var t,r,i=[e];t=i.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||i.push(t.getNeighbor(r))},t.exports=h},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){var i=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},n=e("./xy").toString;i.prototype.toString=function(){return"["+n(this.points_[0])+n(this.points_[1])+n(this.points_[2])+"]"},i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,r){var i=this.points_;if(e===i[2]&&t===i[1]||e===i[1]&&t===i[2])this.neighbors_[0]=r;else if(e===i[0]&&t===i[2]||e===i[2]&&t===i[0])this.neighbors_[1]=r;else{if(!(e===i[0]&&t===i[1]||e===i[1]&&t===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},i.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,r){var i=1e-16;r.EPSILON=i;var n={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=n,r.orient2d=function(e,t,r){var o=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x);return o>-i&&o<i?n.COLLINEAR:o>0?n.CCW:n.CW},r.inScanArea=function(e,t,r,n){return!((e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=-i||(e.x-r.x)*(n.y-r.y)-(n.x-r.x)*(e.y-r.y)<=i)},r.isAngleObtuse=function(e,t,r){var i=t.x-e.x,n=t.y-e.y;return i*(r.x-e.x)+n*(r.y-e.y)<0}},{}],11:[function(e,t,r){function i(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?i(e):t},toStringBase:i,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}));var a=s.exports;t.poly2tri=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCI=void 0;var i=r(1),n=r(111),o=r(77),s=function(e,t,r,i,o){this._cu1=e,this._range1=t,this._cu2=r,this._range2=i,this._epsilon=o,this._tree=new n.SubCurveTree(e,t,r,i,o)};s.prototype.intersect=function(){var e=[];this._tree.build();for(var t=0;t<this._tree._overlaps.length;++t){var r=this._tree._overlaps[t][0],i=this._tree._overlaps[t][1];e=e.concat(this._solve(r._range,i._range))}return this._merge(e),e},s.prototype._distanceSquared=function(e,t){var r=this._cu1.evaluatePosition(e),n=this._cu2.evaluatePosition(t);return i.Vector3.squaredDistance(r,n)},s.prototype._solve=function(e,t){var r=[],i=[.5*(e[0]+e[1]),.5*(t[0]+t[1])],n=this._relaxNR(i,[e,t]),s=n===o.RelaxResult.Success;if(n===o.RelaxResult.OutOfRange){var a=i[0]<e[0]+1e-12||i[0]>e[1]-1e-12,l=i[1]<t[0]+1e-12||i[1]>t[1]-1e-12;(a||l)&&this._distanceSquared(i[0],i[1])<this._epsilon*this._epsilon&&(s=!0)}return s&&r.push(new function(e,t){this.cutInfo=e,this.cutByInfo=t}({param:i[0],atVertex:void 0},{param:i[1],atVertex:void 0})),r},s.prototype._relaxNR=function(e,t){var r=this,n=(0,o.newtonRaphson2D)((function(e){var t=r._cu1.evaluatePosition(e[0]),n=r._cu2.evaluatePosition(e[1]),o=[t[0]-n[0],t[1]-n[1]],s=r._cu1.evaluateDt(e[0]),a=r._cu2.evaluateDt(e[1]);return i.Vector3.negate(a,a),{val:o,deriv1:s,deriv2:a}}),e,t);return e[0]=n.param[0],e[1]=n.param[1],n.status},s.prototype._merge=function(e){e.sort((function(e,t){return e.cutInfo.param-t.cutInfo.param}));for(var t=0;t<e.length;t++)if(e[t])for(var r=e[t].cutInfo.param,i=e[t].cutByInfo.param,n=t+1;n<e.length;n++)if(e[n]){var o=e[n].cutInfo.param,s=e[n].cutByInfo.param;if(o>r+1e-11)break;if(Math.abs(s-i)<=1e-11){e[t]=void 0;break}}for(t=0;t<e.length;t++)e[t]||(e.splice(t,1),t--)},t.CCI=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubCurveTree=void 0;var i=100*r(0).KERNEL_TOLERANCE,n=Math.PI/180*10,o=function(e,t,r){void 0===r&&(r=0),this._cu=e,this._range=t,this._bx=e.getBoundingBox(t).clone(),this._simple=void 0,this._split_param=void 0,this._children=[],this._depth=r};o.prototype.isSimple=function(){if(void 0===this._simple){this._simple=!1;var e=[this._range[0]+1e-8,this._range[1]-1e-8];if(this._split_param=this._cu.suggestSplittingParam(e),void 0===this._split_param){this._split_param=.5*(this._range[0]+this._range[1]);var t=this._cu.getTangentCone(this._range);(t.isDegenerate()||t.angle<n)&&(this._simple=!0)}}return this._simple},o.prototype.canDivide=function(){return!(this._depth>=10||this._range[1]-this._range[0]<2e-8||Math.max(this._bx.getWidth(0),this._bx.getWidth(1),this._bx.getWidth(2))<i)},o.prototype.divide=function(){if(0===this._children.length){var e=[this._range[0],this._split_param],t=[this._split_param,this._range[1]];this._children=[new o(this._cu,e,this._depth+1),new o(this._cu,t,this._depth+1)]}},o.prototype.fullSubdivision=function(){if(!this.isSimple()&&this.canDivide()){this.divide();for(var e=0;e<this._children.length;++e)this._children[e].fullSubdivision()}},o.prototype.toString=function(){if(this._children.length>0){for(var e="",t=0;t<this._children.length;++t)e+=this._children[t];return e}return"t=["+this._range[0]+" "+this._range[1]+"] "+this._bx+"\n"};var s=function(e,t,r,i,n){this._cu1_root_node=new o(e,t),this._cu2_root_node=new o(r,i),this._epsilon=n,this._overlaps=[]};s.prototype.process=function(e,t){if(e._bx.intersectsWithTolerance(t._bx,this._epsilon)){var r=e.canDivide(),i=t.canDivide(),n=e.isSimple()||!r,o=t.isSimple()||!i;if(n&&o)this._overlaps.push([e,t]);else if(r&&i){e.divide(),t.divide();for(var s=0;s<e._children.length;++s)for(var a=0;a<t._children.length;++a)this.process(e._children[s],t._children[a])}else if(r)for(e.divide(),s=0;s<e._children.length;++s)this.process(e._children[s],t);else if(i)for(t.divide(),s=0;s<t._children.length;++s)this.process(e,t._children[s])}},s.prototype.build=function(){this.process(this._cu1_root_node,this._cu2_root_node)},t.SubCurveTree=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegionTopologyFace=t.RegionTopologyEdge=t.RegionTopologyVertex=void 0;var i=r(1),n=r(16),o=r(20),s=r(15),a=r(0),l=r(2),u=function(e){return e&&e.__esModule?e:{default:e}}(r(42)),c=function(e){n.Vertex.call(this,e),this._associatedVertices=[]};(c.prototype=Object.create(n.Vertex.prototype)).setAssociatedEntities=function(e){this._associatedVertices=u.default.clone(e)},c.prototype.getAssociatedEntities=function(){return this._associatedVertices};var h=function(e){o.Edge.call(this,e),this._sourceEdge=void 0,this._associatedEdges=[],this._isDangling=!1};(h.prototype=Object.create(o.Edge.prototype)).setAssociatedEdges=function(e){this._associatedEdges=e},h.prototype.getAssociatedEntities=function(){return u.default.map(this._associatedEdges,(function(e){return e.edge}))},h.prototype.getAssociatedEdgeInfo=function(){return this._associatedEdges},h.prototype.setToEdgeSegment=function(e,t){this._sourceEdge=e,this._curve=e.getCurve(),this._reversed=e.isReversed(),this.setRange(t)},h.prototype.setIsDangling=function(e){this._isDangling=e},h.prototype.isDangling=function(){return this._isDangling},h.prototype.getSourceEdge=function(){return this._sourceEdge};var d=function(e){s.Face.call(this,e),this._danglingEdges=[]};(d.prototype=Object.create(s.Face.prototype)).addDanglingEdge=function(e){this._danglingEdges.push(e)},d.prototype.isPointInsideFace=function(e){for(var t=0,r=0;r<this.getLoops().length;++r)for(var i=this.getLoops()[r],n=0;n<i.getCoedges().length;++n){var o=i.getCoedges()[n];o.getEdge().isDangling()||(t+=o.uvAngleSubtended(e))}t=Math.abs(t);var s=Math.floor(t/(2*Math.PI)),l=t-2*s*Math.PI;return!!(Math.abs(l)<a.PARAMETER_SPACE_TOLERANCE&&s||Math.abs(l-2*Math.PI)<a.PARAMETER_SPACE_TOLERANCE)},d.prototype.getRepresentativePoint=function(){var e,t,r=i.Vector3.createFloat64(),n=this.getBoundingBox(),o=(n.max[0]-n.min[0])/33,s=(n.max[1]-n.min[1])/33;for(e=1;e<32;++e)for(t=1;t<32;++t)if(r[0]=n.min[0]+o*e,r[1]=n.min[1]+s*t,this.isPointInsideFace(r))return r;return l.ConsoleUtils.assert(!1),n.getCenter()},d.prototype.getDanglingEdges=function(){return this._danglingEdges},t.RegionTopologyVertex=c,t.RegionTopologyEdge=h,t.RegionTopologyFace=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.matchRegionEdgeRecipe=t.deserializeRegionEdgeRecipe=t.serializeRegionEdgeRecipe=t.createRecipeFromRegionEdge=t.matchRegionFaceRecipe=t.deserializeRegionFaceRecipe=t.serializeRegionFaceRecipe=t.createRecipeFromRegionFace=void 0;var i=r(1),n=r(3),o=r(0),s=r(114),a=r(2),l=r(8),u=function(e){return e&&e.__esModule?e:{default:e}}(r(42)),c=function(e,t){var r=u.default.filter(t.regionVertices,(function(t){return u.default.contains(t.getAssociatedEntities(),e.getStartVertex())}));a.ConsoleUtils.assert(1===r.length),r=r[0];var i=[],n=[],o=new Set,s=r,l=void 0;if(s)do{i.push(s);var c=u.default.filter(s.getEdges(),(function(t){return t!==l&&u.default.contains(t.getAssociatedEntities(),e)&&!o.has(t)}));if(0===c.length){a.ConsoleUtils.assert(!e.isClosed()),a.ConsoleUtils.assert(u.default.contains(s.getAssociatedEntities(),e.getEndVertex()));break}var h=void 0;if(c.length>1){c.sort((function(e,t){return e.t0()-t.t0()}));for(var d=0;d<c.length;d++)if(c[d].getStartVertex()===s){h=c[d];break}a.ConsoleUtils.assert(h)}else h=c[0];s=h.getOtherVertex(s),a.ConsoleUtils.assert(s),l=h,o.add(l),n.push(l)}while(s!==r);return{edges:n,vertices:i}},h=function(e,t,r){var n=[],s=u.default.filter(t,(function(t){return t!==e}));if(0===s.length);else for(var a=r.vertices,l=0;l<a.length;l++){for(var c=a[l],h=!1,d=c.getEdges(),p=0;p<d.length;p++)if(u.default.intersection(s,d[p].getAssociatedEntities()).length>0){h=!0;break}h&&n.push({vertex:c,indexInTopology:l})}if(e.isClosed()&&2===n.length&&1===s.length){var f=!1;if(s[0].getCurveType()===o.GEOMETRY_TYPES.LINE){var g=s[0],v=g.closestToPointParam(n[0].vertex.getPosition());f=g.closestToPointParam(n[1].vertex.getPosition())<v}else if(e.getCurveType()===o.GEOMETRY_TYPES.CIRCLE&&s[0].getCurveType()===o.GEOMETRY_TYPES.CIRCLE){var y=e.getCurve().getCenter(),m=i.Vector3.sub([0,0,0],s[0].getCurve().getCenter(),y);if(i.Vector3.length(m)>0){i.Vector3.normalize(m,m);var _=i.Vector3.sub([0,0,0],n[0].vertex.getPosition(),y),E=i.Vector3.sub([0,0,0],n[1].vertex.getPosition(),y),x=_.x*m.y-_.y*m.x,b=E.x*m.y-E.y*m.x;x>0&&b<0&&(f=!0)}}if(f){var A=n[1];n[1]=n[0],n[0]=A}}return n},d=function(e,t,r,i,n){var o,a={};a[e.getGuid()]={dist:0,prev:null,prevEdge:null,vertex:e,guid:e.getGuid()};var l=new s.BinaryHeap((function(e){return e.dist}),(function(e){return e.guid}));for(l.push(a[e.getGuid()]);0!==l.size();){var c=l.pop();if(c===t)break;o=c.vertex.getEdges();for(var h=0;h<o.length;h++){var d=o[h].getOtherVertex(c.vertex);if(d&&!i[o[h].getGuid()]&&(!r[d.getGuid()]||d===t)){for(var p=o[h].getEndVertex()===d,f=!1,g=o[h].getAssociatedEntities(),v=0;v<n.length;v++)if(u.default.contains(g,n[v].edge)&&n[v].orientation===p){f=!0;break}var y=a[c.guid].dist;f||(y+=1),void 0===a[d.getGuid()]?(a[d.getGuid()]={dist:y,prev:c,prevEdge:o[h],vertex:d,guid:d.getGuid()},l.push(a[d.getGuid()])):a[d.getGuid()].dist>y&&(a[d.getGuid()].dist=y,a[d.getGuid()].prev=c,a[d.getGuid()].prevEdge=o[h],l.updated(a[d.getGuid()]))}}}var m=a[t.getGuid()];if(m){o=[];for(var _=[],E=m,x=t;E.prevEdge;){var b=E.prevEdge;o.push(b),E=E.prev,_.push(b.getEndVertex()===x),x=b.getOtherVertex(x)}return{dist:m.dist,edges:o.reverse(),orientations:_.reverse(),startVertex:e,endVertex:t}}return{dist:1/0,edges:[]}},p=function(e,t,r,i,o,s,a){for(var l=e[o],c={},h=0;h<l.length;h++)null!==l[h].endVertex&&(c[l[h].endVertex.getGuid()]?c[l[h].endVertex.getGuid()].incomingEdges.push({edge:l[h].edge,orientation:l[h].edgeOriented}):c[l[h].endVertex.getGuid()]={edgeIndex:h,edgeInfo:l[h],vertex:l[h].endVertex,incomingEdges:[{edge:l[h].edge,orientation:l[h].edgeOriented}]});if(u.default.values(c).length>0){var p=s.vertices,f=s.edges,g=u.default.keys(c),v={dist:1/0},y=i;do{y=(0,n.modulus)(y-1,e.length);for(var m=u.default.keys(a[y]),_=0;_<m.length;_++){var E=a[y][m[_]].vertex;if(E)for(var x=0;x<g.length;x++){var b=c[g[x]].vertex,A=a[y][m[_]].outgoingEdges.concat(c[g[x]].incomingEdges),C=d(E,b,p,f,A);C.dist<v.dist&&((v=C).startIndex=y)}}}while(y!==t&&v.dist===1/0);if(v.dist<1/0){var T=a[v.startIndex][v.startVertex.getGuid()],P=a[o][v.endVertex.getGuid()],R=T.cost+v.dist;(!P||R<P.cost||o===t&&v.endVertex.getGuid()===r.getGuid()&&null===P.previousGuid)&&(a[o][v.endVertex.getGuid()]={previousGuid:v.startVertex.getGuid(),edgeSegment:null,indexRange:[],cost:T.cost+v.dist,vertex:v.endVertex,previousIndex:v.startIndex,connectionEdges:v.edges,connectionOrientation:v.orientations,outgoingEdges:[]})}}},f=function(e,t,r,i,o){var s=[],a=e[t][r].endVertex;s[t]={},s[t][a.getGuid()]={previousGuid:null,edgeSegment:null,previousIndex:null,cost:0,vertex:a,outgoingEdges:[]};var l=t;do{var c=(0,n.modulus)(l+1,e.length),h=e[c];s[c]=s[c]||{};for(var d=u.default.keys(s[l]),f=0,g=0;g<d.length;g++)for(var v=d[g],y=0;y<h.length;y++)if(h[y].startVertices[v]){s[l][v].outgoingEdges.push({edge:h[y].edge,orientation:h[y].edgeOriented});var m=h[y].endVertex;if(null!==m){var _=s[l][v].cost;h[y].edge.isClosed()||h[y].endVertexTopologyIndex>h[y].startVertices[v].vertexIndex!==h[y].edgeOriented&&(_+=1),(!s[c][m.getGuid()]||s[c][m.getGuid()].cost>_||c===t&&m.getGuid()===a.getGuid()&&null===s[c][m.getGuid()].previousGuid)&&(s[c][m.getGuid()]={previousGuid:v,edgeSegment:h[y],indexRange:[h[y].startVertices[v].vertexIndex,h[y].endVertexTopologyIndex],cost:_,vertex:m,previousIndex:l,outgoingEdges:[]},f++)}else _=s[l][v].cost,(!s[c][v]||s[c][v].cost>_)&&(s[c][v]={previousGuid:v,edgeSegment:h[y],indexRange:[],cost:_,previousIndex:l,outgoingEdges:[]})}0===f&&p(e,t,a,l,c,i,s),l=c}while(l!==t);null!==s[t][a.getGuid()].previousGuid&&s[t][a.getGuid()].cost<o.cost&&(o.cost=s[t][a.getGuid()].cost,o.state=s,o.startGuid=a.getGuid())},g=function(e,t){for(var r=function(e,t){var r={},i={},o={},s=t;do{var a=(0,n.modulus)(s+1,e.length),l=e[s],u=e[a],c=o;o={};for(var h=0;h<u.length;h++){var d=u[h].topologyAlongEdge.vertices,p=u[h].topologyAlongEdge.edges;u[h].startVertices={};var f=void 0,g=void 0,v=l.length;void 0!==c[u[h].edge.getGuid()]&&v++;for(var y=0;y<v;y++){var m=void 0;if(y===l.length)m=c[u[h].edge.getGuid()];else{if(!l[y].endVertex)continue;m=l[y].endVertex.getGuid()}for(var _=void 0,E=0;E<d.length;E++)if(d[E].getGuid()===m){_=E;break}void 0!==_&&(u[h].startVertices[m]={vertex:d[_],vertexIndex:_},null!==u[h].endVertex&&(u[h].edgeOriented?(f=void 0!==f?Math.min(f,_):_,g=void 0!==g?Math.max(g,u[h].endVertexTopologyIndex):u[h].endVertexTopologyIndex):(f=void 0!==f?Math.max(f,_):_,g=void 0!==g?Math.min(g,u[h].endVertexTopologyIndex):u[h].endVertexTopologyIndex)),void 0===o[u[h].edge.getGuid()]&&(o[u[h].edge.getGuid()]=m))}if(void 0!==f&&void 0!==g){if(f!==g){var x;x=u[h].edge.isClosed()?u[h].edgeOriented?1:-1:f<g?1:-1;var b=f;do{if(r[d[b].getGuid()]=d[b],x>0)b!==g&&(i[p[b].getGuid()]=p[b]);else{var A=(0,n.modulus)(b-1,p.length);i[p[A].getGuid()]=p[A]}b=(0,n.modulus)(b+x,d.length)}while(b!==g)}r[d[g].getGuid()]=d[g]}}s=a}while(s!==t);return{vertices:r,edges:i}}(e,t),i={cost:1/0,state:void 0,startGuid:void 0},o=0;o<e[t].length;o++)null!==e[t][o].endVertex&&f(e,t,o,r,i);if(i.cost===1/0)return{edges:void 0,edgeOrientedFlags:void 0,score:1/0};var s=function(e,t){var r=[],i=e.startGuid,o=t;do{r.push(e.state[o][i]);var s=e.state[o][i].previousIndex;i=e.state[o][i].previousGuid,o=s}while(o!==t);r=r.reverse();var a=[],l=[];for(o=0;o<r.length;o++)if(0!==r[o].indexRange.length){var u,c,h,d,p=r[o].edgeSegment.topologyAlongEdge;r[o].indexRange[0]<r[o].indexRange[1]?(u=r[o].indexRange[0],c=r[o].indexRange[1],r[o].edgeSegment.edge.isClosed()&&!r[o].edgeSegment.edgeOriented?(h=-1,u=(0,n.modulus)(r[o].indexRange[0]-1,p.edges.length),c=(0,n.modulus)(r[o].indexRange[1]-1,p.edges.length),d=!1):(h=1,u=(0,n.modulus)(r[o].indexRange[0],p.edges.length),c=(0,n.modulus)(r[o].indexRange[1],p.edges.length),d=!0)):r[o].edgeSegment.edge.isClosed()&&r[o].edgeSegment.edgeOriented?(h=1,u=(0,n.modulus)(r[o].indexRange[0],p.edges.length),c=(0,n.modulus)(r[o].indexRange[1],p.edges.length),d=!0):(h=-1,u=(0,n.modulus)(r[o].indexRange[0]-1,p.edges.length),c=(0,n.modulus)(r[o].indexRange[1]-1,p.edges.length),d=!1);var f=u;do{a.push(p.edges[f]),l.push(d),f=(0,n.modulus)(f+h,p.edges.length)}while(f!==c)}else if(r[o].connectionEdges)for(f=0;f<r[o].connectionEdges.length;f++)a.push(r[o].connectionEdges[f]),l.push(r[o].connectionOrientation[f]);return{topologyEdges:a,edgeOrientedFlags:l}}(i,t);return{edges:s.topologyEdges,edgeOrientedFlags:s.edgeOrientedFlags,score:i.cost}},v=function(e,t){var r,i=function(e,t){for(var r=[],i=0;i<e.length;i++){for(var n=e[i],o=[],s=0;s<n.length;s++){var a=n[s],l=t.sketchEdges[a.edgeRef];l&&o.push({edgeRef:a.edgeRef,edgeOriented:a.edgeOriented,intersectionNumber:a.intersectionNumber,totalIntersections:a.totalIntersections,edge:l,topologyAlongEdge:c(l,t),endVertex:null,endVertexTopologyIndex:null})}r.push(o)}return r}(e,t);if(l.DebugUtils.level("region_match")>=2){var n=u.default.pluck(u.default.flatten(i),"edge");for(r=0;r<n.length;r++)l.DebugUtils.drawEdge3D(n[r],{color:0,render:!1});l.DebugUtils.render()}if(function(e){for(var t=0;t<e.length;t++)for(var r=u.default.pluck(e[(t+1)%e.length],"edge"),i=0;i<e[t].length;i++){var n=e[t][i],o=h(n.edge,r,n.topologyAlongEdge);if(0===n.totalIntersections)n.endVertex=null;else if(o.length===n.totalIntersections){var s=o[n.intersectionNumber];n.endVertexTopologyIndex=s.indexInTopology,n.endVertex=s.vertex}else 0===o.length||l.DebugUtils.warn("Region matching problem! Intersection counts do not match"),n.endVertex=null}}(i),l.DebugUtils.level("region_match")>=2){var o=u.default.pluck(u.default.flatten(i),"endVertex");for(r=0;r<o.length;r++)null!==o[r]&&l.DebugUtils.drawVertex3D(o[r],{color:65280,render:!1});l.DebugUtils.render()}var s=function(e){for(var t=1/0,r=void 0,i=0;i<e.length;i++){var n=e[i];if(0!==n.length){for(var o=0,s=0;s<n.length;s++)null!==n[s].endVertex&&o++;var a=n.length-o;if(0===a)return i;o>0&&a<t&&(t=a,r=i)}}return r}(i);if(void 0===s){for(var a=0;a<i[0].length;a++){var d=i[0][a].edge;if(d.isClosed()&&u.default.all(i,(function(e){for(var t=0;t<e.length;t++)if(e[t].edge===d)return!0;return!1}))){var p=i[0][a].topologyAlongEdge.edges,f=new Array(p.length);for(r=0;r<f.length;r++)f[r]=i[0][a].edgeOriented;return i[0][a].edgeOriented||p.reverse(),l.DebugUtils.level("region_match")>=2&&l.DebugUtils.drawEdge3D(d,{color:16711680}),{edges:p,edgeOrientedFlags:f,matchStatus:2}}}return{edges:void 0,edgeOrientedFlags:void 0,matchStatus:0}}var v,y=g(i,s);if(l.DebugUtils.level("region_match")>=2&&void 0!==y.edges){for(r=0;r<y.edges.length;r++)l.DebugUtils.drawEdge3D(y.edges[r],{color:16711680,render:!1});l.DebugUtils.render()}return v=0===y.score?2:y.score===1/0?0:1,{edges:y.edges,edgeOrientedFlags:y.edgeOrientedFlags,matchStatus:v}},y=function(e,t){if(!e||!e.edges)return new Set;for(var r=new Set,i=0;i<e.edges.length;i++){var n=e.edgeOrientedFlags[i]===t,o=e.edges[i].getCoedges();a.ConsoleUtils.assert(o.length>=1&&o.length<=2);for(var s=void 0,l=0;l<o.length;l++)if(o[l].isReversed()===n){s=o[l].getFace();break}s&&!r.has(s)&&r.add(s)}var u=new Set(e.edges);return r.forEach((function(e){for(var t=Array.from(e.collectEdges()),i=0;i<t.length;i++){var n=t[i];if(!u.has(n)){var o=void 0,s=n.getFaces();a.ConsoleUtils.assert(s.length>=1&&s.length<=2),1===s.length?a.ConsoleUtils.assert(s[0]===e):2===s.length&&(a.ConsoleUtils.assert(s[0]===e||s[1]===e),o=s[0]===e?s[1]:s[0]),o&&!r.has(o)&&r.add(o)}}})),r};t.createRecipeFromRegionFace=function(e,t){for(var r=[],i=e.getLoops(),n=0;n<i.length;n++){for(var o=i[n].getCoedges(),s=[],a=0;a<o.length;a++){for(var l=o[a],d=l.getEdge().getAssociatedEdgeInfo(),p=l.getEndVertex(),f=o[(a+1)%o.length].getEdge().getAssociatedEdgeInfo(),g=u.default.pluck(f,"edge"),v=[],y=0;y<d.length;y++){for(var m=c(d[y].edge,t),_=h(d[y].edge,g,m),E=0,x=0;x<_.length;x++)if(_[x].vertex===p){E=x;break}var b={edgeRef:d[y].edge.getGuid(),edgeOriented:!(l.isReversed()^d[y].flipped),intersectionNumber:E,totalIntersections:_.length,edge:d[y].edge};v.push(b)}s.push(v)}r.push(s)}return r},t.serializeRegionFaceRecipe=function(e){for(var t=[],r=0;r<e.length;r++){for(var i=[],n=e[r],o=0;o<n.length;o++){for(var s=[],a=n[o],l=0;l<a.length;l++){var u=a[l];s.push(u.edgeRef+"_"+(u.edgeOriented?"t":"f")+"_"+u.intersectionNumber+"_"+u.totalIntersections)}i.push(s.join(";"))}t.push(i.join("+"))}return t.join("/")},t.deserializeRegionFaceRecipe=function(e){for(var t=e.split("/"),r=0;r<t.length;r++){t[r]=t[r].split("+");for(var i=t[r],n=0;n<i.length;n++){i[n]=i[n].split(";");for(var o=i[n],s=0;s<o.length;s++){var a=o[s].split("_");o[s]={edgeRef:a[0],edgeOriented:"t"===a[1],intersectionNumber:parseInt(a[2],10),totalIntersections:parseInt(a[3],10)}}}}return t},t.matchRegionFaceRecipe=function(e,t){var r,i,n,o=2,s=[];for(r=0;r<e.length;r++){var a=v(e[r],t);if(0===a.matchStatus&&0===r)return{regions:[],matchStatus:0};2!==a.matchStatus&&(o=1),s.push(a)}if(l.DebugUtils.level("region_match")>0){for(l.DebugUtils.clearView(),n=u.default.values(t.sketchEdges),r=0;r<n.length;r++)l.DebugUtils.drawEdge3D(n[r],{color:0,render:!1});for(r=0;r<s.length;r++)for(i=0;i<s[r].edges.length;i++){var c=0===r?65280:16711680;l.DebugUtils.drawEdge3D(s[r].edges[i],{color:c,render:!1})}l.DebugUtils.render()}var h=y(s[0],!1);for(i=1;i<s.length;i++)y(s[i],!0).forEach((function(e){h.delete(e)}));if(h=Array.from(h),l.DebugUtils.level("region_match")>0){for(r=0;r<h.length;r++)for(n=Array.from(h[r].collectEdges()),i=0;i<n.length;i++)l.DebugUtils.drawEdge3D(n[i],{color:13684736,render:!1});l.DebugUtils.render()}return{regions:h,matchStatus:o}},t.createRecipeFromRegionEdge=function(e,t){var r,i,n={startEdgeRefs:[],endEdgeRefs:[],edgeRef:[],edgeOriented:[],intersectionNumberStart:[],totalIntersectionsStart:[],intersectionNumberEnd:[],totalIntersectionsEnd:[]},o=e.getStartVertex(),s=[];o.getOtherEdges(e).forEach((function(e){var t=u.default.pluck(e.getAssociatedEdgeInfo(),"edge");for(r=0;r<t.length;r++)s.indexOf(t[r])<0&&(s.push(t[r]),n.startEdgeRefs.push(t[r].getGuid()))}));var a=e.getEndVertex(),l=[];a.getOtherEdges(e).forEach((function(e){var t=u.default.pluck(e.getAssociatedEdgeInfo(),"edge");for(r=0;r<t.length;r++)l.indexOf(t[r])<0&&(l.push(t[r]),n.endEdgeRefs.push(t[r].getGuid()))}));var d=e.getAssociatedEdgeInfo(),p=u.default.pluck(d,"edge");for(r=0;r<d.length;r++){var f=p[r],g=!d[r].flipped,v=c(f,t),y=u.default.unique(s.concat(p)),m=h(f,y,v),_=0;for(i=0;i<m.length;i++)if(m[i].vertex===o){_=i;break}var E=u.default.unique(l.concat(p)),x=h(f,E,v),b=0;for(i=0;i<x.length;i++)if(x[i].vertex===a){b=i;break}n.edgeRef.push(f.getGuid()),n.edgeOriented.push(g),n.intersectionNumberStart.push(_),n.totalIntersectionsStart.push(m.length),n.intersectionNumberEnd.push(b),n.totalIntersectionsEnd.push(x.length)}return n},t.serializeRegionEdgeRecipe=function(e){var t={edge:e.edgeRef,orient:e.edgeOriented,start:e.startEdgeRefs,end:e.endEdgeRefs,sIdx:e.intersectionNumberStart,sNum:e.totalIntersectionsStart,eIdx:e.intersectionNumberEnd,eNum:e.totalIntersectionsEnd};return JSON.stringify(t)},t.deserializeRegionEdgeRecipe=function(e){var t=JSON.parse(e);return{edgeRef:t.edge,edgeOriented:t.orient,startEdgeRefs:t.start,endEdgeRefs:t.end,intersectionNumberStart:t.sIdx,totalIntersectionsStart:t.sNum,intersectionNumberEnd:t.eIdx,totalIntersectionsEnd:t.eNum}},t.matchRegionEdgeRecipe=function(e,t){var r=[],i=0,n=[];e.startEdgeRefs.forEach((function(e){var r=t.sketchEdges[e];r&&n.push(r)}));var o=[];e.endEdgeRefs.forEach((function(e){var r=t.sketchEdges[e];r&&o.push(r)})),e.edgeRef.forEach((function(e){var r=t.sketchEdges[e];r&&n.indexOf(r)<0&&n.push(r),r&&o.indexOf(r)<0&&o.push(r)}));for(var s=0;s<e.edgeRef.length;s++){var a=t.sketchEdges[e.edgeRef[s]];if(a){var u=c(a,t),d=void 0,p=void 0,f=h(a,n,u);if(0===e.totalIntersectionsStart[s])d=u.vertices[0],p=0;else if(f.length===e.totalIntersectionsStart[s]){var g=f[e.intersectionNumberStart[s]];d=g.vertex,p=g.indexInTopology}var v=void 0,y=void 0,m=h(a,o,u);if(0===e.totalIntersectionsEnd[s])v=u.vertices[0],y=u.vertices.length;else if(m.length===e.totalIntersectionsEnd[s]){var _=m[e.intersectionNumberEnd[s]];v=_.vertex,0===(y=_.indexInTopology)&&a.isClosed()&&(y=u.vertices.length)}if(!e.edgeOriented[s]){var E=d;d=v,v=E,E=p,p=y,y=E}if(d&&v){if(!(p>=y)){r=u.edges.slice(p,y),i=2;break}l.DebugUtils.warn("Edge recipe match should find start vertex before end vertex")}}}return{edges:r,matchStatus:i}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){this.content=[],this.scoreFunction=e,this.lookupFunction=t,this.lookupFunction&&(this.nodeDict={})};i.prototype={push:function(e){this.content.push(e),this.lookupFunction&&(this.nodeDict[this.lookupFunction(e)]=this.content.length-1),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.lookupFunction&&(this.nodeDict[this.lookupFunction(t)]=0),this.sinkDown(0)),this.lookupFunction&&delete this.nodeDict[this.lookupFunction(e)],e},peek:function(){return this.content[0]},getNodeIndex:function(e){if(this.lookupFunction)return this.nodeDict[this.lookupFunction(e)];for(var t=this.content.length,r=0;r<t;r++)if(this.content[r]===e)return r;throw new Error("Node not found.")},updated:function(e){var t=this.getNodeIndex(e),r=this.scoreFunction(e),i=Math.floor((t+1)/2)-1,n=this.content[i];if(t>0&&r<this.scoreFunction(n))this.bubbleUp(t);else{var o=2*(t+1),s=o-1,a=this.content[s],l=this.content[o];(a&&r>this.scoreFunction(a)||l&&r>this.scoreFunction(l))&&this.sinkDown(t)}},remove:function(e){var t=this.content.length,r=this.getNodeIndex(e),i=this.content.pop();r!==t-1&&(this.content[r]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r))},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var r=Math.floor((e+1)/2)-1,i=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[r]=t,this.content[e]=i,this.lookupFunction&&(this.nodeDict[this.lookupFunction(t)]=r,this.nodeDict[this.lookupFunction(i)]=e),e=r}},sinkDown:function(e){for(var t=this.content.length,r=this.content[e],i=this.scoreFunction(r);;){var n=2*(e+1),o=n-1,s=null;if(o<t){var a=this.content[o],l=this.scoreFunction(a);l<i&&(s=o)}if(n<t){var u=this.content[n];this.scoreFunction(u)<(null===s?i:l)&&(s=n)}if(null===s)break;this.content[e]=this.content[s],this.content[s]=r,this.lookupFunction&&(this.nodeDict[this.lookupFunction(this.content[e])]=e,this.nodeDict[this.lookupFunction(this.content[s])]=s),e=s}}},t.BinaryHeap=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBlock=void 0;var i=r(28),n=r(83),o=r(0),s=r(2);t.createBlock=function(e,t){var r=[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.min(e[2],t[2])],a=[Math.max(e[0],t[0]),Math.max(e[1],t[1]),Math.max(e[2],t[2])];s.ConsoleUtils.assert(a[0]-r[0]>o.KERNEL_TOLERANCE,"block is degenerate in x axis"),s.ConsoleUtils.assert(a[1]-r[1]>o.KERNEL_TOLERANCE,"block is degenerate in y axis"),s.ConsoleUtils.assert(a[2]-r[2]>o.KERNEL_TOLERANCE,"block is degenerate in z axis");var l=[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]]],u=(0,i.createFaceFromPolyline)(l),c=a[2]-r[2];return(0,n.extrudeFace)(u,c)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCylinder=t.createCone=void 0;var i=r(1),n=r(28),o=r(0),s=r(18),a=r(51),l=r(38),u=r(39),c=r(52),h=r(13),d=r(15),p=r(26),f=r(25),g=r(24),v=r(2),y=function(e,t,r,y,m,_){var E=e,x=t,b=Math.abs(r),A=void 0===_typeof(y)?b:Math.abs(y);if(b<o.KERNEL_TOLERANCE){E=t,x=e;var C=b;b=A,A=C}v.ConsoleUtils.assert(b>o.KERNEL_TOLERANCE);var T=i.Vector3.createFloat64();i.Vector3.subtract(T,x,E);var P=i.Vector3.length(T);v.ConsoleUtils.assert(P>o.KERNEL_TOLERANCE),i.Vector3.scale(T,T,1/P);var R=A-b,S=Math.abs(R)>o.KERNEL_TOLERANCE,V=0;S&&(V=Math.atan2(R,P));var w,M=i.Vector3.createFloat64();_&&i.Vector3.subtract(M,_,i.Vector3.scale(M,T,i.Vector3.dot(_,T))),(!_||i.Vector3.squaredLength(M)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE)&&i.Vector3.computeOrthogonal(M,T),i.Vector3.normalize(M,M),i.Vector3.scale(M,M,b);var L=m||1;v.ConsoleUtils.assert(L>0&&L<=1);var O=Math.max(b,A);Math.abs(O*(1-L))<o.KERNEL_TOLERANCE?S?(w=new a.Cone).set(E,b,T,V,M,1):(w=new l.Cylinder).set(E,b,T,M,1):S?(w=new c.EllipticalCone).set(E,M,L,T,V,1):(w=new u.EllipticalCylinder).set(E,M,L,T,1);var k=[0,P/Math.cos(V)];w.limitRangeU(k);var I=(0,n.makeConeOrCylinderVParamLoop)(w,k[0]),F=(0,n.makeConeOrCylinderVParamLoop)(w,k[1]);I.getCoedges()[0].setReversed(!0);var N=[];N[0]=new d.Face,N[0].setSurface(w),N[0].addLoops([I,F]);var D=I.getCoedges()[0].getEdge();if(D.getCurve()){var B=new h.Loop;B.addCoedge((0,n.createCoedgeOnEdge)(D)),(U=new d.Face).addLoop(B);var z=new s.Plane;z.set(E,T),U.setSurface(z),U.setReversed(!0),N.push(U),v.ConsoleUtils.assert(B.getCoedges()[0].uvAngleSubtended(E)<-o.KERNEL_TOLERANCE)}var j=F.getCoedges()[0].getEdge();if(j.getCurve()){var U,G=new h.Loop;G.addCoedge((0,n.createCoedgeOnEdge)(j)),(U=new d.Face).addLoop(G);var Y=new s.Plane;Y.set(x,T),U.setSurface(Y),N.push(U),v.ConsoleUtils.assert(G.getCoedges()[0].uvAngleSubtended(x)<-o.KERNEL_TOLERANCE)}var K=new p.Shell;K.addFaces(N);var H=new f.Lump;H.addShell(K);var q=new g.Body;return q.addLump(H),q};t.createCone=y,t.createCylinder=function(e,t,r,i,n){return y(e,t,r,r,i,n)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPolyhedron=void 0;var i=r(24),n=r(25),o=r(15),s=r(13),a=r(16),l=r(18),u=r(6),c=r(28),h=r(3),d=r(2),p=r(8);function f(e,t){var r,i=e.getCommonEdges(t);d.ConsoleUtils.assert(i.length<=1),r=0===i.length?(0,c.createLineEdgeBetweenVertices)(e,t):i[0];var n=(0,c.createCoedgeOnEdge)(r);return d.ConsoleUtils.assert(n.getStartVertex()===e),d.ConsoleUtils.assert(n.getEndVertex()===t),n}function g(e,t){var r,i=[];for(r=0;r<t.length;++r)i[r]=e[t[r]];var n=(0,h.definePlaneThroughPoints)(i);if(n){var o=new l.Plane;return o.set(n.origin,n.normal,n.uAxis),o.limitRangeU(n.uRange),o.limitRangeV(n.vRange),o}p.DebugUtils.warn("Face is degenerate")}t.createPolyhedron=function(e,t){var r,l=[];for(r=0;r<e.length;++r){var h=new a.Vertex(new u.Point(e[r]));l.push(h)}var p=[];for(r=0;r<t.length;++r){var v=t[r];d.ConsoleUtils.assert(v.length>=3);for(var y=new s.Loop,m=[],_=0;_<v.length;++_){var E=v[_],x=v[(_+1)%v.length];d.ConsoleUtils.assert(E>=0&&E<e.length),d.ConsoleUtils.assert(x>=0&&x<e.length);var b=f(l[E],l[x]);m.push(b)}y.addCoedges(m);var A=g(e,v),C=new o.Face(A);C.addLoop(y),p.push(C)}var T=(0,c.createShellsFromFaces)(p),P=[];for(r=0;r<T.length;++r)P[r]=new n.Lump,P[r].addShell(T[r]);var R=new i.Body;return R.addLumps(P),R}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TopologyStitcher=void 0;var i=r(1),n=r(119),o=r(41),s=r(2),a=function(){this._shellSet=new Set,this._lumpSet=new Set,this._bodySet=new Set,this._wireSet=new Set,this._progenitorMap=new o.ProgenitorMap};a.prototype.initMerge=function(){this._shellSet.clear(),this._lumpSet.clear(),this._bodySet.clear(),this._wireSet.clear()},a.prototype.getEdgeOwnerToMerge=function(e){var t=e.getWire();if(t)this._wireSet.add(t);else{var r=function(e){var t=e.getCoedge();if(t){var r=t.getFace();if(r)return r.getShell()}}(e);r&&this._shellSet.add(r)}},a.prototype.getVertexOwnerToMerge=function(e){var t=e.getEdges();t.length>0&&this.getEdgeOwnerToMerge(t[0])},a.prototype.stitchVertices=function(e,t){var r;this.initMerge();var i=void 0;for(r=0;r<e.length;++r)if(!t||!t.has(e[r])){i=e[r];break}s.ConsoleUtils.assert(i);var n=[];for(r=0;r<e.length;++r)if(this.getVertexOwnerToMerge(e[r]),e[r]!==i){for(var o=e[r],a=o.getEdges().slice(0),l=0;l<a.length;++l){var u=a[l];u.getStartVertex()===o&&u.setStartVertex(i),u.getEndVertex()===o&&u.setEndVertex(i)}s.ConsoleUtils.assert(0===o.getEdges().length),t&&t.has(o)||n.push(o)}n.length>0&&this._progenitorMap.addEntry(i,n),this.mergeTopology()},a.prototype.stitchEdges=function(e,t){var r,n=e[0];for(r=0;r<e.length;++r)if(!t||!t.has(e[r])){n=e[r];break}var o=[],s=[];for(r=0;r<e.length;++r){var a=e[r],l=!1;if(a.getStartVertex()!==n.getStartVertex()&&a.getStartVertex()===n.getEndVertex()){var u=a.evaluateDt(a.t0()),c=n.evaluateDt(n.t1());i.Vector3.dot(u,c)<0&&(l=!0)}for(var h=a.getCoedge();h;)o.push(h),l&&h.setReversed(!h.isReversed()),(h=h.getPartner())===a.getCoedge()&&(h=void 0);a!==n&&(a.setStartVertex(null),a.setEndVertex(null),s.push(a))}for(this.initMerge(),r=0;r<o.length;++r){var d=o[r];this.getEdgeOwnerToMerge(d.getEdge()),d.setEdge(n);var p=(r+1)%o.length;d.setPartner(o[p])}this.mergeTopology(),this._progenitorMap.addEntry(n,s)},a.prototype.mergeTopology=function(){if(this._shellSet.size>1&&this.mergeShells(),this._wireSet.size>1)throw new Error("Merging wires in TopologyStitcher is not yet supported.")},a.prototype.mergeShells=function(){var e=new o.ProgenitorMap;if(this._shellSet.size>1){var t=Array.from(this._shellSet),r=t[0],i=r.getLump();i&&this._lumpSet.add(i);for(var n=1;n<t.length;++n){var s=t[n];r.addFaces(s.getFaces()),s.setFaces([]),(i=s.getLump())&&(i.removeShell(s),this._lumpSet.add(i))}e.addEntry(r,t.slice(1))}if(this._lumpSet.size>1){var a=Array.from(this._lumpSet),l=a[0],u=l.getBody();for(u&&this._bodySet.add(u),n=1;n<a.length;++n){var c=a[n];l.addShells(c.getShells()),c.setShells([]),(u=c.getBody())&&(u.removeLump(c),this._bodySet.add(u))}e.addEntry(l,a.slice(1))}if(this._bodySet.size>1){var h=Array.from(this._bodySet),d=h[0];for(n=1;n<h.length;++n){for(var p=h[n],f=p.getLumps().slice(0),g=0;g<f.length;++g)f[g].getShells().length>0&&d.addLump(f[g]);p.setLumps([])}e.addEntry(d,h.slice(1))}e.size()>0&&(this._progenitorMap=e.collapseMaps(this._progenitorMap,{keepIntermediates:!0,keepAllDescendants:!0}))},a.prototype.getProgenitorMap=function(){return this._progenitorMap},a.prototype.stitchTwoEdgeSets=function(e,t){var r=new n.MatchFinder;r.setEdges(e,t),r.compute();for(var i=r.getVertexMatches(),o=r.getEdgeMatches(),s=r.getNewVertices(),a=new Set(r.getEdgeProgenitors().getAllNewTopology()),l=0;l<i.length;++l)this.stitchVertices(i[l],s);for(l=0;l<o.length;++l)this.stitchEdges(o[l],a);this._progenitorMap=this._progenitorMap.collapseMaps(r.getEdgeProgenitors(),{keepIntermediates:!1,keepAllDescendants:!0})},a.prototype.stitchTwoTopology=function(e,t){s.ConsoleUtils.assert("function"==typeof e.collectEdges),s.ConsoleUtils.assert("function"==typeof t.collectEdges);var r=e.collectEdges(),i=t.collectEdges();this.stitchTwoEdgeSets(r,i)},a.prototype.stitchEdgeSet=function(e){this.stitchTwoEdgeSets(e,e)},t.TopologyStitcher=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MatchFinder=void 0;var i=r(1),n=r(0),o=r(120),s=r(82),a=r(41),l=r(2),u=function(){this._edges1=[],this._edges2=[],this._verts1=[],this._verts2=[],this._vertexMatchMap=new Map,this._edgeMatchMap=new Map,this._sameEdgeLists=!1,this._newVertices=new Set,this._edgeProgenitors=new a.ProgenitorMap};u.prototype.addMergeToMap=function(e,t,r){var i=r.get(e),n=r.get(t);if(i&&!n)i.push(t),r.set(t,i);else if(!i&&n)n.push(e),r.set(e,n);else if(i||n){if(i&&n&&i!==n)for(var o=0;o<n.length;++o)i.push(n[o]),r.set(n[o],i)}else{var s=[e,t];r.set(e,s),r.set(t,s)}},u.prototype.addVertexMerge=function(e,t){this.addMergeToMap(e,t,this._vertexMatchMap)},u.prototype.addEdgeMerge=function(e,t){this.addMergeToMap(e,t,this._edgeMatchMap)},u.prototype.verticesMatch=function(e,t){var r=Math.max(e.getPrecision(),t.getPrecision(),n.KERNEL_TOLERANCE);return i.Vector3.squaredDistance(e.getPosition(),t.getPosition())<r*r},u.prototype.findEdgeSplitParam=function(e,t){var r=e.getStartVertex();if(r!==t){var o=e.getEndVertex();if(o!==t){var s=this._vertexMatchMap.get(r);if(!s||-1===s.indexOf(t)){var a=this._vertexMatchMap.get(o);if(!a||-1===a.indexOf(t)){var l=t.getPosition(),u=Math.max(t.getPrecision(),n.KERNEL_TOLERANCE),c=e.closestToPointParam(l);if(void 0!==c){var h=e.evaluatePosition(c);if(!(i.Vector3.squaredDistance(l,h)>u*u))return{param:c,position:h}}}}}}},u.prototype.matchVertices=function(){for(var e=new Set,t=0;t<this._edges1.length;++t)this._edges1[t].collectVertices(e);this._verts1=Array.from(e);var r=new Set;for(t=0;t<this._edges2.length;++t)this._edges2[t].collectVertices(r);this._verts2=Array.from(r);var i=this;e.forEach((function(e){r.forEach((function(t){e!==t&&i.verticesMatch(e,t)&&i.addVertexMerge(e,t)}))}))},u.prototype.findVertexOnEdgeSplits=function(e,t){for(var r=t.length,i=0;i<r;++i){for(var n=t[i],o=[],s=0;s<e.length;++s){var a=e[s],l=this.findEdgeSplitParam(n,a);l&&o.push({vertex:a,param:l.param,position:l.position})}if(o.length>0){var u=this.splitEdgeAtParams(n,o);if(u.length>0){t[i]=u[0];for(var c=1;c<u.length;++c)t.push(u[c])}}}},u.prototype.doEdgeSplits=function(){this.findVertexOnEdgeSplits(this._verts1,this._edges2),this._sameEdgeLists||this.findVertexOnEdgeSplits(this._verts2,this._edges1)},u.prototype.splitEdgeAtParams=function(e,t){t.sort((function(e,t){return e.param-t.param}));for(var r=[],s=e,a=0;a<t.length;++a){var l=t[a].vertex,u=t[a].param,c=t[a].position,h=s.getStartVertex().getPosition();if(i.Vector3.squaredDistance(c,h)<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE)this.addVertexMerge(l,s.getStartVertex());else{0===r.length&&(s=(0,o.replaceEdge)(s),r.push(s),this._edgeProgenitors.addEntry(s,[e]));var d=(0,o.splitEdge)(s,u,c);r.push(d),this._edgeProgenitors.addEntry(d,[e]);var p=d.getStartVertex();this.addVertexMerge(l,p),this._newVertices.add(p),s=d}}return r},u.prototype.edgesMatch=function(e,t){return(0,s.edgesAreCoincident)(e,t)},u.prototype.matchEdges=function(){for(var e=0;e<this._edges1.length;++e)for(var t=this._edges1[e],r=t.getStartVertex(),i=t.getEndVertex(),n=0;n<this._edges2.length;++n){var o=this._edges2[n],s=o.getStartVertex(),a=o.getEndVertex();if(!(this._sameEdgeLists&&n<=e)&&t!==o){var l,u=r===s||r===a;if(!u){var c=this._vertexMatchMap.get(r);c&&(u=c===this._vertexMatchMap.get(s)||c===this._vertexMatchMap.get(a))}if(u&&!(l=i===s||i===a)){var h=this._vertexMatchMap.get(i);h&&(l=h===this._vertexMatchMap.get(s)||h===this._vertexMatchMap.get(a))}u&&l&&this.edgesMatch(t,o)&&this.addEdgeMerge(t,o)}}},u.prototype.setEdges=function(e,t){e instanceof Set?this._edges1=Array.from(e):e instanceof Array&&(this._edges1=e),t&&t!==e?t instanceof Set?this._edges2=Array.from(t):t instanceof Array&&(this._edges2=t):this._edges2=this._edges1,this._sameEdgeLists=this._edges1===this._edges2,l.ConsoleUtils.assert(this._edges1&&this._edges2)},u.prototype.compute=function(){this.matchVertices(),this.doEdgeSplits(),this.matchEdges()},u.prototype.getVertexMatches=function(){var e=new Set;return this._vertexMatchMap.forEach((function(t,r){e.add(t)})),Array.from(e)},u.prototype.getEdgeMatches=function(){var e=new Set;return this._edgeMatchMap.forEach((function(t,r){e.add(t)})),Array.from(e)},u.prototype.getNewVertices=function(){return this._newVertices},u.prototype.getEdgeProgenitors=function(){return this._edgeProgenitors},t.MatchFinder=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceEdge=t.splitEdge=void 0;var i=r(16),n=r(20),o=r(27),s=r(6),a=function(e,t){var r=new o.Coedge;r.setEdge(t),e.getEdge().getCoedge()===e&&t.setCoedge(r),r.setReversed(e.isReversed()),r.setLoop(e.getLoop());var i=e.getLoop().getCoedges(),n=i.indexOf(e);return r.isReversed()?i.splice(n,0,r):i.splice((n+1)%i.length,0,r),r};t.splitEdge=function(e,t,r){var o=new i.Vertex(new s.Point(r)),l=[e.getRange()[0],e.getRange()[1]],u=e.getEndVertex();e.setRange([l[0],t]),e.setEndVertex(o);var c=new n.Edge;c.setCurve(e.getCurve()),c.setReversed(e.isReversed()),c.setRange([t,l[1]]),c.setStartVertex(o),c.setEndVertex(u),c.setPrecision(e.getPrecision()),c.setWire(e.getWire());for(var h=[],d=e.getCoedge();d;)h.push(a(d,c)),(d=d.getPartner())===e.getCoedge()&&(d=void 0);for(var p=0;p<h.length;++p){var f=(p+1)%h.length;h[p].setPartner(h[f])}if(c.getWire()){var g=c.getWire().getEdges().slice(),v=g.indexOf(e);g.splice(v+1,0,c),c.getWire().setEdges(g)}return c},t.replaceEdge=function(e){var t=new n.Edge;t.setCurve(e.getCurve()),t.setReversed(e.isReversed()),t.setRange([e.getRange()[0],e.getRange()[1]]),t.setStartVertex(e.getStartVertex()),t.setEndVertex(e.getEndVertex()),t.setPrecision(e.getPrecision()),t.setCoedge(e.getCoedge()),t.setWire(e.getWire()),e.setStartVertex(null),e.setEndVertex(null),e.setCoedge(void 0),e.setWire(void 0);for(var r=t.getCoedge();r;)r.setEdge(t),(r=r.getPartner())===t.getCoedge()&&(r=void 0);if(t.getWire()){var i=t.getWire().getEdges().slice();i[i.indexOf(e)]=t,t.getWire().setEdges(i)}return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.svgFromWire=void 0;var i=r(0),n=r(2);t.svgFromWire=function(e){e.getTopologyType()===i.TOPOLOGY_TYPES.WIREBODY&&console.warn("svgFromWire: Pass a wire, not a wire body."),n.ConsoleUtils.assert(e.getTopologyType()===i.TOPOLOGY_TYPES.WIRE,"Input topology is not a Wire");var t=e.getOrderedEdges();if(0===t.edges.length)return"";for(var r=t.start,o=r.getPosition(),s="M "+o[0]+" "+o[1],a=0;a<t.edges.length;++a){var l=t.edges[a];o=(r=r===l.getStartVertex()?l.getEndVertex():l.getStartVertex()).getPosition();var u=l.getCurve();if(u)if(u.getGeometryType()===i.GEOMETRY_TYPES.LINE)s+=" L "+o[0]+" "+o[1];else if(u.getGeometryType()!==i.GEOMETRY_TYPES.BCURVE||3!==u.getDegree()||u.isRational())console.warn("Unhandled curve type in svgFromWire");else{for(var c=[],h=u.getBezierSegments(),d=0;d<h.length;d++){var p=h[d];if(p)for(var f=p.getControlPoints(),g=0;g<f.length;g+=3)c.push([f[g],f[g+1]])}r===l.getStartVertex()!==l.isReversed()&&c.reverse(),n.ConsoleUtils.assert(c.length===4*h.length,"Unexpected number of control points");for(var v=0;v<h.length;++v)s+=" C "+c[4*v+1][0]+" "+c[4*v+1][1]+" "+c[4*v+2][0]+" "+c[4*v+2][1]+" ",v===h.length-1?s+=o[0]+" "+o[1]:s+=c[4*v+3][0]+" "+c[4*v+3][1]}}return s}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Path2D=void 0;var i=r(1),n=r(0),o=r(54),s=r(40),a=r(33),l=r(14),u=r(23),c=r(7),h=r(28),d=r(84),p=r(2),f=r(8),g={assert:function(e,t){if(!e)throw{message:t||"assertion failed"}},assert_arg:function(e,t,r,i){var n="Invalid argument '"+t+"': "+r+"\nUsage: "+i;this.assert(e,n)},assert_number:function(e,t,r){this.assert_arg("number"==typeof e,t,"should be a number",r)},assert_boolean:function(e,t,r){this.assert_arg("boolean"==typeof e,t,"should be a boolean",r)},assert_string:function(e,t,r){this.assert_arg("string"==typeof e,t,"should be a string",r)}},v=function(){this._wireBody=new o.WireBody,this._curves=[],this._xy=[0,0],this._mergeBCurves=!0,this._healPath=!1,this._tangentTol=n.KERNEL_ANGULAR_TOLERANCE};function y(e,t,r){var n=3*(t-1),o=[e[n],e[n+1],e[n+2]],s=3*r,a=[e[s],e[s+1],e[s+2]],l=i.Vector3.sub([0,0,0],a,o);i.Vector3.scale(l,l,-.1);for(var u=1;u<=r-t;++u){var c=i.Vector3.scaleAndAdd([0,0,0],a,l,u);e[s-3*u]=c[0],e[s-3*u+1]=c[1],e[s-3*u+2]=c[2]}}function m(e,t,r){var n=3*t,o=[e[n],e[n+1],e[n+2]],s=3*(r+1),a=[e[s],e[s+1],e[s+2]],l=i.Vector3.sub([0,0,0],a,o);i.Vector3.scale(l,l,.1);for(var u=1;u<=r-t;++u){var c=i.Vector3.scaleAndAdd([0,0,0],o,l,u);e[n+3*u]=c[0],e[n+3*u+1]=c[1],e[n+3*u+2]=c[2]}}function _(e,t){for(var r,n,o,s=[],a=e.getControlPoints(),l=[a[0],a[1],a[2]],u=a.length/3,c=1;c<u;++c){r=[a[3*c],a[3*c+1],a[3*c+2]];var h=c===u-1;i.Vector3.squaredDistance(l,r)<t?(void 0===n&&(n=c-1),o=c):h=!0,h&&void 0!==n&&void 0!==o&&(s.push([n,o]),h=!1,n=void 0,o=void 0),l=r}return s}function E(e,t){var r=_(e,t);if(1===r.length&&r[0][1]-r[0][0]==1){var i=r[0];0===i[0]?e.addControlPointOnCurve(e.evaluatePosition(.1)):i[1]===e.getNumControlPoints()-1?e.addControlPointOnCurve(e.evaluatePosition(.9)):(e.addControlPointOnCurve(e.evaluatePosition(.45)),e.addControlPointOnCurve(e.evaluatePosition(.55)))}return r.length>0}function x(e,t){for(var r=_(e,t),i=0;i<r.length;++i){var n=r[i],o=e.getControlPoints().slice();n[0]>0?y(o,n[0],n[1]):n[1]<o.length/3-1?m(o,n[0],n[1]):f.DebugUtils.warn("Degenerate BCurve!"),e.setControlPoints(o)}}function b(e,t){var r=e.getControlPoints(),n=[r[0],r[1],r[2]],o=[r[3],r[4],r[5]],s=i.Vector3.distance(n,o);r[3]=n[0]+t[0]*s,r[4]=n[1]+t[1]*s,r[5]=n[2]+t[2]*s,e.setControlPoints(r)}function A(e,t){var r=e.getControlPoints(),n=e.getControlPoints().length,o=[r[n-6],r[n-5],r[n-4]],s=[r[n-3],r[n-2],r[n-1]],a=i.Vector3.distance(o,s);r[n-6]=s[0]-t[0]*a,r[n-5]=s[1]-t[1]*a,r[n-4]=s[2]-t[2]*a,e.setControlPoints(r)}function C(e){var t=new a.BCurve,r=e.getRange(),n=e.evaluatePosition(r[0]),o=e.evaluatePosition(r[1]),s=i.Vector3.lerp([0,0,0],n,o,1/3),l=i.Vector3.lerp([0,0,0],n,o,2/3),u=[n[0],n[1],0,s[0],s[1],0,l[0],l[1],0,o[0],o[1],0];return t.set(u,[1,1,1,1],3,[0,0,0,0,1,1,1,1]),t}function T(e,t){for(var r,n=e.getRange(),o=e.evaluatePosition(n[0]),s=e.evaluatePosition(n[1]),a=i.Vector3.distance(o,s),l=0,u=t.getControlPoints(),c=[u[0],u[1],u[2]],h=u.length/3,d=1;d<h;++d)r=[u[3*d],u[3*d+1],u[3*d+2]],l+=i.Vector3.distance(c,r),c=r;return a<l}function P(e,t){var r=e.getControlPoints().concat(t.getControlPoints().slice(3)),n=e.getWeights().concat(t.getWeights().slice(1)),o=e.getKnotVector().slice(0,-1),s=e.evaluateDt(e.getRange()[1]),a=t.evaluateDt(t.getRange()[0]),l=Math.sqrt(i.Vector3.squaredLength(a)/i.Vector3.squaredLength(s)),u=o[o.length-1]-t.getKnotVector()[0]*l,c=t.getKnotVector().slice(t.getDegree()+1);return c=c.map((function(e){return e*l+u})),o=o.concat(c),e.set(r,n,3,o),e}function R(e,t,r,o,s){var a=i.Vector2.subtract([],s,e),u=i.Vector2.length(a);if(!(u<n.KERNEL_TOLERANCE)){u>2*t&&(t=u/2);var c=i.Vector2.scaleAndAdd([],e,a,.5);if(u<2*t-i.FLOAT64_TOLERANCE){var h=Math.sqrt(t*t-u*u/4);!0===o!=(!1===r)&&(h=-h);var d=i.Vector2.normalize([],[-a[1],a[0]]);i.Vector2.scaleAndAdd(c,c,d,h)}var p=[0,0,o?1:-1],f=new l.Circle;f.set([c[0],c[1],0],p,[t,0,0]);var g=f.closestToPointParam([e[0],e[1],0]),v=f.closestToPointParam([s[0],s[1],0]);return v<=g&&(v+=2*Math.PI),f.limitRange([g,v]),f}}function S(e,t){var r=e.slice(1);r=r.replace(/([^e])-/g,"$1 -");for(var i=0;i<2;++i)r=r.replace(/\.[0-9]*\./g,(function(e){return e.slice(0,-1)+" ."}));for(var n=r.split(/[,\s]/),o=[],s=0;s<n.length;++s)if(n[s].length>0){var a=Number(n[s]);t(!isNaN(a),"could not parse command"),o.push(a)}return o}v.prototype.numWires=function(){var e=this._wireBody.getWires().length;return this._curves.length>0&&(e+=1),e},v.prototype.numClosed=function(){for(var e=0,t=0;t<this._wireBody.getWires().length;++t)this._wireBody.getWires()[t].isClosed()&&(e+=1);return this._areCurvesClosed()&&(e+=1),e},v.prototype._fixCoincidentControlPoints=function(){for(var e=n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE,t=0;t<this._curves.length;++t){var r=this._curves[t];r.getGeometryType()===n.GEOMETRY_TYPES.BCURVE&&3===r.getDegree()&&4===r.getNumControlPoints()&&!1===r.isRational()&&E(r,e)&&x(r,e)}},v.prototype._snapBCurvesTangent=function(){for(var e=0;e<this._curves.length;++e){var t=(e+1)%this._curves.length;if(0===t&&!this._areCurvesClosed())break;var r=this._curves[e],o=this._curves[t],s=r.evaluateDt(r.getRange()[1]),a=o.evaluateDt(o.getRange()[0]);i.Vector3.isParallel(s,a,1,this._tangentTol)&&(r.getGeometryType()!==n.GEOMETRY_TYPES.BCURVE&&o.getGeometryType()===n.GEOMETRY_TYPES.BCURVE?(i.Vector3.normalize(s,s),b(o,s)):r.getGeometryType()===n.GEOMETRY_TYPES.BCURVE&&o.getGeometryType()!==n.GEOMETRY_TYPES.BCURVE&&(i.Vector3.normalize(a,a),A(r,a)))}},v.prototype._areCurvesClosed=function(){if(0===this._curves.length)return!1;var e=this._curves[this._curves.length-1],t=this._curves[0];return i.Vector3.squaredDistance(e.evaluatePosition(e.getRange()[1]),t.evaluatePosition(t.getRange()[0]))<n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE},v.prototype._mergeShortLinesWithBCurves=function(){for(var e=!1,t=0;t<this._curves.length;++t){var r=(t+1)%this._curves.length;if(0===r&&!this._areCurvesClosed())break;var o=this._curves[t],s=this._curves[r],a=o.evaluateDt(o.getRange()[1]),l=s.evaluateDt(s.getRange()[0]);i.Vector3.isParallel(a,l,1,n.KERNEL_ANGULAR_TOLERANCE)&&(o.getGeometryType()===n.GEOMETRY_TYPES.LINE&&s.getGeometryType()===n.GEOMETRY_TYPES.BCURVE&&T(o,s)?(this._curves.splice(t,1,P(C(o),s)),this._curves.splice(r,1),t-=1,e=!0):o.getGeometryType()===n.GEOMETRY_TYPES.BCURVE&&s.getGeometryType()===n.GEOMETRY_TYPES.LINE&&T(s,o)&&(this._curves.splice(t,1,P(o,C(s))),this._curves.splice(r,1),t-=1,e=!0))}return e},v.prototype._mergeAdjacentBCurves=function(){for(var e=0;e<this._curves.length;++e){var t=(e+1)%this._curves.length;if(0===t&&!this._areCurvesClosed())break;var r=this._curves[e],o=this._curves[t],s=r.evaluateDt(r.getRange()[1]),a=o.evaluateDt(o.getRange()[0]);i.Vector3.isParallel(s,a,1,this._tangentTol)&&r.getGeometryType()===n.GEOMETRY_TYPES.BCURVE&&o.getGeometryType()===n.GEOMETRY_TYPES.BCURVE&&(i.Vector3.squaredLength(s)<i.Vector3.squaredLength(a)?(i.Vector3.normalize(s,s),b(o,s)):(i.Vector3.normalize(a,a),A(r,a)),r!==o&&(P(r,o),this._curves.splice(t,1),e-=1))}},v.prototype.setMergeBCurves=function(e){this._mergeBCurves=e},v.prototype.setHealForASM=function(e,t){this._healPath=e,this._tangentTol=void 0!==t?t:.01745240643728351},v.prototype._addWire=function(){if(0!==this._curves.length){this._healPath&&(this._fixCoincidentControlPoints(),this._snapBCurvesTangent()),(this._mergeBCurves||this._healPath)&&this._mergeAdjacentBCurves(),this._healPath&&this._mergeShortLinesWithBCurves()&&this._mergeAdjacentBCurves();var e=(0,h.createWiresFromEdges)((0,h.createEdgesFromCurves)(this._curves));p.ConsoleUtils.assert(1===e.length),this._wireBody.addWire(e[0]),this._curves=[]}},v.prototype._discardIfOpen=function(){if(0!==this._curves.length){var e=this._curves[0].evaluatePosition(this._curves[0].getRange()[0]),t=[this._xy[0],this._xy[1],0];i.Vector3.squaredDistance(e,t)>=n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE&&(this._curves=[])}},v.prototype.moveTo=function(e,t){var r="Path2D.moveTo(x, y)";return g.assert_number(e,"x",r),g.assert_number(t,"y",r),this._addWire(),this._xy[0]=e,this._xy[1]=t,this},v.prototype.lineTo=function(e,t){var r="Path2D.lineTo(x, y)";g.assert_number(e,"x",r),g.assert_number(t,"y",r);var i=e-this._xy[0],o=t-this._xy[1];if(i*i+o*o>n.KERNEL_TOLERANCE*n.KERNEL_TOLERANCE){var s=new c.Line;s.set([this._xy[0],this._xy[1],0],[i,o,0]),s.limitRange([0,1]),this._curves.push(s)}return this._xy[0]=e,this._xy[1]=t,this},v.prototype.quadraticCurveTo=function(e,t,r,i){var n="Path2D.quadraticCurveTo(cpx, cpy, x, y)";g.assert_number(e,"cpx",n),g.assert_number(t,"cpy",n),g.assert_number(r,"x",n),g.assert_number(i,"y",n);var o=new a.BCurve,s=1/3*this._xy[0]+2/3*e,l=1/3*this._xy[1]+2/3*t,u=1/3*r+2/3*e,c=1/3*i+2/3*t,h=[this._xy[0],this._xy[1],0,s,l,0,u,c,0,r,i,0];return o.set(h,[1,1,1,1],3,[0,0,0,0,1,1,1,1]),this._curves.push(o),this._xy[0]=r,this._xy[1]=i,this},v.prototype.bezierCurveTo=function(e,t,r,i,n,o){var s="Path2D.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)";g.assert_number(e,"cp1x",s),g.assert_number(t,"cp1y",s),g.assert_number(r,"cp2x",s),g.assert_number(i,"cp2y",s),g.assert_number(n,"x",s),g.assert_number(o,"y",s);var l=new a.BCurve,u=[this._xy[0],this._xy[1],0,e,t,0,r,i,0,n,o,0];return l.set(u,[1,1,1,1],3,[0,0,0,0,1,1,1,1]),this._curves.push(l),this._xy[0]=n,this._xy[1]=o,this},v.prototype.circleArcTo=function(e,t,r,i,n){var o="Path2D.circleArcTo(radius, longest, anticlockwise, x, y)";g.assert_number(e,"radius",o),g.assert_arg(e>0,"radius","must be positive",o),g.assert_boolean(t,"longest",o),g.assert_boolean(r,"anticlockwise",o),g.assert_number(i,"x",o),g.assert_number(n,"y",o);var s=R(this._xy,e,t,r,[i,n]);return s&&(this._curves.push(s),this._xy[0]=i,this._xy[1]=n),this},v.prototype.ellipseArcTo=function(e,t,r,n,o,s,a){var l="Path2D.ellipseArcTo(xRadius, yRadius, rotation, longest, anticlockwise, x, y)";if(g.assert_number(e,"xRadius",l),g.assert_arg(e>0,"xRadius","must be positive",l),g.assert_number(t,"yRadius",l),g.assert_arg(t>0,"yRadius","must be positive",l),g.assert_number(r,"rotation",l),g.assert_boolean(n,"longest",l),g.assert_boolean(o,"anticlockwise",l),g.assert_number(s,"x",l),g.assert_number(a,"y",l),e<t){var c=e;e=t,t=c,r+=Math.PI/2}var h=Math.cos(r),d=Math.sin(r),p=e/t,f=i.Matrix22.multiply([],[1,0,0,p],[h,-d,d,h]),v=R(i.Vector2.transformMatrix22([],this._xy,f),e,n,o,i.Vector2.transformMatrix22([],[s,a],f));if(v){var y=[v.getCenter()[0],v.getCenter()[1]];i.Matrix22.invert(f,f),i.Vector2.transformMatrix22(y,y,f),y[2]=0;var m=v.getRadius(),_=[m*h,m*d,0],E=new u.Ellipse;E.set(y,v.getNormal(),_,1/p),E.limitRange(v.getRange()),this._curves.push(E),this._xy[0]=s,this._xy[1]=a}return this},v.prototype.closePath=function(){if(this._curves.length>0){var e=this._curves[0],t=e.evaluatePosition(e.getRange()[0]);this.lineTo(t[0],t[1]),this._addWire()}return this},v.prototype.addCircle=function(e,t,r){var i="Path2D.addCircle(x, y, radius)";g.assert_number(e,"x",i),g.assert_number(t,"y",i),g.assert_number(r,"radius",i),g.assert_arg(r>0,"radius","must be positive",i),this._addWire();var n=new l.Circle;return n.set([e,t,0],[0,0,1],[r,0,0]),this._curves.push(n),this._addWire(),this},v.prototype.addEllipse=function(e,t,r,i,n){n=void 0===n?0:n;var o="Path2D.addEllipse(x, y, xRadius, yRadius, rotation)";if(g.assert_number(e,"x",o),g.assert_number(t,"y",o),g.assert_number(r,"xRadius",o),g.assert_arg(r>0,"xRadius","must be positive",o),g.assert_number(i,"yRadius",o),g.assert_arg(i>0,"yRadius","must be positive",o),g.assert_number(n,"rotation",o),this._addWire(),r<i){var s=r;r=i,i=s,n+=Math.PI/2}var a=new u.Ellipse,l=Math.cos(n),c=Math.sin(n),h=i/r;return a.set([e,t,0],[0,0,1],[r*l,r*c,0],h),this._curves.push(a),this._addWire(),this},v.prototype.addSVGPath=function(e,t){t=void 0!==t&&t;var r="Path2D.addSVGPath(pathString, [includeOpen])";g.assert_string(e,"pathString",r),g.assert_boolean(t,"includeOpen",r),this._addWire(),this._xy[0]=0,this._xy[1]=0;var i=function(e){for(var t=[];e.length>0;){var r=e.slice(1).search(/[MmZzLlHhVvCcSsQqTtAa]/)+1;r<=0&&(r=e.length);var i=e.slice(0,r).trim();i.length>0&&t.push(i),e=e.slice(r).trim()}return t}(e);g.assert_arg(i.length>0,"pathString","cannot be empty string",r);for(var o=[this._xy[0],this._xy[1]],s=[this._xy[0],this._xy[1]],a=0;a<i.length;++a){var l,u,c,h,d,p,f,v=function(e,t){g.assert_arg(e,"pathString",t+' "'+i[a]+'"',r)},y=i[a].charAt(0).toUpperCase(),m=y!==i[a].charAt(0),_=S(i[a],v),E=m?this._xy:[0,0];switch(y){case"M":for(v(_.length>=2,"insufficient arguments in command"),v(_.length%2==0,"command requires pairs of x,y arguments"),t||this._discardIfOpen(),this.moveTo(_[0]+E[0],_[1]+E[1]),f=2;f<_.length;f+=2)this.lineTo(_[f]+E[0],_[f+1]+E[1]);break;case"Z":v(0===_.length,"command should not have arguments"),this.closePath();break;case"L":for(v(_.length>=2,"insufficient arguments in command"),v(_.length%2==0,"command requires pairs of x,y arguments"),f=0;f<_.length;f+=2)this.lineTo(_[f]+E[0],_[f+1]+E[1]);break;case"H":for(v(_.length>=1,"insufficient arguments in command"),f=0;f<_.length;f+=1)this.lineTo(_[f]+E[0],this._xy[1]);break;case"V":for(v(_.length>=1,"insufficient arguments in command"),f=0;f<_.length;f+=1)this.lineTo(this._xy[0],_[f]+E[1]);break;case"C":for(v(_.length>=6,"insufficient arguments in command"),v(_.length%6==0,"command requires sets of 6 arguments"),f=0;f<_.length;f+=6)l=_[f]+E[0],u=_[f+1]+E[1],c=_[f+2]+E[0],h=_[f+3]+E[1],d=_[f+4]+E[0],p=_[f+5]+E[1],this.bezierCurveTo(l,u,c,h,d,p),s[0]=c,s[1]=h;break;case"S":for(v(_.length>=4,"insufficient arguments in command"),v(_.length%4==0,"command requires sets of 4 arguments"),f=0;f<_.length;f+=4)l=2*this._xy[0]-s[0],u=2*this._xy[1]-s[1],c=_[f]+E[0],h=_[f+1]+E[1],d=_[f+2]+E[0],p=_[f+3]+E[1],this.bezierCurveTo(l,u,c,h,d,p),s[0]=c,s[1]=h;break;case"Q":for(v(_.length>=4,"insufficient arguments in command"),v(_.length%4==0,"command requires sets of 4 arguments"),f=0;f<_.length;f+=4)l=_[f]+E[0],u=_[f+1]+E[1],c=_[f+2]+E[0],h=_[f+3]+E[1],this.quadraticCurveTo(l,u,c,h),o[0]=l,o[1]=u;break;case"T":for(v(_.length>=2,"insufficient arguments in command"),v(_.length%2==0,"command requires pairs of arguments"),f=0;f<_.length;f+=2)l=2*this._xy[0]-o[0],u=2*this._xy[1]-o[1],c=_[f]+E[0],h=_[f+1]+E[1],this.quadraticCurveTo(l,u,c,h),o[0]=l,o[1]=u;break;case"A":for(v(_.length>=7,"insufficient arguments in command"),v(_.length%7==0,"command requires sets of 7 arguments"),f=0;f<_.length;f+=7){var x=Math.abs(_[f]),b=Math.abs(_[f+1]),A=_[f+2]*Math.PI/180,C=0!==_[f+3],T=0!==_[f+4],P=_[f+5]+E[0],R=_[f+6]+E[1];x<n.KERNEL_TOLERANCE||b<n.KERNEL_TOLERANCE?this.lineTo(P,R):this.ellipseArcTo(x,b,A,C,T,P,R)}break;default:v(!1,"unrecognised command")}"Q"!==y&&"T"!==y&&(o=[this._xy[0],this._xy[1]]),"C"!==y&&"S"!==y&&(s=[this._xy[0],this._xy[1]])}return t||this._discardIfOpen(),this._addWire(),this},v.prototype.getWireBody=function(){return this._addWire(),this._wireBody},v.prototype.computeRegionizedWireBody=function(){this.getWireBody();for(var e=new o.WireBody,t=(0,d.mergeSketchRegions)(this._wireBody.getWires()),r=0;r<t.length;++r)for(var i=t[r].getLoops(),n=0;n<i.length;++n){var a=i[n],l=new s.Wire;l.addEdges(Array.from(a.collectEdges())),e.addWire(l)}return e},v.prototype.reset=function(){this._wireBody=new o.WireBody,this._curves=[],this._xy=[0,0]},t.Path2D=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidDefLoader=t.getTopologyRank=void 0;var i=r(6),n=r(7),o=r(14),s=r(23),a=r(33),l=r(18),u=r(38),c=r(39),h=r(74),d=r(51),p=r(52),f=r(75),g=r(53),v=r(24),y=r(25),m=r(26),_=r(15),E=r(13),x=r(27),b=r(20),A=r(16),C=r(54),T=r(40),P=r(79),R=r(0),S=r(85),V=r(124),w=r(125),M=r(45),L=function(){var e={};return e[R.TOPOLOGY_TYPES.BODY]=10,e[R.TOPOLOGY_TYPES.WIREBODY]=9,e[R.TOPOLOGY_TYPES.LUMP]=8,e[R.TOPOLOGY_TYPES.SHELL]=7,e[R.TOPOLOGY_TYPES.FACE]=6,e[R.TOPOLOGY_TYPES.WIRE]=5,e[R.TOPOLOGY_TYPES.LOOP]=4,e[R.TOPOLOGY_TYPES.COEDGE]=3,e[R.TOPOLOGY_TYPES.EDGE]=2,e[R.TOPOLOGY_TYPES.VERTEX]=1,function(t){var r=void 0;return"function"==typeof t.getTopologyType&&(r=e[t.getTopologyType()]),r||0}}(),O=function(){this._runTimeMap=new Map,this._typeidToFuncMap={},this.addLoader("body",V.TopologySetters.setBodyData,v.Body),this.addLoader("wirebody",V.TopologySetters.setWireBodyData,C.WireBody),this.addLoader("wire",V.TopologySetters.setWireData,T.Wire),this.addLoader("lump",V.TopologySetters.setLumpData,y.Lump),this.addLoader("shell",V.TopologySetters.setShellData,m.Shell),this.addLoader("face",V.TopologySetters.setFaceData,_.Face),this.addLoader("loop",V.TopologySetters.setLoopData,E.Loop),this.addLoader("coedge",V.TopologySetters.setCoedgeData,x.Coedge),this.addLoader("edge",V.TopologySetters.setEdgeData,b.Edge),this.addLoader("vertex",V.TopologySetters.setVertexData,A.Vertex),this.addLoader("point",S.GeometrySetters.setPointFromProperty,i.Point),this.addLoader("line",S.GeometrySetters.setLineFromProperty,n.Line),this.addLoader("circle",S.GeometrySetters.setCircleFromProperty,o.Circle),this.addLoader("ellipse",S.GeometrySetters.setEllipseFromProperty,s.Ellipse),this.addLoader("bcurve",S.GeometrySetters.setBCurveFromProperty,a.BCurve),this.addLoader("plane",S.GeometrySetters.setPlaneFromProperty,l.Plane),this.addLoader("sphere",S.GeometrySetters.setSphereFromProperty,h.Sphere),this.addLoader("torus",S.GeometrySetters.setTorusFromProperty,f.Torus),this.addLoader("cylinder",S.GeometrySetters.setCylinderFromProperty,u.Cylinder),this.addLoader("cone",S.GeometrySetters.setConeFromProperty,d.Cone),this.addLoader("ellipticalcylinder",S.GeometrySetters.setEllipticalCylinderFromProperty,c.EllipticalCylinder),this.addLoader("ellipticalcone",S.GeometrySetters.setEllipticalConeFromProperty,p.EllipticalCone),this.addLoader("bsurface",S.GeometrySetters.setBSurfaceFromProperty,g.BSurface),this.addLoader("nmiattributestr",w.AttributeSetters.setNMIAttributeStr,P.Attribute),this.addLoader("nmiattributearr",w.AttributeSetters.setNMIAttributeArr,P.Attribute),this.addLoader("textattribute",w.AttributeSetters.setTextAttribute,P.Attribute)};O.prototype.addLoader=function(e,t,r){this._typeidToFuncMap[e]=[t,r]},O.prototype._reset=function(){this._runTimeMap.clear()},O.prototype.getDataSettingFunction=function(e){var t=this._typeidToFuncMap[e];if(t)return t[0]},O.prototype.createRunTimeObject=function(e){var t=this.getTypeContructor(e);if(t)return new t},O.prototype.getTypeContructor=function(e){var t=this._typeidToFuncMap[e];if(t&&2===t.length)return t[1]},O.prototype.setObjectProperties=function(e,t,r){var i=this.getDataSettingFunction(e,r),n=this;"function"==typeof i&&i(t,r,(function(e){if(e){var t=e;return t?n._runTimeMap.get(t):void 0}}))},O.prototype.makeGeometryObjectsProto=function(e){var t=this;Object.keys(e).forEach((function(r){var i=e[r],n=i[i.geometry],o=t.createRunTimeObject(i.geometry);o&&(t._runTimeMap.set(r,o),t.setObjectProperties(i.geometry,o,n),o.setGuid(r))}))},O.prototype.makeGeometryObject=function(e){var t=e.getTypeid(),r=this.createRunTimeObject(t);return r?this.setObjectProperties(t,r,e):console.error("No constructor"),r},O.prototype.makeTopologyObject=function(e){var t=e.getTypeid(),r=this.createRunTimeObject(t);return r||console.error("No constructor"),r},O.prototype.makeAttributeObjectsProto=function(e){var t=this;Object.keys(e).forEach((function(r){var i=e[r],n=i[i.attribute],o=new P.Attribute;t._runTimeMap.set(r,o),t.setObjectProperties(i.attribute,o,n),o.setGuid(r)}))},O.prototype.makeTopologyObjectsProto=function(e){var t=this,r=[];Object.keys(e).forEach((function(i){var n=e[i],o=n[n.topology],s=t.createRunTimeObject(n.topology);s&&(t._runTimeMap.set(i,s),r.push({type:n.topology,obj:s,prop:o}),s.setGuid(i))}));for(var i=0;i<r.length;++i)this.setObjectProperties(r[i].type,r[i].obj,r[i].prop)},O.prototype._collectGeometries=function(e){this._runTimeMap.forEach((function(t){void 0!==t.getGeometryType&&e.set(t.getGuid(),t)}))},O.prototype._collectTopologies=function(e){this._runTimeMap.forEach((function(t){void 0!==t.getTopologyType&&e.set(t.getGuid(),t)}))},O.prototype.loadModelPSet=function(e,t,r){var i=e.get("geometries");if(i){var n=e.get("attributes"),o=e.get("topologies");if(o)return this.makeGeometryObjects(i),n&&this.makeAttributeObjects(n),this.makeTopologyObjects(o),this.getHighestObject(t,r)}},O.prototype.getHighestObject=function(e,t){var r=void 0,i=0;return this._runTimeMap.forEach((function(e){if(10!==i){var t=L(e);t>i&&t>0&&(i=t,r=e)}})),e&&this._collectGeometries(e),t&&this._collectTopologies(t),this._reset(),r},O.prototype.loadModelProtoMessage=function(e,t,r){var i=e.geometries;if(i){var n=e.attributes,o=e.topologies;return o?(this.makeGeometryObjectsProto(i),n&&this.makeAttributeObjectsProto(n),this.makeTopologyObjectsProto(o),this.getHighestObject(t,r)):void 0}},O.prototype.loadProtoBinary=function(e,t,r){var i=e;i instanceof ArrayBuffer&&(i=new Uint8Array(i));var n=M.Autodesk.lookupType("SolidDef.model_1_0_0").decode(i);return this.loadModelProtoMessage(n,t,r)},t.getTopologyRank=L,t.SolidDefLoader=O},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TopologySetters=void 0;var i=r(85),n={},o=function(e,t,r){var i=t.attributes;if(i){e.removeAllAttributes();for(var n=0;n<i.length;++n){var o=r(i[n]);e.addAttribute(o)}}};n.setBodyData=function(e,t,r){for(var i=t.lumps,n=new Array(i.length),s=0;s<i.length;++s){var a=i[s];n[s]=r(a),n[s].setBody(e)}e.setLumps(n),o(e,t,r)},n.setLumpData=function(e,t,r){for(var i=t.shells,n=new Array(i.length),s=0;s<i.length;++s){var a=i[s];n[s]=r(a),n[s].setLump(e)}e.setShells(n),o(e,t,r)},n.setShellData=function(e,t,r){for(var i=t.faces,n=new Array(i.length),s=0;s<i.length;++s){var a=i[s];n[s]=r(a),n[s].setShell(e)}e.setFaces(n),o(e,t,r)},n.setFaceData=function(e,t,r){for(var i=t.loops,n=new Array(i.length),s=0;s<i.length;++s){var a=i[s];n[s]=r(a),n[s].setFace(e)}e.setLoops(n),e.setReversed(t.reversed),e.setSurface(r(t.geometry)),o(e,t,r)},n.setLoopData=function(e,t,r){for(var i=t.coedges,n=new Array(i.length),s=0;s<i.length;++s){var a=i[s];n[s]=r(a),n[s].setLoop(e)}e.setCoedges(n),o(e,t,r)},n.setCoedgeData=function(e,t,r){e.setEdge(r(t.edge)),e.setReversed(t.reversed),e.setPartner(r(t.partner)),e.getEdge()&&!e.getEdge().getCoedge()&&e.getEdge().setCoedge(e),o(e,t,r)},n.setEdgeData=function(e,t,r){e.setVertex(0,r(t.vertex0)),e.setVertex(1,r(t.vertex1));var n=(0,i.propertyToRange)(t,"range");e.sett0(n[0]),e.sett1(n[1]),e.setReversed(t.reversed),e.setPrecision(t.precision),e.setCurve(r(t.geometry)),o(e,t,r)},n.setVertexData=function(e,t,r){e.setPrecision(t.precision),e.setPoint(r(t.geometry)),o(e,t,r)},n.setWireBodyData=function(e,t,r){for(var i=t.wires,n=new Array(i.length),s=0;s<i.length;++s){var a=i[s];n[s]=r(a),n[s].setWireBody(e)}e.setWires(n),o(e,t,r)},n.setWireData=function(e,t,r){for(var i=t.edges,n=new Array(i.length),s=0;s<i.length;++s){var a=i[s];n[s]=r(a),n[s].setWire(e)}e.setEdges(n),o(e,t,r)},t.TopologySetters=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={setNMIAttributeStr:function(e,t){e.typeid="autodesk.brep:nmiattributestr-1.0.0",e.values={primaryId:t.primaryId,secondaryId:t.secondaryId,approachId:t.approachId,operationIds:t.operationIds}},setNMIAttributeArr:function(e,t){e.typeid="autodesk.brep:nmiattributearr-1.0.0";for(var r=t.tagInfo,i=new Array(r.length),n=0;n<r.length;++n){var o=r[n];i[n]={primaryId:o.primaryId,secondaryId:o.secondaryId,approachId:o.approachId,operationIds:o.operationIds}}e.values={tagInfo:i}},setTextAttribute:function(e,t){e.typeid="autodesk.brep:textattribute-1.0.0",e.values={text:t.text}}};t.AttributeSetters=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saveToProtoBinary=t.saveToProtoMessage=t.SolidDefSaver=void 0;var i=r(45),n=function(){};n.prototype.setVersion=function(e){console.warn("SolidDefSaver.prototype.setVersion is deprecated,")};var o=function(e){var t=i.Autodesk.lookupType("SolidDef.model_1_0_0"),r={topologies:{},geometries:{},attributes:{}};return e.addToModelObject(r),t.create(r)};t.SolidDefSaver=n,t.saveToProtoMessage=o,t.saveToProtoBinary=function(e){var t=i.Autodesk.lookupType("SolidDef.model_1_0_0"),r=o(e);return t.encode(r).finish()}}])},"object"==(void 0===exports?"undefined":_typeof(exports))&&"object"==(void 0===module?"undefined":_typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==(void 0===exports?"undefined":_typeof(exports))?exports["solid-definition"]=t():e.SolidDefinition=t()},93379:e=>{"use strict";var t=[];function r(e){for(var r=-1,i=0;i<t.length;i++)if(t[i].identifier===e){r=i;break}return r}function i(e,i){for(var o={},s=[],a=0;a<e.length;a++){var l=e[a],u=i.base?l[0]+i.base:l[0],c=o[u]||0,h="".concat(u," ").concat(c);o[u]=c+1;var d=r(h),p={css:l[1],media:l[2],sourceMap:l[3]};-1!==d?(t[d].references++,t[d].updater(p)):t.push({identifier:h,updater:n(p,i),references:1}),s.push(h)}return s}function n(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r.update(e=t)}else r.remove()}}e.exports=function(e,n){var o=i(e=e||[],n=n||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=r(o[s]);t[a].references--}for(var l=i(e,n),u=0;u<o.length;u++){var c=r(o[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}o=l}}},90569:e=>{"use strict";var t={};e.exports=function(e,r){var i=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(r)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},3565:(e,t,r)=>{"use strict";e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var i=r.css,n=r.media,o=r.sourceMap;n?e.setAttribute("media",n):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},80227:(e,t,r)=>{e.exports=function(){return r(69855)('/*! For license information please see 22a2550ef316957f9288.worker.js.LICENSE.txt */\n(()=>{var t={924:(t,i,e)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}t=e.nmd(t);var r,s,o,a,h,u,c,l,f,m,y,p,x,d,v,b,M={REVISION:"71"};"object"===n(t)&&(t.exports=M),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),M.log=function(){console.log.apply(console,arguments)},M.warn=function(){console.warn.apply(console,arguments)},M.error=function(){console.error.apply(console,arguments)},M.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},M.CullFaceNone=0,M.CullFaceBack=1,M.CullFaceFront=2,M.CullFaceFrontBack=3,M.FrontFaceDirectionCW=0,M.FrontFaceDirectionCCW=1,M.BasicShadowMap=0,M.PCFShadowMap=1,M.PCFSoftShadowMap=2,M.FrontSide=0,M.BackSide=1,M.DoubleSide=2,M.NoShading=0,M.FlatShading=1,M.SmoothShading=2,M.NoColors=0,M.FaceColors=1,M.VertexColors=2,M.NoBlending=0,M.NormalBlending=1,M.AdditiveBlending=2,M.SubtractiveBlending=3,M.MultiplyBlending=4,M.CustomBlending=5,M.AddEquation=100,M.SubtractEquation=101,M.ReverseSubtractEquation=102,M.MinEquation=103,M.MaxEquation=104,M.ZeroFactor=200,M.OneFactor=201,M.SrcColorFactor=202,M.OneMinusSrcColorFactor=203,M.SrcAlphaFactor=204,M.OneMinusSrcAlphaFactor=205,M.DstAlphaFactor=206,M.OneMinusDstAlphaFactor=207,M.DstColorFactor=208,M.OneMinusDstColorFactor=209,M.SrcAlphaSaturateFactor=210,M.MultiplyOperation=0,M.MixOperation=1,M.AddOperation=2,M.UVMapping=300,M.CubeReflectionMapping=301,M.CubeRefractionMapping=302,M.EquirectangularReflectionMapping=303,M.EquirectangularRefractionMapping=304,M.SphericalReflectionMapping=305,M.RepeatWrapping=1e3,M.ClampToEdgeWrapping=1001,M.MirroredRepeatWrapping=1002,M.NearestFilter=1003,M.NearestMipMapNearestFilter=1004,M.NearestMipMapLinearFilter=1005,M.LinearFilter=1006,M.LinearMipMapNearestFilter=1007,M.LinearMipMapLinearFilter=1008,M.UnsignedByteType=1009,M.ByteType=1010,M.ShortType=1011,M.UnsignedShortType=1012,M.IntType=1013,M.UnsignedIntType=1014,M.FloatType=1015,M.HalfFloatType=1025,M.UnsignedShort4444Type=1016,M.UnsignedShort5551Type=1017,M.UnsignedShort565Type=1018,M.AlphaFormat=1019,M.RGBFormat=1020,M.RGBAFormat=1021,M.LuminanceFormat=1022,M.LuminanceAlphaFormat=1023,M.RGBEFormat=M.RGBAFormat,M.RGB_S3TC_DXT1_Format=2001,M.RGBA_S3TC_DXT1_Format=2002,M.RGBA_S3TC_DXT3_Format=2003,M.RGBA_S3TC_DXT5_Format=2004,M.RGB_PVRTC_4BPPV1_Format=2100,M.RGB_PVRTC_2BPPV1_Format=2101,M.RGBA_PVRTC_4BPPV1_Format=2102,M.RGBA_PVRTC_2BPPV1_Format=2103,M.Projector=function(){M.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,i){M.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(i)},this.unprojectVector=function(t,i){M.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(i)},this.pickingRay=function(t,i){M.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},M.CanvasRenderer=function(){M.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},M.Quaternion=function(t,i,e,n){this._x=t||0,this._y=i||0,this._z=e||0,this._w=void 0!==n?n:1},M.Quaternion.prototype={constructor:M.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,i,e,n){return this._x=t,this._y=i,this._z=e,this._w=n,this.onChangeCallback(),this},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,i){if(t instanceof M.Euler==0)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=Math.cos(t._x/2),n=Math.cos(t._y/2),r=Math.cos(t._z/2),s=Math.sin(t._x/2),o=Math.sin(t._y/2),a=Math.sin(t._z/2);return"XYZ"===t.order?(this._x=s*n*r+e*o*a,this._y=e*o*r-s*n*a,this._z=e*n*a+s*o*r,this._w=e*n*r-s*o*a):"YXZ"===t.order?(this._x=s*n*r+e*o*a,this._y=e*o*r-s*n*a,this._z=e*n*a-s*o*r,this._w=e*n*r+s*o*a):"ZXY"===t.order?(this._x=s*n*r-e*o*a,this._y=e*o*r+s*n*a,this._z=e*n*a+s*o*r,this._w=e*n*r-s*o*a):"ZYX"===t.order?(this._x=s*n*r-e*o*a,this._y=e*o*r+s*n*a,this._z=e*n*a-s*o*r,this._w=e*n*r+s*o*a):"YZX"===t.order?(this._x=s*n*r+e*o*a,this._y=e*o*r+s*n*a,this._z=e*n*a-s*o*r,this._w=e*n*r-s*o*a):"XZY"===t.order&&(this._x=s*n*r-e*o*a,this._y=e*o*r-s*n*a,this._z=e*n*a+s*o*r,this._w=e*n*r+s*o*a),!1!==i&&this.onChangeCallback(),this},setFromAxisAngle:function(t,i){var e=i/2,n=Math.sin(e);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(e),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var i,e=t.elements,n=e[0],r=e[4],s=e[8],o=e[1],a=e[5],h=e[9],u=e[2],c=e[6],l=e[10],f=n+a+l;return f>0?(i=.5/Math.sqrt(f+1),this._w=.25/i,this._x=(c-h)*i,this._y=(s-u)*i,this._z=(o-r)*i):n>a&&n>l?(i=2*Math.sqrt(1+n-a-l),this._w=(c-h)/i,this._x=.25*i,this._y=(r+o)/i,this._z=(s+u)/i):a>l?(i=2*Math.sqrt(1+a-n-l),this._w=(s-u)/i,this._x=(r+o)/i,this._y=.25*i,this._z=(h+c)/i):(i=2*Math.sqrt(1+l-n-a),this._w=(o-r)/i,this._x=(s+u)/i,this._y=(h+c)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(t,i){return void 0===r&&(r=new M.Vector3),(s=t.dot(i)+1)<1e-6?(s=0,Math.abs(t.x)>Math.abs(t.z)?r.set(-t.y,t.x,0):r.set(0,-t.z,t.y)):r.crossVectors(t,i),this._x=r.x,this._y=r.y,this._z=r.z,this._w=s,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,i){return void 0!==i?(M.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,i){var e=t._x,n=t._y,r=t._z,s=t._w,o=i._x,a=i._y,h=i._z,u=i._w;return this._x=e*u+s*o+n*h-r*a,this._y=n*u+s*a+r*o-e*h,this._z=r*u+s*h+e*a-n*o,this._w=s*u-e*o-n*a-r*h,this.onChangeCallback(),this},multiplyVector3:function(t){return M.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var e=this._x,n=this._y,r=this._z,s=this._w,o=s*t._w+e*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=e,this._y=n,this._z=r,this;var a=Math.acos(o),h=Math.sqrt(1-o*o);if(Math.abs(h)<.001)return this._w=.5*(s+this._w),this._x=.5*(e+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var u=Math.sin((1-i)*a)/h,c=Math.sin(i*a)/h;return this._w=s*u+this._w*c,this._x=e*u+this._x*c,this._y=n*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new M.Quaternion(this._x,this._y,this._z,this._w)}},M.Quaternion.slerp=function(t,i,e,n){return e.copy(t).slerp(i,n)},M.Vector2=function(t,i){this.x=t||0,this.y=i||0},M.Vector2.prototype={constructor:M.Vector2,set:function(t,i){return this.x=t,this.y=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(M.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},sub:function(t,i){return void 0!==i?(M.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){if(0!==t){var i=1/t;this.x*=i,this.y*=i}else this.x=0,this.y=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this},clampScalar:function(t,i){return void 0===o&&(o=new M.Vector2,a=new M.Vector2),o.set(t,t),a.set(i,i),this.clamp(o,a)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},setLength:function(t){var i=this.length();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},fromAttribute:function(t,i,e){return void 0===e&&(e=0),i=i*t.itemSize+e,this.x=t.array[i],this.y=t.array[i+1],this},clone:function(){return new M.Vector2(this.x,this.y)}},M.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},M.Vector3.prototype={constructor:M.Vector3,set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(M.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},sub:function(t,i){return void 0!==i?(M.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(M.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return t instanceof M.Euler==0&&M.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===u&&(u=new M.Quaternion),this.applyQuaternion(u.setFromEuler(t)),this},applyAxisAngle:function(){var t;return function(i,e){return void 0===t&&(t=new M.Quaternion),this.applyQuaternion(t.setFromAxisAngle(i,e)),this}}(),applyMatrix3:function(t){var i=this.x,e=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[3]*e+r[6]*n,this.y=r[1]*i+r[4]*e+r[7]*n,this.z=r[2]*i+r[5]*e+r[8]*n,this},applyMatrix4:function(t){var i=this.x,e=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[4]*e+r[8]*n+r[12],this.y=r[1]*i+r[5]*e+r[9]*n+r[13],this.z=r[2]*i+r[6]*e+r[10]*n+r[14],this},applyProjection:function(t){var i=this.x,e=this.y,n=this.z,r=t.elements,s=1/(r[3]*i+r[7]*e+r[11]*n+r[15]);return this.x=(r[0]*i+r[4]*e+r[8]*n+r[12])*s,this.y=(r[1]*i+r[5]*e+r[9]*n+r[13])*s,this.z=(r[2]*i+r[6]*e+r[10]*n+r[14])*s,this},applyQuaternion:function(t){var i=this.x,e=this.y,n=this.z,r=t.x,s=t.y,o=t.z,a=t.w,h=a*i+s*n-o*e,u=a*e+o*i-r*n,c=a*n+r*e-s*i,l=-r*i-s*e-o*n;return this.x=h*a+l*-r+u*-o-c*-s,this.y=u*a+l*-s+c*-r-h*-o,this.z=c*a+l*-o+h*-s-u*-r,this},project:function(t){return void 0===h&&(h=new M.Matrix4),h.multiplyMatrices(t.projectionMatrix,h.copy(t.matrixWorld).invert()),this.applyProjection(h)},unproject:function(){var t;return function(i){return void 0===t&&(t=new M.Matrix4),t.multiplyMatrices(i.matrixWorld,t.copy(i.projectionMatrix).invert()),this.applyProjection(t)}}(),transformDirection:function(t){var i=this.x,e=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[4]*e+r[8]*n,this.y=r[1]*i+r[5]*e+r[9]*n,this.z=r[2]*i+r[6]*e+r[10]*n,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){if(0!==t){var i=1/t;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this.z<t.z?this.z=t.z:this.z>i.z&&(this.z=i.z),this},clampScalar:function(){var t,i;return function(e,n){return void 0===t&&(t=new M.Vector3,i=new M.Vector3),t.set(e,e,e),i.set(n,n,n),this.clamp(t,i)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var i=this.length();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t),this},cross:function(t,i){if(void 0!==i)return M.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i);var e=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-e*t.z,this.z=e*t.y-n*t.x,this},crossVectors:function(t,i){var e=t.x,n=t.y,r=t.z,s=i.x,o=i.y,a=i.z;return this.x=n*a-r*o,this.y=r*s-e*a,this.z=e*o-n*s,this},projectOnVector:function(){var t,i;return function(e){return void 0===t&&(t=new M.Vector3),t.copy(e).normalize(),i=this.dot(t),this.copy(t).multiplyScalar(i)}}(),projectOnPlane:function(){var t;return function(i){return void 0===t&&(t=new M.Vector3),t.copy(this).projectOnVector(i),this.sub(t)}}(),reflect:function(){var t;return function(i){return void 0===t&&(t=new M.Vector3),this.sub(t.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(t){var i=this.dot(t)/(this.length()*t.length());return Math.acos(M.Math.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n},setEulerFromRotationMatrix:function(t,i){M.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(t,i){M.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return M.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return M.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,i){return M.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,i)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var i=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),e=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),n=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=i,this.y=e,this.z=n,this},setFromMatrixColumn:function(t,i){var e=4*t,n=i.elements;return this.x=n[e],this.y=n[e+1],this.z=n[e+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromAttribute:function(t,i,e){return void 0===e&&(e=0),i=i*t.itemSize+e,this.x=t.array[i],this.y=t.array[i+1],this.z=t.array[i+2],this},clone:function(){return new M.Vector3(this.x,this.y,this.z)}},M.Box2=function(t,i){this.min=void 0!==t?t:new M.Vector2(1/0,1/0),this.max=void 0!==i?i:new M.Vector2(-1/0,-1/0)},M.Box2.prototype={constructor:M.Box2,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromPoints:function(t){this.makeEmpty();for(var i=0,e=t.length;i<e;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(){var t=new M.Vector2;return function(i,e){var n=t.copy(e).multiplyScalar(.5);return this.min.copy(i).sub(n),this.max.copy(i).add(n),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return console.warn("Box2.empty has been deprecated. Use Box2.isEmpty instead"),this.isEmpty()},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){return console.warn("Box2.center() is deprecated. Use Box2.getCenter() instead."),this.getCenter(t)},getCenter:function(t){return(t||new M.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new M.Vector2).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,i){return(i||new M.Vector2).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,i){return(i||new M.Vector2).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new M.Vector2;return function(i){return t.copy(i).clamp(this.min,this.max).sub(i).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new M.Box2).copy(this)}},M.Box3=function(t,i){this.min=void 0!==t?t:new M.Vector3(1/0,1/0,1/0),this.max=void 0!==i?i:new M.Vector3(-1/0,-1/0,-1/0)},M.Box3.prototype={constructor:M.Box3,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromPoints:function(t){this.makeEmpty();for(var i=0,e=t.length;i<e;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(){var t=new M.Vector3;return function(i,e){var n=t.copy(e).multiplyScalar(.5);return this.min.copy(i).sub(n),this.max.copy(i).add(n),this}}(),setFromObject:function(){var t=new M.Vector3;return function(i){var e=this;return i.updateMatrixWorld(!0),this.makeEmpty(),i.traverse((function(i){var n=i.geometry;if(void 0!==n)if(n instanceof M.Geometry)for(var r=n.vertices,s=0,o=r.length;s<o;s++)t.copy(r[s]),t.applyMatrix4(i.matrixWorld),e.expandByPoint(t);else if(n instanceof M.BufferGeometry&&void 0!==n.attributes.position)for(var a=n.attributes.position.array,h=0,u=a.length;h<u;h+=3)t.set(a[h],a[h+1],a[h+2]),t.applyMatrix4(i.matrixWorld),e.expandByPoint(t)})),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return console.warn("Box3.empty has been deprecated. Use Box3.isEmpty instead"),this.isEmpty()},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return console.warn("Box3.center() is deprecated. Use Box3.getCenter() instead."),this.getCenter(t)},getCenter:function(t){return(t||new M.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new M.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,i){return(i||new M.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},clampPoint:function(t,i){return(i||new M.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new M.Vector3;return function(i){return t.copy(i).clamp(this.min,this.max).sub(i).length()}}(),getBoundingSphere:function(){var t=new M.Vector3;return function(i){var e=i||new M.Sphere;return e.center=this.center(),e.radius=.5*this.size(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(c=[new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3],function(t){return c[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),c[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),c[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),c[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),c[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),c[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),c[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),c[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(c),this}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new M.Box3).copy(this)}},M.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&M.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},M.Matrix3.prototype={constructor:M.Matrix3,set:function(t,i,e,n,r,s,o,a,h){var u=this.elements;return u[0]=t,u[3]=i,u[6]=e,u[1]=n,u[4]=r,u[7]=s,u[2]=o,u[5]=a,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(t){var i=t.elements;return this.set(i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]),this},multiplyVector3:function(t){return M.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){return M.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t=new M.Vector3;return function(i,e,n){void 0===e&&(e=0),void 0===n&&(n=i.length);for(var r=0,s=e;r<n;r+=3,s+=3)t.x=i[s],t.y=i[s+1],t.z=i[s+2],t.applyMatrix3(this),i[s]=t.x,i[s+1]=t.y,i[s+2]=t.z;return i}}(),multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],e=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],u=t[8];return i*s*u-i*o*h-e*r*u+e*o*a+n*r*h-n*s*a},getInverse:function(t,i){var e=t.elements,n=this.elements;n[0]=e[10]*e[5]-e[6]*e[9],n[1]=-e[10]*e[1]+e[2]*e[9],n[2]=e[6]*e[1]-e[2]*e[5],n[3]=-e[10]*e[4]+e[6]*e[8],n[4]=e[10]*e[0]-e[2]*e[8],n[5]=-e[6]*e[0]+e[2]*e[4],n[6]=e[9]*e[4]-e[5]*e[8],n[7]=-e[9]*e[0]+e[1]*e[8],n[8]=e[5]*e[0]-e[1]*e[4];var r=e[0]*n[0]+e[1]*n[3]+e[2]*n[6];if(0===r){var s="Matrix3.getInverse(): can\'t invert matrix, determinant is 0";if(i)throw new Error(s);return M.warn(s),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},flattenToArrayOffset:function(t,i){var e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t},getNormalMatrix:function(t){return this.copy(t).invert().transpose(),this},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},clone:function(){return(new M.Matrix3).fromArray(this.elements)}},M.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&M.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},M.Matrix4.prototype={constructor:M.Matrix4,set:function(t,i,e,n,r,s,o,a,h,u,c,l,f,m,y,p){var x=this.elements;return x[0]=t,x[4]=i,x[8]=e,x[12]=n,x[1]=r,x[5]=s,x[9]=o,x[13]=a,x[2]=h,x[6]=u,x[10]=c,x[14]=l,x[3]=f,x[7]=m,x[11]=y,x[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.elements.set(t.elements),this},extractPosition:function(t){return M.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},copyPosition:function(t){var i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this},extractBasis:function(t,i,e){var n=this.elements;return t.set(n[0],n[1],n[2]),i.set(n[4],n[5],n[6]),e.set(n[8],n[9],n[10]),this},makeBasis:function(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this},extractRotation:function(){var t=new M.Vector3;return function(i){var e=this.elements,n=i.elements,r=1/t.set(n[0],n[1],n[2]).length(),s=1/t.set(n[4],n[5],n[6]).length(),o=1/t.set(n[8],n[9],n[10]).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,this}}(),makeRotationFromEuler:function(t){t instanceof M.Euler==0&&M.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=this.elements,e=t.x,n=t.y,r=t.z,s=Math.cos(e),o=Math.sin(e),a=Math.cos(n),h=Math.sin(n),u=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var l=s*u,f=s*c,m=o*u,y=o*c;i[0]=a*u,i[4]=-a*c,i[8]=h,i[1]=f+m*h,i[5]=l-y*h,i[9]=-o*a,i[2]=y-l*h,i[6]=m+f*h,i[10]=s*a}else if("YXZ"===t.order){var p=a*u,x=a*c,d=h*u,v=h*c;i[0]=p+v*o,i[4]=d*o-x,i[8]=s*h,i[1]=s*c,i[5]=s*u,i[9]=-o,i[2]=x*o-d,i[6]=v+p*o,i[10]=s*a}else if("ZXY"===t.order){var b=a*u,w=a*c,g=h*u,z=h*c;i[0]=b-z*o,i[4]=-s*c,i[8]=g+w*o,i[1]=w+g*o,i[5]=s*u,i[9]=z-b*o,i[2]=-s*h,i[6]=o,i[10]=s*a}else if("ZYX"===t.order){var _=s*u,V=s*c,A=o*u,B=o*c;i[0]=a*u,i[4]=A*h-V,i[8]=_*h+B,i[1]=a*c,i[5]=B*h+_,i[9]=V*h-A,i[2]=-h,i[6]=o*a,i[10]=s*a}else if("YZX"===t.order){var C=s*a,E=s*h,T=o*a,P=o*h;i[0]=a*u,i[4]=P-C*c,i[8]=T*c+E,i[1]=c,i[5]=s*u,i[9]=-o*u,i[2]=-h*u,i[6]=E*c+T,i[10]=C-P*c}else if("XZY"===t.order){var S=s*a,F=s*h,R=o*a,k=o*h;i[0]=a*u,i[4]=-c,i[8]=h*u,i[1]=S*c+k,i[5]=s*u,i[9]=F*c-R,i[2]=R*c-F,i[6]=o*u,i[10]=k*c+S}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},setRotationFromQuaternion:function(t){return M.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},makeRotationFromQuaternion:function(t){var i=this.elements,e=t.x,n=t.y,r=t.z,s=t.w,o=e+e,a=n+n,h=r+r,u=e*o,c=e*a,l=e*h,f=n*a,m=n*h,y=r*h,p=s*o,x=s*a,d=s*h;return i[0]=1-(f+y),i[4]=c-d,i[8]=l+x,i[1]=c+d,i[5]=1-(u+y),i[9]=m-p,i[2]=l-x,i[6]=m+p,i[10]=1-(u+f),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},lookAt:(l=new M.Vector3,f=new M.Vector3,m=new M.Vector3,function(t,i,e){var n=this.elements;return m.subVectors(t,i).normalize(),0===m.length()&&(m.z=1),l.crossVectors(e,m).normalize(),0===l.length()&&(m.x+=1e-4,l.crossVectors(e,m).normalize()),f.crossVectors(m,l),n[0]=l.x,n[4]=f.x,n[8]=m.x,n[1]=l.y,n[5]=f.y,n[9]=m.y,n[2]=l.z,n[6]=f.z,n[10]=m.z,this}),multiply:function(t,i){return void 0!==i?(M.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,i){var e=t.elements,n=i.elements,r=this.elements,s=e[0],o=e[4],a=e[8],h=e[12],u=e[1],c=e[5],l=e[9],f=e[13],m=e[2],y=e[6],p=e[10],x=e[14],d=e[3],v=e[7],b=e[11],M=e[15],w=n[0],g=n[4],z=n[8],_=n[12],V=n[1],A=n[5],B=n[9],C=n[13],E=n[2],T=n[6],P=n[10],S=n[14],F=n[3],R=n[7],k=n[11],I=n[15];return r[0]=s*w+o*V+a*E+h*F,r[4]=s*g+o*A+a*T+h*R,r[8]=s*z+o*B+a*P+h*k,r[12]=s*_+o*C+a*S+h*I,r[1]=u*w+c*V+l*E+f*F,r[5]=u*g+c*A+l*T+f*R,r[9]=u*z+c*B+l*P+f*k,r[13]=u*_+c*C+l*S+f*I,r[2]=m*w+y*V+p*E+x*F,r[6]=m*g+y*A+p*T+x*R,r[10]=m*z+y*B+p*P+x*k,r[14]=m*_+y*C+p*S+x*I,r[3]=d*w+v*V+b*E+M*F,r[7]=d*g+v*A+b*T+M*R,r[11]=d*z+v*B+b*P+M*k,r[15]=d*_+v*C+b*S+M*I,this},multiplyToArray:function(t,i,e){var n=this.elements;return this.multiplyMatrices(t,i),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},multiplyVector3:function(t){return M.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),t.applyProjection(this)},multiplyVector4:function(t){return M.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){return M.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t=new M.Vector3;return function(i,e,n){void 0===e&&(e=0),void 0===n&&(n=i.length);for(var r=0,s=e;r<n;r+=3,s+=3)t.x=i[s],t.y=i[s+1],t.z=i[s+2],t.applyMatrix4(this),i[s]=t.x,i[s+1]=t.y,i[s+2]=t.z;return i}}(),rotateAxis:function(t){M.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return M.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},determinant:function(){var t=this.elements,i=t[0],e=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],h=t[13],u=t[2],c=t[6],l=t[10],f=t[14];return t[3]*(+r*a*c-n*h*c-r*o*l+e*h*l+n*o*f-e*a*f)+t[7]*(+i*a*f-i*h*l+r*s*l-n*s*f+n*h*u-r*a*u)+t[11]*(+i*h*c-i*o*f-r*s*c+e*s*f+r*o*u-e*h*u)+t[15]*(-n*o*u-i*a*c+i*o*l+n*s*c-e*s*l+e*a*u)},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t,this},flattenToArrayOffset:function(t,i){var e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t[i+9]=e[9],t[i+10]=e[10],t[i+11]=e[11],t[i+12]=e[12],t[i+13]=e[13],t[i+14]=e[14],t[i+15]=e[15],t},getPosition:function(){var t=new M.Vector3;return function(){M.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var i=this.elements;return t.set(i[12],i[13],i[14])}}(),setPosition:function(t){var i=this.elements;return i[12]=t.x,i[13]=t.y,i[14]=t.z,this},getInverse:function(t,i){var e=this.elements,n=t.elements,r=n[0],s=n[4],o=n[8],a=n[12],h=n[1],u=n[5],c=n[9],l=n[13],f=n[2],m=n[6],y=n[10],p=n[14],x=n[3],d=n[7],v=n[11],b=n[15];e[0]=c*p*d-l*y*d+l*m*v-u*p*v-c*m*b+u*y*b,e[4]=a*y*d-o*p*d-a*m*v+s*p*v+o*m*b-s*y*b,e[8]=o*l*d-a*c*d+a*u*v-s*l*v-o*u*b+s*c*b,e[12]=a*c*m-o*l*m-a*u*y+s*l*y+o*u*p-s*c*p,e[1]=l*y*x-c*p*x-l*f*v+h*p*v+c*f*b-h*y*b,e[5]=o*p*x-a*y*x+a*f*v-r*p*v-o*f*b+r*y*b,e[9]=a*c*x-o*l*x-a*h*v+r*l*v+o*h*b-r*c*b,e[13]=o*l*f-a*c*f+a*h*y-r*l*y-o*h*p+r*c*p,e[2]=u*p*x-l*m*x+l*f*d-h*p*d-u*f*b+h*m*b,e[6]=a*m*x-s*p*x-a*f*d+r*p*d+s*f*b-r*m*b,e[10]=s*l*x-a*u*x+a*h*d-r*l*d-s*h*b+r*u*b,e[14]=a*u*f-s*l*f-a*h*m+r*l*m+s*h*p-r*u*p,e[3]=c*m*x-u*y*x-c*f*d+h*y*d+u*f*v-h*m*v,e[7]=s*y*x-o*m*x+o*f*d-r*y*d-s*f*v+r*m*v,e[11]=o*u*x-s*c*x-o*h*d+r*c*d+s*h*v-r*u*v,e[15]=s*c*f-o*u*f+o*h*m-r*c*m-s*h*y+r*u*y;var w=r*e[0]+h*e[4]+f*e[8]+x*e[12];if(0==w){var g="THREE.Matrix4.getInverse(): can\'t invert matrix, determinant is 0";if(i)throw new Error(g);return M.warn(g),this.identity(),this}return this.multiplyScalar(1/w),this},translate:function(t){M.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(t){M.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(t){M.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(t){M.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(t,i){M.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(t){var i=this.elements,e=t.x,n=t.y,r=t.z;return i[0]*=e,i[4]*=n,i[8]*=r,i[1]*=e,i[5]*=n,i[9]*=r,i[2]*=e,i[6]*=n,i[10]*=r,i[3]*=e,i[7]*=n,i[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,Math.max(e,n)))},makeTranslation:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var e=Math.cos(i),n=Math.sin(i),r=1-e,s=t.x,o=t.y,a=t.z,h=r*s,u=r*o;return this.set(h*s+e,h*o-n*a,h*a+n*o,0,h*o+n*a,u*o+e,u*a-n*s,0,h*a-n*o,u*a+n*s,r*a*a+e,0,0,0,0,1),this},makeScale:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this},compose:function(t,i,e){return this.makeRotationFromQuaternion(i),this.scale(e),this.setPosition(t),this},decompose:function(){var t=new M.Vector3,i=new M.Matrix4;return function(e,n,r){var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),a=t.set(s[4],s[5],s[6]).length(),h=t.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],i.elements.set(this.elements);var u=1/o,c=1/a,l=1/h;return i.elements[0]*=u,i.elements[1]*=u,i.elements[2]*=u,i.elements[4]*=c,i.elements[5]*=c,i.elements[6]*=c,i.elements[8]*=l,i.elements[9]*=l,i.elements[10]*=l,n.setFromRotationMatrix(i),r.x=o,r.y=a,r.z=h,this}}(),makeFrustum:function(t,i,e,n,r,s){var o=this.elements,a=2*r/(i-t),h=2*r/(n-e),u=(i+t)/(i-t),c=(n+e)/(n-e),l=-(s+r)/(s-r),f=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=h,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,i,e,n){var r=e*Math.tan(M.Math.degToRad(.5*t)),s=-r,o=s*i,a=r*i;return this.makeFrustum(o,a,s,r,e,n)},makeOrthographic:function(t,i,e,n,r,s){var o=this.elements,a=i-t,h=e-n,u=s-r,c=(i+t)/a,l=(e+n)/h,f=(s+r)/u;return o[0]=2/a,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2/h,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2/u,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},clone:function(){return(new M.Matrix4).fromArray(this.elements)}},M.Sphere=function(t,i){this.center=void 0!==t?t:new M.Vector3,this.radius=void 0!==i?i:0},M.Sphere.prototype={constructor:M.Sphere,set:function(t,i){return this.center.copy(t),this.radius=i,this},setFromPoints:(y=new M.Box3,function(t,i){var e=this.center;void 0!==i?e.copy(i):y.setFromPoints(t).center(e);for(var n=0,r=0,s=t.length;r<s;r++)n=Math.max(n,e.distanceToSquared(t[r]));return this.radius=Math.sqrt(n),this}),copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},clampPoint:function(t,i){var e=this.center.distanceToSquared(t),n=i||new M.Vector3;return n.copy(t),e>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){var i=t||new M.Box3;return i.set(this.center,this.center),i.expandByScalar(this.radius),i},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new M.Sphere).copy(this)}},M.Frustum=function(t,i,e,n,r,s){this.planes=[void 0!==t?t:new M.Plane,void 0!==i?i:new M.Plane,void 0!==e?e:new M.Plane,void 0!==n?n:new M.Plane,void 0!==r?r:new M.Plane,void 0!==s?s:new M.Plane]},M.Frustum.prototype={constructor:M.Frustum,set:function(t,i,e,n,r,s){var o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(e),o[3].copy(n),o[4].copy(r),o[5].copy(s),this},copy:function(t){for(var i=this.planes,e=0;e<6;e++)i[e].copy(t.planes[e]);return this},setFromMatrix:function(t){var i=this.planes,e=t.elements,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],m=e[10],y=e[11],p=e[12],x=e[13],d=e[14],v=e[15];return i[0].setComponents(o-n,c-a,y-l,v-p).normalize(),i[1].setComponents(o+n,c+a,y+l,v+p).normalize(),i[2].setComponents(o+r,c+h,y+f,v+x).normalize(),i[3].setComponents(o-r,c-h,y-f,v-x).normalize(),i[4].setComponents(o-s,c-u,y-m,v-d).normalize(),i[5].setComponents(o+s,c+u,y+m,v+d).normalize(),this},intersectsObject:(d=new M.Sphere,function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),d.copy(i.boundingSphere),d.applyMatrix4(t.matrixWorld),this.intersectsSphere(d)}),intersectsSphere:function(t){for(var i=this.planes,e=t.center,n=-t.radius,r=0;r<6;r++)if(i[r].distanceToPoint(e)<n)return!1;return!0},intersectsBox:(p=new M.Vector3,x=new M.Vector3,function(t){for(var i=this.planes,e=0;e<6;e++){var n=i[e];p.x=n.normal.x>0?t.min.x:t.max.x,x.x=n.normal.x>0?t.max.x:t.min.x,p.y=n.normal.y>0?t.min.y:t.max.y,x.y=n.normal.y>0?t.max.y:t.min.y,p.z=n.normal.z>0?t.min.z:t.max.z,x.z=n.normal.z>0?t.max.z:t.min.z;var r=n.distanceToPoint(p),s=n.distanceToPoint(x);if(r<0&&s<0)return!1}return!0}),containsPoint:function(t){for(var i=this.planes,e=0;e<6;e++)if(i[e].distanceToPoint(t)<0)return!1;return!0},clone:function(){return(new M.Frustum).copy(this)}},M.Plane=function(t,i){this.normal=void 0!==t?t:new M.Vector3(1,0,0),this.constant=void 0!==i?i:0},M.Plane.prototype={constructor:M.Plane,set:function(t,i){return this.normal.copy(t),this.constant=i,this},setComponents:function(t,i,e,n){return this.normal.set(t,i,e),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new M.Vector3,i=new M.Vector3;return function(e,n,r){var s=t.subVectors(r,n).cross(i.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}}(),copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,i){return this.orthoPoint(t,i).sub(t).negate()},orthoPoint:function(t,i){var e=this.distanceToPoint(t);return(i||new M.Vector3).copy(this.normal).multiplyScalar(e)},isIntersectionLine:function(t){var i=this.distanceToPoint(t.start),e=this.distanceToPoint(t.end);return i<0&&e>0||e<0&&i>0},intersectLine:function(){var t=new M.Vector3;return function(i,e){var n=e||new M.Vector3,r=i.delta(t),s=this.normal.dot(r);if(0==s)return 0==this.distanceToPoint(i.start)?n.copy(i.start):void 0;var o=-(i.start.dot(this.normal)+this.constant)/s;return o<0||o>1?void 0:n.copy(r).multiplyScalar(o).add(i.start)}}(),coplanarPoint:function(t){return(t||new M.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new M.Vector3,i=new M.Vector3,e=new M.Matrix3;return function(n,r){var s=r||e.getNormalMatrix(n),o=t.copy(this.normal).applyMatrix3(s),a=this.coplanarPoint(i);return a.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(o,a),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant==this.constant},clone:function(){return(new M.Plane).copy(this)}},M.Math={generateUUID:function(){var t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8==r||13==r||18==r||23==r?e[r]="-":14==r?e[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,e[r]=i[19==r?3&t|8:t]);return e.join("")}}(),clamp:function(t,i,e){return t<i?i:t>e?e:t},clampBottom:function(t,i){return t<i?i:t},mapLinear:function(t,i,e,n,r){return n+(t-i)*(r-n)/(e-i)},smoothstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*(3-2*t)},smootherstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*t*(t*(6*t-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,i){return Math.floor(this.randFloat(t,i))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:(b=Math.PI/180,function(t){return t*b}),radToDeg:(v=180/Math.PI,function(t){return t*v}),isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}},(0,e(176).polyfillTHREE)(M)},176:(t,i,e)=>{"use strict";function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function r(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&s(t,i)}function s(t,i){return s=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},s(t,i)}function o(t){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,n=h(t);if(i){var r=h(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return a(this,e)}}function a(t,i){return!i||"object"!==u(i)&&"function"!=typeof i?function(t){if(void 0===t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}(t):i}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}e.r(i),e.d(i,{polyfillTHREE:()=>f});var c=function(t,i,e){"object"!==u(t)&&"function"!=typeof t||Object.prototype.hasOwnProperty.call(t,i)||(t[i]=e)},l=function(t,i,e){"object"===u(t)&&Object.defineProperty(t,i,e)},f=function(t){var i,e,s,a,h,u,f,m,y,p,x,d,v,b,M,w,g,z,_,V,A;c(null==t||null===(i=t.Camera)||void 0===i?void 0:i.prototype,"updateMatrixWorld",(function(i){t.Object3D.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()})),c(null==t||null===(e=t.Box2)||void 0===e?void 0:e.prototype,"getSize",(function(t){return this.size(t)})),c(null==t||null===(s=t.Box3)||void 0===s?void 0:s.prototype,"getSize",(function(t){return this.size(t)})),c(null==t||null===(a=t.Box2)||void 0===a?void 0:a.prototype,"intersectsBox",(function(t){return this.isIntersectionBox(t)})),c(null==t||null===(h=t.Box3)||void 0===h?void 0:h.prototype,"intersectsBox",(function(t){return this.isIntersectionBox(t)})),c(null==t||null===(u=t.Ray)||void 0===u?void 0:u.prototype,"intersectsBox",(function(t){return this.isIntersectionBox(t)})),l(null==t||null===(f=t.BufferAttribute)||void 0===f?void 0:f.prototype,"normalized",{get:function(){return this.normalize},set:function(t){this.normalize=t}}),"function"==typeof(null==t?void 0:t.BufferAttribute)&&(c(t,"Float32BufferAttribute",function(t){r(e,t);var i=o(e);function e(t,r,s){return n(this,e),i.call(this,new Float32Array(t),r,s)}return e}(t.BufferAttribute)),c(t,"Uint16BufferAttribute",function(t){r(e,t);var i=o(e);function e(t,r,s){return n(this,e),i.call(this,new Uint16Array(t),r,s)}return e}(t.BufferAttribute)),c(t,"Uint32BufferAttribute",function(t){r(e,t);var i=o(e);function e(t,r,s){return n(this,e),i.call(this,new Uint32Array(t),r,s)}return e}(t.BufferAttribute))),c(null==t||null===(m=t.BufferGeometry)||void 0===m?void 0:m.prototype,"applyMatrix4",(function(t){return this.applyMatrix(t)})),l(null==t||null===(y=t.BufferGeometry)||void 0===y?void 0:y.prototype,"groups",{get:function(){return this.offsets},set:function(t){this.offsets=t,this.drawcalls=t}}),l(null==t||null===(p=t.BufferGeometry)||void 0===p?void 0:p.prototype,"index",{get:function(){return this.attributes.index},set:function(t){this.attributes.index=t}}),c(null==t||null===(x=t.BufferGeometry)||void 0===x?void 0:x.prototype,"setFromPoints",(function(i){for(var e=[],n=0,r=i.length;n<r;n++){var s=i[n];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new t.Float32BufferAttribute(e,3)),this})),c(null==t||null===(d=t.BufferGeometry)||void 0===d?void 0:d.prototype,"setIndex",(function(i){return Array.isArray(i)?this.index=new(function(t){if(0===t.length)return-1/0;for(var i=t[0],e=1,n=t.length;e<n;++e)t[e]>i&&(i=t[e]);return i}(i)>65535?t.Uint32BufferAttribute:t.Uint16BufferAttribute)(i,1):this.index=i,this})),"function"==typeof(null==t?void 0:t.BufferAttribute)&&c(t,"CircleBufferGeometry",function(i){r(s,i);var e=o(s);function s(){var i,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;n(this,s),(i=e.call(this)).type="CircleGeometry",i.parameters={radius:r,segments:o,thetaStart:a,thetaLength:h},o=Math.max(3,o);var u=[],c=[],l=[],f=[],m=new t.Vector3,y=new t.Vector2;c.push(0,0,0),l.push(0,0,1),f.push(.5,.5);for(var p=0,x=3;p<=o;p++,x+=3){var d=a+p/o*h;m.x=r*Math.cos(d),m.y=r*Math.sin(d),c.push(m.x,m.y,m.z),l.push(0,0,1),y.x=(c[x]/r+1)/2,y.y=(c[x+1]/r+1)/2,f.push(y.x,y.y)}for(var v=1;v<=o;v++)u.push(v,v+1,0);return i.setIndex(u),i.setAttribute("position",new t.Float32BufferAttribute(c,3)),i.setAttribute("normal",new t.Float32BufferAttribute(l,3)),i.setAttribute("uv",new t.Float32BufferAttribute(f,2)),i}return s}(t.BufferGeometry)),c(null==t||null===(v=t.Frustum)||void 0===v?void 0:v.prototype,"setFromProjectionMatrix",(function(t){return this.setFromMatrix(t)})),c(null==t||null===(b=t.Geometry)||void 0===b?void 0:b.prototype,"applyMatrix4",(function(t){return this.applyMatrix(t)})),c(t,"Interpolant",(function(){})),c(null==t||null===(M=t.Matrix3)||void 0===M?void 0:M.prototype,"invert",(function(){var t=this.elements,i=t[0],e=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],u=t[8],c=u*s-o*h,l=o*a-u*r,f=h*r-s*a,m=i*c+e*l+n*f;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);var y=1/m;return t[0]=c*y,t[1]=(n*h-u*e)*y,t[2]=(o*e-n*s)*y,t[3]=l*y,t[4]=(u*i-n*a)*y,t[5]=(n*r-o*i)*y,t[6]=f*y,t[7]=(e*a-h*i)*y,t[8]=(s*i-e*r)*y,this})),c(null==t||null===(w=t.Matrix4)||void 0===w?void 0:w.prototype,"invert",(function(){var t=this.elements,i=t[0],e=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],u=t[8],c=t[9],l=t[10],f=t[11],m=t[12],y=t[13],p=t[14],x=t[15],d=c*p*h-y*l*h+y*a*f-o*p*f-c*a*x+o*l*x,v=m*l*h-u*p*h-m*a*f+s*p*f+u*a*x-s*l*x,b=u*y*h-m*c*h+m*o*f-s*y*f-u*o*x+s*c*x,M=m*c*a-u*y*a-m*o*l+s*y*l+u*o*p-s*c*p,w=i*d+e*v+n*b+r*M;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var g=1/w;return t[0]=d*g,t[1]=(y*l*r-c*p*r-y*n*f+e*p*f+c*n*x-e*l*x)*g,t[2]=(o*p*r-y*a*r+y*n*h-e*p*h-o*n*x+e*a*x)*g,t[3]=(c*a*r-o*l*r-c*n*h+e*l*h+o*n*f-e*a*f)*g,t[4]=v*g,t[5]=(u*p*r-m*l*r+m*n*f-i*p*f-u*n*x+i*l*x)*g,t[6]=(m*a*r-s*p*r-m*n*h+i*p*h+s*n*x-i*a*x)*g,t[7]=(s*l*r-u*a*r+u*n*h-i*l*h-s*n*f+i*a*f)*g,t[8]=b*g,t[9]=(m*c*r-u*y*r-m*e*f+i*y*f+u*e*x-i*c*x)*g,t[10]=(s*y*r-m*o*r+m*e*h-i*y*h-s*e*x+i*o*x)*g,t[11]=(u*o*r-s*c*r-u*e*h+i*c*h+s*e*f-i*o*f)*g,t[12]=M*g,t[13]=(u*y*n-m*c*n+m*e*l-i*y*l-u*e*p+i*c*p)*g,t[14]=(m*o*n-s*y*n-m*e*a+i*y*a+s*e*p-i*o*p)*g,t[15]=(s*c*n-u*o*n+u*e*a-i*c*a-s*e*l+i*o*l)*g,this})),c(t,"MeshStandardMaterial",t.MeshBasicMaterial),c(null==t||null===(g=t.Object3D)||void 0===g?void 0:g.prototype,"applyMatrix4",(function(t){return this.applyMatrix(t)})),c(t,"PointsMaterial",t.PointCloudMaterial),c(null==t?void 0:t.Triangle,"getNormal",(function(t,i,e,n){return this.normal(t,i,e,n)})),c(null==t||null===(z=t.Vector2)||void 0===z?void 0:z.prototype,"fromBufferAttribute",(function(t,i,e){return this.fromAttribute(t,i,e)})),c(null==t||null===(_=t.Vector3)||void 0===_?void 0:_.prototype,"fromBufferAttribute",(function(t,i,e){return this.fromAttribute(t,i,e)})),c(null==t||null===(V=t.Vector4)||void 0===V?void 0:V.prototype,"fromBufferAttribute",(function(t,i,e){return this.fromAttribute(t,i,e)})),c(t,"WebGLProperties",(function(){return{get:function(){return{}}}})),c(t,"WebGLAnimation",(function(){return{setAnimationLoop:function(){},setContext:function(){},start:function(){},stop:function(){}}})),c(t,"WebXRManager",(function(){return{isPresenting:!1,enabled:!1,setAnimationLoop:function(){},addEventListener:function(){}}})),l(null==t||null===(A=t.WebGLRenderTarget)||void 0===A?void 0:A.prototype,"texture",{get:function(){return this}})}}},i={};function e(n){var r=i[n];if(void 0!==r)return r.exports;var s=i[n]={id:n,loaded:!1,exports:{}};return t[n](s,s.exports,e),s.loaded=!0,s.exports}e.d=(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},e.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t=e(924),i=2*Math.PI;function n(t){var i,e,n=this;this.vb=t.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.ib=t.ib,this.stride=t.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=t.numInstances>0,this.useCompactBuffers=t.unpackXform,this.texData=this.useCompactBuffers&&(null===(i=t.tIdColor)||void 0===i||null===(e=i.image)||void 0===e?void 0:e.data)&&new Uint32Array(t.tIdColor.image.data.buffer),this.isInterleavedVb=function(){var i=t.attributes;if(!i)return!1;var e=i.layerVp4b,r=i.flags4b;if(n.useCompactBuffers)return i.uvIdColor&&e&&r;var s=i.color4b,o=i.dbId4b;return s&&o&&e&&r}()}function r(i){this.bounds=i,this.point=new t.Vector4,this.point.z=0,this.point.w=1}n.prototype.getDbIdAt=function(t){return this.texData?this.texData[this.vbs[t*this.stride*2+7]]:this.vbi[t*this.stride+7]},n.prototype.getColorAt=function(t){return this.texData?this.texData[this.vbs[t*this.stride*2+6]]:this.vbi[t*this.stride+6]},n.prototype.getVertexFlagsAt=function(t){return this.texData?this.vbi[t*this.stride+4]:this.vbi[t*this.stride+8]},n.prototype.getLayerIndexAt=function(t){return this.texData?65535&this.vbi[t*this.stride+5]:65535&this.vbi[t*this.stride+9]},n.prototype.getViewportIndexAt=function(t){return this.texData?this.vbi[t*this.stride+5]>>16&65535:this.vbi[t*this.stride+9]>>16&65535},n.prototype.decodeLineAt=function(t,e,n,r){if(r.onLineSegment){if(this.useCompactBuffers)var s=this.stride*t*2,o=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w,h=this.vbs[s+2]/65535*i-Math.PI,u=this.vbs[s+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),c=this.vbs[s+4]/32767*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y)*2;else{var l=this.stride*t;o=this.vbf[l],a=this.vbf[l+1],h=this.vbf[l+2]*i-Math.PI,u=this.vbf[l+3],c=2*this.vbf[l+4]}var f=o+u*Math.cos(h),m=a+u*Math.sin(h);r.onLineSegment(o,a,f,m,n,c)}},n.prototype.decodeCircularArcAt=function(t,e,n,r){if(r.onCircularArc){if(this.useCompactBuffers)var s=this.stride*t*2,o=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w,h=this.vbs[s+2]/65535*i,u=this.vbs[s+3]/65535*i,c=this.vbs[s+5]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var l=this.stride*t;o=this.vbf[l],a=this.vbf[l+1],h=this.vbf[l+2]*i,u=this.vbf[l+3]*i,c=this.vbf[l+5]}r.onCircularArc(o,a,h,u,c,n)}},n.prototype.decodeEllipticalArcAt=function(t,e,n,r){if(r.onEllipticalArc){var s=this.stride*t,o=this.vbf[s],a=this.vbf[s+1],h=this.vbf[s+2]*i,u=this.vbf[s+3]*i,c=this.vbf[s+5],l=this.vbf[s+10],f=this.vbf[s+11];r.onEllipticalArc(o,a,h,u,c,l,f,n)}},n.prototype.decodeTexQuadAt=function(t,e,n,r){if(r.onTexQuad){if(this.useCompactBuffers)var s=this.stride*t*2,o=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w,h=this.vbs[s+2]/65535*i,u=this.vbs[s+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),c=this.vbs[s+4]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var l=this.stride*t;o=this.vbf[l],a=this.vbf[l+1],h=this.vbf[l+2]*i,u=this.vbf[l+3],c=this.vbf[l+4]}r.onTexQuad(o,a,u,c,h,n)}},n.prototype.decodeOneTriangleAt=function(t,i,e,n){if(n.onOneTriangle){if(this.useCompactBuffers)var r=this.stride*t*2,s=this.useCompactBuffers.x*this.vbs[r]/65535+this.useCompactBuffers.z,o=this.useCompactBuffers.y*this.vbs[r+1]/65535+this.useCompactBuffers.w,a=this.useCompactBuffers.x*this.vbs[r+2]/65535+this.useCompactBuffers.z,h=this.useCompactBuffers.y*this.vbs[r+3]/65535+this.useCompactBuffers.w,u=this.useCompactBuffers.x*this.vbs[r+4]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[r+5]/65535+this.useCompactBuffers.w;else{var l=this.stride*t;s=this.vbf[l],o=this.vbf[l+1],a=this.vbf[l+2],h=this.vbf[l+3],u=this.vbf[l+4],c=this.vbf[l+5]}n.onOneTriangle(s,o,a,h,u,c,e)}},n.prototype.decodeTriangleIndexed=function(t,i,e,n,r,s){if(s.onOneTriangle){if(this.useCompactBuffers){var o=this.stride*t*2,a=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,h=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w;o=this.stride*i*2;var u=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w;o=this.stride*e*2;var l=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,f=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w}else{var m=this.stride*t;a=this.vbf[m],h=this.vbf[m+1],m=this.stride*i,u=this.vbf[m],c=this.vbf[m+1],m=this.stride*e,l=this.vbf[m],f=this.vbf[m+1]}s.onOneTriangle(a,h,u,c,l,f,r)}},n.prototype.enumGeomsForObject=function(t,i){if(this.useInstancing)for(var e=0;e<this.vcount;){var n=this.getVertexFlagsAt(e)>>8&255,r=this.getLayerIndexAt(e),s=this.getViewportIndexAt(e);if(a=this.getDbIdAt(e)===t)switch(n){case 1:this.decodeLineAt(e,r,s,i);break;case 2:this.decodeCircularArcAt(e,r,s,i);break;case 3:this.decodeEllipticalArcAt(e,r,s,i);break;case 4:this.decodeTexQuadAt(e,r,s,i);break;case 5:this.decodeOneTriangleAt(e,r,s,i)}e+=1}else for(e=0;e<this.ib.length;){var o=this.ib[e],a=(n=this.getVertexFlagsAt(o)>>8&255,r=this.getLayerIndexAt(o),s=this.getViewportIndexAt(o),this.getDbIdAt(o)===t);if(0===n)a&&this.decodeTriangleIndexed(this.ib[e],this.ib[e+1],this.ib[e+2],r,s,i),e+=3;else{if(a)switch(n){case 1:this.decodeLineAt(o,r,s,i);break;case 2:this.decodeCircularArcAt(o,r,s,i);break;case 3:this.decodeEllipticalArcAt(o,r,s,i);break;case 4:this.decodeTexQuadAt(o,r,s,i);break;case 5:this.decodeOneTriangleAt(o,r,s,i)}e+=6}}},n.prototype.enumGeomsForVisibleLayer=function(t,i){this.enumGeoms((function(i,e,n){return!t||0!==e&&-1!==t.indexOf(e)}),i)},n.prototype.enumGeoms=function(t,i){if(this.useInstancing)for(var e=0;e<this.vcount;){var n=this.getVertexFlagsAt(e)>>8&255,r=this.getLayerIndexAt(e),s=this.getViewportIndexAt(e),o=this.getDbIdAt(e);if(h=!t||t(o,r,s))switch(n){case 1:this.decodeLineAt(e,r,s,i);break;case 2:this.decodeCircularArcAt(e,r,s,i);break;case 3:this.decodeEllipticalArcAt(e,r,s,i);break;case 4:this.decodeTexQuadAt(e,r,s,i);break;case 5:this.decodeOneTriangleAt(e,r,s,i)}e+=1}else for(e=0;e<this.ib.length;){var a=this.ib[e],h=(n=this.getVertexFlagsAt(a)>>8&255,r=this.getLayerIndexAt(a),s=this.getViewportIndexAt(a),o=this.getDbIdAt(a),!t||t(o,r,s));if(0===n)h&&this.decodeTriangleIndexed(this.ib[e],this.ib[e+1],this.ib[e+2],r,s,i),e+=3;else{if(h)switch(n){case 1:this.decodeLineAt(a,r,s,i);break;case 2:this.decodeCircularArcAt(a,r,s,i);break;case 3:this.decodeEllipticalArcAt(a,r,s,i);break;case 4:this.decodeTexQuadAt(a,r,s,i);break;case 5:this.decodeOneTriangleAt(a,r,s,i)}e+=6}}},r.prototype.onVertex=function(t,i,e){this.point.x=t,this.point.y=i,this.bounds.expandByPoint(this.point)},r.prototype.onLineSegment=function(t,i,e,n,r){this.onVertex(t,i),this.onVertex(e,n)},r.prototype.onCircularArc=function(t,i,e,n,r,s){this.onEllipticalArc(t,i,e,n,r,r,0,s)},r.prototype.onEllipticalArc=function(t,i,e,n,r,s,o,a){0==o?e<=0&&n>=2*Math.PI-1e-5?this.onTexQuad(t,i,2*r,2*s,o,a):(this.point.x=t+Math.cos(e)*r,this.point.y=i+Math.sin(e)*s,this.bounds.expandByPoint(this.point),this.point.x=t+Math.cos(n)*r,this.point.y=i+Math.sin(n)*s,this.bounds.expandByPoint(this.point),e>n&&(this.point.x=t+r,this.point.y=i,this.bounds.expandByPoint(this.point),e-=2*Math.PI),e<.5*Math.PI&&n>.5*Math.PI&&(this.point.x=t,this.point.y=i+s,this.bounds.expandByPoint(this.point)),e<Math.PI&&n>Math.PI&&(this.point.x=t-r,this.point.y=i,this.bounds.expandByPoint(this.point)),e<1.5*Math.PI&&n>1.5*Math.PI&&(this.point.x=t,this.point.y=i-s,this.bounds.expandByPoint(this.point))):this.onTexQuad(t,i,2*r,2*s,o,a)},r.prototype.onTexQuad=function(i,e,n,r,s,o){var a=.5*n,h=.5*n;if(0==s)this.onVertex(i-a,e-h),this.onVertex(i+a,e+h);else{var u=new t.Matrix4,c=new t.Matrix4;u.makeRotationZ(s),c.makeTranslation(i,e,0),c.multiply(u);for(var l=0;l<4;l++)this.point.x=l%2==1?a:-a,this.point.y=l>=2?h:-h,this.point.applyMatrix4(c),this.bounds.expandByPoint(this.point)}},r.prototype.onOneTriangle=function(t,i,e,n,r,s,o){this.onVertex(t,i),this.onVertex(e,n),this.onVertex(r,s)};var s=45e3,o=new Float64Array(s),a=0,h=0,u=0,c={onLineSegment:1,onCircularArc:2,onEllipticalArc:3,finished:9};function l(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];o[u++]=c[t];for(var e=0;e<8;e++)o[u++]=e<i.length?i[e]:0;(u>=45e3||a===h)&&(postMessage(o,[o.buffer]),o=new Float64Array(s),u=0)}onmessage=function(t){if(t.data.hasOwnProperty("totalGeoms"))return h=t.data.totalGeoms,o=new Float64Array(s),a=0,void(u=0);for(var i=0;i<t.data.length;i++){var e={onLineSegment:function(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];return l("onLineSegment",i)},onCircularArc:function(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];return l("onCircularArc",i)},onEllipticalArc:function(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];return l("onEllipticalArc",i)}};new n(t.data[i]).enumGeoms(null,e),a++}l("finished")}})()})();\n//# sourceMappingURL=22a2550ef316957f9288.worker.js.map',r.p+"22a2550ef316957f9288.worker.js")}},69855:e=>{"use strict";var t=window.URL||window.webkitURL;e.exports=function(e,r){try{try{var i;try{(i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),i=i.getBlob()}catch(t){i=new Blob([e])}return new Worker(t.createObjectURL(i))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!r)throw Error("Inline worker is not supported");return new Worker(r)}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e+"../"})();var __webpack_exports__=__webpack_require__(68312);Autodesk.Extensions.Edit2D=__webpack_exports__})();
//# sourceMappingURL=Edit2D.min.js.map