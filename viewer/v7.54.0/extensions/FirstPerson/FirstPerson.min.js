/*! For license information please see FirstPerson.min.js.LICENSE.txt */
(()=>{var e={d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";function a(e){var t,a,o,n,i,s,r,l,u,c,T=Autodesk.Viewing.Private,d=e.navigation,g=e.container,h=d.getCamera(),p=1,v=.1,A=6,f={},E=new THREE.Clock(!0),R={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},S={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},m=function(){},b={};for(var O in S)Object.prototype.hasOwnProperty.call(S,O)&&(b[S[O]]=m);this.activate=function(a){var o=e.model.getBoundingBox().getSize(new THREE.Vector3);p=Math.max(Math.min(Math.min(o.x,o.y),o.z)/10,1e-4),t=navigator.getGamepads()[0],n=new Autodesk.Viewing.Private.ViewerState(e),i=[],s=0,c=a,H(a)},this.deactivate=function(){c=null,n=null},this.update=function(e,n){if(n&&(h=n),e=E.getDelta(),t=navigator.getGamepads()[0],a>-1&&(new Date).getTime()-a>o&&P(),t&&(l=2*e*p*A,h.isPerspective||d.toPerspective(),t&&function(){for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e)&&t.buttons[e].pressed&&.5!=t.buttons[e].value)return f[e]=!0,!0;for(var a in f)if(Object.prototype.hasOwnProperty.call(f,a)&&f[a])return!0;return!(Math.abs(t.axes[0])<v&&Math.abs(t.axes[1])<v&&Math.abs(t.axes[2])<v&&Math.abs(t.axes[3])<v)}())){h.dirty=!0,r&&(u=h.position.z);var i=h.target.clone().sub(h.position),s=i.length();i.multiplyScalar(1/s);var c=i.clone().cross(h.up).normalize();if(Math.abs(t.axes[1])>v){var T=i.clone().multiplyScalar(-t.axes[1]*l);h.position.add(T),h.target.add(T)}if(Math.abs(t.axes[0])>v){var g=c.clone().multiplyScalar(t.axes[0]*l);h.position.add(g),h.target.add(g)}var R=new THREE.Quaternion,m=i;if(Math.abs(t.axes[3])>v){var O=h.clone(),H=i.clone();R.setFromAxisAngle(c,-t.axes[3]*l/2),H.applyQuaternion(R),O.up.applyQuaternion(R);var I=O.worldup.clone(),k=H.angleTo(I),D=THREE.Math.degToRad(5);k>=D&&k<=Math.PI-D&&(m=i.clone().applyQuaternion(R),h.up.applyQuaternion(R))}var G=new THREE.Quaternion;Math.abs(t.axes[2])>v&&(G.setFromAxisAngle(h.worldup,-t.axes[2]*l/2),m.applyQuaternion(G),h.up.applyQuaternion(G)),function(){for(var e in S)Object.prototype.hasOwnProperty.call(S,e)&&w(S[e])}(),r&&(h.position.z=u),m.multiplyScalar(s),h.target.copy(h.position).add(m)}return h};var P=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),a=-1};function w(e){if(t.buttons[e].value>v)switch(f[e]=!0,e){case S.LEFT_SHOULDER:case S.RIGHT_SHOULDER:b[e]();break;case S.LEFT_TRIGGER:b[e](t.buttons[S.LEFT_TRIGGER].value);break;case S.RIGHT_TRIGGER:b[e](t.buttons[S.RIGHT_TRIGGER].value)}else if(f[e])switch(f[e]=!1,e){case S.SOUTH_BTN:case S.EAST_BTN:case S.WEST_BTN:case S.NORTH_BTN:case S.NORTH_DPAD:case S.SOUTH_DPAD:case S.WEST_DPAD:case S.EAST_DPAD:case S.RIGHT_STICK_BUTTON:case S.LEFT_STICK_BUTTON:b[e]();break;case S.LEFT_TRIGGER:b[e](t.buttons[S.LEFT_TRIGGER].value);break;case S.RIGHT_TRIGGER:b[e](t.buttons[S.RIGHT_TRIGGER].value)}}var H=function(e){"headtracker"===e?(b[S.SOUTH_BTN]=V,b[S.SOUTH_DPAD]=I,b[S.NORTH_DPAD]=x,b[S.WEST_BTN]=B,b[S.LEFT_SHOULDER]=k,b[S.RIGHT_SHOULDER]=D,b[S.LEFT_TRIGGER]=G,b[S.RIGHT_TRIGGER]=C,b[S.RIGHT_STICK_BUTTON]=F,b[S.LEFT_STICK_BUTTON]=L):(b[S.SOUTH_BTN]=V,b[S.EAST_BTN]=_,b[S.WEST_BTN]=B,b[S.NORTH_BTN]=M,b[S.SOUTH_DPAD]=I,b[S.WEST_DPAD]=N,b[S.EAST_DPAD]=U,b[S.NORTH_DPAD]=x,b[S.LEFT_SHOULDER]=k,b[S.RIGHT_SHOULDER]=D,b[S.LEFT_TRIGGER]=y,b[S.RIGHT_TRIGGER]=C,b[S.RIGHT_STICK_BUTTON]=F,b[S.LEFT_STICK_BUTTON]=L)},I=function(){e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},k=function(){r?u+=-t.buttons[S.LEFT_SHOULDER].pressed*l:h.translateY(-t.buttons[S.LEFT_SHOULDER].pressed*l)},D=function(){r?u+=t.buttons[S.RIGHT_SHOULDER].pressed*l:h.translateY(t.buttons[S.RIGHT_SHOULDER].pressed*l)},G=function(t){if(t>v){if(.5==t)return void e.explode(0);var a=t;a>1&&(a=1),a<0&&(a=0),e.explode(a)}else e.explode(0)},y=function(e){if(e>v){if(.5==e)return h.fov=75,void(f[S.LEFT_TRIGGER]=!1);h.fov=-45*e+75}else h.fov=75},C=function(e){if(e>v){if(.5==e)return void(f[S.RIGHT_TRIGGER]=!1);A=-5.5*e+6}else A=6},_=function(){var e=n.getState(R);i.push(e),T.logger.log("Savepoint created.")},N=function(){i.length&&(--s<0&&(s=i.length-1),n.restoreState(i[s]))},U=function(){i.length&&(++s>=i.length&&(s=0),n.restoreState(i[s]))},V=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==c&&h.updateMatrixWorld(),t?e.impl.selector.toggleSelection(t.dbId,t.model):e.impl.selector.clearSelection()},F=function(){e.impl.selector.clearSelection()},L=function(){e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},B=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);t&&(t.dbId in e.getHiddenNodes()?e.show(t.dbId):e.hide(t.dbId))},M=function(){e.getPropertyPanel(!0).setVisible(!e.getPropertyPanel(!0).isVisible())},x=function(){var e,t,n;(r=!r)&&(u=h.position.z),e="up",P(),"up"===e&&(t=r?"Vertical Lock Mode":"Fly mode"),n={msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:t},Autodesk.Viewing.Private.HudMessage.displayMessage(g,n,void 0,void 0,void 0),a=(new Date).getTime(),o=2e3}}function o(e){var t=Autodesk.Viewing.Private,o=-1!=navigator.userAgent.search("Mac OS"),n=e.navigation,i=e.container,s=n.getCamera(),r=["firstperson"];this.setGlobalManager(e.globalManager);var l,u={SHIFT:0,ALT:0,CONTROL:0},c=Autodesk.Viewing.KeyCode,T=!1,d=!0,g=!1,h=null,p=new THREE.Clock(!0),v=-1,A=5e3,f=1,E=2,R=.0035,S=0,m=-1e20,b=-1e20,O=0,P=0,w=!1,H=!1,I=!1,k=!1,D=!1,G=!1,y=(s.fov,s.isPerspective,!1);(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(l=new a(e));var C=!1;this.isActive=function(){return T},this.getNames=function(){return r},this.getName=function(){return r[0]},this.activate=function(){p.start(),s.isPerspective,n.toPerspective(),s.fov,n.setVerticalFov(75,!0);var t=e.model.getBoundingBox().getSize(new THREE.Vector3);f=Math.max(Math.min(Math.min(t.x,t.y),t.z)/10,1e-4),e.canvas.focus(),T=!0,e.getFirstPersonToolPopup()&&!y&&F(),this.addCrosshair(),e.impl.pauseHighlight(!0),l&&l.activate(this.getName())},this.deactivate=function(){T=!1,p.stop(),U(),this.removeCrosshair(),e.impl.pauseHighlight(!1),l&&l.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(e){0===e?E=2:(E*=e>0?1.1:.9)<.01&&(E=.01)},this.handleGesture=function(e){switch(e.pointers&&e.pointers.length>0&&(e.pageX=e.pointers[0].pageX,e.pageY=e.pointers[0].pageY),e.type){case"dragstart":return h="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===h&&this.handleMouseMove(e);case"dragend":return"drag"===h&&(this.handleButtonUp(e,0),h=null,!0)}return!1},this.handleSingleClick=function(){return!1},this.handleButtonDown=function(e,t){U();var a=function(e){if(h)return!1;var t=e.ctrlKey||o&&e.metaKey,a=e.metaKey&&!o;return t||a||e.shiftKey||e.altKey}(e);return 0!==t||a||(m=e.pageX,b=e.pageY,O=P=0,g=!0),!0},this.handleMouseMove=function(e){var t=m<-1e10?0:e.pageX-m,a=b<-1e10?0:e.pageY-b;return m=e.pageX,b=e.pageY,g===d&&(O+=t*R,P+=a*R),!0},this.handleButtonUp=function(e,t){return 0!==t||!g||(O=P=0,g=!1,!0)},this.handleKeyDown=function(e,t){U();var a=!1;switch(t){case c.ESCAPE:break;case c.TAB:a=!1;break;case c.SHIFT:u.SHIFT=1,a=!0;break;case c.CONTROL:u.CONTROL=1,a=!0;break;case c.ALT:u.ALT=1,a=!0;break;case c.SPACE:u.SPACE=1,a=!0;break;case c.EQUALS:this.adjustSpeed(1),a=!0;break;case c.DASH:this.adjustSpeed(-1),a=!0;break;case c.ZERO:this.adjustSpeed(0),a=!0;break;case c.UP:case c.w:w=!0,a=!0;break;case c.LEFT:case c.a:I=!0,a=!0;break;case c.DOWN:case c.s:H=!0,a=!0;break;case c.RIGHT:case c.d:k=!0,a=!0;break;case c.q:D=!0,a=!0;break;case c.e:G=!0,a=!0;break;case c.g:case c.F1:a=!0}return a},this.handleKeyUp=function(e,t){var a=!1;switch(t){case c.TAB:a=!1;break;case c.SHIFT:u.SHIFT=0,a=!0;break;case c.CONTROL:u.CONTROL=0,a=!0;break;case c.ALT:u.ALT=0,a=!0;break;case c.SPACE:u.SPACE=0,a=!0;break;case c.UP:case c.w:w=!1,a=!0,_();break;case c.LEFT:case c.a:I=!1,a=!0,_();break;case c.DOWN:case c.s:H=!1,a=!0,_();break;case c.RIGHT:case c.d:k=!1,a=!0,_();break;case c.q:D=!1,a=!0,_();break;case c.e:G=!1,a=!0,_();break;case c.g:V(d=!d),a=!0;break;case c.F1:F(),a=!0}return a},this.handleWheelInput=function(e){return n.getReverseZoomDirection()&&(e*=-1),S+=e,!0},this.handleSingleClick=function(){return!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(){return!1},this.handleBlur=function(){return w=H=!1,I=k=!1,D=G=!1,!1},this.update=function(){if(!T||!n.isActionEnabled("walk"))return!1;var e=p.getDelta();v>-1&&(new Date).getTime()-v>A&&U(),s.isPerspective||(console.log("Lost perspective mode: resetting view."),n.toPerspective());var t=s.clone(),a=e*E*f*(1===u.SHIFT?4:1),o=.5*e*f*(1===u.SHIFT?4:1);if(0!=S){var i=1*S*f*(1===u.SHIFT?4:1);t.translateZ(-i),S=0}w&&t.translateZ(-a),H&&t.translateZ(a),I&&t.translateX(-a),k&&t.translateX(a),D&&t.translateY(o),G&&t.translateY(-o);var r=t.position,c=0!==r.distanceToSquared(s.position),d=t.target,g=s.target.clone().sub(s.position),h=g.clone().cross(s.up).normalize();if(0!=P){var R=new THREE.Quaternion;R.setFromAxisAngle(h,-P);var m=g.clone();m.applyQuaternion(R);var b=s.worldup.clone(),y=m.angleTo(b),C=THREE.Math.degToRad(5);y>=C&&y<=Math.PI-C&&(g.applyQuaternion(R),t.up.applyQuaternion(R)),P=0}if(0!=O){var _=new THREE.Quaternion;_.setFromAxisAngle(s.worldup,-O),g.applyQuaternion(_),t.up.applyQuaternion(_),O=0}var N=0!==(d=r.clone().add(g)).distanceToSquared(s.target);return(c||N)&&(n.setView(r,d),n.orientCameraUp()),l&&(s=l.update(s)),s.dirty};var _=function(){C||(t.logger.track({category:"tool_used",name:"FirstPerson_tool"}),C=!0)},N=function(e,t,a,o,n){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(i,e,a,o,n),t>0?(v=(new Date).getTime(),A=t):(v=-1,A=0))},U=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),v=-1},V=function(e){U();var t=e?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation";N({msgTitleKey:"First Person Tool",messageKey:t,messageDefaultValue:t},0,(function(){}))},F=function(){U(),N({msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",buttonText:"Ok Got It"},0,(function(){}),(function(){y=!0,e.setFirstPersonToolPopup(!1),U()}))};this.addCrosshair=function(){t.stringToDOM&&(this.crosshair=t.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),e.canvasWrap.appendChild(this.crosshair))},this.removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}function n(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.name="firstperson"}e.r(t),e.d(t,{FirstPersonExtension:()=>n}),Autodesk.Viewing.GlobalManagerMixin.call(o.prototype),n.prototype=Object.create(Autodesk.Viewing.Extension.prototype),n.prototype.constructor=n;var i=n.prototype;i.load=function(){var e=this,t=this.viewer,a=Autodesk.Viewing.UI;return this.tool=new o(t),t.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(t){if(-1!==t.toolName.indexOf("firstperson")&&e.firstPersonToolButton){var o=t.active?a.Button.State.ACTIVE:a.Button.State.INACTIVE;e.firstPersonToolButton.setState(o)}},t.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},i.createUI=function(){var e=this.viewer;if(e.getToolbar){var t=this,a=Autodesk.Viewing.UI,o=e.getToolbar().getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new a.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(){t.activeStatus?t.deactivate():t.activate()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var n=o.getControl("toolbar-cameraSubmenuTool");n?o.addControl(this.firstPersonToolButton,{index:o.indexOf(n.getId())}):o.addControl(this.firstPersonToolButton)}},i.unload=function(){var e=this.viewer;return e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,e.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton&&(e.getToolbar()&&this.firstPersonToolButton.removeFromParent(),this.firstPersonToolButton=null),e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},i.activate=function(){return this.activeStatus||(this.viewer.setActiveNavigationTool("firstperson"),this.activeStatus=!0),!0},i.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",n)})(),Autodesk.Extensions.FirstPerson=t})();
//# sourceMappingURL=FirstPerson.min.js.map