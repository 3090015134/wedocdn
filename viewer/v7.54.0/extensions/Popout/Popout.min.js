/*! For license information please see Popout.min.js.LICENSE.txt */
(()=>{var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e.r(t),e.d(t,{default:()=>_});var l=Autodesk.Viewing.getGlobal();var s={id:"__$$VIEWER_POPOUT_COMPONENT$$__",set:function(e,t){l[this.id]=l[this.id]||{},l[this.id][e]=t},get:function(e){return l[this.id]&&l[this.id][e]}},c={},a={};function u(e){return e&&!e.closed}s.set("startMonitor",(function(e){a[e]=setTimeout((function t(){c[e]&&c[e].props.onClose&&(!c[e].child||c[e].child.closed?(function(e){a[e]&&(clearTimeout(a[e]),delete a[e])}(e),c[e].props.onClose(),c[e].child=null):a[e]=setTimeout(t,250))}),250)})),s.set("dispose",(function(e){delete c[e]}));var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=null,this.setupAttempts=0,this.styleElement=null,this.child=null,this.props=t,this.styleCount=0}var t,o;return t=e,(o=[{key:"setupOnCloseHandler",value:function(e,t){var n,o=this;if(!(this.setupAttempts>=5))if(t&&t.document&&t.document.head){var i=t.document.createElement("script"),r="\n            window.onbeforeunload = function(e) {\n                var result = window.opener.".concat(s.id,".onBeforeUnload.call(window, '").concat(e,"', e);\n\n                if (result) {\n                    window.opener.").concat(s.id,".startMonitor.call(window.opener, '").concat(e,"');\n\n                    e.returnValue = result;\n                    return result;\n                } else {\n                    window.opener.").concat(s.id,".onChildClose.call(window.opener, '").concat(e,"');\n                }\n\n                // Added by LMV - free memory\n                window.opener.").concat(s.id,".dispose.call(window.opener, '").concat(e,"');\n            }");i.innerHTML="\n            window.onload = function(e) {\n                ".concat(r,"\n            };\n            "),n="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",(/Edge/.test(n)||/Trident/.test(n)||!this.props.url)&&(i.innerHTML=r),t.document.head.appendChild(i),this.setupCleanupCallbacks()}else this.setupAttempts++,setTimeout((function(){return o.setupOnCloseHandler(e,t)}),50)}},{key:"setupCleanupCallbacks",value:function(){var e=this;window.addEventListener("unload",(function(t){return e.closeChildWindowIfOpened()})),s.set("onChildClose",(function(e){c[e]&&c[e].props.onClose&&c[e].props.onClose()})),s.set("onBeforeUnload",(function(e,t){if(c[e]&&c[e].props.onBeforeUnload)return c[e].props.onBeforeUnload(t)}))}},{key:"setupStyleElement",value:function(e){this.styleElement=e.document.createElement("style"),this.styleElement.setAttribute("data-this-styles","true"),this.styleElement.type="text/css",e.document.head.appendChild(this.styleElement)}},{key:"injectHtml",value:function(e,t){var n;if(this.props.html)t.document.write(this.props.html),this.copyStyles(t),(n=t.document.getElementById(e))||((n=t.document.createElement("div")).id=e,t.document.body.appendChild(n));else{for(var o="<!DOCTYPE html><html><head>",i=window.document.styleSheets.length-1;i>=0;i--){var r=window.document.styleSheets[i];try{var l=r.cssText;o+="<style>".concat(l,"</style>")}catch(e){}}o+='</head><body><div id="'.concat(e,'"></div></body></html>'),t.document.write(o),n=t.document.getElementById(e)}return this.setupStyleElement(t),n}},{key:"copyStyles",value:function(e){for(var t=e.document.head,n="",o=null,i=l.document.styleSheets.length-1;i>=0;i--){var r=l.document.styleSheets[i];try{o=r.cssRules}catch(n){var s=e.document.createElement("link");s.type=r.type,s.rel="stylesheet",s.href=r.href,t.appendChild(s)}finally{if(o)for(var c=0;c<o.length;c++)try{n+=o[c].cssText}catch(e){}}o=null}var a=e.document.createElement("style");a.innerHTML=n,t.appendChild(a)}},{key:"setupStyleObserver",value:function(e){new MutationObserver((function(t){t.forEach((function(t){"childList"==t.type&&function(e,t,n){for(var o,i=0;i<e.length;i++)"STYLE"==(o=e[i]).tagName&&t.call(undefined,o,i)}(t.addedNodes,(function(t){e.document.head.appendChild(function(e,t){var n=t.createElement(e.tagName);if(n.innerHTML=e.innerHTML,e.hasAttributes())for(var o,i=0;i<e.attributes.length;i++)o=e.attributes[i],n.setAttribute(o.name,o.value);return n}(t,e.document))}))}))})).observe(document.head,{childList:!0})}},{key:"initializeChildWindow",value:function(e,t){if(c[e]=this,this.props.url)return this.setupOnCloseHandler(e,t),null;var n=this.injectHtml(e,t);return this.setupStyleObserver(t),this.setupOnCloseHandler(e,t),n}},{key:"setupChild",value:function(e,t,n){this.child=t,this.container=e,c[e.id]=this,n&&this.setupStyleObserver(t),this.setupOnCloseHandler(e.id,t)}},{key:"openChildWindow",value:function(){var e,t=function(e){var t={left:0,top:0,height:600,width:800,location:!1,menubar:!1,resizable:!1,scrollbars:!1,status:!1,toolbar:!1};return t=i(i({},t),e),Object.getOwnPropertyNames(t).map((function(e){return"".concat(e,"=").concat("boolean"==typeof(n=t[e])?n?"1":"0":n?String(n):void 0);var n})).join(",")}(this.props.options||{}),n=function(e){return e||Math.random().toString(12).slice(2)}(this.props.name);if(this.child=!(e=window.open(this.props.url||"about:blank",n,t))||e.closed||void 0===e||void 0===e.closed?null:e,this.child){var o="__".concat(n,"_container__");this.container=this.initializeChildWindow(o,this.child)}else this.props.onBlocked&&this.props.onBlocked(),this.container=null}},{key:"closeChildWindowIfOpened",value:function(){u(this.child)&&(this.child.close(),this.child.close(),this.child=null,this.props.onClose&&this.props.onClose())}},{key:"renderChildWindow",value:function(){!function(e){if(e){var t=document.createElement("a");t.href=e;var n=l.location;if(t.hostname&&n.hostname!=t.hostname||t.protocol&&n.protocol!=t.protocol)throw new Error("react-popup-component error: cross origin URLs are not supported (window=".concat(n.protocol,"//").concat(n.hostname,"; popout=").concat(t.protocol,"//").concat(t.hostname,")"))}}(this.props.url),this.props.hidden?this.closeChildWindowIfOpened():u(this.child)||this.openChildWindow()}}])&&n(t.prototype,o),e}();function p(e){for(var t=e.querySelectorAll("img"),n=function(e){var n=t[e];if(0!==n.src.indexOf("blob:"))return"continue";n.onload=function(){URL.revokeObjectURL(n.src)};var o=function(e){var t=e.ownerDocument.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}(n);o.toBlob((function(e){var t=URL.createObjectURL(e);n.src=t}),"image/png"),n.src=""},o=0;o<t.length;++o)n(o)}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?w(e):t}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}var g=Autodesk.Viewing,O=g.Private,_=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(l,e);var t,n,o,i,r=(o=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(o);if(i){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(this,l),(t=r.call(this,e,n))._viewer=e,t._popoutInstance=null,t._viewerParentNode=null,t._onBeforeUnload=t._onBeforeUnload.bind(w(t)),t}return t=l,n=[{key:"load",value:function(){return!0}},{key:"unload",value:function(){return!0}},{key:"popoutToChild",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.viewer,r=O.logger;if(e){var l=e.document.getElementById(t);l?i.container?this._isPoppedOut()?r.info("Already popped out"):(this._popoutInstance=new d({hidden:!1,onBeforeUnload:this._onBeforeUnload}),n&&this._popoutInstance.copyStyles(e),this._popoutInstance.setupChild(l,e,o),this._moveViewerTo(e,t)):r.error("Viewer is not part of DOM"):r.error("Invalid element ".concat(t))}else r.error("Invalid child")}},{key:"popoutToBlank",value:function(e,t,n,o){var i=this,r=this.viewer,l=O.logger;if(r.container)if(this._isPoppedOut())l.info("Already popped out");else{var s={options:e,hidden:!1,html:"<!DOCTYPE html><html><head></head><body></body></html>",onBeforeUnload:function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];t&&t.apply(null,n),i._onBeforeUnload.apply(null,n)},onClose:n,onBlocked:o};this._popoutInstance=new d(s),this._popoutInstance.renderChildWindow(),this._popoutInstance.child&&!this._popoutInstance.child.closed&&this._moveViewerTo(this._popoutInstance.child,this._popoutInstance.container.id)}else l.error("Viewer is not part of DOM")}},{key:"popin",value:function(){this._popoutInstance&&this._popoutInstance.closeChildWindowIfOpened()}},{key:"_onBeforeUnload",value:function(){this._moveViewerBack(),this._popoutInstance=null}},{key:"_moveViewerTo",value:function(e,t){if(this._isPoppedOut())O.logger.info("Already popped out");else{var n=e.document.getElementById(t);n&&(this._viewerParentNode=this.viewer.container.parentNode,p(this.viewer.container),n.appendChild(this.viewer.container),this.setWindow(e))}}},{key:"_moveViewerBack",value:function(){this._isPoppedOut()?(p(this.viewer.container),this._viewerParentNode.appendChild(this.viewer.container),this.setWindow(g.getGlobal()),this.viewer.resize()):O.logger.info("Not popped out")}},{key:"_isPoppedOut",value:function(){return this.getWindow().opener===g.getGlobal()}}],n&&y(t.prototype,n),l}(g.Extension);g.theExtensionManager.registerExtension("Autodesk.Viewing.Popout",_)})(),Autodesk.Extensions.Popout=t})();
//# sourceMappingURL=Popout.min.js.map