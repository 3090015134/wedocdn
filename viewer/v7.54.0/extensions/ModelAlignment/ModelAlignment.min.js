/*! For license information please see ModelAlignment.min.js.LICENSE.txt */
(()=>{var e={21835:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(87537),o=n.n(i),r=n(23645),s=n.n(r)()(o());s.push([e.id,".adsk-viewing-viewer .edit2d-label.angle-to-angle{width:84px;height:84px;border-radius:100px;background:#FFFFFF;box-shadow:0px 1px 6px rgba(12,44,84,0.12);font-size:18px;line-height:20px;display:flex}.adsk-viewing-viewer .edit2d-label.angle-to-angle.visible{display:flex}.adsk-viewing-viewer .edit2d-label.angle-to-angle .edit2d-label-text{font-size:18px;line-height:20px;align-self:center;width:100%;color:black}\n","",{version:3,sources:["webpack://./extensions/ModelAlignment/ModelAlignment.css"],names:[],mappings:"AAAA,kDACI,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,kBAAmB,CACnB,0CAA8C,CAC9C,cAAe,CACf,gBAAiB,CACjB,YAAa,CAChB,0DAGG,YAAa,CAChB,qEAGG,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,UAAW,CACX,WAAY",sourcesContent:[".adsk-viewing-viewer .edit2d-label.angle-to-angle {\n    width: 84px;\n    height: 84px;\n    border-radius: 100px;\n    background: #FFFFFF;\n    box-shadow: 0px 1px 6px rgba(12, 44, 84, 0.12);\n    font-size: 18px;\n    line-height: 20px;\n    display: flex;\n}\n\n.adsk-viewing-viewer .edit2d-label.angle-to-angle.visible {\n    display: flex;\n}\n\n.adsk-viewing-viewer .edit2d-label.angle-to-angle .edit2d-label-text {\n    font-size: 18px;\n    line-height: 20px;\n    align-self: center;\n    width: 100%;\n    color: black;\n}\n"],sourceRoot:""}]);const a=s},92459:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(87537),o=n.n(i),r=n(23645),s=n.n(r)()(o());s.push([e.id,".model-alignment-panel .tab-header{border-bottom-color:transparent;font-size:12px;font-weight:bold;border-bottom-style:solid;border-bottom-width:3px;padding-bottom:2px}.model-alignment-panel .tab-header.selected{color:#1dc6f2;border-bottom-color:#1dc6f2}.model-alignment-panel .tab-header:hover{color:#1dc6f2}.model-alignment-panel .model-select-combo{width:calc(100% - 20px);margin:15px 10px 15px 10px;font-size:15px}\n","",{version:3,sources:["webpack://./extensions/ModelAlignment/ModelAlignmentPanel.css"],names:[],mappings:"AAGA,mCACI,+BAAiC,CACjC,cAA0B,CAC1B,gBAA0B,CAC1B,yBAA2B,CAC3B,uBAAyB,CACzB,kBAAyB,CAC5B,4CAGG,aAAc,CACd,2BAA4B,CAC/B,yCAGG,aAAc,CACjB,2CAGG,uBAAyB,CACzB,0BAA2B,CAC3B,cAAe",sourcesContent:["\n\n\n.model-alignment-panel .tab-header {\n    border-bottom-color:  transparent;\n    font-size:            12px;\n    font-weight:          bold;\n    border-bottom-style:  solid;\n    border-bottom-width:  3px;\n    padding-bottom:       2px;\n}\n\n.model-alignment-panel .tab-header.selected {\n    color: #1dc6f2;\n    border-bottom-color: #1dc6f2;\n}\n\n.model-alignment-panel .tab-header:hover {\n    color: #1dc6f2;\n}\n\n.model-alignment-panel .model-select-combo {\n    width:  calc(100% - 20px);\n    margin: 15px 10px 15px 10px; /* top-right-bottom-left */\n    font-size: 15px;\n}\n\n\n"],sourceRoot:""}]);const a=s},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&s[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},87537:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),r="/*# ".concat(o," */"),s=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(s).concat([r]).join("\n")}return[t].join("\n")}},86398:(e,t,n)=>{"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,{ModelAlignment:()=>dt,SheetAlignment:()=>Qt});var o="Autodesk.ModelAlignment_Gizmo",r={MODEL_MOVED:"modelMoved",DRAG_STARTED:"dragStarted",DRAG_ENDED:"dragEnded"},s=Autodesk.Viewing,a=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.EventDispatcher.prototype.apply(this),this.viewer=t,this.id=n,this.anchor=new THREE.Vector3,this.startPos=new THREE.Vector3,this.viewer.impl.createOverlayScene(o),this.gizmo=new THREE.TransformControls(this.viewer.impl.camera,this.viewer.canvas,"translate",i),this.target=new THREE.Object3D,this.gizmo.attach(this.target),this.active=!1,this.tmpMatrix=new THREE.Matrix4,this.onCameraChange=this.onCameraChange.bind(this),this.dragging=!1,this.moved=!1}var t,n;return t=e,(n=[{key:"dtor",value:function(){this.deactivate(),this.viewer.impl.removeOverlayScene(o)}},{key:"setModel",value:function(e,t,n){this.model=e,e?(t=t||this.model.getFuzzyBox({ignoreTransforms:!0}),this.anchor.copy(t.min),this.gizmo.setSpace(n?"local":"world"),this.initGizmo(),this.setGizmoVisible(!0)):this.setGizmoVisible(!1)}},{key:"setGizmoVisible",value:function(e){this.gizmo.visible=e,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"initGizmo",value:function(){if(this.model){this.startPos.copy(this.anchor);var e=this.model.getModelToViewerTransform();e&&this.startPos.applyMatrix4(e),this.target.position.copy(this.startPos),"local"===this.gizmo.space&&e&&this.gizmo.setRotation(this.tmpMatrix.extractRotation(e)),this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"ModelTransformTool_".concat(this.id)}},{key:"activate",value:function(){this.active||(this.viewer.impl.addOverlay(o,this.gizmo),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!0)}},{key:"deactivate",value:function(){this.active&&(this.viewer.impl.removeOverlay(o,this.gizmo),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!1)}},{key:"onCameraChange",value:function(){this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"handleMouseMove",value:function(e){if(this.model){var t=this.gizmo.onPointerMove(e),n=this.gizmo.onPointerHover(e);if(this.viewer.impl.invalidate(t,t,!0),t){var i=this.target.position.clone().sub(this.startPos),o=this.model.getPlacementTransform(),s=o.elements;s[12]+=i.x,s[13]+=i.y,s[14]+=i.z,this.viewer.impl.setPlacementTransform(this.model,o),this.fireEvent({type:r.MODEL_MOVED}),this.moved=!0}return(n||t)&&this.viewer.impl.clearHighlight(),n||t}}},{key:"handleButtonDown",value:function(e){return 0===e.button&&(this.dragging=this.gizmo.onPointerDown(e),this.moved=!1,this.dragging&&this.fireEvent({type:r.DRAG_STARTED}),this.dragging)}},{key:"handleButtonUp",value:function(e){return 0===e.button&&(this.dragging&&this.fireEvent({type:r.DRAG_ENDED,moved:this.moved}),this.dragging=!1,this.moved=!1,this.gizmo.onPointerUp(e))}},{key:"getPriority",value:function(){return 1}},{key:"isDragging",value:function(){return this.dragging}}])&&i(t.prototype,n),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){c(r,i,o,s,a,"next",e)}function a(e){c(r,i,o,s,a,"throw",e)}s(void 0)}))}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function g(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}a.Events=r;var p=Autodesk.Viewing,E=Autodesk.Viewing.Private,y=0,T=AutodeskNamespace("Autodesk.ModelAlignment"),A="Snapper_ModelAlignment",P={MODEL_SELECTED:"modelSelected",STATE_CHANGED:"stateChanged",ANIMATION_ENDED:"animationEnded"},k=function(e,t){return e&&t?new E.LmvMatrix4(!0).makeScale(t,t,t).multiply(e):e},b=function(e,t){return k(e,t.myData.scalingFactor)},S=function(e,t){return k(e,1/t.myData.scalingFactor)},C=function(e){var t=e.getDocumentNode();return e.is2d()?t.name():void 0},w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(T,e);var t,n,i,o,r,s,l,c=(s=T,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(s);if(l){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function T(e,t){var n;return d(this,T),(n=c.call(this,e,t)).name="ModelAlignmentBase",n.onModelTransformChanged=n.onTransformChanged.bind(v(n)),n.modelTransformToolAxis=null,Autodesk.Viewing.EventDispatcher.prototype.apply(v(n)),n}return t=T,n=[{key:"load",value:(r=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.Section");case 2:return e.next=4,this.viewer.loadExtension("Autodesk.Snapping");case 4:return e.next=6,this.viewer.loadExtension("Autodesk.Edit2D");case 6:return e.next=8,this.viewer.loadExtension("Autodesk.Edit3D");case 8:this.initTransformTool(),this.snapper=this.viewer.toolController.getTool(A),this.snapper||(this.snapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer,{renderSnappedTopology:!0,toolName:A}),this.viewer.toolController.registerTool(this.snapper)),this.coordPicker=this.viewer.toolController.getTool(Autodesk.Edit3D.CoordPicker.Name),this.coordPicker||(this.coordPicker=new Autodesk.Edit3D.CoordPicker(this.viewer,this.snapper),this.viewer.toolController.registerTool(this.coordPicker)),this.screenOverlay=new Autodesk.Edit2D.ScreenOverlay(this.viewer,"Autodesk.ModelAlignment.ScreenOverlay_".concat(y++)),this.model=null,this.pendingChanges={},this.syncedState={};case 17:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"initTransformTool",value:function(){var e=this;this.modelTransformTool=new a(this.viewer,this.name,this.modelTransformToolAxis),this.viewer.toolController.registerTool(this.modelTransformTool),this.modelTransformTool.addEventListener(a.Events.MODEL_MOVED,(function(){e.modified()})),this.viewer.addEventListener(p.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)}},{key:"destroyTransformTool",value:function(){var e;this.modelTransformTool&&(this.viewer.toolController.deregisterTool(this.modelTransformTool),this.viewer.removeEventListener(p.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged),null===(e=this.modelTransformTool)||void 0===e||e.dtor(),this.modelTransformTool=null)}},{key:"unload",value:function(){this.destroyTransformTool(),this.model=null,this.pendingChanges={},this.syncedState={}}},{key:"setAlignmentService",value:function(e){this.options.alignmentService=e}},{key:"onTransformChanged",value:function(){this.modelTransformTool.initGizmo()}},{key:"setModel",value:function(e){var t;if(this.model!==e){if(this.model=e,null===(t=this.modelTransformTool)||void 0===t||t.setModel(e),e){var n=this.getAlignmentItemKey(e);this.syncedState[n]||(this.syncedState[n]={matrix:this.model.getPlacementTransform().clone()})}this.fireEvent({type:P.MODEL_SELECTED,model:e})}}},{key:"onSaveButton",value:function(){this.options.onSaveButton&&this.options.onSaveButton()}},{key:"saveChanges",value:(o=u(regeneratorRuntime.mark((function e(){var t,n,i,o,r,s,a,l,c,u,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.alignmentService){e.next=3;break}return console.error("AlignmentService must be set for saving transforms"),e.abrupt("return",!1);case 3:t=[],e.t0=regeneratorRuntime.keys(this.pendingChanges);case 5:if((e.t1=e.t0()).done){e.next=21;break}if(n=e.t1.value,o=this.pendingChanges[n]){e.next=10;break}return e.abrupt("continue",5);case 10:r=o.model,s=o.resetPlacement?null:r.getPlacementTransform().clone(),this.syncedState[n].matrix=s,a=r.getDocumentNode(),l=a.getRootNode().urn(),c=C(r),s=S(s,r),u=null===(i=this.options.alignmentService)||void 0===i?void 0:i.saveTransform(l,c,s),t.push(u),e.next=5;break;case 21:return this.pendingChanges={},e.next=24,Promise.all(t);case 24:return d=e.sent,h=d.every((function(e){return e})),e.abrupt("return",h);case 27:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"isAlignmentLocked",value:(i=u(regeneratorRuntime.mark((function e(t){var n,i,o,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.isAlignmentLockedSync(t))){e.next=3;break}return e.abrupt("return",n);case 3:if(i=this.options.alignmentService){e.next=7;break}return console.error("Alignment service must be set to check lock flag."),e.abrupt("return",!1);case 7:return o=t.getDocumentNode(),r=o.getRootNode().urn(),s=t.is2d()?o.name():void 0,e.next=12,i.isAlignmentLocked(r,s);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"isAlignmentLockedSync",value:function(e){var t=e.getDocumentNode(),n=t.getRootNode().urn(),i=e.is2d()?t.name():void 0,o=this.options.alignmentService;return o&&o.getIsLocked(n,i)}},{key:"getAlignmentItemKey",value:function(e){var t=e.myData.urn,n=e.getDocumentNode();return t+(e.is2d()&&n?n.guid():"")}},{key:"modified",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.model){var t=this.getAlignmentItemKey(this.model);if(e&&!this.hasSavedTransform(this.model))return void delete this.pendingChanges[t];this.pendingChanges[t]=new D(this.model,e)}}},{key:"getOriginalFileTransform",value:function(e){var t=e.myData.refPointTransform||new E.LmvMatrix4(!0);return b(t,e)}},{key:"getLastSavedPlacement",value:function(e){var t=e.getDocumentNode().getRootNode().urn(),n=this.options.alignmentService.getTransform(t);return n?b(n,e):this.getOriginalFileTransform(e)}},{key:"isModelTransformDifferentThanOriginalFileTransform",value:function(e){var t=e.getPlacementTransform(),n=this.getOriginalFileTransform(e);return!t.equals(n)}},{key:"isMatrixDifferentThanLastSyncedMatrix",value:function(e,t){if(!e||!t)return!1;var n=this.getAlignmentItemKey(t),i=this.syncedState[n].matrix||this.getOriginalFileTransform(t);return!e.equals(i)}},{key:"hasSavedTransform",value:function(e){var t=this.options.alignmentService;if(!t)return console.error("Alignment service must be set first"),!1;var n=e.getDocumentNode().getRootNode().urn(),i=C(e),o=t.getTransform(n,i);return void 0===o&&console.error("Alignment service transform state should already be known."),null!==o}},{key:"hasPendingChanges",value:function(e){if(e){var t=this.getAlignmentItemKey(e);return!!this.pendingChanges[t]}return Boolean(Object.keys(this.pendingChanges).length)}},{key:"isPendingReset",value:function(e){var t=this;if(e){var n,i=this.getAlignmentItemKey(e);return Boolean(null===(n=this.pendingChanges[i])||void 0===n?void 0:n.resetPlacement)}return Boolean(Object.keys(this.pendingChanges).some((function(e){var n;return null===(n=t.pendingChanges[e])||void 0===n?void 0:n.resetPlacement})))}},{key:"onAnimEnded",value:function(){this.fireEvent({type:P.ANIMATION_ENDED})}}],n&&h(t.prototype,n),T}(p.Extension),D=function e(t,n){d(this,e),this.model=t,this.resetPlacement=n};T.Events=P;var M=n(93379),O=n.n(M),_=n(7795),R=n.n(_),x=n(90569),N=n.n(x),V=n(3565),H=n.n(V),L=n(19216),B=n.n(L),I=n(44589),F=n.n(I),G=n(92459),z={};function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}z.styleTagTransform=F(),z.setAttributes=H(),z.insert=N().bind(null,"head"),z.domAPI=R(),z.insertStyleElement=B(),O()(G.Z,z),G.Z&&G.Z.locals&&G.Z.locals;var Z={MODEL_SELECTED:"modelSelected",MODEL_HOVERED:"modelHovered"},W="ModelAlignment.ModelSelector",Y=function(e,t){t?(t.is3d()?function(e,t){var n=e.getVisibleModels().filter((function(e){return e.is3d()&&e.myData.urn==t})).map((function(e){return e.id}));e.impl.renderer().rollOverModelId(n)}(e,t.myData.urn):e.impl.renderer().rollOverModelId(t.id),e.impl.invalidate(!1,!1,!0)):e.impl.clearHighlight()},q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;U(this,e),this.viewer=t,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.hoverColor=new THREE.Color(.5,.5,.1),this.hoverColorNotSelectable=new THREE.Color(.5,0,0),this.modelFilter=n,this.getCustomHoverColor=null}var t,n;return t=e,n=[{key:"getName",value:function(){return W}},{key:"getNames",value:function(){return[W]}},{key:"activate",value:function(){this.active=!0}},{key:"deactivate",value:function(){this.active=!1,this.setHoverHighlighting(null)}},{key:"register",value:function(){}},{key:"modelIdAtPixel",value:function(e,t){var n=[],i=this.viewer.impl.clientToViewport(e,t);return this.viewer.impl.renderer().idAtPixel(i.x,i.y,n),n[1]?n[1]:0}},{key:"setHoverHighlighting",value:function(e){if(e){var t=!this.modelFilter||this.modelFilter(e)?this.hoverColor:this.hoverColorNotSelectable,n=this.getCustomHoverColor&&this.getCustomHoverColor(e);n&&(t=n),this.viewer.impl.renderer().setRollOverHighlightColor(t),Y(this.viewer,e)}else this.viewer.impl.clearHighlight(),this.viewer.impl.renderer().setRollOverHighlightColor()}},{key:"setModelUnderMouse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setHoverHighlighting(e);var t=this.modelUnderMouse;this.modelUnderMouse=e;var n=t!==e;n&&this.fireEvent({type:Z.MODEL_HOVERED,modelBefore:t,model:e})}},{key:"handleMouseMove",value:function(e){if(0!==e.buttons)return this.setModelUnderMouse(),!1;var t=this.modelIdAtPixel(e.canvasX,e.canvasY),n=this.viewer.impl.findModel(t);return this.setModelUnderMouse(n),!0}},{key:"handleSingleClick",value:function(e,t){if(0==t){var n=this.modelIdAtPixel(e.canvasX,e.canvasY),i=n&&this.viewer.impl.findModel(n);return i&&this.modelFilter&&!this.modelFilter(i)&&(i=null),this.fireEvent({type:Z.MODEL_SELECTED,model:i}),!0}}},{key:"setCustomHoverColors",value:function(e){this.getCustomHoverColor=e}}],n&&j(t.prototype,n),e}();function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}q.Events=Z;var X=Autodesk.Viewing.Private,K=new THREE.Vector3,J=new THREE.Vector3,$=new THREE.Quaternion,ee=new THREE.Euler,te=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=null,this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.euler=new THREE.Euler,this.viewer=t}var t,n,i;return t=e,i=[{key:"readPlacementValues",value:function(e,t,n,i){var o=t||K,r=i||J,s=e.getPlacementTransform();THREE.Matrix4.prototype.decompose.call(s,o,$,r),ee.setFromQuaternion($),n&&(n.x=THREE.Math.radToDeg(ee._x),n.y=THREE.Math.radToDeg(ee._y),n.z=THREE.Math.radToDeg(ee._z))}}],(n=[{key:"getPosition",value:function(){return this.position}},{key:"getRotationZ",value:function(){return this.rotation.z}},{key:"setPosition",value:function(e){this.position.copy(e)}},{key:"setRotationZ",value:function(e){this.rotation.z=e}},{key:"setModel",value:function(e){this.model=e}},{key:"update",value:function(){this.model&&e.readPlacementValues(this.model,this.position,this.rotation,this.scale)}},{key:"apply",value:function(){if(this.model){this.euler._x=THREE.Math.degToRad(this.rotation.x),this.euler._y=THREE.Math.degToRad(this.rotation.y),this.euler._z=THREE.Math.degToRad(this.rotation.z),this.quaternion.setFromEuler(this.euler);var e=new X.LmvMatrix4(!0).compose(this.position,this.quaternion,this.scale);this.viewer.impl.setPlacementTransform(this.model,e)}}}])&&Q(t.prototype,n),i&&Q(t,i),e}();function ne(e){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(e)}function ie(e,t,n){return ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ae(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},ie(e,t,n||e)}function oe(e,t){return oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},oe(e,t)}function re(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?se(e):t}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ae(e){return ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ae(e)}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ue(e,t,n){return t&&ce(e.prototype,t),n&&ce(e,n),e}var de=Autodesk.Viewing,he={MODEL_TRANSFORM_EDITED:"transformEdited",SELECT_MODEL_PRESSED:"selectModelPressed",EDIT_POSITION_PRESSED:"editPositionPressed",TAB_CHANGED:"tabChanged",VECTOR_INPUT_VALUE_CHANGED:"vectorInputValueChanged",MODEL_SELECTED:"modelSelected",SAVE_BUTTON_PRESSED:"saveButtonPressed",FIT_TO_VIEW_BUTTON_PRESSED:"fitToViewButtonPressed",FROM_POINT_BUTTON_PRESSED:"fromPointButtonPressed",TO_POINT_BUTTON_PRESSED:"toPointButtonPressed",APPLY_PTP_PRESSED:"applyPointToPointPressed",FROM_POINT_CHANGED:"fromPointChanged",TO_POINT_CHANGED:"toPointChanged",OFFSET_CHANGED:"offsetChanged",CENTER_BUTTON_PRESSED:"centerButtonPressed",FROM_ANGLE_BUTTON_PRESSED:"fromAngleButtonPressed",TO_ANGLE_BUTTON_PRESSED:"toAngleButtonPressed",APPLY_ATA_PRESSED:"applyAngleToAnglePressed",CENTER_CHANGED:"centerChanged",OFFSET_ANGLE_CHANGED:"offsetAngleChanged",FROM_ANGLE_CHANGED:"fromAngleChanged",TO_ANGLE_CHANGED:"toAngleChanged",FROM_EDGE_BUTTON_PRESSED:"fromEdgeButtonPressed",TO_EDGE_BUTTON_PRESSED:"toEdgeButtonPressed"},fe=function(e){var t=document.createElement("div");return e.appendChild(t),t.style.height="55px",t.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.style.display="flex",t.style.flexDirection="row",t.style.padding="10px",t.style.width="100%",t.style.boxSizing="border-box",t.style.alignItems="center",t.style.marginTop="15px",t},ge=function(e,t,n,i,o){var r=fe(e);i&&(r.id=i);var s=document.createElement("div");if(s.textContent=t,s.style.flexGrow="90",s.style.fontWeight="bold",r.appendChild(s),!n)return r;var a=function(e){var t=e.container.style;t.backgroundColor="rgb(80,80,80)",t.flexGrow="10",t.height="15px",t.width="auto",t.textAlign="center",t.fontSize="12px"};return a(n),r.appendChild(n.container),o?(a(o),r.appendChild(o.container),r):r},ve=function(e,t){var n=document.createElement("div");e.appendChild(n);var i=document.createElement("div");i.textContent=t,i.fontSize="10px",n.appendChild(i);var o=document.createElement("input");return o.type="text",n.appendChild(o),o.style.width="80px",o},me=function(e){return!!e.match(/^-?\d*\.?\d*$/)},pe=function(e,t){var n=parseFloat(parseFloat(e).toFixed(t)).toString();return isFinite(n)?n:"0"},Ee=new THREE.Vector3,ye=new THREE.Vector3,Te=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;le(this,e),de.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.input=document.createElement("input"),this.input.type="text",this.input.style.width="100px",this.container.appendChild(this.input),this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.input.addEventListener("input",this.handleInput)),this.input.addEventListener("blur",this.onBlur.bind(this)),this.digits=o}return ue(e,[{key:"validate",value:function(e){return pe(e,this.digits)}},{key:"setValue",value:function(e){if(null!=e&&null!==e){var t=parseFloat(e).toFixed(this.digits);isNaN(t)||(this.updateInput&&(this.input.value=t),this.fireEvent({type:he.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){me(e)&&(this.input.value=e)}},{key:"getValue",value:function(){return this.valid()?parseFloat(this.input.value):void 0}},{key:"onBlur",value:function(){this.setValue(this.input.value)}},{key:"clear",value:function(){this.input.value="",this.fireEvent({type:he.VECTOR_INPUT_VALUE_CHANGED})}},{key:"valid",value:function(){return isFinite(parseFloat(this.input.value))}}]),e}(),Ae=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;le(this,e),de.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.x=ve(this.container,"X"),this.y=ve(this.container,"Y"),this.z=ve(this.container,"Z"),this.digits=o,this._value=new THREE.Vector3,this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.x.addEventListener("input",this.handleInput),this.y.addEventListener("input",this.handleInput),this.z.addEventListener("input",this.handleInput)),this.x.addEventListener("blur",this.onBlur.bind(this)),this.y.addEventListener("blur",this.onBlur.bind(this)),this.z.addEventListener("blur",this.onBlur.bind(this)),this.enableEmpty=!1}return ue(e,[{key:"validate",value:function(e){return pe(e,this.digits)}},{key:"parseValue",value:function(e){return this.enableEmpty&&!e.length?0:parseFloat(e)}},{key:"valid",value:function(){return this.enableEmpty||this.x.value.length&&this.y.value.length&&this.z.value.length}},{key:"getValue",value:function(){var e=this.parseValue(this.x.value),t=this.parseValue(this.y.value),n=this.parseValue(this.z.value);return this._value.set(e,t,n),this._value}},{key:"isZero",value:function(){var e=this.getValue();return 0==e.x&&0==e.y&&0==e.z}},{key:"setValue",value:function(e){if(e){var t=this.validate(e.x),n=this.validate(e.y),i=this.validate(e.z);isNaN(t)||isNaN(n)||isNaN(i)||(this._value.copy(e),this.updateInput&&(this.x.value=t,this.y.value=n,this.z.value=i),this.fireEvent({type:he.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){me(e.x)&&me(e.y)&&me(e.z)&&(this.x.value=e.x,this.y.value=e.y,this.z.value=e.z)}},{key:"onBlur",value:function(){this.setValue(this._value)}},{key:"clear",value:function(){this.x.value="",this.y.value="",this.z.value="",this.fireEvent({type:he.VECTOR_INPUT_VALUE_CHANGED})}}]),e}(),Pe=function(e,t,n){var i=new Autodesk.Viewing.UI.Button(t);return e.appendChild(i.container),i.container.textContent=n,i.container.style.textAlign="center",i.container.style.left="50%",i.container.style.transform="translateX(-50%)",i.container.style.width="auto",i.container.style.height="auto",i.container.style.backgroundColor="rgb(80,80,80)",i},ke=function(e,t){e.container.style.boxShadow=t?"0px 0px 10px":"initial",e.highlight=t},be={Transform:"Transform",PointToPoint:"Point-to-Point",AngleToAngle:"Angle-to-Angle"},Se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(o,Autodesk.Viewing.UI.DockingPanel);var t,n,i=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=ae(t);if(n){var o=ae(this).constructor;e=Reflect.construct(i,arguments,o)}else e=i.apply(this,arguments);return re(this,e)});function o(e,t,n,r,s){var a;return le(this,o),(a=i.call(this,e.container,t,n,s)).viewer=e,a.unitHandler=r,de.EventDispatcher.prototype.apply(se(a)),a.pages=[],a.selectedTabId=null,a.title.style.borderBottomColor="rgb(74, 85, 91)",a.container.classList.add("model-alignment-panel"),a.container.style.width="300px",a.container.style.height="815px",a.container.style.top="6px",a.container.style.left="6px",a.body=document.createElement("div"),a.body.style.backgroundColor="rgba(34, 34, 34, 0.9)",a.body.style.height="100%",a.body.style.padding="10px",a.container.appendChild(a.body),a.addModelSection(a.body),a.addTabHeaderSection(a.body),a.positionTab=a.addTab(be.Transform,"Position"),a.pointToPointTab=a.addTab(be.PointToPoint,"Move"),a.angleToAngleTab=a.addTab(be.AngleToAngle,"Rotate"),a.initPositionTab(),a.initPointToPointTab(),a.initAngleToAngleTab(),a.selectTab(be.Transform),a.setPrecision(4),a}return ue(o,[{key:"addModelSection",value:function(e){var t=this,n=document.createElement("div");n.id="ModelSection",this.selectModelButton=new Autodesk.Viewing.UI.Button("SelectModel"),this.selectModelButton.container.textContent="Select",this.selectModelButton.onClick=function(){t.fireEvent({type:he.SELECT_MODEL_PRESSED}),ke(t.selectModelButton,!0)},ge(n,"Model",this.selectModelButton),this.modelCombo=document.createElement("select"),this.modelCombo.classList.add("model-select-combo"),n.appendChild(this.modelCombo),this.updateModelCombo(),this.updateModelCombo=this.updateModelCombo.bind(this),this.viewer.addEventListener(de.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.addEventListener(de.MODEL_REMOVED_EVENT,this.updateModelCombo),this.modelCombo.addEventListener("change",(function(){var e=t.modelCombo.selectedIndex,n=t.modelCombo.items[e];t.setModel(n.model)})),e.appendChild(n)}},{key:"getSelectableModels",value:function(){var e={};return this.viewer.getVisibleModels().filter((function(t){if(!t.getDocumentNode())return!1;if(t.getData().underlayRaster)return!1;if(t.is2d())return!0;var n=t.myData.urn;return!e[n]&&(e[n]=!0,!0)}))}},{key:"updateModelCombo",value:function(){var e=this;this.modelCombo.length=0;var t=[];t.push({name:"Please select",model:null}),this.getSelectableModels().forEach((function(e){var n=e.getDocumentNode().getModelName();t.push({name:n,model:e,urn:e.myData.urn})})),t.forEach((function(t,n){var i=document.createElement("option");i.value=n,i.textContent=t.name,i.addEventListener("mouseenter",(function(){return Y(e.viewer,t.model)})),i.addEventListener("mouseleave",(function(){return Y(e.viewer,null)})),e.modelCombo.add(i)})),this.modelCombo.items=t}},{key:"initPositionTab",value:function(){var e=this;this.positionTab.padding="10px",this.editPositionButton=this.createEventButton("EditPositionButton","Edit",he.EDIT_POSITION_PRESSED),this.fitToViewButton=this.createEventButton("FitToViewButton","Fit to View",he.FIT_TO_VIEW_BUTTON_PRESSED,null,!1),ge(this.positionTab,"Position",this.editPositionButton,"PositionHeader",this.fitToViewButton),this.position=new Ae(this.positionTab,(function(){return e.onTransformChanged()})),ge(this.positionTab,"Rotation"),this.rotation=new Te(this.positionTab,(function(){return e.onTransformChanged()})),this.saveButton=this.createEventButton("SaveButton","Save Transforms",he.SAVE_BUTTON_PRESSED),ge(this.body,"",this.saveButton)}},{key:"initPointToPointTab",value:function(){var e=this;this.selectFromButton=this.createEventButton("SelectFromButton","Select",he.FROM_POINT_BUTTON_PRESSED),this.selectToButton=this.createEventButton("SelectToButton","Select",he.TO_POINT_BUTTON_PRESSED),ge(this.pointToPointTab,"From point",this.selectFromButton,"FromPointHeader"),this.fromPoint=new Ae(this.pointToPointTab,(function(){return e.onFromPointChanged(!0)})),ge(this.pointToPointTab,"To point",this.selectToButton,"ToPointHeader"),this.toPoint=new Ae(this.pointToPointTab,(function(){return e.onToPointChanged(!0)})),ge(this.pointToPointTab,"Offset",null,"OffsetHeader"),this.offset=new Ae(this.pointToPointTab,(function(){return e.onOffsetChanged(!0)})),this.offset.enableEmpty=!0;var t=fe(this.pointToPointTab);this.applyPointToPointButton=Pe(t,"ApplyP2P","Apply"),this.applyPointToPointButton.onClick=function(){e.clearPointToPoint(),e.fireEvent({type:he.APPLY_PTP_PRESSED})}}},{key:"setPrecision",value:function(e){this.position.digits=e,this.offset.digits=e,this.fromPoint.digits=e,this.toPoint.digits=e,this.updateTransformValues()}},{key:"initAngleToAngleTab",value:function(){var e=this;this.selectCenterButton=this.createEventButton("SelectCenterButton","Select",he.CENTER_BUTTON_PRESSED,(function(){return e.onSelectCenterButton()})),this.selectFromAngleButton=this.createEventButton("SelectFromAngleButton","Direction",he.FROM_ANGLE_BUTTON_PRESSED),this.selectToAngleButton=this.createEventButton("SelectToAngleButton","Direction",he.TO_ANGLE_BUTTON_PRESSED),this.selectFromEdgeButton=this.createEventButton("SelectFromEdgeButton","Edge",he.FROM_EDGE_BUTTON_PRESSED),this.selectToEdgeButton=this.createEventButton("SelectToEdgeButton","Edge",he.TO_EDGE_BUTTON_PRESSED),ge(this.angleToAngleTab,"Center",this.selectCenterButton,"CenterHeader"),this.center=new Ae(this.angleToAngleTab,(function(){return e.onCenterChanged(!0)})),ge(this.angleToAngleTab,"From angle",this.selectFromEdgeButton,"FromAngleHeader",this.selectFromAngleButton),this.fromAngle=new Te(this.angleToAngleTab,(function(){return e.onFromAngleChanged(!0)})),ge(this.angleToAngleTab,"To angle",this.selectToEdgeButton,"ToPointHeader",this.selectToAngleButton),this.toAngle=new Te(this.angleToAngleTab,(function(){return e.onToAngleChanged(!0)})),ge(this.angleToAngleTab,"Offset angle",null,"OffsetHeader"),this.offsetAngle=new Te(this.angleToAngleTab,(function(){return e.onOffsetAngleChanged(!0)})),this.offset.enableEmpty=!0;var t=fe(this.angleToAngleTab);this.applyAngleToAngleButton=Pe(t,"ApplyA2A","Apply"),this.applyAngleToAngleButton.onClick=function(){e.clearAngleToAngle(),e.fireEvent({type:he.APPLY_ATA_PRESSED})}}},{key:"setModel",value:function(e){this.model=e;var t=this.modelCombo.items;this.modelCombo.selectedIndex=t.findIndex((function(t){return t.model===e})),this.updateTransformValues(),ke(this.selectModelButton,!1),this.blockEvents||(this.blockEvents=!0,this.fireEvent({type:he.MODEL_SELECTED}),this.blockEvents=!1)}},{key:"updateTransformValues",value:function(){if(!this.model)return this.position.clear(),void this.rotation.clear();te.readPlacementValues(this.model,Ee,ye),this.unitHandler.toDisplayUnitsVec3(this.model.getUnitString(),Ee,Ee),this.setPosition(Ee),this.setRotation(ye.z)}},{key:"setPosition",value:function(e){this.position.setValue(e)}},{key:"setRotation",value:function(e){this.rotation.setValue(e)}},{key:"setFromPoint",value:function(e){this.fromPoint.setValue(e),this.onFromPointChanged()}},{key:"setToPoint",value:function(e){this.toPoint.setValue(e),this.onToPointChanged()}},{key:"setOffset",value:function(e){this.offset.setValue(e),this.onOffsetChanged()}},{key:"setCenter",value:function(e){this.center.setValue(e)}},{key:"setFromAngle",value:function(e){this.fromAngle.setValue(e),this.onFromAngleChanged()}},{key:"setToAngle",value:function(e){this.toAngle.setValue(e),this.onToAngleChanged()}},{key:"fromPointValid",value:function(){return this.fromPoint.valid()}},{key:"toPointValid",value:function(){return this.toPoint.valid()}},{key:"offsetValid",value:function(){return this.offset.valid()}},{key:"clearPointToPoint",value:function(){this.fromPoint.clear(),this.toPoint.clear(),this.offset.clear()}},{key:"clearAngleToAngle",value:function(){this.center.clear(),this.fromAngle.clear(),this.toAngle.clear(),this.offsetAngle.clear()}},{key:"getPosition",value:function(){return this.position.valid()&&this.position.getValue()}},{key:"getRotation",value:function(){return this.rotation.valid()&&this.rotation.getValue()}},{key:"getFromPoint",value:function(){return this.fromPoint.valid()&&this.fromPoint.getValue()}},{key:"getToPoint",value:function(){return this.toPoint.valid()&&this.toPoint.getValue()}},{key:"getOffset",value:function(){return!this.offset.isZero()&&this.offset.getValue()}},{key:"getCenter",value:function(){return this.center.valid()&&this.center.getValue()}},{key:"extractModelScale",value:function(){var e=new THREE.Vector3(1,1,1),t=this.model.getPlacementTransform();return t?e.setFromMatrixScale(t):e}},{key:"onTransformChanged",value:function(){this.model&&this.position.valid()&&this.rotation.valid()&&this.fireEvent({type:he.MODEL_TRANSFORM_EDITED})}},{key:"onFromPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?this.offset.setValue(n.sub(t)):t&&i&&(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:he.TO_POINT_CHANGED,toPoint:this.getToPoint()})),e&&this.fireEvent({type:he.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})}},{key:"onToPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?(this.offset.setValue(n.sub(t)),e&&this.fireEvent({type:he.OFFSET_CHANGED,offset:this.getOffset()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:he.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:he.TO_POINT_CHANGED,toPoint:this.getToPoint()})}},{key:"onOffsetChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&i?(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:he.TO_POINT_CHANGED,toPoint:this.getToPoint()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:he.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:he.OFFSET_CHANGED,offset:this.getOffset()})}},{key:"updateFromAngle",value:function(e){var t=this.toAngle.getValue()-this.offsetAngle.getValue();this.fromAngle.setValue(t),e&&this.fireEvent({type:he.FROM_ANGLE_CHANGED,angle:t})}},{key:"updateToAngle",value:function(e){var t=this.fromAngle.getValue()+this.offsetAngle.getValue();this.toAngle.setValue(t),e&&this.fireEvent({type:he.TO_ANGLE_CHANGED,angle:t})}},{key:"updateOffsetAngle",value:function(e){var t=this.toAngle.getValue()-this.fromAngle.getValue();this.offsetAngle.setValue(t),e&&this.fireEvent({type:he.OFFSET_ANGLE_CHANGED,angle:t})}},{key:"onCenterChanged",value:function(e){e&&this.fireEvent({type:he.CENTER_CHANGED,center:this.getCenter()})}},{key:"onFromAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):t&&i&&this.updateToAngle(e),e&&this.fireEvent({type:he.FROM_ANGLE_CHANGED,angle:this.fromAngle.getValue()})}},{key:"onToAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):n&&i&&this.updateFromAngle(e),e&&this.fireEvent({type:he.TO_ANGLE_CHANGED,angle:this.toAngle.getValue()})}},{key:"onOffsetAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&i?this.updateToAngle(e):n&&i?this.updateFromAngle(e):!i||t||n||(this.fromAngle.setValue(0),this.toAngle.setValue(this.offsetAngle.getValue()),this.updateFromAngle(e),this.updateToAngle(e)),e&&this.fireEvent({type:he.OFFSET_ANGLE_CHANGED,angle:this.offsetAngle.getValue()})}},{key:"addTabHeaderSection",value:function(e){this.tabHeaders=document.createElement("div"),this.tabHeaders.id="TabHeaders",this.tabHeaders.style.paddingTop="15px",this.tabHeaders.style.paddingLeft="10px",this.tabHeaders.style.backgroundColor="rgb(34, 34, 34, 0.94)",this.tabHeaders.style.display="flex",this.tabHeaders.style.flexDirection="row",this.tabHeaders.style.borderBottomStyle="solid",this.tabHeaders.style.borderBottomWidth="3px",this.tabHeaders.style.borderColor="rgb(34, 34, 34, 0.94)",e.appendChild(this.tabHeaders)}},{key:"addTabHeader",value:function(e,t){var n=this,i=document.createElement("div");i.style.paddingRight="10px";var o=document.createElement("span");o.textContent=t,o.classList.add("tab-header"),i.appendChild(o),i.tabId=e,i.text=o,this.tabHeaders.appendChild(i),i.addEventListener("click",(function(){return n.selectTab(e)}))}},{key:"addTab",value:function(e,t){this.addTabHeader(e,t);var n=document.createElement("div");return n.tabId=e,this.pages.push(n),this.body.append(n),n}},{key:"selectTab",value:function(e){if(this.selectedTabId!==e){for(var t=0;t<this.tabHeaders.children.length;t++){var n=this.tabHeaders.children[t];n.tabId==e?n.text.classList.add("selected"):n.text.classList.remove("selected")}for(var i=0;i<this.pages.length;i++){var o=this.pages[i],r=o.tabId===e;o.style.display=r?"block":"none"}this.selectedTabId=e,this.fireEvent({type:he.TAB_CHANGED,tabId:e})}}},{key:"onFromSelected",value:function(e){this.setFromPoint(e),ke(this.selectFromButton,!1),this.fromPoint.valid()&&!this.toPoint.valid()&&(ke(this.selectToButton,!0),this.fireEvent({type:he.TO_POINT_BUTTON_PRESSED}))}},{key:"onToSelected",value:function(e){this.setToPoint(e),ke(this.selectToButton,!1)}},{key:"onFromHovered",value:function(e){this.setFromPoint(e)}},{key:"onToHovered",value:function(e){this.setToPoint(e)}},{key:"createEventButton",value:function(e,t,n,i){var o=this,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=new Autodesk.Viewing.UI.Button(e);return s.container.textContent=t,s.onClick=function(){i&&i(),o.fireEvent({type:n}),r&&ke(s,!0)},s}},{key:"onCenterHovered",value:function(e){this.setCenter(e)}},{key:"onCenterSelected",value:function(e){this.setCenter(e),ke(this.selectCenterButton,!1),this.center.valid()&&!this.fromAngle.valid()&&ke(this.selectFromAngleButton,!0)}},{key:"onFromAngleHovered",value:function(e){this.setFromAngle(e)}},{key:"onFromAngleSelected",value:function(e){this.setFromAngle(e),ke(this.selectFromAngleButton,!1),ke(this.selectFromEdgeButton,!1),this.center.valid()&&this.fromAngle.valid()&&!this.toAngle.valid()&&ke(this.selectToAngleButton,!0)}},{key:"onToAngleHovered",value:function(e){this.setToAngle(e)}},{key:"onToAngleSelected",value:function(e){this.setToAngle(e),ke(this.selectToAngleButton,!1),ke(this.selectToEdgeButton,!1)}},{key:"onSelectCenterButton",value:function(){this.clearAngleToAngle()}},{key:"uninitialize",value:function(){ie(ae(o.prototype),"uninitialize",this).call(this),this.viewer.removeEventListener(de.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.removeEventListener(de.MODEL_REMOVED_EVENT,this.updateModelCombo)}}]),o}();function Ce(e){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce(e)}function we(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function De(e,t,n){return De="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Re(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},De(e,t,n||e)}function Me(e,t){return Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Me(e,t)}function Oe(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?_e(e):t}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Re(e){return Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Re(e)}Se.Events=he,Se.TabIds=be;var xe=Object.assign({},Autodesk.Edit3D.TwoPointPicker.Events,{ANIMATION_ENDED:"animEnded"}),Ne=new THREE.Vector3,Ve=new THREE.Vector3,He=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(s,Autodesk.Edit3D.TwoPointPicker);var t,n,i,o,r=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Re(i);if(o){var n=Re(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Oe(this,e)});function s(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var o={backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Blue},a={draggable:!0,labels:["From","To"],labelStyles:[o,o],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Black,getEdgeLabelText:function(){var e=Math.abs(i.points[0].x-i.points[1].x),t=Math.abs(i.points[0].y-i.points[1].y),n=Math.abs(i.points[0].z-i.points[1].z),o=i.unitHandler.lengthToString(e),r=i.unitHandler.lengthToString(t),s=i.unitHandler.lengthToString(n);return"X: ".concat(o,", Y: ").concat(r,", Z: ").concat(s)},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]};return(i=r.call(this,e,t,n,a)).unitHandler=new Autodesk.Edit2D.DefaultUnitHandler(i.viewer),i.updateGizmos=i.updateGizmos.bind(_e(i)),i.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,i.updateGizmos),i}return t=s,(n=[{key:"dtor",value:function(){De(Re(s.prototype),"dtor",this).call(this),this.viewer.removeEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.updateGizmos)}},{key:"start",value:function(){this.setVisible(!0),this.startSelect()}},{key:"pause",value:function(){this.cancelPointSelection(),this.isActive=!1,this.setVisible(!1)}},{key:"cancel",value:function(){this.cancelPointSelection(),this.clear(),this.setVisible(!1)}},{key:"finish",value:function(e){return this.isActive=!1,this.apply(e)}},{key:"apply",value:function(e){var t=this;return new Promise((function(n){var i=e.getPlacementTransform(),o=t.pointValid[0]&&t.pointValid[1]?t.points[1].clone().sub(t.points[0]):t.offset,r=(new THREE.Vector3).setFromMatrixPosition(i),s=r.clone().add(o),a=new THREE.Vector3,l=new THREE.Vector3;t.screenOverlay.fadeOutGizmo(t.connectors[0].gizmo),t.connectors[0].label.setOpacity(0,!0),t.markers[0].setLabelVisible(!1),t.markers[1].setLabelVisible(!1),t.anim=Autodesk.Viewing.Private.fadeValue(0,1,1,(function(n){n=THREE.Math.smootherstep(n,0,1),a.lerpVectors(r,s,n),l.lerpVectors(t.points[0],t.points[1],n),t.markers[0].setPosition(l),i.setPosition(a),t.viewer.impl.setPlacementTransform(e,i)}),(function(e){t.clear(),t.anim=null,n(),t.fireEvent({type:xe.ANIMATION_ENDED})}))}))}},{key:"fitModelToView",value:function(e){var t=e.getBoundingBox(),n=this.viewer.impl.camera,i=Autodesk.Viewing.UnifiedCamera.getViewParamsFromBox(t,!1,n.aspect,n.up,n.fov),o=t.getCenter(Ve),r=i.position.distanceTo(i.target),s=n.getWorldDirection(Ne).clone().multiplyScalar(r),a=n.position.clone().add(s),l=o.distanceTo(a),c=2*t.getSize(Ne).length();if(l>c){var u=Math.max(l-c,0),d=a.clone().sub(o).normalize().multiplyScalar(u),h=e.getPlacementTransform(),f=(new THREE.Vector3).setFromMatrixPosition(h);f.add(d),h.setPosition(f),this.viewer.impl.setPlacementTransform(e,h),o.add(d)}return this.setVisible(!1),this.setPoint(0,o),this.setPoint(1,a),this.apply(e)}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}},{key:"isAnimationActive",value:function(){return this.anim&&this.anim.isRunning}}])&&we(t.prototype,n),s}();He.Events=xe;var Le=n(21835),Be={};function Ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Be.styleTagTransform=F(),Be.setAttributes=H(),Be.insert=N().bind(null,"head"),Be.domAPI=R(),Be.insertStyleElement=B(),O()(Le.Z,Be),Le.Z&&Le.Z.locals&&Le.Z.locals;var Fe={CENTER_SELECTED:"centerSelected",CENTER_HOVERED:"centerHovered",FROM_ANGLE_SELECTED:"startAngleSelected",FROM_ANGLE_HOVERED:"startAngleHovered",TO_ANGLE_SELECTED:"endAngleSelected",TO_ANGLE_HOVERED:"endAngleHovered",ANIMATION_ENDED:"animationEnded"},Ge={NotSelecting:0,SelectingCenter:1,SelectingStartAngle:2,SelectingEndAngle:3,SelectingStartAngleEdge:4,SelectingEndAngleEdge:5},ze={SinglePoint:0,Edge:1},Ue=new THREE.Matrix4,je=new THREE.Matrix4,Ze=new THREE.Matrix4,We=new THREE.Quaternion,Ye=new THREE.Vector2,qe=function(e){return e>=0?e:e+360},Qe=function(){function e(t,n,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=Autodesk.Edit3D.CoordPicker,s=Autodesk.Edit3D.PointMarker,a=Autodesk.Edit3D.TwoPointPicker;this.viewer=t,this.coordPicker=n,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.mode=Ge.NotSelecting,this.defaultPickingMode=ze.Edge,this.center=new THREE.Vector3,this.fromEdge={a:new THREE.Vector3,b:new THREE.Vector3},this.toEdge={a:new THREE.Vector3,b:new THREE.Vector3},this.centerValid=!1,this.fromValid=!1,this.toValid=!1,this.fromPointOnPlane=new THREE.Vector3,this.toPointOnPlane=new THREE.Vector3,this.screenOverlay=i,this.angleGizmo=new Autodesk.Edit2D.AngleGizmo(this.screenOverlay.layer,{startColor:Autodesk.Edit3D.NPointPicker.Colors.Blue,endColor:Autodesk.Edit3D.NPointPicker.Colors.Red,ignoreCameraDistance:!0,hideArrowHead:!0,centerLabel:!0,labelClassName:"angle-to-angle"}),this.angleGizmo.setVisible(!0),this.axis=new THREE.Vector3(0,0,1),this.selectionPlane=new THREE.Plane,this.fromConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo,this.toConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo;var l=this.fromConnector.line2D.style;l.lineStyle=10,l.lineWidth=1.5,l.lineColor="rgb(255, 0, 0)",l.lineOpacity=.7,this.toConnector.line2D.style.copy(l),this.animTime=1.5,this.fadeOutAngleGizmoAfter=.7,this.angleGizmoSize=60,this.angleGizmoBottomOffset=200,this.useFirstPointAsCenter=!0,this.visible=!0,this.onDragEdgeEnd=this.onDragEdgeEnd.bind(this);var c={backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Blue},u={draggable:!0,labels:["From"],labelStyles:[c],icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Blue],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Blue,getEdgeLabelText:function(){return o.fromValid?qe(o.edgeToAngle(o.fromEdge.b,o.fromEdge.a,!0)).toFixed(1)+"°":""},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]};this.fromEdgePicker=new a(t,n,i,u),this.fromEdgePicker.addEventListener(a.Events.POINT_SELECTED,(function(){return o.onEdgeSelected(o.fromEdgePicker)})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=Ge.SelectingStartAngleEdge})),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=Ge.SelectingStartAngleEdge})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),u={draggable:!0,labels:["To"],labelStyles:[c],icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Red,getEdgeLabelText:function(){return o.toValid?qe(o.edgeToAngle(o.toEdge.b,o.toEdge.a,!0)).toFixed(1)+"°":""},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]},this.toEdgePicker=new a(t,n,i,u),this.toEdgePicker.addEventListener(a.Events.POINT_SELECTED,(function(){return o.onEdgeSelected(o.toEdgePicker)})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=Ge.SelectingEndAngleEdge})),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=Ge.SelectingEndAngleEdge})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.onPointClicked=this.onPointClicked.bind(this),this.onPointHovered=this.onPointHovered.bind(this),this.coordPicker.addEventListener(r.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.addEventListener(r.Events.POINT_HOVERED,this.onPointHovered),this.coordPicker.addEventListener(r.Events.ESCAPE,(function(){return o.cancelPointSelection()})),this.updateGizmos=this.updateGizmos.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.updateGizmos),this.clearOnNextStart=!1,this.updateGizmos()}var t,n;return t=e,n=[{key:"dtor",value:function(){this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_HOVERED,this.onPointHovered),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.updateGizmos)}},{key:"start",value:function(){this.skipAnim(),this.clearOnNextStart&&this.clear(),this.isActive=!0,this.continuePointSelectionIfNeeded()}},{key:"pause",value:function(){this.cancelPointSelection(),this.setVisible(!1),this.isActive=!1,this.updateGizmos()}},{key:"cancel",value:function(){this.setVisible(!1),this.isActive=!1,this.clear()}},{key:"finish",value:function(e){return this.clearOnNextStart=!1,this.updateGizmos(),this.apply(e)}},{key:"startSelectCenter",value:function(e){this.clear(),this.isActive=!0,this.pointBackup=this.centerValid?this.center.clone():null,this.startCoordPicker(),this.mode=Ge.SelectingCenter,e&&this.coordPicker.setDragging(!0)}},{key:"startCoordPicker",value:function(){this.viewer.toolController.isToolActivated(this.coordPicker.getName())||this.viewer.toolController.activateTool(this.coordPicker.getName())}},{key:"endCoordPicker",value:function(){this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName())}},{key:"onDragCenterEnd",value:function(e){var t=e.event;this.coordPicker.getDragging()&&(this.coordPicker.handleSingleClick(t,0),this.coordPicker.setDragging(!1))}},{key:"onDragEdgeEnd",value:function(){this.useFirstPointAsCenter&&this.mode===Ge.SelectingStartAngleEdge&&this.setCenter(this.fromEdgePicker.points[0]),this.mode=Ge.NotSelecting,this.continuePointSelectionIfNeeded()}},{key:"startSelectFromAngle",value:function(){this.startCoordPicker(),this.mode=Ge.SelectingStartAngle,this.pointBackup=this.fromValid?this.fromEdge.b.clone():null}},{key:"startSelectToAngle",value:function(){this.startCoordPicker(),this.mode=Ge.SelectingEndAngle,this.pointBackup=this.toValid?this.toEdge.b.clone():null}},{key:"setCenter",value:function(e){e?(this.center.copy(e),this.centerValid=!0,this.selectionPlane.setFromNormalAndCoplanarPoint(this.axis,this.center)):this.centerValid=!1,this.updateGizmos()}},{key:"setFromEdge",value:function(e,t){this.fromValid=Boolean(e&&t),this.fromValid&&(this.fromEdge.a.copy(e),this.fromEdge.b.copy(t)),this.updateGizmos()}},{key:"setToEdge",value:function(e,t){this.toValid=Boolean(e&&t),this.toValid&&(this.toEdge.a.copy(e),this.toEdge.b.copy(t)),this.updateGizmos()}},{key:"edgeToAngle",value:function(e,t,n){var i=e.x-t.x,o=e.y-t.y,r=Math.atan2(o,i);return n?THREE.Math.radToDeg(r):r}},{key:"onPointHovered",value:function(e){if(this.mode!==Ge.NotSelecting&&e.point)switch(this.mode){case Ge.SelectingCenter:this.setCenter(e.point),this.fireEvent({type:Fe.CENTER_HOVERED,point:e.point}),this.fromValid&&this.fireEvent({type:Fe.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(this.fromEdge.b,this.center,!0)}),this.toValid&&this.fireEvent({type:Fe.TO_ANGLE_HOVERED,angle:this.edgeToAngle(this.toEdge.b,this.center,!0)});break;case Ge.SelectingStartAngle:this.setFromEdge(this.center,e.point),this.fireEvent({type:Fe.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(e.point,!0)});break;case Ge.SelectingEndAngle:this.setToEdge(this.center,e.point),this.fireEvent({type:Fe.TO_ANGLE_HOVERED,angle:this.edgeToAngle(e.point,!0)});break;case Ge.SelectingStartAngleEdge:(1===this.fromEdgePicker.selectingIndex||this.fromValid)&&(this.setFromEdge(this.fromEdgePicker.points[0],this.fromEdgePicker.points[1]),this.fireEvent({type:Fe.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(this.fromEdgePicker.points[1],this.fromEdgePicker.points[0])}));break;case Ge.SelectingEndAngleEdge:(1===this.toEdgePicker.selectingIndex||this.toValid)&&(this.setToEdge(this.toEdgePicker.points[0],this.toEdgePicker.points[1]),this.fireEvent({type:Fe.TO_ANGLE_HOVERED,angle:this.edgeToAngle(this.toEdgePicker.points[1],this.toEdgePicker.points[0])}))}}},{key:"updateAngleGizmo",value:function(){if(this.fromValid&&this.toValid&&this.centerValid){var e=this.viewer.impl.getCanvasBoundingClientRect();this.angleGizmo.setCenter(Ye.set(e.width/2,e.height-this.angleGizmoBottomOffset));var t=Math.PI/2;this.setPointFromAngle(Ye,-t,this.angleGizmoSize,this.angleGizmo.center),this.angleGizmo.setStart(Ye);var n=t+this.getOffsetAngle();this.setPointFromAngle(Ye,-n,this.angleGizmoSize,this.angleGizmo.center),this.angleGizmo.setEnd(Ye)}else this.angleGizmo.setCenter(null),this.angleGizmo.setStart(null),this.angleGizmo.setEnd(null);this.angleGizmo.update()}},{key:"updateGizmos",value:function(){var e=this.visible&&this.isActive;this.fromEdgePicker.setVisible(e&&this.fromValid),this.toEdgePicker.setVisible(e&&this.toValid),this.fromEdgePicker.updateGizmos(),this.toEdgePicker.updateGizmos(),this.visible&&(this.fromValid||this.toValid)&&(this.isActive||this.isAnimationActive())?(this.angleGizmo.fadeTo(1),this.angleGizmo.setLabelEnabled(!0),this.mode!==Ge.NotSelecting&&this.angleGizmo.skipFade(),this.updateAngleGizmo()):(this.angleGizmo.fadeTo(0),this.angleGizmo.setLabelEnabled(!1),this.angleGizmo.update()),this.screenOverlay.update()}},{key:"onPointClicked",value:function(e){var t=e.point,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.mode!==Ge.NotSelecting&&this.mode!==Ge.SelectingStartAngleEdge&&this.mode!=Ge.SelectingEndAngleEdge){t=t||this.pointBackup,this.pointBackup=null;var i=this.mode;this.mode=Ge.NotSelecting,this.endCoordPicker(),t&&(this.viewer.impl.camera.pivot.copy(t),this.viewer.impl.camera.dirty=!0);var o=t?this.edgeToAngle(t,this.center,!0):null;switch(i){case Ge.SelectingCenter:this.setCenter(t),this.fireEvent({type:Fe.CENTER_SELECTED,point:t});break;case Ge.SelectingStartAngle:this.setFromEdge(this.center,t),this.fireEvent({type:Fe.FROM_ANGLE_SELECTED,angle:o});break;case Ge.SelectingEndAngle:this.setToEdge(this.center,t),this.fireEvent({type:Fe.TO_ANGLE_SELECTED,angle:o});break;case Ge.SelectingStartAngleEdge:case Ge.SelectingEndAngleEdge:break;default:console.error("Unexpeced mode")}n&&this.continuePointSelectionIfNeeded()}}},{key:"cancelPointSelection",value:function(){this.onPointClicked({},!1),this.mode===Ge.SelectingStartAngleEdge?this.fromValid=!1:this.mode===Ge.SelectingEndAngleEdge&&(this.toValid=!1),this.fromEdgePicker.cancelPointSelection(),this.toEdgePicker.cancelPointSelection()}},{key:"continuePointSelectionIfNeeded",value:function(){var e=this;this.isPickerActive()&&(this.setVisible(!0),setTimeout((function(){e.centerValid||e.useFirstPointAsCenter?e.fromValid?e.toValid||(e.defaultPickingMode===ze.Edge?e.startSelectToAngleEdge():e.defaultPickingMode===ze.SinglePoint&&e.startSelectToAngle()):e.defaultPickingMode===ze.Edge?e.startSelectFromAngleEdge():e.defaultPickingMode===ze.SinglePoint&&e.startSelectFromAngle():e.startSelectCenter()}),1))}},{key:"getOffsetAngle",value:function(){if(this.fromValid&&this.toValid){var e=this.edgeToAngle(this.fromEdge.b,this.fromEdge.a);return this.edgeToAngle(this.toEdge.b,this.toEdge.a)-e}return this.offset}},{key:"createRotation",value:function(e,t,n){var i=Ue.makeTranslation(-n.x,-n.y,-n.z),o=je.makeTranslation(n.x,n.y,n.z),r=We.setFromAxisAngle(this.axis,e),s=Ze.makeRotationFromQuaternion(r);return t.copy(o).multiply(s).multiply(i)}},{key:"clear",value:function(){this.clearOnNextStart=!1,this.fromValid=!1,this.toValid=!1,this.centerValid=!1,this.fromEdgePicker.clear(),this.toEdgePicker.clear(),this.isActive=!1,this.updateGizmos()}},{key:"apply",value:function(e){var t=this;return new Promise((function(n){var i=t.getOffsetAngle();(i=Autodesk.Extensions.CompGeom.normalizeAngle(i))>Math.PI&&(i-=2*Math.PI);var o=e.getPlacementTransform().clone(),r=new Autodesk.Viewing.Private.LmvMatrix4(!0),s=e.getGlobalOffset(),a=s?t.center.clone().add(s):t.center,l=function(e,n){return t.createRotation(e,n,a).multiply(o)};t.animEndMatrix=l(i,r).clone(),t.fromEdgePicker.markers[0].setDraggable(!1),t.fromEdgePicker.markers[1].setDraggable(!1),t.toEdgePicker.markers[0].setDraggable(!1),t.toEdgePicker.markers[1].setDraggable(!1),t.anim=Autodesk.Viewing.Private.fadeValue(0,1,t.animTime,(function(n){var o=THREE.Math.smootherstep(n,0,1)*i,s=Math.PI/2;t.setPointFromAngle(Ye,-(s+o),t.angleGizmoSize,t.angleGizmo.center),t.angleGizmo.setStart(Ye),t.angleGizmo.update(),n>t.fadeOutAngleGizmoAfter&&t.angleGizmo.fadeTo(0),l(o,r),t.viewer.impl.setPlacementTransform(e,r)}),(function(){t.angleGizmo.setLabelEnabled(!1),t.clear(),t.anim=null,n(),t.fireEvent({type:Fe.ANIMATION_ENDED})}))}))}},{key:"setVisible",value:function(e){e!==this.visible&&(this.visible=e,this.updateGizmos())}},{key:"setPointFromAngle",value:function(e,t,n,i){e.set(1,0,0),Autodesk.Edit2D.Math2D.rotateAround(e,t),e.multiplyScalar(n).add(i)}},{key:"changeFromAngle",value:function(e){if(this.fromValid){if(void 0!==e){var t=this.fromPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.fromEdge.b,e,t,this.center)}else this.fromValid=!1;this.updateGizmos()}}},{key:"changeToAngle",value:function(e){if(this.toValid){if(void 0!==e){var t=this.toPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.toEdge.b,e,t,this.center)}else this.toValid=!1;this.updateGizmos()}}},{key:"changeOffset",value:function(e){this.centerValid&&(this.cancelPointSelection(),this.fromValid||(this.startSelectFromAngle(),this.fromValid=!0,this.changeFromAngle(0),this.onPointClicked({point:this.fromEdge.b})),this.toValid||(this.startSelectToAngle(),this.toValid=!0,this.changeToAngle(this.edgeToAngle(this.fromEdge.b,this.fromEdge.a)+e),this.onPointClicked({point:this.toEdge.b})),this.continuePointSelectionIfNeeded())}},{key:"startSelectFromAngleEdge",value:function(){this.mode=Ge.SelectingStartAngleEdge,this.fromEdgePicker.startSelect()}},{key:"startSelectToAngleEdge",value:function(){this.mode=Ge.SelectingEndAngleEdge,this.toEdgePicker.startSelect()}},{key:"onEdgeSelected",value:function(e){var t=this.mode===Ge.SelectingStartAngleEdge,n=this.mode===Ge.SelectingEndAngleEdge;if(t||n){var i=e.points[0],o=e.points[1];if(t?(this.useFirstPointAsCenter&&this.setCenter(i),this.setFromEdge(i,o)):this.setToEdge(i,o),this.updateGizmos(),t){var r=this.edgeToAngle(o,i,!0);this.fireEvent({type:Fe.FROM_ANGLE_SELECTED,angle:r})}else{var s=this.edgeToAngle(o,i,!0);this.fireEvent({type:Fe.TO_ANGLE_SELECTED,angle:s})}e.areAllPointsSet()&&(this.mode=Ge.NotSelecting,this.continuePointSelectionIfNeeded())}}},{key:"isPickerActive",value:function(){return this.isActive}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}},{key:"isAnimationActive",value:function(){return this.anim&&this.anim.isRunning}}],n&&Ie(t.prototype,n),e}();Qe.Events=Fe,Qe.Modes=Ge,Qe.PickingModes=ze;var Xe={en:JSON.parse('{"@@locale":"en","@@context":"ModelAlignment Extension","Pivot":"Pivot","From":"From","To":"To"}')};function Ke(e){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(e)}function Je(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function $e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function et(e,t,n){return et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ot(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},et(e,t,n||e)}function tt(e,t){return tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},tt(e,t)}function nt(e,t){return!t||"object"!==Ke(t)&&"function"!=typeof t?it(e):t}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e){return ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ot(e)}var rt="Autodesk.ModelAlignment",st=Autodesk.Viewing,at=AutodeskNamespace("Autodesk.ModelAlignment"),lt=function(e,t){if(e.isLeaflet())e.setThemingColor(null,t);else for(var n=e.myData.fragments.fragId2dbId,i=0;i<n.length;i++){var o=n[i];if(Array.isArray(o))for(var r=0;r<o.length;r++)e.setThemingColor(o[r],t);else e.setThemingColor(o,t)}},ct=function(e){return void 0!==e?THREE.Math.degToRad(e):void 0},ut={Default:"Default",Animating:"Animating",SelectModel:"SelectModel",PointToPoint:"PointToPoint",AngleToAngle:"AngleToAngle"},dt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(l,e);var t,n,i,o,r,s,a=(r=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ot(r);if(s){var n=ot(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return nt(this,e)});function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=a.call(this,e,t)).name=rt,n.onPlacementChanged=n.onPlacementChanged.bind(it(n)),n.onSaveButton=n.onSaveButton.bind(it(n)),n.onTabChanged=n.onTabChanged.bind(it(n)),n.onStateChanged=n.onStateChanged.bind(it(n)),n.onDisplayUnitsChanged=n.onDisplayUnitsChanged.bind(it(n)),n.fuzzyBoxCache={},n.flyToAnim=null,n.flyToDuration=1,n.frustumIntersector=new Autodesk.Viewing.Private.FrustumIntersector,n}return t=l,n=[{key:"load",value:(i=regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(Xe),e.next=3,et(ot(l.prototype),"load",this).call(this);case 3:this.unitHandler=new Autodesk.Edit2D.DefaultUnitHandler(this.viewer),this.panel=new Se(this.viewer,"ModelAlignmentPanel","Model Alignment",this.unitHandler),this.viewer.addPanel&&this.viewer.addPanel(this.panel),this.viewer.addEventListener(st.MODEL_PLACEMENT_CHANGED_EVENT,this.onPlacementChanged),this.viewer.addEventListener(st.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.onDisplayUnitsChanged),this.onModelPanelSelect=this.onModelPanelSelect.bind(this),this.pointToPoint=new He(this.viewer,this.coordPicker,this.screenOverlay),this.angleToAngle=new Qe(this.viewer,this.coordPicker,this.screenOverlay),this.modelSelector=new q(this.viewer,(function(e){return t.isModelSelectable(e)})),this.viewer.toolController.registerTool(this.modelSelector),this.pointToPoint.addEventListener(He.Events.ANIMATION_ENDED,(function(){return t.onAnimEnded()})),this.angleToAngle.addEventListener(Qe.Events.ANIMATION_ENDED,(function(){return t.onAnimEnded()})),this.modelSelector.setCustomHoverColors((function(e){return t.isModelEditable(e)?void 0:t.modelSelector.hoverColorNotSelectable})),this.connectModelsPanel(),this.connectPointToPoint(),this.connectAngleToAngle(),this.connectModelSelector(),this.connectModelMoveTool(),this.panel.addEventListener(Se.Events.SAVE_BUTTON_PRESSED,this.onSaveButton),this.panel.addEventListener(Se.Events.MODEL_TRANSFORM_EDITED,(function(){t.positionEditInProgress=!0;var e=t.unitHandler.fromDisplayUnitsVec3(t.model.getUnitString(),t.panel.getPosition());t.transformEdit.update(),t.transformEdit.setPosition(e),t.transformEdit.setRotationZ(t.panel.getRotation()),t.transformEdit.apply(),t.modified(),t.positionEditInProgress=!1,t.onTabChanged()})),this.panel.addEventListener(Se.Events.TAB_CHANGED,this.onTabChanged),this.selectionColor=new THREE.Vector4(1,1,0,.25),this.transformEdit=new te(this.viewer);case 26:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function s(e){Je(r,n,o,s,a,"next",e)}function a(e){Je(r,n,o,s,a,"throw",e)}s(void 0)}))},function(){return o.apply(this,arguments)})},{key:"unload",value:function(){et(ot(l.prototype),"unload",this).call(this),this.viewer.removePanel&&this.viewer.removePanel(this.panel),this.panel.uninitialize(),this.panel=null,this.viewer.removeEventListener(st.MODEL_PLACEMENT_CHANGED_EVENT,this.onPlacementChanged),this.viewer.removeEventListener(st.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.onDisplayUnitsChanged),this.onExtensionLoaded&&this.viewer.removeEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded),this.pointToPoint&&(this.pointToPoint.dtor(),this.pointToPoint=null),this.angleToAngle&&(this.angleToAngle=null),this.disconnectModelsPanel()}},{key:"getToolMode",value:function(){return this.isAnimationActive()?ut.Animating:this.isAngleToAngleActive()?ut.AngleToAngle:this.isPointToPointActive()?ut.PointToPoint:this.isModelSelectorActive()?ut.SelectModel:ut.Default}},{key:"startAngleToAngle",value:function(){this.isAngleToAngleActive()||(this.stopTools(!0),this.angleToAngle.start(),this.onStateChanged())}},{key:"pauseAngleToAngle",value:function(){this.angleToAngle.pause(),this.onStateChanged()}},{key:"cancelAngleToAngle",value:function(){this.angleToAngle.cancel(),this.onStateChanged()}},{key:"isAngleToAngleActive",value:function(){return this.angleToAngle.isActive}},{key:"finishAngleToAngle",value:function(){var e=this;this.angleToAngle.finish(this.model).then((function(){e.modified(),e.onStateChanged()})),this.onStateChanged()}},{key:"startPointToPoint",value:function(){this.isPointToPointActive()||(this.stopTools(!0),this.pointToPoint.start(),this.onStateChanged())}},{key:"pausePointToPoint",value:function(){this.pointToPoint.pause(),this.onStateChanged()}},{key:"cancelPointToPoint",value:function(){this.pointToPoint.cancel(),this.onStateChanged()}},{key:"isPointToPointActive",value:function(){return this.pointToPoint.isActive}},{key:"finishPointToPoint",value:function(){var e=this;this.pointToPoint.finish(this.model).then((function(){e.modified(),e.onStateChanged()})),this.onStateChanged()}},{key:"startModelSelector",value:function(){this.isModelSelectorActive()||(this.stopTools(!0),this.viewer.toolController.activateTool(this.modelSelector.getName()),this.onStateChanged())}},{key:"isModelSelectorActive",value:function(){return this.modelSelector.active}},{key:"stopModelSelector",value:function(){this.isModelSelectorActive()&&(this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.modelSelector.getName()))}},{key:"startFreeTransform",value:function(){this.isFreeTransformActive()||(this.stopTools(!0),this.setTransformToolActive(!0),this.onStateChanged())}},{key:"pauseFreeTransform",value:function(){this.setTransformToolActive(!1)}},{key:"isFreeTransformActive",value:function(){var e=this.modelTransformTool.getName();return this.viewer.toolController.isToolActivated(e)}},{key:"stopTools",value:function(e){this.isPointToPointActive()&&(e?this.pausePointToPoint():this.cancelPointToPoint()),this.isAngleToAngleActive()&&(e?this.pauseAngleToAngle():this.cancelAngleToAngle()),this.isFreeTransformActive()&&this.pauseFreeTransform(),this.isModelSelectorActive()&&this.stopModelSelector()}},{key:"setModel",value:function(e){var t;et(ot(l.prototype),"setModel",this).call(this,e),this.panel.setModel(e),this.updateColorTheming(),this.onTabChanged(),this.transformEdit.setModel(e),e&&this.stopModelSelector(),e&&!this.isModelEditable(e)&&(null===(t=this.modelTransformTool)||void 0===t||t.setModel(null))}},{key:"setHoverHighlighting",value:function(e){this.modelSelector.setHoverHighlighting(e)}},{key:"isAnimationActive",value:function(){return this.pointToPoint.isAnimationActive()||this.angleToAngle.isAnimationActive()}},{key:"isResetEnabled",value:function(){return!!this.model&&!this.isPendingReset(this.model)&&(!!this.hasPendingChanges(this.model)||this.hasSavedTransform(this.model))}},{key:"resetToOriginalFileTransform",value:function(){if(!this.isResetEnabled())return!1;var e=this.getOriginalFileTransform(this.model);return this.viewer.impl.setPlacementTransform(this.model,e),this.modified(!0),!0}},{key:"getSelectableModels",value:function(){return this.panel.getSelectableModels()}},{key:"handlePositionEdit",value:function(e){this.positionEditInProgress=!0;var t=this.unitHandler.fromDisplayUnitsVec3(this.model.getUnitString(),e);this.transformEdit.update(),this.transformEdit.setPosition(t),this.transformEdit.apply(),this.modified(),this.positionEditInProgress=!1}},{key:"handleRotationZEdit",value:function(e){this.transformEdit.update(),this.transformEdit.setRotationZ(e),this.transformEdit.apply(),this.modified()}},{key:"getEditPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.model;if(e){var t=new THREE.Vector3;return te.readPlacementValues(e,t),this.unitHandler.toDisplayUnitsVec3(e.getUnitString(),t)}}},{key:"getEditRotationZ",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.model;if(e){var t=new THREE.Vector3;return te.readPlacementValues(e,void 0,t),t.z}}},{key:"discardChanges",value:function(){for(var e in this.pendingChanges){var t=this.pendingChanges[e].model,n=this.getLastSavedPlacement(t);this.viewer.impl.setPlacementTransform(t,n)}this.pendingChanges={}}},{key:"getChangedModelNames",value:function(){return Object.values(this.pendingChanges).map((function(e){return e.model.getDocumentNode().getModelName()}))}},{key:"setModelSelectionFilter",value:function(e){this.modelSelectionFilter=e}},{key:"setModelEditFilter",value:function(e){this.modelEditFilter=e}},{key:"isModelSelectable",value:function(e){return!this.modelSelectionFilter||this.modelSelectionFilter(e)}},{key:"isModelEditable",value:function(e){return!(this.modelEditFilter&&!this.modelEditFilter(e))&&!1===this.isAlignmentLockedSync(e)}},{key:"setHomeCameraTopView",value:function(e){var t=this.createStableModelOrthoView(e);this.viewer.autocam.setHomeViewFrom(t)}},{key:"fitSelectedModelToView",value:function(){this.model&&this.pointToPoint.fitModelToView(this.model),this.modified()}},{key:"isTransformToolDragging",value:function(){return this.modelTransformTool.isDragging()}},{key:"flyToModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.model;if(e){var t=this.createStableModelOrthoView(e),n=!1;this.flyToAnim=Autodesk.Viewing.Private.flyToView(this.viewer,t,this.flyToDuration,null,n)}}},{key:"isModelVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.model,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;this.frustumIntersector.reset(this.viewer.impl.camera);var n=e===this.model&&this.angleToAngle.isAnimationActive(),i=t&&n&&this.angleToAngle.animEndMatrix,o=this.getModelSpaceFuzzyBox(e),r=i||e.getPlacementTransform(),s=e.getGlobalOffset().clone().multiplyScalar(-1),a=o.clone().applyMatrix4(r).translate(s),l=this.frustumIntersector.intersectsBox(a);return l!==Autodesk.Viewing.Private.FrustumIntersector.OUTSIDE}},{key:"getEditDisplayUnit",value:function(){return this.unitHandler.getMainDisplayUnit()}},{key:"isPlacementEqual",value:function(e){if(this.model){var t=e.getPlacementTransform(),n=this.model.getPlacementTransform();return t.equals(n)}}},{key:"copyPlacementFrom",value:function(e){if(!this.model||this.isPlacementEqual(e))return!1;var t=e.getPlacementTransform();this.viewer.impl.setPlacementTransform(this.model,t),this.modified()}},{key:"getModelSpaceFuzzyBox",value:function(e){var t=this.fuzzyBoxCache[e.id];return t||(t=e.getFuzzyBox({ignoreTransforms:!0,quantil:.9}),this.fuzzyBoxCache[e.id]=t),t}},{key:"createStableModelOrthoView",value:function(e){var t=e===this.model&&this.angleToAngle.isAnimationActive()&&this.angleToAngle.animEndMatrix;return this.createModelOrthoView(e,t)}},{key:"createModelOrthoView",value:function(e,t){var n=this.getModelSpaceFuzzyBox(e),i=this.viewer.getCamera(),o=new THREE.Vector3(0,1,0),r=Autodesk.Viewing.UnifiedCamera.getViewParamsFromBox(n,!1,i.aspect,o,i.fov);r.isPerspective=!1,r.worldup=i.worldup.clone();var s=null;if(t){s=t.clone();var a=e.getGlobalOffset();s.elements[12]-=a.x,s.elements[13]-=a.y,s.elements[14]-=a.z}var l=s||e.getModelToViewerTransform();return l&&Autodesk.Viewing.UnifiedCamera.transformViewParams(r,l),r.pivot=r.target.clone(),r}},{key:"onStateChanged",value:function(){this.updateTransformTool(),this.fireEvent({type:Autodesk.ModelAlignment.Events.STATE_CHANGED})}},{key:"setTransformToolActive",value:function(e){if(this.isFreeTransformActive()!=e){var t=this.modelTransformTool.getName();e?this.viewer.toolController.activateTool(t):this.viewer.toolController.deactivateTool(t)}}},{key:"updateTransformTool",value:function(){var e=this.getToolMode(),t=this.model&&e===ut.Default;this.setTransformToolActive(t)}},{key:"onTabChanged",value:function(){var e=this.panel.selectedTabId;this.onStateChanged(),e===Se.TabIds.PointToPoint?this.startPointToPoint():this.cancelPointToPoint(),e===Se.TabIds.AngleToAngle?this.startAngleToAngle():this.cancelAngleToAngle()}},{key:"connectModelsPanel",value:function(){var e=this,t=this.viewer.getExtension("Autodesk.ModelsPanel");if(!t)return this.onExtensionLoaded=function(t){return"Autodesk.ModelsPanel"===t.extensionId&&e.connectModelsPanel()},void this.viewer.addEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded);this.modelsPanel=t.panel,this.modelsPanel.addEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!0)}},{key:"disconnectModelsPanel",value:function(){this.modelsPanel&&(this.modelsPanel.removeEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!1))}},{key:"onModelPanelSelect",value:function(e){this.setModel(e.item.model)}},{key:"connectPointToPoint",value:function(){var e=this;this.panel.addEventListener(Se.Events.FROM_POINT_CHANGED,(function(t){return e.pointToPoint.setFrom(t.fromPoint)})),this.panel.addEventListener(Se.Events.TO_POINT_CHANGED,(function(t){return e.pointToPoint.setTo(t.toPoint)})),this.panel.addEventListener(Se.Events.OFFSET_CHANGED,(function(t){return e.pointToPoint.setOffset(t.offset)})),this.panel.addEventListener(Se.Events.FROM_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectFrom()})),this.panel.addEventListener(Se.Events.TO_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectTo()})),this.panel.addEventListener(Se.Events.APPLY_PTP_PRESSED,(function(){e.pointToPoint.apply(e.panel.model),e.modified()})),this.panel.addEventListener(Se.Events.FIT_TO_VIEW_BUTTON_PRESSED,(function(){e.pointToPoint.fitModelToView(e.panel.model),e.modified()})),this.pointToPoint.addEventListener(He.Events.FROM_POINT_SELECTED,(function(t){return e.panel.onFromSelected(t.point)})),this.pointToPoint.addEventListener(He.Events.FROM_POINT_HOVERED,(function(t){return e.panel.onFromHovered(t.point)})),this.pointToPoint.addEventListener(He.Events.TO_POINT_HOVERED,(function(t){return e.panel.onToHovered(t.point)})),this.pointToPoint.addEventListener(He.Events.TO_POINT_SELECTED,(function(t){return e.panel.onToSelected(t.point)}))}},{key:"connectAngleToAngle",value:function(){var e=this;this.panel.addEventListener(Se.Events.MODEL_SELECTED,(function(){return e.setModel(e.panel.model)})),this.panel.addEventListener(Se.Events.CENTER_CHANGED,(function(t){return e.angleToAngle.setCenter(t.center)})),this.panel.addEventListener(Se.Events.FROM_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeFromAngle(ct(t.angle))})),this.panel.addEventListener(Se.Events.TO_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeToAngle(ct(t.angle))})),this.panel.addEventListener(Se.Events.OFFSET_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeOffset(ct(t.angle))})),this.panel.addEventListener(Se.Events.CENTER_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectCenter()})),this.panel.addEventListener(Se.Events.FROM_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngle()})),this.panel.addEventListener(Se.Events.TO_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngle()})),this.panel.addEventListener(Se.Events.FROM_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngleEdge()})),this.panel.addEventListener(Se.Events.TO_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngleEdge()})),this.panel.addEventListener(Se.Events.APPLY_ATA_PRESSED,(function(){e.angleToAngle.apply(e.panel.model),e.modified()})),this.angleToAngle.addEventListener(Qe.Events.CENTER_HOVERED,(function(t){return e.panel.onCenterHovered(t.point)})),this.angleToAngle.addEventListener(Qe.Events.CENTER_SELECTED,(function(t){return e.panel.onCenterSelected(t.point)})),this.angleToAngle.addEventListener(Qe.Events.FROM_ANGLE_HOVERED,(function(t){return e.panel.onFromAngleHovered(t.angle)})),this.angleToAngle.addEventListener(Qe.Events.FROM_ANGLE_SELECTED,(function(t){return e.panel.onFromAngleSelected(t.angle)})),this.angleToAngle.addEventListener(Qe.Events.TO_ANGLE_HOVERED,(function(t){return e.panel.onToAngleHovered(t.angle)})),this.angleToAngle.addEventListener(Qe.Events.TO_ANGLE_SELECTED,(function(t){return e.panel.onToAngleSelected(t.angle)}))}},{key:"connectModelMoveTool",value:function(){var e=this;this.panel.addEventListener(Se.Events.EDIT_POSITION_PRESSED,(function(){return e.viewer.toolController.activateTool(e.modelTransformTool.getName())}))}},{key:"connectModelSelector",value:function(){var e=this;this.panel.addEventListener(Se.Events.SELECT_MODEL_PRESSED,(function(t){e.startModelSelector()})),this.modelSelector.addEventListener(q.Events.MODEL_SELECTED,(function(t){t.model||!e.model?e.setModel(t.model):e.stopModelSelector()}))}},{key:"updateColorTheming",value:function(){for(var e=this.model&&this.model.myData.urn,t=function(t){return e&&t.myData.urn===e},n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i];t(o)?lt(o,this.selectionColor):this.viewer.clearThemingColors(o)}this.viewer.impl.invalidate(!0)}},{key:"onSaveButton",value:function(){this.pointToPoint.skipAnim(),this.angleToAngle.skipAnim(),et(ot(l.prototype),"onSaveButton",this).call(this)}},{key:"onPlacementChanged",value:function(e){e.model===this.model&&(this.positionEditInProgress||this.panel.updateTransformValues(),this.syncAlignments())}},{key:"syncAlignments",value:function(){if(this.model&&!this.model.is2d())for(var e=this.model.myData.urn,t=this.model.getPlacementTransform(),n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i],r=o.myData.urn==e&&o!==this.model;o.is3d()&&r&&this.viewer.impl.setPlacementTransform(o,t)}}},{key:"onDisplayUnitsChanged",value:function(){this.panel.updateTransformValues()}}],n&&$e(t.prototype,n),l}(w);dt.ToolModes=ut,at.ModelAlignment=dt,at.ModelAlignmentPanel=Se,at.AngleToAngle=Qe,at.ModelSelector=q,at.ModelTransformTool=a,Autodesk.Viewing.theExtensionManager.registerExtension(rt,dt);var ht,ft,gt,vt,mt,pt,Et,yt,Tt,At,Pt=(ht=new THREE.Quaternion,ft=new THREE.Quaternion,gt=new THREE.Quaternion,vt=new THREE.Matrix4,mt=new THREE.Matrix4,pt=new THREE.Matrix4,Et=new THREE.Vector3,yt=new THREE.Vector3,Tt=new THREE.Matrix4,At=new THREE.Matrix4,function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=o.onChange,s=o.onEnd,a=o.applyTranslation,l=void 0===a||a,c=o.applyRotation,u=void 0===c||c,d=o.applyScale,h=void 0===d||d,f=o.duration,g=void 0===f?1:f,v=o.originalMatrix?o.originalMatrix.clone():void 0,m=n.clone().sub(e),p=e.distanceTo(t),E=n.distanceTo(i),y=E/p,T=t.clone().sub(e).normalize(),A=i.clone().sub(n).normalize();ht.setFromUnitVectors(T,A),Tt.identity().setPosition(e),At.identity().setPosition(e.clone().multiplyScalar(-1));var P=function(e){if(e=THREE.Math.smootherstep(e,0,1),mt.identity(),l&&(Et.lerpVectors(yt,m,e),mt.makeTranslation(Et.x,Et.y,Et.z)),mt.multiply(Tt),u&&(THREE.Quaternion.slerp(ft,ht,gt,e),pt.makeRotationFromQuaternion(gt),mt.multiply(pt)),h){var t=Autodesk.Viewing.Private.lerp(1,y,e);vt.makeScale(t,t,t),mt.multiply(vt)}mt.multiply(At),v&&mt.multiply(v),r&&r(mt)},k=Autodesk.Viewing.Private.fadeValue(0,1,g,P,s);return k}),kt=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Quaternion,r=new THREE.Quaternion,s=new THREE.Vector3,a=new THREE.Vector3,l=new THREE.Quaternion;return function(c,u,d,h){return c.decompose(e,o,n),u.decompose(t,r,i),s.lerpVectors(e,t,d),a.lerpVectors(n,i,d),THREE.Quaternion.slerp(o,r,l,d),h.compose(s,l,a),h}}();function bt(e){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bt(e)}function St(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ct(e,t){return Ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ct(e,t)}function wt(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dt(e){return Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Dt(e)}var Mt={SOURCE_POINT_SELECTION_STARTED:"sourcePointSelectionStarted",DEST_POINT_SELECTION_STARTED:"destPointSelectionStarted"},Ot=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ct(e,t)}(s,Autodesk.Edit3D.NPointPicker);var t,n,i,o,r=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Dt(i);if(o){var n=Dt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return wt(this,e)});function s(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var o={width:"34px",height:"34px",padding:"7px",boxSizing:"border-box",borderRadius:"20px",border:"1px solid",backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.White},a=Object.assign({},o,{borderColor:Autodesk.Edit3D.NPointPicker.Colors.Blue,color:Autodesk.Edit3D.NPointPicker.Colors.Blue}),l=Object.assign({},o,{borderColor:Autodesk.Edit3D.NPointPicker.Colors.Red,color:Autodesk.Edit3D.NPointPicker.Colors.Red}),c={draggable:!0,colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red],icons:[Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle],labels:["1","2","1","2"],labelStyles:[a,l,a,l],connections:[{fromIndex:0,toIndex:2,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Blue},{fromIndex:1,toIndex:3,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Red}],stops:[1]};return(i=r.call(this,e,t,n,4,c)).addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTION_STARTED,(function(e){var t=e.index;0!==t||i.pointValid[0]?2!==t||i.pointValid[2]||i.fireEvent({type:Mt.DEST_POINT_SELECTION_STARTED}):i.fireEvent({type:Mt.SOURCE_POINT_SELECTION_STARTED})})),i}return t=s,n=[{key:"apply",value:function(e,t){var n=this;if(!this.anim){var i={transform:e.getPlacementTransform().clone(),model:e,s0:this.points[0].clone(),s1:this.points[1].clone(),t0:this.points[2].clone(),t1:this.points[3].clone()},o=e.getPlacementTransform().clone(),r=this.points[0].clone(),s=this.points[1].clone(),a=this.points[2].clone(),l=this.points[3].clone();t&&(a.add(t),l.add(t)),this.anim=Pt(r,s,a,l,{onChange:function(t){n.viewer.impl.setPlacementTransform(e,t.multiply(o))},onEnd:function(){n.alignmentBackup=i,n.anim=null,n.clear()}})}}},{key:"restorePreviousTransform",value:function(e){var t=this;if(this.alignmentBackup&&!this.anim){var n=this.alignmentBackup,i=n.transform,o=n.model,r=n.s0,s=n.s1,a=n.t0,l=n.t1;this.anim=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.onChange,o=n.onEnd,r=n.duration,s=void 0===r?1:r,a=new Autodesk.Viewing.Private.LmvMatrix4(t.isDoublePrecision),l=function(n){n=Autodesk.Viewing.Private.smootherStep(n),kt(e,t,n,a),i&&i(a)};return Autodesk.Viewing.Private.fadeValue(0,1,s,l,o)}(o.getPlacementTransform().clone(),i,{onChange:function(e){t.viewer.impl.setPlacementTransform(o,e)},onEnd:function(){e?(t.setPoint(0,r),t.setPoint(1,s),t.setPoint(2,a),t.setPoint(3,l),t.lastSelectedPoint=3,t.anim=null,t.clearAlignmentBackup(),t.startSelect(),t.fireEvent({type:Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTED,point:a,index:3})):(t.anim=null,t.clearAlignmentBackup())}})}}},{key:"hasAlignmentBackup",value:function(){return!!this.alignmentBackup}},{key:"clearAlignmentBackup",value:function(){this.alignmentBackup=null}},{key:"skipAnim",value:function(){var e;null===(e=this.anim)||void 0===e||e.skip()}},{key:"isSelectingSourcePointsDone",value:function(){return 0!==this.selectingIndex&&1!==this.selectingIndex&&this.pointValid[0]&&this.pointValid[1]}},{key:"isAnimationActive",value:function(){var e;return null===(e=this.anim)||void 0===e?void 0:e.isRunning}}],n&&St(t.prototype,n),s}();Ot.Events=Mt;var _t={en:JSON.parse('{"@@locale":"en","@@context":"SheetAlignment Extension","Align 2D drawing":"Align 2D drawing"}')},Rt=n(55877);function xt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Nt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.overlayName=n,this.materialManager=t.impl.matman(),this.isVisible=!1,this.lock=!1}var t,n;return t=e,n=[{key:"createBoundsPlane",value:function(){this.viewer.impl.createOverlayScene(this.overlayName);var e=new THREE.PlaneBufferGeometry(1,1),t=[];t.push(new THREE.Vector3(-.5,-.5,0)),t.push(new THREE.Vector3(-.5,.5,0)),t.push(new THREE.Vector3(.5,.5,0)),t.push(new THREE.Vector3(.5,-.5,0));var n=new THREE.Geometry,i=n.vertices;i.push(t[0]),i.push(t[1]),i.push(t[1]),i.push(t[2]),i.push(t[2]),i.push(t[3]),i.push(t[3]),i.push(t[0]),this.fillMaterial=new THREE.MeshPhongMaterial({color:13495031,side:THREE.DoubleSide,specular:0,transparent:!0,opacity:.7,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:5,depthTest:!1,depthWrite:!1}),this.edgeMaterial=new THREE.LineBasicMaterial({color:0,side:THREE.DoubleSide,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),this.fillMaterial.doNotCut=!0,this.edgeMaterial.doNotCut=!0,this.solidName=this.materialManager._getMaterialHash(null,"ModelSheetTransition.solid"),this.materialManager.addMaterial(this.solidName,this.fillMaterial,!0),this.edgesName=this.materialManager._getMaterialHash(null,"ModelSheetTransition.edges"),this.materialManager.addMaterialNonHDR(this.edgesName,this.edgeMaterial);var o=new THREE.Mesh(e,this.fillMaterial),r=new THREE.Line(n,this.edgeMaterial,THREE.LinePieces),s=new THREE.Group;return s.add(o),s.add(r),s.matrixAutoUpdate=!1,s}},{key:"getBoundsPlane",value:function(){return this.boundsPlane||(this.boundsPlane=this.createBoundsPlane()),this.boundsPlane}},{key:"setFromMatrix",value:function(e){var t=this.getBoundsPlane();t.matrix.copy(e),t.matrixWorldNeedsUpdate=!0}},{key:"setMaterialsOpacity",value:function(e){this.fillMaterial.opacity=.7*e,this.edgeMaterial.opacity=1*e,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"setVisible",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isVisible!==e){this.fadeAnim&&(this.fadeAnim.stop(),this.fadeAnim=null),this.isVisible=e;var i=this.getBoundsPlane(),o=e?0:1;if(e&&this.viewer.impl.addOverlay(this.overlayName,i),n){var r=function(e){e=Autodesk.Viewing.Private.smootherStep(e),t.setMaterialsOpacity(e)},s=function(){e||t.viewer.impl.removeOverlay(t.overlayName,i),t.fadeAnim=null};this.fadeAnim=Autodesk.Viewing.Private.fadeValue(o,1-o,.3,r,s)}else e?this.setMaterialsOpacity(1):this.viewer.impl.removeOverlay(this.overlayName,i);this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"destroy",value:function(){this.setVisible(!1),this.solidName&&(this.materialManager.removeMaterial(this.solidName),this.materialManager.removeMaterial(this.edgesName)),this.viewer.impl.removeOverlayScene(this.overlayName)}}],n&&xt(t.prototype,n),e}();function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Ht(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function Lt(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){Ht(r,i,o,s,a,"next",e)}function a(e){Ht(r,i,o,s,a,"throw",e)}s(void 0)}))}}function Bt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function It(e,t,n){return It="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ut(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},It(e,t,n||e)}function Ft(e,t){return Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ft(e,t)}function Gt(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?zt(e):t}function zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ut(e){return Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ut(e)}var jt=n(23493),Zt="Autodesk.SheetAlignment",Wt=AutodeskNamespace("Autodesk.SheetAlignment"),Yt=1e-4,qt={SURFACE_SELECTED:"surfaceSelected",SELECT_SHEET:"selectSheet",SHEET_ALIGNMENT_START:"sheetAlignmentStart",SHEET_ALIGNMENT_END:"sheetAlignmentEnd",SHEET_ALIGNMENT_SAVED:"sheetAlignmentSaved",SHEET_ALIGNMENT_SAVE_FAILED:"sheetAlignmentSaveFailed",CROP_CHANGED:"cropChanged",GIZMO_CHANGED:"gizmoChanged"},Qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(h,e);var t,n,i,o,r,s,a,l,c,u,d=(c=h,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ut(c);if(u){var n=Ut(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Gt(this,e)});function h(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(n=d.call(this,e,t)).name=Zt,n.tmpBox=new THREE.Box3,n.onCropChanged=n.onCropChanged.bind(zt(n)),n.onGizmoChanged=n.onGizmoChanged.bind(zt(n)),n.fetchAndCacheVersionUrns=n.fetchAndCacheVersionUrns.bind(zt(n)),n.fadeDuration=.3,n.hoverColor=new THREE.Color(0,.5,1),n.modelTransformToolAxis=["X","Y","XY"],n.getVersionUrn=n.options.getVersionUrn,n.onCropThrottled=jt((function(e){n.fireEvent({type:qt.CROP_CHANGED,cropRegion:e})}),3e3),n.onGizmoThrottled=jt((function(){n.fireEvent({type:qt.GIZMO_CHANGED})}),3e3),n}return t=h,n=[{key:"load",value:(l=Lt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(_t),this.model=null,this.target3DModel=null,e.next=5,It(Ut(h.prototype),"load",this).call(this);case 5:return e.next=7,this.viewer.loadExtension("Autodesk.Crop",{disableMoveTool:!0});case 7:return this.cropExtension=e.sent,this.cropExtension.addEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),e.next=11,this.viewer.loadExtension("Autodesk.AEC.ViewportsExtension");case 11:this.viewportsExtension=e.sent,this.fourPointsAlignment=new Ot(this.viewer,this.coordPicker,this.screenOverlay),this.onPointSelectionStarted=this.onPointSelectionStarted.bind(this),this.onPointPicked=this.onPointPicked.bind(this),this.fourPointsAlignment.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTION_STARTED,this.onPointSelectionStarted),this.fourPointsAlignment.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTED,this.onPointPicked),this.modelTransformTool.addEventListener(Autodesk.ModelAlignment.ModelTransformTool.Events.MODEL_MOVED,this.onGizmoChanged),this.onSheetSelected=this.onSheetSelected.bind(this),this.onSurfacePicked=this.onSurfacePicked.bind(this),this.prepareForPickingSurface=this.prepareForPickingSurface.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.viewer.registerContextMenuCallback(Zt,this.onContextMenu),this.targetPos=null,this.targetNormal=null,this.animationHandleMap={},this.boundsPlane=new Nt(this.viewer,"SheetAlignment_Extension_Overlay"),this.getVersionUrn&&(this.isLatestUrnCache={},this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.fetchAndCacheVersionUrns),this.fetchAndCacheVersionUrns());case 28:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"unload",value:function(){this.endAlignment(),It(Ut(h.prototype),"unload",this).call(this),this.fourPointsAlignment&&(this.fourPointsAlignment.dtor(),this.fourPointsAlignment=null),this.clearHighlight(),this.cropExtension.removeEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),this.model=null,this.target3DModel=null,this.viewer.unregisterContextMenuCallback(Zt),this.animationHandleMap={},this.boundsPlane.destroy(),this.boundsPlane=null,this.getVersionUrn&&(this.isLatestUrnCache=null,this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.fetchAndCacheVersionUrns))}},{key:"fetchAndCacheVersionUrns",value:function(){var e=this;this.viewer.impl.get3DModels().forEach(function(){var t=Lt(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.getModelKey(),void 0!==e.isLatestUrnCache[i]){t.next=5;break}return t.next=4,e.isAlignmentAllowed(n.getDocumentNode());case 4:e.isLatestUrnCache[i]=t.sent;case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"isAlignmentAllowed",value:(a=Lt(regeneratorRuntime.mark((function e(t){var n,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:if(this.getVersionUrn){e.next=5;break}return console.warn("getVersionUrn not provided to SheetAlignment extension"),e.abrupt("return",!0);case 5:return n=Autodesk.Viewing.fromUrlSafeBase64(t.getRootNode().urn()),i=t.lineageUrn(),e.prev=7,e.next=10,this.getVersionUrn(i);case 10:o=e.sent,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),console.error("getVersionUrn failed or canceled");case 16:return e.abrupt("return",n===o);case 17:case"end":return e.stop()}}),e,this,[[7,13]])}))),function(e){return a.apply(this,arguments)})},{key:"setHasAlignPermission",value:function(e){this.hasPermission=e}},{key:"getRightVector",value:function(e){var t=this.viewer.navigation.getWorldUpVector(),n=new THREE.Vector3;return n.crossVectors(e,t),n.lengthSq()<Yt&&(Math.abs(e.z)>=Math.abs(e.y)?t.set(0,1,0):t.set(0,0,1),n.crossVectors(e,t)),n.normalize()}},{key:"applyInitialSheetTransform",value:function(){if(this.targetPos&&this.targetNormal){var e=this.model.getBoundingBox(!0,!0).getCenter(new THREE.Vector3),t=this.targetNormal,n=this.targetPos.clone().sub(e).sub(t.clone().multiplyScalar(Yt)),i=this.getRightVector(t).cross(t).normalize(),o=new THREE.Matrix4;o.lookAt(new THREE.Vector3,t,i);var r=(new THREE.Matrix4).makeTranslation(-e.x,-e.y,-e.z),s=(new THREE.Matrix4).makeTranslation(e.x,e.y,e.z),a=(new THREE.Matrix4).makeTranslation(n.x,n.y,n.z).multiply(s).multiply(o).multiply(r);this.viewer.impl.setPlacementTransform(this.model,a),this.modified()}}},{key:"setModel",value:function(e){this.model!==e&&(this.cropExtension.setModel(e),It(Ut(h.prototype),"setModel",this).call(this,e))}},{key:"onSheetSelected",value:(s=Lt(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSheet(t,n);case 2:if(e.sent){e.next=6;break}return this.endAlignment(!1),e.abrupt("return");case 6:this.showSheet();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"showSheet",value:(r=Lt(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clearSurfacePicking(),this.waitingForPlacementApproval=!1,this.boundsPlane.setVisible(!1),this.clearHighlight(),this.model){e.next=6;break}return e.abrupt("return");case 6:return this.cropExtension.cropToModelBounds(!0),this.viewer.impl.setDoNotCut(this.model,!0),this.fourPointsAlignment.clear(),this.fourPointsAlignment.attachPointsToModel(this.model,[0,1]),-1===this.viewer.getVisibleModels().indexOf(this.model)&&this.viewer.showModel(this.model),this.applyInitialSheetTransform(),e.next=14,this.fitCameraToSheet();case 14:this.modelTransformTool.setModel(this.model,this.getMinCroppedBox(),!0),this.viewer.impl.changePaperVisibility(this.model,!1,!0,(function(){t.startPointToPointSelection(),t.show()}),1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setTarget3DModel",value:function(e){this.target3DModel=e,this.target3DModel&&this.fourPointsAlignment.attachPointsToModel(e,[2,3])}},{key:"onSaveButton",value:function(){this.fourPointsAlignment.skipAnim(),It(Ut(h.prototype),"onSaveButton",this).call(this)}},{key:"startPointToPointSelection",value:function(){this.onAlignmentStart(),this.fourPointsAlignment.startSelect()}},{key:"applyPointsToPoints",value:function(){var e;this.transformBackup=this.model.getPlacementTransform().clone();var t=null===(e=this.targetNormal)||void 0===e?void 0:e.clone().negate().multiplyScalar(Yt);this.fourPointsAlignment.apply(this.model,t),this.modified()}},{key:"restorePreviousTransform",value:function(e){this.fourPointsAlignment.restorePreviousTransform(e)}},{key:"hideModel",value:function(e){var t,n;this.viewer.impl.changePaperVisibility(e,!0),this.viewer.impl.setPlacementTransform(e,new THREE.Matrix4),null===(t=(n=this.options).hideSheet)||void 0===t||t.call(n,e)}},{key:"endAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.hide(),this.clearHighlight(),this.fourPointsAlignment.clearAlignmentBackup(),this.fourPointsAlignment.clear(),this.cropExtension.deactivate(),this.clearSurfacePicking(),this.waitingForPlacementApproval=!1,this.boundsPlane.setVisible(!1);var n=this.model;t&&n&&this.hideModel(n),this.setModel(null),this.setTarget3DModel(null),this.restoreToolbar(),this.fireEvent({type:qt.SHEET_ALIGNMENT_END,isSaving:e,model:n})}},{key:"goBackToSurfacePicking",value:function(){var e=this.model,t=null==e?void 0:e.getDocumentNode(),n=this.target3DModel;this.endAlignment(),t&&(this.prepareForPickingSurface(t.urn(!0),t.guid()),this.setModel(e),this.setTarget3DModel(n),this.setBoundsPlane())}},{key:"goBackToPickPointsOnSheet",value:function(){this.fourPointsAlignment.cancelPointSelection(),this.fourPointsAlignment.clearPoint(2),this.fourPointsAlignment.clearPoint(3),this.fourPointsAlignment.lastSelectedPoint=1,this.isolate2DSheet()}},{key:"areAllPointsSet",value:function(){return this.fourPointsAlignment.areAllPointsSet()}},{key:"fitCameraToSheet",value:function(){var e=this;if(this.model){this.viewer.navigation.toOrthographic();var t=this.getMinCroppedBox(),n=t.getSize(new THREE.Vector3);t.expandByVector(new THREE.Vector3(n.x*this.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,n.y*this.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN,0));var i=this.model.getModelToViewerTransform()||new THREE.Matrix4,o=t.getCenter(new THREE.Vector3),r=o.clone().applyMatrix4(i),s=o;s.z-=t.getSize(new THREE.Vector3).y,s.applyMatrix4(i);var a=new THREE.Matrix4;a.extractRotation(i);var l={position:r,target:s,up:new THREE.Vector3(0,1,0).applyMatrix4(a).normalize()};return new Promise((function(t){Autodesk.Viewing.Private.flyToView(e.viewer,l,.5,t,!1)}))}}},{key:"fitCameraToTargetModel",value:function(){if(this.target3DModel){var e=(new THREE.Box3).copy(this.target3DModel.getBoundingBox());this.viewer.navigation.fitBounds(!1,e,!1)}}},{key:"show",value:function(){this.model&&!this.active&&(this.active=!0,this.fourPointsAlignment.setVisible(!0),this.fourPointsAlignment.continuePointSelectionIfNeeded(),this.cropExtension.activate(),this.viewer.toolController.isToolActivated(this.modelTransformTool.getName())||this.viewer.toolController.activateTool(this.modelTransformTool.getName()))}},{key:"hide",value:function(){this.active&&(this.active=!1,this.fourPointsAlignment.cancelPointSelection(),this.fourPointsAlignment.setVisible(!1),this.viewer.toolController.deactivateTool(this.modelTransformTool.getName()),this.clearIsolation())}},{key:"getMinCroppedBox",value:function(){var e;if(!this.model)return null;var t=this.tmpBox.copy(this.model.getBoundingBox(!0)),n=null===(e=this.cropExtension.getCurrentCropRegion())||void 0===e?void 0:e.bbox;return n&&t.intersect(n),t}},{key:"onCropChanged",value:function(){var e=this.getMinCroppedBox();this.modelTransformTool.setModel(this.model,e,!0);var t=this.cropExtension.getCurrentCropRegion();this.modified(t),this.onCropThrottled(t)}},{key:"onGizmoChanged",value:function(){this.onGizmoThrottled()}},{key:"onPointSelectionStarted",value:function(e){var t=e.index;0===t||1===t?this.isolate2DSheet():this.isolate3DModel(),this.cropExtension.activate()}},{key:"onPointPicked",value:function(){this.fourPointsAlignment.areAllPointsSet()&&this.clearIsolation()}},{key:"isolate2DSheet",value:function(){var e=this;this.animateModelVisibility(this.model,!0),this.animateModelVisibility(this.target3DModel,!1),this.coordPicker.setSnapFilter((function(t){return t.modelId===e.model.id}))}},{key:"isolate3DModel",value:function(){var e=this;this.animateModelVisibility(this.model,!1),this.animateModelVisibility(this.target3DModel,!0),this.coordPicker.setSnapFilter((function(t){return t.modelId===e.target3DModel.id}))}},{key:"clearIsolation",value:function(){this.animateModelVisibility(this.model,!0),this.animateModelVisibility(this.target3DModel,!0),this.coordPicker.setSnapFilter(null)}},{key:"isAnimationActive",value:function(){return this.fourPointsAlignment.isAnimationActive()}},{key:"animateModelVisibility",value:function(e,t){if(e)return e.is2d()?this.animateModelVisibility2D(e,t):this.animateModelVisibility3D(e,t)}},{key:"animateModelVisibility2D",value:function(e,t){var n;null===(n=e.visibilityManager)||void 0===n||n.setAllVisibility(t),this.viewer.impl.changePaperVisibility(e,!1)}},{key:"animateModelVisibility3D",value:function(e,t){var n,i=this;t&&(null===(n=e.visibilityManager)||void 0===n||n.setAllVisibility(!0));var o=this.viewer.impl.matman(),r=Object.values(o.getModelMaterials(e,!0).mats),s=this.viewer.impl.fadeMaterial.opacity,a=function(e){r.forEach((function(n){var i=n.opacity,o=t?n.origOpacity:s;n.opacity=(1-e)*i+o*e})),i.viewer.impl.invalidate(!0)};return this.animationHandleMap[e.id]&&(this.animationHandleMap[e.id].stop(),delete this.animationHandleMap[e.id]),r.forEach((function(e){void 0===e.origOpacity&&(e.origOpacity=e.opacity,e.origTransparent=e.transparent,e.transparent=!0)})),new Promise((function(n){i.animationHandleMap[e.id]=Autodesk.Viewing.Private.fadeValue(0,1,i.fadeDuration,a,(function(){var o;t?r.forEach((function(e){e.opacity=e.origOpacity,e.transparent=e.origTransparent,delete e.origOpacity,delete e.origTransparent})):null===(o=e.visibilityManager)||void 0===o||o.setAllVisibility(!1),delete i.animationHandleMap[e.id],n()}))}))}},{key:"mirrorX",value:function(){var e=this.model.getPlacementTransform(),t=new THREE.Matrix4;t.elements[5]=-1;var n=this.model.getBoundingBox(!0,!0).getSize(new THREE.Vector3),i=(new THREE.Matrix4).makeTranslation(0,-n.y,0);e.multiply(t).multiply(i),this.viewer.impl.setPlacementTransform(this.model,e)}},{key:"mirrorY",value:function(){var e=this.model.getPlacementTransform(),t=new THREE.Matrix4;t.elements[0]=-1;var n=this.model.getBoundingBox(!0,!0).getSize(new THREE.Vector3),i=(new THREE.Matrix4).makeTranslation(-n.x,0,0);e.multiply(t).multiply(i),this.viewer.impl.setPlacementTransform(this.model,e)}},{key:"onContextMenu",value:function(e,t){var n,i,o=this;if(this.hasPermission&&!(this.waitingForPlacementApproval||this.fourPointsAlignment.hasAlignmentBackup()||this.fourPointsAlignment.isPickerActive())){var r=this.viewer.impl.hitTest(t.canvasX,t.canvasY,!1);if(null==r||null===(n=r.model)||void 0===n?void 0:n.is3d()){var s=r.model.getModelKey();if((!this.isLatestUrnCache||this.isLatestUrnCache[s])&&(null==r||null===(i=r.face)||void 0===i?void 0:i.normal)){var a=r.point,l=this.viewer.impl.getRenderProxy(r.model,r.fragId),c=(new THREE.Matrix3).getNormalMatrix(l.matrixWorld),u=r.face.normal.clone().applyMatrix3(c).normalize(),d=r.model,h={title:"Align 2D drawing",target:function(){o.surfacePreselected=!0,o.onSurfacePicked({point:a,normal:u,modelId:d.id,dbId:r.dbId})}};e.push(h)}}}}},{key:"saveChanges",value:(o=Lt(regeneratorRuntime.mark((function e(){var t,n,i,o,r,s,a,l,c,u,d,h,f,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.model&&this.target3DModel){e.next=2;break}return e.abrupt("return");case 2:if(this.options.alignmentService){e.next=5;break}return console.error("AlignmentService must be set for saving transforms"),e.abrupt("return",!1);case 5:return n=!0,i=this.model,o=this.target3DModel,this.cropExtension.deactivate(),this.viewer.toolController.deactivateTool(this.modelTransformTool.getName()),r=null===(t=i.getPlacementTransform())||void 0===t?void 0:t.clone(),s=i.getDocumentNode(),a=s.getRootNode().urn(),l=s.lineageUrn(),c=s.name(),u=o.getDocumentNode(),d=u.lineageUrn(),h=this.cropExtension.getCurrentCropRegion(),f=i.regionId=i.regionId||(0,Rt.v4)(),this.pendingChanges=[],this.endAlignment(!0,!1),i.setViewportBounds(this.viewer.impl.matman(),h.bbox),null==(g=this.viewer.getExtension("Autodesk.ModelSheetTransition"))||g.cache.transformedModels.set(i,i),e.next=26,this.options.alignmentService.saveRelationship(d,u.name(),l,c,f);case 26:if(n=e.sent,e.t0=n,!e.t0){e.next=32;break}return e.next=31,this.options.alignmentService.saveRegion(a,c,f,h.bbox,r);case 31:e.t0=e.sent;case 32:return(n=e.t0)?(this.viewportsExtension.fireEvent({type:Autodesk.AEC.ViewportsExtension.Events.VIEWPORT_DATA_CREATED_EVENT,models:[i,o]}),null==g||g.setSelectedViewport(f),this.fireEvent({type:qt.SHEET_ALIGNMENT_SAVED,regionId:f,model:i,target3DModel:o})):(this.hideModel(i),this.fireEvent({type:qt.SHEET_ALIGNMENT_SAVE_FAILED,regionId:f,model:i,target3DModel:o})),e.abrupt("return",n);case 35:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"clearHighlight",value:function(){this.viewer.impl.renderer().setRollOverHighlightColor(),this.viewer.impl.pauseHighlight(!1),this.viewer.impl.clearHighlight()}},{key:"clearSurfacePicking",value:function(){this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onSurfacePicked),this.coordPicker.setCursor(),this.coordPicker.setConsumeClickEvents(!0),this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName()),this.viewer.clearSelection()}},{key:"selectSheet",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.target3DModel;if(n){var i=n.getDocumentNode().getRootNode(),o=i.search(Autodesk.Viewing.BubbleNode.SHEET_NODE),r=o.length>0;if(r){var s=Autodesk.Viewing.fromUrlSafeBase64(i.urn()),a=i.getModelName();t={urn:s,bubbleUrn:s,fileName:a}}}this.fireEvent({type:qt.SELECT_SHEET,file:t,onSheetSelected:this.prepareForPickingSurface,from:e?"Contextual":"Panel"})}},{key:"onAlignmentStart",value:function(){this.coordPicker.setSelectionPlane(this.selectionPlane);var e=this.viewer.getToolbar(),t=null==e?void 0:e.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(t)for(var n=t.container.children,i=0;i<n.length;i++)"toolbar-sectionTool"!==n[i].id&&(n[i].style.display="none");var o=this.viewer.getExtension("Autodesk.ModelSheetTransition");null==o||o.hideSelectedSheet(),this.fireEvent({type:qt.SHEET_ALIGNMENT_START})}},{key:"restoreToolbar",value:function(){var e=this.viewer.getToolbar(),t=null==e?void 0:e.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(t)for(var n=t.container.children,i=0;i<n.length;i++)n[i].style.display=""}},{key:"loadSheet",value:(i=Lt(regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.options.loadSheet(t,n);case 4:return i=e.sent,this.setModel(i),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"setBoundsPlane",value:function(){var e,t=(new THREE.Matrix4).makeTranslation(this.targetPos.x,this.targetPos.y,this.targetPos.z),n=this.getRightVector(this.targetNormal).cross(this.targetNormal).normalize(),i=(new THREE.Matrix4).lookAt(new THREE.Vector3,this.targetNormal,n),o=Autodesk.Viewing.Private.convertUnits("m",this.target3DModel.getUnitString(),1,1),r=null===(e=this.model)||void 0===e?void 0:e.getBoundingBox(!0,!0).getSize(new THREE.Vector3),s=(null==r?void 0:r.x)||3*o,a=(null==r?void 0:r.y)||3*o,l=(new THREE.Matrix4).makeScale(s,a,1);t.multiply(i).multiply(l),this.boundsPlane.setFromMatrix(t),this.boundsPlane.setVisible(!0)}},{key:"onSurfacePicked",value:function(e){var t=e.point,n=e.normal,i=e.modelId;if(t&&n&&i){this.clearSurfacePicking(),this.clearHighlight(),this.selectionPlane=new THREE.Plane,this.selectionPlane.setFromNormalAndCoplanarPoint(n,t),this.targetPos=t,this.targetNormal=n.negate();var o=this.viewer.impl.findModel(i);this.setTarget3DModel(o),this.setBoundsPlane(),this.fireEvent({type:qt.SURFACE_SELECTED}),this.surfacePreselected?this.selectSheet(!0):this.startPickingSurface()}}},{key:"prepareForPickingSurface",value:function(e,t){e?(this.onAlignmentStart(),this.loadSheet(e,t),this.surfacePreselected=!1,this.startPickingSurface()):this.endAlignment(!1)}},{key:"startPickingSurface",value:function(){this.viewer.toolController.isToolActivated(this.coordPicker.getName())||this.viewer.toolController.activateTool(this.coordPicker.getName()),this.coordPicker.setConsumeClickEvents(!1),this.viewer.impl.pauseHighlight(!1),this.coordPicker.snapperOff(),this.coordPicker.setCursor("pointer"),this.coordPicker.setSelectionPlane(),this.viewer.impl.renderer().setRollOverHighlightColor(this.hoverColor),this.coordPicker.addEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onSurfacePicked),this.waitingForPlacementApproval=!0}},{key:"isSheetLoading",value:function(){return this.waitingForPlacementApproval&&this.target3DModel&&!this.model}}],n&&Bt(t.prototype,n),h}(w);Wt.SheetAlignment=Qt,Wt.Events=qt,Wt.SupportedExtensions=["rvt","pdf","dwg","dwf","dwfx","dxf","dgn","tif","tiff","png","jpg","jpeg","bmp"],Wt.AnalyticsEventName="viewer.hypermodel.alignment",Autodesk.Viewing.theExtensionManager.registerExtension(Zt,Qt)},62705:(e,t,n)=>{var i=n(55639).Symbol;e.exports=i},44239:(e,t,n)=>{var i=n(62705),o=n(89607),r=n(2333),s=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?o(e):r(e)}},27561:(e,t,n)=>{var i=n(67990),o=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(o,""):e}},31957:(e,t,n)=>{var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=i},89607:(e,t,n)=>{var i=n(62705),o=Object.prototype,r=o.hasOwnProperty,s=o.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=r.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var o=s.call(e);return i&&(t?e[a]=n:delete e[a]),o}},2333:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},55639:(e,t,n)=>{var i=n(31957),o="object"==typeof self&&self&&self.Object===Object&&self,r=i||o||Function("return this")();e.exports=r},67990:e=>{var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},23279:(e,t,n)=>{var i=n(13218),o=n(7771),r=n(14841),s=Math.max,a=Math.min;e.exports=function(e,t,n){var l,c,u,d,h,f,g=0,v=!1,m=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function E(t){var n=l,i=c;return l=c=void 0,g=t,d=e.apply(i,n)}function y(e){return g=e,h=setTimeout(A,t),v?E(e):d}function T(e){var n=e-f;return void 0===f||n>=t||n<0||m&&e-g>=u}function A(){var e=o();if(T(e))return P(e);h=setTimeout(A,function(e){var n=t-(e-f);return m?a(n,u-(e-g)):n}(e))}function P(e){return h=void 0,p&&l?E(e):(l=c=void 0,d)}function k(){var e=o(),n=T(e);if(l=arguments,c=this,f=e,n){if(void 0===h)return y(f);if(m)return clearTimeout(h),h=setTimeout(A,t),E(f)}return void 0===h&&(h=setTimeout(A,t)),d}return t=r(t)||0,i(n)&&(v=!!n.leading,u=(m="maxWait"in n)?s(r(n.maxWait)||0,t):u,p="trailing"in n?!!n.trailing:p),k.cancel=function(){void 0!==h&&clearTimeout(h),g=0,l=f=c=h=void 0},k.flush=function(){return void 0===h?d:P(o())},k}},13218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},37005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},33448:(e,t,n)=>{var i=n(44239),o=n(37005);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==i(e)}},7771:(e,t,n)=>{var i=n(55639);e.exports=function(){return i.Date.now()}},23493:(e,t,n)=>{var i=n(23279),o=n(13218);e.exports=function(e,t,n){var r=!0,s=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return o(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),i(e,t,{leading:r,maxWait:t,trailing:s})}},14841:(e,t,n)=>{var i=n(27561),o=n(13218),r=n(33448),s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(r(e))return NaN;if(o(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var n=a.test(e);return n||l.test(e)?c(e.slice(2),n?2:8):s.test(e)?NaN:+e}},93379:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var r={},s=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=r[c]||0,d="".concat(c," ").concat(u);r[c]=u+1;var h=n(d),f={css:l[1],media:l[2],sourceMap:l[3]};-1!==h?(t[h].references++,t[h].updater(f)):t.push({identifier:d,updater:o(f,i),references:1}),s.push(d)}return s}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=i(e=e||[],o=o||{});return function(e){e=e||[];for(var s=0;s<r.length;s++){var a=n(r[s]);t[a].references--}for(var l=i(e,o),c=0;c<r.length;c++){var u=n(r[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}r=l}}},90569:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i=n.css,o=n.media,r=n.sourceMap;o?e.setAttribute("media",o):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},55877:(e,t,n)=>{var i=n(23570),o=n(71171),r=o;r.v1=i,r.v4=o,e.exports=r},45327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var i=n||0,o=t;return[o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]]].join("")}},85217:e=>{var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},23570:(e,t,n)=>{var i,o,r=n(85217),s=n(45327),a=0,l=0;e.exports=function(e,t,n){var c=t&&n||0,u=t||[],d=(e=e||{}).node||i,h=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==h){var f=r();null==d&&(d=i=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=o=16383&(f[6]<<8|f[7]))}var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:l+1,m=g-a+(v-l)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||g>a)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,l=v,o=h;var p=(1e4*(268435455&(g+=122192928e5))+v)%4294967296;u[c++]=p>>>24&255,u[c++]=p>>>16&255,u[c++]=p>>>8&255,u[c++]=255&p;var E=g/4294967296*1e4&268435455;u[c++]=E>>>8&255,u[c++]=255&E,u[c++]=E>>>24&15|16,u[c++]=E>>>16&255,u[c++]=h>>>8|128,u[c++]=255&h;for(var y=0;y<6;++y)u[c+y]=d[y];return t||s(u)}},71171:(e,t,n)=>{var i=n(85217),o=n(45327);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||o(s)}}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i=n(86398);Autodesk.Extensions.ModelAlignment=i})();
//# sourceMappingURL=ModelAlignment.min.js.map