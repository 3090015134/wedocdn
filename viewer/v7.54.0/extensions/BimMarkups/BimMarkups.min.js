/*! For license information please see BimMarkups.min.js.LICENSE.txt */
(()=>{var e={97:e=>{e.exports="#define MESHLINE_PATH_FLAT_CAP      3.0\nuniform vec3 color;\nuniform float opacity;\nvarying float vCounters;\nvarying float vDistance;\nvarying float aaRange;\nvarying float totalWidth;\nvarying vec2 center;\nvarying vec2 finalPos;\nvarying float vPointType;\nfloat when_eq(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\nfloat getSmoothStep(float t, float d) {\n    return smoothstep(t - aaRange, t + aaRange, abs(d));\n}\nvoid main() {\n    float t = totalWidth / 2.0;\n    float d = vDistance;\n    float aa = 1.0;\n    if (vCounters < 0.0 || vCounters > 1.0) {\n        d = length(finalPos - center);\n        if (vPointType == MESHLINE_PATH_FLAT_CAP) {\n            t = aaRange;\n        }\n        if (d > t + aaRange) {\n            discard;\n        }\n        aa = 1.0 - getSmoothStep(t, d);       \n    }\n        \n#ifdef IS_IE_11\n    aa = (1.0 - when_eq(opacity, 1.0) * getSmoothStep(totalWidth / 2.0, vDistance)) * aa;\n#else\n    aa = (1.0 - getSmoothStep(totalWidth / 2.0, vDistance)) * aa;\n#endif\n    gl_FragColor = vec4(color, opacity * aa);\n}\n"},90071:e=>{e.exports="\n#define MESHLINE_PATH_ROUND_CAP     2.\n#define MESHLINE_PATH_FLAT_CAP      3.\nattribute vec3 position;\nattribute vec2 previous;\nattribute vec2 next;\nattribute float side;\nattribute float width;\nattribute float counters;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 resolution;\nuniform float lineWidth;\nuniform float opacity;\nvarying float vCounters;\nvarying float vPointType;\nvarying float vDistance;\nvarying float aaRange;\nvarying float totalWidth;\nvarying vec2 center;\nvarying vec2 finalPos;\nfloat when_eq(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\nfloat when_neq(float x, float y) {\n  return abs(sign(x - y));\n}\nvoid main() {\n    float pixelsPerUnit = 0.5 * resolution.x * projectionMatrix[0][0];\n    vCounters = counters;\n    vPointType = abs(side);\n    float sideSgn = sign(side);\n    vec4 curPosition = modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    vec2 prevPos = (modelViewMatrix * vec4(previous, 0.0, 1.0)).xy;\n    vec2 nextPos = (modelViewMatrix * vec4(next, 0.0, 1.0)).xy;\n#ifdef IS_IE_11\n    aaRange = when_neq(width, 0.0) * when_eq(opacity, 1.0) * 1.0 / pixelsPerUnit;\n#else\n    aaRange = when_neq(width, 0.0) * 1.0 / pixelsPerUnit;\n#endif\n    \n    float minSize = when_neq(width, 0.0) * 0.5 / pixelsPerUnit;    \n   \n    totalWidth = lineWidth * width;\n    \n    float w = max(.5 * totalWidth, minSize) + aaRange;\n    \n    vDistance = w * sideSgn;\n    vec2 dir;\n    if (nextPos == curPosition.xy) {\n        dir = normalize(curPosition.xy - prevPos);\n    } else if (prevPos == curPosition.xy) {\n        dir = normalize(nextPos - curPosition.xy);\n    } else {\n#ifdef MITER\n        vec2 dir1 = normalize(curPosition.xy - prevPos);\n        vec2 dir2 = normalize(nextPos - curPosition.xy);\n        dir = normalize(dir1 + dir2);\n        vec2 perp = vec2(-dir1.y, dir1.x);\n        vec2 miter = vec2(-dir.y, dir.x);\n        w = clamp(w / dot(miter, perp), minSize + aaRange, 20. * w);\n#else\n        dir = normalize(curPosition.xy - prevPos);\n#endif\n    }\n    vec2 normal = vec2(-dir.y, dir.x);\n    normal *= w * sideSgn;\n    \n    if (vPointType == MESHLINE_PATH_ROUND_CAP) {\n        center = curPosition.xy;\n        curPosition.xy += normal;\n    } else  {\n        curPosition.xy += normal;\n        center = curPosition.xy;\n    }\n    \n    if (vCounters < 0.0 || vCounters > 1.0) {\n        normal = vec2(dir.x, dir.y);\n        normal *= sign(vCounters) * w;\n        curPosition.xy += normal;\n    }\n  \n    finalPos = curPosition.xy;\n    gl_Position = projectionMatrix * curPosition;\n}\n"},98346:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(87537),A=n.n(r),i=n(23645),o=n.n(i)()(A());o.push([e.id,".markup-frames-container{transform:translateZ(0);left:0;top:0;position:absolute}.markup-selection-frame-container{display:none}.markup-selection-frame-container.visible{display:block}.markup-selection-frame{transform:translateZ(0);position:absolute;pointer-events:none}.markup-selection-frame.fill{display:none;background-color:rgba(6,150,215,0.05)}.markup-selection-frame.fill.ios,.markup-selection-frame.border.ios{transform:translateZ(0);-webkit-transform:rotateZ(0deg)}.markup-selection-frame.fill.visible{display:block}.markup-selection-frame.border{background-color:rgba(6,150,215,0.6)}.markup-selection-frame.segment{display:none}.markup-selection-frame.segment.visible{display:block}.markup-anchor{transform:translateZ(0);display:none;position:absolute;background:#FFFFFF;box-shadow:0 0 0 1px rgba(107,120,127,0.7);pointer-events:none;border-radius:20px;z-index:1}.markup-anchor-fill.rectangle,.markup-anchor.rectangle{border-radius:0px}.markup-anchor-fill{display:none;width:100%;margin:1px;border-radius:20px;background:#0696D7}.markup-anchor-fill.visible{display:block}.markup-anchor.visible{display:flex}.rect-selector-frame{transform:translateZ(0);position:absolute;pointer-events:none;border:#222222 dashed 1px;border-radius:5px}.rect-selector-frame.visible{display:block}\n","",{version:3,sources:["webpack://./extensions/BimMarkups/FrameRenderer.css"],names:[],mappings:"AAAA,yBACI,uBAAwB,CACxB,MAAO,CACP,KAAM,CACN,iBAAkB,CACrB,kCAGG,YAAa,CAChB,0CAGG,aAAc,CACjB,wBAGG,uBAAwB,CACxB,iBAAkB,CAClB,mBAAoB,CACvB,6BAGG,YAAa,CACb,qCAAyC,CAC5C,oEAKG,uBAAwB,CACxB,+BAAgC,CACnC,qCAGG,aAAc,CACjB,+BAGG,oCAAwC,CAC3C,gCAGG,YAAa,CAChB,wCAGG,aAAc,CACjB,eAGG,uBAAwB,CACxB,YAAa,CAChB,iBAAkB,CACf,kBAAmB,CACnB,0CAA2C,CAC3C,mBAAoB,CACpB,kBAAmB,CACnB,SAAU,CACb,uDAIG,iBAAkB,CACrB,oBAGG,YAAa,CACb,UAAW,CACX,UAAW,CACX,kBAAmB,CACnB,kBAAmB,CACtB,4BAGG,aAAc,CACjB,uBAGG,YAAa,CAChB,qBAGG,uBAAwB,CACxB,iBAAkB,CAClB,mBAAoB,CACpB,yBAA0B,CAC1B,iBAAkB,CACrB,6BAGG,aAAc",sourcesContent:[".markup-frames-container {\n    transform: translateZ(0);\n    left: 0;\n    top: 0;\n    position: absolute;\n}\n\n.markup-selection-frame-container {\n    display: none;\n}\n\n.markup-selection-frame-container.visible {\n    display: block;\n}\n\n.markup-selection-frame {\n    transform: translateZ(0);\n    position: absolute;\n    pointer-events: none;\n}\n\n.markup-selection-frame.fill {\n    display: none;\n    background-color: rgba(6, 150, 215, 0.05);\n}\n\n/* iOS devices won't update the border without it. */\n.markup-selection-frame.fill.ios,\n.markup-selection-frame.border.ios {\n    transform: translateZ(0);\n    -webkit-transform: rotateZ(0deg);\n}\n\n.markup-selection-frame.fill.visible {\n    display: block;\n}\n\n.markup-selection-frame.border {\n    background-color: rgba(6, 150, 215, 0.6);\n}\n\n.markup-selection-frame.segment {\n    display: none;\n}\n\n.markup-selection-frame.segment.visible {\n    display: block;\n}\n\n.markup-anchor {\n    transform: translateZ(0);\n    display: none;\n\tposition: absolute;\n    background: #FFFFFF;\n    box-shadow: 0 0 0 1px rgba(107,120,127,0.7);\n    pointer-events: none;\n    border-radius: 20px;\n    z-index: 1;\n}\n\n.markup-anchor-fill.rectangle,\n.markup-anchor.rectangle {\n    border-radius: 0px;\n}\n\n.markup-anchor-fill {\n    display: none;\n    width: 100%;\n    margin: 1px;\n    border-radius: 20px;\n    background: #0696D7;\n}\n\n.markup-anchor-fill.visible {\n    display: block;\n}\n\n.markup-anchor.visible {\n    display: flex;\n}\n\n.rect-selector-frame {\n    transform: translateZ(0);\n    position: absolute;\n    pointer-events: none;\n    border: #222222 dashed 1px;\n    border-radius: 5px;\n}\n\n.rect-selector-frame.visible {\n    display: block;\n}"],sourceRoot:""}]);const a=o},22006:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(87537),A=n.n(r),i=n(23645),o=n.n(i)()(A());o.push([e.id,'.markup-links-container{transform:translateZ(0);left:0;top:0;position:absolute}.link{display:none;position:absolute;pointer-events:none;z-index:1}.link.visible{display:block}.link.transparent{opacity:0.3}.link-document-attachment{transform:translateZ(0);display:block;position:absolute;text-align:center;font-family:"Artifakt Element";background-color:#0696D7;border-radius:10.5px;color:white;cursor:pointer;font-size:13px;font-weight:500;line-height:19px;height:20px;width:40px}.link-document-attachment:before{font-family:"bimviewericon", sans-serif;content:"\\e911";font-size:11px;padding-right:4px}.link.selected .link-document-attachment{background-color:#0584BD}.link.hover .link-document-attachment{background-color:#38ABDF}.link.editable .link-document-attachment{outline:1px solid rgba(6,150,215,0.6)}\n',"",{version:3,sources:["webpack://./extensions/BimMarkups/Links/LinksRenderer.css"],names:[],mappings:"AAAA,wBACI,uBAAwB,CACxB,MAAO,CACP,KAAM,CACN,iBAAkB,CACrB,MAGG,YAAa,CAChB,iBAAkB,CACf,mBAAoB,CACpB,SAAU,CACb,cAGG,aAAc,CACjB,kBAGG,WAAY,CACf,0BAKG,uBAAwB,CACxB,aAAc,CACd,iBAAkB,CAClB,iBAAiB,CACjB,8BAA+B,CAC/B,wBAAyB,CACzB,oBAAqB,CACrB,WAAY,CACZ,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,gBAAiB,CACjB,WAAY,CACZ,UAAW,CACd,iCAGG,uCAAwC,CACxC,eAAgB,CAChB,cAAe,CACf,iBAAkB,CACrB,yCAGG,wBACJ,CAAC,sCAGG,wBACJ,CAAC,yCAGG,qCAAyC",sourcesContent:['.markup-links-container {\n    transform: translateZ(0);\n    left: 0;\n    top: 0;\n    position: absolute;\n}\n\n.link {\n    display: none;\n\tposition: absolute;\n    pointer-events: none;\n    z-index: 1;\n}\n\n.link.visible {\n    display: block;\n}\n\n.link.transparent {\n    opacity: 0.3;\n}\n\n/* Document attachment link */\n\n.link-document-attachment {\n    transform: translateZ(0);\n    display: block;\n    position: absolute;\n    text-align:center;\n    font-family: "Artifakt Element";\n    background-color: #0696D7;\n    border-radius: 10.5px;\n    color: white;\n    cursor: pointer;\n    font-size: 13px;\n    font-weight: 500;\n    line-height: 19px;\n    height: 20px;\n    width: 40px;\n}\n\n.link-document-attachment:before {\n    font-family: "bimviewericon", sans-serif;\n    content: "\\e911";\n    font-size: 11px;\n    padding-right: 4px;\n}\n\n.link.selected .link-document-attachment {\n    background-color: #0584BD\n}\n\n.link.hover .link-document-attachment {\n    background-color: #38ABDF\n}\n\n.link.editable .link-document-attachment {\n    outline: 1px solid rgba(6, 150, 215, 0.6);\n}\n'],sourceRoot:""}]);const a=o},58706:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(87537),A=n.n(r),i=n(23645),o=n.n(i)()(A());o.push([e.id,".markup-text-container{left:0;top:0;width:100%;height:100%;position:absolute;pointer-events:none}.markup-text{will-change:contents;transform:translateZ(0);text-rendering:geometricPrecision;display:none;position:absolute;pointer-events:none;text-align:left;white-space:pre-wrap;overflow-wrap:break-word;word-wrap:break-word;outline:none;-webkit-user-select:none;user-select:none}.markup-text p{display:block;box-sizing:content-box;font-weight:inherit;font-size:inherit;font-family:inherit;font-style:inherit;word-wrap:inherit;white-space:inherit;line-height:inherit;text-rendering:geometricPrecision;-ms-text-size-adjust:100%;text-align:left;margin:0 0 0 0;padding:0 0 0 0;user-select:text}.markup-text.single-line br{display:none}.markup-text.visible{display:block}.markup-text-area{pointer-events:all;position:absolute;z-index:100}\n","",{version:3,sources:["webpack://./extensions/BimMarkups/RendererHelpers/TextRenderer.css"],names:[],mappings:"AAAA,uBACI,MAAO,CACP,KAAM,CACN,UAAW,CACX,WAAY,CACZ,iBAAkB,CAClB,mBAAoB,CACvB,aAIG,oBAAqB,CACrB,uBAAwB,CACxB,iCAAkC,CAClC,YAAa,CACb,iBAAkB,CAClB,mBAAoB,CACpB,eAAgB,CAChB,oBAAqB,CACrB,wBAAyB,CACzB,oBAAqB,CACrB,YAAa,CACb,wBAAyB,CACzB,gBAAiB,CACpB,eAQG,aAAc,CACd,sBAAuB,CACvB,mBAAoB,CACpB,iBAAkB,CAClB,mBAAoB,CACpB,kBAAmB,CACnB,iBAAkB,CAClB,mBAAoB,CACpB,mBAAqB,CACrB,iCAAkC,CAClC,yBAA0B,CAC1B,eAAgB,CAChB,cAAe,CACf,eAAgB,CAChB,gBAAiB,CACpB,4BAGG,YAAa,CAChB,qBAGG,aAAc,CACjB,kBAGG,kBAAmB,CACnB,iBAAkB,CAClB,WAAY",sourcesContent:[".markup-text-container {\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    pointer-events: none;\n}\n\n.markup-text {\n    /* Optimization */\n    will-change: contents;\n    transform: translateZ(0);\n    text-rendering: geometricPrecision;\n    display: none;\n    position: absolute; /* changing position to fixed solves the 'out of screen' text expansion, but cause the text be visible on top of other element */\n    pointer-events: none;\n    text-align: left;\n    white-space: pre-wrap;\n    overflow-wrap: break-word;\n    word-wrap: break-word; /* IE11 replacement for overflow-wrap */\n    outline: none;\n    -webkit-user-select: none;\n    user-select: none;\n}\n\n/* IE uses <p> tag elements instead of divs inside contentedible,\n   inherit style to mimic div style.\n   add min width to edge cases.\n*/\n\n.markup-text p { \n    display: block;\n    box-sizing: content-box;\n    font-weight: inherit; \n    font-size: inherit; \n    font-family: inherit;\n    font-style: inherit;  \n    word-wrap: inherit; \n    white-space: inherit;\n    line-height:  inherit;\n    text-rendering: geometricPrecision;\n    -ms-text-size-adjust: 100%;\n    text-align: left;\n    margin: 0 0 0 0;\n    padding: 0 0 0 0;\n    user-select: text;\n}\n\n.markup-text.single-line br {\n    display: none;\n}\n\n.markup-text.visible {\n    display: block;\n}\n\n.markup-text-area {\n    pointer-events: all;\n    position: absolute;\n    z-index: 100;\n}"],sourceRoot:""}]);const a=o},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,A,i){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var s=this[a][0];null!=s&&(o[s]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&o[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),A&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=A):c[4]="".concat(A)),t.push(c))}},t}},87537:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),A="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),i="/*# ".concat(A," */"),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(o).concat([i]).join("\n")}return[t].join("\n")}},39921:e=>{!function(){var t=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n="undefined"!=typeof window,r=n&&null!=window.mozInnerScreenX;function A(e,A,i){var o=e.ownerDocument,a=o.defaultView||o.parentWindow;if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var s=i&&i.debug||!1;if(s){var u=o.querySelector("#input-textarea-caret-position-mirror-div");u&&u.parentNode.removeChild(u)}var c=o.createElement("div");c.id="input-textarea-caret-position-mirror-div",o.body.appendChild(c);var l=c.style,h=a.getComputedStyle?a.getComputedStyle(e):e.currentStyle,p="INPUT"===e.nodeName;l.whiteSpace="pre-wrap",p||(l.wordWrap="break-word"),l.position="absolute",s||(l.visibility="hidden"),t.forEach((function(e){p&&"lineHeight"===e?l.lineHeight=h.height:l[e]=h[e]})),r?e.scrollHeight>parseInt(h.height)&&(l.overflowY="scroll"):l.overflow="hidden",c.textContent=e.value.substring(0,A),p&&(c.textContent=c.textContent.replace(/\s/g," "));var d=o.createElement("span");d.textContent=e.value.substring(A)||".",c.appendChild(d);var f={top:d.offsetTop+parseInt(h.borderTopWidth),left:d.offsetLeft+parseInt(h.borderLeftWidth),height:parseInt(h.lineHeight)};return s?d.style.backgroundColor="#aaa":o.body.removeChild(c),f}void 0!==e.exports?e.exports=A:n&&(window.getCaretCoordinates=A)}()},86205:function(e,t,n){var r,A,i;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}i=function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var A in t=arguments[n])Object.prototype.hasOwnProperty.call(t,A)&&(e[A]=t[A]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(A,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?A(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}s((r=r.apply(e,t||[])).next())}))}function A(e,t){var n,r,A,i,o={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(A=2&i[0]?r.return:i[0]?r.throw||((A=r.return)&&A.call(r),0):r.next)&&!(A=A.call(r,i[1])).done)return A;switch(r=0,A&&(i=[2&i[0],A.value]),i[0]){case 0:case 1:A=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((A=(A=o.trys).length>0&&A[A.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!A||i[1]>A[0]&&i[1]<A[3])){o.label=i[1];break}if(6===i[0]&&o.label<A[1]){o.label=A[1],A=i;break}if(A&&o.label<A[2]){o.label=A[2],o.ops.push(i);break}A[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=A=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function i(e,t,n){if(n||2===arguments.length)for(var r,A=0,i=t.length;A<i;A++)!r&&A in t||(r||(r=Array.prototype.slice.call(t,0,A)),r[A]=t[A]);return e.concat(r||t)}for(var a=function(){function e(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}return e.prototype.add=function(t,n,r,A){return new e(this.left+t,this.top+n,this.width+r,this.height+A)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var r=n[0];return r?new e(r.x+t.windowBounds.left,r.y+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),s=function(e,t){return a.fromClientRect(e,t.getBoundingClientRect())},u=function(e){for(var t=[],n=0,r=e.length;n<r;){var A=e.charCodeAt(n++);if(A>=55296&&A<=56319&&n<r){var i=e.charCodeAt(n++);56320==(64512&i)?t.push(((1023&A)<<10)+(1023&i)+65536):(t.push(A),n--)}else t.push(A)}return t},c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],A=-1,i="";++A<n;){var o=e[A];o<=65535?r.push(o):(o-=65536,r.push(55296+(o>>10),o%1024+56320)),(A+1===n||r.length>16384)&&(i+=String.fromCharCode.apply(String,r),r.length=0)}return i},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="undefined"==typeof Uint8Array?[]:new Uint8Array(256),p=0;p<l.length;p++)h[l.charCodeAt(p)]=p;var d,f,y,g,E,B,m,v,w,k=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},C=function(){function e(e,t,n,r,A,i){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=A,this.data=i}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),b=10,S=13,T=15,x=17,M=18,U=19,Q=20,L=21,F=22,R=24,H=25,_=26,D=27,I=28,O=30,P=32,N=33,K=34,V=35,G=37,j=38,Y=39,W=40,X=42,J=[9001,65288],z="×",Z="÷",q=(E=function(e){var t,n,r,A,i,o=.75*e.length,a=e.length,s=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(o):new Array(o),c=Array.isArray(u)?u:new Uint8Array(u);for(t=0;t<a;t+=4)n=h[e.charCodeAt(t)],r=h[e.charCodeAt(t+1)],A=h[e.charCodeAt(t+2)],i=h[e.charCodeAt(t+3)],c[s++]=n<<2|r>>4,c[s++]=(15&r)<<4|A>>2,c[s++]=(3&A)<<6|63&i;return u}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),B=Array.isArray(E)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n}(E):new Uint32Array(E),m=Array.isArray(E)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n}(E):new Uint16Array(E),v=k(m,12,B[4]/2),w=2===B[5]?k(m,(24+B[4])/2):(f=B,y=Math.ceil((24+B[4])/4),f.slice?f.slice(y,g):new Uint32Array(Array.prototype.slice.call(f,y,g))),new C(B[0],B[1],B[2],B[3],v,w)),$=[O,36],ee=[1,2,3,5],te=[b,8],ne=[D,_],re=ee.concat(te),Ae=[j,Y,W,K,V],ie=[T,S],oe=function(e,t,n,r){var A=r[n];if(Array.isArray(e)?-1!==e.indexOf(A):e===A)for(var i=n;i<=r.length;){if((s=r[++i])===t)return!0;if(s!==b)break}if(A===b)for(i=n;i>0;){var o=r[--i];if(Array.isArray(e)?-1!==e.indexOf(o):e===o)for(var a=n;a<=r.length;){var s;if((s=r[++a])===t)return!0;if(s!==b)break}if(o!==b)break}return!1},ae=function(e,t){for(var n=e;n>=0;){var r=t[n];if(r!==b)return r;n--}return 0},se=function(e,t,n,r,A){if(0===n[r])return z;var i=r-1;if(Array.isArray(A)&&!0===A[i])return z;var o=i-1,a=i+1,s=t[i],u=o>=0?t[o]:0,c=t[a];if(2===s&&3===c)return z;if(-1!==ee.indexOf(s))return"!";if(-1!==ee.indexOf(c))return z;if(-1!==te.indexOf(c))return z;if(8===ae(i,t))return Z;if(11===q.get(e[i]))return z;if((s===P||s===N)&&11===q.get(e[a]))return z;if(7===s||7===c)return z;if(9===s)return z;if(-1===[b,S,T].indexOf(s)&&9===c)return z;if(-1!==[x,M,U,R,I].indexOf(c))return z;if(ae(i,t)===F)return z;if(oe(23,F,i,t))return z;if(oe([x,M],L,i,t))return z;if(oe(12,12,i,t))return z;if(s===b)return Z;if(23===s||23===c)return z;if(16===c||16===s)return Z;if(-1!==[S,T,L].indexOf(c)||14===s)return z;if(36===u&&-1!==ie.indexOf(s))return z;if(s===I&&36===c)return z;if(c===Q)return z;if(-1!==$.indexOf(c)&&s===H||-1!==$.indexOf(s)&&c===H)return z;if(s===D&&-1!==[G,P,N].indexOf(c)||-1!==[G,P,N].indexOf(s)&&c===_)return z;if(-1!==$.indexOf(s)&&-1!==ne.indexOf(c)||-1!==ne.indexOf(s)&&-1!==$.indexOf(c))return z;if(-1!==[D,_].indexOf(s)&&(c===H||-1!==[F,T].indexOf(c)&&t[a+1]===H)||-1!==[F,T].indexOf(s)&&c===H||s===H&&-1!==[H,I,R].indexOf(c))return z;if(-1!==[H,I,R,x,M].indexOf(c))for(var l=i;l>=0;){if((h=t[l])===H)return z;if(-1===[I,R].indexOf(h))break;l--}if(-1!==[D,_].indexOf(c))for(l=-1!==[x,M].indexOf(s)?o:i;l>=0;){var h;if((h=t[l])===H)return z;if(-1===[I,R].indexOf(h))break;l--}if(j===s&&-1!==[j,Y,K,V].indexOf(c)||-1!==[Y,K].indexOf(s)&&-1!==[Y,W].indexOf(c)||-1!==[W,V].indexOf(s)&&c===W)return z;if(-1!==Ae.indexOf(s)&&-1!==[Q,_].indexOf(c)||-1!==Ae.indexOf(c)&&s===D)return z;if(-1!==$.indexOf(s)&&-1!==$.indexOf(c))return z;if(s===R&&-1!==$.indexOf(c))return z;if(-1!==$.concat(H).indexOf(s)&&c===F&&-1===J.indexOf(e[a])||-1!==$.concat(H).indexOf(c)&&s===M)return z;if(41===s&&41===c){for(var p=n[i],d=1;p>0&&41===t[--p];)d++;if(d%2!=0)return z}return s===P&&c===N?z:Z},ue=function(){function e(e,t,n,r){this.codePoints=e,this.required="!"===t,this.start=n,this.end=r}return e.prototype.slice=function(){return c.apply(void 0,this.codePoints.slice(this.start,this.end))},e}();!function(e){e[e.STRING_TOKEN=0]="STRING_TOKEN",e[e.BAD_STRING_TOKEN=1]="BAD_STRING_TOKEN",e[e.LEFT_PARENTHESIS_TOKEN=2]="LEFT_PARENTHESIS_TOKEN",e[e.RIGHT_PARENTHESIS_TOKEN=3]="RIGHT_PARENTHESIS_TOKEN",e[e.COMMA_TOKEN=4]="COMMA_TOKEN",e[e.HASH_TOKEN=5]="HASH_TOKEN",e[e.DELIM_TOKEN=6]="DELIM_TOKEN",e[e.AT_KEYWORD_TOKEN=7]="AT_KEYWORD_TOKEN",e[e.PREFIX_MATCH_TOKEN=8]="PREFIX_MATCH_TOKEN",e[e.DASH_MATCH_TOKEN=9]="DASH_MATCH_TOKEN",e[e.INCLUDE_MATCH_TOKEN=10]="INCLUDE_MATCH_TOKEN",e[e.LEFT_CURLY_BRACKET_TOKEN=11]="LEFT_CURLY_BRACKET_TOKEN",e[e.RIGHT_CURLY_BRACKET_TOKEN=12]="RIGHT_CURLY_BRACKET_TOKEN",e[e.SUFFIX_MATCH_TOKEN=13]="SUFFIX_MATCH_TOKEN",e[e.SUBSTRING_MATCH_TOKEN=14]="SUBSTRING_MATCH_TOKEN",e[e.DIMENSION_TOKEN=15]="DIMENSION_TOKEN",e[e.PERCENTAGE_TOKEN=16]="PERCENTAGE_TOKEN",e[e.NUMBER_TOKEN=17]="NUMBER_TOKEN",e[e.FUNCTION=18]="FUNCTION",e[e.FUNCTION_TOKEN=19]="FUNCTION_TOKEN",e[e.IDENT_TOKEN=20]="IDENT_TOKEN",e[e.COLUMN_TOKEN=21]="COLUMN_TOKEN",e[e.URL_TOKEN=22]="URL_TOKEN",e[e.BAD_URL_TOKEN=23]="BAD_URL_TOKEN",e[e.CDC_TOKEN=24]="CDC_TOKEN",e[e.CDO_TOKEN=25]="CDO_TOKEN",e[e.COLON_TOKEN=26]="COLON_TOKEN",e[e.SEMICOLON_TOKEN=27]="SEMICOLON_TOKEN",e[e.LEFT_SQUARE_BRACKET_TOKEN=28]="LEFT_SQUARE_BRACKET_TOKEN",e[e.RIGHT_SQUARE_BRACKET_TOKEN=29]="RIGHT_SQUARE_BRACKET_TOKEN",e[e.UNICODE_RANGE_TOKEN=30]="UNICODE_RANGE_TOKEN",e[e.WHITESPACE_TOKEN=31]="WHITESPACE_TOKEN",e[e.EOF_TOKEN=32]="EOF_TOKEN"}(d||(d={}));var ce=45,le=43,he=-1,pe=function(e){return e>=48&&e<=57},de=function(e){return pe(e)||e>=65&&e<=70||e>=97&&e<=102},fe=function(e){return 10===e||9===e||32===e},ye=function(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return e>=128}(e)||95===e},ge=function(e){return ye(e)||pe(e)||e===ce},Ee=function(e){return e>=0&&e<=8||11===e||e>=14&&e<=31||127===e},Be=function(e,t){return 92===e&&10!==t},me=function(e,t,n){return e===ce?ye(t)||Be(t,n):!!ye(e)||!(92!==e||!Be(e,t))},ve=function(e,t,n){return e===le||e===ce?!!pe(t)||46===t&&pe(n):pe(46===e?t:e)},we=function(e){var t=0,n=1;e[t]!==le&&e[t]!==ce||(e[t]===ce&&(n=-1),t++);for(var r=[];pe(e[t]);)r.push(e[t++]);var A=r.length?parseInt(c.apply(void 0,r),10):0;46===e[t]&&t++;for(var i=[];pe(e[t]);)i.push(e[t++]);var o=i.length,a=o?parseInt(c.apply(void 0,i),10):0;69!==e[t]&&101!==e[t]||t++;var s=1;e[t]!==le&&e[t]!==ce||(e[t]===ce&&(s=-1),t++);for(var u=[];pe(e[t]);)u.push(e[t++]);var l=u.length?parseInt(c.apply(void 0,u),10):0;return n*(A+a*Math.pow(10,-o))*Math.pow(10,s*l)},ke={type:d.LEFT_PARENTHESIS_TOKEN},Ce={type:d.RIGHT_PARENTHESIS_TOKEN},be={type:d.COMMA_TOKEN},Se={type:d.SUFFIX_MATCH_TOKEN},Te={type:d.PREFIX_MATCH_TOKEN},xe={type:d.COLUMN_TOKEN},Me={type:d.DASH_MATCH_TOKEN},Ue={type:d.INCLUDE_MATCH_TOKEN},Qe={type:d.LEFT_CURLY_BRACKET_TOKEN},Le={type:d.RIGHT_CURLY_BRACKET_TOKEN},Fe={type:d.SUBSTRING_MATCH_TOKEN},Re={type:d.BAD_URL_TOKEN},He={type:d.BAD_STRING_TOKEN},_e={type:d.CDO_TOKEN},De={type:d.CDC_TOKEN},Ie={type:d.COLON_TOKEN},Oe={type:d.SEMICOLON_TOKEN},Pe={type:d.LEFT_SQUARE_BRACKET_TOKEN},Ne={type:d.RIGHT_SQUARE_BRACKET_TOKEN},Ke={type:d.WHITESPACE_TOKEN},Ve={type:d.EOF_TOKEN},Ge=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(u(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Ve;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case 34:return this.consumeStringToken(34);case 35:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(ge(t)||Be(n,r)){var A=me(t,n,r)?2:1,i=this.consumeName();return{type:d.HASH_TOKEN,value:i,flags:A}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Se;break;case 39:return this.consumeStringToken(39);case 40:return ke;case 41:return Ce;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Fe;break;case le:if(ve(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 44:return be;case ce:var o=e,a=this.peekCodePoint(0),s=this.peekCodePoint(1);if(ve(o,a,s))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(me(o,a,s))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(a===ce&&62===s)return this.consumeCodePoint(),this.consumeCodePoint(),De;break;case 46:if(ve(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var u=this.consumeCodePoint();if(42===u&&47===(u=this.consumeCodePoint()))return this.consumeToken();if(u===he)return this.consumeToken()}break;case 58:return Ie;case 59:return Oe;case 60:if(33===this.peekCodePoint(0)&&this.peekCodePoint(1)===ce&&this.peekCodePoint(2)===ce)return this.consumeCodePoint(),this.consumeCodePoint(),_e;break;case 64:var l=this.peekCodePoint(0),h=this.peekCodePoint(1),p=this.peekCodePoint(2);if(me(l,h,p))return i=this.consumeName(),{type:d.AT_KEYWORD_TOKEN,value:i};break;case 91:return Pe;case 92:if(Be(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case 93:return Ne;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Te;break;case 123:return Qe;case 125:return Le;case 117:case 85:var f=this.peekCodePoint(0),y=this.peekCodePoint(1);return f!==le||!de(y)&&63!==y||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Me;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),xe;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ue;break;case he:return Ve}return fe(e)?(this.consumeWhiteSpace(),Ke):pe(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):ye(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:d.DELIM_TOKEN,value:c(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();de(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;63===t&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n){var r=parseInt(c.apply(void 0,e.map((function(e){return 63===e?48:e}))),16),A=parseInt(c.apply(void 0,e.map((function(e){return 63===e?70:e}))),16);return{type:d.UNICODE_RANGE_TOKEN,start:r,end:A}}var i=parseInt(c.apply(void 0,e),16);if(this.peekCodePoint(0)===ce&&de(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var o=[];de(t)&&o.length<6;)o.push(t),t=this.consumeCodePoint();return A=parseInt(c.apply(void 0,o),16),{type:d.UNICODE_RANGE_TOKEN,start:i,end:A}}return{type:d.UNICODE_RANGE_TOKEN,start:i,end:i}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:d.FUNCTION_TOKEN,value:e}):{type:d.IDENT_TOKEN,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===he)return{type:d.URL_TOKEN,value:""};var t=this.peekCodePoint(0);if(39===t||34===t){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===d.STRING_TOKEN&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===he||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:d.URL_TOKEN,value:n.value}):(this.consumeBadUrlRemnants(),Re)}for(;;){var r=this.consumeCodePoint();if(r===he||41===r)return{type:d.URL_TOKEN,value:c.apply(void 0,e)};if(fe(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===he||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:d.URL_TOKEN,value:c.apply(void 0,e)}):(this.consumeBadUrlRemnants(),Re);if(34===r||39===r||40===r||Ee(r))return this.consumeBadUrlRemnants(),Re;if(92===r){if(!Be(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),Re;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;fe(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(41===e||e===he)return;Be(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t="";e>0;){var n=Math.min(6e4,e);t+=c.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),t},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var r=this._value[n];if(r===he||void 0===r||r===e)return t+=this.consumeStringSlice(n),{type:d.STRING_TOKEN,value:t};if(10===r)return this._value.splice(0,n),He;if(92===r){var A=this._value[n+1];A!==he&&void 0!==A&&(10===A?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):Be(r,A)&&(t+=this.consumeStringSlice(n),t+=c(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=4,n=this.peekCodePoint(0);for(n!==le&&n!==ce||e.push(this.consumeCodePoint());pe(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(46===n&&pe(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;pe(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var A=this.peekCodePoint(2);if((69===n||101===n)&&((r===le||r===ce)&&pe(A)||pe(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;pe(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[we(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],r=this.peekCodePoint(0),A=this.peekCodePoint(1),i=this.peekCodePoint(2);if(me(r,A,i)){var o=this.consumeName();return{type:d.DIMENSION_TOKEN,number:t,flags:n,unit:o}}return 37===r?(this.consumeCodePoint(),{type:d.PERCENTAGE_TOKEN,number:t,flags:n}):{type:d.NUMBER_TOKEN,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(de(e)){for(var t=c(e);de(this.peekCodePoint(0))&&t.length<6;)t+=c(this.consumeCodePoint());fe(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||function(e){return e>=55296&&e<=57343}(n)||n>1114111?65533:n}return e===he?65533:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(ge(t))e+=c(t);else{if(!Be(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=c(this.consumeEscapedCodePoint())}}},e}(),je=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new Ge;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===d.WHITESPACE_TOKEN;)e=this.consumeToken();if(e.type===d.EOF_TOKEN)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(e.type===d.WHITESPACE_TOKEN);if(e.type===d.EOF_TOKEN)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===d.EOF_TOKEN)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case d.LEFT_CURLY_BRACKET_TOKEN:case d.LEFT_SQUARE_BRACKET_TOKEN:case d.LEFT_PARENTHESIS_TOKEN:return this.consumeSimpleBlock(e.type);case d.FUNCTION_TOKEN:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(n.type===d.EOF_TOKEN||et(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:d.FUNCTION};;){var n=this.consumeToken();if(n.type===d.EOF_TOKEN||n.type===d.RIGHT_PARENTHESIS_TOKEN)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Ve:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Ye=function(e){return e.type===d.DIMENSION_TOKEN},We=function(e){return e.type===d.NUMBER_TOKEN},Xe=function(e){return e.type===d.IDENT_TOKEN},Je=function(e){return e.type===d.STRING_TOKEN},ze=function(e,t){return Xe(e)&&e.value===t},Ze=function(e){return e.type!==d.WHITESPACE_TOKEN},qe=function(e){return e.type!==d.WHITESPACE_TOKEN&&e.type!==d.COMMA_TOKEN},$e=function(e){var t=[],n=[];return e.forEach((function(e){if(e.type===d.COMMA_TOKEN){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}e.type!==d.WHITESPACE_TOKEN&&n.push(e)})),n.length&&t.push(n),t},et=function(e,t){return t===d.LEFT_CURLY_BRACKET_TOKEN&&e.type===d.RIGHT_CURLY_BRACKET_TOKEN||t===d.LEFT_SQUARE_BRACKET_TOKEN&&e.type===d.RIGHT_SQUARE_BRACKET_TOKEN||t===d.LEFT_PARENTHESIS_TOKEN&&e.type===d.RIGHT_PARENTHESIS_TOKEN},tt=function(e){return e.type===d.NUMBER_TOKEN||e.type===d.DIMENSION_TOKEN},nt=function(e){return e.type===d.PERCENTAGE_TOKEN||tt(e)},rt=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},At={type:d.NUMBER_TOKEN,number:0,flags:4},it={type:d.PERCENTAGE_TOKEN,number:50,flags:4},ot={type:d.PERCENTAGE_TOKEN,number:100,flags:4},at=function(e,t,n){var r=e[0],A=e[1];return[st(r,t),st(void 0!==A?A:r,n)]},st=function(e,t){if(e.type===d.PERCENTAGE_TOKEN)return e.number/100*t;if(Ye(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},ut="grad",ct="turn",lt=function(e,t){if(t.type===d.DIMENSION_TOKEN)switch(t.unit){case"deg":return Math.PI*t.number/180;case ut:return Math.PI/200*t.number;case"rad":return t.number;case ct:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")},ht=function(e){return e.type===d.DIMENSION_TOKEN&&("deg"===e.unit||e.unit===ut||"rad"===e.unit||e.unit===ct)},pt=function(e){switch(e.filter(Xe).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[At,At];case"to top":case"bottom":return dt(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[At,ot];case"to right":case"left":return dt(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[ot,ot];case"to bottom":case"top":return dt(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[ot,At];case"to left":case"right":return dt(270)}return 0},dt=function(e){return Math.PI*e/180},ft=function(e,t){if(t.type===d.FUNCTION){var n=bt[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(t.type===d.HASH_TOKEN){if(3===t.value.length){var r=t.value.substring(0,1),A=t.value.substring(1,2),i=t.value.substring(2,3);return Et(parseInt(r+r,16),parseInt(A+A,16),parseInt(i+i,16),1)}if(4===t.value.length){r=t.value.substring(0,1),A=t.value.substring(1,2),i=t.value.substring(2,3);var o=t.value.substring(3,4);return Et(parseInt(r+r,16),parseInt(A+A,16),parseInt(i+i,16),parseInt(o+o,16)/255)}if(6===t.value.length)return r=t.value.substring(0,2),A=t.value.substring(2,4),i=t.value.substring(4,6),Et(parseInt(r,16),parseInt(A,16),parseInt(i,16),1);if(8===t.value.length)return r=t.value.substring(0,2),A=t.value.substring(2,4),i=t.value.substring(4,6),o=t.value.substring(6,8),Et(parseInt(r,16),parseInt(A,16),parseInt(i,16),parseInt(o,16)/255)}if(t.type===d.IDENT_TOKEN){var a=Tt[t.value.toUpperCase()];if(void 0!==a)return a}return Tt.TRANSPARENT},yt=function(e){return 0==(255&e)},gt=function(e){var t=255&e,n=255&e>>8,r=255&e>>16,A=255&e>>24;return t<255?"rgba("+A+","+r+","+n+","+t/255+")":"rgb("+A+","+r+","+n+")"},Et=function(e,t,n,r){return(e<<24|t<<16|n<<8|Math.round(255*r)<<0)>>>0},Bt=function(e,t){if(e.type===d.NUMBER_TOKEN)return e.number;if(e.type===d.PERCENTAGE_TOKEN){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},mt=function(e,t){var n=t.filter(qe);if(3===n.length){var r=n.map(Bt),A=r[0],i=r[1],o=r[2];return Et(A,i,o,1)}if(4===n.length){var a=n.map(Bt),s=(A=a[0],i=a[1],o=a[2],a[3]);return Et(A,i,o,s)}return 0};function vt(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var wt,kt,Ct=function(e,t){var n=t.filter(qe),r=n[0],A=n[1],i=n[2],o=n[3],a=(r.type===d.NUMBER_TOKEN?dt(r.number):lt(0,r))/(2*Math.PI),s=nt(A)?A.number/100:0,u=nt(i)?i.number/100:0,c=void 0!==o&&nt(o)?st(o,1):1;if(0===s)return Et(255*u,255*u,255*u,1);var l=u<=.5?u*(s+1):u+s-u*s,h=2*u-l,p=vt(h,l,a+1/3),f=vt(h,l,a),y=vt(h,l,a-1/3);return Et(255*p,255*f,255*y,c)},bt={hsl:Ct,hsla:Ct,rgb:mt,rgba:mt},St=function(e,t){return ft(e,je.create(t).parseComponentValue())},Tt={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199};!function(e){e[e.VALUE=0]="VALUE",e[e.LIST=1]="LIST",e[e.IDENT_VALUE=2]="IDENT_VALUE",e[e.TYPE_VALUE=3]="TYPE_VALUE",e[e.TOKEN_VALUE=4]="TOKEN_VALUE"}(wt||(wt={})),function(e){e[e.BORDER_BOX=0]="BORDER_BOX",e[e.PADDING_BOX=1]="PADDING_BOX",e[e.CONTENT_BOX=2]="CONTENT_BOX"}(kt||(kt={}));var xt,Mt,Ut,Qt={name:"background-clip",initialValue:"border-box",prefix:!1,type:wt.LIST,parse:function(e,t){return t.map((function(e){if(Xe(e))switch(e.value){case"padding-box":return kt.PADDING_BOX;case"content-box":return kt.CONTENT_BOX}return kt.BORDER_BOX}))}},Lt={name:"background-color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"},Ft=function(e,t){var n=ft(e,t[0]),r=t[1];return r&&nt(r)?{color:n,stop:r}:{color:n,stop:null}},Rt=function(e,t){var n=e[0],r=e[e.length-1];null===n.stop&&(n.stop=At),null===r.stop&&(r.stop=ot);for(var A=[],i=0,o=0;o<e.length;o++){var a=e[o].stop;if(null!==a){var s=st(a,t);s>i?A.push(s):A.push(i),i=s}else A.push(null)}var u=null;for(o=0;o<A.length;o++){var c=A[o];if(null===c)null===u&&(u=o);else if(null!==u){for(var l=o-u,h=(c-A[u-1])/(l+1),p=1;p<=l;p++)A[u+p-1]=h*p;u=null}}return e.map((function(e,n){return{color:e.color,stop:Math.max(Math.min(1,A[n]/t),0)}}))},Ht=function(e,t){return Math.sqrt(e*e+t*t)},_t=function(e,t,n,r,A){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var i=t[0],o=t[1],a=Ht(n-i,r-o);return(A?a<e.optimumDistance:a>e.optimumDistance)?{optimumCorner:t,optimumDistance:a}:e}),{optimumDistance:A?1/0:-1/0,optimumCorner:null}).optimumCorner},Dt=function(e,t){var n=dt(180),r=[];return $e(t).forEach((function(t,A){if(0===A){var i=t[0];if(i.type===d.IDENT_TOKEN&&-1!==["top","left","right","bottom"].indexOf(i.value))return void(n=pt(t));if(ht(i))return void(n=(lt(0,i)+dt(270))%dt(360))}var o=Ft(e,t);r.push(o)})),{angle:n,stops:r,type:xt.LINEAR_GRADIENT}},It="closest-side",Ot="farthest-side",Pt="closest-corner",Nt="farthest-corner",Kt="circle",Vt="ellipse",Gt="cover",jt="contain",Yt=function(e,t){var n=Mt.CIRCLE,r=Ut.FARTHEST_CORNER,A=[],i=[];return $e(t).forEach((function(t,o){var a=!0;if(0===o?a=t.reduce((function(e,t){if(Xe(t))switch(t.value){case"center":return i.push(it),!1;case"top":case"left":return i.push(At),!1;case"right":case"bottom":return i.push(ot),!1}else if(nt(t)||tt(t))return i.push(t),!1;return e}),a):1===o&&(a=t.reduce((function(e,t){if(Xe(t))switch(t.value){case Kt:return n=Mt.CIRCLE,!1;case Vt:return n=Mt.ELLIPSE,!1;case jt:case It:return r=Ut.CLOSEST_SIDE,!1;case Ot:return r=Ut.FARTHEST_SIDE,!1;case Pt:return r=Ut.CLOSEST_CORNER,!1;case Gt:case Nt:return r=Ut.FARTHEST_CORNER,!1}else if(tt(t)||nt(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)),a){var s=Ft(e,t);A.push(s)}})),{size:r,shape:n,stops:A,position:i,type:xt.RADIAL_GRADIENT}};!function(e){e[e.URL=0]="URL",e[e.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",e[e.RADIAL_GRADIENT=2]="RADIAL_GRADIENT"}(xt||(xt={})),function(e){e[e.CIRCLE=0]="CIRCLE",e[e.ELLIPSE=1]="ELLIPSE"}(Mt||(Mt={})),function(e){e[e.CLOSEST_SIDE=0]="CLOSEST_SIDE",e[e.FARTHEST_SIDE=1]="FARTHEST_SIDE",e[e.CLOSEST_CORNER=2]="CLOSEST_CORNER",e[e.FARTHEST_CORNER=3]="FARTHEST_CORNER"}(Ut||(Ut={}));var Wt,Xt=function(e,t){if(t.type===d.URL_TOKEN){var n={url:t.value,type:xt.URL};return e.cache.addImage(t.value),n}if(t.type===d.FUNCTION){var r=Jt[t.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)},Jt={"linear-gradient":function(e,t){var n=dt(180),r=[];return $e(t).forEach((function(t,A){if(0===A){var i=t[0];if(i.type===d.IDENT_TOKEN&&"to"===i.value)return void(n=pt(t));if(ht(i))return void(n=lt(0,i))}var o=Ft(e,t);r.push(o)})),{angle:n,stops:r,type:xt.LINEAR_GRADIENT}},"-moz-linear-gradient":Dt,"-ms-linear-gradient":Dt,"-o-linear-gradient":Dt,"-webkit-linear-gradient":Dt,"radial-gradient":function(e,t){var n=Mt.CIRCLE,r=Ut.FARTHEST_CORNER,A=[],i=[];return $e(t).forEach((function(t,o){var a=!0;if(0===o){var s=!1;a=t.reduce((function(e,t){if(s)if(Xe(t))switch(t.value){case"center":return i.push(it),e;case"top":case"left":return i.push(At),e;case"right":case"bottom":return i.push(ot),e}else(nt(t)||tt(t))&&i.push(t);else if(Xe(t))switch(t.value){case Kt:return n=Mt.CIRCLE,!1;case Vt:return n=Mt.ELLIPSE,!1;case"at":return s=!0,!1;case It:return r=Ut.CLOSEST_SIDE,!1;case Gt:case Ot:return r=Ut.FARTHEST_SIDE,!1;case jt:case Pt:return r=Ut.CLOSEST_CORNER,!1;case Nt:return r=Ut.FARTHEST_CORNER,!1}else if(tt(t)||nt(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)}if(a){var u=Ft(e,t);A.push(u)}})),{size:r,shape:n,stops:A,position:i,type:xt.RADIAL_GRADIENT}},"-moz-radial-gradient":Yt,"-ms-radial-gradient":Yt,"-o-radial-gradient":Yt,"-webkit-radial-gradient":Yt,"-webkit-gradient":function(e,t){var n=dt(180),r=[],A=xt.LINEAR_GRADIENT,i=Mt.CIRCLE,o=Ut.FARTHEST_CORNER;return $e(t).forEach((function(t,n){var i=t[0];if(0===n){if(Xe(i)&&"linear"===i.value)return void(A=xt.LINEAR_GRADIENT);if(Xe(i)&&"radial"===i.value)return void(A=xt.RADIAL_GRADIENT)}if(i.type===d.FUNCTION)if("from"===i.name){var o=ft(e,i.values[0]);r.push({stop:At,color:o})}else if("to"===i.name)o=ft(e,i.values[0]),r.push({stop:ot,color:o});else if("color-stop"===i.name){var a=i.values.filter(qe);if(2===a.length){o=ft(e,a[1]);var s=a[0];We(s)&&r.push({stop:{type:d.PERCENTAGE_TOKEN,number:100*s.number,flags:s.flags},color:o})}}})),A===xt.LINEAR_GRADIENT?{angle:(n+dt(180))%dt(360),stops:r,type:A}:{size:o,shape:i,stops:r,position:[],type:A}}},zt={name:"background-image",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return n.type===d.IDENT_TOKEN&&"none"===n.value?[]:t.filter((function(e){return qe(e)&&function(e){return!(e.type===d.IDENT_TOKEN&&"none"===e.value||e.type===d.FUNCTION&&!Jt[e.name])}(e)})).map((function(t){return Xt(e,t)}))}},Zt={name:"background-origin",initialValue:"border-box",prefix:!1,type:wt.LIST,parse:function(e,t){return t.map((function(e){if(Xe(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},qt={name:"background-position",initialValue:"0% 0%",type:wt.LIST,prefix:!1,parse:function(e,t){return $e(t).map((function(e){return e.filter(nt)})).map(rt)}};!function(e){e[e.REPEAT=0]="REPEAT",e[e.NO_REPEAT=1]="NO_REPEAT",e[e.REPEAT_X=2]="REPEAT_X",e[e.REPEAT_Y=3]="REPEAT_Y"}(Wt||(Wt={}));var $t,en={name:"background-repeat",initialValue:"repeat",prefix:!1,type:wt.LIST,parse:function(e,t){return $e(t).map((function(e){return e.filter(Xe).map((function(e){return e.value})).join(" ")})).map(tn)}},tn=function(e){switch(e){case"no-repeat":return Wt.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return Wt.REPEAT_X;case"repeat-y":case"no-repeat repeat":return Wt.REPEAT_Y;default:return Wt.REPEAT}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}($t||($t={}));var nn,rn={name:"background-size",initialValue:"0",prefix:!1,type:wt.LIST,parse:function(e,t){return $e(t).map((function(e){return e.filter(An)}))}},An=function(e){return Xe(e)||nt(e)},on=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"}},an=on("top"),sn=on("right"),un=on("bottom"),cn=on("left"),ln=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:wt.LIST,parse:function(e,t){return rt(t.filter(nt))}}},hn=ln("top-left"),pn=ln("top-right"),dn=ln("bottom-right"),fn=ln("bottom-left");!function(e){e[e.NONE=0]="NONE",e[e.SOLID=1]="SOLID",e[e.DASHED=2]="DASHED",e[e.DOTTED=3]="DOTTED",e[e.DOUBLE=4]="DOUBLE"}(nn||(nn={}));var yn,gn=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"none":return nn.NONE;case"dashed":return nn.DASHED;case"dotted":return nn.DOTTED;case"double":return nn.DOUBLE}return nn.SOLID}}},En=gn("top"),Bn=gn("right"),mn=gn("bottom"),vn=gn("left"),wn=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:wt.VALUE,prefix:!1,parse:function(e,t){return Ye(t)?t.number:0}}},kn=wn("top"),Cn=wn("right"),bn=wn("bottom"),Sn=wn("left"),Tn={name:"color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"},xn={name:"display",initialValue:"inline-block",prefix:!1,type:wt.LIST,parse:function(e,t){return t.filter(Xe).reduce((function(e,t){return e|Mn(t.value)}),0)}},Mn=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0};!function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.INLINE_START=3]="INLINE_START",e[e.INLINE_END=4]="INLINE_END"}(yn||(yn={}));var Un,Qn={name:"float",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"left":return yn.LEFT;case"right":return yn.RIGHT;case"inline-start":return yn.INLINE_START;case"inline-end":return yn.INLINE_END}return yn.NONE}},Ln={name:"letter-spacing",initialValue:"0",prefix:!1,type:wt.VALUE,parse:function(e,t){return t.type===d.IDENT_TOKEN&&"normal"===t.value?0:t.type===d.NUMBER_TOKEN||t.type===d.DIMENSION_TOKEN?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Un||(Un={}));var Fn,Rn={name:"line-break",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){return"strict"===t?Un.STRICT:Un.NORMAL}},Hn={name:"line-height",initialValue:"normal",prefix:!1,type:wt.TOKEN_VALUE},_n=function(e,t){return Xe(e)&&"normal"===e.value?1.2*t:e.type===d.NUMBER_TOKEN?t*e.number:nt(e)?st(e,t):t},Dn={name:"list-style-image",initialValue:"none",type:wt.VALUE,prefix:!1,parse:function(e,t){return t.type===d.IDENT_TOKEN&&"none"===t.value?null:Xt(e,t)}};!function(e){e[e.INSIDE=0]="INSIDE",e[e.OUTSIDE=1]="OUTSIDE"}(Fn||(Fn={}));var In,On={name:"list-style-position",initialValue:"outside",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){return"inside"===t?Fn.INSIDE:Fn.OUTSIDE}};!function(e){e[e.NONE=-1]="NONE",e[e.DISC=0]="DISC",e[e.CIRCLE=1]="CIRCLE",e[e.SQUARE=2]="SQUARE",e[e.DECIMAL=3]="DECIMAL",e[e.CJK_DECIMAL=4]="CJK_DECIMAL",e[e.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",e[e.LOWER_ROMAN=6]="LOWER_ROMAN",e[e.UPPER_ROMAN=7]="UPPER_ROMAN",e[e.LOWER_GREEK=8]="LOWER_GREEK",e[e.LOWER_ALPHA=9]="LOWER_ALPHA",e[e.UPPER_ALPHA=10]="UPPER_ALPHA",e[e.ARABIC_INDIC=11]="ARABIC_INDIC",e[e.ARMENIAN=12]="ARMENIAN",e[e.BENGALI=13]="BENGALI",e[e.CAMBODIAN=14]="CAMBODIAN",e[e.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",e[e.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",e[e.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",e[e.DEVANAGARI=18]="DEVANAGARI",e[e.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",e[e.GEORGIAN=20]="GEORGIAN",e[e.GUJARATI=21]="GUJARATI",e[e.GURMUKHI=22]="GURMUKHI",e[e.HEBREW=22]="HEBREW",e[e.HIRAGANA=23]="HIRAGANA",e[e.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",e[e.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",e[e.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",e[e.KANNADA=27]="KANNADA",e[e.KATAKANA=28]="KATAKANA",e[e.KATAKANA_IROHA=29]="KATAKANA_IROHA",e[e.KHMER=30]="KHMER",e[e.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",e[e.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",e[e.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",e[e.LAO=34]="LAO",e[e.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",e[e.MALAYALAM=36]="MALAYALAM",e[e.MONGOLIAN=37]="MONGOLIAN",e[e.MYANMAR=38]="MYANMAR",e[e.ORIYA=39]="ORIYA",e[e.PERSIAN=40]="PERSIAN",e[e.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",e[e.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",e[e.TAMIL=43]="TAMIL",e[e.TELUGU=44]="TELUGU",e[e.THAI=45]="THAI",e[e.TIBETAN=46]="TIBETAN",e[e.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",e[e.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",e[e.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",e[e.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN",e[e.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"}(In||(In={}));var Pn,Nn={name:"list-style-type",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"disc":return In.DISC;case"circle":return In.CIRCLE;case"square":return In.SQUARE;case"decimal":return In.DECIMAL;case"cjk-decimal":return In.CJK_DECIMAL;case"decimal-leading-zero":return In.DECIMAL_LEADING_ZERO;case"lower-roman":return In.LOWER_ROMAN;case"upper-roman":return In.UPPER_ROMAN;case"lower-greek":return In.LOWER_GREEK;case"lower-alpha":return In.LOWER_ALPHA;case"upper-alpha":return In.UPPER_ALPHA;case"arabic-indic":return In.ARABIC_INDIC;case"armenian":return In.ARMENIAN;case"bengali":return In.BENGALI;case"cambodian":return In.CAMBODIAN;case"cjk-earthly-branch":return In.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return In.CJK_HEAVENLY_STEM;case"cjk-ideographic":return In.CJK_IDEOGRAPHIC;case"devanagari":return In.DEVANAGARI;case"ethiopic-numeric":return In.ETHIOPIC_NUMERIC;case"georgian":return In.GEORGIAN;case"gujarati":return In.GUJARATI;case"gurmukhi":return In.GURMUKHI;case"hebrew":return In.HEBREW;case"hiragana":return In.HIRAGANA;case"hiragana-iroha":return In.HIRAGANA_IROHA;case"japanese-formal":return In.JAPANESE_FORMAL;case"japanese-informal":return In.JAPANESE_INFORMAL;case"kannada":return In.KANNADA;case"katakana":return In.KATAKANA;case"katakana-iroha":return In.KATAKANA_IROHA;case"khmer":return In.KHMER;case"korean-hangul-formal":return In.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return In.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return In.KOREAN_HANJA_INFORMAL;case"lao":return In.LAO;case"lower-armenian":return In.LOWER_ARMENIAN;case"malayalam":return In.MALAYALAM;case"mongolian":return In.MONGOLIAN;case"myanmar":return In.MYANMAR;case"oriya":return In.ORIYA;case"persian":return In.PERSIAN;case"simp-chinese-formal":return In.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return In.SIMP_CHINESE_INFORMAL;case"tamil":return In.TAMIL;case"telugu":return In.TELUGU;case"thai":return In.THAI;case"tibetan":return In.TIBETAN;case"trad-chinese-formal":return In.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return In.TRAD_CHINESE_INFORMAL;case"upper-armenian":return In.UPPER_ARMENIAN;case"disclosure-open":return In.DISCLOSURE_OPEN;case"disclosure-closed":return In.DISCLOSURE_CLOSED;default:return In.NONE}}},Kn=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:wt.TOKEN_VALUE}},Vn=Kn("top"),Gn=Kn("right"),jn=Kn("bottom"),Yn=Kn("left");!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.SCROLL=2]="SCROLL",e[e.AUTO=3]="AUTO"}(Pn||(Pn={}));var Wn,Xn={name:"overflow",initialValue:"visible",prefix:!1,type:wt.LIST,parse:function(e,t){return t.filter(Xe).map((function(e){switch(e.value){case"hidden":return Pn.HIDDEN;case"scroll":return Pn.SCROLL;case"auto":return Pn.AUTO;default:return Pn.VISIBLE}}))}};!function(e){e.NORMAL="normal",e.BREAK_WORD="break-word"}(Wn||(Wn={}));var Jn,zn={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){return"break-word"===t?Wn.BREAK_WORD:Wn.NORMAL}},Zn=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:wt.TYPE_VALUE,format:"length-percentage"}},qn=Zn("top"),$n=Zn("right"),er=Zn("bottom"),tr=Zn("left");!function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(Jn||(Jn={}));var nr,rr={name:"text-align",initialValue:"left",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"right":return Jn.RIGHT;case"center":case"justify":return Jn.CENTER;default:return Jn.LEFT}}};!function(e){e[e.STATIC=0]="STATIC",e[e.RELATIVE=1]="RELATIVE",e[e.ABSOLUTE=2]="ABSOLUTE",e[e.FIXED=3]="FIXED",e[e.STICKY=4]="STICKY"}(nr||(nr={}));var Ar,ir={name:"position",initialValue:"static",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"relative":return nr.RELATIVE;case"absolute":return nr.ABSOLUTE;case"fixed":return nr.FIXED;case"sticky":return nr.STICKY}return nr.STATIC}},or={name:"text-shadow",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e,t){return 1===t.length&&ze(t[0],"none")?[]:$e(t).map((function(t){for(var n={color:Tt.TRANSPARENT,offsetX:At,offsetY:At,blur:At},r=0,A=0;A<t.length;A++){var i=t[A];tt(i)?(0===r?n.offsetX=i:1===r?n.offsetY=i:n.blur=i,r++):n.color=ft(e,i)}return n}))}};!function(e){e[e.NONE=0]="NONE",e[e.LOWERCASE=1]="LOWERCASE",e[e.UPPERCASE=2]="UPPERCASE",e[e.CAPITALIZE=3]="CAPITALIZE"}(Ar||(Ar={}));var ar,sr={name:"text-transform",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"uppercase":return Ar.UPPERCASE;case"lowercase":return Ar.LOWERCASE;case"capitalize":return Ar.CAPITALIZE}return Ar.NONE}},ur={name:"transform",initialValue:"none",prefix:!0,type:wt.VALUE,parse:function(e,t){if(t.type===d.IDENT_TOKEN&&"none"===t.value)return null;if(t.type===d.FUNCTION){var n=cr[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},cr={matrix:function(e){var t=e.filter((function(e){return e.type===d.NUMBER_TOKEN})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return e.type===d.NUMBER_TOKEN})).map((function(e){return e.number})),n=t[0],r=t[1];t[2],t[3];var A=t[4],i=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var o=t[12],a=t[13];return t[14],t[15],16===t.length?[n,r,A,i,o,a]:null}},lr={type:d.PERCENTAGE_TOKEN,number:50,flags:4},hr=[lr,lr],pr={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:wt.LIST,parse:function(e,t){var n=t.filter(nt);return 2!==n.length?hr:[n[0],n[1]]}};!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.COLLAPSE=2]="COLLAPSE"}(ar||(ar={}));var dr,fr={name:"visible",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"hidden":return ar.HIDDEN;case"collapse":return ar.COLLAPSE;default:return ar.VISIBLE}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(dr||(dr={}));var yr,gr={name:"word-break",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"break-all":return dr.BREAK_ALL;case"keep-all":return dr.KEEP_ALL;default:return dr.NORMAL}}},Er={name:"z-index",initialValue:"auto",prefix:!1,type:wt.VALUE,parse:function(e,t){if(t.type===d.IDENT_TOKEN)return{auto:!0,order:0};if(We(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Br={name:"opacity",initialValue:"1",type:wt.VALUE,prefix:!1,parse:function(e,t){return We(t)?t.number:1}},mr={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"},vr={name:"text-decoration-line",initialValue:"none",prefix:!1,type:wt.LIST,parse:function(e,t){return t.filter(Xe).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},wr={name:"font-family",initialValue:"",prefix:!1,type:wt.LIST,parse:function(e,t){var n=[],r=[];return t.forEach((function(e){switch(e.type){case d.IDENT_TOKEN:case d.STRING_TOKEN:n.push(e.value);break;case d.NUMBER_TOKEN:n.push(e.number.toString());break;case d.COMMA_TOKEN:r.push(n.join(" ")),n.length=0}})),n.length&&r.push(n.join(" ")),r.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},kr={name:"font-size",initialValue:"0",prefix:!1,type:wt.TYPE_VALUE,format:"length"},Cr={name:"font-weight",initialValue:"normal",type:wt.VALUE,prefix:!1,parse:function(e,t){return We(t)?t.number:Xe(t)&&"bold"===t.value?700:400}},br={name:"font-variant",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e,t){return t.filter(Xe).map((function(e){return e.value}))}};!function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(yr||(yr={}));var Sr,Tr={name:"font-style",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e,t){switch(t){case"oblique":return yr.OBLIQUE;case"italic":return yr.ITALIC;default:return yr.NORMAL}}},xr=function(e,t){return 0!=(e&t)},Mr={name:"content",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return n.type===d.IDENT_TOKEN&&"none"===n.value?[]:t}},Ur={name:"counter-increment",initialValue:"none",prefix:!0,type:wt.LIST,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(n.type===d.IDENT_TOKEN&&"none"===n.value)return null;for(var r=[],A=t.filter(Ze),i=0;i<A.length;i++){var o=A[i],a=A[i+1];if(o.type===d.IDENT_TOKEN){var s=a&&We(a)?a.number:1;r.push({counter:o.value,increment:s})}}return r}},Qr={name:"counter-reset",initialValue:"none",prefix:!0,type:wt.LIST,parse:function(e,t){if(0===t.length)return[];for(var n=[],r=t.filter(Ze),A=0;A<r.length;A++){var i=r[A],o=r[A+1];if(Xe(i)&&"none"!==i.value){var a=o&&We(o)?o.number:0;n.push({counter:i.value,reset:a})}}return n}},Lr={name:"quotes",initialValue:"none",prefix:!0,type:wt.LIST,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(n.type===d.IDENT_TOKEN&&"none"===n.value)return null;var r=[],A=t.filter(Je);if(A.length%2!=0)return null;for(var i=0;i<A.length;i+=2){var o=A[i].value,a=A[i+1].value;r.push({open:o,close:a})}return r}},Fr=function(e,t,n){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?n?r.open:r.close:""},Rr={name:"box-shadow",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e,t){return 1===t.length&&ze(t[0],"none")?[]:$e(t).map((function(t){for(var n={color:255,offsetX:At,offsetY:At,blur:At,spread:At,inset:!1},r=0,A=0;A<t.length;A++){var i=t[A];ze(i,"inset")?n.inset=!0:tt(i)?(0===r?n.offsetX=i:1===r?n.offsetY=i:2===r?n.blur=i:n.spread=i,r++):n.color=ft(e,i)}return n}))}};!function(e){e[e.FILL=0]="FILL",e[e.STROKE=1]="STROKE",e[e.MARKERS=2]="MARKERS"}(Sr||(Sr={}));var Hr,_r={name:"paint-order",initialValue:"normal",prefix:!1,type:wt.LIST,parse:function(e,t){var n=[Sr.FILL,Sr.STROKE,Sr.MARKERS],r=[];return t.filter(Xe).forEach((function(e){switch(e.value){case"stroke":r.push(Sr.STROKE);break;case"fill":r.push(Sr.FILL);break;case"markers":r.push(Sr.MARKERS)}})),n.forEach((function(e){-1===r.indexOf(e)&&r.push(e)})),r}},Dr={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:wt.TYPE_VALUE,format:"color"},Ir={name:"-webkit-text-stroke-width",initialValue:"0",type:wt.VALUE,prefix:!1,parse:function(e,t){return Ye(t)?t.number:0}},Or=function(){function e(e,t){var n,r;this.backgroundClip=Kr(e,Qt,t.backgroundClip),this.backgroundColor=Kr(e,Lt,t.backgroundColor),this.backgroundImage=Kr(e,zt,t.backgroundImage),this.backgroundOrigin=Kr(e,Zt,t.backgroundOrigin),this.backgroundPosition=Kr(e,qt,t.backgroundPosition),this.backgroundRepeat=Kr(e,en,t.backgroundRepeat),this.backgroundSize=Kr(e,rn,t.backgroundSize),this.borderTopColor=Kr(e,an,t.borderTopColor),this.borderRightColor=Kr(e,sn,t.borderRightColor),this.borderBottomColor=Kr(e,un,t.borderBottomColor),this.borderLeftColor=Kr(e,cn,t.borderLeftColor),this.borderTopLeftRadius=Kr(e,hn,t.borderTopLeftRadius),this.borderTopRightRadius=Kr(e,pn,t.borderTopRightRadius),this.borderBottomRightRadius=Kr(e,dn,t.borderBottomRightRadius),this.borderBottomLeftRadius=Kr(e,fn,t.borderBottomLeftRadius),this.borderTopStyle=Kr(e,En,t.borderTopStyle),this.borderRightStyle=Kr(e,Bn,t.borderRightStyle),this.borderBottomStyle=Kr(e,mn,t.borderBottomStyle),this.borderLeftStyle=Kr(e,vn,t.borderLeftStyle),this.borderTopWidth=Kr(e,kn,t.borderTopWidth),this.borderRightWidth=Kr(e,Cn,t.borderRightWidth),this.borderBottomWidth=Kr(e,bn,t.borderBottomWidth),this.borderLeftWidth=Kr(e,Sn,t.borderLeftWidth),this.boxShadow=Kr(e,Rr,t.boxShadow),this.color=Kr(e,Tn,t.color),this.display=Kr(e,xn,t.display),this.float=Kr(e,Qn,t.cssFloat),this.fontFamily=Kr(e,wr,t.fontFamily),this.fontSize=Kr(e,kr,t.fontSize),this.fontStyle=Kr(e,Tr,t.fontStyle),this.fontVariant=Kr(e,br,t.fontVariant),this.fontWeight=Kr(e,Cr,t.fontWeight),this.letterSpacing=Kr(e,Ln,t.letterSpacing),this.lineBreak=Kr(e,Rn,t.lineBreak),this.lineHeight=Kr(e,Hn,t.lineHeight),this.listStyleImage=Kr(e,Dn,t.listStyleImage),this.listStylePosition=Kr(e,On,t.listStylePosition),this.listStyleType=Kr(e,Nn,t.listStyleType),this.marginTop=Kr(e,Vn,t.marginTop),this.marginRight=Kr(e,Gn,t.marginRight),this.marginBottom=Kr(e,jn,t.marginBottom),this.marginLeft=Kr(e,Yn,t.marginLeft),this.opacity=Kr(e,Br,t.opacity);var A=Kr(e,Xn,t.overflow);this.overflowX=A[0],this.overflowY=A[A.length>1?1:0],this.overflowWrap=Kr(e,zn,t.overflowWrap),this.paddingTop=Kr(e,qn,t.paddingTop),this.paddingRight=Kr(e,$n,t.paddingRight),this.paddingBottom=Kr(e,er,t.paddingBottom),this.paddingLeft=Kr(e,tr,t.paddingLeft),this.paintOrder=Kr(e,_r,t.paintOrder),this.position=Kr(e,ir,t.position),this.textAlign=Kr(e,rr,t.textAlign),this.textDecorationColor=Kr(e,mr,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=Kr(e,vr,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=Kr(e,or,t.textShadow),this.textTransform=Kr(e,sr,t.textTransform),this.transform=Kr(e,ur,t.transform),this.transformOrigin=Kr(e,pr,t.transformOrigin),this.visibility=Kr(e,fr,t.visibility),this.webkitTextStrokeColor=Kr(e,Dr,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Kr(e,Ir,t.webkitTextStrokeWidth),this.wordBreak=Kr(e,gr,t.wordBreak),this.zIndex=Kr(e,Er,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===ar.VISIBLE},e.prototype.isTransparent=function(){return yt(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return this.position!==nr.STATIC},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==yn.NONE},e.prototype.isInlineLevel=function(){return xr(this.display,4)||xr(this.display,33554432)||xr(this.display,268435456)||xr(this.display,536870912)||xr(this.display,67108864)||xr(this.display,134217728)},e}(),Pr=function(e,t){this.content=Kr(e,Mr,t.content),this.quotes=Kr(e,Lr,t.quotes)},Nr=function(e,t){this.counterIncrement=Kr(e,Ur,t.counterIncrement),this.counterReset=Kr(e,Qr,t.counterReset)},Kr=function(e,t,n){var r=new Ge,A=null!=n?n.toString():t.initialValue;r.write(A);var i=new je(r.read());switch(t.type){case wt.IDENT_VALUE:var o=i.parseComponentValue();return t.parse(e,Xe(o)?o.value:t.initialValue);case wt.VALUE:return t.parse(e,i.parseComponentValue());case wt.LIST:return t.parse(e,i.parseComponentValues());case wt.TOKEN_VALUE:return i.parseComponentValue();case wt.TYPE_VALUE:switch(t.format){case"angle":return lt(0,i.parseComponentValue());case"color":return ft(e,i.parseComponentValue());case"image":return Xt(e,i.parseComponentValue());case"length":var a=i.parseComponentValue();return tt(a)?a:At;case"length-percentage":var s=i.parseComponentValue();return nt(s)?s:At}}},Vr=function(e,t){this.context=e,this.styles=new Or(e,window.getComputedStyle(t,null)),this.textNodes=[],this.elements=[],null!==this.styles.transform&&CA(t)&&(t.style.transform="none"),this.bounds=s(this.context,t),this.flags=0},Gr=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},jr=function(e,t,n,r,A){var i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg"),a=document.createElementNS(i,"foreignObject");return o.setAttributeNS(null,"width",e.toString()),o.setAttributeNS(null,"height",t.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",n.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(a),a.appendChild(A),o},Yr=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Wr={get SUPPORT_RANGE_BOUNDS(){var e=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var n=e.createElement("boundtest");n.style.height="123px",n.style.display="block",e.body.appendChild(n),t.selectNode(n);var r=t.getBoundingClientRect(),A=Math.round(r.height);if(e.body.removeChild(n),123===A)return!0}}return!1}(document);return Object.defineProperty(Wr,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Wr.SUPPORT_RANGE_BOUNDS&&function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,A=u(r.data).map((function(e){return c(e)})),i=0,o={},a=A.every((function(e,t){n.setStart(r,i),n.setEnd(r,i+e.length);var A=n.getBoundingClientRect();i+=e.length;var a=A.x>o.x||A.y>o.y;return o=A,0===t||a}));return e.body.removeChild(t),a}(document);return Object.defineProperty(Wr,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=function(e){var t=new Image,n=e.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),n.toDataURL()}catch(e){return!1}return!0}(document);return Object.defineProperty(Wr,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var r=t.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var A=new Image,i=t.toDataURL();A.src=i;var o=jr(n,n,0,0,A);return r.fillStyle="red",r.fillRect(0,0,n,n),Yr(o).then((function(t){r.drawImage(t,0,0);var A=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var o=e.createElement("div");return o.style.backgroundImage="url("+i+")",o.style.height="100px",Gr(A)?Yr(jr(n,n,0,0,o)):Promise.reject(!1)})).then((function(e){return r.drawImage(e,0,0),Gr(r.getImageData(0,0,n,n).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Wr,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=void 0!==(new Image).crossOrigin;return Object.defineProperty(Wr,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Wr,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Wr,"SUPPORT_CORS_XHR",{value:e}),e}},Xr=function(e,t){this.text=e,this.bounds=t},Jr=function(e,t,n){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var A=r.createRange();return A.setStart(e,t),A.setEnd(e,t+n),A},zr=[32,160,4961,65792,65793,4153,4241],Zr=function(e,t){for(var n,r=function(e,t){var n=u(e),r=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=function(e,t){void 0===t&&(t="strict");var n=[],r=[],A=[];return e.forEach((function(e,i){var o=q.get(e);if(o>50?(A.push(!0),o-=50):A.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(i),n.push(16);if(4===o||11===o){if(0===i)return r.push(i),n.push(O);var a=n[i-1];return-1===re.indexOf(a)?(r.push(r[i-1]),n.push(a)):(r.push(i),n.push(O))}return r.push(i),31===o?n.push("strict"===t?L:G):o===X||29===o?n.push(O):43===o?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(G):n.push(O):void n.push(o)})),[r,n,A]}(e,t.lineBreak),r=n[0],A=n[1],i=n[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(A=A.map((function(e){return-1!==[H,O,X].indexOf(e)?G:e})));var o="keep-all"===t.wordBreak?i.map((function(t,n){return t&&e[n]>=19968&&e[n]<=40959})):void 0;return[r,A,o]}(n,t),A=r[0],i=r[1],o=r[2],a=n.length,s=0,c=0;return{next:function(){if(c>=a)return{done:!0,value:null};for(var e=z;c<a&&(e=se(n,i,A,++c,o))===z;);if(e!==z||c===a){var t=new ue(n,e,s,c);return s=c,{value:t,done:!1}}return{done:!0,value:null}}}}(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap===Wn.BREAK_WORD?"break-word":t.wordBreak}),A=[],i=function(){if(n.value){var e=n.value.slice(),t=u(e),r="";t.forEach((function(e){-1===zr.indexOf(e)?r+=c(e):(r.length&&A.push(r),A.push(c(e)),r="")})),r.length&&A.push(r)}};!(n=r.next()).done;)i();return A},qr=function(e,t,n){this.text=$r(t.data,n.textTransform),this.textBounds=function(e,t,n,r){var A=function(e,t){return 0!==t.letterSpacing?u(e).map((function(e){return c(e)})):Zr(e,t)}(t,n),i=[],o=0;return A.forEach((function(t){if(n.textDecorationLine.length||t.trim().length>0)if(Wr.SUPPORT_RANGE_BOUNDS)Wr.SUPPORT_WORD_BREAKING?i.push(new Xr(t,function(e,t,n,r){return a.fromClientRect(e,Jr(t,n,r).getBoundingClientRect())}(e,r,o,t.length))):i.push(new Xr(t,a.fromDOMRectList(e,Jr(r,o,t.length).getClientRects())));else{var A=r.splitText(t.length);i.push(new Xr(t,function(e,t){var n=t.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var A=t.parentNode;if(A){A.replaceChild(r,t);var i=s(e,r);return r.firstChild&&A.replaceChild(r.firstChild,r),i}}return a.EMPTY}(e,r))),r=A}else Wr.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));o+=t.length})),i}(e,this.text,n,t)},$r=function(e,t){switch(t){case Ar.LOWERCASE:return e.toLowerCase();case Ar.CAPITALIZE:return e.replace(eA,tA);case Ar.UPPERCASE:return e.toUpperCase();default:return e}},eA=/(^|\s|:|-|\(|\))([a-z])/g,tA=function(e,t,n){return e.length>0?t+n.toUpperCase():e},nA=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.src=n.currentSrc||n.src,r.intrinsicWidth=n.naturalWidth,r.intrinsicHeight=n.naturalHeight,r.context.cache.addImage(r.src),r}return t(n,e),n}(Vr),rA=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n,r.intrinsicWidth=n.width,r.intrinsicHeight=n.height,r}return t(n,e),n}(Vr),AA=function(e){function n(t,n){var r=e.call(this,t,n)||this,A=new XMLSerializer,i=s(t,n);return n.setAttribute("width",i.width+"px"),n.setAttribute("height",i.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(A.serializeToString(n)),r.intrinsicWidth=n.width.baseVal.value,r.intrinsicHeight=n.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t(n,e),n}(Vr),iA=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(Vr),oA=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.start=n.start,r.reversed="boolean"==typeof n.reversed&&!0===n.reversed,r}return t(n,e),n}(Vr),aA=[{type:d.DIMENSION_TOKEN,flags:0,unit:"px",number:3}],sA=[{type:d.PERCENTAGE_TOKEN,flags:0,number:50}],uA="checkbox",cA="radio",lA=707406591,hA=function(e){function n(t,n){var r,A,i,o=e.call(this,t,n)||this;switch(o.type=n.type.toLowerCase(),o.checked=n.checked,o.value=0===(A="password"===(r=n).type?new Array(r.value.length+1).join("•"):r.value).length?r.placeholder||"":A,o.type!==uA&&o.type!==cA||(o.styles.backgroundColor=3739148031,o.styles.borderTopColor=o.styles.borderRightColor=o.styles.borderBottomColor=o.styles.borderLeftColor=2779096575,o.styles.borderTopWidth=o.styles.borderRightWidth=o.styles.borderBottomWidth=o.styles.borderLeftWidth=1,o.styles.borderTopStyle=o.styles.borderRightStyle=o.styles.borderBottomStyle=o.styles.borderLeftStyle=nn.SOLID,o.styles.backgroundClip=[kt.BORDER_BOX],o.styles.backgroundOrigin=[0],o.bounds=(i=o.bounds).width>i.height?new a(i.left+(i.width-i.height)/2,i.top,i.height,i.height):i.width<i.height?new a(i.left,i.top+(i.height-i.width)/2,i.width,i.width):i),o.type){case uA:o.styles.borderTopRightRadius=o.styles.borderTopLeftRadius=o.styles.borderBottomRightRadius=o.styles.borderBottomLeftRadius=aA;break;case cA:o.styles.borderTopRightRadius=o.styles.borderTopLeftRadius=o.styles.borderBottomRightRadius=o.styles.borderBottomLeftRadius=sA}return o}return t(n,e),n}(Vr),pA=function(e){function n(t,n){var r=e.call(this,t,n)||this,A=n.options[n.selectedIndex||0];return r.value=A&&A.text||"",r}return t(n,e),n}(Vr),dA=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(Vr),fA=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.src=n.src,r.width=parseInt(n.width,10)||0,r.height=parseInt(n.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){r.tree=BA(t,n.contentWindow.document.documentElement);var A=n.contentWindow.document.documentElement?St(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):Tt.TRANSPARENT,i=n.contentWindow.document.body?St(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):Tt.TRANSPARENT;r.backgroundColor=yt(A)?yt(i)?r.styles.backgroundColor:i:A}}catch(e){}return r}return t(n,e),n}(Vr),yA=["OL","UL","MENU"],gA=function e(t,n,r,A){for(var i=n.firstChild,o=void 0;i;i=o)if(o=i.nextSibling,wA(i)&&i.data.trim().length>0)r.textNodes.push(new qr(t,i,r.styles));else if(kA(i))if(IA(i)&&i.assignedNodes)i.assignedNodes().forEach((function(n){return e(t,n,r,A)}));else{var a=EA(t,i);a.styles.isVisible()&&(mA(i,a,A)?a.flags|=4:vA(a.styles)&&(a.flags|=2),-1!==yA.indexOf(i.tagName)&&(a.flags|=8),r.elements.push(a),i.slot,i.shadowRoot?e(t,i.shadowRoot,a,A):_A(i)||MA(i)||DA(i)||e(t,i,a,A))}},EA=function(e,t){return LA(t)?new nA(e,t):QA(t)?new rA(e,t):MA(t)?new AA(e,t):SA(t)?new iA(e,t):TA(t)?new oA(e,t):xA(t)?new hA(e,t):DA(t)?new pA(e,t):_A(t)?new dA(e,t):FA(t)?new fA(e,t):new Vr(e,t)},BA=function(e,t){var n=EA(e,t);return n.flags|=4,gA(e,t,n,n),n},mA=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||UA(e)&&n.styles.isTransparent()},vA=function(e){return e.isPositioned()||e.isFloating()},wA=function(e){return e.nodeType===Node.TEXT_NODE},kA=function(e){return e.nodeType===Node.ELEMENT_NODE},CA=function(e){return kA(e)&&void 0!==e.style&&!bA(e)},bA=function(e){return"object"===o(e.className)},SA=function(e){return"LI"===e.tagName},TA=function(e){return"OL"===e.tagName},xA=function(e){return"INPUT"===e.tagName},MA=function(e){return"svg"===e.tagName},UA=function(e){return"BODY"===e.tagName},QA=function(e){return"CANVAS"===e.tagName},LA=function(e){return"IMG"===e.tagName},FA=function(e){return"IFRAME"===e.tagName},RA=function(e){return"STYLE"===e.tagName},HA=function(e){return"SCRIPT"===e.tagName},_A=function(e){return"TEXTAREA"===e.tagName},DA=function(e){return"SELECT"===e.tagName},IA=function(e){return"SLOT"===e.tagName},OA=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){return this.counters[e]||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,r=e.counterReset,A=!0;null!==n&&n.forEach((function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(A=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)}));var i=[];return A&&r.forEach((function(e){var n=t.counters[e.counter];i.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)})),i},e}(),PA={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},NA={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},KA={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},VA={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},GA=function(e,t,n,r,A,i){return e<t||e>n?$A(e,A,i.length>0):r.integers.reduce((function(t,n,A){for(;e>=n;)e-=n,t+=r.values[A];return t}),"")+i},jA=function(e,t,n,r){var A="";do{n||e--,A=r(e)+A,e/=t}while(e*t>=t);return A},YA=function(e,t,n,r,A){var i=n-t+1;return(e<0?"-":"")+(jA(Math.abs(e),i,r,(function(e){return c(Math.floor(e%i)+t)}))+A)},WA=function(e,t,n){void 0===n&&(n=". ");var r=t.length;return jA(Math.abs(e),r,!1,(function(e){return t[Math.floor(e%r)]}))+n},XA=function(e,t,n,r,A,i){if(e<-9999||e>9999)return $A(e,In.CJK_DECIMAL,A.length>0);var o=Math.abs(e),a=A;if(0===o)return t[0]+a;for(var s=0;o>0&&s<=4;s++){var u=o%10;0===u&&xr(i,1)&&""!==a?a=t[u]+a:u>1||1===u&&0===s||1===u&&1===s&&xr(i,2)||1===u&&1===s&&xr(i,4)&&e>100||1===u&&s>1&&xr(i,8)?a=t[u]+(s>0?n[s-1]:"")+a:1===u&&s>0&&(a=n[s-1]+a),o=Math.floor(o/10)}return(e<0?r:"")+a},JA="十百千萬",zA="拾佰仟萬",ZA="マイナス",qA="마이너스",$A=function(e,t,n){var r=n?". ":"",A=n?"、":"",i=n?", ":"",o=n?" ":"";switch(t){case In.DISC:return"•"+o;case In.CIRCLE:return"◦"+o;case In.SQUARE:return"◾"+o;case In.DECIMAL_LEADING_ZERO:var a=YA(e,48,57,!0,r);return a.length<4?"0"+a:a;case In.CJK_DECIMAL:return WA(e,"〇一二三四五六七八九",A);case In.LOWER_ROMAN:return GA(e,1,3999,PA,In.DECIMAL,r).toLowerCase();case In.UPPER_ROMAN:return GA(e,1,3999,PA,In.DECIMAL,r);case In.LOWER_GREEK:return YA(e,945,969,!1,r);case In.LOWER_ALPHA:return YA(e,97,122,!1,r);case In.UPPER_ALPHA:return YA(e,65,90,!1,r);case In.ARABIC_INDIC:return YA(e,1632,1641,!0,r);case In.ARMENIAN:case In.UPPER_ARMENIAN:return GA(e,1,9999,NA,In.DECIMAL,r);case In.LOWER_ARMENIAN:return GA(e,1,9999,NA,In.DECIMAL,r).toLowerCase();case In.BENGALI:return YA(e,2534,2543,!0,r);case In.CAMBODIAN:case In.KHMER:return YA(e,6112,6121,!0,r);case In.CJK_EARTHLY_BRANCH:return WA(e,"子丑寅卯辰巳午未申酉戌亥",A);case In.CJK_HEAVENLY_STEM:return WA(e,"甲乙丙丁戊己庚辛壬癸",A);case In.CJK_IDEOGRAPHIC:case In.TRAD_CHINESE_INFORMAL:return XA(e,"零一二三四五六七八九",JA,"負",A,14);case In.TRAD_CHINESE_FORMAL:return XA(e,"零壹貳參肆伍陸柒捌玖",zA,"負",A,15);case In.SIMP_CHINESE_INFORMAL:return XA(e,"零一二三四五六七八九",JA,"负",A,14);case In.SIMP_CHINESE_FORMAL:return XA(e,"零壹贰叁肆伍陆柒捌玖",zA,"负",A,15);case In.JAPANESE_INFORMAL:return XA(e,"〇一二三四五六七八九","十百千万",ZA,A,0);case In.JAPANESE_FORMAL:return XA(e,"零壱弐参四伍六七八九","拾百千万",ZA,A,7);case In.KOREAN_HANGUL_FORMAL:return XA(e,"영일이삼사오육칠팔구","십백천만",qA,i,7);case In.KOREAN_HANJA_INFORMAL:return XA(e,"零一二三四五六七八九","十百千萬",qA,i,0);case In.KOREAN_HANJA_FORMAL:return XA(e,"零壹貳參四五六七八九","拾百千",qA,i,7);case In.DEVANAGARI:return YA(e,2406,2415,!0,r);case In.GEORGIAN:return GA(e,1,19999,VA,In.DECIMAL,r);case In.GUJARATI:return YA(e,2790,2799,!0,r);case In.GURMUKHI:return YA(e,2662,2671,!0,r);case In.HEBREW:return GA(e,1,10999,KA,In.DECIMAL,r);case In.HIRAGANA:return WA(e,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case In.HIRAGANA_IROHA:return WA(e,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case In.KANNADA:return YA(e,3302,3311,!0,r);case In.KATAKANA:return WA(e,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",A);case In.KATAKANA_IROHA:return WA(e,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",A);case In.LAO:return YA(e,3792,3801,!0,r);case In.MONGOLIAN:return YA(e,6160,6169,!0,r);case In.MYANMAR:return YA(e,4160,4169,!0,r);case In.ORIYA:return YA(e,2918,2927,!0,r);case In.PERSIAN:return YA(e,1776,1785,!0,r);case In.TAMIL:return YA(e,3046,3055,!0,r);case In.TELUGU:return YA(e,3174,3183,!0,r);case In.THAI:return YA(e,3664,3673,!0,r);case In.TIBETAN:return YA(e,3872,3881,!0,r);case In.DECIMAL:default:return YA(e,48,57,!0,r)}},ei="data-html2canvas-ignore",ti=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new OA,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement)}return e.prototype.toIFrame=function(e,t){var n=this,i=ri(e,t);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,s=i.contentWindow,u=s.document,c=oi(i).then((function(){return r(n,void 0,void 0,(function(){var e,n;return A(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(li),s&&(s.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||s.scrollY===t.top&&s.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-t.left,s.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:u.fonts&&u.fonts.ready?[4,u.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,ii(u)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(u,n)})).then((function(){return i}))]:[2,i]}}))}))}));return u.open(),u.write(ui(document.doctype)+"<html></html>"),ci(this.referenceElement.ownerDocument,o,a),u.replaceChild(u.adoptNode(this.documentElement),u.documentElement),u.close(),c},e.prototype.createElementClone=function(e){if(QA(e))return this.createCanvasClone(e);if(RA(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return LA(t)&&(LA(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),r=e.cloneNode(!1);return r.textContent=n,r}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(e){this.context.logger.info("Unable to clone canvas contents, canvas is tainted")}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var r=e.getContext("2d"),A=n.getContext("2d");return A&&(r?A.putImageData(r.getImageData(0,0,e.width,e.height),0,0):A.drawImage(e,0,0)),n}catch(e){}return n},e.prototype.cloneNode=function(e){if(wA(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var t=e.ownerDocument.defaultView;if(t&&kA(e)&&(CA(e)||bA(e))){var n=this.createElementClone(e),r=t.getComputedStyle(e),A=t.getComputedStyle(e,":before"),i=t.getComputedStyle(e,":after");this.referenceElement===e&&CA(n)&&(this.clonedReferenceElement=n),UA(n)&&fi(n);for(var o=this.counters.parse(new Nr(this.context,r)),a=this.resolvePseudoContent(e,n,A,Hr.BEFORE),s=e.firstChild;s;s=s.nextSibling)kA(s)&&(HA(s)||s.hasAttribute(ei)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(s))||this.options.copyStyles&&kA(s)&&RA(s)||n.appendChild(this.cloneNode(s));a&&n.insertBefore(a,n.firstChild);var u=this.resolvePseudoContent(e,n,i,Hr.AFTER);return u&&n.appendChild(u),this.counters.pop(o),r&&(this.options.copyStyles||bA(e))&&!FA(e)&&si(r,n),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(_A(e)||DA(e))&&(_A(n)||DA(n))&&(n.value=e.value),n}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,r){var A=this;if(n){var i=n.content,o=t.ownerDocument;if(o&&i&&"none"!==i&&"-moz-alt-content"!==i&&"none"!==n.display){this.counters.parse(new Nr(this.context,n));var a=new Pr(this.context,n),s=o.createElement("html2canvaspseudoelement");si(n,s),a.content.forEach((function(t){if(t.type===d.STRING_TOKEN)s.appendChild(o.createTextNode(t.value));else if(t.type===d.URL_TOKEN){var n=o.createElement("img");n.src=t.value,n.style.opacity="1",s.appendChild(n)}else if(t.type===d.FUNCTION){if("attr"===t.name){var r=t.values.filter(Xe);r.length&&s.appendChild(o.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var i=t.values.filter(qe),u=i[0],c=i[1];if(u&&Xe(u)){var l=A.counters.getCounterValue(u.value),h=c&&Xe(c)?Nn.parse(A.context,c.value):In.DECIMAL;s.appendChild(o.createTextNode($A(l,h,!1)))}}else if("counters"===t.name){var p=t.values.filter(qe),f=(u=p[0],p[1]);if(c=p[2],u&&Xe(u)){var y=A.counters.getCounterValues(u.value),g=c&&Xe(c)?Nn.parse(A.context,c.value):In.DECIMAL,E=f&&f.type===d.STRING_TOKEN?f.value:"",B=y.map((function(e){return $A(e,g,!1)})).join(E);s.appendChild(o.createTextNode(B))}}}else if(t.type===d.IDENT_TOKEN)switch(t.value){case"open-quote":s.appendChild(o.createTextNode(Fr(a.quotes,A.quoteDepth++,!0)));break;case"close-quote":s.appendChild(o.createTextNode(Fr(a.quotes,--A.quoteDepth,!1)));break;default:s.appendChild(o.createTextNode(t.value))}})),s.className=hi+" "+pi;var u=r===Hr.BEFORE?" "+hi:" "+pi;return bA(t)?t.className.baseValue+=u:t.className+=u,s}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Hr||(Hr={}));var ni,ri=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute(ei,"true"),e.body.appendChild(n),n},Ai=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},ii=function(e){return Promise.all([].slice.call(e.images,0).map(Ai))},oi=function(e){return new Promise((function(t,n){var r=e.contentWindow;if(!r)return n("No window assigned for iframe");var A=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var n=setInterval((function(){A.body.childNodes.length>0&&"complete"===A.readyState&&(clearInterval(n),t(e))}),50)}}))},ai=["all","d","content"],si=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e.item(n);-1===ai.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},ui=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},ci=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},li=function(e){var t=e[0],n=e[1],r=e[2];t.scrollLeft=n,t.scrollTop=r},hi="___html2canvas___pseudoelement_before",pi="___html2canvas___pseudoelement_after",di='{\n    content: "" !important;\n    display: none !important;\n}',fi=function(e){yi(e,"."+hi+":before"+di+"\n         ."+pi+":after"+di)},yi=function(e,t){var n=e.ownerDocument;if(n){var r=n.createElement("style");r.textContent=t,e.appendChild(r)}},gi=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),Ei=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:bi(e)||wi(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,o=this;return A(this,(function(A){switch(A.label){case 0:return t=gi.isSameOrigin(e),n=!ki(e)&&!0===this._options.useCORS&&Wr.SUPPORT_CORS_IMAGES&&!t,r=!ki(e)&&!t&&!bi(e)&&"string"==typeof this._options.proxy&&Wr.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||ki(e)||bi(e)||r||n?(i=e,r?[4,this.proxy(i)]:[3,2]):[2];case 1:i=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(Ci(i)||n)&&(r.crossOrigin="anonymous"),r.src=i,!0===r.complete&&setTimeout((function(){return e(r)}),500),o._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+o._options.imageTimeout+"ms) loading image")}),o._options.imageTimeout)}))];case 3:return[2,A.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise((function(A,i){var o=Wr.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(200===a.status)if("text"===o)A(a.response);else{var e=new FileReader;e.addEventListener("load",(function(){return A(e.result)}),!1),e.addEventListener("error",(function(e){return i(e)}),!1),e.readAsDataURL(a.response)}else i("Failed to proxy resource "+r+" with status code "+a.status)},a.onerror=i;var s=n.indexOf("?")>-1?"&":"?";if(a.open("GET",""+n+s+"url="+encodeURIComponent(e)+"&responseType="+o),"text"!==o&&a instanceof XMLHttpRequest&&(a.responseType=o),t._options.imageTimeout){var u=t._options.imageTimeout;a.timeout=u,a.ontimeout=function(){return i("Timed out ("+u+"ms) proxying "+r)}}a.send()}))},e}(),Bi=/^data:image\/svg\+xml/i,mi=/^data:image\/.*;base64,/i,vi=/^data:image\/.*/i,wi=function(e){return Wr.SUPPORT_SVG_DRAWING||!Si(e)},ki=function(e){return vi.test(e)},Ci=function(e){return mi.test(e)},bi=function(e){return"blob"===e.substr(0,4)},Si=function(e){return"svg"===e.substr(-3).toLowerCase()||Bi.test(e)};!function(e){e[e.VECTOR=0]="VECTOR",e[e.BEZIER_CURVE=1]="BEZIER_CURVE"}(ni||(ni={}));var Ti,xi=function(e,t){return e.length===t.length&&e.some((function(e,n){return e===t[n]}))},Mi=function(){function e(e,t){this.type=ni.VECTOR,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),Ui=function(e,t,n){return new Mi(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},Qi=function(){function e(e,t,n,r){this.type=ni.BEZIER_CURVE,this.start=e,this.startControl=t,this.endControl=n,this.end=r}return e.prototype.subdivide=function(t,n){var r=Ui(this.start,this.startControl,t),A=Ui(this.startControl,this.endControl,t),i=Ui(this.endControl,this.end,t),o=Ui(r,A,t),a=Ui(A,i,t),s=Ui(o,a,t);return n?new e(this.start,r,o,s):new e(s,a,i,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),Li=function(e){return e.type===ni.BEZIER_CURVE},Fi=function(e){var t=e.styles,n=e.bounds,r=at(t.borderTopLeftRadius,n.width,n.height),A=r[0],i=r[1],o=at(t.borderTopRightRadius,n.width,n.height),a=o[0],s=o[1],u=at(t.borderBottomRightRadius,n.width,n.height),c=u[0],l=u[1],h=at(t.borderBottomLeftRadius,n.width,n.height),p=h[0],d=h[1],f=[];f.push((A+a)/n.width),f.push((p+c)/n.width),f.push((i+d)/n.height),f.push((s+l)/n.height);var y=Math.max.apply(Math,f);y>1&&(A/=y,i/=y,a/=y,s/=y,c/=y,l/=y,p/=y,d/=y);var g=n.width-a,E=n.height-l,B=n.width-c,m=n.height-d,v=t.borderTopWidth,w=t.borderRightWidth,k=t.borderBottomWidth,C=t.borderLeftWidth,b=st(t.paddingTop,e.bounds.width),S=st(t.paddingRight,e.bounds.width),T=st(t.paddingBottom,e.bounds.width),x=st(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=A>0||i>0?Ri(n.left+C/3,n.top+v/3,A-C/3,i-v/3,Ti.TOP_LEFT):new Mi(n.left+C/3,n.top+v/3),this.topRightBorderDoubleOuterBox=A>0||i>0?Ri(n.left+g,n.top+v/3,a-w/3,s-v/3,Ti.TOP_RIGHT):new Mi(n.left+n.width-w/3,n.top+v/3),this.bottomRightBorderDoubleOuterBox=c>0||l>0?Ri(n.left+B,n.top+E,c-w/3,l-k/3,Ti.BOTTOM_RIGHT):new Mi(n.left+n.width-w/3,n.top+n.height-k/3),this.bottomLeftBorderDoubleOuterBox=p>0||d>0?Ri(n.left+C/3,n.top+m,p-C/3,d-k/3,Ti.BOTTOM_LEFT):new Mi(n.left+C/3,n.top+n.height-k/3),this.topLeftBorderDoubleInnerBox=A>0||i>0?Ri(n.left+2*C/3,n.top+2*v/3,A-2*C/3,i-2*v/3,Ti.TOP_LEFT):new Mi(n.left+2*C/3,n.top+2*v/3),this.topRightBorderDoubleInnerBox=A>0||i>0?Ri(n.left+g,n.top+2*v/3,a-2*w/3,s-2*v/3,Ti.TOP_RIGHT):new Mi(n.left+n.width-2*w/3,n.top+2*v/3),this.bottomRightBorderDoubleInnerBox=c>0||l>0?Ri(n.left+B,n.top+E,c-2*w/3,l-2*k/3,Ti.BOTTOM_RIGHT):new Mi(n.left+n.width-2*w/3,n.top+n.height-2*k/3),this.bottomLeftBorderDoubleInnerBox=p>0||d>0?Ri(n.left+2*C/3,n.top+m,p-2*C/3,d-2*k/3,Ti.BOTTOM_LEFT):new Mi(n.left+2*C/3,n.top+n.height-2*k/3),this.topLeftBorderStroke=A>0||i>0?Ri(n.left+C/2,n.top+v/2,A-C/2,i-v/2,Ti.TOP_LEFT):new Mi(n.left+C/2,n.top+v/2),this.topRightBorderStroke=A>0||i>0?Ri(n.left+g,n.top+v/2,a-w/2,s-v/2,Ti.TOP_RIGHT):new Mi(n.left+n.width-w/2,n.top+v/2),this.bottomRightBorderStroke=c>0||l>0?Ri(n.left+B,n.top+E,c-w/2,l-k/2,Ti.BOTTOM_RIGHT):new Mi(n.left+n.width-w/2,n.top+n.height-k/2),this.bottomLeftBorderStroke=p>0||d>0?Ri(n.left+C/2,n.top+m,p-C/2,d-k/2,Ti.BOTTOM_LEFT):new Mi(n.left+C/2,n.top+n.height-k/2),this.topLeftBorderBox=A>0||i>0?Ri(n.left,n.top,A,i,Ti.TOP_LEFT):new Mi(n.left,n.top),this.topRightBorderBox=a>0||s>0?Ri(n.left+g,n.top,a,s,Ti.TOP_RIGHT):new Mi(n.left+n.width,n.top),this.bottomRightBorderBox=c>0||l>0?Ri(n.left+B,n.top+E,c,l,Ti.BOTTOM_RIGHT):new Mi(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=p>0||d>0?Ri(n.left,n.top+m,p,d,Ti.BOTTOM_LEFT):new Mi(n.left,n.top+n.height),this.topLeftPaddingBox=A>0||i>0?Ri(n.left+C,n.top+v,Math.max(0,A-C),Math.max(0,i-v),Ti.TOP_LEFT):new Mi(n.left+C,n.top+v),this.topRightPaddingBox=a>0||s>0?Ri(n.left+Math.min(g,n.width-w),n.top+v,g>n.width+w?0:Math.max(0,a-w),Math.max(0,s-v),Ti.TOP_RIGHT):new Mi(n.left+n.width-w,n.top+v),this.bottomRightPaddingBox=c>0||l>0?Ri(n.left+Math.min(B,n.width-C),n.top+Math.min(E,n.height-k),Math.max(0,c-w),Math.max(0,l-k),Ti.BOTTOM_RIGHT):new Mi(n.left+n.width-w,n.top+n.height-k),this.bottomLeftPaddingBox=p>0||d>0?Ri(n.left+C,n.top+Math.min(m,n.height-k),Math.max(0,p-C),Math.max(0,d-k),Ti.BOTTOM_LEFT):new Mi(n.left+C,n.top+n.height-k),this.topLeftContentBox=A>0||i>0?Ri(n.left+C+x,n.top+v+b,Math.max(0,A-(C+x)),Math.max(0,i-(v+b)),Ti.TOP_LEFT):new Mi(n.left+C+x,n.top+v+b),this.topRightContentBox=a>0||s>0?Ri(n.left+Math.min(g,n.width+C+x),n.top+v+b,g>n.width+C+x?0:a-C+x,s-(v+b),Ti.TOP_RIGHT):new Mi(n.left+n.width-(w+S),n.top+v+b),this.bottomRightContentBox=c>0||l>0?Ri(n.left+Math.min(B,n.width-(C+x)),n.top+Math.min(E,n.height+v+b),Math.max(0,c-(w+S)),l-(k+T),Ti.BOTTOM_RIGHT):new Mi(n.left+n.width-(w+S),n.top+n.height-(k+T)),this.bottomLeftContentBox=p>0||d>0?Ri(n.left+C+x,n.top+m,Math.max(0,p-(C+x)),d-(k+T),Ti.BOTTOM_LEFT):new Mi(n.left+C+x,n.top+n.height-(k+T))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Ti||(Ti={}));var Ri=function(e,t,n,r,A){var i=(Math.sqrt(2)-1)/3*4,o=n*i,a=r*i,s=e+n,u=t+r;switch(A){case Ti.TOP_LEFT:return new Qi(new Mi(e,u),new Mi(e,u-a),new Mi(s-o,t),new Mi(s,t));case Ti.TOP_RIGHT:return new Qi(new Mi(e,t),new Mi(e+o,t),new Mi(s,u-a),new Mi(s,u));case Ti.BOTTOM_RIGHT:return new Qi(new Mi(s,t),new Mi(s,t+a),new Mi(e+o,u),new Mi(e,u));case Ti.BOTTOM_LEFT:default:return new Qi(new Mi(s,u),new Mi(s-o,u),new Mi(e,t+a),new Mi(e,t))}},Hi=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},_i=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},Di=function(e,t,n){this.type=0,this.target=6,this.offsetX=e,this.offsetY=t,this.matrix=n},Ii=function(e,t){this.type=1,this.target=t,this.path=e},Oi=function(e){this.type=2,this.target=6,this.opacity=e},Pi=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},Ni=function(){function e(e,t){if(this.container=e,this.effects=t.slice(0),this.curves=new Fi(e),e.styles.opacity<1&&this.effects.push(new Oi(e.styles.opacity)),null!==e.styles.transform){var n=e.bounds.left+e.styles.transformOrigin[0].number,r=e.bounds.top+e.styles.transformOrigin[1].number,A=e.styles.transform;this.effects.push(new Di(n,r,A))}if(e.styles.overflowX!==Pn.VISIBLE){var i=Hi(this.curves),o=_i(this.curves);xi(i,o)?this.effects.push(new Ii(i,6)):(this.effects.push(new Ii(i,2)),this.effects.push(new Ii(o,4)))}}return e.prototype.getParentEffects=function(){var e=this.effects.slice(0);if(this.container.styles.overflowX!==Pn.VISIBLE){var t=Hi(this.curves),n=_i(this.curves);xi(t,n)||e.push(new Ii(n,6))}return e},e}(),Ki=function e(t,n,r,A){t.container.elements.forEach((function(i){var o=xr(i.flags,4),a=xr(i.flags,2),s=new Ni(i,t.getParentEffects());xr(i.styles.display,2048)&&A.push(s);var u=xr(i.flags,8)?[]:A;if(o||a){var c=o||i.styles.isPositioned()?r:n,l=new Pi(s);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var h=i.styles.zIndex.order;if(h<0){var p=0;c.negativeZIndex.some((function(e,t){return h>e.element.container.styles.zIndex.order?(p=t,!1):p>0})),c.negativeZIndex.splice(p,0,l)}else if(h>0){var d=0;c.positiveZIndex.some((function(e,t){return h>=e.element.container.styles.zIndex.order?(d=t+1,!1):d>0})),c.positiveZIndex.splice(d,0,l)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(l)}else i.styles.isFloating()?c.nonPositionedFloats.push(l):c.nonPositionedInlineLevel.push(l);e(s,l,o?l:r,u)}else i.styles.isInlineLevel()?n.inlineLevel.push(s):n.nonInlineLevel.push(s),e(s,n,r,u);xr(i.flags,8)&&Vi(i,u)}))},Vi=function(e,t){for(var n=e instanceof oA?e.start:1,r=e instanceof oA&&e.reversed,A=0;A<t.length;A++){var i=t[A];i.container instanceof iA&&"number"==typeof i.container.value&&0!==i.container.value&&(n=i.container.value),i.listValue=$A(n,i.container.styles.listStyleType,!0),n+=r?-1:1}},Gi=function(e){var t=new Ni(e,[]),n=new Pi(t),r=[];return Ki(t,n,n,r),Vi(t.container,r),n},ji=function(e,t){switch(t){case 0:return Wi(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return Wi(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return Wi(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return Wi(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},Yi=function(e,t){var n=[];return Li(e)?n.push(e.subdivide(.5,!1)):n.push(e),Li(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},Wi=function(e,t,n,r){var A=[];return Li(e)?A.push(e.subdivide(.5,!1)):A.push(e),Li(n)?A.push(n.subdivide(.5,!0)):A.push(n),Li(r)?A.push(r.subdivide(.5,!0).reverse()):A.push(r),Li(t)?A.push(t.subdivide(.5,!1).reverse()):A.push(t),A},Xi=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},Ji=function(e){var t=e.styles,n=e.bounds,r=st(t.paddingLeft,n.width),A=st(t.paddingRight,n.width),i=st(t.paddingTop,n.width),o=st(t.paddingBottom,n.width);return n.add(r+t.borderLeftWidth,i+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+A),-(t.borderTopWidth+t.borderBottomWidth+i+o))},zi=function(e,t,n){var r=function(e,t){return 0===e?t.bounds:2===e?Ji(t):Xi(t)}(eo(e.styles.backgroundOrigin,t),e),A=function(e,t){return e===kt.BORDER_BOX?t.bounds:e===kt.CONTENT_BOX?Ji(t):Xi(t)}(eo(e.styles.backgroundClip,t),e),i=$i(eo(e.styles.backgroundSize,t),n,r),o=i[0],a=i[1],s=at(eo(e.styles.backgroundPosition,t),r.width-o,r.height-a);return[to(eo(e.styles.backgroundRepeat,t),s,i,r,A),Math.round(r.left+s[0]),Math.round(r.top+s[1]),o,a]},Zi=function(e){return Xe(e)&&e.value===$t.AUTO},qi=function(e){return"number"==typeof e},$i=function(e,t,n){var r=t[0],A=t[1],i=t[2],o=e[0],a=e[1];if(!o)return[0,0];if(nt(o)&&a&&nt(a))return[st(o,n.width),st(a,n.height)];var s=qi(i);if(Xe(o)&&(o.value===$t.CONTAIN||o.value===$t.COVER))return qi(i)?n.width/n.height<i!=(o.value===$t.COVER)?[n.width,n.width/i]:[n.height*i,n.height]:[n.width,n.height];var u=qi(r),c=qi(A),l=u||c;if(Zi(o)&&(!a||Zi(a)))return u&&c?[r,A]:s||l?l&&s?[u?r:A*i,c?A:r/i]:[u?r:n.width,c?A:n.height]:[n.width,n.height];if(s){var h=0,p=0;return nt(o)?h=st(o,n.width):nt(a)&&(p=st(a,n.height)),Zi(o)?h=p*i:a&&!Zi(a)||(p=h/i),[h,p]}var d=null,f=null;if(nt(o)?d=st(o,n.width):a&&nt(a)&&(f=st(a,n.height)),null===d||a&&!Zi(a)||(f=u&&c?d/r*A:n.height),null!==f&&Zi(o)&&(d=u&&c?f/A*r:n.width),null!==d&&null!==f)return[d,f];throw new Error("Unable to calculate background-size for element")},eo=function(e,t){var n=e[t];return void 0===n?e[0]:n},to=function(e,t,n,r,A){var i=t[0],o=t[1],a=n[0],s=n[1];switch(e){case Wt.REPEAT_X:return[new Mi(Math.round(r.left),Math.round(r.top+o)),new Mi(Math.round(r.left+r.width),Math.round(r.top+o)),new Mi(Math.round(r.left+r.width),Math.round(s+r.top+o)),new Mi(Math.round(r.left),Math.round(s+r.top+o))];case Wt.REPEAT_Y:return[new Mi(Math.round(r.left+i),Math.round(r.top)),new Mi(Math.round(r.left+i+a),Math.round(r.top)),new Mi(Math.round(r.left+i+a),Math.round(r.height+r.top)),new Mi(Math.round(r.left+i),Math.round(r.height+r.top))];case Wt.NO_REPEAT:return[new Mi(Math.round(r.left+i),Math.round(r.top+o)),new Mi(Math.round(r.left+i+a),Math.round(r.top+o)),new Mi(Math.round(r.left+i+a),Math.round(r.top+o+s)),new Mi(Math.round(r.left+i),Math.round(r.top+o+s))];default:return[new Mi(Math.round(A.left),Math.round(A.top)),new Mi(Math.round(A.left+A.width),Math.round(A.top)),new Mi(Math.round(A.left+A.width),Math.round(A.height+A.top)),new Mi(Math.round(A.left),Math.round(A.height+A.top))]}},no="Hidden Text",ro=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),r=this._document.createElement("img"),A=this._document.createElement("span"),i=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",i.appendChild(n),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",A.style.fontFamily=e,A.style.fontSize=t,A.style.margin="0",A.style.padding="0",A.appendChild(this._document.createTextNode(no)),n.appendChild(A),n.appendChild(r);var o=r.offsetTop-A.offsetTop+2;n.removeChild(A),n.appendChild(this._document.createTextNode(no)),n.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-n.offsetTop+2;return i.removeChild(n),{baseline:o,middle:a}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return void 0===this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),Ao=function(e,t){this.context=e,this.options=t},io=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r._activeEffects=[],r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),n.canvas||(r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px"),r.fontMetrics=new ro(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),r}return t(n,e),n.prototype.applyEffects=function(e,t){for(var n=this;this._activeEffects.length;)this.popEffect();e.filter((function(e){return xr(e.target,t)})).forEach((function(e){return n.applyEffect(e)}))},n.prototype.applyEffect=function(e){this.ctx.save(),function(e){return 2===e.type}(e)&&(this.ctx.globalAlpha=e.opacity),function(e){return 0===e.type}(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),function(e){return 1===e.type}(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(e){return r(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.renderNode=function(e){return r(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},n.prototype.renderTextWithLetterSpacing=function(e,t,n){var r=this;if(0===t)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n);else{var A=u(e.text).map((function(e){return c(e)}));A.reduce((function(t,A){return r.ctx.fillText(A,t,e.bounds.top+n),t+r.ctx.measureText(A).width}),e.bounds.left)}},n.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),n=e.fontFamily.join(", "),r=Ye(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,n].join(" "),n,r]},n.prototype.renderTextNode=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l=this;return A(this,(function(A){return n=this.createFontStyle(t),r=n[0],i=n[1],o=n[2],this.ctx.font=r,this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(i,o),s=a.baseline,u=a.middle,c=t.paintOrder,e.textBounds.forEach((function(e){c.forEach((function(n){switch(n){case Sr.FILL:l.ctx.fillStyle=gt(t.color),l.renderTextWithLetterSpacing(e,t.letterSpacing,s);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach((function(n){l.ctx.shadowColor=gt(n.color),l.ctx.shadowOffsetX=n.offsetX.number*l.options.scale,l.ctx.shadowOffsetY=n.offsetY.number*l.options.scale,l.ctx.shadowBlur=n.blur.number,l.renderTextWithLetterSpacing(e,t.letterSpacing,s)})),l.ctx.shadowColor="",l.ctx.shadowOffsetX=0,l.ctx.shadowOffsetY=0,l.ctx.shadowBlur=0),t.textDecorationLine.length&&(l.ctx.fillStyle=gt(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:l.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+s),e.bounds.width,1);break;case 2:l.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:l.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+u),e.bounds.width,1)}})));break;case Sr.STROKE:t.webkitTextStrokeWidth&&e.text.trim().length&&(l.ctx.strokeStyle=gt(t.webkitTextStrokeColor),l.ctx.lineWidth=t.webkitTextStrokeWidth,l.ctx.lineJoin=window.chrome?"miter":"round",l.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+s)),l.ctx.strokeStyle="",l.ctx.lineWidth=0,l.ctx.lineJoin="miter"}}))})),[2]}))}))},n.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=Ji(e),A=_i(t);this.path(A),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,(function(){var t,r,i,o,s,u,c,l,h,p,d,f,y,g,E,B,m,v;return A(this,(function(A){switch(A.label){case 0:this.applyEffects(e.effects,4),t=e.container,r=e.curves,i=t.styles,o=0,s=t.textNodes,A.label=1;case 1:return o<s.length?(u=s[o],[4,this.renderTextNode(u,i)]):[3,4];case 2:A.sent(),A.label=3;case 3:return o++,[3,1];case 4:if(!(t instanceof nA))return[3,8];A.label=5;case 5:return A.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return E=A.sent(),this.renderReplacedElement(t,r,E),[3,8];case 7:return A.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof rA&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof AA))return[3,12];A.label=9;case 9:return A.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return E=A.sent(),this.renderReplacedElement(t,r,E),[3,12];case 11:return A.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof fA&&t.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:c=A.sent(),t.width&&t.height&&this.ctx.drawImage(c,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),A.label=14;case 14:if(t instanceof hA&&(l=Math.min(t.bounds.width,t.bounds.height),t.type===uA?t.checked&&(this.ctx.save(),this.path([new Mi(t.bounds.left+.39363*l,t.bounds.top+.79*l),new Mi(t.bounds.left+.16*l,t.bounds.top+.5549*l),new Mi(t.bounds.left+.27347*l,t.bounds.top+.44071*l),new Mi(t.bounds.left+.39694*l,t.bounds.top+.5649*l),new Mi(t.bounds.left+.72983*l,t.bounds.top+.23*l),new Mi(t.bounds.left+.84*l,t.bounds.top+.34085*l),new Mi(t.bounds.left+.39363*l,t.bounds.top+.79*l)]),this.ctx.fillStyle=gt(lA),this.ctx.fill(),this.ctx.restore()):t.type===cA&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+l/2,t.bounds.top+l/2,l/4,0,2*Math.PI,!0),this.ctx.fillStyle=gt(lA),this.ctx.fill(),this.ctx.restore())),oo(t)&&t.value.length){switch(h=this.createFontStyle(i),m=h[0],p=h[1],d=this.fontMetrics.getMetrics(m,p).baseline,this.ctx.font=m,this.ctx.fillStyle=gt(i.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=so(t.styles.textAlign),v=Ji(t),f=0,t.styles.textAlign){case Jn.CENTER:f+=v.width/2;break;case Jn.RIGHT:f+=v.width}y=v.add(f,0,0,-v.height/2+1),this.ctx.save(),this.path([new Mi(v.left,v.top),new Mi(v.left+v.width,v.top),new Mi(v.left+v.width,v.top+v.height),new Mi(v.left,v.top+v.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Xr(t.value,y),i.letterSpacing,d),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!xr(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if((g=t.styles.listStyleImage).type!==xt.URL)return[3,18];E=void 0,B=g.url,A.label=15;case 15:return A.trys.push([15,17,,18]),[4,this.context.cache.match(B)];case 16:return E=A.sent(),this.ctx.drawImage(E,t.bounds.left-(E.width+10),t.bounds.top),[3,18];case 17:return A.sent(),this.context.logger.error("Error loading list-style-image "+B),[3,18];case 18:return[3,20];case 19:e.listValue&&t.styles.listStyleType!==In.NONE&&(m=this.createFontStyle(i)[0],this.ctx.font=m,this.ctx.fillStyle=gt(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",v=new a(t.bounds.left,t.bounds.top+st(t.styles.paddingTop,t.bounds.width),t.bounds.width,_n(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Xr(e.listValue,v),i.letterSpacing,_n(i.lineHeight,i.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),A.label=20;case 20:return[2]}}))}))},n.prototype.renderStackContent=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c,l,h,p,d,f,y;return A(this,(function(A){switch(A.label){case 0:return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:A.sent(),t=0,n=e.negativeZIndex,A.label=2;case 2:return t<n.length?(y=n[t],[4,this.renderStack(y)]):[3,5];case 3:A.sent(),A.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:A.sent(),r=0,i=e.nonInlineLevel,A.label=7;case 7:return r<i.length?(y=i[r],[4,this.renderNode(y)]):[3,10];case 8:A.sent(),A.label=9;case 9:return r++,[3,7];case 10:o=0,a=e.nonPositionedFloats,A.label=11;case 11:return o<a.length?(y=a[o],[4,this.renderStack(y)]):[3,14];case 12:A.sent(),A.label=13;case 13:return o++,[3,11];case 14:s=0,u=e.nonPositionedInlineLevel,A.label=15;case 15:return s<u.length?(y=u[s],[4,this.renderStack(y)]):[3,18];case 16:A.sent(),A.label=17;case 17:return s++,[3,15];case 18:c=0,l=e.inlineLevel,A.label=19;case 19:return c<l.length?(y=l[c],[4,this.renderNode(y)]):[3,22];case 20:A.sent(),A.label=21;case 21:return c++,[3,19];case 22:h=0,p=e.zeroOrAutoZIndexOrTransformedOrOpacity,A.label=23;case 23:return h<p.length?(y=p[h],[4,this.renderStack(y)]):[3,26];case 24:A.sent(),A.label=25;case 25:return h++,[3,23];case 26:d=0,f=e.positiveZIndex,A.label=27;case 27:return d<f.length?(y=f[d],[4,this.renderStack(y)]):[3,30];case 28:A.sent(),A.label=29;case 29:return d++,[3,27];case 30:return[2]}}))}))},n.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},n.prototype.formatPath=function(e){var t=this;e.forEach((function(e,n){var r=Li(e)?e.start:e;0===n?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),Li(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},n.prototype.renderRepeat=function(e,t,n,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},n.prototype.resizeImage=function(e,t,n){var r;if(e.width===t&&e.height===n)return e;var A=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return A.width=Math.max(1,t),A.height=Math.max(1,n),A.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),A},n.prototype.renderBackgroundImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,o,a;return A(this,(function(s){switch(s.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var i,o,a,s,u,c,l,h,p,d,f,y,g,E,B,m,v,w,k,C,b,S,T,x,M,U,Q,L,F,R,H;return A(this,(function(A){switch(A.label){case 0:if(n.type!==xt.URL)return[3,5];i=void 0,o=n.url,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,r.context.cache.match(o)];case 2:return i=A.sent(),[3,4];case 3:return A.sent(),r.context.logger.error("Error loading background-image "+o),[3,4];case 4:return i&&(a=zi(e,t,[i.width,i.height,i.width/i.height]),m=a[0],S=a[1],T=a[2],k=a[3],C=a[4],E=r.ctx.createPattern(r.resizeImage(i,k,C),"repeat"),r.renderRepeat(m,E,S,T)),[3,6];case 5:n.type===xt.LINEAR_GRADIENT?(s=zi(e,t,[null,null,null]),m=s[0],S=s[1],T=s[2],k=s[3],C=s[4],u=function(e,t,n){var r="number"==typeof e?e:function(e,t,n){var r=t/2,A=n/2,i=st(e[0],t)-r,o=A-st(e[1],n);return(Math.atan2(o,i)+2*Math.PI)%(2*Math.PI)}(e,t,n),A=Math.abs(t*Math.sin(r))+Math.abs(n*Math.cos(r)),i=t/2,o=n/2,a=A/2,s=Math.sin(r-Math.PI/2)*a,u=Math.cos(r-Math.PI/2)*a;return[A,i-u,i+u,o-s,o+s]}(n.angle,k,C),c=u[0],l=u[1],h=u[2],p=u[3],d=u[4],(f=document.createElement("canvas")).width=k,f.height=C,y=f.getContext("2d"),g=y.createLinearGradient(l,p,h,d),Rt(n.stops,c).forEach((function(e){return g.addColorStop(e.stop,gt(e.color))})),y.fillStyle=g,y.fillRect(0,0,k,C),k>0&&C>0&&(E=r.ctx.createPattern(f,"repeat"),r.renderRepeat(m,E,S,T))):n.type===xt.RADIAL_GRADIENT&&(B=zi(e,t,[null,null,null]),m=B[0],v=B[1],w=B[2],k=B[3],C=B[4],b=0===n.position.length?[it]:n.position,S=st(b[0],k),T=st(b[b.length-1],C),x=function(e,t,n,r,A){var i=0,o=0;switch(e.size){case Ut.CLOSEST_SIDE:e.shape===Mt.CIRCLE?i=o=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-A)):e.shape===Mt.ELLIPSE&&(i=Math.min(Math.abs(t),Math.abs(t-r)),o=Math.min(Math.abs(n),Math.abs(n-A)));break;case Ut.CLOSEST_CORNER:if(e.shape===Mt.CIRCLE)i=o=Math.min(Ht(t,n),Ht(t,n-A),Ht(t-r,n),Ht(t-r,n-A));else if(e.shape===Mt.ELLIPSE){var a=Math.min(Math.abs(n),Math.abs(n-A))/Math.min(Math.abs(t),Math.abs(t-r)),s=_t(r,A,t,n,!0),u=s[0],c=s[1];o=a*(i=Ht(u-t,(c-n)/a))}break;case Ut.FARTHEST_SIDE:e.shape===Mt.CIRCLE?i=o=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-A)):e.shape===Mt.ELLIPSE&&(i=Math.max(Math.abs(t),Math.abs(t-r)),o=Math.max(Math.abs(n),Math.abs(n-A)));break;case Ut.FARTHEST_CORNER:if(e.shape===Mt.CIRCLE)i=o=Math.max(Ht(t,n),Ht(t,n-A),Ht(t-r,n),Ht(t-r,n-A));else if(e.shape===Mt.ELLIPSE){a=Math.max(Math.abs(n),Math.abs(n-A))/Math.max(Math.abs(t),Math.abs(t-r));var l=_t(r,A,t,n,!1);u=l[0],c=l[1],o=a*(i=Ht(u-t,(c-n)/a))}}return Array.isArray(e.size)&&(i=st(e.size[0],r),o=2===e.size.length?st(e.size[1],A):i),[i,o]}(n,S,T,k,C),M=x[0],U=x[1],M>0&&U>0&&(Q=r.ctx.createRadialGradient(v+S,w+T,0,v+S,w+T,M),Rt(n.stops,2*M).forEach((function(e){return Q.addColorStop(e.stop,gt(e.color))})),r.path(m),r.ctx.fillStyle=Q,M!==U?(L=e.bounds.left+.5*e.bounds.width,F=e.bounds.top+.5*e.bounds.height,H=1/(R=U/M),r.ctx.save(),r.ctx.translate(L,F),r.ctx.transform(1,0,0,R,0,0),r.ctx.translate(-L,-F),r.ctx.fillRect(v,H*(w-F)+F,k,C*H),r.ctx.restore()):r.ctx.fill())),A.label=6;case 6:return t--,[2]}}))},r=this,i=0,o=e.styles.backgroundImage.slice(0).reverse(),s.label=1;case 1:return i<o.length?(a=o[i],[5,n(a)]):[3,4];case 2:s.sent(),s.label=3;case 3:return i++,[3,1];case 4:return[2]}}))}))},n.prototype.renderSolidBorder=function(e,t,n){return r(this,void 0,void 0,(function(){return A(this,(function(r){return this.path(ji(n,t)),this.ctx.fillStyle=gt(e),this.ctx.fill(),[2]}))}))},n.prototype.renderDoubleBorder=function(e,t,n,i){return r(this,void 0,void 0,(function(){var r,o;return A(this,(function(A){switch(A.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,i)]:[3,2];case 1:return A.sent(),[2];case 2:return r=function(e,t){switch(t){case 0:return Wi(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return Wi(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return Wi(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return Wi(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}}(i,n),this.path(r),this.ctx.fillStyle=gt(e),this.ctx.fill(),o=function(e,t){switch(t){case 0:return Wi(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return Wi(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return Wi(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return Wi(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}}(i,n),this.path(o),this.ctx.fill(),[2]}}))}))},n.prototype.renderNodeBackgroundAndBorders=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c=this;return A(this,(function(A){switch(A.label){case 0:return this.applyEffects(e.effects,2),t=e.container.styles,n=!yt(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],i=ao(eo(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(i),this.ctx.clip(),yt(t.backgroundColor)||(this.ctx.fillStyle=gt(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:A.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){c.ctx.save();var n,r,A,i,o,a=Hi(e.curves),s=t.inset?0:1e4,u=(n=a,r=-s+(t.inset?1:-1)*t.spread.number,A=(t.inset?1:-1)*t.spread.number,i=t.spread.number*(t.inset?-2:2),o=t.spread.number*(t.inset?-2:2),n.map((function(e,t){switch(t){case 0:return e.add(r,A);case 1:return e.add(r+i,A);case 2:return e.add(r+i,A+o);case 3:return e.add(r,A+o)}return e})));t.inset?(c.path(a),c.ctx.clip(),c.mask(u)):(c.mask(a),c.ctx.clip(),c.path(u)),c.ctx.shadowOffsetX=t.offsetX.number+s,c.ctx.shadowOffsetY=t.offsetY.number,c.ctx.shadowColor=gt(t.color),c.ctx.shadowBlur=t.blur.number,c.ctx.fillStyle=t.inset?gt(t.color):"rgba(0,0,0,1)",c.ctx.fill(),c.ctx.restore()})),A.label=2;case 2:o=0,a=0,s=r,A.label=3;case 3:return a<s.length?(u=s[a]).style!==nn.NONE&&!yt(u.color)&&u.width>0?u.style!==nn.DASHED?[3,5]:[4,this.renderDashedDottedBorder(u.color,u.width,o,e.curves,nn.DASHED)]:[3,11]:[3,13];case 4:return A.sent(),[3,11];case 5:return u.style!==nn.DOTTED?[3,7]:[4,this.renderDashedDottedBorder(u.color,u.width,o,e.curves,nn.DOTTED)];case 6:return A.sent(),[3,11];case 7:return u.style!==nn.DOUBLE?[3,9]:[4,this.renderDoubleBorder(u.color,u.width,o,e.curves)];case 8:return A.sent(),[3,11];case 9:return[4,this.renderSolidBorder(u.color,o,e.curves)];case 10:A.sent(),A.label=11;case 11:o++,A.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},n.prototype.renderDashedDottedBorder=function(e,t,n,i,o){return r(this,void 0,void 0,(function(){var r,a,s,u,c,l,h,p,d,f,y,g,E,B,m,v;return A(this,(function(A){return this.ctx.save(),r=function(e,t){switch(t){case 0:return Yi(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return Yi(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return Yi(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return Yi(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}}(i,n),a=ji(i,n),o===nn.DASHED&&(this.path(a),this.ctx.clip()),Li(a[0])?(s=a[0].start.x,u=a[0].start.y):(s=a[0].x,u=a[0].y),Li(a[1])?(c=a[1].end.x,l=a[1].end.y):(c=a[1].x,l=a[1].y),h=0===n||2===n?Math.abs(s-c):Math.abs(u-l),this.ctx.beginPath(),o===nn.DOTTED?this.formatPath(r):this.formatPath(a.slice(0,2)),p=t<3?3*t:2*t,d=t<3?2*t:t,o===nn.DOTTED&&(p=t,d=t),f=!0,h<=2*p?f=!1:h<=2*p+d?(p*=y=h/(2*p+d),d*=y):(g=Math.floor((h+d)/(p+d)),E=(h-g*p)/(g-1),d=(B=(h-(g+1)*p)/g)<=0||Math.abs(d-E)<Math.abs(d-B)?E:B),f&&(o===nn.DOTTED?this.ctx.setLineDash([0,p+d]):this.ctx.setLineDash([p,d])),o===nn.DOTTED?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=gt(e),this.ctx.stroke(),this.ctx.setLineDash([]),o===nn.DASHED&&(Li(a[0])&&(m=a[3],v=a[0],this.ctx.beginPath(),this.formatPath([new Mi(m.end.x,m.end.y),new Mi(v.start.x,v.start.y)]),this.ctx.stroke()),Li(a[1])&&(m=a[1],v=a[2],this.ctx.beginPath(),this.formatPath([new Mi(m.end.x,m.end.y),new Mi(v.start.x,v.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=gt(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=Gi(e),[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([],2),[2,this.canvas]}}))}))},n}(Ao),oo=function(e){return e instanceof dA||e instanceof pA||e instanceof hA&&e.type!==cA&&e.type!==uA},ao=function(e,t){switch(e){case kt.BORDER_BOX:return Hi(t);case kt.CONTENT_BOX:return function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]}(t);case kt.PADDING_BOX:default:return _i(t)}},so=function(e){switch(e){case Jn.CENTER:return"center";case Jn.RIGHT:return"right";case Jn.LEFT:default:return"left"}},uo=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=n,r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),r}return t(n,e),n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return t=jr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,co(t)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=gt(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},n}(Ao),co=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},lo=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,i([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,i([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,i([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,i([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),ho=function(){function e(t,n){var r;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new lo({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new Ei(this,t)}return e.instanceCount=1,e}();"undefined"!=typeof window&&gi.setContext(window);var po=function(e,t,n){var r=t.ownerDocument,A=r.documentElement?St(e,getComputedStyle(r.documentElement).backgroundColor):Tt.TRANSPARENT,i=r.body?St(e,getComputedStyle(r.body).backgroundColor):Tt.TRANSPARENT,o="string"==typeof n?St(e,n):null===n?Tt.TRANSPARENT:4294967295;return t===r.documentElement?yt(A)?yt(i)?o:i:A:o};return function(e,t){return void 0===t&&(t={}),function(e,t){return r(void 0,void 0,void 0,(function(){var r,i,u,c,l,h,p,d,f,y,g,E,B,m,v,w,k,C,b,S,T,x,M,U,Q,L,F,R,H,_,D,I,O,P,N,K,V;return A(this,(function(A){switch(A.label){case 0:if(!e||"object"!==o(e))return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(i=r.defaultView))throw new Error("Document is not attached to a Window");return u={allowTaint:null!==(x=t.allowTaint)&&void 0!==x&&x,imageTimeout:null!==(M=t.imageTimeout)&&void 0!==M?M:15e3,proxy:t.proxy,useCORS:null!==(U=t.useCORS)&&void 0!==U&&U},c=n({logging:null===(Q=t.logging)||void 0===Q||Q,cache:t.cache},u),l={windowWidth:null!==(L=t.windowWidth)&&void 0!==L?L:i.innerWidth,windowHeight:null!==(F=t.windowHeight)&&void 0!==F?F:i.innerHeight,scrollX:null!==(R=t.scrollX)&&void 0!==R?R:i.pageXOffset,scrollY:null!==(H=t.scrollY)&&void 0!==H?H:i.pageYOffset},h=new a(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),p=new ho(c,h),d=null!==(_=t.foreignObjectRendering)&&void 0!==_&&_,f={onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:d,copyStyles:d},p.logger.debug("Starting document clone with size "+h.width+"x"+h.height+" scrolled to "+-h.left+","+-h.top),y=new ti(p,e,f),(g=y.clonedReferenceElement)?[4,y.toIFrame(r,h)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return E=A.sent(),B=UA(g)||"HTML"===g.tagName?function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),A=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new a(0,0,r,A)}(g.ownerDocument):s(p,g),m=B.width,v=B.height,w=B.left,k=B.top,C=po(p,g,t.backgroundColor),b={canvas:t.canvas,backgroundColor:C,scale:null!==(I=null!==(D=t.scale)&&void 0!==D?D:i.devicePixelRatio)&&void 0!==I?I:1,x:(null!==(O=t.x)&&void 0!==O?O:0)+w,y:(null!==(P=t.y)&&void 0!==P?P:0)+k,width:null!==(N=t.width)&&void 0!==N?N:Math.ceil(m),height:null!==(K=t.height)&&void 0!==K?K:Math.ceil(v)},d?(p.logger.debug("Document cloned, using foreign object rendering"),[4,new uo(p,b).render(g)]):[3,3];case 2:return S=A.sent(),[3,5];case 3:return p.logger.debug("Document cloned, element located at "+w+","+k+" with size "+m+"x"+v+" using computed rendering"),p.logger.debug("Starting DOM parsing"),T=BA(p,g),C===T.styles.backgroundColor&&(T.styles.backgroundColor=Tt.TRANSPARENT),p.logger.debug("Starting renderer for element at "+b.x+","+b.y+" with size "+b.width+"x"+b.height),[4,new io(p,b).render(T)];case 4:S=A.sent(),A.label=5;case 5:return(null===(V=t.removeContainer)||void 0===V||V)&&(ti.destroy(E)||p.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),p.logger.debug("Finished rendering"),[2,S]}}))}))}(e,t)}},"object"===o(t)?e.exports=i():void 0===(A="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=A)},18552:(e,t,n)=>{var r=n(10852)(n(55639),"DataView");e.exports=r},1989:(e,t,n)=>{var r=n(51789),A=n(80401),i=n(57667),o=n(21327),a=n(81866);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=A,s.prototype.get=i,s.prototype.has=o,s.prototype.set=a,e.exports=s},38407:(e,t,n)=>{var r=n(27040),A=n(14125),i=n(82117),o=n(67518),a=n(54705);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=A,s.prototype.get=i,s.prototype.has=o,s.prototype.set=a,e.exports=s},57071:(e,t,n)=>{var r=n(10852)(n(55639),"Map");e.exports=r},83369:(e,t,n)=>{var r=n(24785),A=n(11285),i=n(96e3),o=n(49916),a=n(95265);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=A,s.prototype.get=i,s.prototype.has=o,s.prototype.set=a,e.exports=s},53818:(e,t,n)=>{var r=n(10852)(n(55639),"Promise");e.exports=r},58525:(e,t,n)=>{var r=n(10852)(n(55639),"Set");e.exports=r},88668:(e,t,n)=>{var r=n(83369),A=n(90619),i=n(72385);function o(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}o.prototype.add=o.prototype.push=A,o.prototype.has=i,e.exports=o},46384:(e,t,n)=>{var r=n(38407),A=n(37465),i=n(63779),o=n(67599),a=n(44758),s=n(34309);function u(e){var t=this.__data__=new r(e);this.size=t.size}u.prototype.clear=A,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},62705:(e,t,n)=>{var r=n(55639).Symbol;e.exports=r},11149:(e,t,n)=>{var r=n(55639).Uint8Array;e.exports=r},70577:(e,t,n)=>{var r=n(10852)(n(55639),"WeakMap");e.exports=r},77412:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},34963:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,A=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[A++]=o)}return i}},14636:(e,t,n)=>{var r=n(22545),A=n(35694),i=n(1469),o=n(44144),a=n(65776),s=n(36719),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=i(e),c=!n&&A(e),l=!n&&!c&&o(e),h=!n&&!c&&!l&&s(e),p=n||c||l||h,d=p?r(e.length,String):[],f=d.length;for(var y in e)!t&&!u.call(e,y)||p&&("length"==y||l&&("offset"==y||"parent"==y)||h&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||a(y,f))||d.push(y);return d}},29932:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,A=Array(r);++n<r;)A[n]=t(e[n],n,e);return A}},62488:e=>{e.exports=function(e,t){for(var n=-1,r=t.length,A=e.length;++n<r;)e[A+n]=t[n];return e}},82908:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},34865:(e,t,n)=>{var r=n(89465),A=n(77813),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var o=e[t];i.call(e,t)&&A(o,n)&&(void 0!==n||t in e)||r(e,t,n)}},18470:(e,t,n)=>{var r=n(77813);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},44037:(e,t,n)=>{var r=n(98363),A=n(3674);e.exports=function(e,t){return e&&r(t,A(t),e)}},63886:(e,t,n)=>{var r=n(98363),A=n(81704);e.exports=function(e,t){return e&&r(t,A(t),e)}},89465:(e,t,n)=>{var r=n(38777);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},85990:(e,t,n)=>{var r=n(46384),A=n(77412),i=n(34865),o=n(44037),a=n(63886),s=n(64626),u=n(278),c=n(18805),l=n(1911),h=n(58234),p=n(46904),d=n(64160),f=n(43824),y=n(29148),g=n(38517),E=n(1469),B=n(44144),m=n(56688),v=n(13218),w=n(72928),k=n(3674),C=n(81704),b="[object Arguments]",S="[object Function]",T="[object Object]",x={};x[b]=x["[object Array]"]=x["[object ArrayBuffer]"]=x["[object DataView]"]=x["[object Boolean]"]=x["[object Date]"]=x["[object Float32Array]"]=x["[object Float64Array]"]=x["[object Int8Array]"]=x["[object Int16Array]"]=x["[object Int32Array]"]=x["[object Map]"]=x["[object Number]"]=x[T]=x["[object RegExp]"]=x["[object Set]"]=x["[object String]"]=x["[object Symbol]"]=x["[object Uint8Array]"]=x["[object Uint8ClampedArray]"]=x["[object Uint16Array]"]=x["[object Uint32Array]"]=!0,x["[object Error]"]=x[S]=x["[object WeakMap]"]=!1,e.exports=function e(t,n,M,U,Q,L){var F,R=1&n,H=2&n,_=4&n;if(M&&(F=Q?M(t,U,Q,L):M(t)),void 0!==F)return F;if(!v(t))return t;var D=E(t);if(D){if(F=f(t),!R)return u(t,F)}else{var I=d(t),O=I==S||"[object GeneratorFunction]"==I;if(B(t))return s(t,R);if(I==T||I==b||O&&!Q){if(F=H||O?{}:g(t),!R)return H?l(t,a(F,t)):c(t,o(F,t))}else{if(!x[I])return Q?t:{};F=y(t,I,R)}}L||(L=new r);var P=L.get(t);if(P)return P;L.set(t,F),w(t)?t.forEach((function(r){F.add(e(r,n,M,r,t,L))})):m(t)&&t.forEach((function(r,A){F.set(A,e(r,n,M,A,t,L))}));var N=D?void 0:(_?H?p:h:H?C:k)(t);return A(N||t,(function(r,A){N&&(r=t[A=r]),i(F,A,e(r,n,M,A,t,L))})),F}},3118:(e,t,n)=>{var r=n(13218),A=Object.create,i=function(){function e(){}return function(t){if(!r(t))return{};if(A)return A(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=i},41848:e=>{e.exports=function(e,t,n,r){for(var A=e.length,i=n+(r?1:-1);r?i--:++i<A;)if(t(e[i],i,e))return i;return-1}},97786:(e,t,n)=>{var r=n(71811),A=n(40327);e.exports=function(e,t){for(var n=0,i=(t=r(t,e)).length;null!=e&&n<i;)e=e[A(t[n++])];return n&&n==i?e:void 0}},68866:(e,t,n)=>{var r=n(62488),A=n(1469);e.exports=function(e,t,n){var i=t(e);return A(e)?i:r(i,n(e))}},44239:(e,t,n)=>{var r=n(62705),A=n(89607),i=n(2333),o=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?A(e):i(e)}},13:e=>{e.exports=function(e,t){return null!=e&&t in Object(e)}},9454:(e,t,n)=>{var r=n(44239),A=n(37005);e.exports=function(e){return A(e)&&"[object Arguments]"==r(e)}},90939:(e,t,n)=>{var r=n(2492),A=n(37005);e.exports=function e(t,n,i,o,a){return t===n||(null==t||null==n||!A(t)&&!A(n)?t!=t&&n!=n:r(t,n,i,o,e,a))}},2492:(e,t,n)=>{var r=n(46384),A=n(67114),i=n(18351),o=n(16096),a=n(64160),s=n(1469),u=n(44144),c=n(36719),l="[object Arguments]",h="[object Array]",p="[object Object]",d=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,f,y,g){var E=s(e),B=s(t),m=E?h:a(e),v=B?h:a(t),w=(m=m==l?p:m)==p,k=(v=v==l?p:v)==p,C=m==v;if(C&&u(e)){if(!u(t))return!1;E=!0,w=!1}if(C&&!w)return g||(g=new r),E||c(e)?A(e,t,n,f,y,g):i(e,t,m,n,f,y,g);if(!(1&n)){var b=w&&d.call(e,"__wrapped__"),S=k&&d.call(t,"__wrapped__");if(b||S){var T=b?e.value():e,x=S?t.value():t;return g||(g=new r),y(T,x,n,f,g)}}return!!C&&(g||(g=new r),o(e,t,n,f,y,g))}},25588:(e,t,n)=>{var r=n(64160),A=n(37005);e.exports=function(e){return A(e)&&"[object Map]"==r(e)}},2958:(e,t,n)=>{var r=n(46384),A=n(90939);e.exports=function(e,t,n,i){var o=n.length,a=o,s=!i;if(null==e)return!a;for(e=Object(e);o--;){var u=n[o];if(s&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++o<a;){var c=(u=n[o])[0],l=e[c],h=u[1];if(s&&u[2]){if(void 0===l&&!(c in e))return!1}else{var p=new r;if(i)var d=i(l,h,c,e,t,p);if(!(void 0===d?A(h,l,3,i,p):d))return!1}}return!0}},28458:(e,t,n)=>{var r=n(23560),A=n(15346),i=n(13218),o=n(80346),a=/^\[object .+?Constructor\]$/,s=Function.prototype,u=Object.prototype,c=s.toString,l=u.hasOwnProperty,h=RegExp("^"+c.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||A(e))&&(r(e)?h:a).test(o(e))}},29221:(e,t,n)=>{var r=n(64160),A=n(37005);e.exports=function(e){return A(e)&&"[object Set]"==r(e)}},38749:(e,t,n)=>{var r=n(44239),A=n(41780),i=n(37005),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&A(e.length)&&!!o[r(e)]}},67206:(e,t,n)=>{var r=n(91573),A=n(16432),i=n(6557),o=n(1469),a=n(39601);e.exports=function(e){return"function"==typeof e?e:null==e?i:"object"==typeof e?o(e)?A(e[0],e[1]):r(e):a(e)}},280:(e,t,n)=>{var r=n(25726),A=n(86916),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return A(e);var t=[];for(var n in Object(e))i.call(e,n)&&"constructor"!=n&&t.push(n);return t}},10313:(e,t,n)=>{var r=n(13218),A=n(25726),i=n(33498),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=A(e),n=[];for(var a in e)("constructor"!=a||!t&&o.call(e,a))&&n.push(a);return n}},91573:(e,t,n)=>{var r=n(2958),A=n(1499),i=n(42634);e.exports=function(e){var t=A(e);return 1==t.length&&t[0][2]?i(t[0][0],t[0][1]):function(n){return n===e||r(n,e,t)}}},16432:(e,t,n)=>{var r=n(90939),A=n(27361),i=n(79095),o=n(15403),a=n(89162),s=n(42634),u=n(40327);e.exports=function(e,t){return o(e)&&a(t)?s(u(e),t):function(n){var o=A(n,e);return void 0===o&&o===t?i(n,e):r(t,o,3)}}},40371:e=>{e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},79152:(e,t,n)=>{var r=n(97786);e.exports=function(e){return function(t){return r(t,e)}}},15742:(e,t,n)=>{var r=n(57406),A=n(65776),i=Array.prototype.splice;e.exports=function(e,t){for(var n=e?t.length:0,o=n-1;n--;){var a=t[n];if(n==o||a!==s){var s=a;A(a)?i.call(e,a,1):r(e,a)}}return e}},14259:e=>{e.exports=function(e,t,n){var r=-1,A=e.length;t<0&&(t=-t>A?0:A+t),(n=n>A?A:n)<0&&(n+=A),A=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(A);++r<A;)i[r]=e[r+t];return i}},22545:e=>{e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},80531:(e,t,n)=>{var r=n(62705),A=n(29932),i=n(1469),o=n(33448),a=r?r.prototype:void 0,s=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(i(t))return A(t,e)+"";if(o(t))return s?s.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},27561:(e,t,n)=>{var r=n(67990),A=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(A,""):e}},7518:e=>{e.exports=function(e){return function(t){return e(t)}}},57406:(e,t,n)=>{var r=n(71811),A=n(10928),i=n(40292),o=n(40327);e.exports=function(e,t){return t=r(t,e),null==(e=i(e,t))||delete e[o(A(t))]}},74757:e=>{e.exports=function(e,t){return e.has(t)}},71811:(e,t,n)=>{var r=n(1469),A=n(15403),i=n(55514),o=n(79833);e.exports=function(e,t){return r(e)?e:A(e,t)?[e]:i(o(e))}},74318:(e,t,n)=>{var r=n(11149);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},64626:(e,t,n)=>{e=n.nmd(e);var r=n(55639),A=t&&!t.nodeType&&t,i=A&&e&&!e.nodeType&&e,o=i&&i.exports===A?r.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}},57157:(e,t,n)=>{var r=n(74318);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},93147:e=>{var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},40419:(e,t,n)=>{var r=n(62705),A=r?r.prototype:void 0,i=A?A.valueOf:void 0;e.exports=function(e){return i?Object(i.call(e)):{}}},77133:(e,t,n)=>{var r=n(74318);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},278:e=>{e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},98363:(e,t,n)=>{var r=n(34865),A=n(89465);e.exports=function(e,t,n,i){var o=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var u=t[a],c=i?i(n[u],e[u],u,n,e):void 0;void 0===c&&(c=e[u]),o?A(n,u,c):r(n,u,c)}return n}},18805:(e,t,n)=>{var r=n(98363),A=n(99551);e.exports=function(e,t){return r(e,A(e),t)}},1911:(e,t,n)=>{var r=n(98363),A=n(51442);e.exports=function(e,t){return r(e,A(e),t)}},14429:(e,t,n)=>{var r=n(55639)["__core-js_shared__"];e.exports=r},67740:(e,t,n)=>{var r=n(67206),A=n(98612),i=n(3674);e.exports=function(e){return function(t,n,o){var a=Object(t);if(!A(t)){var s=r(n,3);t=i(t),n=function(e){return s(a[e],e,a)}}var u=e(t,n,o);return u>-1?a[s?t[u]:u]:void 0}}},38777:(e,t,n)=>{var r=n(10852),A=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=A},67114:(e,t,n)=>{var r=n(88668),A=n(82908),i=n(74757);e.exports=function(e,t,n,o,a,s){var u=1&n,c=e.length,l=t.length;if(c!=l&&!(u&&l>c))return!1;var h=s.get(e),p=s.get(t);if(h&&p)return h==t&&p==e;var d=-1,f=!0,y=2&n?new r:void 0;for(s.set(e,t),s.set(t,e);++d<c;){var g=e[d],E=t[d];if(o)var B=u?o(E,g,d,t,e,s):o(g,E,d,e,t,s);if(void 0!==B){if(B)continue;f=!1;break}if(y){if(!A(t,(function(e,t){if(!i(y,t)&&(g===e||a(g,e,n,o,s)))return y.push(t)}))){f=!1;break}}else if(g!==E&&!a(g,E,n,o,s)){f=!1;break}}return s.delete(e),s.delete(t),f}},18351:(e,t,n)=>{var r=n(62705),A=n(11149),i=n(77813),o=n(67114),a=n(68776),s=n(21814),u=r?r.prototype:void 0,c=u?u.valueOf:void 0;e.exports=function(e,t,n,r,u,l,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!l(new A(e),new A(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=a;case"[object Set]":var d=1&r;if(p||(p=s),e.size!=t.size&&!d)return!1;var f=h.get(e);if(f)return f==t;r|=2,h.set(e,t);var y=o(p(e),p(t),r,u,l,h);return h.delete(e),y;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},16096:(e,t,n)=>{var r=n(58234),A=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,i,o,a){var s=1&n,u=r(e),c=u.length;if(c!=r(t).length&&!s)return!1;for(var l=c;l--;){var h=u[l];if(!(s?h in t:A.call(t,h)))return!1}var p=a.get(e),d=a.get(t);if(p&&d)return p==t&&d==e;var f=!0;a.set(e,t),a.set(t,e);for(var y=s;++l<c;){var g=e[h=u[l]],E=t[h];if(i)var B=s?i(E,g,h,t,e,a):i(g,E,h,e,t,a);if(!(void 0===B?g===E||o(g,E,n,i,a):B)){f=!1;break}y||(y="constructor"==h)}if(f&&!y){var m=e.constructor,v=t.constructor;m==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof m&&m instanceof m&&"function"==typeof v&&v instanceof v||(f=!1)}return a.delete(e),a.delete(t),f}},31957:(e,t,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=r},58234:(e,t,n)=>{var r=n(68866),A=n(99551),i=n(3674);e.exports=function(e){return r(e,i,A)}},46904:(e,t,n)=>{var r=n(68866),A=n(51442),i=n(81704);e.exports=function(e){return r(e,i,A)}},45050:(e,t,n)=>{var r=n(37019);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},1499:(e,t,n)=>{var r=n(89162),A=n(3674);e.exports=function(e){for(var t=A(e),n=t.length;n--;){var i=t[n],o=e[i];t[n]=[i,o,r(o)]}return t}},10852:(e,t,n)=>{var r=n(28458),A=n(47801);e.exports=function(e,t){var n=A(e,t);return r(n)?n:void 0}},85924:(e,t,n)=>{var r=n(5569)(Object.getPrototypeOf,Object);e.exports=r},89607:(e,t,n)=>{var r=n(62705),A=Object.prototype,i=A.hasOwnProperty,o=A.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=i.call(e,a),n=e[a];try{e[a]=void 0;var r=!0}catch(e){}var A=o.call(e);return r&&(t?e[a]=n:delete e[a]),A}},99551:(e,t,n)=>{var r=n(34963),A=n(70479),i=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(e){return null==e?[]:(e=Object(e),r(o(e),(function(t){return i.call(e,t)})))}:A;e.exports=a},51442:(e,t,n)=>{var r=n(62488),A=n(85924),i=n(99551),o=n(70479),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,i(e)),e=A(e);return t}:o;e.exports=a},64160:(e,t,n)=>{var r=n(18552),A=n(57071),i=n(53818),o=n(58525),a=n(70577),s=n(44239),u=n(80346),c="[object Map]",l="[object Promise]",h="[object Set]",p="[object WeakMap]",d="[object DataView]",f=u(r),y=u(A),g=u(i),E=u(o),B=u(a),m=s;(r&&m(new r(new ArrayBuffer(1)))!=d||A&&m(new A)!=c||i&&m(i.resolve())!=l||o&&m(new o)!=h||a&&m(new a)!=p)&&(m=function(e){var t=s(e),n="[object Object]"==t?e.constructor:void 0,r=n?u(n):"";if(r)switch(r){case f:return d;case y:return c;case g:return l;case E:return h;case B:return p}return t}),e.exports=m},47801:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},222:(e,t,n)=>{var r=n(71811),A=n(35694),i=n(1469),o=n(65776),a=n(41780),s=n(40327);e.exports=function(e,t,n){for(var u=-1,c=(t=r(t,e)).length,l=!1;++u<c;){var h=s(t[u]);if(!(l=null!=e&&n(e,h)))break;e=e[h]}return l||++u!=c?l:!!(c=null==e?0:e.length)&&a(c)&&o(h,c)&&(i(e)||A(e))}},51789:(e,t,n)=>{var r=n(94536);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},80401:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},57667:(e,t,n)=>{var r=n(94536),A=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return A.call(t,e)?t[e]:void 0}},21327:(e,t,n)=>{var r=n(94536),A=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:A.call(t,e)}},81866:(e,t,n)=>{var r=n(94536);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},43824:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},29148:(e,t,n)=>{var r=n(74318),A=n(57157),i=n(93147),o=n(40419),a=n(77133);e.exports=function(e,t,n){var s=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new s(+e);case"[object DataView]":return A(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(e,n);case"[object Map]":return new s;case"[object Number]":case"[object String]":return new s(e);case"[object RegExp]":return i(e);case"[object Set]":return new s;case"[object Symbol]":return o(e)}}},38517:(e,t,n)=>{var r=n(3118),A=n(85924),i=n(25726);e.exports=function(e){return"function"!=typeof e.constructor||i(e)?{}:r(A(e))}},65776:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var r=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<n}},15403:(e,t,n)=>{var r=n(1469),A=n(33448),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;e.exports=function(e,t){if(r(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!A(e))||o.test(e)||!i.test(e)||null!=t&&e in Object(t)}},37019:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},15346:(e,t,n)=>{var r,A=n(14429),i=(r=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!i&&i in e}},25726:e=>{var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},89162:(e,t,n)=>{var r=n(13218);e.exports=function(e){return e==e&&!r(e)}},27040:e=>{e.exports=function(){this.__data__=[],this.size=0}},14125:(e,t,n)=>{var r=n(18470),A=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():A.call(t,n,1),--this.size,0))}},82117:(e,t,n)=>{var r=n(18470);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},67518:(e,t,n)=>{var r=n(18470);e.exports=function(e){return r(this.__data__,e)>-1}},54705:(e,t,n)=>{var r=n(18470);e.exports=function(e,t){var n=this.__data__,A=r(n,e);return A<0?(++this.size,n.push([e,t])):n[A][1]=t,this}},24785:(e,t,n)=>{var r=n(1989),A=n(38407),i=n(57071);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||A),string:new r}}},11285:(e,t,n)=>{var r=n(45050);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},96e3:(e,t,n)=>{var r=n(45050);e.exports=function(e){return r(this,e).get(e)}},49916:(e,t,n)=>{var r=n(45050);e.exports=function(e){return r(this,e).has(e)}},95265:(e,t,n)=>{var r=n(45050);e.exports=function(e,t){var n=r(this,e),A=n.size;return n.set(e,t),this.size+=n.size==A?0:1,this}},68776:e=>{e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},42634:e=>{e.exports=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}},24523:(e,t,n)=>{var r=n(88306);e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},94536:(e,t,n)=>{var r=n(10852)(Object,"create");e.exports=r},86916:(e,t,n)=>{var r=n(5569)(Object.keys,Object);e.exports=r},33498:e=>{e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},31167:(e,t,n)=>{e=n.nmd(e);var r=n(31957),A=t&&!t.nodeType&&t,i=A&&e&&!e.nodeType&&e,o=i&&i.exports===A&&r.process,a=function(){try{return i&&i.require&&i.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a},2333:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5569:e=>{e.exports=function(e,t){return function(n){return e(t(n))}}},40292:(e,t,n)=>{var r=n(97786),A=n(14259);e.exports=function(e,t){return t.length<2?e:r(e,A(t,0,-1))}},55639:(e,t,n)=>{var r=n(31957),A="object"==typeof self&&self&&self.Object===Object&&self,i=r||A||Function("return this")();e.exports=i},90619:e=>{e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},72385:e=>{e.exports=function(e){return this.__data__.has(e)}},21814:e=>{e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},37465:(e,t,n)=>{var r=n(38407);e.exports=function(){this.__data__=new r,this.size=0}},63779:e=>{e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},67599:e=>{e.exports=function(e){return this.__data__.get(e)}},44758:e=>{e.exports=function(e){return this.__data__.has(e)}},34309:(e,t,n)=>{var r=n(38407),A=n(57071),i=n(83369);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var o=n.__data__;if(!A||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new i(o)}return n.set(e,t),this.size=n.size,this}},55514:(e,t,n)=>{var r=n(24523),A=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(A,(function(e,n,r,A){t.push(r?A.replace(i,"$1"):n||e)})),t}));e.exports=o},40327:(e,t,n)=>{var r=n(33448);e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},80346:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},67990:e=>{var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},50361:(e,t,n)=>{var r=n(85990);e.exports=function(e){return r(e,5)}},23279:(e,t,n)=>{var r=n(13218),A=n(7771),i=n(14841),o=Math.max,a=Math.min;e.exports=function(e,t,n){var s,u,c,l,h,p,d=0,f=!1,y=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function E(t){var n=s,r=u;return s=u=void 0,d=t,l=e.apply(r,n)}function B(e){return d=e,h=setTimeout(v,t),f?E(e):l}function m(e){var n=e-p;return void 0===p||n>=t||n<0||y&&e-d>=c}function v(){var e=A();if(m(e))return w(e);h=setTimeout(v,function(e){var n=t-(e-p);return y?a(n,c-(e-d)):n}(e))}function w(e){return h=void 0,g&&s?E(e):(s=u=void 0,l)}function k(){var e=A(),n=m(e);if(s=arguments,u=this,p=e,n){if(void 0===h)return B(p);if(y)return clearTimeout(h),h=setTimeout(v,t),E(p)}return void 0===h&&(h=setTimeout(v,t)),l}return t=i(t)||0,r(n)&&(f=!!n.leading,c=(y="maxWait"in n)?o(i(n.maxWait)||0,t):c,g="trailing"in n?!!n.trailing:g),k.cancel=function(){void 0!==h&&clearTimeout(h),d=0,s=p=u=h=void 0},k.flush=function(){return void 0===h?l:w(A())},k}},77813:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},30988:(e,t,n)=>{var r=n(67740)(n(7436));e.exports=r},7436:(e,t,n)=>{var r=n(41848),A=n(67206),i=n(40554),o=Math.max,a=Math.min;e.exports=function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var u=s-1;return void 0!==n&&(u=i(n),u=n<0?o(s+u,0):a(u,s-1)),r(e,A(t,3),u,!0)}},27361:(e,t,n)=>{var r=n(97786);e.exports=function(e,t,n){var A=null==e?void 0:r(e,t);return void 0===A?n:A}},79095:(e,t,n)=>{var r=n(13),A=n(222);e.exports=function(e,t){return null!=e&&A(e,t,r)}},6557:e=>{e.exports=function(e){return e}},35694:(e,t,n)=>{var r=n(9454),A=n(37005),i=Object.prototype,o=i.hasOwnProperty,a=i.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(e){return A(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=s},1469:e=>{var t=Array.isArray;e.exports=t},98612:(e,t,n)=>{var r=n(23560),A=n(41780);e.exports=function(e){return null!=e&&A(e.length)&&!r(e)}},44144:(e,t,n)=>{e=n.nmd(e);var r=n(55639),A=n(95062),i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i?r.Buffer:void 0,s=(a?a.isBuffer:void 0)||A;e.exports=s},23560:(e,t,n)=>{var r=n(44239),A=n(13218);e.exports=function(e){if(!A(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},41780:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},56688:(e,t,n)=>{var r=n(25588),A=n(7518),i=n(31167),o=i&&i.isMap,a=o?A(o):r;e.exports=a},13218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},37005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},72928:(e,t,n)=>{var r=n(29221),A=n(7518),i=n(31167),o=i&&i.isSet,a=o?A(o):r;e.exports=a},33448:(e,t,n)=>{var r=n(44239),A=n(37005);e.exports=function(e){return"symbol"==typeof e||A(e)&&"[object Symbol]"==r(e)}},36719:(e,t,n)=>{var r=n(38749),A=n(7518),i=n(31167),o=i&&i.isTypedArray,a=o?A(o):r;e.exports=a},3674:(e,t,n)=>{var r=n(14636),A=n(280),i=n(98612);e.exports=function(e){return i(e)?r(e):A(e)}},81704:(e,t,n)=>{var r=n(14636),A=n(10313),i=n(98612);e.exports=function(e){return i(e)?r(e,!0):A(e)}},10928:e=>{e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},88306:(e,t,n)=>{var r=n(83369);function A(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,A=t?t.apply(this,r):r[0],i=n.cache;if(i.has(A))return i.get(A);var o=e.apply(this,r);return n.cache=i.set(A,o)||i,o};return n.cache=new(A.Cache||r),n}A.Cache=r,e.exports=A},7771:(e,t,n)=>{var r=n(55639);e.exports=function(){return r.Date.now()}},39601:(e,t,n)=>{var r=n(40371),A=n(79152),i=n(15403),o=n(40327);e.exports=function(e){return i(e)?r(o(e)):A(e)}},82729:(e,t,n)=>{var r=n(67206),A=n(15742);e.exports=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,o=[],a=e.length;for(t=r(t,3);++i<a;){var s=e[i];t(s,i,e)&&(n.push(s),o.push(i))}return A(e,o),n}},70479:e=>{e.exports=function(){return[]}},95062:e=>{e.exports=function(){return!1}},23493:(e,t,n)=>{var r=n(23279),A=n(13218);e.exports=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return A(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),r(e,t,{leading:i,maxWait:t,trailing:o})}},18601:(e,t,n)=>{var r=n(14841);e.exports=function(e){return e?Infinity===(e=r(e))||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},40554:(e,t,n)=>{var r=n(18601);e.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}},14841:(e,t,n)=>{var r=n(27561),A=n(13218),i=n(33448),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(i(e))return NaN;if(A(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=A(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=a.test(e);return n||s.test(e)?u(e.slice(2),n?2:8):o.test(e)?NaN:+e}},79833:(e,t,n)=>{var r=n(80531);e.exports=function(e){return null==e?"":r(e)}},35867:()=>{!function(){try{return new MouseEvent("test")}catch(e){}var e=function(e,t){t=t||{bubbles:!1,cancelable:!1};var n=document.createEvent("MouseEvent");return n.initMouseEvent(e,t.bubbles,t.cancelable,window,0,t.screenX||0,t.screenY||0,t.clientX||0,t.clientY||0,t.ctrlKey||!1,t.altKey||!1,t.shiftKey||!1,t.metaKey||!1,t.button||0,t.relatedTarget||null),n};e.prototype=Event.prototype,window.MouseEvent=e}()},93379:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},o=[],a=0;a<e.length;a++){var s=e[a],u=r.base?s[0]+r.base:s[0],c=i[u]||0,l="".concat(u," ").concat(c);i[u]=c+1;var h=n(l),p={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(t[h].references++,t[h].updater(p)):t.push({identifier:l,updater:A(p,r),references:1}),o.push(l)}return o}function A(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,A){var i=r(e=e||[],A=A||{});return function(e){e=e||[];for(var o=0;o<i.length;o++){var a=n(i[o]);t[a].references--}for(var s=r(e,A),u=0;u<i.length;u++){var c=n(i[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}i=s}}},90569:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r=n.css,A=n.media,i=n.sourceMap;A?e.setAttribute("media",A):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},55877:(e,t,n)=>{var r=n(23570),A=n(71171),i=A;i.v1=r,i.v4=A,e.exports=i},45327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0,A=t;return[A[e[r++]],A[e[r++]],A[e[r++]],A[e[r++]],"-",A[e[r++]],A[e[r++]],"-",A[e[r++]],A[e[r++]],"-",A[e[r++]],A[e[r++]],"-",A[e[r++]],A[e[r++]],A[e[r++]],A[e[r++]],A[e[r++]],A[e[r++]]].join("")}},85217:e=>{var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},23570:(e,t,n)=>{var r,A,i=n(85217),o=n(45327),a=0,s=0;e.exports=function(e,t,n){var u=t&&n||0,c=t||[],l=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:A;if(null==l||null==h){var p=i();null==l&&(l=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=A=16383&(p[6]<<8|p[7]))}var d=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:s+1,y=d-a+(f-s)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||d>a)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=d,s=f,A=h;var g=(1e4*(268435455&(d+=122192928e5))+f)%4294967296;c[u++]=g>>>24&255,c[u++]=g>>>16&255,c[u++]=g>>>8&255,c[u++]=255&g;var E=d/4294967296*1e4&268435455;c[u++]=E>>>8&255,c[u++]=255&E,c[u++]=E>>>24&15|16,c[u++]=E>>>16&255,c[u++]=h>>>8|128,c[u++]=255&h;for(var B=0;B<6;++B)c[u+B]=l[B];return t||o(c)}},71171:(e,t,n)=>{var r=n(85217),A=n(45327);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[i+a]=o[a];return t||A(o)}}},t={};function n(r){var A=t[r];if(void 0!==A)return A.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var r={};(()=>{"use strict";n.r(r),n.d(r,{default:()=>Hc});var e={};n.r(e),n.d(e,{ANCHOR_RADIUS:()=>ke,ARROW_MOVE_OFFSET:()=>Qe,ARROW_TIP_LENGTH:()=>me,ATTACHMENT_DATA_TYPE_BINARY:()=>Z,ATTACHMENT_DATA_TYPE_TEXT:()=>q,BOUNDING_BOX_MARGIN:()=>Oe,COLORS:()=>o,CONTEXTUAL_MENU_OFFSET:()=>Le,DEFAULT_COLOR:()=>ie,DEFAULT_COLORS:()=>a,DEFAULT_FILL_COLOR:()=>ae,DEFAULT_FILL_COLORS:()=>s,DEFAULT_FILL_OPACITY:()=>le,DEFAULT_FONT_COLOR:()=>oe,DEFAULT_FONT_FAMILY:()=>ye,DEFAULT_FONT_SIZE_IN_MM:()=>de,DEFAULT_FONT_SIZE_IN_PIXELS:()=>pe,DEFAULT_FONT_STYLE:()=>ge,DEFAULT_FONT_WEIGHT:()=>fe,DEFAULT_HIGHLIGHT_OPACITY:()=>ce,DEFAULT_MARKUP:()=>Ae,DEFAULT_OPACITY:()=>ue,DEFAULT_STATUSES_TO_LOAD:()=>te,DEFAULT_STROKE_IN_MM:()=>he,DEFAULT_THICKNESS:()=>se,DIMENSION_FONT_SIZE_FACTOR:()=>Ge,DIMENSION_THICKNESS_FACTOR:()=>Ve,DIMENSION_TIP_LENGTH:()=>Ke,DISABLED_OPACITY:()=>je,EPSILON:()=>ve,FONT_SIZES:()=>c,FRAME_SIZE_SCALE:()=>Ie,HIT_AREA_MARGIN:()=>Pe,LINK_ICON_SIZE:()=>Re,LINK_POSITION_OFFSET:()=>Fe,LINK_TYPE_ATTACHMENTS:()=>ne,LINK_TYPE_DOCUMENT_ATTACHMENT:()=>re,MARKUP_ATTACHMENT_DELETEING:()=>z,MARKUP_ATTACHMENT_LOADING:()=>j,MARKUP_ATTACHMENT_RENAMING:()=>J,MARKUP_ATTACHMENT_SAVE_FAILED:()=>X,MARKUP_ATTACHMENT_SAVE_SUCCEED:()=>W,MARKUP_ATTACHMENT_SAVING:()=>Y,MARKUP_CREATION_CURSORS:()=>rt,MARKUP_ERRORS:()=>At,MARKUP_RESOURCE_TYPE_SCREEN_CAPTURE:()=>ee,MARKUP_RESOURCE_TYPE_SVG:()=>$,MARKUP_STATUS_ARCHIVED:()=>V,MARKUP_STATUS_ARCHIVING:()=>G,MARKUP_STATUS_CLOSED:()=>K,MARKUP_STATUS_CREATED:()=>D,MARKUP_STATUS_DELETE_FAILED:()=>_,MARKUP_STATUS_DELETE_SUCCEED:()=>H,MARKUP_STATUS_DELETING:()=>R,MARKUP_STATUS_OPEN:()=>I,MARKUP_STATUS_PRIVATE:()=>O,MARKUP_STATUS_PUBLISHED:()=>P,MARKUP_STATUS_PUBLISHING:()=>N,MARKUP_STATUS_SAVE_FAILED:()=>Q,MARKUP_STATUS_SAVE_SUCCEED:()=>L,MARKUP_STATUS_SAVING:()=>F,MARKUP_TYPE_ARROW:()=>y,MARKUP_TYPE_ARROW_CALLOUT:()=>S,MARKUP_TYPE_ARROW_CLOUD_CALLOUT:()=>T,MARKUP_TYPE_CALLOUT:()=>b,MARKUP_TYPE_CIRCLE:()=>E,MARKUP_TYPE_CLOUD:()=>B,MARKUP_TYPE_DIMENSION:()=>x,MARKUP_TYPE_FREEHAND:()=>m,MARKUP_TYPE_HIGHLIGHT:()=>v,MARKUP_TYPE_LINE:()=>M,MARKUP_TYPE_POLYCLOUD:()=>k,MARKUP_TYPE_POLYLINE:()=>w,MARKUP_TYPE_RECTANGLE:()=>g,MARKUP_TYPE_TEXT:()=>C,MAX_NORMA_PERCENTAGE:()=>Ze,MAX_NORMA_TEXT_PERCENTAGE:()=>qe,MAX_THICKNESS:()=>_e,MESHLINE_PATH_DEFAULT:()=>p,MESHLINE_PATH_END:()=>h,MESHLINE_PATH_FLAT_CAP:()=>f,MESHLINE_PATH_ROUND_CAP:()=>d,MESHLINE_PATH_START:()=>l,MINIMUM_THUMBNAIL_SIZE:()=>Je,MIN_ANGLE_CHANGE:()=>Te,MIN_CHANGE_DISTANCE:()=>Ce,MIN_FREEHAND_POINT_DISTANCE:()=>Se,MOBILE_GESTURES_MIN_THRESHOLD_TIME:()=>Ye,NORMA_3D:()=>$e,NORMA_TEXT_3D:()=>et,PASTE_OFFSET:()=>Ue,PERSPECTIVE_MODE_SCALE:()=>De,POINT_SIZE_IN_MM:()=>tt,RECT_SELECTOR:()=>U,ROTATION_ANCHOR_DISTANCE:()=>xe,ROTATION_SNAP_DEGREES:()=>Me,SCREEN_MARGIN:()=>We,SELECTION_ZOOM_MARGIN:()=>He,SNAP_DISTANCE:()=>be,STYLE_PROPERTIES:()=>u,SUB_MENU_VISIBLE_CLASS:()=>Ee,TEXT_DEBOUNCE:()=>Ne,TEXT_LENGTH_LIMIT:()=>Xe,TIMEOUT_TO_SELECT_AFTER_DRAWEND:()=>nt,TOUCH_RADIUS:()=>we,WORLD_3D_SIZE:()=>ze});var t,A={MARKUP_SESSION_START:"markup.session.start",MARKUP_SESSION_END:"markup.session.end",MARKUP_TOOL_ENABLED_CHANGED:"markup.tool.enabled.changed",MARKUP_REMOVED:"markup.removed",MARKUP_DRAWING_START:"markup.drawing.start",MARKUP_DRAWING_END:"markup.drawing.end",MARKUP_DRAWING_CANCEL:"markup.drawing.cancel",MARKUP_EDIT_START:"markup.edit.start",MARKUP_EDIT_END:"markup.edit.end",MARKUP_SELECTED:"markup.selected",MARKUP_DESELECTED:"markup.deselected",MARKUP_ENABLE_EDIT:"markup.enable.edit",MARKUP_DISABLE_EDIT:"markup.disable.edit",MARKUP_DIRTY:"markup.dirty",MARKUP_VISIBILITY_CHANGED:"markup.visibility.changed",MARKUP_VIEW_ENTERED:"markup.view.entered",MARKUP_VIEW_EXITED:"markup.view.exited",TEXT_EDITING_STARTED:"text.editing.started",TEXT_EDITING_ENDED:"text.editing.ended",LAYER_DIRTY:"layer.dirty",LAYER_SELECTED:"layer.selected",LAYER_DESELECTED:"layer.deselected",LAYER_SELECTED_FROM_DIFFERENT_SHEET:"layer.selected.from.different.sheet",LAYER_EDITED_FROM_DIFFERENT_SHEET:"layer.edited.from.different.sheet",LAYER_DELETE:"layer.delete",LAYER_DELETED:"layer.deleted",LAYER_PUBLISH:"layer.publish",LAYER_ARCHIVE:"layer.archive",LAYER_SYNCING:"layer.syncing",LAYER_SYNCED:"layer.synced",LAYER_READY_TO_SAVE:"layer.ready.to.save",LAYER_CREATED:"layer.created",DOCUMENT_ATTACHMENT_CREATION_START:"document.attachment.creation.start",DOCUMENT_ATTACHMENT_RENAME:"document.attachment.rename",DOCUMENT_ATTACHMENT_DELETE:"document.attachment.delete",LAYER_FETCHED:"layer.fetched",LAYER_RESOURCE_FETCHED:"layer.resource.fetched",LAYER_THUMBNAIL_FETCHED:"layer.thumbnail.fetched",LAYER_METADATA_FETCHED:"layer.metadata.fetched",ATTACHMENT_THUMBNAIL_LOADED:"attachment.thumbnail.loaded",ALL_MARKUPS_LOADED:"all.markups.loaded",PROJECT_USERS_FETCHED:"project.users.fetched",LINK_DIRTY:"link.dirty",LINK_SELECTED:"link.selected",LINK_DESELECTED:"link.deselected",LINK_SYNCED:"link.synced",LINK_SYNCING:"link.syncing",LINK_REMOVED:"link.removed",LINK_RENDERED:"link.rendered",FILTER_CHANGED:"filter.changed",BUTTON_DOWN:"button.down",MARKUP_CREATION_TYPE_CHANGED:"markup.creation.type.changed",MARKUP_STYLE_PROPERTY_CHANGED:"markup.style.property.changed",LAYER_DISCARD_PRESSED:"layer.discard.pressed",LAYER_PUBLISH_PRESSED:"layer.publish.pressed",LAYER_ARCHIVE_PRESSED:"layer.archive.pressed",LAYER_DELETE_PRESSED:"layer.delete.pressed",LAYER_DELETE_EMPTY_PRESSED:"layer.delete.empty.pressed",EXIT_VIEWER_PRESSED:"exit.viewer.pressed",RECT_SELECTOR_UPDATED:"rect.selector.updated",CALIBRATION_REQUIRED:"calibration.required"};function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o={RED:"#FF0000",GREEN:"#00F72C",BLUE:"#103FFB",ORANGE:"#FF9224",YELLOW:"#FEF935",CYAN:"#03FCFE",WHITE:"#FFFFFF",BLACK:"#000000",PINK:"#FF4CFC",PURPLE:"#922890",NO_COLOR:"-1"},a=[{color:o.RED,label:"Red"},{color:o.BLUE,label:"Blue"},{color:o.PURPLE,label:"Purple"},{color:o.YELLOW,label:"Yellow"},{color:o.ORANGE,label:"Orange"},{color:o.CYAN,label:"Cyan"},{color:o.PINK,label:"Pink"},{color:o.GREEN,label:"Green"},{color:o.BLACK,label:"Black"},{color:o.WHITE,label:"White"}],s=[{color:o.RED,label:"Red"},{color:o.BLUE,label:"Blue"},{color:o.PURPLE,label:"Purple"},{color:o.YELLOW,label:"Yellow"},{color:o.ORANGE,label:"Orange"},{color:o.CYAN,label:"Cyan"},{color:o.PINK,label:"Pink"},{color:o.GREEN,label:"Green"},{color:o.NO_COLOR,label:"No Fill"},{color:o.BLACK,label:"Black"},{color:o.WHITE,label:"White"}],u={COLOR:"stroke-color",FILL_COLOR:"fill-color",THICKNESS:"stroke-width",OPACITY:"stroke-opacity",FILL_OPACITY:"fill-opacity",FONT_SIZE:"font-size",FONT_WEIGHT:"font-weight",FONT_FAMILY:"font-family",FONT_STYLE:"font-style",FONT_COLOR:"font-color",STROKE_LINEJOIN:"stroke-linejoin"},c=[10,12,14,16,18,20,24,28,32,36,40,44,48,52,58,64,70,76,82,88,94,100],l=1,h=2,p=1,d=2,f=3,y="arrow",g="rectangle",E="ellipse",B="cloud",m="freehand",v="highlight",w="polyline",k="polycloud",C="label",b="callout",S="simple-arrow-callout",T="arrow-cloud-callout",x="dimension",M="line",U="selector",Q="save_failed",L="save_success",F="markup_saving",R="deleting",H="delete_success",_="delete_failed",D="created",I="open",O="private",P="published",N="publishing",K="closed",V="archived",G="archiving",j="attachment_loading",Y="attachment_saving",W="attachment_save_success",X="attachment_save_failed",J="attachment_renaming",z="attachment_deleting",Z="binary",q="text",$="svg",ee="screencapture",te=[O,P,V].join(","),ne="attachments",re="document",Ae=m,ie=o.RED,oe=o.RED,ae=o.NO_COLOR,se=10,ue=1,ce=.5,le=.5,he=.1,pe=36,de=10,fe="normal",ye="Artifakt Element, Arial",ge="normal",Ee="subMenuVisible",Be="undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0),me=5,ve=1e-4,we=Be?34:4,ke=4,Ce=5,be=20,Se=1,Te=.05,xe=Be?30:20,Me=45,Ue=20,Qe=20,Le=60,Fe=10,Re=20,He=.05,_e=100,De=1e3,Ie=20,Oe=4*window.devicePixelRatio+10,Pe=we+10,Ne=200,Ke=8,Ve=.4,Ge=.6,je=.3,Ye=100,We=10,Xe=3e3,Je=92,ze=1e3,Ze=5e-4,qe=20*Ze,$e=1,et=20*$e,tt=.005,nt=700,rt=(i(t={},U,"cell"),i(t,C,"text"),i(t,b,"text"),t),At={MARKUP_SAVE_FAILED:"MARKUP_SAVE_FAILED",MARKUP_DELETE_FAILED:"MARKUP_DELETE_FAILED",MARKUP_PUBLISH_FAILED:"MARKUP_PUBLISH_FAILED",MARKUP_ARCHIVE_FAILED:"MARKUP_ARCHIVE_FAILED",MARKUP_ATTACHMENT_CREATE_FAILED:"MARKUP_ATTACHMENT_CREATE_FAILED",MARKUP_ATTACHMENT_DELETE_FAILED:"MARKUP_ATTACHMENT_DELETE_FAILED",MARKUP_ATTACHMENT_RENAME_FAILED:"MARKUP_ATTACHMENT_RENAME_FAILED",MARKUP_ATTACHMENT_UPDATE_FAILED:"MARKUP_ATTACHMENT_UPDATE_FAILED"};const it={radiansToDegrees:function(e){return e*(180/Math.PI)},degreesToRadians:function(e){return e*(Math.PI/180)},applyRotation:function(e,t,n,r){e instanceof Array||(e=[e]),e.forEach((function(e){e.sub(n),e.applyAxisAngle(r,t),e.add(n)}))},getSignedAngle:function(e,t,n){var r=e.angleTo(t),A=e.clone().cross(t).normalize();return r*(n.dot(A)>0?1:-1)},swapBoundingBoxY:function(e){var t=[e.min.y,e.max.y];return e.max.y=t[0],e.min.y=t[1],e}};var ot=n(50361),at=n(30988),st=n(23279),ut=n(82729),ct={cloneDeep:function(e){return ot(e)},findLast:function(e,t){return at(e,t)},debounce:function(e,t,n){return st(e,t,n)},remove:function(e,t){return ut(e,t)}};const lt=ct;function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var pt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.actionManager=t}var t,n;return t=e,(n=[{key:"execute",value:function(){this.actionManager.execute(this)}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}])&&ht(t.prototype,n),e}();function dt(e){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dt(e)}function ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yt(e,t){return yt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},yt(e,t)}function gt(e,t){return!t||"object"!==dt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Et(e){return Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Et(e)}var Bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yt(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Et(r);if(A){var n=Et(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return gt(this,e)});function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,e.actionManager)).markupsManager=e,r.markup=t,r.layer=n,r}return t=o,(n=[{key:"undo",value:function(){this.markupsManager.removeMarkupFromLayer(this.markup)}},{key:"redo",value:function(){this.markupsManager.addMarkupToLayer(this.markup,this.layer)}}])&&ft(t.prototype,n),o}(pt);function mt(e){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mt(e)}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wt(e,t){return wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},wt(e,t)}function kt(e,t){return!t||"object"!==mt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ct(e){return Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ct(e)}var bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wt(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ct(r);if(A){var n=Ct(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return kt(this,e)});function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,e.actionManager)).markupsManager=e,r.markup=t,r.layer=r.markup.layer,r.oldState=lt.cloneDeep(r.markup.getState()),r.newState=lt.cloneDeep(n),r}return t=o,(n=[{key:"undo",value:function(){this.markup.setState(this.oldState),this.markup.syncEditState()}},{key:"redo",value:function(){this.markup.setState(this.newState),this.markup.syncEditState()}}])&&vt(t.prototype,n),o}(pt);function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function Tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xt(e,t){return xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xt(e,t)}function Mt(e,t){return!t||"object"!==St(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ut(e){return Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ut(e)}var Qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ut(r);if(A){var n=Ut(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Mt(this,e)});function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e.actionManager)).markupsManager=e,n.markup=t,n.layer=n.markup.layer,n}return t=o,(n=[{key:"undo",value:function(){this.markupsManager.addMarkupToLayer(this.markup,this.layer)}},{key:"redo",value:function(){this.markupsManager.removeMarkupFromLayer(this.markup)}}])&&Tt(t.prototype,n),o}(pt),Lt=Autodesk.Viewing,Ft=function(e,t){e&&Object.keys(e).forEach((function(n){var r=e[n];r&&t(r)}))},Rt=function(e,t,n){return!(!e||!t)&&(n=n||ve,e.distanceTo(t)<=n)},Ht=function(e){var t=[];return Ft(e,(function(e){Array.isArray(e)?e.forEach((function(e){t.push(e)})):t.push(e)})),t},_t=function(e,t,n){var r,A=new THREE.Vector3,i=new THREE.Vector3;return A.subVectors(t,e),i.subVectors(n,t),r=A.dot(i),A.subVectors(n,t),r=-r/A.dot(A),A.subVectors(n,t),A.multiplyScalar(r),A.add(t)},Dt=function(e,t){e instanceof Array||(e=[e]),e.forEach((function(e){e.x+=t.x,e.y+=t.y,e.z+=t.z}))},It=function(){var e=Lt.getGlobal().document,t=e.createElement("div");t.id="text-markup-measure-div",t.style.position="absolute",t.style.visibility="hidden",t.style.pointerEvents="none",t.style.textRendering="geometricPrecision",e.body.appendChild(t);var n={};return function(e,r){var A="".concat(e,"_").concat(r.fontWeight,"_").concat(r.fontSize,"_").concat(r.fontFamily,"_").concat(r.fontStyle,"_").concat(r.width);if(n[A])return n[A];t.innerText=e,t.style.fontWeight=r.fontWeight,t.style.fontSize=r.fontSize,t.style.fontFamily=r.fontFamily,t.style.fontStyle=r.fontStyle,t.style.overflowWrap=r.overflowWrap||"break-word",t.style.wordWrap=r.wordWrap||"break-word",t.style.whiteSpace=r.whiteSpace||"pre-wrap",t.style.width=r.width||(Autodesk.Viewing.isIE11?"auto":"unset"),t.style.lineHeight=r.lineHeight||1;var i=t.getBoundingClientRect(),o=i.width,a=i.height;return n[A]={width:o,height:a},n[A]}}(),Ot=function(e,t,n,r,A,i,o,a){var s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;a||(a=[]),e=e||0,t=t||0,n=n||0,r=r||0,A=A||0;var c=Math.abs(r-A);c>2*Math.PI&&(c-=2*Math.PI),(!i&&r>A||i&&A>r)&&(c=2*Math.PI-c),"number"!=typeof o&&(s=s||n,o=Math.max(6,2*Math.floor(6*Math.pow(s,1/3)*(c/Math.PI))));var l=c/(o=Math.max(o,3)),h=r;l*=i?-1:1;for(var p=0;p<o+1;p++){var d=e+Math.cos(h)*n,f=t+Math.sin(h)*n;a.push({x:d,y:f,z:0}),u&&(u.min.x=Math.min(u.min.x,d),u.min.y=Math.min(u.min.y,f),u.max.x=Math.max(u.max.x,d),u.max.y=Math.max(u.max.y,f)),h+=l}return a},Pt=function(e,t,n,r){var A=new THREE.Vector2(e[n].x+Math.cos(e[n].end)*t,e[n].y+Math.sin(e[n].end)*t),i=new THREE.Vector2(e[r].x+Math.cos(e[r].begin)*t,e[r].y+Math.sin(e[r].begin)*t),o=A.clone().sub(i),a=o.length(),s=A.clone().add(i).divideScalar(2);o.normalize();var u=Math.sqrt(Math.max(0,t*t-a/2*(a/2))),c=new THREE.Vector2(o.y,-o.x);c.multiplyScalar(u);var l=s.clone().add(c),h=Math.atan2(A.y-l.y,A.x-l.x),p=Math.atan2(i.y-l.y,i.x-l.x),d={x:l.x,y:l.y,begin:h,end:p};return e.splice(n+1,0,d),{newCircle:d,beginPoint:A,endPoint:i}},Nt=function(e,t,n){for(var r=0;r<n.length;r++){for(var A=null,i=0,o=0;o<e.length;o++)if(e[o]["isCurrentIntersection"+r])for(var a=0;a<e.length;a++)e[a]["isNextIntersection"+r]&&Math.sqrt((e[o].x-e[a].x)*(e[o].x-e[a].x)+(e[o].y-e[a].y)*(e[o].y-e[a].y))<2*t&&(e[o].hide=!0,null===A&&(A=o-1),e[a].hide=!0,i<a+1&&(i=a+1));n[r].begin=A,n[r].end=i}},Kt=function(e,t,n,r){var A={x:null,y:null,onLine1:!1,onLine2:!1,onBothLines:!1},i=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(0===i)return A;var o=e.y-n.y,a=e.x-n.x,s=(r.x-n.x)*o-(r.y-n.y)*a,u=(t.x-e.x)*o-(t.y-e.y)*a;return o=s/i,a=u/i,A.x=e.x+o*(t.x-e.x),A.y=e.y+o*(t.y-e.y),o>0&&o<1&&(A.onLine1=!0),a>0&&a<1&&(A.onLine2=!0),A.onBothLines=A.onLine1&&A.onLine2,A},Vt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.width,A=t.height,i=t.ctx,o=t.target,a=t.screenshotCamera,s=t.onRenderDone,u=n.markupLayer,c=e.getExtension("Autodesk.BIM360.Markups");if(c){var l=e.impl.getCanvasBoundingClientRect(),h=l.width,p=l.height,d=e.impl.glrenderer();d.pushViewport(),d.setPixelRatio(1),d.setViewport(0,0,r,A),c.renderer.onResize({width:r,height:A});var f,y,g=e.impl.is2d?a:c.renderer.markupsCamera,E=c.markupsManager.getVisibleLayers();u&&E.forEach((function(e){return e!==u&&e.setVisible(!1)}));var B=function(){u&&(f=u.isVisible(),y=u.isTransparent(),u.setVisible(!0),u.changeTransparency(!1))},m=function(){u&&(u.setVisible(f),u.changeTransparency(!y))};B(),c.renderer.render(o,g),m(),d.popViewport(),d.setPixelRatio(),c.renderer.onResize({width:h,height:p});var v=i.targetToCanvas(o),w=v.canvas,k=r/h;c.renderer.textRenderer.renderTextToCanvas(w,g,k,B,m,s),u&&E.forEach((function(e){return e!==u&&e.setVisible(!0)}))}else s(i.targetToCanvas(o).canvas)},Gt=function(e,t,n){if(e.length<=2)return e;function r(e,t,n){var r=t.x,A=t.y,i=n.x-r,o=n.y-A;if(0!==i||0!==o){var a=((e.x-r)*i+(e.y-A)*o)/(i*i+o*o);a>1?(r=n.x,A=n.y):a>0&&(r+=i*a,A+=o*a)}return(i=e.x-r)*i+(o=e.y-A)*o}function A(e,t,n,i,o){for(var a,s=i,u=t+1;u<n;u++){var c=r(e[u],e[t],e[n]);c>s&&(a=u,s=c)}s>i&&(a-t>1&&A(e,t,a,i,o),o.push(e[a]),n-a>1&&A(e,a,n,i,o))}var i=void 0!==t?t*t:1;return e=n?e:function(e,t){for(var n,r,A,i,o,a=e[0],s=[a],u=1,c=e.length;u<c;u++)A=a,void 0,void 0,(i=(r=n=e[u]).x-A.x)*i+(o=r.y-A.y)*o>t&&(s.push(n),a=n);return a!==n&&s.push(n),s}(e,i),e=function(e,t){var n=e.length-1,r=[e[0]];return A(e,0,n,t,r),r.push(e[n]),r}(e,i),e};function jt(e){var t=e.length;if(3===t)return!0;for(var n=0;n<t;n++)for(var r=e[n],A=e[(n+1)%t],i=n+2;i<t;i++){var o=e[i%t],a=e[(i+1)%t];if(a===r)break;if(Kt(r,A,o,a).onBothLines)return!1}return!0}var Yt=function(e,t){e.navigation.getRequestTransition()||e.navigation.getTransitionActive()?setTimeout((function(){e.navigation.getRequestTransition()||e.navigation.getTransitionActive()?e.addEventListener(Autodesk.Viewing.CAMERA_TRANSITION_COMPLETED,(function(){t()}),{once:!0}):t()}),1):t()},Wt=function(e,t){return e===t||!(!e||!t||e.length===t.length)&&(e.startsWith("(")?e==="(".concat(t,")"):t==="(".concat(e,")"))};function Xt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var zt=Autodesk.Viewing,Zt=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Xt(this,e),this.setGlobalManager(t.globalManager),this.markupsExtension=t,this.viewer=t.viewer,this.markup=n,this.options=r}var t,n;return t=e,n=[{key:"getEditState",value:function(){return this.markup.getEditState()}},{key:"setEditState",value:function(e,t){this.markup.setEditState(e,t,this)}},{key:"getAnchors",value:function(){return this.getEditState().anchors}},{key:"updateEditState",value:function(e){this.setEditState(this.getEditState(),e)}},{key:"updateEditStateAnchors",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getEditState().anchors;this.updateEditState({anchors:e})}},{key:"handleCompensation",value:function(){if(this.markup.layer){var e=this.markup.getAnchors();this.prevCenter||(this.prevCenter=this.markup.center.clone());var t=this.markup.center.clone().sub(this.prevCenter);e.forEach((function(e){e.sub(t)})),t.applyMatrix4(this.markup.scaleMatrix);var n=this.markup.getRotation();if(0!==n){var r=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(t,n,new THREE.Vector3,r)}t.add(this.markup.editState.translation),this.updateEditState({anchors:e,translation:t}),this.prevCenter.copy(this.markup.center)}}},{key:"submitChanges",value:function(e){var t;if(this.markup.layer){if(this.markup.belongsToGroup())return void this.submitGroupUpdate(e);t=new bt(this.markupsExtension.markupsManager,this.markup,this.getEditState())}else{var n=this.markupsExtension.markupsManager.getActiveLayer();this.markup.syncState(),t=new Bt(this.markupsExtension.markupsManager,this.markup,n)}t.isDuringEdit=e,t.execute()}},{key:"submitGroupUpdate",value:function(e){var t=this,n=this.markup.markupGroup.markups,r=this.markupsExtension.markupsManager.isActionGroupOpen();r||this.markupsExtension.markupsManager.openActionGroup(),n.forEach((function(r,A){var i=new bt(t.markupsExtension.markupsManager,r,r.getEditState());i.isDuringEdit=A<n.length-1||e,i.execute()})),r||this.markupsExtension.markupsManager.closeActionGroup()}},{key:"deleteMarkup",value:function(){new Qt(this.markupsExtension.markupsManager,this.markup).execute()}},{key:"changeStyleProperty",value:function(e,t,n){var r=lt.cloneDeep(this.getEditState());r.style[e]=t,this.updateEditState({style:Object.assign({},r.style)}),n||(this.submitChanges(!0),this.editEnd(!0))}},{key:"snapPointToAxis",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!Rt(e,t)){var A=this.markupsExtension.renderer.worldToClient(e),i=this.markupsExtension.renderer.worldToClient(t),o=A.clone().sub(i).normalize(),a=it.getSignedAngle(this.markupsExtension.renderer.absoluteUpVec,o,this.markupsExtension.renderer.getCameraEyeVector()),s=a+it.degreesToRadians(r),u=it.degreesToRadians(n),c=Math.ceil((s-it.degreesToRadians(n/2))/u)*u,l=new THREE.Vector3(0,0,-1),h=A.clone();it.applyRotation(h,c-s,i,l);var p=h.clone().sub(i).normalize(),d=A.clone().sub(i).dot(p),f=i.add(p.multiplyScalar(d));e.copy(this.markupsExtension.renderer.clientToWorld(f))}}},{key:"getSnappedPosition",value:function(){return this.markupsExtension.markupsTool.isSnappingAllowed()?this.markupsExtension.markupsTool.getSnappedPosition():this.markupsExtension.markupsTool.lastMousePos}},{key:"didMouseMove",value:function(){return this.markupsExtension.markupsTool.mouseMoved}},{key:"getTouchRadiusWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(we)}},{key:"getMinChangeDistanceWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(Ce)}},{key:"snapDistance",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(be)}},{key:"intersect",value:function(e){return null}},{key:"getCursor",value:function(){return"crosshair"}},{key:"isDragging",value:function(){return!1}},{key:"editStart",value:function(){this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_EDIT_START,markup:this.markup,handler:this})}},{key:"editEnd",value:function(e){this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_EDIT_END,markup:this.markup,isDuringEdit:e,handler:this})}},{key:"isSamePoint",value:function(e,t){return Rt(e,t,this.getMinChangeDistanceWorld())}},{key:"isSamePointClient",value:function(e,t){return Rt(e,t,Ce)}},{key:"handleDoubleClick",value:function(e,t){}},{key:"handleButtonDown",value:function(e,t){}},{key:"handleButtonUp",value:function(e,t){}},{key:"handleKeyDown",value:function(e,t){}},{key:"handleKeyUp",value:function(e,t){}},{key:"handleMouseMove",value:function(e){}},{key:"handleGesture",value:function(e){}},{key:"handleResize",value:function(){}},{key:"destroy",value:function(){this.markupsExtension=null,this.viewer=null,this.markup=null}}],n&&Jt(t.prototype,n),e}();function qt(e){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qt(e)}function $t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function en(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tn(e,t){return tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},tn(e,t)}function nn(e,t){return!t||"object"!==qt(t)&&"function"!=typeof t?rn(e):t}function rn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function An(e){return An=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},An(e)}zt.GlobalManagerMixin.call(Zt.prototype);var on=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=An(r);if(i){var n=An(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return nn(this,e)});function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $t(this,a),(t=o.call(this,e,null,n)).bounds=new THREE.Box3,t.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,t.clean.bind(rn(t))),t}return t=a,(n=[{key:"handleMouseMove",value:function(e){var t=this;return!!(this.buttonDownPoint&&this.markupsExtension.markupsTool.dragging&&this.didMouseMove())&&(this.bounds.makeEmpty(),this.bounds.expandByVector(new THREE.Vector3(0,0,1/0)),this.bounds.expandByPoint(e),this.bounds.expandByPoint(this.buttonDownPoint),this.markupsExtension.markupsManager.getEnabledMarkups().filter((function(e){return!e.isSelected()})).forEach((function(e){var n=e.getWorldBoundingBox(!0);t.bounds.intersectsBox(n)&&e.setHover(!0)})),this.markupsExtension.markupsManager.dispatchEvent({type:A.RECT_SELECTOR_UPDATED,bounds:this.bounds}),!0)}},{key:"clean",value:function(){this.buttonDownPoint=null,this.bounds.makeEmpty(),this.markupsExtension.markupsManager.dispatchEvent({type:A.RECT_SELECTOR_UPDATED,bounds:this.bounds})}},{key:"handleButtonDown",value:function(e,t){return this.clean(),this.buttonDownPoint=e,!0}},{key:"handleButtonUp",value:function(e,t){return this.selectMarkups(),this.clean(),!1}},{key:"selectMarkups",value:function(){var e=this;this.markupsExtension.markupsTool.shiftDown||this.markupsExtension.markupsManager.deselectAllMarkups(),this.markupsExtension.markupsManager.getEnabledMarkups().filter((function(e){return!e.isSelected()})).forEach((function(t){var n=t.getWorldBoundingBox(!0);e.bounds.intersectsBox(n)&&t.select()}))}}])&&en(t.prototype,n),a}(Zt);function an(e){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(e)}function sn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function un(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cn(e,t){return cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},cn(e,t)}function ln(e,t){return!t||"object"!==an(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hn(e){return hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},hn(e)}var pn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cn(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=hn(r);if(A){var n=hn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ln(this,e)});function o(){return sn(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"getCursor",value:function(){return"pointer"}},{key:"intersect",value:function(e){return this.markup.intersect(e)}},{key:"handleMouseMove",value:function(e){if(this.markupsExtension.markupsTool.dragging||Autodesk.Viewing.isMobileDevice())return!1;var t=this.markup.intersect(e);return t&&(this.markup.layer===this.markupsExtension.markupsManager.getActiveLayer()?this.markup.setHover(!0):this.markup.layer.setHover(!0)),t}},{key:"handleDoubleClick",value:function(e,t){return!this.didMouseMove()&&!!this.markup.intersect(e)&&(this.markupsExtension.markupsManager.isMarkupSessionOpen()||this.markup.layer===this.markupsExtension.markupsManager.getActiveLayer()||this.markupsExtension.markupsManager.editLayer(this.markup.layer,!1,!1,!1),this.markupsExtension.markupsTool.shiftDown||this.markupsExtension.markupsTool.ctrlDown||this.markupsExtension.markupsManager.deselectAllMarkups([this.markup]),this.markup.select(),!0)}},{key:"handleButtonDown",value:function(e,t){return!1}},{key:"handleButtonUp",value:function(e,t){return!this.didMouseMove()&&!!this.markup.intersect(e)&&(this.markupsExtension.markupsManager.deselectAllLayers([this.markup.layer]),this.markupsExtension.markupsManager.selectLayer(this.markup.layer,!1,!1),this.markupsExtension.markupsManager.isMarkupSessionOpen()&&(this.markupsExtension.markupsTool.shiftDown||this.markupsExtension.markupsTool.ctrlDown||this.markupsExtension.markupsManager.deselectAllMarkups([this.markup]),this.markup.select()),!0)}}])&&un(t.prototype,n),o}(Zt);function dn(e){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(e)}function fn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gn(e,t){return gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},gn(e,t)}function En(e,t){return!t||"object"!==dn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bn(e){return Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Bn(e)}var mn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(a,e);var t,n,r,A,i,o=(A=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Bn(A);if(i){var n=Bn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return En(this,e)});function a(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return fn(this,a),(n=o.call(this,e,t,r)).keyTranslation=new THREE.Vector3,n}return t=a,r=[{key:"hasOneGroupInEdit",value:function(e){var t=0,n=0;return e.forEach((function(e){e.isGroupMarkup()?t++:e.belongsToGroup()||n++})),1===t&&0===n}}],(n=[{key:"handleMouseMove",value:function(e){return this.translating&&this.handleMouseTranslation(e),this.translating}},{key:"handleButtonDown",value:function(e,t){return!!this.translating||(this.translating=this.intersect(e),this.translating&&(this.lastTranslationPoint=e,this.buttonDownPos=e,this.editStart()),this.translating)}},{key:"handleButtonUp",value:function(e,t){if(this.translating){var n,r=this.markupsExtension.markupsManager.getInEditMarkups();return this.markupsExtension.markupsManager.openActionGroup(),Rt(e,this.lastTranslationPoint,this.getMinChangeDistanceWorld())?(this.cancelTransformEditing(),n=!1):(r.forEach((function(e,t){e.translationHandler&&e.translationHandler.submitChanges(t<r.length-1)})),this.editEnd(),n=!0),this.markupsExtension.markupsManager.closeActionGroup(),this.translating=!1,this.lastTranslationPoint=null,n}return!1}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.translating)return this.cancelTransformEditing(),!0;break;case Autodesk.Viewing.KeyCode.UP:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraUpVector()),!0;case Autodesk.Viewing.KeyCode.DOWN:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraUpVector().negate()),!0;case Autodesk.Viewing.KeyCode.RIGHT:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraRightVector()),!0;case Autodesk.Viewing.KeyCode.LEFT:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraRightVector().negate()),!0}return!1}},{key:"handleKeyUp",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.UP:case Autodesk.Viewing.KeyCode.DOWN:case Autodesk.Viewing.KeyCode.RIGHT:case Autodesk.Viewing.KeyCode.LEFT:return this.keyTranslation.set(0,0,0),this.submitChanges(e.isDuringEdit),!0}return!1}},{key:"handleDoubleClick",value:function(e,t){return this.translating}},{key:"getCursor",value:function(){return"move"}},{key:"cancelTransformEditing",value:function(){this.markupsExtension.markupsManager.getInEditMarkups().forEach((function(e){e.syncEditState()})),this.translating=!1,this.lastTranslationPoint=null,this.editEnd()}},{key:"handleMouseTranslation",value:function(e){var t=this;this.markupsExtension.markupsTool.shiftDown&&(e=e.clone(),this.snapPointToAxis(e,this.buttonDownPos,90));var n=e.clone().sub(this.lastTranslationPoint),r=this.markupsExtension.markupsManager.getInEditMarkups();a.hasOneGroupInEdit(r)?this.handleTranslation(this.markup,n):r.forEach((function(e){t.handleTranslation(e,n)}))}},{key:"handleKeyTranslation",value:function(e){var t=e.multiplyScalar(this.markupsExtension.renderer.multiplyByNormaStrokeWidth(Qe));this.keyTranslation.add(t),this.handleTranslation(this.markup,this.keyTranslation)}},{key:"handleTranslation",value:function(e,t){if(e.translationHandler){var n=t.clone().add(e.state.translation);e.translationHandler.updateEditState({translation:n})}}},{key:"intersect",value:function(e){return this.markup.intersect(e)}},{key:"isDragging",value:function(){return this.translating}}])&&yn(t.prototype,n),r&&yn(t,r),a}(Zt);function vn(e){return vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(e)}function wn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cn(e,t){return Cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Cn(e,t)}function bn(e,t){return!t||"object"!==vn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Sn(e){return Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Sn(e)}var Tn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cn(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Sn(r);if(A){var n=Sn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return bn(this,e)});function o(){return wn(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"handleMouseMove",value:function(e){return!!this.activeAnchor&&(e=this.getSnappedPosition(),this.markup.applyInverseRotation(e),this.markup.applyInverseScaleAndTranslation(e),this.markupsExtension.markupsTool.shiftDown&&this.snapAxis(e),this.updateActiveAnchor(e),!0)}},{key:"handleButtonDown",value:function(e,t){return!!this.activeAnchor||(this.activeAnchor=this.intersect(e),this.activeAnchor&&(this.originalAnchor=this.activeAnchor.clone(),this.editStart()),!!this.activeAnchor)}},{key:"handleButtonUp",value:function(e,t){return!!this.activeAnchor&&(e=this.getSnappedPosition(),this.markup.applyInverseRotation(e),this.markup.applyInverseScaleAndTranslation(e),this.markupsExtension.markupsTool.shiftDown&&this.snapAxis(e),this.updateActiveAnchor(e),Rt(this.activeAnchor,this.originalAnchor,this.getMinChangeDistanceWorld())?this.cancelAnchorEditing():(this.submitChanges(),this.editEnd()),this.activeAnchor=null,!0)}},{key:"handleKeyDown",value:function(e,t){if(this.activeAnchor)switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return this.cancelAnchorEditing(),!0}return!1}},{key:"handleKeyUp",value:function(e,t){}},{key:"handleDoubleClick",value:function(e,t){}},{key:"updateActiveAnchor",value:function(e){this.activeAnchor.copy(e),this.updateEditStateAnchors(),this.handleCompensation()}},{key:"cancelAnchorEditing",value:function(){this.activeAnchor=null,this.markup.syncEditState(),this.updateEditStateAnchors(),this.editEnd()}},{key:"isDragging",value:function(){return!!this.activeAnchor}},{key:"snapAxis",value:function(e){var t=this,n=this.markup.getAnchors(),r=n.findIndex((function(e){return e===t.activeAnchor}));n[r-1]?this.snapPointToAxis(e,n[r-1],Me):n[r+1]&&this.snapPointToAxis(e,n[r+1],Me)}},{key:"intersect",value:function(e){var t=this;e=e.clone(),this.markup.applyInverseRotation(e),this.markup.applyInverseScaleAndTranslation(e);var n=this.markupsExtension.renderer.worldToClient(e);return this.markup.getAnchors().find((function(e){if(t.markup.isAnchorHandlingAllowed(e))return t.markupsExtension.renderer.worldToClient(e).distanceTo(n)<=we}))}},{key:"getCursor",value:function(){return this.activeAnchor?"grabbing":"grab"}}])&&kn(t.prototype,n),o}(Zt);function xn(e){return xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xn(e)}function Mn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Un(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qn(e,t){return Qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Qn(e,t)}function Ln(e,t){return!t||"object"!==xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fn(e){return Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Fn(e)}var Rn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qn(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Fn(r);if(A){var n=Fn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ln(this,e)});function o(){return Mn(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"handleMouseMove",value:function(e){return this.rotating&&this.handleRotation(e),this.rotating}},{key:"handleButtonDown",value:function(e,t){return this.rotating||(this.rotating=this.intersect(e),this.rotating&&(this.originalRotation=this.markup.getRotation(),this.handleRotation(e),this.editStart())),this.rotating}},{key:"handleButtonUp",value:function(e,t){return!!this.rotating&&(this.rotating=!1,Math.abs(this.originalRotation-this.markup.getRotation())<Te?this.cancelTransformEditing():(this.submitChanges(),this.editEnd()),this.originalRotation=null,!0)}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.rotating)return this.cancelTransformEditing(),!0}return!1}},{key:"handleKeyUp",value:function(e,t){return!1}},{key:"handleDoubleClick",value:function(e,t){return this.rotating}},{key:"getCursor",value:function(){return"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjAgMCAyMCAyMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4gICAgICAgIDx0aXRsZT5tb3VzZSBjdXJzb3Ivcm90YXRlPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxkZWZzPiAgICAgICAgPHBhdGggZD0iTTMsOCBMMSw4IEw0LDQgTDcsOCBMNSw4IEM1LDEwLjQ4NTI4MTQgNy41MTQ3MTg2MywxMyAxMCwxMyBDMTIuNDg1MjgxNCwxMyAxNSwxMC40ODUyODE0IDE1LDggTDEzLDggTDE2LDQgTDE5LDggTDE3LDggQzE3LDExLjU4OTg1MDkgMTMuNTg5ODUwOSwxNSAxMCwxNSBDNi40MTAxNDkxMywxNSAzLDExLjU4OTg1MDkgMyw4IFoiIGlkPSJwYXRoLTEiPjwvcGF0aD4gICAgICAgIDxmaWx0ZXIgeD0iLTMzLjMlIiB5PSItNjkuNyUiIHdpZHRoPSIxNjYuNyUiIGhlaWdodD0iMTk3LjAlIiBmaWx0ZXJVbml0cz0ib2JqZWN0Qm91bmRpbmdCb3giIGlkPSJmaWx0ZXItMiI+ICAgICAgICAgICAgPGZlTW9ycGhvbG9neSByYWRpdXM9IjEiIG9wZXJhdG9yPSJkaWxhdGUiIGluPSJTb3VyY2VBbHBoYSIgcmVzdWx0PSJzaGFkb3dTcHJlYWRPdXRlcjEiPjwvZmVNb3JwaG9sb2d5PiAgICAgICAgICAgIDxmZU9mZnNldCBkeD0iMCIgZHk9Ii0yIiBpbj0ic2hhZG93U3ByZWFkT3V0ZXIxIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMSI+PC9mZU9mZnNldD4gICAgICAgICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxIiBpbj0ic2hhZG93T2Zmc2V0T3V0ZXIxIiByZXN1bHQ9InNoYWRvd0JsdXJPdXRlcjEiPjwvZmVHYXVzc2lhbkJsdXI+ICAgICAgICAgICAgPGZlQ29tcG9zaXRlIGluPSJzaGFkb3dCbHVyT3V0ZXIxIiBpbjI9IlNvdXJjZUFscGhhIiBvcGVyYXRvcj0ib3V0IiByZXN1bHQ9InNoYWRvd0JsdXJPdXRlcjEiPjwvZmVDb21wb3NpdGU+ICAgICAgICAgICAgPGZlQ29sb3JNYXRyaXggdmFsdWVzPSIwIDAgMCAwIDAgICAwIDAgMCAwIDAgICAwIDAgMCAwIDAgIDAgMCAwIDAuNSAwIiB0eXBlPSJtYXRyaXgiIGluPSJzaGFkb3dCbHVyT3V0ZXIxIj48L2ZlQ29sb3JNYXRyaXg+ICAgICAgICA8L2ZpbHRlcj4gICAgPC9kZWZzPiAgICA8ZyBpZD0ibW91c2UtY3Vyc29yL3JvdGF0ZSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+ICAgICAgICA8ZyBpZD0iQ29tYmluZWQtU2hhcGUiIGZpbGwtcnVsZT0ibm9uemVybyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuMDAwMDAwLCA5LjUwMDAwMCkgcm90YXRlKC0xODAuMDAwMDAwKSB0cmFuc2xhdGUoLTEwLjAwMDAwMCwgLTkuNTAwMDAwKSAiPiAgICAgICAgICAgIDx1c2UgZmlsbD0iYmxhY2siIGZpbGwtb3BhY2l0eT0iMSIgZmlsdGVyPSJ1cmwoI2ZpbHRlci0yKSIgeGxpbms6aHJlZj0iI3BhdGgtMSI+PC91c2U+ICAgICAgICAgICAgPHBhdGggc3Ryb2tlPSIjRkZGRkZGIiBzdHJva2Utd2lkdGg9IjEiIGQ9Ik0yLjUyMDExNDgzLDguNSBMMy40MjUyNjAwOGUtMTIsOC41IEw0LDMuMTY2NjY2NjcgTDgsOC41IEw1LjUzODA0MjA3LDguNSBDNS44NDQ5MzkyOCwxMC41NDE1MjMyIDcuOTU3NDAyMDYsMTIuNSAxMCwxMi41IEMxMi4wNDI1OTc5LDEyLjUgMTQuMTU1MDYwNywxMC41NDE1MjMyIDE0LjQ2MTk1NzksOC41IEwxMiw4LjUgTDE2LDMuMTY2NjY2NjcgTDIwLDguNSBMMTcuNDc5ODg1Miw4LjUgQzE3LjE4NTI0NywxMi4xNzM1MTU3IDEzLjY5ODgwMSwxNS41IDEwLDE1LjUgQzYuMzAxMTk5MDIsMTUuNSAyLjgxNDc1MzAzLDEyLjE3MzUxNTcgMi41MjAxMTQ4Myw4LjUgWiIgZmlsbD0iIzAwMDAwMCIgZmlsbC1ydWxlPSJldmVub2RkIj48L3BhdGg+ICAgICAgICA8L2c+ICAgIDwvZz48L3N2Zz4=) 10 10, auto"}},{key:"cancelTransformEditing",value:function(){this.markup.syncEditState(),this.rotating=!1,this.editEnd()}},{key:"handleRotation",value:function(e){var t=this.markupsExtension.renderer.worldToClient(e),n=this.markup.getClientCenter(),r=t.clone().sub(n).normalize(),A=it.getSignedAngle(r,this.markupsExtension.renderer.getCameraUpVector(),this.markupsExtension.renderer.getCameraEyeVector());if(this.markupsExtension.markupsTool.shiftDown){var i=it.degreesToRadians(Me);A=Math.ceil((A-it.degreesToRadians(Me/2))/i)*i}this.updateEditState({rotation:A})}},{key:"getRotationAnchor",value:function(){var e=this.markup.getClientBoundingBox(!0),t=e.getCenter(new THREE.Vector3).add(new THREE.Vector3(0,xe+e.getSize(new THREE.Vector3).y/2,0)),n=e.getCenter(new THREE.Vector3),r=this.markup.getRotation()+this.markupsExtension.renderer.getCameraRotation();return it.applyRotation(t,r,n,this.markupsExtension.renderer.absoluteEyeVec),t}},{key:"intersect",value:function(e){e=e.clone();var t=this.markupsExtension.renderer.worldToClient(e);return this.getRotationAnchor().distanceTo(t)<=we}},{key:"isDragging",value:function(){return this.rotating}}])&&Un(t.prototype,n),o}(Zt);function Hn(e){return Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hn(e)}function _n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function In(e,t){return In=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},In(e,t)}function On(e,t){return!t||"object"!==Hn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pn(e){return Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pn(e)}var Nn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&In(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pn(r);if(A){var n=Pn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return On(this,e)});function o(){return _n(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"handleMouseMove",value:function(e){if(this.scaling){var t=e.clone();this.markup.applyInverseRotation(t),this.markup.applyInverseCameraRotation(t),this.handleScaling(t)}return this.scaling}},{key:"handleButtonDown",value:function(e,t){return this.scaling||(this.scaleAnchor=this.intersect(e),this.scaling=!!this.scaleAnchor,this.scaling&&(this.originalPoint=e.clone(),this.editStart())),this.scaling}},{key:"handleButtonUp",value:function(e,t){return!!this.scaling&&(this.scaleAnchor=null,this.scaling=!1,this.isSamePoint(e,this.originalPoint)?this.cancelTransformEditing():(this.submitChanges(),this.editEnd()),!0)}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.scaling)return this.cancelTransformEditing(),!0}return!1}},{key:"handleDoubleClick",value:function(e,t){return this.scaling}},{key:"getCursor",value:function(){if(this.cursor&&this.scaling)return this.cursor;var e=this.markup.getClientCenter(),t=this.lastIntersectPoint.clone().sub(e).normalize(),n=new THREE.Vector3(1,0,0),r=this.lastIntersectPoint.y<e.y?1:-1,A=it.radiansToDegrees(t.angleTo(n))*r,i=45*Math.ceil((A-22.5)/45);switch(this.cursor=null,i){case 180:case-180:case 0:this.cursor="ew-resize";break;case 90:case-90:this.cursor="ns-resize";break;case 135:case-45:this.cursor="nwse-resize";break;case-135:case 45:this.cursor="nesw-resize"}return this.cursor}},{key:"cancelTransformEditing",value:function(){this.markup.syncEditState(),this.scaleAnchor=null,this.scaling=!1,this.editEnd()}},{key:"handleScaling",value:function(e){var t=this,n=this.markupsExtension.renderer.worldToClient(e);this.originalBoundingBox=it.swapBoundingBoxY(this.markup.getWorldBoundingBox().clone()),this.scaleAnchor.axisList.forEach((function(e){var r=t.getAnchorPosByAxisList([e],!1),A=n.clone().sub(e.clone().multiplyScalar(t.markup.getMarginSize()));t.resize(A,r,e)})),this.updateTranslation()}},{key:"updateTranslation",value:function(){var e=this.scaleAnchor.axisList.reduce((function(e,t){return e.clone().add(t)})),t=it.swapBoundingBoxY(this.markup.getWorldBoundingBox().clone()).getSize(new THREE.Vector3).sub(this.originalBoundingBox.getSize(new THREE.Vector3)).multiply(e).multiplyScalar(.5),n=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(t,this.markup.getRotation(),new THREE.Vector3,n);var r=t.add(this.markup.editState.translation);this.updateEditState({translation:r}),this.originalBoundingBox=it.swapBoundingBoxY(this.markup.getWorldBoundingBox().clone())}},{key:"resize",value:function(e,t,n,r){var A=t.clone().add(n),i=_t(e,t,A),o=this.markup.getClientBoundingBox(!1),a=this.getOppositePoint(t,o),s=i.clone().sub(a),u=n.clone().multiply(s),c=o.getSize(new THREE.Vector3).multiply(n).length(),l=s.length();if(r||!(l<this.markup.getMinimumSize())){if(!r&&u.x+u.y<0){var h=a.clone().add(n);return this.resize(h,t,n,!0),this.updateTranslation(),n.negate(),this.applyReflection(n),void this.resize(e,h,n,!0)}var p=l/c-1,d=(this.markupsExtension.markupsTool.shiftDown?new THREE.Vector3(1,1,0):new THREE.Vector3(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))).clone().multiplyScalar(p).addScalar(1).clone().multiply(this.markup.editState.scale);this.updateEditState({scale:d})}}},{key:"intersect",value:function(e){var t=this.getScaleAnchors(),n=e.clone();this.markup.applyInverseRotation(n),this.markup.applyInverseCameraRotation(n);var r=this.markupsExtension.renderer.worldToClient(n);return this.lastIntersectPoint=r,t.find((function(e){return e.pos.distanceTo(r)<=we}))}},{key:"isDragging",value:function(){return this.scaling}},{key:"getOppositePoint",value:function(e,t){var n=t.getCenter(new THREE.Vector3),r=e.clone().distanceTo(n),A=e.clone().sub(n).normalize();return e.clone().sub(A.multiplyScalar(2*r))}},{key:"applyReflection",value:function(e){var t=new THREE.Vector3(1,1,1).sub(e.clone().multiply(e).multiplyScalar(2)),n=this.markup.editState.scale.clone();n.multiply(t),this.updateEditState({scale:n})}},{key:"getScaleAnchors",value:function(){return this.getEditState().anchors.length<2?[]:this.options.onlyHorizontal?[this.getEastAnchor(),this.getWestAnchor()]:[this.getEastAnchor(),this.getWestAnchor(),this.getNorthAnchor(),this.getSouthAnchor(),this.getNorthWestAnchor(),this.getSouthWestAnchor(),this.getNorthEastAnchor(),this.getSouthEastAnchor()]}},{key:"getAnchorPosByAxisList",value:function(e,t){var n=this.markup.getClientBoundingBox(t),r=n.getCenter(new THREE.Vector3),A=new THREE.Vector3;return e.forEach((function(e){var t=e.clone().multiply(n.getSize(A).multiplyScalar(.5));r.add(t)})),r}},{key:"getAnchor",value:function(e,t){return{pos:this.getAnchorPosByAxisList(e,!this.markup.belongsToGroup()),axisList:e,id:t}}},{key:"getNorthAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,1,0)],"n")}},{key:"getSouthAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,-1,0)],"s")}},{key:"getEastAnchor",value:function(){return this.getAnchor([new THREE.Vector3(1,0,0)],"e")}},{key:"getWestAnchor",value:function(){return this.getAnchor([new THREE.Vector3(-1,0,0)],"w")}},{key:"getNorthWestAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,1,0),new THREE.Vector3(-1,0,0)],"nw")}},{key:"getSouthWestAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,-1,0),new THREE.Vector3(-1,0,0)],"sw")}},{key:"getNorthEastAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0)],"ne")}},{key:"getSouthEastAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,-1,0),new THREE.Vector3(1,0,0)],"se")}}])&&Dn(t.prototype,n),o}(Zt);function Kn(e){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(e)}function Vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gn(e,t){return Gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Gn(e,t)}function jn(e,t){return!t||"object"!==Kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yn(e){return Yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Yn(e)}var Wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gn(e,t)}(o,Autodesk.Viewing.EventDispatcher);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Yn(r);if(A){var n=Yn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return jn(this,e)});function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).undoStack=[],e.redoStack=[],e.isGroupOpen=!1,e.nextActionId=0,e}return t=o,n=[{key:"execute",value:function(e){this.clearStack(this.redoStack),e.id=this.nextActionId,this.nextActionId+=1,e.redo(),this.isGroupOpen?this.group.push(e):this.undoStack.push(e),e.trigger=o.EXECUTE,this.notify(e)}},{key:"undo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!==this.undoStack.length)if(this.isGroupOpen)console.warn("Cannot undo while action group is open!");else{var t=this.undoStack.pop();if(e&&this.redoStack.push(t),t instanceof pt)t.undo();else for(var n=t.length-1;n>=0;n--)t[n].undo();t.trigger=o.UNDO,this.notify(t)}}},{key:"redo",value:function(){if(0!==this.redoStack.length)if(this.isGroupOpen)console.warn("Cannot redo while action group is open!");else{var e=this.redoStack.pop();if(this.undoStack.push(e),e instanceof pt)e.redo();else for(var t=0;t<e.length;t++)e[t].redo();e.trigger=o.REDO,this.notify(e)}}},{key:"clear",value:function(){this.clearStack(this.undoStack),this.clearStack(this.redoStack),this.isGroupOpen=!1,this.group=[],this.notify([])}},{key:"clearStack",value:function(e){e.splice(0,e.length)}},{key:"isUndoStackEmpty",value:function(){return 0===this.undoStack.length}},{key:"isRedoStackEmpty",value:function(){return 0===this.redoStack.length}},{key:"notify",value:function(e){e=e instanceof pt?[e]:e,this.dispatchEvent({type:o.HISTORY_CHANGED_EVENT,actionGroup:e,hasUndo:!this.isUndoStackEmpty(),hasRedo:!this.isRedoStackEmpty()})}},{key:"openActionGroup",value:function(){this.isGroupOpen?console.warn("Cannot open a new action group while another one is still open"):(this.group=[],this.undoStack.push(this.group),this.isGroupOpen=!0)}},{key:"closeActionGroup",value:function(){0===this.group.length&&this.undoStack.pop(),this.isGroupOpen=!1}}],n&&Vn(t.prototype,n),o}();Wn.HISTORY_CHANGED_EVENT="action-manager.history.changed.event",Wn.UNDO="action-manager.undo",Wn.REDO="action-manager.redo",Wn.EXECUTE="action-manager.execute";var Xn=n(39921),Jn=n.n(Xn);function zn(e){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zn(e)}function Zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qn(e,t){return qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},qn(e,t)}function $n(e,t){return!t||"object"!==zn(t)&&"function"!=typeof t?er(e):t}function er(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tr(e){return tr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},tr(e)}n(35867);var nr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qn(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=tr(r);if(i){var n=tr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return $n(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e,t,n)).textboxActive=!1,r.submitChangesDebounced=lt.debounce(r.options.submitChanges||r.submitChanges,Ne),Autodesk.Viewing.isIOSDevice()&&(r.onMarkupEditEnabledBinded=r.onMarkupEditEnabled.bind(er(r)),r.onMarkupEditDisabledBinded=r.onMarkupEditDisabled.bind(er(r)),r.onMarkupEditStartBinded=r.onMarkupEditStart.bind(er(r)),r.onMarkupEditEndBinded=r.onMarkupEditEnd.bind(er(r)),r.onTouchEndBinded=r.onTouchEnd.bind(er(r)),r.markupsExtension.markupsManager.addEventListener(A.MARKUP_ENABLE_EDIT,r.onMarkupEditEnabledBinded),r.markupsExtension.markupsManager.addEventListener(A.MARKUP_DISABLE_EDIT,r.onMarkupEditDisabledBinded)),r}return t=a,n=[{key:"intersect",value:function(e){if(!this.markup.isTextMarkup())return!1;e=e.clone(),this.markup.applyInverseRotation(e),this.markup.applyInverseCameraRotation(e);var t=this.markupsExtension.renderer.worldToClient(e);return this.markup.getClientBoundingBox(!0).containsPoint(t)}},{key:"updateCaretPosition",value:function(){var e=this.markupsExtension.renderer.textRenderer.getLabel(this.markup),t=this.getUpdatedCaretPosition(e);0===t.start&&0===t.end||(this.lastCaretPosition=t)}},{key:"getCursor",value:function(){return"pointer"}},{key:"handleDoubleClick",value:function(e,t){if(Autodesk.Viewing.isIOSDevice())return!1;if(this.intersect(e)){var n=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);return this.lastCaretPosition={start:n.innerText.length,end:n.innerText.length},this.startTextEditing(),!0}return!1}},{key:"handleButtonDown",value:function(e){return this.textboxActive?(this.submitChangesDebounced.flush(),this.endTextEditing(),!0):this.isEmpty()}},{key:"handleButtonUp",value:function(e){return!!this.isEmpty()&&(this.onEmptyTextMarkup(),!0)}},{key:"isEmpty",value:function(){return""===this.markup.editState.text.trim()}},{key:"onEmptyTextMarkup",value:function(){this.options.onEmptyTextMarkup?(this.textboxActive=!1,this.options.onEmptyTextMarkup()):this.deleteEmptyTextMarkup()}},{key:"deleteEmptyTextMarkup",value:function(){this.textboxActive=!1,this.markupsExtension.markupsManager.actionManager.undo(),this.markupsExtension.markupsManager.deleteMarkup(this.markup)}},{key:"onCameraChanged",value:function(e){this.markupsExtension.renderer.textRenderer.getLabel(this.markup).focus()}},{key:"startTextEditing",value:function(e){var t=this,n=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);if(this.label=n,n){this.textboxActive=!0,n.style.position="fixed",n.setAttribute("contenteditable",!0),n.style.webkitUserSelect="text",n.style.userSelect="text",n.style.pointerEvents="auto",n.setAttribute("spellcheck",!1),this.setCaretPosition(n),n.blur(),n.focus();var r=this.getDocument();e&&r.execCommand("selectAll",!1,null),this.onCameraChanged=function(){n.focus()};var i=Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIOSDevice();this.onCameraChangedDebounced=lt.debounce(this.onCameraChanged,5),i&&this.markupsExtension.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedDebounced),this.onKeyDown=function(e){n.focus();var r=n.getBoundingClientRect(),A=t.markupsExtension.viewer.impl.getCanvasBoundingClientRect(),o=t.markup.getTextStyle(),a=It("AA",o),s=t.markupsExtension.renderer.getFontToWorldScale(),u=t.markupsExtension.renderer.sizeFromWorldToClient(s),c=function(){return r.bottom+a.height*u>A.bottom-30},l=t.getWindow();switch(e.keyCode){case Autodesk.Viewing.KeyCode.ESCAPE:t.submitChangesDebounced.flush(),t.endTextEditing(),t.textboxActive=!0;break;case Autodesk.Viewing.KeyCode.ENTER:i&&c()||t.options.singleLine?e.preventDefault():l.getSelection().anchorNode.firstChild&&"BR"===l.getSelection().anchorNode.firstChild.tagName||0===l.getSelection().anchorOffset?(e.preventDefault(),Autodesk.Viewing.isIE11&&(t.enterPressed=!0)):t.enterPressed=!0;break;case Autodesk.Viewing.KeyCode.BACKSPACE:t.backspacePressed=!0;break;default:i&&(function(){var e=t.getUpdatedCaretPosition(n),i=t.getWindow().getSelection().anchorNode.parentElement;i.value=i.innerText;var o=Jn()(i,e.end);return r.left+(o.left+a.width*u)>A.right-30}()?c()||t.options.singleLine?e.preventDefault():r.right<A.right?t.addNewline=!0:e.preventDefault():c()&&e.preventDefault())}var h=t.lastCaretPosition.end-t.lastCaretPosition.start;!e.metaKey&&e.keyCode>47&&n.innerText.length-h>Xe&&e.preventDefault(),Autodesk.Viewing.isIE11&&t.onInput(!0)},this.onKeyUp=function(){t.onInput(!0)},this.onInput=function(e){n.innerText||(n.innerText=Autodesk.Viewing.isIE11?" ":String.fromCharCode(10)),t.lastCaretPosition=t.getUpdatedCaretPosition(n);var r=n.innerText;t.addNewline&&(r+="\r\n"),Autodesk.Viewing.isIE11&&!0===e&&(r=r.replace(/(\r\n){2,}/g,"\r\n"),t.enterPressed&&(r+="\r\n\r\n")),t.options.singleLine||t.expandBoundingBox(r),t.updateEditState({text:r}),t.submitChangesDebounced(),t.enterPressed=!1,t.addNewline=!1,t.backspacePressed=!1},this.onPaste=function(e){e.preventDefault();var r=t.getWindow(),A=t.getDocument(),i=e.clipboardData&&e.clipboardData.getData("text")||r.clipboardData&&r.clipboardData.getData&&r.clipboardData.getData("Text");if(i){var o=t.lastCaretPosition.end-t.lastCaretPosition.start,a=Xe+o-n.innerText.length;if(i.length>a&&(i=i.substr(0,a)+"…"),Autodesk.Viewing.isIE11){var s=r.getSelection(),u=s.getRangeAt(0),c=A.createDocumentFragment();c.appendChild(A.createElement("br"));var l=A.createElement("span");l.innerText=i,c.appendChild(l),u.insertNode(c),u.selectNodeContents(l),s.removeAllRanges(),s.addRange(u),A.execCommand("ms-endUndoUnit",!1,null)}else A.execCommand("insertText",!1,i)}},this.onMouseWheel=function(e){var n=new MouseEvent(e.type,e);n.wheelDelta=e.wheelDelta,n.deltaY=e.deltaY,t.markupsExtension.viewer.toolController.domElement.dispatchEvent(n),n.defaultPrevented&&e.preventDefault()},this.onDOMMouseScroll=function(e){var n=new MouseEvent(e.type,e);n.wheelDelta=e.wheelDelta,n.deltaY=e.deltaY,t.markupsExtension.viewer.toolController.domElement.dispatchEvent(n),n.defaultPrevented&&e.preventDefault()},this.onMouseMove=function(e){var n=new MouseEvent(e.type,e);t.markupsExtension.viewer.toolController.domElement.dispatchEvent(n),n.defaultPrevented&&e.preventDefault()},n.addEventListener("keydown",this.onKeyDown),n.addEventListener("keypress",this.onKeyPress),n.addEventListener("input",this.onInput),n.addEventListener("paste",this.onPaste),Autodesk.Viewing.isIE11&&n.addEventListener("keyup",this.onKeyUp),n.addEventListener("mousewheel",this.onMouseWheel),n.addEventListener("DOMMouseScroll",this.onDOMMouseScroll),n.addEventListener("mousemove",this.onMouseMove),n.addEventListener("mouseup",(function(){setTimeout((function(){t.lastCaretPosition=t.getUpdatedCaretPosition(n)}),25)})),n.addEventListener("touchend",(function(){setTimeout((function(){t.lastCaretPosition=t.getUpdatedCaretPosition(n)}),25)})),this.onHistoryChangedBinded=this.onHistoryChanged.bind(this),this.endTextEditingBinded=this.endTextEditing.bind(this),this.onStyleChangedBinded=this.onStyleChanged.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DISABLE_EDIT,this.endTextEditingBinded,{once:!0}),this.markupsExtension.markupsManager.addEventListener(Wn.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_STYLE_PROPERTY_CHANGED,this.onStyleChangedBinded),this.markupsExtension.markupsManager.dispatchEvent({type:A.TEXT_EDITING_STARTED})}}},{key:"removeSelection",value:function(){this.getWindow().getSelection().removeAllRanges(),this.label.style.position="absolute",this.label.style.pointerEvents="none",this.label.setAttribute("contenteditable",!1),this.label.style.webkitUserSelect="none",this.label.style.userSelect="none"}},{key:"setCaretPosition",value:function(e){this.lastCaretPosition||(this.lastCaretPosition={start:0,end:e.innerText.length});var t=this.getWindow(),n=this.getDocument().createRange(),r=t.getSelection(),A=Math.min(this.lastCaretPosition.start,e.childNodes[0].length),i=Math.min(this.lastCaretPosition.end,e.childNodes[0].length);n.setStart(e.childNodes[0],A),n.setEnd(e.childNodes[0],i),r.removeAllRanges(),r.addRange(n)}},{key:"getUpdatedCaretPosition",value:function(e){var t,n,r={start:0,end:0},A=this.getWindow();return A.getSelection?(t=A.getSelection()).rangeCount&&((n=t.getRangeAt(0)).commonAncestorContainer.parentNode===e||n.commonAncestorContainer.parentNode.parentNode===e)&&(r={start:n.startOffset,end:n.endOffset}):r={start:e.innerText.length,end:e.innerText.length},r}},{key:"onHistoryChanged",value:function(e){var t=this;e.actionGroup.forEach((function(e){e.trigger!==Wn.UNDO&&e.trigger!==Wn.REDO||t.markupsExtension.renderer&&t.markupsExtension.renderer.textRenderer.getLabel(t.markup)&&t.endTextEditing()}))}},{key:"endTextEditing",value:function(){if(this.textboxActive&&this.markupsExtension.renderer){var e=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("input",this.onInput),e.removeEventListener("paste",this.onPaste),Autodesk.Viewing.isIE11&&e.removeEventListener("keyup",this.onKeyUp),e.removeEventListener("mousewheel",this.onMouseWheel),e.removeEventListener("DOMMouseScroll",this.onDOMMouseScroll),e.removeEventListener("mousemove",this.onMouseMove),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DISABLE_EDIT,this.endTextEditingBinded),this.markupsExtension.markupsManager.removeEventListener(Wn.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_STYLE_PROPERTY_CHANGED,this.onStyleChangedBinded),this.markupsExtension.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedDebounced),this.getWindow().getSelection().removeAllRanges(),e.style.position="absolute",e.style.pointerEvents="none",e.blur(),e.setAttribute("contenteditable",!1),e.style.webkitUserSelect="none",e.style.userSelect="none",this.textboxActive=!1,this.isEmpty()?this.onEmptyTextMarkup():(this.markup.syncEditState(),this.editEnd()),this.markupsExtension.markupsManager.dispatchEvent({type:A.TEXT_EDITING_ENDED})}}},{key:"onStyleChanged",value:function(){this.textboxActive&&this.onCameraChanged()}},{key:"handleKeyDown",value:function(e,t){return!(!this.textboxActive||e.keyCode!==Autodesk.Viewing.KeyCode.ESCAPE||(this.isEmpty()&&this.onEmptyTextMarkup(),this.textboxActive=!1,0))}},{key:"expandBoundingBox",value:function(e){var t=this.getEditState(),n=t.translation,r=t.scale,A=this.markup.getTextStyle(),i=this.markup.getWorldBoundingBoxTextOnly().getSize(new THREE.Vector3),o=this.markupsExtension.renderer.getFontToWorldScale(),a=this.markup.getTextWidthInFontScale().width;A.width="".concat(a,"px");var s=It(this.markup.editState.text,A),u=It(e,A);if((this.enterPressed||this.backspacePressed||this.addNewline)&&u.height!==s.height){var c=(u.height-s.height)*o;this.translateBoundingBox(c)}else if(u.height>s.height){A.width=null;var l=It("A",A).width*o;r.multiply(new THREE.Vector3((i.x+l)/i.x,1,1));var h=this.markup.getRotation(),p=new THREE.Vector3(l/2,0,0);if(0!==h){var d=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(p,h,new THREE.Vector3,d)}n.add(p),this.updateEditState({scale:r,translation:n})}}},{key:"translateBoundingBox",value:function(e){var t=this.getEditState().translation,n=this.markup.getBoundingBoxVerticalTranslation(e);t.add(n),this.updateEditState({translation:t})}},{key:"destroy",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_ENABLE_EDIT,this.onMarkupEditStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_END,this.onMarkupEditEndBinded)}},{key:"onMarkupEditEnabled",value:function(e){var t=this;e.markup===this.markup&&(this.markupsExtension.markupsManager.hasEventListener(A.MARKUP_EDIT_START,this.onMarkupEditStartBinded)||this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_START,this.onMarkupEditStartBinded),this.markupsExtension.markupsManager.hasEventListener(A.MARKUP_EDIT_END,this.onMarkupEditEndBinded)||this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_END,this.onMarkupEditEndBinded),setTimeout((function(){var e=t.markupsExtension.renderer.textRenderer.getLabel(t.markup);e&&(e.addEventListener("touchend",t.onTouchEndBinded),e.style.pointerEvents="auto")}),10))}},{key:"onTouchEnd",value:function(e){e.preventDefault(),e.stopPropagation(),this.startTextEditing()}},{key:"onMarkupEditDisabled",value:function(e){if(e.markup===this.markup){var t=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);t&&(t.removeEventListener("touchend",this.onTouchEndBinded),t.style.pointerEvents="none")}}},{key:"onMarkupEditStart",value:function(e){this.textboxActive&&(this.textboxWasActive=!0),e.markup===this.markup&&e.handler instanceof Rn&&this.removeSelection()}},{key:"onMarkupEditEnd",value:function(e){e.handler instanceof a||e.markup===this.markup&&this.textboxWasActive&&e.handler instanceof Rn&&(this.textboxWasActive=!1,this.startTextEditing())}}],n&&Zn(t.prototype,n),a}(Zt);function rr(e){return rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rr(e)}function Ar(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ir(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function or(e,t){return or=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},or(e,t)}function ar(e,t){return!t||"object"!==rr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sr(e){return sr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},sr(e)}var ur=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&or(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=sr(r);if(A){var n=sr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ar(this,e)});function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Ar(this,o),i.call(this,e,t,n)}return t=o,(n=[{key:"handleMouseMove",value:function(e){return this.translating&&this.handleMouseTranslation(e),this.translating}},{key:"handleButtonDown",value:function(e,t){if(!this.translating){if(this.translating=this.intersect(e),this.translating){var n=this.markup.getAnchors(),r=n[1].clone().sub(n[0]).normalize(),A=this.markupsExtension.renderer.getCameraEyeVector();this.normal=r.clone().cross(A).normalize(),this.editStart()}return this.translating}return!0}},{key:"getPointOnNormal",value:function(e){var t=this.markup.getAnchors(),n=t[0].clone().add(this.normal);return _t(e,t[0],n)}},{key:"handleButtonUp",value:function(e,t){if(this.translating){var n=this.getPointOnNormal(e);return Rt(n,this.lastTranslationPoint,this.getMinChangeDistanceWorld())?this.cancelTransformEditing():this.lastTranslationPoint&&(this.submitChanges(),this.editEnd()),this.translating=!1,this.lastTranslationPoint=null,!0}return!1}},{key:"handleDoubleClick",value:function(e,t){return this.translating}},{key:"getCursor",value:function(){return"move"}},{key:"cancelTransformEditing",value:function(){this.markup.syncEditState(),this.translating=!1,this.lastTranslationPoint=null,this.editEnd()}},{key:"handleMouseTranslation",value:function(e){var t=this.getPointOnNormal(e);this.lastTranslationPoint||(this.lastTranslationPoint=t);var n=t.clone().sub(this.lastTranslationPoint).clone().add(this.markup.state.translation);this.updateEditState({translation:n})}},{key:"intersect",value:function(e){e=e.clone(),this.markup.applyInverseRotation(e);var t=this.markupsExtension.renderer.worldToClient(e);return this.markup.getClientBoundingBox(!0).containsPoint(t)}},{key:"isDragging",value:function(){return this.translating}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.translating)return this.cancelTransformEditing(),!0}return!1}}])&&ir(t.prototype,n),o}(Zt);function cr(e){return cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cr(e)}function lr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pr(e,t){return pr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},pr(e,t)}function dr(e,t){return!t||"object"!==cr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fr(e){return fr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fr(e)}var yr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pr(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=fr(r);if(i){var n=fr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return dr(this,e)});function a(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return lr(this,a),(n=o.call(this,e,t,r)).onCreationStartCB=r.onCreationStart,n.onCreationEndCB=r.onCreationEnd,n}return t=a,(n=[{key:"creationStart",value:function(){this.creationStarted=!0,this.onCreationStartCB?this.onCreationStartCB():(this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DRAWING_START,markup:this.markup}),this.markupsExtension.markupsManager.deselectAllMarkups(),this.markupsExtension.markupsManager.deselectAllLinks(),this.editStart())}},{key:"fixInitialRotation",value:function(){var e,t=this;(this.markup.rotationHandler||this.markup.options.rotationNotAllowed)&&(e=t.markupsExtension.renderer.getCameraRotation(),Math.abs(e)>ve&&function(){for(var n=t.markupsExtension.renderer.getCameraEyeVector(),r=t.markupsExtension.markupsManager.actionManager;!r.isUndoStackEmpty();){var A=r.undoStack[r.undoStack.length-1];if(Array.isArray(A)&&(A=A[A.length-1]),A.markup!==t.markup)break;t.getEditState().anchors.forEach((function(r){it.applyRotation(r,e,t.markup.getWorldCenter(),n)})),t.prevCenter=t.markup.center.clone(),t.markup.setLocked(!0),t.updateEditStateAnchors(),t.updateEditState({rotation:-e}),t.markup.setLocked(!1),t.handleCompensation();var i=lt.cloneDeep(t.getEditState());if(A.markup.state=i,A.markup.editState=i,A.newState&&(A.newState=i),r.isRedoStackEmpty()||(r.redoStack[r.redoStack.length-1].oldState=i),r.isGroupOpen)break;r.undo()}for(;!r.isRedoStackEmpty();)r.redo()}())}},{key:"creationEnd",value:function(e){this.fixInitialRotation(),this.onCreationEndCB?this.onCreationEndCB(e):(this.markup.disableEdit(),this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DRAWING_END,markup:this.markup}),this.markupsExtension.markupsManager.duringCreationMarkup=null,this.editEnd(),this.markup.complete())}},{key:"creationCancel",value:function(){this.markup.anchorHandler&&this.markup.anchorHandler.cancelAnchorEditing(),this.markup.disableEdit(),this.markup.remove(),this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DRAWING_CANCEL,markup:this.markup}),this.markupsExtension.markupsManager.duringCreationMarkup=null,this.editEnd()}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:return this.creationCancel(),!0;case Autodesk.Viewing.KeyCode.ESCAPE:return this.onEscape()}return!1}},{key:"onEscape",value:function(){return this.creationCancel(),!0}}])&&hr(t.prototype,n),a}(Zt);function gr(e){return gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gr(e)}function Er(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Br(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mr(e,t){return mr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},mr(e,t)}function vr(e,t){return!t||"object"!==gr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function wr(e){return wr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},wr(e)}var kr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mr(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=wr(r);if(A){var n=wr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return vr(this,e)});function o(){return Er(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;return t[0]&&(this.creationStarted||this.creationStart(),this.updateRectPoints(t,e)),!0}},{key:"updateRectPoints",value:function(e,t){this.markupsExtension.markupsTool.shiftDown&&this.snapPointToAxis(t,e[0],90,45);var n=this.markupsExtension.renderer.getCameraRightVector(),r=this.markupsExtension.renderer.getCameraUpVector();e[2]=t;var A=e[2].clone().sub(e[0]),i=A.dot(n);e[1]=e[0].clone().add(n.multiplyScalar(i));var o=A.dot(r);e[3]=e[0].clone().add(r.multiplyScalar(o)),this.updateEditStateAnchors()}},{key:"handleButtonDown",value:function(e,t){var n=this.getEditState().anchors;return n[0]||(n[0]=e,this.updateEditStateAnchors()),!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;return n[1]?this.isSamePoint(e,n[0])?(this.creationCancel(),!1):(this.updateRectPoints(n,e),this.submitChanges(),this.creationEnd(e),!0):this.handleMouseMove(e,t)}}])&&Br(t.prototype,n),o}(yr);function Cr(e){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cr(e)}function br(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tr(e,t){return Tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Tr(e,t)}function xr(e,t){return!t||"object"!==Cr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mr(e){return Mr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Mr(e)}var Ur=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tr(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Mr(r);if(A){var n=Mr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return xr(this,e)});function o(){return br(this,o),i.apply(this,arguments)}return t=o,n=[{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;if(this.creationStarted||this.creationStart(),t.length>0){this.popTemporaryPoint(),this.markupsExtension.markupsTool.shiftDown&&t.length>0&&this.snapPointToAxis(e,t[t.length-1],Me);var n=this.isClosingLoop(e);n||(t.push(e),this.needPop=!0),this.updateEditState({anchors:t,closed:n})}return!0}},{key:"handleButtonDown",value:function(e,t){var n=this.getEditState().anchors;return 0===n.length&&(n.push(e),this.updateEditStateAnchors()),!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;this.creationStarted||this.creationStart(),this.popTemporaryPoint();var r=this.isClosingLoop(e);return(r||this.isNewLocation(e))&&(this.markupsExtension.markupsTool.shiftDown&&n.length>0&&this.snapPointToAxis(e,n[n.length-1],Me),r||n.push(e),this.updateEditState({anchors:n,closed:r}),n.length>1&&this.submitChanges(),r&&this.creationEnd(e)),!0}},{key:"beforeCreationEnd",value:function(){return!0}},{key:"handleDoubleClick",value:function(e,t){return this.getEditState().anchors.length>=this.getMinimumPoints()?(this.popTemporaryPoint(),this.beforeCreationEnd(),this.creationEnd(e)):this.markupsExtension.markupsManager.getMarkupById(this.markup.id)?this.deleteMarkup():this.creationCancel(),!0}},{key:"getMinimumPoints",value:function(){return 2}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var n=this.getEditState().anchors;return n.length>0&&(this.popTemporaryPoint(),n.pop(),this.updateEditStateAnchors(),n.length>1?this.submitChanges():this.markupsExtension.markupsManager.getMarkupById(this.markup.id)?this.deleteMarkup():this.creationCancel()),!0;case Autodesk.Viewing.KeyCode.ESCAPE:return this.onEscape()}return!1}},{key:"onEscape",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getEditState(),n=t.anchors;return n.length>0&&(this.popTemporaryPoint(),n.length>=this.getMinimumPoints()?(e&&this.beforeCreationEnd(),this.creationEnd()):this.markupsExtension.markupsManager.getMarkupById(this.markup.id)?this.deleteMarkup():this.creationCancel(),!0)}},{key:"isClosingLoop",value:function(e){var t=this.getEditState().anchors;return t.length>2&&Rt(e,t[0],this.snapDistance())}},{key:"isNewLocation",value:function(e){var t=this.getEditState().anchors;return!(t.length>0&&this.isSamePoint(e,t[t.length-1]))}},{key:"popTemporaryPoint",value:function(){this.needPop&&(this.getEditState().anchors.pop(),this.needPop=!1,this.updateEditStateAnchors())}}],n&&Sr(t.prototype,n),o}(yr);function Qr(e){return Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qr(e)}function Lr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rr(e,t){return Rr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Rr(e,t)}function Hr(e,t){return!t||"object"!==Qr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _r(e){return _r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_r(e)}var Dr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rr(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_r(r);if(A){var n=_r(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Hr(this,e)});function o(){return Lr(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"beforeCreationEnd",value:function(){this.updateEditState({closed:!0}),this.submitChanges()}},{key:"getMinimumPoints",value:function(){return 3}}])&&Fr(t.prototype,n),o}(Ur);function Ir(e){return Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ir(e)}function Or(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nr(e,t){return Nr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Nr(e,t)}function Kr(e,t){return!t||"object"!==Ir(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vr(e){return Vr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Vr(e)}var Gr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nr(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Vr(r);if(A){var n=Vr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Kr(this,e)});function o(){return Or(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"handleMouseMove",value:function(e){return 1===this.getEditState().anchors.length&&this.creationStart(),this.addPoint(e),!0}},{key:"handleButtonDown",value:function(e,t){return this.addPoint(e),!0}},{key:"handleButtonUp",value:function(e,t){return this.addPoint(e),this.submitChanges(),this.creationEnd(e),!0}},{key:"addPoint",value:function(e){var t=this.getEditState().anchors;0!==t.length&&Rt(e,t[t.length-1],this.markupsExtension.renderer.sizeFromClientToWorld(Se))||(t.push(e),t=Gt(t,this.markupsExtension.renderer.sizeFromClientToWorld(.5),!0),this.updateEditStateAnchors(t))}},{key:"handleKeyDown",value:function(e,t){var n=this.getEditState().anchors;switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return n.length>0&&this.creationCancel(),!0}return!1}}])&&Pr(t.prototype,n),o}(yr);function jr(e){return jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jr(e)}function Yr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xr(e,t){return Xr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Xr(e,t)}function Jr(e,t){return!t||"object"!==jr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zr(e){return zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},zr(e)}var Zr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xr(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=zr(r);if(A){var n=zr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Jr(this,e)});function o(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Yr(this,o),(n=i.call(this,e,t,r)).tailIndex=r.reverseHead?1:0,n.headIndex=r.reverseHead?0:1,n}return t=o,(n=[{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;return t[this.headIndex]||(t[this.headIndex]=t[this.tailIndex]),this.creationStarted||this.creationStart(),t[this.tailIndex]&&(this.markupsExtension.markupsTool.shiftDown&&this.snapPointToAxis(e,t[this.tailIndex],Me),t[this.headIndex]=e,this.updateEditStateAnchors()),!0}},{key:"handleButtonDown",value:function(e,t){var n=this.getEditState().anchors;return n[this.tailIndex]||(n[this.tailIndex]=e,this.updateEditStateAnchors()),!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;return n[this.headIndex]?this.isSamePoint(e,n[this.tailIndex])?(this.creationCancel(),!1):(this.markupsExtension.markupsTool.shiftDown&&this.snapPointToAxis(e,n[this.tailIndex],Me),n[this.headIndex]=e,this.updateEditStateAnchors(),this.submitChanges(),this.creationEnd(e),!0):this.handleMouseMove(e,t)}}])&&Wr(t.prototype,n),o}(yr);function qr(e){return qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qr(e)}function $r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tA(e,t){return tA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},tA(e,t)}function nA(e,t){return!t||"object"!==qr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rA(e){return rA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},rA(e)}var AA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tA(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=rA(r);if(A){var n=rA(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return nA(this,e)});function o(){return $r(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"calculateAnchorsByCenterPoint",value:function(e){var t=this.getEditState(),n=t.anchors,r=t.text,A=this.markupsExtension.renderer.getCameraRightVector(),i=this.markupsExtension.renderer.getCameraUpVector(),o=this.markup.getTextStyle(),a=It(r,o),s=this.markupsExtension.renderer.getFontToWorldScale(),u=Math.ceil(a.width)*s,c=a.height*s;n[0]=e.clone().sub(i.clone().multiplyScalar(c/2)).sub(A.clone().multiplyScalar(u/2)),n[1]=n[0].clone().add(A.multiplyScalar(u)),n[2]=n[1].clone().add(i.clone().multiplyScalar(c)),n[3]=n[0].clone().add(i.clone().multiplyScalar(c))}},{key:"handleButtonDown",value:function(e,t){return!0}},{key:"handleButtonUp",value:function(e,t){return!this.didMouseMove()&&this.handleClick(e,t)}},{key:"handleClick",value:function(e,t){return this.calculateAnchorsByCenterPoint(e),this.creationStart(),this.updateEditStateAnchors(),this.submitChanges(),this.creationEnd(e),Autodesk.Viewing.isIOSDevice()||this.markup.textInputHandler.startTextEditing(!0),!0}}])&&eA(t.prototype,n),o}(yr);function iA(e){return iA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},iA(e)}function oA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function aA(e,t,n){return aA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cA(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},aA(e,t,n||e)}function sA(e,t){return sA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},sA(e,t)}function uA(e,t){return!t||"object"!==iA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cA(e){return cA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},cA(e)}var lA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sA(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=cA(r);if(i){var n=cA(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return uA(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e,t,n)).measurement=new Autodesk.Viewing.MeasureCommon.Measurement(Autodesk.Viewing.MeasureCommon.MeasurementTypes.MEASUREMENT_DISTANCE),r.snapper=r.markupsExtension.markupsTool.snapper,r.viewer=r.markupsExtension.viewer,r}return t=a,(n=[{key:"getMeasureExtension",value:function(){return this.measureExtension||(this.measureExtension=this.markupsExtension.viewer.getExtension("Autodesk.Measure"),this.measureExtension||console.error("Measure extension not available!")),this.measureExtension}},{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;return this.creationStarted||this.creationStart(),t[0]&&(this.markupsExtension.markupsTool.shiftDown&&this.viewer.impl.is2d&&this.snapPointToAxis(e,t[0],90),t[1]||this.updateViewportId(this.measurement.getPick(1).viewportIndex2d),this.pickSecondAnchor(e)),!0}},{key:"handleButtonDown",value:function(e,t){var n=this.getMeasureExtension();if((n.forceCalibrate||this.viewer.model.isLeaflet()||this.viewer.model.isPdf(!0))&&!n.calibrationTool.isCalibrated())return n.openCalibrationRequiredDialog("dimension"),this.markupsExtension.markupsManager.dispatchEvent({type:A.CALIBRATION_REQUIRED}),this.creationCancel(),!0;var r=this.getEditState().anchors;if(!r[0]){if(!this.snapper.isSnapped())return!1;this.snapper.copyResults(this.measurement.getPick(1));var i=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer);r[0]=this.markupsExtension.renderer.documentCameraToMarkupsCamera(i),this.updateEditStateAnchors()}return!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;return n[1]?this.isSamePoint(e,n[0])?(this.creationCancel(),!1):(this.markupsExtension.markupsTool.shiftDown&&this.viewer.impl.is2d&&this.snapPointToAxis(e,n[0],90),!!this.pickSecondAnchor(e)&&(this.updateViewportId(),this.submitChanges(),this.creationEnd(e),this.markup.dimensionEditHandler&&this.markup.dimensionEditHandler.handleButtonDown(e,t),!0)):this.handleMouseMove(e,t)}},{key:"pickSecondAnchor",value:function(e){var t=this.getEditState().anchors;if(this.markupsExtension.markupsTool.shiftDown&&this.viewer.impl.is2d){var n=this.markupsExtension.renderer.worldToClient(e);this.snapper.onMouseMove({x:n.x,y:n.y})}var r=this.measurement.getPick(2),A=this.snapper.isSnapped();A?(this.snapper.copyResults(r),t[1]=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer)):(t[1]=e,r.geomType=Autodesk.Viewing.MeasureCommon.SnapType.SNAP_VERTEX,r.geomVertex=e,r.intersectPoint=e),Autodesk.Viewing.MeasureCommon.correctPerpendicularPicks(this.measurement.getPick(1),this.measurement.getPick(2),this.viewer,this.snapper)&&(t[1]=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.measurement.getPick(2),this.viewer),this.snapper.indicator.render()),A&&(t[1]=this.markupsExtension.renderer.documentCameraToMarkupsCamera(t[1]));var i=A||this.viewer.impl.is2d?this.getDistance():"";return this.updateEditState({text:i,anchors:t}),A}},{key:"creationCancel",value:function(){aA(cA(a.prototype),"creationCancel",this).call(this),this.updateViewportId()}},{key:"updateViewportId",value:function(e){this.viewer.model&&this.viewer.impl.is2d&&(e?(this.viewer.impl.updateViewportId(e),this.snapper.setViewportId(e)):(this.viewer.impl.updateViewportId(0),this.snapper.setViewportId(null)))}},{key:"getDistance",value:function(){var e=this.getMeasureExtension().sharedMeasureConfig;if(this.measurement.computeResult(this.measurement.picks,this.markupsExtension.viewer),this.markupsExtension.viewer.model&&this.measurement.distanceXYZ){var t=Autodesk.Viewing.Private.convertUnits(this.markupsExtension.viewer.model.getUnitString(),e.units,e.calibrationFactor,this.measurement.distanceXYZ);return Autodesk.Viewing.Private.formatValueWithUnits(t,e.units,3,e.precision)}return null}}])&&oA(t.prototype,n),a}(yr);function hA(e){return hA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hA(e)}function pA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fA(e,t,n){return fA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=EA(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},fA(e,t,n||e)}function yA(e,t){return yA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},yA(e,t)}function gA(e,t){return!t||"object"!==hA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function EA(e){return EA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},EA(e)}var BA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yA(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=EA(r);if(A){var n=EA(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return gA(this,e)});function o(e,t,n){var r,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];pA(this,o),(r=i.call(this,e,t,n)).creationHandlers=[],r.currentStep=0,r.lastCompleted=-1,r.markup.markups=[];var a=[];r.markup.state.uuid?a=r.markup.state.componentsState.sort((function(e,t){return e.groupOrder-t.groupOrder})):r.markup.state.uuid=r.markup.editState.uuid=THREE.Math.generateUUID(),r.markupClasses=A,r.numMarkups=A.length;for(var s=0;s<r.numMarkups;s++){var u=A[s].class,c=A[s].options||{};r._restoreFill(a[s],A[s],a);var l=s===A.length-1;c.onCreationEnd=function(e){r.onCreationEnd(e)},c.onCreationStart=function(){r.onCreationStart()};var h=Object.assign({},a[s],{groupId:r.markup.state.uuid,groupOrder:s}),p=r.markupsExtension.markupsManager.createMarkup(u,h,c);l||(p.selectWhenCompleted=function(){return!1}),p.markupGroup=r.markup,r.markup.markups.push(p),r.creationHandlers.push(p.creationHandler)}return delete r.markup.state.componentsState,r}return t=o,(n=[{key:"_restoreFill",value:function(e,t,n){if(e&&t.options.fillNotAllowed)for(var r=0;r<this.numMarkups;r++)if(!(t===this.markupClasses[r]||this.markupClasses[r].options&&this.markupClasses[r].options.fillNotAllowed)){e.style[u.FILL_OPACITY]=n[r].style[u.FILL_OPACITY],e.style[u.FILL_COLOR]=n[r].style[u.FILL_COLOR];break}}},{key:"handleMouseMove",value:function(e){return this.creationHandlers[this.currentStep].handleMouseMove(e)}},{key:"handleButtonDown",value:function(e,t){return this.creationHandlers[this.currentStep].handleButtonDown(e,t)}},{key:"handleButtonUp",value:function(e,t){return this.creationHandlers[this.currentStep].handleButtonUp(e,t)}},{key:"handleDoubleClick",value:function(e,t){return this.creationHandlers[this.currentStep].handleDoubleClick(e,t)}},{key:"creationCancel",value:function(){for(fA(EA(o.prototype),"creationCancel",this).call(this),this.markupsExtension.markupsManager.closeActionGroup();this.currentStep-- >0;)this.markupsExtension.markupsManager.actionManager.undo(!1)}},{key:"onCreationStart",value:function(){0===this.currentStep&&(this.markupsExtension.markupsManager.openActionGroup(),this.creationStart()),this.markup.markups[this.currentStep].setVisible(!0),this.markup.markups[this.currentStep].enableEdit()}},{key:"closeGroup",value:function(){this.lastCompleted===this.currentStep&&this.markupsExtension.markupsManager.closeActionGroup(),this.lastCompleted=this.currentStep}},{key:"onCreationEnd",value:function(e){if(this.markup.markups[this.currentStep].disableEdit(),this.markup.markups[this.currentStep].complete(),this.currentStep===this.numMarkups-1)this.submitChanges(),this.creationEnd(e);else{var t=this.markup.markups[this.currentStep].getStartPointForNextMarkup();this.currentStep+=1,this.markupClasses[this.currentStep].options.requiresClick?this.creationHandlers[this.currentStep].handleClick(t):this.creationHandlers[this.currentStep].handleButtonDown(t),this.afterNextMarkupCreated(this.currentStep)}this.closeGroup()}},{key:"afterNextMarkupCreated",value:function(e){}}])&&dA(t.prototype,n),o}(yr);function mA(e){return mA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mA(e)}function vA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wA(e,t){return wA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},wA(e,t)}function kA(e,t){return!t||"object"!==mA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function CA(e){return CA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},CA(e)}var bA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wA(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=CA(r);if(A){var n=CA(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return kA(this,e)});function o(e,t,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,e,t,n,r)}return t=o,(n=[{key:"afterNextMarkupCreated",value:function(e){if(e===this.getTextIndex()){var t,n=this.getArrow(),r=this.getText(),A=r.getWorldBoundingBox(!0),i=r.editState.style[u.THICKNESS]/2,o=A.getSize(new THREE.Vector3).y/2-i,a=A.getSize(new THREE.Vector3).x/2-i,s=n.getHead(),c=n.getTail(),l=Math.atan2(s.y-c.y,s.x-c.x);switch(this.markup.getTextQuadrant(l)){case 1:t=new THREE.Vector3(0,o,0);break;case 2:t=new THREE.Vector3(-a,0,0);break;case 3:t=new THREE.Vector3(0,-o,0);break;case 4:t=new THREE.Vector3(a,0,0)}if(r.editState.frameType===B){var h=t.clone().negate(),p=this.markup.getVectorToClosestPointOnCloud(h);t.add(p)}r.creationHandler.updateEditState({translation:t}),r.creationHandler.submitChanges()}}},{key:"getArrowIndex",value:function(){throw new Error("getArrowIndex needs implementation")}},{key:"getTextIndex",value:function(){throw new Error("getTextIndex needs implementation")}},{key:"getArrow",value:function(){return this.markup.markups[this.getArrowIndex()]}},{key:"getText",value:function(){return this.markup.markups[this.getTextIndex()]}}])&&vA(t.prototype,n),o}(BA);function SA(e){return SA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SA(e)}function TA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xA(e,t){return xA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xA(e,t)}function MA(e,t){return!t||"object"!==SA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function UA(e){return UA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},UA(e)}var QA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xA(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=UA(r);if(A){var n=UA(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return MA(this,e)});function o(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,e,t,n,[{class:y,options:{reverseHead:!0,tailHandlingNotAllowed:!0}},{class:b,options:{requiresClick:!0,rotationNotAllowed:!0,frameType:n.calloutFrameType?n.calloutFrameType:g}}])}return t=o,(n=[{key:"getArrowIndex",value:function(){return 0}},{key:"getTextIndex",value:function(){return 1}}])&&TA(t.prototype,n),o}(bA);function LA(e){return LA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},LA(e)}function FA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function RA(e,t){return RA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},RA(e,t)}function HA(e,t){return!t||"object"!==LA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _A(e){return _A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_A(e)}var DA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&RA(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_A(r);if(A){var n=_A(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return HA(this,e)});function o(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,e,t,n,[{class:B,options:{fillNotAllowed:!0,rotationNotAllowed:!0}},{class:y,options:{reverseHead:!0,headHandlingNotAllowed:!0,tailHandlingNotAllowed:!0}},{class:b,options:{requiresClick:!0,rotationNotAllowed:!0,frameType:n.calloutFrameType?n.calloutFrameType:g}}])}return t=o,(n=[{key:"getArrowIndex",value:function(){return 1}},{key:"getTextIndex",value:function(){return 2}}])&&FA(t.prototype,n),o}(bA);function IA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var OA=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"getCreationHandler",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};switch(e){case y:case M:return new Zr(t,n,r);case g:case E:case B:return new kr(t,n,r);case m:case v:return new Gr(t,n,r);case k:return new Dr(t,n,r);case w:return new Ur(t,n,r);case b:return new AA(t,n,r);case x:return new lA(t,n,r);case S:return new QA(t,n,r);case T:return new DA(t,n,r)}throw new Error("".concat(e," creation handler does not exist"))}}],null&&IA(t.prototype,null),n&&IA(t,n),e}(),PA=n(90071),NA=n.n(PA),KA=n(97),VA=n.n(KA);function GA(e){this.supportsInt32Index=e}function jA(e){function t(e,t){return void 0===e?t:e}THREE.Material.call(this),e=e||{},this.lineWidth=t(e.lineWidth,1),this.miter=t(e.miter,!0),this.color=t(e.color,new THREE.Color(16777215)),this.opacity=t(e.opacity,1),this.resolution=t(e.resolution,new THREE.Vector2(1,1));var n=new THREE.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution}},vertexShader:NA(),fragmentShader:VA(),attributes:{previous:{type:"v2",value:new THREE.Vector2},next:{type:"v2",value:new THREE.Vector2},side:{type:"f",value:0},width:{type:"f",value:0},counters:{type:"f",value:0}}});return n.type="MeshLineMaterial",Autodesk.Viewing.isIE11&&(n.defines.IS_IE_11=1),this.miter&&(n.defines.MITER=1),delete e.lineWidth,delete e.color,delete e.opacity,delete e.resolution,delete e.miter,n.setValues(e),n}function YA(e,t,n,r,A,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.333,a=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),s=Math.sqrt(Math.pow(A-n,2)+Math.pow(i-r,2)),u=o*a/(a+s),c=o-u,l=n+u*(e-A),h=r+u*(t-i),p=n-c*(e-A),d=r-c*(t-i);return[{x:l,y:h},{x:p,y:d}]}function WA(e,t,n,r){var A=r*r,i=1-r,o=i*i,a=o*e.x;a+=2*i*r*t.x,a+=A*n.x;var s=o*e.y;return s+=2*i*r*t.y,{x:a,y:s+=A*n.y,z:0}}function XA(e,t,n,r,A){var i=A*A,o=i*A,a=1-A,s=a*a,u=s*a,c=u*e.x;c+=3*s*A*t.x,c+=3*a*i*n.x,c+=o*r.x;var l=u*e.y;return l+=3*s*A*t.y,l+=3*a*i*n.y,{x:c,y:l+=o*r.y,z:0}}GA.prototype.create=function(){this.geometry=new THREE.BufferGeometry},GA.prototype.dispose=function(){if(this.geometry&&(this.geometry.dispose(),this.geometry=null),this.attributes){for(var e in this.attributes)delete this.attributes[e].array;this.attributes=null}this.positions=null,this.previous=null,this.next=null,this.side=null,this.width=null,this.counters=null,this.indices_array=null},GA.prototype.setGeometry=function(e,t,n,r){var A=this;this.sourceGeo=e,Array.isArray(t)?(this.widthArray=t,this.widthCallback=function(e){return A.widthArray[e]}):this.widthCallback=t,this.sourceConnectivity=n||[],this.connectivity={},this.options=Object.assign({},{capType:f,joinType:f,useExactSize:!1},r),this.isClosed=!!this.options.isClosed,this.process()},GA.prototype.isPointNear=function(){var e=new THREE.Vector3,t=new THREE.Vector3;function n(n){var r=e.x,A=e.y,i=t.x-r,o=t.y-A;if(0!==i||0!==o){var a=((n.x-r)*i+(n.y-A)*o)/(i*i+o*o);a>1?(r=t.x,A=t.y):a>0&&(r+=i*a,A+=o*a)}return(i=n.x-r)*i+(o=n.y-A)*o}return function(r,A,i){for(var o=0,a=this.numPoints-1;o<a;o++)if(this.connectivity[o]!==h&&(e.fromArray(this.positions,6*o).applyMatrix4(i),t.fromArray(this.positions,6*(o+1)).applyMatrix4(i),n(r)<A))return!0;return!1}}(),GA.prototype.getPositionV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},GA.prototype.initArrays=function(e){var t=this.options.useExactSize;if(!this.capacity||this.capacity<e||t&&this.capacity!==e){this.dispose();var n=t?e:Math.ceil(1.5*e);this.positions=new Float32Array(6*n),this.previous=new Float32Array(4*n),this.next=new Float32Array(4*n),this.side=new Float32Array(2*n),this.width=new Float32Array(2*n),this.counters=new Float32Array(2*n);var r=6*(n-1);this.indices_array=this.supportsInt32Index&&r>65535?new Uint32Array(r):new Uint16Array(r),this.capacity=n}this.numPoints=e},GA.prototype.getWidth=function(e,t){return this.widthCallback?this.widthCallback(e,t):1},GA.prototype.process=function(){var e=this,t=this.sourceGeo.length,n=Math.max(1,t-1),r=function(t,r,A,i){var o=e.sourceGeo[t];e.positions.set([o.x,o.y,o.z,o.x,o.y,o.z],6*r),e.counters.set([A,A],2*r),e.side.set([i,-i],2*r);var a=e.getWidth(t,t/n);e.width.set([a,a],2*r)},A=0,i=function(){e.attributes?(e.attributes.position.array=e.positions,e.attributes.position.needsUpdate=!0,e.attributes.previous.array=e.previous,e.attributes.previous.needsUpdate=!0,e.attributes.next.array=e.next,e.attributes.next.needsUpdate=!0,e.attributes.side.array=e.side,e.attributes.side.needsUpdate=!0,e.attributes.width.array=e.width,e.attributes.width.needsUpdate=!0,e.attributes.index.array=e.indices_array,e.attributes.index.needsUpdate=!0,e.attributes.counters.array=e.counters,e.attributes.counters.needsUpdate=!0):(e.create(),e.attributes={position:new THREE.BufferAttribute(e.positions,3),previous:new THREE.BufferAttribute(e.previous,2),next:new THREE.BufferAttribute(e.next,2),side:new THREE.BufferAttribute(e.side,1),width:new THREE.BufferAttribute(e.width,1),index:new THREE.BufferAttribute(e.indices_array,1),counters:new THREE.BufferAttribute(e.counters,1)},e.geometry.setAttribute("position",e.attributes.position),e.geometry.setAttribute("previous",e.attributes.previous),e.geometry.setAttribute("next",e.attributes.next),e.geometry.setAttribute("side",e.attributes.side),e.geometry.setAttribute("width",e.attributes.width),e.geometry.setAttribute("index",e.attributes.index),e.geometry.setAttribute("counters",e.attributes.counters))};if(0!==t){this.isClosed&&this.options.joinType!==d||(this.sourceConnectivity[0]=l,this.sourceConnectivity[t-1]=h);var o=t+this.sourceConnectivity.reduce((function(e){return e+1}),0);this.initArrays(o);for(var a=0,s=0;s<t;s++)if(this.sourceConnectivity[s]===l){var u=0!==s||this.isClosed?this.options.joinType:this.options.capType;this.connectivity[a]=l,r(s,a++,-1,u),r(s,a++,0,u)}else if(this.sourceConnectivity[s]===h){var c=s!==t-1||this.isClosed?this.options.joinType:this.options.capType;r(s,a++,1,c),this.connectivity[a]=h,r(s,a++,2,c)}else r(s,a++,s/n,p);!function(){var t;t=e.isClosed?e.getPositionV3(o-2):e.getPositionV3(0),e.previous.set([t[0],t[1],t[0],t[1]],0);for(var n=1;n<o;n++)t=e.connectivity[n]===l?e.getPositionV3(n):e.connectivity[n]===h?e.getPositionV3(n-2):e.getPositionV3(n-1),e.previous.set([t[0],t[1],t[0],t[1]],4*n)}(),function(){for(var t,n=0;n<o-1;n++)t=e.connectivity[n]===h?e.getPositionV3(n):e.connectivity[n]===l?e.getPositionV3(n+2):e.getPositionV3(n+1),e.next.set([t[0],t[1],t[0],t[1]],4*n);t=e.isClosed?e.getPositionV3(1):e.getPositionV3(o-1),e.next.set([t[0],t[1],t[0],t[1]],4*(o-1))}(),function(){for(var t=0;t<o-1;t++)if(e.connectivity[t]!==h){var n=2*t;e.indices_array.set([n,n+1,n+2,n+2,n+1,n+3],A),A+=6}}(),i(),this.geometry.groups[0]={index:0,start:0,count:A}}else i()},jA.prototype=Object.create(THREE.Material.prototype),jA.prototype.constructor=jA,jA.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.miter=e.miter,this};var JA=function(e){for(var t,n,r,A,i=0,o=1;o<e.length;o++)i+=(t=e[o],n=e[o-1],void 0,void 0,r=t.x-n.x,A=t.y-n.y,Math.sqrt(r*r+A*A));return i};function zA(e,t,n,r,A,i){for(var o=Math.max(Math.round(JA([e,t,n])/r),4),a=0;a<o;a++){var s=a/o,u=WA(e,t,n,s);A.push(u),i&&i.push(e.width+s*s*(n.width-e.width))}}function ZA(e,t,n,r,A,i,o){for(var a=Math.max(Math.round(JA([e,t,n,r])/A),4),s=0;s<a;s++){var u=s/a,c=XA(e,t,n,r,u);i.push(c),o&&o.push(e.width+u*u*u*(r.width-e.width))}}function qA(e,t,n){if(e.length<3)return{anchors:e};for(var r=[],A=[],i=n?[]:null,o=e.length,a=0;a<o-2;a++)r=r.concat(YA(e[a].x,e[a].y,e[a+1].x,e[a+1].y,e[a+2].x,e[a+2].y));zA(e[0],r[0],e[1],t,A,i);for(var s=1;s<o-3;s++)ZA(e[s],r[2*s-1],r[2*s],e[s+1],t,A,i);return zA(e[o-2],r[2*o-5],e[o-1],t,A,i),A.push(e[o-1]),i&&i.push(e[o-1].width),{anchors:A,widths:i}}function $A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ei=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.geoCache={}}var t,n,r;return t=e,n=[{key:"getStrokeGeometry",value:function(t){return this._isCacheSupported(t.type)?this._getCachedStrokeGeometry(t.type):e.areAllAnchorsEqual(t.editState.anchors)?this._createPointGeometry(t):this._createStrokeGeometry(t)}},{key:"getFillGeometry",value:function(e){switch(e.type){case B:case k:var t={innerGeometry:this._getFillInnerGeometryFromAnchors(e)};return e.meshLine.type!==E&&(t.arcGeometry=this._getFillCircleGeometry(e.meshLine.radius),t.fillGapGeometries=this._getFillingGapsGeometry(e)),t;case w:return this._getFillInnerGeometryFromAnchors(e);case E:return this._getFillCircleGeometry(.5,72);case g:return this._getFillRectangleGeometry();default:return null}}},{key:"_getFillingGapsGeometry",value:function(e){for(var t=[],n=0;n<e.meshLine.intersectionObjects.length;n++){var r=e.meshLine.intersectionObjects[n],A=r.beginPoint,i=r.endPoint,o=r.newCircle,a=r.anchorPoint,s=r.beginCircle,u=r.endCircle;if(!(A&&i&&a&&s&&u&&o))return null;var c=[];c.push(new THREE.Vector3(a.x,a.y,0)),c.push(new THREE.Vector3(s.x,s.y,0)),c.push(new THREE.Vector3(A.x,A.y,0)),c.push(new THREE.Vector3(o.x,o.y,0)),c.push(new THREE.Vector3(i.x,i.y,0)),c.push(new THREE.Vector3(u.x,u.y,0)),t.push(new THREE.ShapeGeometry(new THREE.Shape(c)))}return t}},{key:"_getFillCircleGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n="circle-fill|r:"+e+"|s:"+t;return this.geoCache[n]||(this.geoCache[n]=new THREE.CircleGeometry(e,t)),this.geoCache[n]}},{key:"_getFillRectangleGeometry",value:function(){var e="rectangle-fill";return this.geoCache[e]||(this.geoCache[e]=new THREE.PlaneBufferGeometry(1,1,1,1)),this.geoCache[e]}},{key:"_getFillInnerGeometryFromAnchors",value:function(e){if(e.meshLine.type===E)return this._getFillCircleGeometry(.5,10);var t=lt.cloneDeep(e.getAnchors());return this._centerAndScaleLocations(t,e.center,e.scaleMatrix),e.meshLine.type===B&&this._shiftAnchorsInsideBox(e,t,e.meshLine.radius),t.length>2?new THREE.ShapeGeometry(new THREE.Shape(t)):null}},{key:"_getCachedStrokeGeometry",value:function(e){var t=e;return this.geoCache[t]||(this.geoCache[t]=this._createCachedStrokeGeometry(e)),this.geoCache[t]}},{key:"_isCacheSupported",value:function(e){return[g,E].includes(e)}},{key:"isCachedGeometry",value:function(e){for(var t in this.geoCache)if(e===this.geoCache[t])return!0;return!1}},{key:"_createCachedStrokeGeometry",value:function(e){switch(e){case g:return this._createRectangleStrokeGeometry();case E:return this._createCircleStrokeGeometry();default:return null}}},{key:"_createStrokeGeometry",value:function(e){switch(e.type){case B:case k:var t=this._createCloudGeometry(e);return t||(t=this._getCachedStrokeGeometry(E)),t;case w:case M:return this._createLineGeometry(e,179);case m:case v:return this._createLineGeometry(e,120);case y:return this._createArrowGeometry(e);case x:return this._createDimensionGeometry(e);default:return null}}},{key:"_createPointGeometry",value:function(e){var t,n;switch(e.type){case B:case k:case m:case v:t=d,n=tt*this.markupsExtension.renderer.mmToWorldUnitFactor;break;default:t=f,n=this.markupsExtension.renderer.getNormaStrokeWidth()}var r=[{x:0,y:0,z:0},{x:n,y:0,z:0}];return this._createMeshLine(r,e.type,e,null,{capType:t})}},{key:"_createMeshLine",value:function(e,t,n,r){var A,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return n?(A=n.meshLine,i.useExactSize=n.completed):i.useExactSize=!0,A&&A.type===t||(A=new GA(this.markupsExtension.renderer.supportsInt32Index())),A.type=t,A.setGeometry(e,o,r,i),A}},{key:"_createRectangleStrokeGeometry",value:function(){return this._createMeshLine([{x:-.5,y:-.5,z:0},{x:.5,y:-.5,z:0},{x:.5,y:.5,z:0},{x:-.5,y:.5,z:0},{x:-.5,y:-.5,z:0}],g,null,null,{isClosed:!0})}},{key:"_createCircleStrokeGeometry",value:function(){var e=Ot(0,0,.5,0,2*Math.PI,!1,72);return this._createMeshLine(e,E,null,null,{isClosed:!0})}},{key:"_centerAndScaleLocations",value:function(e,t,n){e.forEach((function(e){e.sub(t),e.applyMatrix4(n)}))}},{key:"_createLineGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:29,n=e.type===m||e.type===v,r=lt.cloneDeep(e.getEditState().anchors);this._centerAndScaleLocations(r,e.center,e.scaleMatrix);var A=[],i=null;if(e.editState.closed&&r.push(r[0]),n){var o=.5*e.markupsExtension.renderer.mmToWorldUnitFactor,a=!1,s=qA(r,o,a);r=s.anchors,i=s.widths}for(var u=new THREE.Vector3,c=new THREE.Vector3,l=Math.cos(t*Math.PI/180),p=1;p<r.length-1;p++)u.copy(r[p-1]).sub(r[p]).normalize(),c.copy(r[p+1]).sub(r[p]).normalize(),c.dot(u)>l&&(r.splice(p,0,r[p]),i&&i.splice(p,0,i[p]),A[p]=h,p++);return e.editState.closed&&(u.copy(r[r.length-2]).sub(r[r.length-1]).normalize(),c.copy(r[1]).sub(r[0]).normalize(),c.dot(u)>l&&(r.push(r[0]),i&&i.push(i[0]))),this._createMeshLine(r,e.type,e,A,{capType:n?d:f,joinType:d,isClosed:e.editState.closed},i)}},{key:"_createArrowGeometry",value:function(e){var t=e.editState.style[u.THICKNESS],n=lt.cloneDeep(e.getEditState().anchors);n[0].sub(e.center),n[1].sub(e.center);var r=n[1].clone().sub(n[0]),A=this.markupsExtension.renderer.getCameraEyeVector(),i=Math.min(t*me,r.length()/2),o=[],a=i>t;if(a){var s=r.clone().normalize(),c=n[1].clone().sub(s.multiplyScalar(i)),p=it.degreesToRadians(30);n[2]=c.clone(),it.applyRotation(n[2],p,n[1],A),n[3]=n[1].clone(),n[4]=c.clone(),it.applyRotation(n[4],-p,n[1],A),o[1]=h,o[2]=l}var d=this._createMeshLine(n,e.type,e,o);return a&&(n[0].add(e.center),n[1].add(e.center),n[2].add(e.center),n[4].add(e.center),d.boundingPoints=[n[0],n[2],n[1],n[4]]),d}},{key:"_createDimensionGeometry",value:function(e){var t=e.editState.style[u.THICKNESS]*Ve,n=lt.cloneDeep(e.getEditState().anchors),r=[],A=[];function i(e,t){r=r.concat([e,t]),A=A.concat([l,h])}n[0].sub(e.center),n[1].sub(e.center),i(n[0],n[1]);var o=n[0].clone().sub(n[1]),a=this.markupsExtension.renderer.getCameraEyeVector(),s=o.clone().cross(a).normalize(),c=t*Ke,p=s.clone().multiplyScalar(c),d=it.degreesToRadians(45);return n[2]=n[0].clone().add(p),n[3]=n[0].clone().sub(p),it.applyRotation([n[2],n[3]],d,n[0],a),i(n[2],n[3]),n[4]=n[1].clone().add(p),n[5]=n[1].clone().sub(p),it.applyRotation([n[4],n[5]],d,n[1],a),i(n[4],n[5]),n[6]=n[0].clone(),e.applyInverseScaleAndTranslation(n[6]),Rt(n[6],n[0])||(n[7]=n[0].clone().sub(n[0].clone().sub(n[6]).normalize().multiplyScalar(c)),i(n[6],n[7])),n[8]=n[1].clone(),e.applyInverseScaleAndTranslation(n[8]),Rt(n[8],n[1])||(n[9]=n[1].clone().sub(n[1].clone().sub(n[8]).normalize().multiplyScalar(c)),i(n[8],n[9])),n[10]=n[0].clone().add(p),n[11]=n[0].clone().sub(p),i(n[10],n[11]),n[12]=n[1].clone().add(p),n[13]=n[1].clone().sub(p),i(n[12],n[13]),this._createMeshLine(r,e.type,e,A)}},{key:"_createCloudGeometry",value:function(e){var t=lt.cloneDeep(e.getEditState().anchors);(function(e,t){for(var n=0,r=0;r<e.length;r++){var A=e[r],i=e[(r+1)%e.length];n+=(i.x-A.x)*(i.y+A.y)}return n*t.scaleMatrix.elements[0]*t.scaleMatrix.elements[5]>0})(t,e)&&t.reverse();var n=this.getCloudMinimumRadius(e.editState.style[u.THICKNESS]),r=n/this.markupsExtension.renderer.mmToWorldUnitFactor;this._centerAndScaleLocations(t,e.center,e.scaleMatrix);var A,i=e.editState.closed;if(e.type===B){if(i=!0,!this._shiftAnchorsInsideBox(e,t,n))return null}else(A=new THREE.Box3).min.z=A.max.z=0;var o=function(e,t,n){for(var r=e.length,A=[],i=0;i<r;i++){var o=e[0===i?r-1:i-1],a=e[i],s=e[(i+1)%r];if(!a||!s)break;var u=Math.atan2(a.y-o.y,a.x-o.x),c={};c.p1=new THREE.Vector3(o.x+Math.cos(u-Math.PI/2)*t,o.y+Math.sin(u-Math.PI/2)*t,1),c.p2=new THREE.Vector3(a.x+Math.cos(u-Math.PI/2)*t,a.y+Math.sin(u-Math.PI/2)*t,1);var l=Math.atan2(s.y-a.y,s.x-a.x),h={};h.p1=new THREE.Vector3(a.x+Math.cos(l-Math.PI/2)*t,a.y+Math.sin(l-Math.PI/2)*t,1),h.p2=new THREE.Vector3(s.x+Math.cos(l-Math.PI/2)*t,s.y+Math.sin(l-Math.PI/2)*t,1);var p=Kt(c.p1,c.p2,h.p1,h.p2);if(p.onBothLines){var d=new THREE.Vector3(a.x-o.x,a.y-o.y,0),f=new THREE.Vector3(s.x-a.x,s.y-a.y,0);d.normalize(),f.normalize(),d.multiplyScalar(-1);var y=(new THREE.Vector3).crossVectors(d,f),g=Math.asin(y.z),E=d.dot(f);Math.atan2(g,E)<Math.PI/2&&(a["isCurrentIntersection"+A.length]=!0,s["isNextIntersection"+A.length]=!0,a.intersects=A,s.intersects=A,A.push(p))}}return A}(t,n),a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];function o(e,t,n){var r=t.x-e.x,A=t.y-e.y,i=.5*Math.sqrt(r*r+A*A)/n;i<-1&&(i=-1),i>1&&(i=1);var o=Math.atan2(A,r),a=Math.acos(i);return[o-a,Math.PI+o+a]}var a=[],s=2*t*(arguments.length>4&&void 0!==arguments[4]?arguments[4]:.8),u=n?e[e.length-1]:e[0];i=i||!n;for(var c=n?0:1;c<e.length;c++){var l=e[c],h=l.x-u.x,p=l.y-u.y,d=Math.sqrt(h*h+p*p);h/=d,p/=d;var f=0,y=0;n||(1===c?(d-=t,u.x+=h*t,u.y+=p*t,f=Math.atan2(p,h)+Math.PI):c===e.length-1&&(y=Math.atan2(p,h)));var g=s;if(i){var E=d/s+.5|0;E<1&&(E=1),g=d/E}for(var B=0;B+.1*g<d;B+=g){a.push({x:u.x+B*h,y:u.y+B*p,begin:f,end:y,isAnchor:0===B});for(var m=0;m<r.length;m++)a[a.length-1]["isNextIntersection"+m]=l["isNextIntersection"+m],a[a.length-1]["isCurrentIntersection"+m]=l["isCurrentIntersection"+m],l["isNextIntersection"+m]&&0===B&&(r[m].anchorPoint=a[a.length-1])}u=l}var v=it.degreesToRadians(A);u=a[a.length-1];for(var w=0;w<a.length;w++){var k=a[w],C=o(u,k,t);(n||0!==w)&&(u.end=C[0]+v,k.begin=C[1]),u=k}Nt(a,t,r);for(var b=r.length-1;b>-1;b--)if(a[r[b].begin]&&a[r[b].end]){r[b].beginCircle=a[r[b].begin],r[b].endCircle=a[r[b].end];var S=Pt(a,t,r[b].begin,r[b].end),T=S.newCircle,x=S.beginPoint,M=S.endPoint;r[b].newCircle=T,r[b].beginPoint=x,r[b].endPoint=M}return a.filter((function(e){return!e.hide}))}(t,n,i,o);if(0===a.length)return null;for(var s,c,p=[],f=[],y=0,g=0;g<a.length;g++){var E=a[g];E.isAnchor&&(s=E,void 0,c=void 0,(c=Math.abs(s.begin-s.end))>2*Math.PI&&(c-=2*Math.PI),s.begin>s.end&&(c=2*Math.PI-c),c>1.9*Math.PI&&(E.begin=E.end)),Ot(E.x,E.y,n,E.begin,E.end,!1,null,p,r,A);var m=p.length-y;f[y]=l,f[y+m-1]=h,y+=m}var v=this._createMeshLine(p,e.type,e,f,{capType:d,joinType:d});return v.arcs=a,v.radius=n,v.intersectionObjects=o,A&&(A.applyMatrix4(e.invScaleMatrix),A.translate(e.center),v.boundingPoints=[A.min.clone(),A.max.clone(),A.max.clone(),A.min.clone()],v.boundingPoints[1].y=A.min.y,v.boundingPoints[3].y=A.max.y),v}},{key:"_shiftAnchorsInsideBox",value:function(e,t,n){var r=t[0].clone().sub(t[1]).normalize(),A=t[2].clone().sub(t[1]).normalize(),i=t[0].distanceTo(t[1])/2;if(t[2].distanceTo(t[1])/2<n||i<n)return!1;for(var o=0;o<t.length;o++){var a=t[o],s=n*Math.sign(a.dot(A));a.sub(A.clone().multiplyScalar(s)),s=n*Math.sign(a.dot(r)),a.sub(r.clone().multiplyScalar(s))}return!0}},{key:"getCloudMinimumRadius",value:function(e){var t=this.markupsExtension.renderer.mmToWorldUnitFactor*(this.markupsExtension.viewer.impl.is2d?1:10);return Math.max(3*e,t)}},{key:"destroy",value:function(){for(var e in this.geoCache)this.geoCache[e].dispose();this.geoCache=null}}],r=[{key:"areAllAnchorsEqual",value:function(e){for(var t=e[0],n=1;n<e.length;n++)if(!e[n].equals(t))return!1;return!0}}],n&&$A(t.prototype,n),r&&$A(t,r),e}();function ti(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ni(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ri(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ai=Autodesk.Viewing,ii=function(){function e(t,n,r,A){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};ni(this,e),this.setGlobalManager(t.globalManager),this.id=n,this.type=r,this.options=i,this.markupsExtension=t,this.materialManager=this.markupsExtension.renderer.materialManager,this.layer=null,this.meshContainer=null,this.strokeMaterial=null,this.fillMaterial=null,this.center=new THREE.Vector3,this.matrix=new THREE.Matrix4,this.invMatrix=new THREE.Matrix4,this.scaleMatrix=new THREE.Matrix4,this.invScaleMatrix=new THREE.Matrix4,this.completed=!1,this.selected=!1,this.inEdit=!1,this.enabled=!0,this.transparent=!1,this.visible=!1,this.hover=!1,this.locked=!1,this.state=this.getDefaultState(),this.state.anchors=this.getDefaultAnchors(),this.state.style=this.getDefaultStyle(),A&&Object.assign(this.state,A),this.state.translation=this.state.translation||new THREE.Vector3,this.state.rotation=this.state.rotation||0,this.state.scale=this.state.scale||new THREE.Vector3(1,1,1),this.editState=lt.cloneDeep(this.state),this.updateMatrix(),this.registerSelectionHandler(),this.creationHandler=OA.getCreationHandler(this.type,this.markupsExtension,this,i)}var t,n,r;return t=e,n=[{key:"updateMatrix",value:function(){this.scaleMatrix.makeScale(this.editState.scale.x,this.editState.scale.y,this.editState.scale.z),this.matrix.copy(this.scaleMatrix),this.matrix.setPosition(this.editState.translation),this.invMatrix.copy(this.matrix).invert(),this.invScaleMatrix.copy(this.scaleMatrix).invert(),this.updateCenter()}},{key:"updateCenter",value:function(){if(0!==this.editState.anchors.length){var e=(new THREE.Vector3).set(-1/0,-1/0,-1/0),t=(new THREE.Vector3).set(1/0,1/0,1/0);this.editState.anchors.forEach((function(n){e=e.max(n),t=t.min(n)})),this.center.x=(e.x+t.x)/2,this.center.y=(e.y+t.y)/2}}},{key:"getDefaultState",value:function(){return{}}},{key:"getDefaultAnchors",value:function(){return[]}},{key:"getDefaultStyle",value:function(){var e;return ti(e={},u.COLOR,this.markupsExtension.getStyleProperty(u.LAST_COLOR)),ti(e,u.FONT_SIZE,this.markupsExtension.getStyleProperty(u.FONT_SIZE)),ti(e,u.FONT_WEIGHT,this.markupsExtension.getStyleProperty(u.FONT_WEIGHT)),ti(e,u.FONT_FAMILY,this.markupsExtension.getStyleProperty(u.FONT_FAMILY)),ti(e,u.FONT_STYLE,this.markupsExtension.getStyleProperty(u.FONT_STYLE)),ti(e,u.FONT_COLOR,this.markupsExtension.getStyleProperty(u.FONT_COLOR)),ti(e,u.THICKNESS,this.markupsExtension.getStyleProperty(u.THICKNESS)),ti(e,u.FILL_OPACITY,this.markupsExtension.getStyleProperty(u.FILL_OPACITY)),ti(e,u.FILL_COLOR,this.markupsExtension.getStyleProperty(u.FILL_COLOR)),ti(e,u.OPACITY,this.markupsExtension.getStyleProperty(u.OPACITY)),e}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e){this.state=lt.cloneDeep(e),this.rotatedBoundingBox=null,this.boundingBox=null}},{key:"getEditState",value:function(){return this.editState}},{key:"setEditState",value:function(e,t,n){var r=this.editState;this.editState=t?Object.assign({},e,t):lt.cloneDeep(e),this.updateMatrix(),this.rotatedBoundingBox=null,this.boundingBox=null,this.visible&&this.markupsExtension.renderer&&this.render(t),this.belongsToGroup()&&!this.isLocked()&&this.syncGroup(r,this.editState,t,n)}},{key:"isLocked",value:function(){return this.locked}},{key:"setLocked",value:function(e){this.locked=e}},{key:"render",value:function(e){this.meshContainer||(this.meshContainer=new THREE.Group,this.markupsExtension.renderer.addToScene(this))}},{key:"syncEditState",value:function(){this.setEditState(this.getState())}},{key:"syncState",value:function(){this.setState(this.getEditState())}},{key:"syncGroup",value:function(e,t,n,r){this.markupGroup.rotatedBoundingBox=null,this.markupGroup.boundingBox=null,n&&this.markupGroup.syncGroupMarkups(this,e,t,n,r)}},{key:"select",value:function(){this.layer&&!this.markupsExtension.permissionManager.canEditMarkup(this.layer.layerData)||(this.selected=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_SELECTED,markup:this}),this.enableEdit(),this.belongsToGroup()&&!this.markupGroup.locked&&this.markupGroup.select(this))}},{key:"deselect",value:function(){this.selected=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DESELECTED,markup:this}),this.disableEdit()}},{key:"setVisible",value:function(e,t){(this.visible!==e||t)&&(this.visible=e,this.meshContainer&&(this.meshContainer.visible=e),this.markupsExtension.renderer&&(this.visible?this.render():this.markupsExtension.renderer.invalidate()),this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_VISIBILITY_CHANGED,markup:this,visible:e}))}},{key:"isVisible",value:function(){return this.visible}},{key:"isSelected",value:function(){return this.selected}},{key:"enableEdit",value:function(){this.inEdit=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_ENABLE_EDIT,markup:this}),this.setDirty()}},{key:"disableEdit",value:function(){this.inEdit=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DISABLE_EDIT,markup:this}),this.setDirty()}},{key:"enable",value:function(){this.enabled=!0,this.changeTransparency(!1)}},{key:"disable",value:function(){this.enabled=!1,this.changeTransparency(!0)}},{key:"isEnabled",value:function(){return this.enabled}},{key:"changeTransparency",value:function(e){this.transparent!==e&&(this.transparent=e,this.visible&&this.markupsExtension.renderer&&this.render({style:{}}),this.setDirty())}},{key:"isTransparent",value:function(){return this.transparent}},{key:"setHover",value:function(e){this.hover!==e&&(this.hover=e,this.belongsToGroup()&&!this.markupGroup.locked&&this.markupGroup.setHover(e,this),this.setDirty())}},{key:"isHovered",value:function(){return this.hover}},{key:"isInEdit",value:function(){return this.inEdit}},{key:"setDirty",value:function(){this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DIRTY,markup:this})}},{key:"isCompleted",value:function(){return this.completed}},{key:"complete",value:function(){this.completed=!0,this.selectWhenCompleted()?this.select():this.setDirty(),this.visible&&this.markupsExtension.renderer&&this.render(),this.markupsExtension.markupsManager.selectLayer(this.layer,!1,!1)}},{key:"selectWhenCompleted",value:function(){return!0}},{key:"registerAnchorHandler",value:function(e){this.anchorHandler=new Tn(this.markupsExtension,this,e)}},{key:"registerTranslationHandler",value:function(e){this.translationHandler=new mn(this.markupsExtension,this,e)}},{key:"registerRotationHandler",value:function(e){this.rotationHandler=new Rn(this.markupsExtension,this,e)}},{key:"registerScaleHandler",value:function(e){this.scaleHandler=new Nn(this.markupsExtension,this,e)}},{key:"registerSelectionHandler",value:function(e){this.selectionHandler=new pn(this.markupsExtension,this,e)}},{key:"registerTextInputHandler",value:function(e){this.textInputHandler=new nr(this.markupsExtension,this,e)}},{key:"registerDimensionEditHandler",value:function(e){this.dimensionEditHandler=new ur(this.markupsExtension,this,e)}},{key:"applyCameraRotation",value:function(e){var t=this.markupsExtension.renderer.getCameraRotation(),n=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(e,t,this.getWorldCenter(),n)}},{key:"applyInverseCameraRotation",value:function(e){var t=this.markupsExtension.renderer.getCameraRotation(),n=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(e,-t,this.getWorldCenter(),n)}},{key:"applyInverseRotation",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(e,-t,this.getWorldCenter(),n)}}},{key:"applyRotation",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(e,t,this.getWorldCenter(),n)}}},{key:"applyRotationForAnchors",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector(),r=this.getWorldCenter();e.forEach((function(e){it.applyRotation(e,t,r,n)}))}}},{key:"applyScaleAndTranslation",value:function(e){e.sub(this.center),e.applyMatrix4(this.matrix),e.add(this.center)}},{key:"applyInverseScaleAndTranslation",value:function(e){e.sub(this.center),e.applyMatrix4(this.invMatrix),e.add(this.center)}},{key:"calculateWorldBoundingBox",value:function(e){var t,n=this,r=new THREE.Box3;(t=this.meshLine&&this.meshLine.boundingPoints?lt.cloneDeep(this.meshLine.boundingPoints):lt.cloneDeep(this.editState.anchors)).forEach((function(e){n.applyScaleAndTranslation(e)})),e&&this.applyRotationForAnchors(t),t.forEach((function(e){r.expandByPoint(e)}));var A=this.editState.style[u.THICKNESS]/2;return r.expandByVector(new THREE.Vector3(A,A,0)),r}},{key:"getWorldBoundingBox",value:function(e){return e?(this.rotatedBoundingBox||(this.rotatedBoundingBox=this.calculateWorldBoundingBox(e)),this.rotatedBoundingBox):(this.boundingBox||(this.boundingBox=this.calculateWorldBoundingBox(e)),this.boundingBox)}},{key:"getClientBoundingBox",value:function(e,t){var n=this.getWorldBoundingBox(t).clone();n.min=this.markupsExtension.renderer.worldToClient(n.min),n.max=this.markupsExtension.renderer.worldToClient(n.max);var r=this.markupsExtension.renderer.getCameraEyeVector(),A=n.getCenter(new THREE.Vector3),i=this.markupsExtension.renderer.getCameraRotation();if(it.applyRotation(n.min,i,A,r),it.applyRotation(n.max,i,A,r),it.swapBoundingBoxY(n),e){var o=this.getMarginSize();n.expandByVector(new THREE.Vector3(o,o,0))}return n.min.z=0,n.max.z=0,n}},{key:"getMarginSize",value:function(){return Oe}},{key:"getMinimumSize",value:function(){return Math.max(this.markupsExtension.renderer.sizeFromWorldToClient(this.editState.style[u.THICKNESS]),this.getMarginSize())}},{key:"getCenter",value:function(){return this.center}},{key:"setPosition",value:function(){var e=this.center.clone().add(this.editState.translation);this.meshContainer.position.copy(e)}},{key:"setRotation",value:function(){this.meshContainer.rotation.z=this.editState.rotation*this.markupsExtension.renderer.getCameraEyeVector().z}},{key:"getWorldCenter",value:function(){return this.center.clone().add(this.editState.translation)}},{key:"getClientCenter",value:function(){return this.markupsExtension.renderer.worldToClient(this.getWorldCenter())}},{key:"getRotation",value:function(){return this.editState.rotation}},{key:"getScale",value:function(){return this.editState.scale}},{key:"getAnchors",value:function(){return this.editState.anchors}},{key:"isAnchorHandlingAllowed",value:function(e){return!0}},{key:"getTail",value:function(){return this.editState.anchors[this.editState.anchors.length-1]}},{key:"getHead",value:function(){return this.editState.anchors[0]}},{key:"getStartPointForNextMarkup",value:function(){return new THREE.Vector3}},{key:"intersect",value:function(e){var t=e.clone();this.applyInverseRotation(t);var n=this.markupsExtension.renderer.worldToClient(t),r=this.getClientBoundingBox(!0),A=this.markupsExtension.renderer.getCameraEyeVector(),i=this.markupsExtension.renderer.getCameraRotation();it.applyRotation(n,i,r.getCenter(new THREE.Vector3),A),n.z=0;var o=r.containsPoint(n);if(!o||this.isTextMarkup())return o;if(this.hasFill()&&this.fillMesh&&this.markupsExtension.renderer.raycaster.intersectObject(this.fillMesh).length>0)return!0;var a=this.strokeMaterial.uniforms.lineWidth.value/2;return a+=this.markupsExtension.renderer.sizeFromClientToWorld(Pe),this.meshLine.isPointNear(e,a*a,this.meshContainer.matrixWorld)}},{key:"isGroupMarkup",value:function(){return!1}},{key:"belongsToGroup",value:function(){return!!this.markupGroup}},{key:"isTextMarkup",value:function(){return!1}},{key:"isGeometricMarkup",value:function(){return!0}},{key:"isWithFillMarkup",value:function(){return!1}},{key:"isPoint",value:function(){return this.editState.anchors.length<2||ei.areAllAnchorsEqual(this.editState.anchors)}},{key:"hasFill",value:function(){return this.isWithFillMarkup()&&!this.options.fillNotAllowed&&this.editState.style[u.FILL_OPACITY]>0&&this.editState.style[u.FILL_COLOR]!==o.NO_COLOR}},{key:"needsMiter",value:function(){return!0}},{key:"showPath",value:function(){return!1}},{key:"hasThicknessChanged",value:function(){return this.strokeMaterial&&this.strokeMaterial.uniforms.lineWidth.value!==this.editState.style[u.THICKNESS]}},{key:"removeFill",value:function(){this.fillMaterial&&(this.materialManager.removeMaterial(this.fillMaterial),this.fillMaterial=null),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null)}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.markupsExtension.renderer&&(this.strokeMaterial&&(this.materialManager.removeMaterial(this.strokeMaterial),this.strokeMaterial=null),this.strokeMesh&&(this.meshContainer.remove(this.strokeMesh),this.strokeMesh=null),this.meshLine&&!this.markupsExtension.renderer.geometryManager.isCachedGeometry(this.meshLine)&&(this.meshLine.dispose(),this.meshLine=null),this.fillMaterial&&(this.materialManager.removeMaterial(this.fillMaterial),this.fillMaterial=null),this.fillMesh&&(this.markupsExtension.renderer.geometryManager.isCachedGeometry(this.fillMesh.geometry)||this.fillMesh.traverse((function(e){e.geometry&&e.geometry.dispose()})),this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.meshContainer&&(this.markupsExtension.renderer.removeFromScene(this),this.meshContainer=null),e&&this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_REMOVED,markup:this}))}},{key:"destroy",value:function(){this.anchorHandler&&(this.anchorHandler.destroy(),this.anchorHandler=null),this.translationHandler&&(this.translationHandler.destroy(),this.translationHandler=null),this.rotationHandler&&(this.rotationHandler.destroy(),this.rotationHandler=null),this.scaleHandler&&(this.scaleHandler.destroy(),this.scaleHandler=null),this.selectionHandler&&(this.selectionHandler.destroy(),this.selectionHandler=null),this.textInputHandler&&(this.textInputHandler.destroy(),this.textInputHandler=null),this.markupsExtension=null,this.state=null,this.editState=null,this.layer=null}}],r=[{key:"createMesh",value:function(e,t){var n=new THREE.Mesh(e,t);return n.frustumCulled=!1,n}}],n&&ri(t.prototype,n),r&&ri(t,r),e}();function oi(e){return oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oi(e)}function ai(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function si(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ui(e,t,n){return ui="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hi(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},ui(e,t,n||e)}function ci(e,t){return ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ci(e,t)}function li(e,t){return!t||"object"!==oi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hi(e){return hi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},hi(e)}Ai.GlobalManagerMixin.call(ii.prototype),ii.singleClickMarkup=!1,ii.withSnappingMarkup=!1,ii.useTimerBeforeSelection=!1;var pi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ci(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=hi(r);if(A){var n=hi(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return li(this,e)});function o(e,t,n,r){var A,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return ai(this,o),(A=i.call(this,e,t,n,r,a)).registerTranslationHandler(),A.registerAnchorHandler(),A}return t=o,n=[{key:"createLine",value:function(){this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=ii.createMesh(this.meshLine.geometry,this.strokeMaterial),this.setPosition(),this.meshContainer.add(this.strokeMesh)}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;ui(hi(o.prototype),"render",this).call(this);var t=e.anchors;if(t&&t.length>1&&this.createLine(),this.strokeMesh){if(e.style){var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);r&&(this.strokeMaterial=r,this.strokeMesh.material=r,n&&this.createLine())}e.translation&&this.setPosition(),this.markupsExtension.renderer.invalidate()}}}],n&&si(t.prototype,n),o}(ii);function di(e){return di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},di(e)}function fi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gi(e,t){return gi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},gi(e,t)}function Ei(e,t){return!t||"object"!==di(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bi(e){return Bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Bi(e)}pi.withSnappingMarkup=!0;var mi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gi(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Bi(r);if(A){var n=Bi(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ei(this,e)});function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return fi(this,o),i.call(this,e,t,y,n,r)}return t=o,(n=[{key:"getTail",value:function(){return this.editState.anchors[0]}},{key:"getHead",value:function(){return this.editState.anchors[1]}},{key:"getStartPointForNextMarkup",value:function(){return this.getTail().clone()}},{key:"isAnchorHandlingAllowed",value:function(e){return!(this.options.headHandlingNotAllowed&&e===this.getHead()||this.options.tailHandlingNotAllowed&&e===this.getTail())}}])&&yi(t.prototype,n),o}(pi);function vi(e){return vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vi(e)}function wi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ki(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ci(e,t,n){return Ci="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ti(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},Ci(e,t,n||e)}function bi(e,t){return bi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},bi(e,t)}function Si(e,t){return!t||"object"!==vi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ti(e){return Ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ti(e)}var xi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bi(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ti(r);if(A){var n=Ti(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Si(this,e)});function o(e,t,n){var r,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return wi(this,o),(r=i.call(this,e,t,w,n,A)).registerTranslationHandler(),r.registerAnchorHandler(),r.registerRotationHandler(),r.registerScaleHandler(),r}return t=o,n=[{key:"getDefaultState",value:function(){return{closed:!1}}},{key:"createPolyline",value:function(){if(this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=ii.createMesh(this.meshLine.geometry,this.strokeMaterial),this.hasFill()&&!this.isPoint()&&jt(this.editState.anchors)){this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0));var e=this.markupsExtension.renderer.geometryManager.getFillGeometry(this);e&&(this.fillMesh=ii.createMesh(e,this.fillMaterial),this.meshContainer.add(this.fillMesh))}this.meshContainer.add(this.strokeMesh),this.setPosition(),this.setRotation()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;Ci(Ti(o.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>0||this.editState.anchors.length>0&&e.scale)&&this.createPolyline(),this.strokeMesh){if(e.style){var n=this.materialManager.editMaterial(this.strokeMaterial,this,!1);n&&(this.strokeMaterial=n,this.strokeMesh.material=n);var r=!1;if(this.hasFill())if(this.fillMesh){var A=this.materialManager.editMaterial(this.fillMaterial,this,!0);A&&(this.fillMaterial=A,this.fillMesh.material=A)}else r=!0;else this.removeFill();r&&this.createPolyline()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}},{key:"isWithFillMarkup",value:function(){return this.editState.closed}},{key:"showPath",value:function(){return!0}}],n&&ki(t.prototype,n),o}(ii);function Mi(e){return Mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mi(e)}function Ui(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Li(e,t,n){return Li="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Hi(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},Li(e,t,n||e)}function Fi(e,t){return Fi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fi(e,t)}function Ri(e,t){return!t||"object"!==Mi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Hi(e){return Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Hi(e)}xi.withSnappingMarkup=!0;var _i=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fi(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Hi(r);if(A){var n=Hi(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ri(this,e)});function o(e,t,n){var r,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Ui(this,o),(r=i.call(this,e,t,k,n,A)).registerTranslationHandler(),r.registerAnchorHandler(),r.registerRotationHandler(),r.registerScaleHandler(),r}return t=o,n=[{key:"getDefaultState",value:function(){return{closed:!1}}},{key:"needsMiter",value:function(){return!1}},{key:"createCloud",value:function(){if(this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.meshLine.type===E){var e=this.markupsExtension.renderer.getNormaStrokeWidth();this.meshContainer.scale.x=e,this.meshContainer.scale.y=e}else this.meshContainer.scale.x=1,this.meshContainer.scale.y=1;this.strokeMesh=ii.createMesh(this.meshLine.geometry,this.strokeMaterial),this.hasFill()&&!this.isPoint()&&jt(this.editState.anchors)&&this.createFillMesh(),this.meshContainer.add(this.strokeMesh),this.setPosition(),this.setRotation()}},{key:"createFillMesh",value:function(){var e=this,t=this.markupsExtension.renderer.geometryManager.getFillGeometry(this);t.innerGeometry&&(this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0)),this.fillMesh=ii.createMesh(t.innerGeometry,this.fillMaterial),this.meshContainer.add(this.fillMesh),t.arcGeometry&&this.meshLine.arcs.forEach((function(n){var r=ii.createMesh(t.arcGeometry,e.fillMaterial);e.fillMesh.add(r),r.position.x=n.x,r.position.y=n.y})),t.fillGapGeometries&&t.fillGapGeometries.forEach((function(t){var n=ii.createMesh(t,e.fillMaterial);e.fillMesh.add(n)})))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;Li(Hi(o.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>0||this.editState.anchors.length>0&&e.scale)&&this.createCloud(),this.strokeMesh){if(e.style){var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);if(r&&(this.strokeMaterial=r,this.strokeMesh.material=r),this.hasFill())if(this.fillMesh){var A=this.materialManager.editMaterial(this.fillMaterial,this,!0);A&&(this.fillMaterial=A,this.fillMesh.traverse((function(e){return e.material=A})))}else n=!0;else this.removeFill();n&&this.createCloud()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}},{key:"showPath",value:function(){return!0}},{key:"isWithFillMarkup",value:function(){return this.editState.closed}}],n&&Qi(t.prototype,n),o}(ii);function Di(e){return Di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Di(e)}function Ii(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pi(e,t,n){return Pi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vi(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},Pi(e,t,n||e)}function Ni(e,t){return Ni=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ni(e,t)}function Ki(e,t){return!t||"object"!==Di(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vi(e){return Vi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Vi(e)}_i.withSnappingMarkup=!0;var Gi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ni(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Vi(r);if(A){var n=Vi(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ki(this,e)});function o(e,t,n,r){var A,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return Ii(this,o),(A=i.call(this,e,t,n,r,a)).width=0,A.height=0,A.registerTranslationHandler(),A.registerRotationHandler(),A.registerScaleHandler(),A}return t=o,n=[{key:"setSize",value:function(){var e=this.markupsExtension.renderer.getNormaStrokeWidth();this.meshContainer.scale.x=Math.max(Math.abs(this.width*this.editState.scale.x),e)*Math.sign(this.editState.scale.x),this.meshContainer.scale.y=Math.max(Math.abs(this.height*this.editState.scale.y),e)*Math.sign(this.editState.scale.y)}},{key:"createShape",value:function(e){this.strokeMesh||(this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=ii.createMesh(this.meshLine.geometry,this.strokeMaterial),this.meshContainer.add(this.strokeMesh),this.meshContainer.rotation.z=-this.markupsExtension.renderer.getCameraRotation()*this.markupsExtension.renderer.getCameraEyeVector().z),!this.fillMesh&&this.hasFill()&&this.createFill(),this.width=e[0].distanceTo(e[1]),this.height=e[2].distanceTo(e[1]),this.setPosition(),this.setSize()}},{key:"createFill",value:function(){this.fillGeometry=this.markupsExtension.renderer.geometryManager.getFillGeometry(this),this.fillGeometry&&(this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0)),this.fillMesh=ii.createMesh(this.fillGeometry,this.fillMaterial),this.meshContainer.add(this.fillMesh),this.meshContainer.add(this.strokeMesh))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;Pi(Vi(o.prototype),"render",this).call(this);var t=e.anchors;if(t&&t.length>1&&this.createShape(t),this.strokeMesh){if(e.style){var n=this.materialManager.editMaterial(this.strokeMaterial,this,!1);if(n&&(this.strokeMaterial=n,this.strokeMesh.material=n),this.hasFill())if(this.fillMesh){var r=this.materialManager.editMaterial(this.fillMaterial,this,!0);r&&(this.fillMaterial=r,this.fillMesh.material=r)}else this.createFill();else this.removeFill()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),e.scale&&this.setSize(),this.markupsExtension.renderer.invalidate()}}},{key:"isWithFillMarkup",value:function(){return!0}}],n&&Oi(t.prototype,n),o}(ii);function ji(e){return ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ji(e)}function Yi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xi(e,t){return Xi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Xi(e,t)}function Ji(e,t){return!t||"object"!==ji(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zi(e){return zi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},zi(e)}var Zi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xi(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=zi(r);if(A){var n=zi(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ji(this,e)});function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Yi(this,o),i.call(this,e,t,g,n,r)}return t=o,(n=[{key:"isWithFillMarkup",value:function(){return!0}}])&&Wi(t.prototype,n),o}(Gi);function qi(e){return qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qi(e)}function $i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function to(e,t){return to=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},to(e,t)}function no(e,t){return!t||"object"!==qi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ro(e){return ro=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ro(e)}var Ao=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&to(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ro(r);if(A){var n=ro(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return no(this,e)});function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return $i(this,o),i.call(this,e,t,E,n,r)}return t=o,(n=[{key:"isWithFillMarkup",value:function(){return!0}},{key:"needsMiter",value:function(){return!1}}])&&eo(t.prototype,n),o}(Gi);function io(e){return io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},io(e)}function oo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ao(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function so(e,t,n){return so="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=lo(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},so(e,t,n||e)}function uo(e,t){return uo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},uo(e,t)}function co(e,t){return!t||"object"!==io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lo(e){return lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},lo(e)}var ho=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&uo(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=lo(r);if(A){var n=lo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return co(this,e)});function o(e,t,n){var r,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return oo(this,o),(r=i.call(this,e,t,B,n,A)).registerTranslationHandler(),A.rotationNotAllowed||r.registerRotationHandler(),r.registerScaleHandler(),r}return t=o,n=[{key:"createCloud",value:function(){if(this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=ii.createMesh(this.meshLine.geometry,this.strokeMaterial),this.hasFill()&&!this.isPoint()&&this.createFillMesh(),this.meshContainer.add(this.strokeMesh),this.meshLine.type===E){var e=this.editState.anchors[0].distanceTo(this.editState.anchors[1]),t=this.editState.anchors[2].distanceTo(this.editState.anchors[1]),n=this.markupsExtension.renderer.getNormaStrokeWidth();this.meshContainer.scale.x=Math.max(Math.abs(e*this.editState.scale.x),n)*Math.sign(this.editState.scale.x),this.meshContainer.scale.y=Math.max(Math.abs(t*this.editState.scale.y),n)*Math.sign(this.editState.scale.y),this.isCompleted()?this.setRotation():this.meshContainer.rotation.z=-this.markupsExtension.renderer.getCameraRotation()*this.markupsExtension.renderer.getCameraEyeVector().z}else this.meshContainer.scale.x=1,this.meshContainer.scale.y=1,this.setRotation();this.setPosition()}},{key:"createFillMesh",value:function(){var e=this,t=this.markupsExtension.renderer.geometryManager.getFillGeometry(this);t.innerGeometry&&(this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0)),this.fillMesh=ii.createMesh(t.innerGeometry,this.fillMaterial),this.meshContainer.add(this.fillMesh),t.arcGeometry&&this.meshLine.arcs.forEach((function(n){var r=ii.createMesh(t.arcGeometry,e.fillMaterial);e.fillMesh.add(r),r.position.x=n.x,r.position.y=n.y})))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;so(lo(o.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>1||this.editState.anchors.length>1&&e.scale)&&this.createCloud(),this.strokeMesh){if(e.style){var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);if(r&&(this.strokeMaterial=r,this.strokeMesh.material=r),this.hasFill())if(this.fillMesh){var A=this.materialManager.editMaterial(this.fillMaterial,this,!0);A&&(this.fillMaterial=A,this.fillMesh.traverse((function(e){return e.material=A})))}else n=!0;else this.removeFill();n&&this.createCloud()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}},{key:"isWithFillMarkup",value:function(){return!0}},{key:"needsMiter",value:function(){return!1}}],n&&ao(t.prototype,n),o}(ii);function po(e){return po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},po(e)}function fo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function go(e,t,n){return go="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mo(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},go(e,t,n||e)}function Eo(e,t){return Eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Eo(e,t)}function Bo(e,t){return!t||"object"!==po(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function mo(e){return mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},mo(e)}ho.withSnappingMarkup=!0;var vo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Eo(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=mo(r);if(A){var n=mo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Bo(this,e)});function o(e,t,n,r){var A,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return fo(this,o),(A=i.call(this,e,t,n,r,a)).registerTranslationHandler(),A.registerRotationHandler(),A.registerScaleHandler(),A}return t=o,n=[{key:"selectWhenCompleted",value:function(){return!1}},{key:"needsMiter",value:function(){return!0}},{key:"createPen",value:function(){this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=ii.createMesh(this.meshLine.geometry,this.strokeMaterial),this.meshContainer.add(this.strokeMesh),this.setPosition(),this.setRotation()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;go(mo(o.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>0||this.editState.anchors.length>0&&e.scale)&&this.createPen(),this.strokeMesh){if(e.style){var n=this.materialManager.editMaterial(this.strokeMaterial,this,!1);n&&(this.strokeMaterial=n,this.strokeMesh.material=n)}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}}],n&&yo(t.prototype,n),o}(ii);function wo(e){return wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wo(e)}function ko(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Co(e,t){return Co=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Co(e,t)}function bo(e,t){return!t||"object"!==wo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function So(e){return So=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},So(e)}vo.singleClickMarkup=!0,vo.useTimerBeforeSelection=!0;var To=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Co(e,t)}(A,e);var t,n,r=(t=A,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=So(t);if(n){var A=So(this).constructor;e=Reflect.construct(r,arguments,A)}else e=r.apply(this,arguments);return bo(this,e)});function A(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ko(this,A),r.call(this,e,t,m,n,i)}return A}(vo);function xo(e){return xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xo(e)}function Mo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Uo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qo(e,t,n){return Qo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ro(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},Qo(e,t,n||e)}function Lo(e,t){return Lo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Lo(e,t)}function Fo(e,t){return!t||"object"!==xo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ro(e){return Ro=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ro(e)}var Ho=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lo(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ro(r);if(A){var n=Ro(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Fo(this,e)});function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Mo(this,o),i.call(this,e,t,v,n,r)}return t=o,(n=[{key:"getDefaultStyle",value:function(){var e=Qo(Ro(o.prototype),"getDefaultStyle",this).call(this);return e[u.OPACITY]=ce,e}}])&&Uo(t.prototype,n),o}(vo);function _o(e){return _o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_o(e)}function Do(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Io(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oo(e,t,n){return Oo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ko(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},Oo(e,t,n||e)}function Po(e,t){return Po=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Po(e,t)}function No(e,t){return!t||"object"!==_o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ko(e){return Ko=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ko(e)}var Vo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Po(e,t)}(a,e);var t,n,r,A,i=(r=a,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ko(r);if(A){var n=Ko(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return No(this,e)});function a(e,t,n){var r,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Do(this,a),(r=i.call(this,e,t,b,n,A)).registerTranslationHandler(),r.registerScaleHandler({onlyHorizontal:!0}),r.registerTextInputHandler(),A.rotationNotAllowed||r.registerRotationHandler(),r}return t=a,n=[{key:"getDefaultState",value:function(){return{text:"Default Text",isFrameUsed:!0,frameType:this.options.frameType?this.options.frameType:g}}},{key:"shouldRenderFrame",value:function(){return this.editState.isFrameUsed||this.hasFill()}},{key:"setVisible",value:function(e,t){Oo(Ko(a.prototype),"setVisible",this).call(this,e,t),this.frameMarkup?this.frameMarkup.setVisible(e,t):this.shouldRenderFrame()&&e&&this.renderFrame()}},{key:"render",value:function(){arguments.length>0&&void 0!==arguments[0]||this.editState,this.markupsExtension.renderer.textRenderer.renderMarkup(this),this.shouldRenderFrame()?this.renderFrame():(this.removeFrame(),this.setDirty())}},{key:"renderFrame",value:function(){this.frameMarkup||(this.frameMarkup=new _a[this.editState.frameType](this.markupsExtension,this.id),this.frameMarkup.layer=this.layer,this.frameMarkup.transparent=this.isTransparent(),this.frameMarkup.editState.anchors=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]);var e=this.frameMarkup.editState;e.style[u.THICKNESS]=this.editState.style[u.THICKNESS],e.style[u.OPACITY]=this.editState.style[u.OPACITY],e.style[u.FILL_COLOR]=this.editState.style[u.FILL_COLOR],e.style[u.FILL_OPACITY]=this.editState.style[u.FILL_OPACITY],this.editState.isFrameUsed?(e.style[u.COLOR]=this.editState.style[u.COLOR],e.style[u.OPACITY]=1):(e.style[u.COLOR]=this.editState.style[u.FILL_COLOR],e.style[u.OPACITY]=this.editState.style[u.FILL_OPACITY]);var t=this.getWorldBoundingBox(),n=e.style[u.THICKNESS]/2;this.frameMarkup.editState.anchors[0].set(t.min.x+n,t.min.y+n,0),this.frameMarkup.editState.anchors[1].set(t.max.x-n,t.min.y+n,0),this.frameMarkup.editState.anchors[2].set(t.max.x-n,t.max.y-n,0),this.frameMarkup.editState.anchors[3].set(t.min.x+n,t.max.y-n,0),e.rotation=this.editState.rotation,this.frameMarkup.updateMatrix(),this.frameMarkup.render()}},{key:"removeFrame",value:function(){this.frameMarkup&&(this.frameMarkup.remove(!1),this.frameMarkup=null)}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.removeFrame(),Oo(Ko(a.prototype),"remove",this).call(this,e)}},{key:"changeTransparency",value:function(e){this.frameMarkup&&(this.frameMarkup.transparent=e),Oo(Ko(a.prototype),"changeTransparency",this).call(this,e)}},{key:"resetFrameBoundingBox",value:function(){this.frameMarkup&&(this.frameMarkup.rotatedBoundingBox=null,this.frameMarkup.boundingBox=null)}},{key:"setState",value:function(e){this.resetFrameBoundingBox(),Oo(Ko(a.prototype),"setState",this).call(this,e)}},{key:"setEditState",value:function(e,t,n){if(t&&t.style){var r=Object.assign({},e,t),A=this.markupsExtension.renderer.getFontToWorldScale(),i=this.getTextWidthInFontScale().width,s=this.getTextStyle(this.editState),c=this.getTextStyle(r);s.width="".concat(i,"px"),c.width="".concat(i,"px");var l=It(this.editState.text,s),h=It(r.text,c);if(h.height!==l.height){var p=(h.height-l.height)*A,d=this.getBoundingBoxVerticalTranslation(p);if(this.shouldRenderFrame()){var f=this.calculateFrameSize(this.editState.style[u.FONT_SIZE]),y=this.calculateFrameSize(r.style[u.FONT_SIZE])-f,g=new THREE.Vector3(y,-y,0);this._rotateTranslationVector(g),d.add(g)}if(t.translation)t.translation.add(d);else{var E=this.getEditState().translation;E.add(d),t.translation=E}}t.isFrameUsed=r.style[u.COLOR]!==o.NO_COLOR}this.resetFrameBoundingBox(),Oo(Ko(a.prototype),"setEditState",this).call(this,e,t,n)}},{key:"getTextWidthInFontScale",value:function(){var e=Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIOSDevice(),t=this.markupsExtension.renderer.getFontToWorldScale(),n=this.getWorldBoundingBoxTextOnly().getSize(new THREE.Vector3).x/t;return{preciseWidth:n,width:e?n:Math.ceil(n)||1}}},{key:"getBoundingBoxVerticalTranslation",value:function(e){var t=new THREE.Vector3(0,-e/2,0);return this._rotateTranslationVector(t),t}},{key:"_rotateTranslationVector",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector();it.applyRotation(e,t,new THREE.Vector3,n)}}},{key:"_rotateBoundingBox",value:function(e){var t=this.getRotation();if(0===t)return e;var n=e.getCenter(new THREE.Vector3),r=e.getSize(new THREE.Vector3),A=this.markupsExtension.renderer.getCameraEyeVector(),i=new THREE.Box3;return[e.min,e.min.clone().add(new THREE.Vector3(r.x,0,0)),e.max,e.min.clone().add(new THREE.Vector3(0,r.y,0))].forEach((function(e){it.applyRotation(e,t,n,A),i.expandByPoint(e)})),i}},{key:"_calculateWorldBoundingBoxText",value:function(){var e=this,t=new THREE.Box3,n=lt.cloneDeep(this.editState.anchors);n.forEach((function(t){e.applyScaleAndTranslation(t)})),n.forEach((function(e){t.expandByPoint(e)}));var r=t.getCenter(new THREE.Vector3),A=this.getTextStyle(),i=this.markupsExtension.renderer.getFontToWorldScale(),o=It("A",A);t.getSize(new THREE.Vector3).x<o.width*i&&(t.min.x=r.x,t.max.x=r.x,t.expandByVector(new THREE.Vector3(o.width*i/2,0,0)));var a=Math.ceil(t.getSize(new THREE.Vector3).x/i);return A.width="".concat(a,"px"),o=It(this.editState.text,A),t.min.y=r.y,t.max.y=r.y,t.expandByVector(new THREE.Vector3(0,o.height*i/2,0)),t}},{key:"calculateWorldBoundingBox",value:function(e){var t=this._calculateWorldBoundingBoxText();if(this.shouldRenderFrame()){var n=this.getWorldFrameSize();t.expandByVector(new THREE.Vector3(n,n,0))}return e?this._rotateBoundingBox(t):t}},{key:"calculateFrameSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.editState.style[u.THICKNESS],n=this.markupsExtension.renderer.getFontToWorldScale(),r=e*n/2;return this.editState.isFrameUsed?this.editState.frameType===B&&(t+=this.markupsExtension.renderer.geometryManager.getCloudMinimumRadius(t)/2):t=0,r+t}},{key:"getWorldFrameSize",value:function(){return this.calculateFrameSize(this.editState.style[u.FONT_SIZE])}},{key:"getClientFrameSize",value:function(){var e=this.getWorldFrameSize();return this.markupsExtension.renderer.sizeFromWorldToClient(e)}},{key:"getWorldBoundingBoxTextOnly",value:function(e){if(!this.shouldRenderFrame())return this.getWorldBoundingBox(e).clone();var t=this.getWorldBoundingBox(!1).clone(),n=this.getWorldFrameSize();return t.expandByVector(new THREE.Vector3(-n,-n,0)),e?this._rotateBoundingBox(t):t}},{key:"getClientBoundingBoxTextOnly",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getWorldBoundingBoxTextOnly(e);return n.min=this.markupsExtension.renderer.worldToClient(n.min),n.max=this.markupsExtension.renderer.worldToClient(n.max),t&&it.swapBoundingBoxY(n),n}},{key:"getTextStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getEditState(),t=e.style,n={};return n.color=t[u.FONT_COLOR],n.fontFamily=t[u.FONT_FAMILY],n.opacity=t[u.OPACITY]*(this.isTransparent()?je:1),n.fontSize="".concat(t[u.FONT_SIZE],"px"),n.fontWeight=t[u.FONT_WEIGHT],n.fontStyle=t[u.FONT_STYLE],n.whiteSpace=e.isSingleLine?"nowrap":"pre-wrap",n.lineHeight=1,n.backgroundColor=null,n}},{key:"getMinimumSize",value:function(){var e=Oo(Ko(a.prototype),"getMinimumSize",this).call(this),t=this.getTextStyle(),n=It("A",t),r=this.markupsExtension.renderer.getFontToWorldScale();return Math.max(this.markupsExtension.renderer.sizeFromWorldToClient(n.width*r+2*this.getWorldFrameSize()),e)}},{key:"isTextMarkup",value:function(){return!0}},{key:"isGeometricMarkup",value:function(){return!1}},{key:"isWithFillMarkup",value:function(){return!0}},{key:"getStartPointForNextMarkup",value:function(){return this.getWorldBoundingBox().getCenter(new THREE.Vector3)}}],n&&Io(t.prototype,n),a}(ii);function Go(e){return Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Go(e)}function jo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wo(e,t,n){return Wo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Zo(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},Wo(e,t,n||e)}function Xo(e,t){return Xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Xo(e,t)}function Jo(e,t){return!t||"object"!==Go(t)&&"function"!=typeof t?zo(e):t}function zo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zo(e){return Zo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Zo(e)}Vo.singleClickMarkup=!0;var qo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xo(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Zo(r);if(A){var n=Zo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Jo(this,e)});function o(e,t,n){var r,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};jo(this,o),(r=i.call(this,e,t,x,n,A)).markupsExtension.viewer.impl.is2d&&r.registerDimensionEditHandler(),r.textMarkup=new Vo(e,t),r.textMarkup.editState.isFrameUsed=!1,r.registerTextInputHandler({singleLine:!0,onEmptyTextMarkup:r.onEmptyTextMarkup.bind(zo(r)),submitChanges:r.onSubmitChanges.bind(zo(r))}),r.getTextStyle=r.textMarkup.getTextStyle.bind(r.textMarkup);var a=r.textInputHandler.editStart;r.textInputHandler.editStart=function(){a.bind(r.textInputHandler)(),r.onTextMarkupEditStart()};var s=r.textInputHandler.editEnd;return r.textInputHandler.editEnd=function(){s.bind(r.textInputHandler)(),r.onTextMarkupEditEnd()},r.textMarkup.textInputHandler=r.textInputHandler,r}return t=o,n=[{key:"setVisible",value:function(e,t){Wo(Zo(o.prototype),"setVisible",this).call(this,e,t),this.textMarkup.setVisible(e,t)}},{key:"setState",value:function(e){Wo(Zo(o.prototype),"setState",this).call(this,e),this.textMarkup.rotatedBoundingBox=null,this.textMarkup.boundingBox=null,this.textMarkup.resetFrameBoundingBox()}},{key:"setEditState",value:function(e,t,n){this.textMarkup.rotatedBoundingBox=null,this.textMarkup.boundingBox=null,this.textMarkup.resetFrameBoundingBox(),Wo(Zo(o.prototype),"setEditState",this).call(this,e,t,n)}},{key:"createDimension",value:function(){this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.strokeMaterial||(this.editState.style[u.THICKNESS]*=Ve,this.strokeMaterial=this.materialManager.addMaterial(this,!1),this.editState.style[u.THICKNESS]/=Ve),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=ii.createMesh(this.meshLine.geometry,this.strokeMaterial),this.meshContainer.add(this.strokeMesh),this.setPosition()}},{key:"calculateWorldBoundingBox",value:function(e){var t=Wo(Zo(o.prototype),"calculateWorldBoundingBox",this).call(this,e),n=this.textMarkup.calculateWorldBoundingBox(!0);return t.union(n)}},{key:"renderText",value:function(){var e=this.getEditState(),t=e.anchors,n=e.text,r=e.style,A=lt.cloneDeep(r);A[u.FONT_SIZE]*=Ge,this.textMarkup.enabled=this.enabled,this.textMarkup.transparent=this.isTransparent(),this.textMarkup.editState.style=A,this.textMarkup.editState.text=n,this.textMarkup.editState.isSingleLine=!0;var i=t[0].clone().add(t[1]).multiplyScalar(.5);this.applyScaleAndTranslation(i),this.textMarkup.creationHandler.calculateAnchorsByCenterPoint(i);var o=this.markupsExtension.renderer.getCameraRotation(),a=this.markupsExtension.renderer.getCameraEyeVector(),s=this.textMarkup.editState.anchors;s.forEach((function(e){it.applyRotation(e,o,i,a)}));var c=it.getSignedAngle(this.markupsExtension.renderer.getCameraRightVector(),t[1].clone().sub(t[0]),this.markupsExtension.renderer.getCameraEyeVector());Math.abs(c)>Math.PI/2&&(c+=Math.PI),this.textMarkup.editState.rotation=c-o;var l=s[1].clone(),h=s[2].clone();it.applyRotation([l,h],this.textMarkup.editState.rotation,i,a);var p=this.editState.style[u.THICKNESS]*Ve*Ke,d=h.clone().sub(l),f=d.clone().normalize().multiplyScalar(p).add(d.multiplyScalar(.5));s.forEach((function(e){e.add(f)})),this.textMarkup.render()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;Wo(Zo(o.prototype),"render",this).call(this);var t=e.anchors;if(t&&t.length>1&&this.createDimension(),this.strokeMesh){if(e.style){this.editState.style[u.THICKNESS]*=Ve;var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);this.editState.style[u.THICKNESS]/=Ve,r&&(this.strokeMaterial=r,this.strokeMesh.material=r,n&&this.createDimension())}e.translation&&(this.createDimension(),this.setPosition()),this.renderText(),this.markupsExtension.renderer.invalidate()}}},{key:"isTextMarkup",value:function(){return!0}},{key:"isWithFillMarkup",value:function(){return!0}},{key:"onEmptyTextMarkup",value:function(){this.markupsExtension.markupsManager.actionManager.undo();var e=this.creationHandler.getDistance();this.creationHandler.updateEditState({text:e}),this.creationHandler.submitChanges()}},{key:"onSubmitChanges",value:function(){this.textInputHandler.submitChanges(),this.hasChanges=!0}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.textMarkup.remove(!1),Wo(Zo(o.prototype),"remove",this).call(this,e)}},{key:"onTextMarkupEditStart",value:function(){var e=this.textMarkup.editState.text;"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,e.length-1)),this.hasChanges=!1,this.creationHandler.updateEditState({text:e})}},{key:"onTextMarkupEditEnd",value:function(){var e=this.textMarkup.editState.text;"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,e.length-1)),""!==e&&(this.hasChanges?(this.markupsExtension.markupsManager.actionManager.undo(),this.creationHandler.updateEditState({text:"(".concat(e,")")}),this.creationHandler.submitChanges()):e!==this.creationHandler.getDistance()&&this.creationHandler.updateEditState({text:"(".concat(e,")")}))}}],n&&Yo(t.prototype,n),o}(ii);function $o(e){return $o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$o(e)}function ea(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ta(e,t){return ta=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ta(e,t)}function na(e,t){return!t||"object"!==$o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ra(e){return ra=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ra(e)}qo.withSnappingMarkup=!0;var Aa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ta(e,t)}(A,e);var t,n,r=(t=A,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ra(t);if(n){var A=ra(this).constructor;e=Reflect.construct(r,arguments,A)}else e=r.apply(this,arguments);return na(this,e)});function A(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ea(this,A),r.call(this,e,t,M,n,i)}return A}(pi);function ia(e){return ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ia(e)}function oa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function aa(e,t,n){return aa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ca(e)););return e}(e,t);if(r){var A=Object.getOwnPropertyDescriptor(r,t);return A.get?A.get.call(n):A.value}},aa(e,t,n||e)}function sa(e,t){return sa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},sa(e,t)}function ua(e,t){return!t||"object"!==ia(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ca(e){return ca=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ca(e)}var la=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sa(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ca(r);if(A){var n=ca(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ua(this,e)});function o(e,t,n,r,A){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,e,t,n,r,A)}return t=o,n=[{key:"render",value:function(){arguments.length>0&&void 0!==arguments[0]||this.editState}},{key:"intersect",value:function(e){return!1}},{key:"isGroupMarkup",value:function(){return!0}},{key:"select",value:function(e){this.selected=!0,this.enableEdit(),e&&(this.setLocked(!0),this.markups.forEach((function(t){return t!==e&&!t.isSelected()&&t.select()})),this.setLocked(!1)),this.setDirty()}},{key:"setHover",value:function(e,t){this.hover!==e&&(this.hover=e,t&&(this.setLocked(!0),this.markups.forEach((function(n){return n!==t&&n.isHovered()!==e&&n.setHover(e)})),this.setLocked(!1)),this.setDirty())}},{key:"calculateWorldBoundingBox",value:function(){var e=new THREE.Box3;return this.markups.forEach((function(t){var n=t.getWorldBoundingBox(!0);e.union(n)})),e}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.markups.forEach((function(t){return t.remove(e)})),aa(ca(o.prototype),"remove",this).call(this,e)}},{key:"syncGroupMarkups",value:function(e,t,n,r,A){r.anchors&&this.applyConstraints(e,t,n),r.translation&&A instanceof mn&&0===A.keyTranslation.length()&&this.applyTranslation(e,t,n),r.scale&&A instanceof Nn&&this.applyScale(e,t,n),r.style&&this.applyStyle(e,t,n,r),r.text&&this.applyTextChange(e,t,n)}},{key:"applyConstraints",value:function(e,t,n){}},{key:"applyTranslation",value:function(e,t,n){}},{key:"applyStyle",value:function(e,t,n,r){}},{key:"applyScale",value:function(e,t,n){}},{key:"applyTextChange",value:function(e,t,n){}}],n&&oa(t.prototype,n),o}(ii);function ha(e){return ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ha(e)}function pa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function da(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fa(e,t){return fa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},fa(e,t)}function ya(e,t){return!t||"object"!==ha(t)&&"function"!=typeof t?ga(e):t}function ga(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ea(e){return Ea=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ea(e)}var Ba=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fa(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ea(r);if(A){var n=Ea(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ya(this,e)});function o(e,t,n,r){var A,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};pa(this,o);var s=(A=i.call(this,e,t,n,r,a)).getTextMarkup();return s.textInputHandler.onEmptyTextMarkup=A.onEmptyTextMarkup.bind(ga(A)),A}return t=o,(n=[{key:"getArrowMarkup",value:function(){throw new Error("getArrowMarkup should be implemented")}},{key:"getTextMarkup",value:function(){throw new Error("getTextMarkup should be implemented")}},{key:"getShapeMarkup",value:function(){throw new Error("getShapeMarkup should be implemented")}},{key:"getQuadrant",value:function(e,t){var n=e.getWorldBoundingBox(!0),r=Math.atan2(n.getSize(new THREE.Vector3).y,n.getSize(new THREE.Vector3).x);return t>=-(Math.PI-r)&&t<-r?1:t>=-r&&t<r?2:t>=r&&t<Math.PI-r?3:4}},{key:"getTextQuadrant",value:function(e){return this.getQuadrant(this.getTextMarkup(),e)}},{key:"getShapeQuadrant",value:function(e){return this.getQuadrant(this.getShapeMarkup(),e)}},{key:"getVectorToClosestPointOnCloud",value:function(e){var t=this.getTextMarkup().frameMarkup.meshLine.sourceGeo,n=1/0,r=null;return t.forEach((function(t){var A=e.distanceToSquared(t);A<n&&(n=A,r=t)})),e.clone().sub(r)}},{key:"applyArrowTextConstraint",value:function(e){var t=this.getArrowMarkup(),n=this.getTextMarkup();if((e=e||t.getEditState()).anchors[0]&&e.anchors[1]){var r=n.getWorldBoundingBox(!0),A=r.getCenter(new THREE.Vector3),i=n.editState.style[u.THICKNESS]/2,o=r.getSize(new THREE.Vector3).y/2-i,a=r.getSize(new THREE.Vector3).x/2-i,s=e.anchors[0],c=e.anchors[1].clone();t.applyScaleAndTranslation(c);var l=Math.atan2(c.y-A.y,c.x-A.x);switch(this.getTextQuadrant(l)){case 1:s.set(A.x,A.y-o,0);break;case 2:s.set(A.x+a,A.y,0);break;case 3:s.set(A.x,A.y+o,0);break;case 4:s.set(A.x-a,A.y,0)}if(n.editState.frameType===B){var h=s.clone().sub(A),p=this.getVectorToClosestPointOnCloud(h).negate();s.add(p)}t.applyInverseScaleAndTranslation(s),t.creationHandler.updateEditStateAnchors()}}},{key:"applyShapeArrowConstraint",value:function(e){var t=this.getArrowMarkup(),n=this.getShapeMarkup();if((e=e||t.getEditState()).anchors[0]&&e.anchors[1]){var r=n.getWorldBoundingBox(!0),A=r.getCenter(new THREE.Vector3),i=r.getSize(new THREE.Vector3),o=i.y/2,a=i.x/2,s=e.anchors[1],u=e.anchors[0].clone();t.applyScaleAndTranslation(u);var c,l=u.x-A.x,h=u.y-A.y,p=Math.atan2(h,l),d=function(e){return e>0?1:-1};switch(this.getShapeQuadrant(p)){case 1:c=d(l)*a/3,s.set(A.x+c,A.y-o,0);break;case 2:c=d(h)*o/3,s.set(A.x+a,A.y+c,0);break;case 3:c=d(l)*a/3,s.set(A.x+c,A.y+o,0);break;case 4:c=d(h)*o/3,s.set(A.x-a,A.y+c,0)}t.applyInverseScaleAndTranslation(s),t.creationHandler.updateEditStateAnchors()}}},{key:"applyArrowConstraints",value:function(e){throw new Error("applyArrowTextConstraint must be implemented")}},{key:"applyConstraints",value:function(e,t,n){throw new Error("applyConstraints must be implemented")}},{key:"applyTranslation",value:function(e,t,n){var r=this;this.markups.forEach((function(A){if(A!==e&&A.isCompleted()){if(A.setLocked(!0),e.type===y){var i=n.translation.clone().sub(t.translation);i=A.editState.translation.clone().add(i),A.creationHandler.updateEditState({translation:i})}else r.applyArrowConstraints();A.setLocked(!1)}}))}},{key:"applyStyle",value:function(e,t,n,r){var A=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&(t.setLocked(!0),t.creationHandler.updateEditState({style:r.style}),A.applyArrowConstraints(),t.setLocked(!1))}))}},{key:"applyScale",value:function(e,t,n){var r=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&t.type===y&&(t.setLocked(!0),r.applyArrowConstraints(),t.setLocked(!1))}))}},{key:"applyTextChange",value:function(e,t,n){this.applyArrowConstraints()}},{key:"onEmptyTextMarkup",value:function(){this.markupsExtension.markupsManager.actionManager.undo();var e=this.getTextMarkup();e.creationHandler.updateEditState({text:e.getDefaultState().text}),e.creationHandler.submitChanges()}}])&&da(t.prototype,n),o}(la);function ma(e){return ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ma(e)}function va(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ka(e,t){return ka=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ka(e,t)}function Ca(e,t){return!t||"object"!==ma(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ba(e){return ba=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ba(e)}Ba.withSnappingMarkup=!0;var Sa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ka(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ba(r);if(A){var n=ba(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ca(this,e)});function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return va(this,o),i.call(this,e,t,S,n,r)}return t=o,(n=[{key:"getTextMarkup",value:function(){return this.markups[1]}},{key:"getArrowMarkup",value:function(){return this.markups[0]}},{key:"applyArrowConstraints",value:function(e){this.applyArrowTextConstraint(e)}},{key:"applyConstraints",value:function(e,t,n){var r=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&e.type===y&&e.anchorHandler.activeAnchor===e.getHead()&&(e.setLocked(!0),r.applyArrowConstraints(n),e.setLocked(!1))}))}}])&&wa(t.prototype,n),o}(Ba);function Ta(e){return Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ta(e)}function xa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ma(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ua(e,t){return Ua=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ua(e,t)}function Qa(e,t){return!t||"object"!==Ta(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function La(e){return La=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},La(e)}var Fa,Ra=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ua(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=La(r);if(A){var n=La(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Qa(this,e)});function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return xa(this,o),i.call(this,e,t,T,n,r)}return t=o,(n=[{key:"getTextMarkup",value:function(){return this.markups[2]}},{key:"getArrowMarkup",value:function(){return this.markups[1]}},{key:"getShapeMarkup",value:function(){return this.markups[0]}},{key:"applyArrowConstraints",value:function(e){this.applyArrowTextConstraint(e),this.applyShapeArrowConstraint(e)}},{key:"applyConstraints",value:function(e,t,n){var r=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&e.type===y&&(e.setLocked(!0),t.type===B?r.applyShapeArrowConstraint(n):r.applyArrowTextConstraint(n),e.setLocked(!1))}))}}])&&Ma(t.prototype,n),o}(Ba);function Ha(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _a=(Ha(Fa={},y,mi),Ha(Fa,w,xi),Ha(Fa,k,_i),Ha(Fa,g,Zi),Ha(Fa,E,Ao),Ha(Fa,B,ho),Ha(Fa,m,To),Ha(Fa,v,Ho),Ha(Fa,S,Sa),Ha(Fa,T,Ra),Ha(Fa,b,Vo),Ha(Fa,C,Vo),Ha(Fa,x,qo),Ha(Fa,M,Aa),Fa);function Da(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ia=Autodesk.Viewing,Oa=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=t.viewer,this.names=["markups"],this.isActive=!1,this.onCameraChangedBinded=this.onCameraChanged.bind(this),this.onEditStartBinded=this.onEditStart.bind(this),this.onEditEndBinded=this.onEditEnd.bind(this),this.onDrawEndBinded=this.onDrawEnd.bind(this),this.onCreationTypeChangedBinded=this.onCreationTypeChanged.bind(this),this.onSelectionChangedBinded=this.onSelectionChanged.bind(this),this.rectSelector=new on(this.markupsExtension),this.lastDrawEndTime=-1/0}var t,n;return t=e,(n=[{key:"getNames",value:function(){return this.names}},{key:"getName",value:function(){return this.names[0]}},{key:"getPriority",value:function(){return this.markupsExtension.markupsManager.isMarkupSessionOpen()?200:40}},{key:"updateToolPriority",value:function(){this.markupsExtension.viewer.toolController.rearrangeByPriorities()}},{key:"intersectHandler",value:function(e,t){if(this.lastMousePos)for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.isCompleted()){var A=r[t];if(A){var i=this.lastMousePos.clone();if(A.intersect(i)||A.isDragging())return A.getCursor()}}}return null}},{key:"getCursor",value:function(){var e=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1),t=this.markupsExtension.markupsManager.getEnabledMarkups(),n=this.markupsExtension.markupsManager.getActiveLayer(),r=this.hasSelection(),A=null;if(this.markupsExtension.markupsManager.isMarkupSessionOpen()){var i=this.markupsExtension.markupsManager.getInEditMarkups(),o=n.getAllLinks();A=(A=(A=(A=(A=(A=(A=e&&e.creationHandler.getCursor())||this.intersectHandler(o,"anchorHandler"))||this.intersectHandler(i,"anchorHandler"))||this.intersectHandler(i,"scaleHandler"))||this.intersectHandler(i,"rotationHandler"))||this.intersectHandler(i,"translationHandler"))||this.intersectHandler(i,"dimensionEditHandler")}if(A=A||this.intersectHandler(t,"selectionHandler"),!this.markupsExtension.markupsManager.isMarkupSessionOpen()){var a=this.markupsExtension.markupsManager.getVisibleLinks();A=A||this.intersectHandler(a,"selectionHandler")}var s=this.markupsExtension.markupsManager.getMarkupCreationType();return A||s!==U||this.isRectSelectorActive()||(A="auto"),A||s&&(r&&!this.isRectSelectorActive()?"auto":rt[s]||"crosshair")}},{key:"register",value:function(){this.snapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer,{markupMode:!0}),this.viewer.toolController.registerTool(this.snapper)}},{key:"deregister",value:function(){this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null)}},{key:"activate",value:function(e){e!==this.getName()||this.isActive||(this.isActive=!0,this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_START,this.onEditStartBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_END,this.onEditEndBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_END,this.onDrawEndBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onCreationTypeChangedBinded),this.addDocumentEventListener("selectionchange",this.onSelectionChangedBinded))}},{key:"deactivate",value:function(e){e===this.getName()&&this.isActive&&(this.isActive=!1,this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_START,this.onEditStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_END,this.onEditEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_END,this.onDrawEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onCreationTypeChangedBinded),this.removeDocumentEventListener("selectionchange",this.onSelectionChangedBinded),this.onCreationTypeChanged())}},{key:"onSelectionChanged",value:function(){this.markupsExtension.markupsManager.getSelectedMarkups().forEach((function(e){e.isTextMarkup()&&e.isInEdit()&&e.textInputHandler.updateCaretPosition()}))}},{key:"eventToWorld",value:function(e){var t={x:e.canvasX,y:e.canvasY};return this.markupsExtension.renderer.clientToWorld(t)}},{key:"getSnappedPosition",value:function(){if(!this.lastSnapPoint)if(this.viewer.impl.is2d||this.isSnappingAllowed()){var e={x:this.originalEvent.canvasX,y:this.originalEvent.canvasY};if(this.snapper.onMouseMove(e),this.viewer.model.isLeaflet()||this.snapper.indicator.render(),this.snapper.isSnapped()){var t=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer);this.lastSnapPoint=this.markupsExtension.renderer.documentCameraToMarkupsCamera(t)}else this.lastSnapPoint=this.lastMousePos}else this.lastSnapPoint=this.lastMousePos;return this.lastSnapPoint.clone()}},{key:"applyHandler",value:function(e,t,n,r){for(var A=e.length-1;A>=0;A--){var i=e[A];if(i.isCompleted()){var o=i[t];if(o&&o[n](this.lastMousePos,r))return!0}}return!1}},{key:"isNavigationToolActive",value:function(){return this.viewer.getActiveNavigationTool()!==this.getName()}},{key:"isSnappingAllowed",value:function(){var e=this.markupsExtension.markupsManager.getMarkupCreationType();return e&&_a[e].withSnappingMarkup&&(e===x||!this.viewer.model.isLeaflet())}},{key:"isRectSelectorActive",value:function(){return this.markupsExtension.markupsManager.isMarkupSessionOpen()&&this.markupsExtension.markupsManager.getMarkupCreationType()===U}},{key:"hasSelection",value:function(){var e=this.markupsExtension.markupsManager.isMarkupSessionOpen();return this.markupsExtension.markupsManager.getSelectedMarkups().length>0||!e&&(this.markupsExtension.markupsManager.getSelectedLayers().length>0||this.markupsExtension.markupsManager.getSelectedLinks().length>0)}},{key:"handleMouseEvent",value:function(e,t,n,r){if(!this.markupsExtension.isToolEnabled())return!1;this.lastMousePos=this.eventToWorld(e),this.originalEvent=e,this.markupsExtension.renderer.updateRaycaster({x:e.canvasX,y:e.canvasY});var A,i,o=this.markupsExtension.markupsManager.getMarkupCreationType(),a=this.markupsExtension.markupsManager.isMarkupSessionOpen();if(!this.markupInEdit&&(!o||!_a[o].useTimerBeforeSelection||_a[o].useTimerBeforeSelection&&performance.now()-this.lastDrawEndTime>nt)){var s=this.markupsExtension.markupsManager.getEnabledMarkups().filter((function(e){return!e.isSelected()}));A=A||this.applyHandler(s,"selectionHandler",n,t)}var u=this.markupsExtension.markupsManager.getActiveLayer();if(o&&(i=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1))&&!i.isCompleted())if(A)i.creationHandler.creationCancel();else{var c=i.creationHandler.getSnappedPosition();A="handleMouseMove"===n&&!this.mouseMoved&&!i.creationHandler.creationStarted||i.creationHandler[n](c,t)}if(a){var l=u.getAllLinks();A=A||this.applyHandler(l,"anchorHandler",n,t);var h=this.markupsExtension.markupsManager.getInEditMarkups();A=(A=(A=(A=(A=(A=A||this.applyHandler(h,"scaleHandler",n,t))||this.applyHandler(h,"anchorHandler",n,t))||this.applyHandler(h,"rotationHandler",n,t))||this.applyHandler(h,"translationHandler",n,t))||this.applyHandler(h,"dimensionEditHandler",n,t))||this.applyHandler(h,"textInputHandler",n,t)}if(!A&&"handleMouseMove"===n&&this.isSnappingAllowed()&&this.getSnappedPosition(),this.isRectSelectorActive()&&(A=A||this.rectSelector[n](this.lastMousePos)),!a){var p=this.markupsExtension.markupsManager.getVisibleLinks();A=A||this.applyHandler(p,"selectionHandler",n,t)}if(!A&&("handleButtonUp"===n||"handleButtonDown"===n&&o&&_a[o].singleClickMarkup)&&(!this.hasSelection()||this.shiftDown||this.mouseMoved||this.isRectSelectorActive()||(this.markupsExtension.markupsManager.deselectAllMarkups(),this.markupsExtension.markupsManager.deselectAllLinks(),a||this.markupsExtension.markupsManager.deselectAllLayers(null),A=!0)),!A&&r&&o&&!this.isNavigationToolActive()&&(i=this.markupsExtension.markupsManager.getDuringCreationMarkup(!0))){var d=i.creationHandler.getSnappedPosition();(A=i.creationHandler[n](d,t))||i.creationHandler.creationCancel()}return this.lastSnapPoint=null,A}},{key:"handleButtonDown",value:function(e,t){if(this.dragging=!0,this.buttonDownPos=new THREE.Vector2(e.canvasX,e.canvasY,0),this.mouseMoved=!1,this.buttonDownConsumed=!1,this.selectedOnDown=!1,this.panning=!Autodesk.Viewing.isMobileDevice()&&(this.isRightClick(e)||this.isMiddleClick(e)),this.panning)return!1;this.markupsExtension.markupsManager.dispatchEvent({type:A.BUTTON_DOWN}),this.buttonDownConsumed=this.handleMouseEvent(e,t,"handleButtonDown",!0);var n=this.markupsExtension.markupsManager.getSelectedMarkups();return this.selectedOnDown=n.length>0,this.buttonDownConsumed}},{key:"handleButtonUp",value:function(e,t){if(this.dragging=!1,this.buttonDownPos=null,this.buttonUpConsumed=!1,this.buttonUpCalled=!0,this.panning||this.mouseMoved&&!this.buttonDownConsumed)return this.panning=!1,this.mouseMoved=!1,!1;var n=this.handleMouseEvent(e,t,"handleButtonUp",!1),r=this.markupsExtension.markupsManager.getSelectedMarkups();if(!this.mouseMoved&&this.selectedOnDown&&!r[0]){var A=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1);A&&A.creationHandler.creationCancel(),this.markupsExtension.markupsManager.deselectAllMarkups()}this.buttonUpConsumed=n;var i=this.mouseMoved;return this.mouseMoved=!1,n&&i||this.isRectSelectorActive()}},{key:"handleDoubleClick",value:function(e,t){var n=this.handleMouseEvent(e,t,"handleDoubleClick",!1),r=this.markupsExtension.markupsManager.isMarkupSessionOpen()&&this.markupsExtension.markupsManager.getMarkupCreationType();return n||r}},{key:"handleMouseMove",value:function(e){if(this.panning)return!1;this.buttonDownPos&&!this.mouseMoved&&(this.mouseMoved=new THREE.Vector2(e.canvasX,e.canvasY,0).distanceTo(this.buttonDownPos)>Ce),this.markupsExtension.markupsManager.unhoverAllLayers(),this.markupsExtension.markupsManager.unhoverAllMarkups();var t=this.handleMouseEvent(e,null,"handleMouseMove",!1);return this.dragging&&t}},{key:"handleKeyDown",value:function(e,t){var n=this,r=this.markupsExtension.markupsManager.getInEditMarkups(),i=!1,o=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1);if(o)i=o.creationHandler.handleKeyDown(e,t);else{var a;this.markupsExtension.markupsManager.openActionGroup();for(var s=r.length-1;s>=0;s--){var u=r[s];u&&u.isCompleted()&&((a=u.anchorHandler&&u.anchorHandler.handleKeyDown(e,t))||(a=u.textInputHandler&&u.textInputHandler.handleKeyDown(e,t)),a||(a=u.scaleHandler&&u.scaleHandler.handleKeyDown(e,t)),a||(a=u.rotationHandler&&u.rotationHandler.handleKeyDown(e,t)),a||(a=u.translationHandler&&u.translationHandler.handleKeyDown(e,t)),a||(a=u.dimensionEditHandler&&u.dimensionEditHandler.handleKeyDown(e,t)),a||(a=u.selectionHandler&&u.selectionHandler.handleKeyDown(e,t))),i=i||a}this.markupsExtension.markupsManager.closeActionGroup()}for(var c=this.markupsExtension.markupsManager.getVisibleLinks(),l=c.length-1;l>=0;l--){var h=c[l];i=(i=i||h.anchorHandler&&h.anchorHandler.handleKeyDown(e,t))||h.selectionHandler&&h.selectionHandler.handleKeyDown(e,t)}if(!i)switch(t){case Autodesk.Viewing.KeyCode.CONTROL:this.ctrlDown=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:this.shiftDown=!0,i=!0;break;case Autodesk.Viewing.KeyCode.a:this.ctrlDown&&this.markupsExtension.markupsManager.isMarkupSessionOpen()&&(this.markupsExtension.markupsManager.getActiveLayer().selectAllMarkups(),i=!0);break;case Autodesk.Viewing.KeyCode.x:this.ctrlDown&&(this.markupsExtension.cut(),i=!0);break;case Autodesk.Viewing.KeyCode.c:this.ctrlDown&&(this.markupsExtension.copy(),i=!0);break;case Autodesk.Viewing.KeyCode.v:this.ctrlDown&&(this.markupsExtension.paste(),i=!0);break;case Autodesk.Viewing.KeyCode.d:this.ctrlDown&&(this.markupsExtension.copy(),this.markupsExtension.paste(),i=!0);break;case Autodesk.Viewing.KeyCode.z:this.ctrlDown&&!this.shiftDown?(this.markupsExtension.undo(),i=!0):this.ctrlDown&&this.shiftDown&&(this.markupsExtension.redo(),i=!0);break;case Autodesk.Viewing.KeyCode.y:this.ctrlDown&&(this.markupsExtension.redo(),i=!0);break;case Autodesk.Viewing.KeyCode.ESCAPE:this.markupsExtension.markupsManager.getSelectedMarkups().length>0?(this.markupsExtension.markupsManager.deselectAllMarkups(),i=!0):this.markupsExtension.markupsManager.isMarkupSessionOpen()?(this.markupsExtension.markupsManager.getActiveLayer().isEmpty()?this.markupsExtension.endMarkupSession(!1):this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_DISCARD_PRESSED,onConfirmCB:function(){n.markupsExtension.endMarkupSession(!1)}}),i=!0):this.markupsExtension.markupsManager.getSelectedLayers().length>0&&(this.markupsExtension.markupsManager.deselectAllLayers(),i=!0);break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:this.markupsExtension.markupsManager.deleteInEditMarkups()}return i}},{key:"handleSingleClick",value:function(e,t){return this.buttonUpConsumed}},{key:"handleKeyUp",value:function(e,t){var n=this.markupsExtension.markupsManager.getInEditMarkups(),r=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1);if(r)r.creationHandler.handleKeyUp(e,t);else{this.markupsExtension.markupsManager.openActionGroup();for(var A=n.length-1;A>=0;A--){var i=n[A];i&&i.isCompleted()&&(e.isDuringEdit=A<n.length-1,i.anchorHandler&&i.anchorHandler.handleKeyUp(e,t)||i.translationHandler&&i.translationHandler.handleKeyUp(e,t))}this.markupsExtension.markupsManager.closeActionGroup()}switch(t){case Autodesk.Viewing.KeyCode.CONTROL:this.ctrlDown=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:this.shiftDown=!1}return!1}},{key:"onCameraChanged",value:function(){this.isSnappingAllowed()&&!this.viewer.model.isLeaflet()&&this.snapper.indicator.render()}},{key:"onCreationTypeChanged",value:function(){this.snapper.indicator.clearOverlays()}},{key:"onEditStart",value:function(){this.markupInEdit=!0,this.snapper.indicator.clearOverlays()}},{key:"onEditEnd",value:function(){this.markupInEdit=!1,this.snapper.indicator.clearOverlays()}},{key:"onDrawEnd",value:function(){this.lastDrawEndTime=performance.now()}},{key:"isMiddleClick",value:function(e){return Autodesk.Viewing.Private.isMiddleClick(e)}},{key:"isRightClick",value:function(e){return Autodesk.Viewing.Private.isRightClick(e,this.viewer.navigation)}},{key:"handleBlur",value:function(){this.ctrlDown=!1,this.shiftDown=!1}},{key:"handleSingleTap",value:function(e){var t=this.buttonUpConsumed;return this.buttonUpCalled||(this.handleButtonDown(e,0),t=this.handleButtonUp(e,0)||this.buttonUpConsumed),this.buttonUpCalled=!1,t}},{key:"handleDoubleTap",value:function(e){return this.handleDoubleClick(e,0)}},{key:"isNavigationJustEnded",value:function(){return this.navigationEndTime&&Date.now()-this.navigationEndTime<Ye}},{key:"handleGesture",value:function(e){var t;switch(e.type){case"dragstart":return!this.isNavigationJustEnded()&&this.handleButtonDown(e,0);case"dragmove":return!this.isNavigationJustEnded()&&this.handleMouseMove(e);case"dragend":return!this.isNavigationJustEnded()&&(t=this.handleButtonUp(e,0),this.buttonUpCalled=!1,t);case"pinchend":case"panend":this.navigationEndTime=Date.now()}return!1}}])&&Da(t.prototype,n),e}();function Pa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ia.GlobalManagerMixin.call(Oa.prototype);var Na=Autodesk.Viewing,Ka=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t.viewer,this.setGlobalManager(t.globalManager),this.options=t.options,this.markupsExtension=t,this.createUI()}var t,n;return t=e,(n=[{key:"createUI",value:function(){var e=this.options.uiClasses;if(e){var t=this.getDocument();this.uiContainer=t.createElement("div"),this.uiContainer.id="MarkupsUI_Container",this.uiContainer.className="MarkupsUI_Container",this.viewer.container.appendChild(this.uiContainer);var n=e.ToolbarClass;this.toolbar=n&&new n(this.markupsExtension,this.uiContainer,this.viewer,this.options);var r=e.CreationToastClass;this.creationToast=r&&new r(this.markupsExtension,this.uiContainer,this.viewer,this.options);var A=e.ContextualMenuClass;this.contextualMenu=A&&new A(this.markupsExtension,this.uiContainer,this.viewer,this.options);var i=e.AttachmentsPreviewPanelClass;this.attachmentsPreviewPanel=i&&new i(this.markupsExtension,this.uiContainer,this.viewer,this.options);var o=e.MarkupsDialogModalsClass;if(this.MarkupsDialogModals=o&&new o(this.markupsExtension,this.uiContainer,this.viewer,this.options),this.viewer.impl.is2d){var a=e.MarkupsVisibilityButtonClass;this.markupsVisibilityButton=a&&new a(this.markupsExtension,this.uiContainer,this.viewer,this.options)}else{var s=e.ExitMarkupViewClass;this.exitMarkupView=s&&new s(this.markupsExtension,this.uiContainer,this.viewer,this.options)}this.registerEventListeners()}}},{key:"destroy",value:function(){this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.creationToast&&(this.creationToast.destroy(),this.creationToast=null),this.contextualMenu&&(this.contextualMenu.destroy(),this.contextualMenu=null),this.attachmentsPreviewPanel&&(this.attachmentsPreviewPanel.destroy(),this.attachmentsPreviewPanel=null),this.markupsVisibilityButton&&(this.markupsVisibilityButton.destroy(),this.markupsVisibilityButton=null),this.exitMarkupView&&(this.exitMarkupView.destroy(),this.exitMarkupView=null),this.unregisterEventListeners(),this.uiContainer&&(this.viewer.container.removeChild(this.uiContainer),this.uiContainer=null),this.markupsExtension=null,this.viewer=null,this.options=null}},{key:"registerEventListeners",value:function(){this.onSessionStartBinded=this.onSessionStart.bind(this),this.onSessionEndBinded=this.onSessionEnd.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.onSessionStartBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.onSessionEndBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED,this.onSessionStartBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.onSessionEndBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onSessionStartBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.onSessionStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.onSessionEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED,this.onSessionStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.onSessionEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onSessionStartBinded)}},{key:"onSessionStart",value:function(){this.selectNavigationButton(null),this.viewer.impl.is2d&&this.handleNavButtonEvents(!0)}},{key:"onSessionEnd",value:function(){this.viewer.impl.is2d&&this.handleNavButtonEvents(!1),this.selectNavigationButton(this.markupsExtension.markupsManager.navigationToolBackup)}},{key:"getNavigationControls",value:function(){return this.viewer.getToolbar().getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID)._controls}},{key:"handleNavButtonEvents",value:function(e){var t=this;this.onNavButtonClickBinded=this.onNavButtonClick.bind(this);var n=this.getNavigationControls(),r=function(n){e?n.hasEventListener(Autodesk.Viewing.UI.Button.Event.CLICK,t.onNavButtonClickBinded)||n.addEventListener(Autodesk.Viewing.UI.Button.Event.CLICK,t.onNavButtonClickBinded):n.removeEventListener(Autodesk.Viewing.UI.Button.Event.CLICK,t.onNavButtonClickBinded)};n.forEach((function(e){r(e),e.subMenu&&e.subMenu._controls.forEach((function(e){r(e)}))}))}},{key:"onNavButtonClick",value:function(e){var t=this;this.getNavigationControls().forEach((function(n){n._id!==e.target._id?n.setState(Autodesk.Viewing.UI.Button.State.INACTIVE):n.getState()===Autodesk.Viewing.UI.Button.State.INACTIVE&&(t.markupsExtension.markupsManager.changeMarkupCreationType(null),n.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),setTimeout((function(){t.markupsExtension.markupsManager.navigationToolBackup=t.viewer.getActiveNavigationTool()})))}))}},{key:"selectNavigationButton",value:function(e){var t=function(t){var n=-1!==t._id.toLowerCase().indexOf(e);t.setState(n?Autodesk.Viewing.UI.Button.State.ACTIVE:Autodesk.Viewing.UI.Button.State.INACTIVE)};this.getNavigationControls().forEach((function(e){t(e),e.subMenu&&e.subMenu._controls.forEach((function(e){t(e)}))}))}}])&&Pa(t.prototype,n),e}();function Va(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Na.GlobalManagerMixin.call(Ka.prototype);var Ga=function(){function e(t,n,r,A,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.guid=t,this.resources=n||[],this.attachments=r||[],this.status=A,this.metadata=i||{}}var t,n;return t=e,(n=[{key:"getSvgResource",value:function(){return this.resources[0]&&this.resources[0].data}},{key:"getScreenCaptureResource",value:function(){return this.resources[1]&&this.resources[1].data}},{key:"getLinksMetadata",value:function(){return this.metadata&&this.metadata.markup_metadata&&this.metadata.markup_metadata.links}},{key:"getMetadata",value:function(){return this.metadata}}])&&Va(t.prototype,n),e}();function ja(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ya=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.viewer=t.viewer,this.link=n,this.link.syncEditState()}var t,n;return t=e,(n=[{key:"getEditState",value:function(){return this.link.getEditState()}},{key:"setEditState",value:function(e){this.link.setEditState(e)}},{key:"updateEditState",value:function(e){this.setEditState(Object.assign({},this.getEditState(),e))}},{key:"submitChanges",value:function(){new bt(this.markupsExtension.markupsManager,this.link,this.getEditState()).execute()}},{key:"isDragging",value:function(){return!1}},{key:"getTouchRadiusWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(we)}},{key:"getMinChangeDistanceWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(Ce)}},{key:"didMouseMove",value:function(){return this.markupsExtension.markupsTool.mouseMoved}},{key:"handleDoubleClick",value:function(e,t){}},{key:"handleButtonDown",value:function(e,t){}},{key:"handleButtonUp",value:function(e,t){}},{key:"handleKeyDown",value:function(e,t){}},{key:"handleKeyUp",value:function(e,t){}},{key:"handleMouseMove",value:function(e){}},{key:"handleGesture",value:function(e){}},{key:"handleResize",value:function(){}},{key:"destroy",value:function(){this.markupsExtension=null,this.viewer=null,this.link=null}}])&&ja(t.prototype,n),e}();function Wa(e){return Wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wa(e)}function Xa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ja(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function za(e,t){return za=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},za(e,t)}function Za(e,t){return!t||"object"!==Wa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qa(e){return qa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},qa(e)}var $a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&za(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qa(r);if(A){var n=qa(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Za(this,e)});function o(){return Xa(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"handleMouseMove",value:function(e){var t=this.grabbing||this.intersect(e);return this.link.setHover(t),!!this.grabbing&&(this.updatePosition(e),!0)}},{key:"handleButtonDown",value:function(e,t){return!!this.grabbing||(this.grabbing=this.intersect(e),this.grabbing&&(this.originalPosition=e.clone(),this.lastTranslationPoint=e),!!this.grabbing)}},{key:"handleButtonUp",value:function(e,t){return!!this.grabbing&&(this.updatePosition(e),Rt(e,this.originalPosition,this.getMinChangeDistanceWorld())?(this.cancelAnchorEditing(),!1):(this.submitChanges(),this.grabbing=!1,this.lastTranslationPoint=null,!0))}},{key:"handleKeyDown",value:function(e,t){if(this.grabbing)switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return this.cancelAnchorEditing(),!0}return!1}},{key:"updateEditStatePosition",value:function(){this.updateEditState({position:this.getEditState().position})}},{key:"updatePosition",value:function(e){var t=e.clone().sub(this.lastTranslationPoint);this.link.editState.position||(this.link.editState.position=this.link.getLinkBasePosition()),Dt(this.link.editState.position,t),this.lastTranslationPoint=e,this.updateEditStatePosition()}},{key:"cancelAnchorEditing",value:function(){this.grabbing=!1,this.link.syncEditState(),this.updateEditStatePosition()}},{key:"isDragging",value:function(){return this.grabbing}},{key:"intersect",value:function(e){var t=this.markupsExtension.renderer.worldToClient(e);return this.link.getClientBoundingBox().containsPoint(t)}},{key:"getCursor",value:function(){return this.grabbing?"grabbing":"grab"}}])&&Ja(t.prototype,n),o}(Ya);function es(e){return es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},es(e)}function ts(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ns(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rs(e,t){return rs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},rs(e,t)}function As(e,t){return!t||"object"!==es(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function is(e){return is=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},is(e)}var os=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rs(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=is(r);if(A){var n=is(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return As(this,e)});function o(){return ts(this,o),i.apply(this,arguments)}return t=o,(n=[{key:"intersect",value:function(e){var t=this.markupsExtension.renderer.worldToClient(e);return this.link.getClientBoundingBox().containsPoint(t)}},{key:"handleMouseMove",value:function(e){if(this.markupsExtension.markupsTool.dragging||Autodesk.Viewing.isMobileDevice())return!1;var t=this.intersect(e);return this.link.setHover(t),t&&this.link.layer.setHover(!0),t}},{key:"getCursor",value:function(){return"pointer"}},{key:"handleButtonUp",value:function(e,t){return!(this.didMouseMove()||!this.intersect(e)||(this.markupsExtension.markupsManager.deselectAllLinks(),this.markupsExtension.markupsManager.selectLink(this.link),0))}}])&&ns(t.prototype,n),o}(Ya);function as(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ss=function(){function e(t,n,r,A,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=n,this.guid=r,this.layer=A,this.type=i,this.markupsExtension=t,this.visible=!0,this.selected=!1,this.hover=!1,this.dirty=!1,o?this.state=o:(this.state=this.getDefaultState(),this.state.style=this.getDefaultStyle()),this.editState={},this.registerSelectionHandler(),this.registerAnchorHandler()}var t,n;return t=e,(n=[{key:"getDefaultState",value:function(){return{}}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e){this.state=e}},{key:"getEditState",value:function(){return this.editState}},{key:"setEditState",value:function(e){this.editState=e,this.setDirty(!0)}},{key:"syncEditState",value:function(){this.setEditState(lt.cloneDeep(this.getState()))}},{key:"setDirty",value:function(e){this.dirty=e,e&&this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_DIRTY,link:this})}},{key:"isDirty",value:function(){return this.dirty}},{key:"isVisible",value:function(){return this.layer.isVisible()}},{key:"getLinkBasePosition",value:function(){var e=this.layer.getClientBoundingBox(!0),t=e.max.clone().setY(e.min.y),n=this.markupsExtension.renderer.getCameraUpVector(),r=this.markupsExtension.renderer.getCameraRightVector(),A=this.getClientBoundingBox().getSize(new THREE.Vector3),i=n.multiplyScalar(this.markupsExtension.renderer.multiplyByNormaStrokeWidth(A.y/2)),o=r.multiplyScalar(this.markupsExtension.renderer.multiplyByNormaStrokeWidth(Fe+A.x/2)),a=this.markupsExtension.renderer.getCameraEyeVector(),s=this.markupsExtension.renderer.getCameraRotation();return it.applyRotation(t,-s,e.getCenter(new THREE.Vector3),a),this.markupsExtension.renderer.clientToWorld(t).sub(i).add(o)}},{key:"getClientBoundingBox",value:function(){return this.markupsExtension.renderer.linksRenderer.getLinkBoundingBox(this)}},{key:"getPosition",value:function(){return this.editState.position?this.editState.position:this.getLinkBasePosition()}},{key:"select",value:function(){this.selected=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_SELECTED,link:this}),this.setDirty(!0)}},{key:"deselect",value:function(){this.selected=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_DESELECTED,link:this}),this.setDirty(!0)}},{key:"isSelected",value:function(){return this.selected}},{key:"setHover",value:function(e){this.hover!==e&&(this.hover=e,this.setDirty(!0))}},{key:"isHovered",value:function(){return this.hover}},{key:"isCompleted",value:function(){return!0}},{key:"registerSelectionHandler",value:function(){this.selectionHandler=new os(this.markupsExtension,this)}},{key:"registerAnchorHandler",value:function(){this.anchorHandler=new $a(this.markupsExtension,this)}},{key:"destroy",value:function(){this.translationHandler&&(this.translationHandler.destroy(),this.translationHandler=null),this.markupsExtension=null,this.state=null,this.editState=null}}])&&as(t.prototype,n),e}();function us(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var cs=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.id=n,this.layerData=!r||r instanceof Ga?r:new Ga(r.guid,r.resources,r.attachments,r.status,r.metadata),this.markups={},this.links={},this.selected=!1,this.visible=!1,this.transparent=!1,this.hover=!1}var t,n;return t=e,(n=[{key:"addMarkup",value:function(e){this.markups[e.id]=e,e.layer=this,e.setVisible(this.visible,!0)}},{key:"deleteMarkup",value:function(e){var t=e instanceof ii?e.id:e;this.markups[t]?(e.deselect(),delete this.markups[t],e.remove(),e.layer=null,this.setDirty()):console.warn("deleteMarkup - markup does not exist")}},{key:"deleteAllMarkups",value:function(){var e=this;Ft(this.markups,(function(t){e.deleteMarkup(t)}))}},{key:"getMarkupById",value:function(e){return this.markups[e]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.markups).length}},{key:"addLink",value:function(e){this.links[e.id]=e}},{key:"deleteLink",value:function(e){var t=e instanceof ss?e.id:e;this.links[t]?(this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_REMOVED,link:e}),delete this.links[t]):console.warn("deleteLink - markup does not exist")}},{key:"deleteAllLinks",value:function(){var e=this;Ft(this.links,(function(t){e.deleteLink(t)}))}},{key:"getLinkById",value:function(e){return this.links[e]}},{key:"getClientBoundingBox",value:function(e){var t=this.getWorldBoundingBox();t.min=this.markupsExtension.renderer.worldToClient(t.min),t.max=this.markupsExtension.renderer.worldToClient(t.max);var n=this.markupsExtension.renderer.getCameraEyeVector(),r=t.getCenter(new THREE.Vector3),A=this.markupsExtension.renderer.getCameraRotation();if(it.applyRotation(t.min,A,r,n),it.applyRotation(t.max,A,r,n),it.swapBoundingBoxY(t),e){var i=this.getMarginSize();t.expandByVector(new THREE.Vector3(i,i,0))}return t.min.z=0,t.max.z=0,t}},{key:"getMarginSize",value:function(){return Oe}},{key:"getWorldBoundingBox",value:function(){var e=new THREE.Box3;return Ft(this.markups,(function(t){var n=t.getWorldBoundingBox(!0);e.union(n)})),e}},{key:"getRotation",value:function(){return 0}},{key:"getAllMarkups",value:function(){return Ht(this.markups)}},{key:"getAllLinks",value:function(){return Ht(this.links)}},{key:"hasSingleMarkup",value:function(){return 1===this.getAllMarkups().length}},{key:"select",value:function(){this.selected=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_SELECTED,layer:this}),this.setDirty()}},{key:"deselect",value:function(){this.selected=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_DESELECTED,layer:this}),this.setDirty()}},{key:"isSelected",value:function(){return this.selected}},{key:"setHover",value:function(e){this.hover!==e&&(this.hover=e,this.getAllLinks().forEach((function(t){t.setHover(e)})),this.setDirty())}},{key:"isHovered",value:function(){return this.hover}},{key:"unhoverAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.setHover(!1)}))}},{key:"setVisible",value:function(e){this.visible=e,Ft(this.markups,(function(t){t.setVisible(e)})),this.setDirty()}},{key:"isVisible",value:function(){return this.visible}},{key:"setDirty",value:function(){this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_DIRTY,layer:this})}},{key:"getGuid",value:function(){return this.layerData&&this.layerData.guid}},{key:"selectAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.select()}))}},{key:"changeTransparency",value:function(e){this.transparent=e,this.getAllMarkups().forEach((function(t){t.changeTransparency(e)}))}},{key:"isTransparent",value:function(){return this.transparent}},{key:"enable",value:function(){this.getAllMarkups().forEach((function(e){e.enable()}))}},{key:"disable",value:function(){this.getAllMarkups().forEach((function(e){e.disable()}))}}])&&us(t.prototype,n),e}();function ls(e){return ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ls(e)}function hs(e,t){return hs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},hs(e,t)}function ps(e,t){return!t||"object"!==ls(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ds(e){return ds=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ds(e)}var fs,ys,gs,Es=(gs=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hs(e,t)}(A,e);var t,n,r=(t=A,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ds(t);if(n){var A=ds(this).constructor;e=Reflect.construct(r,arguments,A)}else e=r.apply(this,arguments);return ps(this,e)});function A(e,t,n,i,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),r.call(this,e,t,n,i,re,o)}return A}(ss),(ys=re)in(fs={})?Object.defineProperty(fs,ys,{value:gs,enumerable:!0,configurable:!0,writable:!0}):fs[ys]=gs,fs);function Bs(e,t,n,r,A,i,o){try{var a=e[i](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,A)}function ms(e){return function(){var t=this,n=arguments;return new Promise((function(r,A){var i=e.apply(t,n);function o(e){Bs(i,r,A,o,a,"next",e)}function a(e){Bs(i,r,A,o,a,"throw",e)}o(void 0)}))}}var vs=function(e,t){e&&t&&("eye"in e&&(e.eye[0]=(Number(e.eye[0])+t.x).toString(),e.eye[1]=(Number(e.eye[1])+t.y).toString(),e.eye[2]=(Number(e.eye[2])+t.z).toString()),"target"in e&&(e.target[0]=(Number(e.target[0])+t.x).toString(),e.target[1]=(Number(e.target[1])+t.y).toString(),e.target[2]=(Number(e.target[2])+t.z).toString()),"pivotPoint"in e&&(e.pivotPoint[0]=(Number(e.pivotPoint[0])+t.x).toString(),e.pivotPoint[1]=(Number(e.pivotPoint[1])+t.y).toString(),e.pivotPoint[2]=(Number(e.pivotPoint[2])+t.z).toString()))},ws=function(e,t){var n=e.model,r=n?n.getData().globalOffset:null,A=t.metadata.markup_metadata;if(r){var i=JSON.parse(JSON.stringify(A)),o=i.viewport,a={x:-r.x,y:-r.y,z:-r.z};return vs(o,a),i}return A},ks=function(){var e=ms(regeneratorRuntime.mark((function e(t,n,r){var A,i,o,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A=a.length>3&&void 0!==a[3]?a[3]:function(){},n){e.next=4;break}return A(!1),e.abrupt("return");case 4:return i=ws(t,n),t.restoreState(i,null,r),o=function(){var e=ms(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=3;break}return e.next=3,Autodesk.Viewing.EventUtils.waitUntilTransitionEnded(t);case 3:n=t.navigation.getCamera(),t.navigation.updateCamera(),n.updateMatrixWorld(),t.impl.sceneUpdated(!0),A(!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),o(),e.next=10,Autodesk.Viewing.EventUtils.waitUntilGeometryLoaded(t);case 10:t.impl.sceneUpdated(!0);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Cs=function(e,t,n,r){var A=t.model.isPdf(!0);if(t.model.isLeaflet()||A){var i,o;if(A)i=Autodesk.Viewing.PDFUtils.getLeafletLoadOptions(t),o=Autodesk.Viewing.PDFUtils.getLeafletBoundingBox(t);else{var a=t.model.getData();i=a.loadOptions.loadOptions,o=a.bbox}var s=i,u=s.texWidth,c=s.texHeight,l=u/(r.metadata.markup_metadata&&r.metadata.markup_metadata.originalDocumentResolution&&r.metadata.markup_metadata.originalDocumentResolution[0]||u),h=o.getSize(new THREE.Vector3),p=e.x/(u/l)*h.x,d=e.y/(c/l)*h.y,f=new THREE.Vector3(p,d,0),y=new THREE.Vector3(o.min.x,o.max.y,0);return f.add(y),A&&Autodesk.Viewing.PDFUtils.leafletToPdfWorld(t,f),f}if(n.documentCamera.isPerspective){var g=t.impl.getCanvasBoundingClientRect();e.x=e.x/De*(.5*g.height)+.5*g.width,e.y=-e.y/De*(.5*g.height)+.5*g.height,e=n.clientToWorld(e)}else{e.applyMatrix4(n.documentCamera.matrixWorld),e.sub(n.documentCamera.position);var E=t.model&&t.model.getData().globalOffset;E&&e.sub(E),e=n.documentCameraToMarkupsCamera(e)}return e},bs=function(e,t,n,r){var A=Cs(new THREE.Vector3,t,n,r),i=Cs(new THREE.Vector3(e,0,0),t,n,r);return A.distanceTo(i)},Ss=function(e,t,n,r,A){var i=e.childNodes[0].childNodes[0],a=function(e){return i.getAttribute(e)||i.getAttribute(e.toLowerCase())},s=a("type")||"",c=A<5,l=n.model.isLeaflet(),h=n.model.isPdf(!0),p={style:{},anchors:[]},d={type:s,state:p},f=function(){for(var e=[],t=a("locations"),n=t&&t.split(" ")||"",r=0;r<n.length;r+=2){var A=new THREE.Vector3(parseFloat(n[r]),parseFloat(n[r+1]),0);e.push(A)}return e},U=function(e){var t=new THREE.Vector3,n=a(e);if(n){var r=n.split(" ");t.x=r[0]&&parseFloat(r[0])||0,t.y=r[1]&&parseFloat(r[1])||0,t.z=r[2]&&parseFloat(r[2])||0}return t},Q=function(){return a("text")||""},L=a("groupId");L&&(p.groupId=L,p.groupOrder=parseFloat(a("groupOrder")));var F,R,H,_=a("uuid");switch(_&&(p.uuid=_),p.style=function(e){for(var t=Ht(u),n={},r=0;r<t.length;r++){var A=e.getAttribute(t[r]);if(A)switch(t[r]){case u.THICKNESS:case u.FONT_SIZE:case u.OPACITY:case u.FILL_OPACITY:n[t[r]]=parseFloat(A);break;case u.STROKE_LINEJOIN:break;case u.FONT_FAMILY:case u.FONT_STYLE:case u.FONT_WEIGHT:case u.COLOR:case u.FONT_COLOR:case u.FILL_COLOR:n[t[r]]=A}}return n[u.FONT_COLOR]||(n[u.FONT_COLOR]=n[u.COLOR]),n[u.FILL_COLOR]||(n[u.FILL_COLOR]=o.NO_COLOR),n[u.FILL_COLOR]===o.NO_COLOR&&(n[u.FILL_OPACITY]=le),n}(i),p.position=U("position"),p.rotation=(F=a("rotation"))&&parseFloat(F)||0,p.size=U("size"),n.impl.is2d||ks(n,t,!0),s){case g:case B:case E:p.anchors[0]=new THREE.Vector3(-p.size.x/2,-p.size.y/2,0),p.anchors[1]=new THREE.Vector3(p.size.x/2,-p.size.y/2,0),p.anchors[2]=new THREE.Vector3(p.size.x/2,p.size.y/2,0),p.anchors[3]=new THREE.Vector3(-p.size.x/2,p.size.y/2,0),c&&s!==B&&(H=p.style[u.THICKNESS]/2,p.anchors[0].add(new THREE.Vector3(H,H,0)),p.anchors[1].add(new THREE.Vector3(-H,H,0)),p.anchors[2].add(new THREE.Vector3(-H,-H,0)),p.anchors[3].add(new THREE.Vector3(H,-H,0)));break;case y:case M:p.anchors[0]=U("tail"),p.anchors[1]=U("head"),c&&(p.rotation=0);break;case C:case b:p.text=Q(),p.isFrameUsed=!!parseInt(a("isFrameUsed"),10),p.frameType=a("frameType")||g,c&&(p.isFrameUsed||(p.style[u.FILL_OPACITY]=0)),p.anchors[0]=new THREE.Vector3(-p.size.x/2,-p.size.y/2,0),p.anchors[1]=new THREE.Vector3(p.size.x/2,-p.size.y/2,0),p.anchors[2]=new THREE.Vector3(p.size.x/2,p.size.y/2,0),p.anchors[3]=new THREE.Vector3(-p.size.x/2,p.size.y/2,0);break;case S:case T:break;case v:case m:p.anchors=f();break;case k:case w:p.anchors=f(),p.closed=function(){var t=e.childNodes[1]||"",n=!1;if("string"!=typeof t){var r=t.getAttribute("d").split(" ");"z"===r[r.length-1].toLowerCase()&&(n=!0)}return n}();break;case x:p.anchors[0]=U("firstAnchor"),p.anchors[1]=U("secondAnchor"),R=U("offset"),p.position.sub(R),p.translation=Cs(R,n,r,t).sub(Cs(new THREE.Vector3,n,r,t)),p.text=Q(),c&&(p.style[u.THICKNESS]/=2),p.style[u.FONT_SIZE]/=Ge,p.style[u.THICKNESS]/=Ve}return(c||l||h)&&function(){if(Object.prototype.hasOwnProperty.call(p.style,u.FONT_SIZE)){var e=r.getFontToWorldScale();p.style[u.FONT_SIZE]/=e}}(),Dt(p.anchors,p.position),(c&&n.model.is3d()||l||h)&&(p.anchors.forEach((function(e){e.copy(Cs(e,n,r,t))})),p.style[u.THICKNESS]=bs(p.style[u.THICKNESS],n,r,t),p.style[u.FONT_SIZE]=bs(p.style[u.FONT_SIZE],n,r,t)),d};function Ts(e){return Ts="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ts(e)}function xs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ms(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Us(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qs(e,t){return Qs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Qs(e,t)}function Ls(e,t){return!t||"object"!==Ts(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fs(e){return Fs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Fs(e)}var Rs=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qs(e,t)}(s,Autodesk.Viewing.EventDispatcher);var t,n,r,i,a=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Fs(r);if(i){var n=Fs(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ls(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this)).markupsExtension=e,t.actionManager=new Wn,t.registerEvents(),t.reset(),t}return t=s,n=[{key:"registerEvents",value:function(){this.onHistoryChangedBinded=this.onHistoryChanged.bind(this),this.actionManager.addEventListener(Wn.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.onAllMarkupsLoadedBinded=this.onAllMarkupsLoaded.bind(this),this.addEventListener(A.ALL_MARKUPS_LOADED,this.onAllMarkupsLoadedBinded),this.onMarkupLayerFetchedBinded=this.onMarkupLayerFetched.bind(this),this.addEventListener(A.LAYER_FETCHED,this.onMarkupLayerFetchedBinded),this.onMarkupResourceFetchedBinded=this.onMarkupResourceFetched.bind(this),this.addEventListener(A.LAYER_RESOURCE_FETCHED,this.onMarkupResourceFetchedBinded),this.onMarkupLinkSyncedBinded=this.onMarkupLinkSynced.bind(this),this.addEventListener(A.LINK_SYNCED,this.onMarkupLinkSyncedBinded),this.onLayerSyncedBinded=this.onLayerSynced.bind(this),this.addEventListener(A.LAYER_SYNCED,this.onLayerSyncedBinded),this.onLayerSyncingBinded=this.onLayerSyncing.bind(this),this.addEventListener(A.LAYER_SYNCING,this.onLayerSyncingBinded),this.onLayerSelectedBinded=this.onLayerSelected.bind(this),this.addEventListener(A.LAYER_SELECTED,this.onLayerSelectedBinded),this.onLayerDeselectedBinded=this.onLayerDeselected.bind(this),this.addEventListener(A.LAYER_DESELECTED,this.onLayerDeselectedBinded),this.onCalibrationEndedBinded=this.onCalibrationEnded.bind(this),this.markupsExtension.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.FINISHED_CALIBRATION_FOR_DIMENSION_EVENT,this.onCalibrationEndedBinded),this.onDrawingStartBinded=this.onDrawingStart.bind(this),this.addEventListener(A.MARKUP_DRAWING_START,this.onDrawingStartBinded),this.onDrawingEndBinded=this.onDrawingEnd.bind(this),this.addEventListener(A.MARKUP_DRAWING_END,this.onDrawingEndBinded),this.addEventListener(A.MARKUP_DRAWING_CANCEL,this.onDrawingEndBinded)}},{key:"unregisterEvents",value:function(){this.actionManager.removeEventListener(Wn.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.removeEventListener(A.ALL_MARKUPS_LOADED,this.onAllMarkupsLoadedBinded),this.removeEventListener(A.LAYER_FETCHED,this.onMarkupLayerFetchedBinded),this.removeEventListener(A.LAYER_RESOURCE_FETCHED,this.onMarkupResourceFetchedBinded),this.removeEventListener(A.LINK_SYNCED,this.onMarkupLinkSyncedBinded),this.removeEventListener(A.LAYER_SYNCED,this.onLayerSyncedBinded),this.removeEventListener(A.LAYER_SYNCING,this.onLayerSyncingBinded),this.markupsExtension.viewer.removeEventListener(Autodesk.Viewing.MeasureCommon.Events.FINISHED_CALIBRATION_FOR_DIMENSION_EVENT,this.onCalibrationEndedBinded),this.removeEventListener(A.MARKUP_DRAWING_START,this.onDrawingStartBinded),this.removeEventListener(A.MARKUP_DRAWING_END,this.onDrawingEndBinded),this.removeEventListener(A.MARKUP_DRAWING_CANCEL,this.onDrawingEndBinded)}},{key:"createLayer",value:function(e){var t=new cs(this.markupsExtension,this.nextLayerId,e);return this.layers[t.id]=t,this.nextLayerId+=1,this.dispatchEvent({type:A.LAYER_CREATED}),t}},{key:"loadLayers",value:function(e,t,n){var r=this;n&&(this.removeAllLayers([this.getActiveLayer()]),this.markupsExtension.markupsCache&&this.markupsExtension.markupsCache.cleanCache()),(e=e instanceof Array?e:[e]).forEach((function(e){r.markupsExtension.markupsCache&&e.guid&&!r.markupsExtension.markupsCache.get(e.guid)&&r.markupsExtension.markupsCache.add(e.guid,e)}));var A=t?e:this.markupsExtension.filterManager.filterLayers(e);this.getLayersAsList().forEach((function(e){e!==r.getActiveLayer()&&-1===A.findIndex((function(t){return t.guid===e.getGuid()}))&&r.removeLayer(e)})),A.forEach((function(e){if(!r.getLayerByGuid(e.guid)){var t=r.createLayer(e);r.markupsExtension.viewer.impl.is2d&&(t.setVisible(!0),r.loadMarkupsToLayer(t)),r.loadLinksToLayer(t)}}))}},{key:"removeLayer",value:function(e){var t=e.id,n=this.layers[t];n?(this.isMarkupSessionOpen()&&n===this.getActiveLayer()?this.endMarkupSession(!1):this.markupsExtension.viewer.model&&this.markupsExtension.viewer.model.is3d()&&this.isInMarkupView()&&this.getVisibleLayers()[0]===n&&this.exitMarkupView(),this.deselectLayer(e),e.deleteAllMarkups(),e.deleteAllLinks(),e.setVisible(!1),this.dispatchEvent({type:A.LAYER_DELETED,layer:e}),delete this.layers[t]):console.warn("deleteLayer - layer does not exist")}},{key:"removeAllLayers",value:function(e){var t=this;this.getLayersAsList().forEach((function(n){e&&-1!==e.indexOf(n)||t.removeLayer(n)}))}},{key:"deleteLayer",value:function(e){this.dispatchEvent({type:A.LAYER_DELETE,layerData:e.layerData})}},{key:"getLayerById",value:function(e){return this.layers[e]}},{key:"getLayerByGuid",value:function(e){return null==e?null:this.getLayersAsList().find((function(t){return t.getGuid()===e}))}},{key:"addMarkupToLayer",value:function(e,t){return this.getLayerById(t.id)||(this.layers[t.id]=t),this.getSelectedLayers().length>0&&!t.isSelected()&&e.changeTransparency(!0),(this.isMarkupSessionOpen()&&t!==this.getActiveLayer()||!this.isToolEnabled())&&e.disable(),t.addMarkup(e),!0}},{key:"addLinkToLayer",value:function(e,t){return this.getLayerById(t.id)||(this.layers[t.id]=t),t.addLink(e),!0}},{key:"createMarkup",value:function(e,t,n){var r=_a[e];return r?new r(this.markupsExtension,this.nextMarkupId++,t,n):null}},{key:"createLink",value:function(e,t){var n=t.position?(new THREE.Vector3).copy(t.position):null;n&&this.markupsExtension.viewer.model.isPdf(!0)&&Autodesk.Viewing.PDFUtils.leafletToPdfWorld(this.markupsExtension.viewer,n);var r=new Es[t.type](this.markupsExtension,this.nextLinkId,t.id,e,{position:n});return this.nextLinkId+=1,r}},{key:"onAllMarkupsLoaded",value:function(e){var t=e.amount;console.log("All markups have been loaded. Amount: "+t)}},{key:"onMarkupLayerFetched",value:function(e){var t=this,n=e.layerData;this.markupsExtension.filterManager.filterLayers([n]).forEach((function(e){var n=t.createLayer(e);t.markupsExtension.viewer.impl.is2d&&n.setVisible(!0)}))}},{key:"onMarkupResourceFetched",value:function(e){var t=e.layerData;if(this.markupsExtension.viewer.impl.is2d){var n=this.getLayerByGuid(t.guid);n&&this.loadMarkupsToLayer(n)}}},{key:"onMarkupLinkSynced",value:function(e){var t=e.documentAttachment,n=e.layerData,r=this.getLayerByGuid(n.guid);r&&(t&&t.status===z&&0===n.attachments.length&&r.deleteAllLinks(),this.loadLinksToLayer(r))}},{key:"onDrawingStart",value:function(){var e=this.getDuringCreationMarkup(!1);this.polySaveDisabled=e&&e.inEdit&&(e.type===w||e.type===k),this.dispatchEvent({type:A.LAYER_READY_TO_SAVE,readyToSave:this.getReadyToSave()})}},{key:"onDrawingEnd",value:function(){this.polySaveDisabled=!1,this.dispatchEvent({type:A.LAYER_READY_TO_SAVE,readyToSave:this.getReadyToSave()})}},{key:"getReadyToSave",value:function(){var e,t,n=this.getActiveLayer();n&&((e=n.isEmpty())||(t=n.getAllMarkups().some((function(e){return e.isTextMarkup()&&e.textInputHandler.isEmpty()}))));var r=this.markupsExtension.options.isMobileApp?!e:!e||e&&this.markupsExtension.permissionManager.canDeleteMarkup(n.layerData);return!(!n||!r||this.polySaveDisabled||t)}},{key:"removeMarkupFromLayer",value:function(e){var t=e.layer;return t?(this.duringCreationMarkup=null,e.deselect(),e.disableEdit(),t.deleteMarkup(e),!0):(console.warn("removeMarkupFromLayer - markup does not exist"),!1)}},{key:"getMarkupById",value:function(e){var t=null;return Ft(this.layers,(function(n){var r=n.getMarkupById(e);r&&(t=r)})),t}},{key:"getSelectedMarkups",value:function(){return this.getMarkupsByProperty("selected",!0)}},{key:"getUnselectedMarkups",value:function(){return this.getMarkupsByProperty("selected",!1)}},{key:"getSelectedLayers",value:function(){return this.getLayersByProperty("selected",!0)}},{key:"getUnselectedLayers",value:function(){return this.getLayersByProperty("selected",!1)}},{key:"getSelectedLayer",value:function(){return this.getSelectedLayers()[0]}},{key:"getVisibleLayers",value:function(){return this.getLayersByProperty("visible",!0)}},{key:"getVisibleMarkups",value:function(){return this.getMarkupsByProperty("visible",!0)}},{key:"getEnabledMarkups",value:function(){return this.getMarkupsByProperty("enabled",!0).filter((function(e){return!e.layer||e.layer.isVisible()}))}},{key:"getDisabledMarkups",value:function(){return this.getMarkupsByProperty("enabled",!1)}},{key:"getVisibleLinks",value:function(){var e=this.getVisibleLayers(),t=[];return e.forEach((function(e){e.getAllLinks().forEach((function(e){t.push(e)}))})),t}},{key:"getDirtyLinks",value:function(){return this.getLinksByProperty("dirty",!0)}},{key:"getSelectedLinks",value:function(){return this.getLinksByProperty("selected",!0)}},{key:"getInEditMarkups",value:function(){var e=this.getMarkupsByProperty("inEdit",!0);return this.duringCreationMarkup&&-1===e.indexOf(this.duringCreationMarkup)&&e.push(this.duringCreationMarkup),e}},{key:"getMarkupsByProperty",value:function(e,t){var n=[];return Ft(this.layers,(function(r){Ft(r.markups,(function(r){r[e]===t&&n.push(r)}))})),n}},{key:"getLayersByProperty",value:function(e,t){var n=[];return Ft(this.layers,(function(r){r[e]===t&&n.push(r)})),n}},{key:"getLinksByProperty",value:function(e,t){var n=[];return Ft(this.layers,(function(r){Ft(r.links,(function(r){r[e]===t&&n.push(r)}))})),n}},{key:"selectMarkup",value:function(e){(e=e instanceof ii?e:this.getMarkupById(e))?e.select():console.warn("selectMarkup - markup does not exist")}},{key:"deselectMarkup",value:function(e){(e=e instanceof ii?e:this.getMarkupById(e))?e.deselect():console.warn("selectMarkup - markup does not exist")}},{key:"deselectAllMarkups",value:function(e){this.getSelectedMarkups().forEach((function(t){e&&-1!==e.indexOf(t)||!t.isSelected()||t.deselect()}))}},{key:"unhoverAllLayers",value:function(){this.getLayersAsList().forEach((function(e){e.setHover(!1)}))}},{key:"unhoverAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.setHover(!1)}))}},{key:"enableAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.enable()}))}},{key:"disableAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.disable()}))}},{key:"lockNavigation",value:function(){this.lockSettings||(this.lockSettings=this.markupsExtension.viewer.getNavigationLockSettings(),this.markupsExtension.viewer.setNavigationLockSettings({orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1}),this.markupsExtension.viewer.navigation.setIsLocked(!0)),this.dispatchEvent({type:A.MARKUP_VIEW_ENTERED})}},{key:"unlockNavigation",value:function(){this.lockSettings&&(this.markupsExtension.viewer.setNavigationLockSettings(this.lockSettings),this.markupsExtension.viewer.setNavigationLock(!1),this.markupsExtension.viewer.toolController.setIsLocked(!1),this.lockSettings=null)}},{key:"loadLayerIfHidden",value:function(e){var t=e instanceof cs?e:this.getLayerByGuid(e);if(!t&&this.markupsExtension.markupsCache){var n=this.markupsExtension.markupsCache.get(e);if(n){var r=n.metadata.markup_metadata.sheetName;Wt(this.markupsExtension.options.sheetName,r)||(n=null)}n&&(this.loadLayers([n],!0),t=this.getLayerByGuid(e))}return t}},{key:"selectLayer",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=this.loadLayerIfHidden(e),a=i.bind(this);if(o){var s=o.isSelected();if(this.deselectAllLayers([o]),this.exitMarkupView([o]),this.markupsExtension.viewer.impl.is2d){if(o.select(),t){var u={horizontal:this.markupsExtension.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,vertical:this.markupsExtension.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN};this.markupsExtension.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=He,this.markupsExtension.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=He;var c=o.getWorldBoundingBox();this.markupsExtension.viewer.navigation.fitBounds(n,c),this.markupsExtension.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=u.horizontal,this.markupsExtension.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=u.vertical}a()}else this.loadMarkupsToLayer(o),o.select(),this.navigationToolBackup=this.markupsExtension.viewer.getActiveNavigationTool(),this.markupsExtension.viewer.setActiveNavigationTool(this.markupsExtension.markupsTool.getName()),ks(this.markupsExtension.viewer,o.layerData,n||s,(function(){o.isSelected()&&(o.setVisible(!0),r.lockNavigation()),a()}))}else{this.dispatchEvent({type:A.LAYER_SELECTED_FROM_DIFFERENT_SHEET,layerGuid:e});var l=this.markupsExtension.cache;l.layerToSelect=this.loadRelevantSheet(e)}}},{key:"deselectLayer",value:function(e){(e=e instanceof cs?e:this.getLayerByGuid(e))?e.isSelected()&&(e.deselect(),e.layerData&&0===this.markupsExtension.filterManager.filterLayers([e.layerData]).length&&this.removeLayer(e)):console.warn("deselectLayer - layer does not exist")}},{key:"deselectAllLayers",value:function(e){var t=this;this.getSelectedLayers().forEach((function(n){e&&-1!==e.indexOf(n)||!n.isSelected()||t.deselectLayer(n)}))}},{key:"loadRelevantSheet",value:function(e){var t=this,n=this.markupsExtension.markupsCache.get(e);return n?this.markupsExtension.options.hasMultiSheet?function(){var r=n.metadata.markup_metadata.sheetName;if(r&&!Wt(t.sheetName,r))return function(n,r){for(var A=0;A<t.markupsExtension.sheetList.length;A++){var i=t.markupsExtension.sheetList[A].search(Ms({},n,r))[0];if(i)return t.markupsExtension.options.loadDocumentCallback?t.markupsExtension.options.loadDocumentCallback(i):t.markupsExtension.viewer.loadDocumentNode(t.markupsExtension.viewer.model.getDocumentNode().getDocument(),i,{loadAsHidden:!1,applyRefPoint:!1,keepCurrentModels:!1}),e}return console.warn("loadRelevantSheet - Sheet not found (by ".concat(n,")")),null}("name",r)}():void console.warn("loadRelevantSheet - Something weird just happened. This method shouldnt be called on Plans folder."):(console.warn("loadRelevantSheet - Cant find selected layer."),null)}},{key:"isInMarkupView",value:function(){var e=this.getVisibleLayers();return!this.isMarkupSessionOpen()&&e.length>0}},{key:"exitMarkupView",value:function(e){var t=this;if(!this.markupsExtension.viewer.impl.is2d&&this.isInMarkupView()){var n=this.getVisibleLayers();if(e&&(n=n.filter((function(t){return-1===e.indexOf(t)}))),0!==n.length){n.forEach((function(e){t.deselectLayer(e),e.setVisible(!1)})),this.unlockNavigation(),this.markupsExtension.viewer.setActiveNavigationTool(this.navigationToolBackup);var r=this.markupsExtension.viewer.getExtension("Autodesk.Section");r&&1===r.getSectionPlanes().length?r.setSectionFromPlane(null):this.markupsExtension.viewer.impl.setCutPlaneSet("__set_view",void 0),this.dispatchEvent({type:A.MARKUP_VIEW_EXITED})}}}},{key:"changeAllLayersTransparency",value:function(e,t){this.markupsExtension.isToolEnabled()&&this.getLayersAsList().forEach((function(n){t&&-1!==t.indexOf(n)||n.changeTransparency(e)}))}},{key:"onLayerSynced",value:function(e){var t=e.layerData,n=e.layer;if(n=n||this.getLayerByGuid(t.guid)){if(!this.isMarkupSessionOpen()){n.enable();var r=this.getSelectedLayer();(r&&r!==n||!this.markupsExtension.isToolEnabled())&&n.changeTransparency(!0)}0===this.markupsExtension.filterManager.filterLayers([t]).length&&this.removeLayer(n)}this.markupsExtension.options.onMarkupsSyncCallback&&this.markupsExtension.options.onMarkupsSyncCallback({count:this.markupsExtension.markupsCache.length()})}},{key:"onLayerSyncing",value:function(e){var t=e.layerData,n=e.layer;(n=n||this.getLayerByGuid(t.guid))&&(this.markupsExtension.viewer.impl.is2d&&n.deselect(),n.disable())}},{key:"selectLink",value:function(e){e?e.select():console.warn("selectLink - link does not exist")}},{key:"deselectLink",value:function(e){e?e.deselect():console.warn("deselectLink - link does not exist")}},{key:"deselectAllLinks",value:function(){var e=this;this.getSelectedLinks().forEach((function(t){e.deselectLink(t)}))}},{key:"getDuringCreationMarkup",value:function(e){if(!this.duringCreationMarkup&&e){var t=this.getMarkupCreationType(),n=this.createMarkup(t);n&&(n.setVisible(!0),n.enableEdit(),this.duringCreationMarkup=n)}return this.duringCreationMarkup}},{key:"getActiveLayer",value:function(){return this.activeLayer}},{key:"setActiveLayer",value:function(e){e=e instanceof cs?e:this.getLayerById(e),this.activeLayer=e}},{key:"isMarkupSessionOpen",value:function(){return this.sessionOpen}},{key:"changeMarkupCreationType",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ae;Yt(this.markupsExtension.viewer,(function(){var n=e.getDuringCreationMarkup(!1);n&&n.creationHandler.onEscape(),e.markupCreationType=t,e.markupsExtension.viewer.setActiveNavigationTool(t?e.markupsExtension.markupsTool.getName():e.navigationToolBackup),e.dispatchEvent({type:A.MARKUP_CREATION_TYPE_CHANGED,creationType:t}),t&&!e.isMarkupSessionOpen()&&t!==U&&e.startMarkupSession()}))}},{key:"getMarkupCreationType",value:function(){return this.markupCreationType}},{key:"setToolEnabled",value:function(e){var t=this;this.toolEnabled=e,e?this.enableAllMarkups():(this.deselectAllLayers(),this.deselectAllLinks(),this.disableAllMarkups()),(Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIE11)&&setTimeout((function(){t.markupsExtension.markupsUI&&t.markupsExtension.markupsUI.toolbar.renderToolbar()}),1),this.dispatchEvent({type:A.MARKUP_TOOL_ENABLED_CHANGED,enable:e})}},{key:"isToolEnabled",value:function(){return this.toolEnabled}},{key:"startMarkupSession",value:function(e,t){return!!this.isToolEnabled()&&(this.deselectAllLayers(t&&[t]),this.exitMarkupView([t]),this.deselectAllLinks(),this.sessionOpen=!0,this.markupsExtension.markupsTool.updateToolPriority(),(t=t||this.createLayer()).setVisible(!0),this.setActiveLayer(t),this.navigationToolBackup=this.markupsExtension.viewer.getActiveNavigationTool(),this.markupsExtension.viewer.setActiveNavigationTool(this.markupsExtension.markupsTool.getName()),this.markupsExtension.viewer.impl.is2d||this.lockNavigation(),!e&&this.getMarkupCreationType()||this.changeMarkupCreationType(e),this.getAllMarkups().forEach((function(e){e.layer!==t&&e.disable()})),this.creationStatusType=this.markupsExtension.options.defaultMarkupStatus||O,this.contextMenu=this.markupsExtension.viewer.contextMenu,this.markupsExtension.viewer.setContextMenu(null),this.markupsExtension.viewer.impl.pauseHighlight(!0),this.markupsExtension.viewer.impl.disableSelection(!0),(n=this.markupsExtension.viewer.toolController.getTool("gestures"))&&(n.setGestureParameter("singletap","time",250),n.setGestureParameter("drag","threshold",0)),this.dispatchEvent({type:A.MARKUP_SESSION_START,layer:t}),!0);var n}},{key:"endMarkupSession",value:function(e){var t=this;if(this.isMarkupSessionOpen()){var n=this.getActiveLayer(),r=!1;if(e&&n.isEmpty()){if(n.layerData)return void this.dispatchEvent({type:A.LAYER_DELETE_EMPTY_PRESSED,onConfirmCB:function(){return t.deleteLayer(n)}});r=!0,e=!1}if(this.sessionOpen=!1,e||this.exitMarkupView(),this.markupsExtension.markupsTool&&this.markupsExtension.markupsTool.updateToolPriority(),this.changeMarkupCreationType(null),this.setActiveLayer(null),this.duringCreationMarkup&&this.duringCreationMarkup.creationHandler.creationCancel(),this.deselectAllMarkups(),this.enableAllMarkups(),this.unhoverAllMarkups(),!e)for(;!this.actionManager.isUndoStackEmpty();)this.undo();this.actionManager.clear();var i,o=n.isEmpty()||!e&&!n.getGuid();r?this.deleteLayer(n):o&&this.removeLayer(n),n.deselect(),this.markupsExtension.viewer.setContextMenu(this.contextMenu),this.markupsExtension.viewer.impl.pauseHighlight(!1),this.markupsExtension.viewer.impl.disableSelection(!1),(i=this.markupsExtension.viewer.toolController.getTool("gestures"))&&(i.restoreGestureParameterDefault("singletap","time"),i.restoreGestureParameterDefault("drag","threshold")),this.dispatchEvent({type:A.MARKUP_SESSION_END,layer:n,save:e})}}},{key:"editLayer",value:function(e,t,n,r){var i=this;if(this.isToolEnabled()){var o=this.loadLayerIfHidden(e);o?this.markupsExtension.permissionManager.canEditMarkup(o.layerData)?this.selectLayer(o,t,r,(function(){i.startMarkupSession(Ae,o),n&&(Autodesk.Viewing.isMobileDevice()||o.selectAllMarkups())})):console.warn("editLayer - Cant edit layer, permissions not valid."):(this.dispatchEvent({type:A.LAYER_EDITED_FROM_DIFFERENT_SHEET,layerGuid:e}),this.markupsExtension.cache.layerToEdit=this.loadRelevantSheet(e))}}},{key:"onLayerSelected",value:function(e){var t=e.layer;this.changeAllLayersTransparency(!0,[t])}},{key:"onLayerDeselected",value:function(){this.getSelectedLayer()||this.changeAllLayersTransparency(!1)}},{key:"deleteMarkup",value:function(e){(e=e instanceof ii?e:this.getMarkupById(e))?e.creationHandler.deleteMarkup():console.warn("deleteMarkup - markup does not exist")}},{key:"deleteInEditMarkups",value:function(){var e=this;this.markupsToDelete=this.getInEditMarkups(),this.openActionGroup(),this.markupsToDelete.forEach((function(t){e.deleteMarkup(t)})),this.closeActionGroup()}},{key:"undo",value:function(){this.duringCreationMarkup?this.duringCreationMarkup.creationHandler.onEscape(!1):this.actionManager.undo()}},{key:"redo",value:function(){this.actionManager.redo()}},{key:"isActionGroupOpen",value:function(){return this.actionManager.isGroupOpen}},{key:"openActionGroup",value:function(){this.actionManager.openActionGroup()}},{key:"closeActionGroup",value:function(){this.actionManager.closeActionGroup()}},{key:"copy",value:function(){this.markupsToCopy=this.getSelectedMarkups(),this.pasteOffset=1}},{key:"paste",value:function(){var e=this;this.deselectAllMarkups(),this.openActionGroup(),this.markupsToCopy.forEach((function(t){e.duplicateMarkup(t)})),this.closeActionGroup(),this.pasteOffset+=1}},{key:"cut",value:function(){this.copy(),this.deleteInEditMarkups()}},{key:"duplicateMarkup",value:function(e){var t=this,n=function(){var e=t.markupsExtension.renderer.getCameraRightVector(),n=t.markupsExtension.renderer.getCameraUpVector(),r=t.markupsExtension.renderer.multiplyByNormaStrokeWidth(Ue*t.pasteOffset);return e.sub(n).normalize().multiplyScalar(r)},r=function(e){e.completed=!0;var n=t.activeLayer?t.activeLayer:t.createLayer();new Bt(t,e,n).execute()};if(e.translationHandler&&!e.belongsToGroup()){var A=lt.cloneDeep(e.getState()),i=n();A.translation.add(i);var o=this.createMarkup(e.type,A);r(o),o.select()}else if(e.isGroupMarkup()){var a=lt.cloneDeep(e.getState()),s=n();a.uuid=THREE.Math.generateUUID(),a.componentsState=e.markups.map((function(e){var t=lt.cloneDeep(e.getState());return t.translation.add(s),t}));var u=this.createMarkup(e.type,a);r(u),u.markups.forEach((function(e){return r(e)})),u.select()}}},{key:"loadMarkupsToLayer",value:function(e){var t=this,n=e.layerData&&e.layerData.getSvgResource();if(n&&e.isEmpty()){var r=function(n){n.completed=!0,t.addMarkupToLayer(n,e),n.setDirty()},A=function(e,t,n,r){try{return JSON.parse(e)}catch(h){for(var A=function(e){var t;try{t=(new DOMParser).parseFromString(e,"text/xml").firstChild}catch(e){console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return t}(e).childNodes,i=[],o=(l=void 0,"string"==typeof(l=A[0].childNodes[0].getAttribute("data-model-version"))?parseFloat(l):0),a=n.impl.is2d?null:n.getState(),s=0;s<A.length;s++){var u=A[s];if(u.childNodes[0].childNodes[0]){var c=Ss(u,t,n,r,o);i.push(c)}}return a&&n.restoreState(a,null,!0),i}var l}(n,e.layerData,this.markupsExtension.viewer,this.markupsExtension.renderer);A.forEach((function(e){if(!e.state.groupId){e.state.uuid&&(e.state.componentsState=A.filter((function(t){return e.state.uuid===t.state.groupId})).map((function(e){return e.state})));var n=t.createMarkup(e.type,e.state);n&&(r(n),n.isGroupMarkup()&&n.markups.forEach((function(e){return r(e)})))}}))}}},{key:"createLinkMetadata",value:function(e){var t=e.metadata;t.markup_metadata=t.markup_metadata||{},t.markup_metadata.links=t.markup_metadata.links||[],e.attachments.forEach((function(e){t.markup_metadata.links.some((function(t){return t.id===e.attributes.issue_id&&t.type===e.attributes.attachment_type}))||t.markup_metadata.links.push({id:e.attributes.issue_id,type:e.attributes.attachment_type,position:null})}))}},{key:"loadLinksToLayer",value:function(e){var t=this;this.createLinkMetadata(e.layerData);var n=e.layerData.getLinksMetadata();n&&n.forEach((function(n){if(!e.getAllLinks().find((function(e){return e.guid===n.id}))&&e.layerData.attachments.some((function(e){return e.attributes.issue_id===n.id}))){var r=t.createLink(e,n);t.addLinkToLayer(r,e),r.setDirty(!0)}}))}},{key:"changeStyleProperty",value:function(e,t,n){"string"==typeof t&&(t=o[t.toUpperCase()]||t),e===u.THICKNESS&&(t*=this.markupsExtension.renderer.getNormaStrokeWidth()),this.creationStyleProperties[e]=t,e===u.COLOR&&t!==o.NO_COLOR&&(this.creationStyleProperties[u.LAST_COLOR]=t),this.isMarkupSessionOpen()&&(this.openActionGroup(),this.getSelectedMarkups().forEach((function(r){r.creationHandler.changeStyleProperty(e,t,n)})),this.closeActionGroup()),this.dispatchEvent({type:A.MARKUP_STYLE_PROPERTY_CHANGED,styleProperty:e,value:t})}},{key:"getStyleProperty",value:function(e){return this.creationStyleProperties[e]}},{key:"onCalibrationEnded",value:function(){this.markupsExtension.setToolEnabled(!0),this.startMarkupSession(x)}},{key:"onHistoryChanged",value:function(e){e.actionGroup.forEach((function(e){e.markup.setDirty()})),this.dispatchEvent(e),this.dispatchEvent({type:A.LAYER_READY_TO_SAVE,readyToSave:this.getReadyToSave()})}},{key:"getLayersAsList",value:function(){return Ht(this.layers)}},{key:"getAllMarkups",value:function(){var e=[];return Ft(this.layers,(function(t){var n;e.push.apply(e,function(e){if(Array.isArray(e))return xs(e)}(n=Ht(t.markups))||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return xs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xs(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})),e}},{key:"generateScreenCapture",value:function(e){var t=this;return new Promise((function(n){setTimeout((function(){!function(e,t,r){var A,i=e.getExtension("Autodesk.BIM360.Markups");r&&e.impl.is2d&&(A=r.getWorldBoundingBox(),Autodesk.Viewing.ScreenShot.makeBoundsSquare(A));var o={bounds:A,margin:r?He:0,overlayRenderer:Vt,overlayRendererExtraOptions:{markupLayer:r},getCropBounds:r&&function(e,t){A=r.getWorldBoundingBox(),Autodesk.Viewing.ScreenShot.makeBoundsSquare(A);var n=i.renderer.markupsCamera;e.impl.is2d&&(i.renderer.markupsCamera=t);var o=i.renderer.worldToClient(A.min),a=i.renderer.worldToClient(A.max);i.renderer.markupsCamera=n;var s=(new THREE.Box3).setFromPoints([o,a]);Autodesk.Viewing.ScreenShot.makeBoundsSquare(s,Je);var u=s.getSize(new THREE.Vector3).x;return s.expandByVector(new THREE.Vector3(u*He,u*He,0)),s}};Autodesk.Viewing.ScreenShot.getScreenShotAtScreenSize(e,(function(e){n(e)}),o)}(t.markupsExtension.viewer,0,e)}),100)}))}},{key:"changeCreationStatusType",value:function(e){this.creationStatusType=e}},{key:"getCreationStatusType",value:function(){return this.creationStatusType}},{key:"setDefaultCreationStyleProperties",value:function(){this.creationStyleProperties={},this.changeStyleProperty(u.LAST_COLOR,ie),this.changeStyleProperty(u.COLOR,ie),this.changeStyleProperty(u.FILL_COLOR,ae),this.changeStyleProperty(u.THICKNESS,se),this.changeStyleProperty(u.OPACITY,ue),this.changeStyleProperty(u.FILL_OPACITY,le),this.changeStyleProperty(u.FONT_SIZE,pe),this.changeStyleProperty(u.FONT_WEIGHT,fe),this.changeStyleProperty(u.FONT_FAMILY,ye),this.changeStyleProperty(u.FONT_STYLE,ge),this.changeStyleProperty(u.FONT_COLOR,oe)}},{key:"reset",value:function(){this.nextMarkupId=0,this.nextLinkId=0,this.nextLayerId=0,this.sessionOpen=!1,this.layers={},this.selectedLayers=[],this.duringCreationMarkup=null,this.activeLayer=null,this.markupCreationType=null,this.markupsToCopy=[],this.pasteOffset=1,this.toolEnabled=!0,this.contextMenu=null,this.actionManager.clear(),this.creationStyleProperties={}}},{key:"destroy",value:function(){this.removeAllLayers(),this.unlockNavigation(),this.unregisterEvents(),this.reset(),this.clearListeners(),this.markupsExtension=null,this.actionManager=null}}],n&&Us(t.prototype,n),s}(),Hs=n(93379),_s=n.n(Hs),Ds=n(7795),Is=n.n(Ds),Os=n(90569),Ps=n.n(Os),Ns=n(3565),Ks=n.n(Ns),Vs=n(19216),Gs=n.n(Vs),js=n(44589),Ys=n.n(js),Ws=n(98346),Xs={};function Js(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Xs.styleTagTransform=Ys(),Xs.setAttributes=Ks(),Xs.insert=Ps().bind(null,"head"),Xs.domAPI=Is(),Xs.insertStyleElement=Gs(),_s()(Ws.Z,Xs),Ws.Z&&Ws.Z.locals&&Ws.Z.locals;var zs=Autodesk.Viewing,Zs=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=this.markupsExtension.viewer,this.container=this.viewer.appendOrderedElementToViewer("markup-frames-container"),this.container.className="markup-frames-container",this.markupFrames={},this.layerFrames={},this.anchors={},this.segments={},this.rotationAxis=new THREE.Vector3(0,0,1),this.registerEventListeners()}var t,n;return t=e,n=[{key:"registerEventListeners",value:function(){this.onMarkupDirtyBinded=this.onMarkupDirty.bind(this),this.onLayerDirtyBinded=this.onLayerDirty.bind(this),this.onLayerDeletedBinded=this.onLayerDeleted.bind(this),this.onMarkupRemovedBinded=this.onMarkupRemoved.bind(this),this.renderAllBinded=this.renderAll.bind(this),this.onRectSelectorUpdatedBinded=this.onRectSelectorUpdated.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DIRTY,this.onLayerDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DELETED,this.onLayerDeletedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.renderAllBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.renderAllBinded),this.markupsExtension.markupsManager.addEventListener(A.RECT_SELECTOR_UPDATED,this.onRectSelectorUpdatedBinded),this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DIRTY,this.onLayerDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DELETED,this.onLayerDeletedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.renderAllBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.renderAllBinded),this.markupsExtension.markupsManager.removeEventListener(A.RECT_SELECTOR_UPDATED,this.onRectSelectorUpdatedBinded),this.viewer.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllBinded)}},{key:"renderAll",value:function(){var e=this.markupsExtension.markupsManager.getAllMarkups();this.renderMarkups(e);var t=this.markupsExtension.markupsManager.getLayersAsList();this.renderLayers(t)}},{key:"onMarkupDirty",value:function(e){var t=e.markup;this.renderMarkups([t])}},{key:"onLayerDirty",value:function(e){var t=e.layer;this.renderLayerSelectionFrame(t)}},{key:"renderLayers",value:function(e){var t=this;e.forEach((function(e){t.renderLayerSelectionFrame(e)}))}},{key:"renderMarkups",value:function(e){var t=this;e.forEach((function(e){e.belongsToGroup()||t.renderMarkupSelectionFrame(e),t.renderTransformAnchors(e),e.layer&&t.renderLayerSelectionFrame(e.layer)}))}},{key:"renderFrame",value:function(e,t,n){var r=this.getDocument();if(!e){(e=r.createElement("div")).className="markup-selection-frame-container",this.container.appendChild(e);var A=r.createElement("div");A.className="markup-selection-frame fill",A.style.width="".concat(Ie,"px"),A.style.height="".concat(Ie,"px"),Autodesk.Viewing.isIOSDevice()&&(A.className+=" ios"),e.appendChild(A),e.fillElement=A;for(var i=0;i<4;i++){var o=r.createElement("div");o.className="markup-selection-frame border",o.style.width="".concat(Ie,"px"),o.style.height="".concat(Ie,"px"),Autodesk.Viewing.isIOSDevice()&&(o.className+=" ios"),e.appendChild(o),e["border_".concat(i)]=o}}e.classList.contains("visible")||(e.classList.add("visible"),e.offsetHeight),n&&!e.fillElement.classList.contains("visible")?(e.fillElement.classList.add("visible"),e.fillElement.offsetHeight):!n&&e.fillElement.classList.contains("visible")&&(e.fillElement.classList.remove("visible"),e.fillElement.offsetHeight);var a=t.getClientBoundingBox(!0),s=a.getCenter(new THREE.Vector3);s.x-=Ie/2,s.y-=Ie/2;var u=a.getSize(new THREE.Vector3),c=it.radiansToDegrees(t.getRotation()+this.markupsExtension.renderer.getCameraRotation())||0;return n&&(e.fillElement.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) scale(").concat(u.x/Ie,", ").concat(u.y/Ie,")")),e.border_0.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(0px, ").concat(u.y/2,"px) scale(").concat(u.x/Ie,", ").concat(1/Ie,")"),e.border_1.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(0px, ").concat(-u.y/2,"px) scale(").concat(u.x/Ie,", ").concat(1/Ie,")"),e.border_2.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(").concat(u.x/2,"px, 0px) scale(").concat(1/Ie,", ").concat(u.y/Ie,")"),e.border_3.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(").concat(-u.x/2,"px, 0px) scale(").concat(1/Ie,", ").concat(u.y/Ie,")"),e}},{key:"renderMarkupSelectionFrame",value:function(e){var t=this.markupFrames[e.id],n=e.isHovered(),r=e.isSelected();(r||n)&&e.layer?this.markupFrames[e.id]=this.renderFrame(t,e,r):t&&t.classList.contains("visible")&&(t.classList.remove("visible"),t.offsetHeight)}},{key:"renderLayerSelectionFrame",value:function(e){var t=this.layerFrames[e.id],n=e.isHovered(),r=e.isSelected(),A=e.isVisible();(r||n)&&A&&!this.markupsExtension.markupsManager.isMarkupSessionOpen()?this.layerFrames[e.id]=this.renderFrame(t,e,!1):t&&t.classList.contains("visible")&&(this.container.removeChild(t),delete this.layerFrames[e.id])}},{key:"_renderScaleAnchors",value:function(e){var t=this;if(e.scaleHandler)if(e.isInEdit()){var n=e.scaleHandler.getScaleAnchors(),r=e.getClientCenter();n.forEach((function(n,A){var i="".concat(e.id,"_scale_").concat(A),o=e.getRotation()+t.markupsExtension.renderer.getCameraRotation();it.applyRotation(n.pos,o,r,t.rotationAxis);var a=e.scaleHandler.isDragging()&&n.id===e.scaleHandler.scaleAnchor.id;t.createAnchorElement(i,n.pos,a,o,"rectangle")}))}else for(var A=0;A<8;A++){var i="".concat(e.id,"_scale_").concat(A);this.anchors[i]&&this.anchors[i].classList.contains("visible")&&this.anchors[i].classList.remove("visible")}}},{key:"_renderRotationAnchor",value:function(e){if(e.rotationHandler){var t="".concat(e.id,"_rotation_anchor");if(e.isInEdit()){var n=e.rotationHandler.getRotationAnchor(),r=e.rotationHandler.isDragging();this.createAnchorElement(t,n,r);var A=e.getClientBoundingBox(!0),i=A.getCenter(new THREE.Vector3).add(new THREE.Vector3(0,A.getSize(new THREE.Vector3).y/2,0)),o=A.getCenter(new THREE.Vector3),a=e.getRotation()+this.markupsExtension.renderer.getCameraRotation();it.applyRotation(i,a,o,this.rotationAxis),this.createSegment(t,i,n)}else this.anchors[t]&&this.anchors[t].classList.contains("visible")&&(this.anchors[t].classList.remove("visible"),this.segments[t].classList.remove("visible"))}}},{key:"_renderAnchors",value:function(e){var t=this;if(e.anchorHandler){var n,r=function(e){var n=t.anchors[e];n&&n.classList.contains("visible")&&n.classList.remove("visible")},A=function(e){var n=t.segments[e];n&&n.classList.contains("visible")&&n.classList.remove("visible")},i="".concat(e.id,"_anchor"),o=e.anchorHandler.getAnchors();if(e.isInEdit()){for(var a=e.getClientCenter(),s=function(n){return e.applyScaleAndTranslation(n),n=t.markupsExtension.renderer.worldToClient(n),it.applyRotation(n,e.getRotation(),a,t.rotationAxis),n},u=null,c=null,l=0;l<o.length;l++){var h="".concat(i,"_").concat(l);c=s(o[l].clone());var p=o[l]===e.anchorHandler.activeAnchor;e.isAnchorHandlingAllowed(o[l])&&this.createAnchorElement(h,c,p),e.showPath()&&l>0&&this.createSegment(h,u,c),u=c}if(e.showPath()&&e.editState.closed){var d="".concat(i,"_").concat(o.length),f=s(o[0].clone());this.createSegment(d,c,f)}for(var y=(n=i,Object.keys(t.anchors).filter((function(e){return 0===e.indexOf(n)}))),g=function(e){return Object.keys(t.segments).filter((function(t){return 0===t.indexOf(e)}))}(i),E=o.length;E<y.length;E++)r("".concat(i,"_").concat(E));for(var B=e.editState.closed?g.length:g.length+1,m=o.length;m<B;m++)A("".concat(i,"_").concat(m))}else for(var v=0;v<=o.length;v++){var w="".concat(i,"_").concat(v);r(w),A(w)}}}},{key:"renderTransformAnchors",value:function(e){e.isCompleted()&&(this._renderScaleAnchors(e),this._renderRotationAnchor(e),this._renderAnchors(e))}},{key:"createAnchorElement",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=this.anchors[e],o=this.getDocument();if(!i){(i=o.createElement("div")).className="markup-anchor "+A;var a="".concat(2*ke,"px");i.style.width=a,i.style.height=a,this.container.appendChild(i),this.anchors[e]=i;var s=o.createElement("div");s.className="markup-anchor-fill "+A,i.appendChild(s),i.anchorFill=s}i.classList.contains("visible")||i.classList.add("visible"),n&&!i.anchorFill.classList.contains("visible")?i.anchorFill.classList.add("visible"):!n&&i.anchorFill.classList.contains("visible")&&i.anchorFill.classList.remove("visible");var u=it.radiansToDegrees(r);i.style.transform="translate(".concat(t.x-ke,"px, ").concat(t.y-ke,"px) rotate(").concat(u,"deg)")}},{key:"createSegment",value:function(e,t,n){var r=this.segments[e],A=this.getDocument();r||((r=A.createElement("div")).className="markup-selection-frame segment border",r.style.width="".concat(Ie,"px"),r.style.height="".concat(Ie,"px"),this.container.appendChild(r),this.segments[e]=r),r.classList.contains("visible")||r.classList.add("visible");var i=t.clone().add(n).multiplyScalar(.5);i.x-=Ie/2,i.y-=Ie/2;var o=t.distanceTo(n),a=it.getSignedAngle(n.clone().sub(t),this.markupsExtension.renderer.getCameraUpVector(),this.markupsExtension.renderer.getCameraEyeVector());r.style.transform="translate(".concat(i.x,"px, ").concat(i.y,"px) rotate(").concat(it.radiansToDegrees(a+this.markupsExtension.renderer.getCameraRotation()),"deg) scale(").concat(1/Ie,", ").concat(o/Ie,")")}},{key:"onLayerDeleted",value:function(e){var t=e.layer.id,n=this.layerFrames[t];n&&this.container.removeChild(n),delete this.layerFrames[t]}},{key:"onMarkupRemoved",value:function(e){var t=e.markup,n=t.id,r=this.markupFrames[n];r&&this.container.removeChild(r),delete this.markupFrames[n],t.layer&&t.layer.isEmpty()&&this.onLayerDeleted(t)}},{key:"onRectSelectorUpdated",value:function(e){var t=e.bounds,n=this.getDocument();this.rectSelectorFrame||(this.rectSelectorFrame=n.createElement("div"),this.rectSelectorFrame.className="rect-selector-frame",this.container.appendChild(this.rectSelectorFrame));var r=!t.isEmpty();r&&!this.rectSelectorFrame.classList.contains("visible")?(this.rectSelectorFrame.classList.add("visible"),this.rectSelectorFrame.offsetHeight):!r&&this.rectSelectorFrame.classList.contains("visible")&&(this.rectSelectorFrame.classList.remove("visible"),this.rectSelectorFrame.offsetHeight);var A=t.clone();A.min=this.markupsExtension.renderer.worldToClient(A.min),A.max=this.markupsExtension.renderer.worldToClient(A.max);var i=A.getSize(new THREE.Vector3);this.rectSelectorFrame.style.width="".concat(Math.abs(i.x),"px"),this.rectSelectorFrame.style.height="".concat(Math.abs(i.y),"px"),this.rectSelectorFrame.style.transformOrigin="top left",this.rectSelectorFrame.style.transform="translate(".concat(A.min.x,"px, ").concat(A.min.y,"px) scale(").concat(Math.sign(i.x),", ").concat(Math.sign(i.y),")")}},{key:"destroy",value:function(){var e=this;this.unregisterEventListeners(),Ft(this.markupFrames,(function(t){e.container.removeChild(t)})),this.markupFrames=null,Ft(this.layerFrames,(function(t){e.container.removeChild(t)})),this.layerFrames=null,Ft(this.anchors,(function(t){e.container.removeChild(t)})),this.anchors=null,Ft(this.segments,(function(t){e.container.removeChild(t)})),this.segments=null,this.markupsExtension=null,this.viewer=null}}],n&&Js(t.prototype,n),e}();zs.GlobalManagerMixin.call(Zs.prototype);var qs=n(22006),$s={};function eu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}$s.styleTagTransform=Ys(),$s.setAttributes=Ks(),$s.insert=Ps().bind(null,"head"),$s.domAPI=Is(),$s.insertStyleElement=Gs(),_s()(qs.Z,$s),qs.Z&&qs.Z.locals&&qs.Z.locals;var tu=Autodesk.Viewing,nu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=this.markupsExtension.viewer,this.container=this.viewer.appendOrderedElementToViewer("markup-links-container"),this.container.className="markup-links-container",this.links={},this.linksSizeCache={},this.registerEventListeners()}var t,n;return t=e,(n=[{key:"registerEventListeners",value:function(){this.onLinkDirtyBinded=this.onLinkDirty.bind(this),this.onMarkupDirtyBinded=this.onMarkupDirty.bind(this),this.renderAllLinksBinded=this.renderAllLinks.bind(this),this.onLinkDeletedBinded=this.onLinkDeleted.bind(this),this.markupsExtension.markupsManager.addEventListener(A.LINK_DIRTY,this.onLinkDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.LINK_SYNCED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.LINK_REMOVED,this.onLinkDeletedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VIEW_EXITED,this.renderAllLinksBinded),this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllLinksBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.LINK_DIRTY,this.onLinkDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.LINK_SYNCED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.LINK_REMOVED,this.onLinkDeletedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VIEW_EXITED,this.renderAllLinksBinded),this.viewer.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllLinksBinded)}},{key:"onMarkupDirty",value:function(e){var t=this,n=e.markup;n.layer&&Ft(n.layer.links,(function(e){t.renderLink(e)}))}},{key:"onLinkDirty",value:function(e){var t=e.link;this.renderLink(t)}},{key:"renderLink",value:function(e){if(!e.layer.isEmpty()){var t="".concat(e.layer.id,"_link_").concat(e.id);if(e.isVisible()){var n=e.isSelected(),r=e.isHovered(),A=this.markupsExtension.markupsManager.getActiveLayer()===e.layer,i=e.layer.layerData.attachments.length,o=this.markupsExtension.markupsManager.isMarkupSessionOpen()&&!A||this.markupsExtension.markupsManager.getSelectedLayers().length>0&&!e.layer.isSelected()||!this.markupsExtension.isToolEnabled();this.createLinkElement(t,e,n,A,r,i,o)}else this.links[t]&&this.links[t].classList.remove("visible");e.setDirty(!1)}}},{key:"renderAllLinks",value:function(){var e=this,t=this.markupsExtension.markupsManager.layers;Ft(t,(function(t){Ft(t.links,(function(t){e.renderLink(t)}))})),this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_RENDERED})}},{key:"createLinkElement",value:function(e,t,n,r,A,i,o){var a=this.links[e],s=this.getDocument();if(!a){(a=s.createElement("div")).className="link";var u=s.createElement("div");u.className="link-document-attachment",a.appendChild(u),this.container.appendChild(a),this.links[e]=a}a.classList.contains("visible")||a.classList.add("visible"),o&&!a.classList.contains("transparent")?a.classList.add("transparent"):!o&&a.classList.contains("transparent")&&a.classList.remove("transparent"),n&&!a.classList.contains("selected")?a.classList.add("selected"):!n&&a.classList.contains("selected")&&a.classList.remove("selected"),A&&!a.classList.contains("hover")?a.classList.add("hover"):!A&&a.classList.contains("hover")&&a.classList.remove("hover"),r&&!a.classList.contains("editable")?a.classList.add("editable"):!r&&a.classList.contains("editable")&&a.classList.remove("editable");var c=i>99?"99+":i;a.firstChild.innerText=c,this.linksSizeCache[c]||(this.linksSizeCache[c]=a.firstChild.getBoundingClientRect());var l=new THREE.Box3,h=new THREE.Vector3(this.linksSizeCache[c].width/2,this.linksSizeCache[c].height/2,0);l.expandByPoint(new THREE.Vector3),l.expandByVector(h),a.boundingBox=l;var p=t.getPosition(),d=this.markupsExtension.renderer.worldToClient(p);a.style.transform="translate(".concat(Math.round(d.x-this.linksSizeCache[c].width/2),"px, ").concat(Math.round(d.y-this.linksSizeCache[c].height/2),"px)"),l.makeEmpty(),l.expandByPoint(d),l.expandByVector(h)}},{key:"getLinkBoundingBox",value:function(e){var t="".concat(e.layer.id,"_link_").concat(e.id),n=this.links[t];return n?n.boundingBox:new THREE.Box3}},{key:"onLinkDeleted",value:function(e){var t=e.link,n="".concat(t.layer.id,"_link_").concat(t.id),r=this.links[n];r&&this.container.removeChild(r),delete this.links[n]}},{key:"destroy",value:function(){var e=this;this.unregisterEventListeners(),Ft(this.links,(function(t){e.container.removeChild(t)})),this.links=null,this.markupsExtension=null,this.viewer=null}}])&&eu(t.prototype,n),e}();function ru(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}tu.GlobalManagerMixin.call(nu.prototype);var Au=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.viewer=t.viewer,this.materials={}}var t,n;return t=e,n=[{key:"_getHashName",value:function(e,t,n,r){var A=e;return n?(A+="|f",t[u.FILL_COLOR]&&(A+="|c"+t[u.FILL_COLOR]),void 0!==t[u.FILL_OPACITY]&&(A+="|o"+t[u.FILL_OPACITY]*(r?je:1))):(t[u.THICKNESS]&&(A+="|t"+t[u.THICKNESS]),t[u.COLOR]&&(A+="|c"+t[u.COLOR]),void 0!==t[u.OPACITY]&&(A+="|o"+t[u.OPACITY]*(r?je:1))),A}},{key:"_setResolution",value:function(e,t){e.uniforms&&e.uniforms.resolution&&e.uniforms.resolution.value.set(t.width,t.height)}},{key:"getMaterial",value:function(e,t,n){var r=this._getHashName(e,t,n);return this.materials[r]?this.materials[r]:null}},{key:"_setFillBlending",value:function(e){e.blending=e.opacity<1?THREE.NoBlending:THREE.NormalBlending}},{key:"_setStrokeBlending",value:function(e){e.uniforms.opacity.value<1?(e.blending=THREE.CustomBlending,e.blendDst=THREE.ZeroFactor,e.blendSrc=THREE.OneFactor,e.blendEquation=THREE.AddEquation,Autodesk.Viewing.isIE11||(e.blendEquationAlpha=THREE.MaxEquation)):e.blending=THREE.NormalBlending}},{key:"_createStrokeMaterial",value:function(e,t,n){var r=this.markupsExtension.renderer.getResolution(),A=new jA({color:new THREE.Color(e[u.COLOR]),opacity:e[u.OPACITY]*(n?je:1),resolution:new THREE.Vector2(r.width,r.height),lineWidth:e[u.THICKNESS],side:THREE.FrontSide,miter:t});return this._setStrokeBlending(A),A}},{key:"_createFillMaterial",value:function(e,t){var n={color:new THREE.Color(e[u.FILL_COLOR]),transparent:!0,opacity:e[u.FILL_OPACITY]*(t?je:1),side:THREE.DoubleSide,wireframe:!1},r=new THREE.MeshBasicMaterial(n);return this._setFillBlending(r),r}},{key:"_editStrokeMaterial",value:function(e,t,n){e.uniforms.color.value.setStyle(t[u.COLOR]),e.uniforms.lineWidth.value=t[u.THICKNESS],e.uniforms.opacity.value=t[u.OPACITY]*(n?je:1),this._setStrokeBlending(e)}},{key:"_editFillMaterial",value:function(e,t,n){e.color.setStyle(t[u.FILL_COLOR]),e.opacity=t[u.FILL_OPACITY]*(n?je:1),e.needsUpdate=!0,this._setFillBlending(e)}},{key:"hasThicknessChanged",value:function(e,t){return e&&t&&e.uniforms&&t.uniforms&&e.uniforms.lineWidth.value!==t.uniforms.lineWidth.value}},{key:"addMaterial",value:function(e,t){var n=e.type,r=e.editState.style,A=e.isTransparent(),i=this._getHashName(n,r,t,A);if(this.materials[i])this.materials[i].refCount++;else{var o=t?this._createFillMaterial(r,A):this._createStrokeMaterial(r,e.needsMiter(),A);o.depthWrite=!1,o.depthTest=!1,o.transparent=!0,o.refCount=1,o.name=i,this.materials[i]=o}return this.materials[i]}},{key:"removeMaterial",value:function(e){this.materials[e.name]?(e.refCount--,0===e.refCount&&(e.dispose(),e.needsUpdate=!0,delete this.materials[e.name])):console.error("Trying to remove a non-existing material")}},{key:"editMaterial",value:function(e,t,n){if(this.materials[e.name]){var r=t.type,A=t.editState.style,i=t.isTransparent(),o=this._getHashName(r,A,n,i);if(o!==e.name)return 1!==e.refCount||this.materials[o]?(this.removeMaterial(e),this.addMaterial(t,n)):(n?this._editFillMaterial(e,A,i):this._editStrokeMaterial(e,A,i),delete this.materials[e.name],e.name=o,this.materials[o]=e,e.needsUpdate=!0,e)}else console.error("Trying to edit a non-existing material")}},{key:"destroy",value:function(){for(var e in this.materials)this.materials[e].dispose(),this.materials[e].needsUpdate=!0;this.materials={}}},{key:"updateScreenSize",value:function(e){for(var t in this.materials)this._setResolution(this.materials[t],e)}}],n&&ru(t.prototype,n),e}(),iu=n(86205),ou=n.n(iu),au=n(58706),su={};function uu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}su.styleTagTransform=Ys(),su.setAttributes=Ks(),su.insert=Ps().bind(null,"head"),su.domAPI=Is(),su.insertStyleElement=Gs(),_s()(au.Z,su),au.Z&&au.Z.locals&&au.Z.locals;var cu=Autodesk.Viewing,lu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=this.markupsExtension.viewer,this.container=this.viewer.appendOrderedElementToViewer("markup-text-container"),this.container.className="markup-text-container",this.labels={},this.textMarkups={},this.textSizeCache={},this.registerEventListeners()}var t,n;return t=e,n=[{key:"registerEventListeners",value:function(){this.onMarkupRemovedBinded=this.onMarkupRemoved.bind(this),this.onCameraChangedBinded=this.onCameraChanged.bind(this),this.onMarkupVisibilityChangedBinded=this.onMarkupVisibilityChanged.bind(this),this.onResizeBinded=this.onResize.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VISIBILITY_CHANGED,this.onMarkupVisibilityChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VISIBILITY_CHANGED,this.onMarkupVisibilityChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded)}},{key:"onCameraChanged",value:function(){this.renderTextMarkups()}},{key:"onResize",value:function(){var e=this;this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,(function(){e.onCameraChanged()}),{once:!0})}},{key:"renderTextMarkups",value:function(){var e=this;Ft(this.textMarkups,(function(t){e.renderMarkup(t)}))}},{key:"updateLabelPositionAndSize",value:function(e,t){function n(t,n){e.styleCache[t]!==n&&(e.style[t]=n,e.styleCache[t]=n)}var r=t.getEditState().text,A=t.getTextStyle(),i=this.markupsExtension.renderer.getFontToWorldScale(),o=this.markupsExtension.renderer.sizeFromWorldToClient(i),a=t.getClientBoundingBoxTextOnly(),s=a.getCenter(new THREE.Vector3),u=a.getSize(new THREE.Vector3),c=it.radiansToDegrees(t.getRotation()+this.markupsExtension.renderer.getCameraRotation());if(Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIOSDevice()){var l=parseFloat(A.fontSize)*o,h=Math.floor(l)||1,p=l/h,d=u.x/p;A.width="".concat(d,"px"),A.fontSize="".concat(h,"px"),Object.keys(A).forEach((function(e){n(e,A[e])})),e.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px)\n                                    translate(-50%, -50%)\n                                    rotate(").concat(c,"deg)\n                                    scale(").concat(p,")")}else{var f=t.getTextWidthInFontScale(),y=f.preciseWidth,g=f.width;A.width="".concat(g,"px"),Object.keys(A).forEach((function(e){n(e,A[e])}));var E=(y-g)*o;e.style.transform="translate(".concat(s.x-E/2,"px, ").concat(s.y,"px)\n                                    translate(-50%, -50%)\n                                    rotate(").concat(c,"deg)\n                                    scale(").concat(o,")")}t.textInputHandler.textboxActive||(e.innerText=r||"")}},{key:"renderMarkup",value:function(e){if(e.editState.anchors[0]){var t=this.labels[e.id],n=this.getDocument();if(!t){(t=n.createElement("div")).className="markup-text",t.id=e.id;var r=e.getEditState().text;t.innerText=r||"",t.styleCache={},this.container.appendChild(t),this.labels[e.id]=t,this.textMarkups[e.id]=e}e.isVisible()&&!t.classList.contains("visible")?t.classList.add("visible"):!e.isVisible()&&t.classList.contains("visible")&&t.classList.remove("visible"),e.editState.isSingleLine&&!t.classList.contains("single-line")&&t.classList.add("single-line"),e.isVisible()&&this.updateLabelPositionAndSize(t,e)}}},{key:"getLabel",value:function(e){return this.labels[e.id]}},{key:"onMarkupVisibilityChanged",value:function(e){var t=e.markup;e.visible,t.type===b&&this.renderMarkup(t)}},{key:"onMarkupRemoved",value:function(e){var t=e.markup.id,n=this.labels[t];n&&this.container.removeChild(n),delete this.labels[t],delete this.textMarkups[t]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.labels).length}},{key:"renderTextToCanvas",value:function(e,t,n,r,A,i){var o=this;if(this.isEmpty())i(e);else{var a={};Ht(this.textMarkups).forEach((function(e){e.isVisible()&&(a[e.id]=!0)}));var s={backgroundColor:null,logging:!1,scale:n,onclone:function(e){r();var n=o.markupsExtension.renderer.documentCamera,i=o.markupsExtension.renderer.markupsCamera;o.markupsExtension.renderer.documentCamera=t,o.markupsExtension.renderer.markupsCamera=t;for(var s=e.getElementsByClassName("markup-text-container")[0].children,u=0;u<s.length;u++){var c=s[u];if(a[c.id]){var l=o.textMarkups[c.id];c.classList.contains("visible")||c.classList.add("visible"),c.styleCache={},o.updateLabelPositionAndSize(c,l)}else c.classList.contains("visible")&&c.classList.remove("visible")}o.markupsExtension.renderer.documentCamera=n,o.markupsExtension.renderer.markupsCamera=i,A()}};ou()(this.container,s).then((function(t){var n=o.getDocument().createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1),r.drawImage(t,0,0);var A=e.getContext("2d");A.globalCompositeOperation="source-over",A.drawImage(n,0,0),i(e)}))}}},{key:"destroy",value:function(){var e=this;this.unregisterEventListeners(),Ft(this.labels,(function(t){e.container.removeChild(t)})),this.labels=null,this.textMarkups=null,this.textSizeCache=null,this.markupsExtension=null,this.viewer=null}}],n&&uu(t.prototype,n),e}();cu.GlobalManagerMixin.call(lu.prototype);var hu={worldToClient:function(e,t,n){var r=new THREE.Vector4(t.x,t.y,t.z,1);return r.applyMatrix4(n.matrixWorldInverse),r.applyMatrix4(n.projectionMatrix),r.w>0&&(r.x/=r.w,r.y/=r.w,r.z/=r.w),e.impl.viewportToClient(r.x,r.y)},getCameraEyeVector:function(e){return e.target.clone().sub(e.position).normalize()},getCameraRightVector:function(e){var t=hu.getCameraEyeVector(e);return(new THREE.Vector3).crossVectors(t,e.up).normalize()},getCameraUpVector:function(e){var t=hu.getCameraRightVector(e),n=hu.getCameraEyeVector(e);return(new THREE.Vector3).crossVectors(t,n).normalize()},getCameraRotation:function(e){return it.getSignedAngle(hu.getCameraUpVector(e),new THREE.Vector3(0,1,0),hu.getCameraEyeVector(e))}};const pu=hu;function du(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fu=Autodesk.Viewing.Private,yu=fu.ShaderPass,gu=fu.CopyShader,Eu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.viewer=this.markupsExtension.viewer,this.viewer.impl.updateCameraMatrices(),this.viewer.navigation.updateCamera(),this.documentCamera=this.viewer.navigation.getCamera(),this.documentCamera.updateMatrixWorld(),this.textRenderer=new lu(this.markupsExtension),this.frameRenderer=new Zs(this.markupsExtension),this.linksRenderer=new nu(this.markupsExtension),this.materialManager=new Au(this.markupsExtension),this.geometryManager=new ei(this.markupsExtension),this.is3d=this.viewer.model.is3d(),this.raycaster=new THREE.Raycaster,this.size={width:this.viewer.canvas.clientWidth,height:this.viewer.canvas.clientHeight},this.is3d?(this.viewSize=ze,this.markupsCamera=new THREE.OrthographicCamera(0,this.viewSize,this.viewSize,0,0,1),this.markupsCamera.position.set(0,0,1),this.markupsCamera.target=new THREE.Vector3(0,0,0)):this.markupsCamera=this.viewer.navigation.getCamera(),this.markups=[],this.renderer=this.viewer.impl.renderer(),this.glrenderer=this.viewer.impl.glrenderer(),this.copyPass=new yu(gu),this.copyPass.material.depthWrite=!1,this.copyPass.material.depthTest=!1,this.copyPass.material.transparent=!0,this._tmpScene=new THREE.Scene,this._black=new THREE.Color(0,0,0),this.absoluteRightVec=new THREE.Vector3(1,0,0),this.absoluteUpVec=new THREE.Vector3(0,1,0),this.absoluteEyeVec=new THREE.Vector3(0,0,1),this.tmpMatrix=new THREE.Matrix4,this.frustum=new THREE.Frustum,this.setMMtoUnitConversion(),this.setNormaStrokeWidth(),this.setNormaTextSize(),this.registerEventListeners(),this.updateCameraAndMaterialParameters()}var t,n;return t=e,n=[{key:"registerEventListeners",value:function(){this.onRenderBinded=this.onRender.bind(this),this.onResizeBinded=this.onResize.bind(this),this.invalidateBinded=this.invalidate.bind(this),this.onCameraChangedBinded=this.onCameraChanged.bind(this),this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.onRenderBinded),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_REMOVED,this.invalidateBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_CANCEL,this.invalidateBinded)}},{key:"removeEventListeners",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.onRenderBinded),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_REMOVED,this.invalidateBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_CANCEL,this.invalidateBinded)}},{key:"onCameraChanged",value:function(){this.eyeVector=null,this.upVector=null,this.rightVector=null}},{key:"getResolution",value:function(){var e=this.glrenderer.getPixelRatio();return{width:this.size.width*e,height:this.size.height*e}}},{key:"supportsInt32Index",value:function(){return!!this.glrenderer.supportsElementIndexUint()}},{key:"disposeTmpTarget",value:function(){this._tmpTarget&&(this._tmpTarget.dispose(),this._tmpTarget=null)}},{key:"createTempRenderTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getResolution();return this.disposeTmpTarget(),0!==e.width&&0!==e.height&&(this._tmpTarget=new THREE.WebGLRenderTarget(e.width,e.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),this._tmpTarget.texture.generateMipmaps=!1,!0)}},{key:"onRender",value:function(){this.render()}},{key:"onResize",value:function(e){this.size.width=e.width,this.size.height=e.height,this.updateCameraAndMaterialParameters()}},{key:"updateCameraAndMaterialParameters",value:function(){if(this.is3d){var e=this.size.width/(this.size.height||1),t=this.viewSize*e,n=this.markupsCamera.right-t;this.markupsCamera.position.x+=n/2,this.markupsCamera.target.x+=n/2,this.markupsCamera.right=t,this.markupsCamera.updateProjectionMatrix(),this.markupsCamera.updateMatrixWorld()}var r=this.getResolution();this._tmpTarget&&this.createTempRenderTarget(r),this.materialManager.updateScreenSize(r)}},{key:"render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.renderer.getFinalTarget(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.markupsCamera;this.tmpMatrix.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this.frustum.setFromProjectionMatrix(this.tmpMatrix);var r=function(t){var n=t.max,r=t.max.clone().setX(t.min.x),A=t.min,i=t.min.clone().setX(t.max.x);return e.frustum.containsPoint(n)||e.frustum.containsPoint(r)||e.frustum.containsPoint(A)||e.frustum.containsPoint(i)||e.frustum.intersectsBox(t)},A=function(e,t){return!(t.max.x<e.min.x||t.min.x>e.max.x||t.max.y<e.min.y||t.min.y>e.max.y)},i=[],o=[],a=[],s=function(){var r;0!==i.length&&((r=e._tmpScene).add.apply(r,i),e.glrenderer.render(e._tmpScene,n,t),e._tmpScene.children.length=0,i.length=0)},u=function(){var r;0!==o.length&&((r=e._tmpScene).add.apply(r,o),e.glrenderer.setClearColor(e._black,0),e.glrenderer.clearTarget(e._tmpTarget,!0,!1,!1),e.glrenderer.render(e._tmpScene,n,e._tmpTarget),e.copyPass.render(e.glrenderer,t,e._tmpTarget),e._tmpScene.children.length=0,o.length=0,a.length=0)};this.markups.forEach((function(c){var l=c.meshContainer;if(l.visible&&0!==l.children.length){if(!e.is3d){var h=c.getWorldBoundingBox(!0);if(!r(h))return}var p=c.fillMesh,d=c.strokeMesh,f=p&&p.material.opacity<1,y=d.material.uniforms.opacity.value<1;if(f||y){if(!e._tmpTarget&&!e.createTempRenderTarget())return;if(s(),!f&&p||!y)u(),e._tmpScene.add(l),l.remove(d),e.glrenderer.setClearColor(e._black,0),e.glrenderer.clearTarget(e._tmpTarget,!0,!1,!1),e.glrenderer.render(e._tmpScene,n,e._tmpTarget),e.copyPass.render(e.glrenderer,t,e._tmpTarget),l.remove(p),l.add(d),e.glrenderer.render(e._tmpScene,n,t),l.add(p),l.add(d),e._tmpScene.remove(l);else{var g=c.getWorldBoundingBox(!0);a.some((function(e){return(!c.isTransparent()||!e.isTransparent)&&A(g,e.bbox)}))&&u(),o.push(l),a.push({bbox:g,isTransparent:c.isTransparent()})}}else u(),i.push(l)}})),s(),u()}},{key:"getCameraEyeVector",value:function(){return this.eyeVector||(this.eyeVector=pu.getCameraEyeVector(this.markupsCamera)),this.eyeVector.clone()}},{key:"getCameraRightVector",value:function(){return this.rightVector||(this.rightVector=pu.getCameraRightVector(this.markupsCamera)),this.rightVector.clone()}},{key:"getCameraUpVector",value:function(){return this.upVector||(this.upVector=pu.getCameraUpVector(this.markupsCamera)),this.upVector.clone()}},{key:"getCameraRotation",value:function(){return pu.getCameraRotation(this.markupsCamera)}},{key:"worldToClient",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.markupsCamera,n=this.viewer.navigation.getScreenViewport(),r=e.clone().project(t);return new THREE.Vector3((r.x+1)/2*n.width,(1-r.y)/2*n.height,0)}},{key:"clientToWorld",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.markupsCamera,n=this.viewer.navigation.getScreenViewport(),r=new THREE.Vector3;r.x=e.x/n.width*2-1,r.y=-(e.y/n.height*2-1);var A=r.unproject(t);return A.z=0,A}},{key:"sizeFromWorldToClient",value:function(e){var t=this.worldToClient(new THREE.Vector3),n=this.worldToClient(new THREE.Vector3(e,0,0));return t.distanceTo(n)}},{key:"sizeFromClientToWorld",value:function(e){var t=this.clientToWorld(new THREE.Vector3),n=this.clientToWorld(new THREE.Vector3(e,0,0));return t.distanceTo(n)}},{key:"multiplyByNormaStrokeWidth",value:function(e){return this.normaStrokeWidth*e}},{key:"documentCameraToMarkupsCamera",value:function(e){if(!this.is3d)return e.z=0,e;var t=this.worldToClient(e,this.documentCamera);return this.clientToWorld(t)}},{key:"_fromMMtoWorldUnits",value:function(e){if(this.is3d)return 1;var t=this.viewer.model,n=t.getMetadata("page_dimensions","page_units",null)||t.getMetadata("page_dimensions","model_units","mm"),r=Autodesk.Viewing.Private.convertUnits("mm",n,1,e);return t.isLeaflet()&&(r*=this.viewer.impl.getFitBounds(!0).getSize(new THREE.Vector3).x/t.getMetadata("page_dimensions","page_width")),r}},{key:"_calcNormaSize",value:function(e,t){var n=this.mmToWorldUnitFactor*e,r=this.viewer.impl.getFitBounds(!0).getSize(new THREE.Vector3),A=r.x,i=r.y,o=Math.sqrt(A*A+i*i);return Math.min(n,o*t)}},{key:"setMMtoUnitConversion",value:function(){this.mmToWorldUnitFactor=this._fromMMtoWorldUnits(1)}},{key:"setNormaStrokeWidth",value:function(){this.is3d?this.normaStrokeWidth=$e:this.normaStrokeWidth=this._calcNormaSize(he,Ze)}},{key:"setNormaTextSize",value:function(){this.is3d?this.normaTextSize=et:this.normaTextSize=this._calcNormaSize(de,qe)}},{key:"getNormaStrokeWidth",value:function(){return this.normaStrokeWidth}},{key:"getFontToWorldScale",value:function(){return this.normaTextSize/pe}},{key:"addToScene",value:function(e){var t,n,r,A=function(e){return e.layer&&e.layer.layerData&&e.layer.layerData.metadata&&e.layer.layerData.metadata.created_at};A(e)?(t=e,n=this.markups,r=function(e,t){if(!A(e))return 1;var n=Date.parse(e.layer.layerData.metadata.created_at),r=Date.parse(t.layer.layerData.metadata.created_at);return n>r?1:n<r?-1:e.id>t.id?1:e.id<t.id?-1:0},n.splice(function(e,t,n){if(0===t.length)return-1;for(var r=0,A=t.length,i=Math.floor(A/2);A-r>1;){var o=n(t[i],e);if(0===o)return i;o>0?A=i:r=i,i=Math.floor(r+(A-r)/2)}return n(t[i],e)>0?i-1:i}(t,n,r)+1,0,t)):this.markups.push(e)}},{key:"removeFromScene",value:function(e){lt.remove(this.markups,(function(t){return t===e}))}},{key:"invalidate",value:function(){this.markupsExtension.viewer.impl.invalidate(!1,!1,!0)}},{key:"updateRaycaster",value:function(e){var t=this.viewer.navigation.getScreenViewport(),n=e.x/t.width*2-1,r=-e.y/t.height*2+1;this.raycaster.ray.origin.set(n,r,(this.markupsCamera.near+this.markupsCamera.far)/(this.markupsCamera.near-this.markupsCamera.far)).unproject(this.markupsCamera),this.raycaster.ray.direction.set(0,0,-1)}},{key:"destroy",value:function(){this.removeEventListeners(),this.frameRenderer&&(this.frameRenderer.destroy(),this.frameRenderer=null),this.linksRenderer&&(this.linksRenderer.destroy(),this.linksRenderer=null),this.textRenderer&&(this.textRenderer.destroy(),this.textRenderer=null),this.materialManager&&(this.materialManager.destroy(),this.materialManager=null),this.geometryManager&&(this.geometryManager.destroy(),this.geometryManager=null),this.disposeTmpTarget(),this.invalidate(),this.markupsExtension=null,this.viewer=null}}],n&&du(t.prototype,n),e}();function Bu(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function mu(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}var vu=36e5,wu={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ku=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Cu=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,bu=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Su(e){var t,n={},r=e.split(wu.dateTimeDelimiter);if(r.length>2)return n;if(/:/.test(r[0])?(n.date=null,t=r[0]):(n.date=r[0],t=r[1],wu.timeZoneDelimiter.test(n.date)&&(n.date=e.split(wu.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length))),t){var A=wu.timezone.exec(t);A?(n.time=t.replace(A[1],""),n.timezone=A[1]):n.time=t}return n}function Tu(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(n);if(!r)return{year:null};var A=r[1]&&parseInt(r[1]),i=r[2]&&parseInt(r[2]);return{year:null==i?A:100*i,restDateString:e.slice((r[1]||r[2]).length)}}function xu(e,t){if(null===t)return null;var n=e.match(ku);if(!n)return null;var r=!!n[4],A=Mu(n[1]),i=Mu(n[2])-1,o=Mu(n[3]),a=Mu(n[4]),s=Mu(n[5])-1;if(r)return function(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}(0,a,s)?function(e,t,n){var r=new Date(0);r.setUTCFullYear(e,0,4);var A=7*(t-1)+n+1-(r.getUTCDay()||7);return r.setUTCDate(r.getUTCDate()+A),r}(t,a,s):new Date(NaN);var u=new Date(0);return function(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(Fu[t]||(Ru(e)?29:28))}(t,i,o)&&function(e,t){return t>=1&&t<=(Ru(e)?366:365)}(t,A)?(u.setUTCFullYear(t,i,Math.max(A,o)),u):new Date(NaN)}function Mu(e){return e?parseInt(e):1}function Uu(e){var t=e.match(Cu);if(!t)return null;var n=Qu(t[1]),r=Qu(t[2]),A=Qu(t[3]);return function(e,t,n){return 24===e?0===t&&0===n:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}(n,r,A)?n*vu+6e4*r+1e3*A:NaN}function Qu(e){return e&&parseFloat(e.replace(",","."))||0}function Lu(e){if("Z"===e)return 0;var t=e.match(bu);if(!t)return 0;var n="+"===t[1]?-1:1,r=parseInt(t[2]),A=t[3]&&parseInt(t[3])||0;return function(e,t){return t>=0&&t<=59}(0,A)?n*(r*vu+6e4*A):NaN}var Fu=[31,null,31,30,31,30,31,31,30,31,30,31];function Ru(e){return e%400==0||e%4==0&&e%100}function Hu(e){mu(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function _u(e){mu(1,arguments);var t=Hu(e);return t.setHours(0,0,0,0),t}function Du(e){mu(1,arguments);var t=Hu(e);return t.setHours(23,59,59,999),t}function Iu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ou=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.options=n,this.filters=this.markupsExtension.cache.filters||this.getInitialFilters()}var t,n;return t=e,n=[{key:"getInitialFilters",value:function(){return{createdByFilter:[],createdAtStartFilter:null,createdAtEndFilter:null,showPrivateFilter:!0,showPublishedFilter:!0,showArchivedFilter:!1,toggleMarkupViewFilter:!0}}},{key:"updateFilters",value:function(e){this.markupsExtension.cache.filters=this.filters=Object.assign({},this.filters,e),this.markupsExtension.loadLayers(),this.markupsExtension.markupsManager.dispatchEvent({type:A.FILTER_CHANGED,filters:this.filters})}},{key:"filterLayers",value:function(e,t){var n=this;return!t&&this.filters.hideAllMarkups?[]:e.filter((function(e){return n.filterByVersion(e)&&n.filterBySheet(e,t&&n.filters.toggleMarkupViewFilter)&&n.filterByDate(e)&&n.filterPrivate(e)&&n.filterPublished(e)&&n.filterArchived(e)&&n.filterCreator(e)&&n.filterDeleted(e)}))}},{key:"isDateInRange",value:function(e,t,n){var r=function(e,t){mu(1,arguments);var n=t||{},r=null==n.additionalDigits?2:Bu(n.additionalDigits);if(2!==r&&1!==r&&0!==r)throw new RangeError("additionalDigits must be 0, 1 or 2");if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var A,i=Su(e);if(i.date){var o=Tu(i.date,r);A=xu(o.restDateString,o.year)}if(isNaN(A)||!A)return new Date(NaN);var a,s=A.getTime(),u=0;if(i.time&&(u=Uu(i.time),isNaN(u)||null===u))return new Date(NaN);if(!i.timezone){var c=new Date(s+u),l=new Date(0);return l.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),l.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),l}return a=Lu(i.timezone),isNaN(a)?new Date(NaN):new Date(s+u+a)}(e);return function(e,t){mu(2,arguments);var n=t||{},r=Hu(e).getTime(),A=Hu(n.start).getTime(),i=Hu(n.end).getTime();if(!(A<=i))throw new RangeError("Invalid interval");return r>=A&&r<=i}(r,{start:_u(t),end:Du(n)})}},{key:"filterByDate",value:function(e){return!this.filters.createdAtStartFilter||!this.filters.createdAtEndFilter||this.isDateInRange(e.metadata.created_at,this.filters.createdAtStartFilter,this.filters.createdAtEndFilter)}},{key:"filterBySheet",value:function(e,t){if(t||!this.options.hasMultiSheet)return!0;var n=e.metadata.markup_metadata&&e.metadata.markup_metadata.sheetName;return!this.options.sheetName||!n||Wt(this.options.sheetName,n)}},{key:"filterDeleted",value:function(e){return e.status!==H}},{key:"filterPrivate",value:function(e){return this.filters.showPrivateFilter||e.metadata.status!==O}},{key:"filterPublished",value:function(e){return this.filters.showPublishedFilter||e.metadata.status!==P}},{key:"filterArchived",value:function(e){return this.filters.showArchivedFilter||e.metadata.status!==V}},{key:"filterCreator",value:function(e){return!this.filters.createdByFilter||0===this.filters.createdByFilter.length||this.filters.createdByFilter.some((function(t){return e.metadata.created_by===t.value}))}},{key:"filterByVersion",value:function(e){var t=e.metadata.starting_version;return this.options.documentVersion>=t}},{key:"destroy",value:function(){this.filters=null,this.options=null}}],n&&Iu(t.prototype,n),e}();function Pu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ku=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Pu(this,e),this.options=t}var t,n;return t=e,(n=[{key:"canPublishMarkup",value:function(e){return!!(e&&e.guid&&!e.metadata.status!==P&&this.options.userId&&e.metadata.permitted_statuses&&-1!==e.metadata.permitted_statuses.indexOf(P))}},{key:"canArchiveMarkup",value:function(e){return!!(e&&e.guid&&!e.metadata.status!==V&&this.options.userId&&e.metadata.permitted_statuses&&-1!==e.metadata.permitted_statuses.indexOf(V))}},{key:"canEditMarkup",value:function(e){if(!e)return!0;if(!e.guid)return!1;var t=[O,P];return!(!this.options.userId||-1===t.indexOf(e.metadata.status))&&!(this.options.documentVersion<this.options.currentRawDocumentVersion)&&(this.options.isAdmin||this.options.userId===e.metadata.created_by)}},{key:"canDeleteMarkup",value:function(e){if(!e||!e.guid)return!1;var t=[I,O];return!(!this.options.userId||-1===t.indexOf(e.metadata.status))&&(this.options.isAdmin||this.options.userId===e.metadata.created_by)}},{key:"canEditMarkupAttachment",value:function(e,t){return!(!e||!e.guid)&&e.metadata.status!==K&&e.metadata.status!==V&&this.options.documentVersion===this.options.currentRawDocumentVersion&&!!this.options.userId&&(!!this.options.isAdmin||!t||t&&this.options.userId===t.attributes.created_by)}},{key:"canCreateMarkup",value:function(){return this.options.documentVersion===this.options.currentRawDocumentVersion}},{key:"destroy",value:function(){this.options=null}}])&&Nu(t.prototype,n),e}();function Vu(e){return Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vu(e)}function Gu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ju(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Yu=Autodesk.Viewing.getGlobal(),Wu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.registerEventListeners()}var t,n,r;return t=e,r=[{key:"send",value:function(e,t){var n=Yu.webkit&&Yu.webkit.messageHandlers.callbackHandler,r=n?function(e,t){n.postMessage({command:e,data:t})}:null,A=Yu.JSINTERFACE,i="object"===Vu(t)?JSON.stringify(t):t;r?void 0!==i?r(e,i):r(e):A&&A[e]&&(void 0!==i?A[e](i):A[e]())}},{key:"correctPixelRatio",value:function(e){return Autodesk.Viewing.isAndroidDevice()&&(e.min.multiplyScalar(window.devicePixelRatio),e.max.multiplyScalar(window.devicePixelRatio)),e}}],(n=[{key:"registerEventListeners",value:function(){this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.onLayerDeselected),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DESELECTED,this.onMarkupDeselected),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED_FROM_DIFFERENT_SHEET,this.onLayerSelectedDifferentSheet),this.markupsExtension.markupsManager.addEventListener(A.LAYER_EDITED_FROM_DIFFERENT_SHEET,this.onLayerEditDifferentSheet),this.markupsExtension.markupsManager.addEventListener(Wn.HISTORY_CHANGED_EVENT,this.onHistoryChanged),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.onMarkupSessionStart),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.onMarkupSessionEnd),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_START,this.onMarkupDrawingStart),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_END,this.onMarkupDrawingEnd),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_CANCEL,this.onMarkupDrawingCancel),this.markupsExtension.markupsManager.addEventListener(A.LINK_SELECTED,this.onLinkSelected),this.markupsExtension.markupsManager.addEventListener(A.LINK_DESELECTED,this.onLinkDeselected),this.onLayerReadyToSaveChangedBinded=this.onLayerReadyToSaveChanged.bind(this),this.markupsExtension.markupsManager.addEventListener(A.LAYER_READY_TO_SAVE,this.onLayerReadyToSaveChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VIEW_ENTERED,this.onMarkupViewEntered),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VIEW_EXITED,this.onMarkupViewExited),this.markupsExtension.markupsManager.addEventListener(A.TEXT_EDITING_STARTED,this.onTextEditingStarted),this.markupsExtension.markupsManager.addEventListener(A.TEXT_EDITING_ENDED,this.onTextEditingEnded),this.updateContextualMenuBinded=this.updateContextualMenu.bind(this),this.hideContextualMenuBinded=this.hideContextualMenu.bind(this),this.updateContextualMenuDebouncedShort=lt.debounce(this.updateContextualMenuBinded,10),this.updateContextualMenuDebouncedLong=lt.debounce(this.updateContextualMenuBinded,200),this.markupsExtension.markupsManager.addEventListener(Wn.HISTORY_CHANGED_EVENT,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DIRTY,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SYNCED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_END,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_TOOL_ENABLED_CHANGED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_START,this.hideContextualMenuBinded),this.markupsExtension.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.updateContextualMenuDebouncedLong)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.onLayerDeselected),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DESELECTED,this.onMarkupDeselected),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED_FROM_DIFFERENT_SHEET,this.onLayerSelectedDifferentSheet),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_EDITED_FROM_DIFFERENT_SHEET,this.onLayerEditDifferentSheet),this.markupsExtension.markupsManager.removeEventListener(Wn.HISTORY_CHANGED_EVENT,this.onHistoryChanged),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.onMarkupSessionStart),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.onMarkupSessionEnd),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_START,this.onMarkupDrawingStart),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_END,this.onMarkupDrawingEnd),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_CANCEL,this.onMarkupDrawingCancel),this.markupsExtension.markupsManager.removeEventListener(A.LINK_SELECTED,this.onLinkSelected),this.markupsExtension.markupsManager.removeEventListener(A.LINK_DESELECTED,this.onLinkDeselected),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_READY_TO_SAVE,this.onLayerReadyToSaveChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VIEW_ENTERED,this.onMarkupViewEntered),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VIEW_EXITED,this.onMarkupViewExited),this.markupsExtension.markupsManager.removeEventListener(A.TEXT_EDITING_STARTED,this.onTextEditingStarted),this.markupsExtension.markupsManager.removeEventListener(A.TEXT_EDITING_ENDED,this.onTextEditingEnded),this.markupsExtension.markupsManager.removeEventListener(Wn.HISTORY_CHANGED_EVENT,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DIRTY,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SYNCED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_END,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_TOOL_ENABLED_CHANGED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_START,this.hideContextualMenuBinded),this.markupsExtension.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.updateContextualMenuDebouncedLong),this.updateContextualMenuDebouncedShort.cancel(),this.updateContextualMenuDebouncedLong.cancel()}},{key:"markupToolLoaded",value:function(){e.send("onMarkupToolLoaded")}},{key:"onMarkupSessionStart",value:function(){e.send("onMarkupSessionStart")}},{key:"onMarkupSessionEnd",value:function(){e.send("onMarkupSessionEnd")}},{key:"onMarkupDrawingStart",value:function(t){var n=t.markup;e.send("onMarkupDrawingStart",n.type)}},{key:"onMarkupDrawingEnd",value:function(t){var n=t.markup;e.send("onMarkupDrawingEnd",n.type)}},{key:"onMarkupDrawingCancel",value:function(t){var n=t.markup;e.send("onMarkupDrawingCancel",n.type)}},{key:"onLayerSelectedDifferentSheet",value:function(t){var n=t.layerGuid;e.send("onLayerSelectedDifferentSheet",n)}},{key:"onLayerEditDifferentSheet",value:function(t){var n=t.layerGuid;e.send("onLayerEditDifferentSheet",n)}},{key:"onLayerSelected",value:function(t){var n=t.layer,r=n.getGuid();if(r){var A={guid:r,boundingBox:e.correctPixelRatio(n.getClientBoundingBox(!0))};e.send("onLayerSelected",A)}}},{key:"onLayerDeselected",value:function(t){var n=t.layer.getGuid();n&&e.send("onLayerDeselected",n)}},{key:"onMarkupSelected",value:function(t){var n=t.markup,r={id:n.id,layerGuid:n.layer&&n.layer.getGuid()||"",type:n.type,style:n.editState.style,boundingBox:e.correctPixelRatio(n.getClientBoundingBox(!0,!0))};e.send("onMarkupSelected",r)}},{key:"onMarkupDeselected",value:function(t){var n=t.markup;e.send("onMarkupDeselected",n.id)}},{key:"onHistoryChanged",value:function(t){var n={enableUndo:t.hasUndo,enableRedo:t.hasRedo};e.send("onMarkupHistoryChanged",n)}},{key:"onLayerReadyToSaveChanged",value:function(t){var n=t.readyToSave;e.send("onLayerReadyToSaveChanged",n)}},{key:"postLayer",value:function(t,n,r){var A,i={metadata:t,resources:(A={},Gu(A,$,n[0]),Gu(A,ee,n[1]),A),requestId:r};e.send("onPostLayer",i)}},{key:"updateLayer",value:function(t,n,r,A){var i,o={originalGuid:t,metadata:n,resources:(i={},Gu(i,$,r[0]),Gu(i,ee,r[1]),i),requestId:A};e.send("onUpdateLayer",o)}},{key:"deleteLayer",value:function(t,n){var r={guid:t,requestId:n};e.send("onDeleteLayer",r)}},{key:"publishLayer",value:function(t,n){var r={guid:t,requestId:n};e.send("onPublishLayer",r)}},{key:"archiveLayer",value:function(t,n,r){var A={guid:t,closeVersion:n,requestId:r};e.send("onArchiveLayer",A)}},{key:"onLinkSelected",value:function(t){var n=t.link,r={type:n.type,layerGuid:n.layer.layerData.guid,boundingBox:n.getClientBoundingBox()};e.send("onLinkSelected",r)}},{key:"onLinkDeselected",value:function(t){var n=t.link,r={type:n.type,layerGuid:n.layer.layerData.guid};e.send("onLinkDeselected",r)}},{key:"updateContextualMenu",value:function(){if(!this.markupsExtension.markupsManager.getDuringCreationMarkup()){var e=this.markupsExtension.markupsManager.getSelectedMarkups()[0];if(e)return void this.onMarkupSelected({markup:e});if(!this.markupsExtension.markupsManager.isMarkupSessionOpen()){var t=this.markupsExtension.markupsManager.getSelectedLayer();if(t)return void this.onLayerSelected({layer:t})}}this.hideContextualMenu()}},{key:"hideContextualMenu",value:function(){e.send("onHideContextualMenu")}},{key:"onMarkupViewExited",value:function(){e.send("onMarkupViewExited")}},{key:"onMarkupViewEntered",value:function(){e.send("onMarkupViewEntered")}},{key:"onTextEditingStarted",value:function(){e.send("onTextEditingStarted")}},{key:"onTextEditingEnded",value:function(){e.send("onTextEditingEnded")}},{key:"destroy",value:function(){this.unregisterEventListeners(),this.iosSend=null,this.androidSend=null,this.send=null}}])&&ju(t.prototype,n),r&&ju(t,r),e}();function Xu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ju=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cache={},this.currentUrn="default"}var t,n;return t=e,n=[{key:"setCurrentUrn",value:function(e){this.currentUrn=e,this.cache[e]=this.cache[e]||{}}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentUrn;this.cache[n][e]=t}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentUrn;delete this.cache[t][e]}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentUrn;return this.cache[t][e]}},{key:"getAsList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn,n=[];return Object.keys(this.cache[t]).forEach((function(r){n.push(e.cache[t][r])})),n}},{key:"getCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;return this.cache[e]}},{key:"cleanCache",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;Object.keys(this.cache[t]).forEach((function(t){e.remove(t)}))}},{key:"length",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;return Object.keys(this.cache[e]).length}},{key:"isEmpty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;return 0===this.length(e)}}],n&&Xu(t.prototype,n),e}();function zu(e,t,n,r,A,i,o){try{var a=e[i](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,A)}function Zu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var qu=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.options=n||{}}var t,n,r,A;return t=e,n=[{key:"postLayer",value:(r=regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("postLayer"),e.abrupt("return",new Promise((function(e,t){})));case 2:case"end":return e.stop()}}),e)})),A=function(){var e=this,t=arguments;return new Promise((function(n,A){var i=r.apply(e,t);function o(e){zu(i,n,A,o,a,"next",e)}function a(e){zu(i,n,A,o,a,"throw",e)}o(void 0)}))},function(e,t){return A.apply(this,arguments)})},{key:"publishLayer",value:function(e){return console.log("publishLayer"),new Promise((function(e,t){}))}},{key:"archiveLayer",value:function(e,t){return console.log("archiveLayer"),new Promise((function(e,t){}))}},{key:"updateLayer",value:function(e,t){return console.log("updateLayer"),new Promise((function(e,t){}))}},{key:"deleteLayer",value:function(e){return console.log("deleteLayer"),new Promise((function(e,t){}))}},{key:"postDocumentAttachment",value:function(e,t){return console.log("postDocumentAttachment"),new Promise((function(e,t){}))}},{key:"deleteDocumentAttachment",value:function(e){return console.log("deleteDocumentAttachment"),new Promise((function(e,t){}))}},{key:"renameDocumentAttachment",value:function(e,t){return console.log("renameDocumentAttachment"),new Promise((function(e,t){}))}},{key:"requestMarkups",value:function(e,t,n,r){return console.log("requestMarkups"),new Promise((function(e,t){}))}},{key:"getAttachment",value:function(e,t,n){return console.log("getAttachment"),new Promise((function(e,t){}))}},{key:"cancelRequests",value:function(){console.log("cancelRequests")}}],n&&Zu(t.prototype,n),e}();function $u(e){return $u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$u(e)}function ec(e,t,n,r,A,i,o){try{var a=e[i](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,A)}function tc(e){return function(){var t=this,n=arguments;return new Promise((function(r,A){var i=e.apply(t,n);function o(e){ec(i,r,A,o,a,"next",e)}function a(e){ec(i,r,A,o,a,"throw",e)}o(void 0)}))}}function nc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rc(e,t){return rc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},rc(e,t)}function Ac(e,t){return!t||"object"!==$u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ic(e){return ic=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ic(e)}var oc=n(23493),ac=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rc(e,t)}(c,e);var t,n,r,A,i,o,a,s,u=(a=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ic(a);if(s){var n=ic(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ac(this,e)});function c(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=u.call(this,e,t)).issueType=n.ISSUES_TYPE.markup;var r=n.ENV_TABLE[t.env]||n.ENV_TABLE.Development;return n.ISSUE_SERVICE_URL=r.ISSUE_SERVICE,n.OBJECT_STORAGE_SERVICE_URL=r.OBJECT_STORAGE,n.maxPageLimit=200,n.xhrReq=[],n.signedS3Requests={},n.headers=[{name:"x-ads-acm-namespace",value:n.options.acmNamespace},{name:"x-ads-acm-check-groups",value:"true"}],n.options.acmScopes&&n.headers.push({name:"x-ads-acm-scopes",value:n.options.acmScopes}),n.flushSignedS3DownloadRequestsThrottled=oc((function(){n.flushSignedS3DownloadRequests()}),30),n}return t=c,n=[{key:"checkValidation",value:function(){var e=this.getAccessToken();return this.valid=!!e&&!!this.options.issueProject&&!!this.issueType,this.valid}},{key:"wait",value:function(e){return new Promise((function(t){setTimeout(t,e)}))}},{key:"getSignedS3UploadUrl",value:function(e){var t=this;return new Promise((function(n,r){e+="/signeds3upload";var A=t.getAjaxCallback(n,r,!0),i=t.createRequest("GET",e,"application/vnd.api+json",A,!1,!1);i.responseType="json",t.injectHeaders(i,t.headers),i.send()}))}},{key:"getSignedS3DownloadUrl",value:function(e,t){var n=this;return new Promise((function(r,A){n.signedS3Requests[e]||(n.signedS3Requests[e]={}),n.signedS3Requests[e][t]={resolve:r,reject:A},25===Object.keys(n.signedS3Requests[e]).length?n.flushSignedS3DownloadRequests():n.flushSignedS3DownloadRequestsThrottled()}))}},{key:"flushSignedS3DownloadRequests",value:function(){var e=this;Object.keys(this.signedS3Requests).forEach((function(t){var n="".concat(e.OBJECT_STORAGE_SERVICE_URL,"buckets/").concat(t,"/objects/batchsigneds3download?useCdn=true"),r=e.signedS3Requests[t],A={onLoad:function(e){var t=e.currentTarget.response;200===e.currentTarget.status?Object.keys(t.results).forEach((function(e){var n=t.results[e];"complete"===n.status?r[e].resolve(n.url):r[e].reject(n)})):Object.keys(t.results).forEach((function(t){r[t].reject(e)}))}},i=e.createRequest("POST",n,"application/json",A,!1,!0);i.responseType="json",e.injectHeaders(i,e.headers);var o={requests:Object.keys(r).map((function(e){return{objectKey:e}}))},a=JSON.stringify(o);i.send(a)})),this.signedS3Requests={}}},{key:"completeUpload",value:function(e,t,n,r){e+="/signeds3upload";var A=this.getAjaxCallback(n,r,!0),i=this.createRequest("POST",e,"application/json",A,!1,!1);i.responseType="json",this.injectHeaders(i,this.headers),i.send(JSON.stringify({uploadKey:t}))}},{key:"sendWithRetry",value:(o=tc(regeneratorRuntime.mark((function e(t,n){var r,A;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<5)){e.next=22;break}return e.prev=2,e.next=5,t.apply(this,n);case 5:return A=e.sent,e.abrupt("return",A);case 9:if(e.prev=9,e.t0=e.catch(2),console.error(e.t0),5!==r+1){e.next=16;break}throw e.t0;case 16:return console.warn("Request failed - Retrying..."),e.next=19,this.wait(500);case 19:r++,e.next=1;break;case 22:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e,t){return o.apply(this,arguments)})},{key:"_requestMarkups",value:function(e,t,n,r){var A=this;return this.checkValidation()?(e||(e=this.maxPageLimit),t||(t=0),new Promise((function(i,o){if(!A.options.documentUrn)return o();var a=[A.ISSUE_SERVICE_URL,"containers/",A.options.issueProject,A.issueType.endpoint].join("");a=[a,"?page[limit]="+e+"&page[offset]="+t].join(""),A.options.documentUrn&&(a=[a,"&filter[target_urn]=",encodeURIComponent(A.options.documentUrn)].join("")),a=[a,"&include=attachments"].join(""),r&&(a=[a,"&filter[status]=",r].join("")),a=[a,"&sort=-created_at"].join("");var s=A.getAjaxCallback(i,o),u=A.createRequest("GET",a,"application/vnd.api+json",s,!1,!0);A.injectHeaders(u,n),u.send()}))):Promise.reject("Service is unavailable.")}},{key:"requestMarkups",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._requestMarkups,t)}},{key:"postMarkups",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,A){var i=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.issueType.endpoint].join(""),o=n.getAjaxCallback(r,A),a=n.createRequest("POST",i,"application/vnd.api+json",o,!1,!1);n.injectHeaders(a,t);var s={data:{type:n.issueType.value,attributes:e}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"fetchOSSBucketForAttachment",value:function(e){var t=this;return new Promise((function(n,r){t.fetchLocationForNewOssAttachment([],{onLoad:function(t){var A=t.currentTarget;if(201===A.status||200===A.status){var i=JSON.parse(A.responseText);e.ossPath=i.data.attributes.urn,n()}else r("Failed fetching OSS Bucket")},onError:r,onTimeout:r})}))}},{key:"uploadAttachment",value:function(e){var t=this.extractOssBucketAndId(e.ossPath),n=t[0],r=t[1];return this.postAttachment(r,e.data,n)}},{key:"_postLayer",value:(i=tc(regeneratorRuntime.mark((function e(t,n,r){var A,i,o,a,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A=function(){if(0===n.length)return Promise.resolve();var e=n.map((function(e){return s.fetchOSSBucketForAttachment(e)}));return Promise.all(e)},i=function(){if(0===n.length)return Promise.resolve();var e=n.map((function(e){return s.uploadAttachment(e)}));return Promise.all(e)},o=function(){return n.forEach((function(e){t.resource_urns[e.type]=e.ossPath})),r?s.updateLayer(r,t):s.postMarkups(t,[])},e.next=5,A();case 5:return e.next=7,i();case 7:return e.next=9,o();case 9:return a=e.sent,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"postLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._postLayer,t)}},{key:"parseResponse",value:function(e){try{var t=JSON.parse(e).data;return Promise.resolve(t)}catch(e){return Promise.reject(e)}}},{key:"_publishLayer",value:function(e){var t=this;return this.checkValidation()?new Promise((function(n,r){var A=[t.ISSUE_SERVICE_URL,"containers/",t.options.issueProject,t.issueType.endpoint,"/",e].join(""),i=t.getAjaxCallback(n,r),o=t.createRequest("PATCH",A,"application/vnd.api+json",i,!1,!1),a={data:{type:t.issueType.value,id:e,attributes:{status:P}}};o.send(JSON.stringify(a))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"publishLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._publishLayer,t)}},{key:"_archiveLayer",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,A){var i=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.issueType.endpoint,"/",e].join(""),o=n.getAjaxCallback(r,A),a=n.createRequest("PATCH",i,"application/vnd.api+json",o,!1,!1),s={data:{type:n.issueType.value,id:e,attributes:{close_version:t,status:V}}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"archiveLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._archiveLayer,t)}},{key:"fetchLocationForNewOssAttachment",value:function(e,t){if(!this.checkValidation())return Promise.reject("Service is unavailable.");var n=[this.ISSUE_SERVICE_URL,"containers/",this.options.issueProject,"/oss_objects"].join(""),r=this.createRequest("POST",n,"application/vnd.api+json",t,!1,!1);return this.injectHeaders(r,e),r.send(JSON.stringify({data:{type:"oss_objects"}})),null}},{key:"_getAttachment",value:(A=tc(regeneratorRuntime.mark((function e(t,n){var r,A,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkValidation()){e.next=2;break}return e.abrupt("return",Promise.reject("Service is unavailable."));case 2:return r=this.extractOssBucketAndId(t),i=!1,e.prev=4,e.next=7,this.getSignedS3DownloadUrl(r[0],r[1]);case 7:A=e.sent,i=!0,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn("Fallback to direct OSS download.",e.t0),A=[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",r[0],"/objects/",r[1]].join("");case 15:return e.abrupt("return",new Promise((function(e,t){var r=o.getAjaxCallback(e,t,n),a=o.createRequest("GET",A,null,r,i,!0);n&&(a.responseType="arraybuffer"),o.injectHeaders(a,o.headers),a.send()})));case 16:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e,t){return A.apply(this,arguments)})},{key:"getAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._getAttachment,t)}},{key:"postAttachment",value:(r=tc(regeneratorRuntime.mark((function e(t,n,r){var A,i,o,a,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkValidation()){e.next=2;break}return e.abrupt("return",Promise.reject("Service is unavailable."));case 2:return A=[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",r,"/objects/",t].join(""),i=A,a=!1,e.prev=5,e.next=8,this.getSignedS3UploadUrl(i);case 8:s=e.sent,i=s.urls[0],o=s.uploadKey,a=!0,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),console.warn("Fallback to direct OSS upload.",e.t0);case 17:return e.abrupt("return",new Promise((function(e,t){var r={onLoad:function(n){var r=n.currentTarget;200===r.status||201===r.status?a?u.completeUpload(A,o,e,t):e():t("Failed uploading attachment")},onError:t,onTimeout:t},s=u.createRequest("PUT",i,"text/plain",r,a,!1);u.injectHeaders(s,u.headers),s.send(n)})));case 18:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"updateLayer",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.checkValidation()?new Promise((function(A,i){var o=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.issueType.endpoint,"/",e].join(""),a=n.getAjaxCallback(A,i),s=n.createRequest("PATCH",o,"application/vnd.api+json",a,!1,!1);n.injectHeaders(s,r);var u={data:{type:n.issueType.value,id:e,attributes:t||{}}};s.send(JSON.stringify(u))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"_deleteLayer",value:function(e){var t=this;return this.checkValidation()?new Promise((function(n,r){var A=[t.ISSUE_SERVICE_URL,"containers/",t.options.issueProject,t.ISSUES_TYPE.markup.endpoint+"/",e].join(""),i=t.getAjaxCallback(n,r);t.createRequest("DELETE",A,"application/vnd.api+json",i,!1,!1).send()})):Promise.reject("Service is unavailable")}},{key:"deleteLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._deleteLayer,t)}},{key:"_postDocumentAttachment",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,A){var i=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.ATTACHMENT.endpoint].join(""),o=n.getAjaxCallback(r,A),a=n.createRequest("POST",i,"application/vnd.api+json",o,!1,!1);n.injectHeaders(a,t);var s={data:{type:n.ATTACHMENT.value,attributes:e.attributes}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"postDocumentAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._postDocumentAttachment,t)}},{key:"_deleteDocumentAttachment",value:function(e){var t=this;return this.checkValidation()?new Promise((function(n,r){var A=[t.ISSUE_SERVICE_URL,"containers/",t.options.issueProject,t.ATTACHMENT.endpoint+"/",e].join(""),i=t.getAjaxCallback(n,r);t.createRequest("DELETE",A,"application/vnd.api+json",i,!1,!1).send()})):Promise.reject("Service is unavailable")}},{key:"deleteDocumentAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._deleteDocumentAttachment,t)}},{key:"_renameDocumentAttachment",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,A){var i=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.ATTACHMENT.endpoint+"/",e].join(""),o=n.getAjaxCallback(r,A),a=n.createRequest("PATCH",i,"application/vnd.api+json",o,!1,!1),s={data:{type:n.ATTACHMENT.value,id:e,attributes:{name:t}}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable")}},{key:"renameDocumentAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._renameDocumentAttachment,t)}},{key:"extractOssBucketAndId",value:function(e){var t=e.split("/"),n=t[0].split(":");return t[0]=n[n.length-1],t}},{key:"cancelRequests",value:function(){for(var e=this.xhrReq.length-1;e>=0;e--)this.xhrReq[e]&&this.xhrReq[e].abort();this.xhrReq=[]}},{key:"removeXhr",value:function(e){var t=this.xhrReq.indexOf(e);t>-1&&this.xhrReq.splice(t,1)}},{key:"addXhr",value:function(e){this.xhrReq.push(e)}},{key:"getAccessToken",value:function(){var e;if(this.markupsExtension.options.getAccessToken)return this.markupsExtension.options.getAccessToken((function(t,n){e=t})),e}},{key:"getAjaxCallback",value:function(e,t,n){return{onLoad:function(r){201===r.currentTarget.status||200===r.currentTarget.status||204===r.currentTarget.status?e(n?r.currentTarget.response:r.currentTarget.responseText):t(r)},onError:t,onTimeout:t}}},{key:"createRequest",value:function(e,t,n,r,A,i){var o=this,a=new XMLHttpRequest;if(a.open(e,t,!0),n&&a.setRequestHeader("Content-Type",n),!A){var s=this.getAccessToken();a.setRequestHeader("Authorization","Bearer "+s)}return a.setRequestHeader("Access-Control-Allow-Origin","*"),a.onload=function(){o.removeXhr(a),r.onLoad.apply(r,arguments)},a.onerror=function(){o.removeXhr(a),r.onError.apply(r,arguments)},a.ontimeout=function(){o.removeXhr(a),r.onTimeout.apply(r,arguments)},a.onabort=function(){o.removeXhr(a)},i&&this.addXhr(a),a}},{key:"injectHeaders",value:function(e,t){t&&t.forEach((function(t){e.setRequestHeader(t.name,t.value)}))}},{key:"ENV_TABLE",get:function(){return{Local:{ISSUE_SERVICE:"https://developer-dev.api.autodesk.com/issues-dev/v1/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v2/"},Development:{ISSUE_SERVICE:"https://developer-stg.api.autodesk.com/issues-dev/v1/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v2/"},Qa:{ISSUE_SERVICE:"https://developer-stg.api.autodesk.com/issues-qa/v1/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v2/"},Staging:{ISSUE_SERVICE:"https://developer-stg.api.autodesk.com/issues-stg/v1/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v2/"},Production:{ISSUE_SERVICE:"https://developer.api.autodesk.com/issues/v1/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v2/"}}}},{key:"ISSUES_TYPE",get:function(){return{issue:{value:"issues",endpoint:"/issues"},markup:{value:"markups",endpoint:"/markups"},area_markup:{value:"areas",endpoint:"/areas"},area_status:{value:"area_statuses",endpoint:"/area-statuses"}}}},{key:"ATTACHMENT",get:function(){return{value:"attachments",endpoint:"/attachments"}}}],n&&nc(t.prototype,n),c}(qu),sc=n(55877);function uc(e){return uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uc(e)}function cc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lc(e,t){return lc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},lc(e,t)}function hc(e,t){return!t||"object"!==uc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pc(e){return pc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},pc(e)}var dc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lc(e,t)}(o,e);var t,n,r,A,i=(r=o,A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=pc(r);if(A){var n=pc(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return hc(this,e)});function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e,t)).pendingRequests={},n}return t=o,(n=[{key:"requestMarkups",value:function(){return this.markupsExtension.mobileCallbacks.markupToolLoaded(),new Promise((function(e,t){}))}},{key:"postLayer",value:function(e,t,n){var r=(0,sc.v4)();return n?this.markupsExtension.mobileCallbacks.updateLayer(n,e,t,r):this.markupsExtension.mobileCallbacks.postLayer(e,t,r),this.returnDelayedPromise(r)}},{key:"updateLayer",value:function(e,t){var n=(0,sc.v4)();return this.markupsExtension.mobileCallbacks.updateLayer(e,t),this.returnDelayedPromise(n)}},{key:"deleteLayer",value:function(e){var t=(0,sc.v4)();return this.markupsExtension.mobileCallbacks.deleteLayer(e,t),this.returnDelayedPromise(t)}},{key:"publishLayer",value:function(e){var t=(0,sc.v4)();return this.markupsExtension.mobileCallbacks.publishLayer(e,t),this.returnDelayedPromise(t)}},{key:"archiveLayer",value:function(e,t){var n=(0,sc.v4)();return this.markupsExtension.mobileCallbacks.archiveLayer(e,t,n),this.returnDelayedPromise(n)}},{key:"postDocumentAttachment",value:function(e,t){var n=(0,sc.v4)();return this.returnDelayedPromise(n)}},{key:"deleteDocumentAttachment",value:function(e){var t=(0,sc.v4)();return this.returnDelayedPromise(t)}},{key:"renameDocumentAttachment",value:function(e,t){var n=(0,sc.v4)();return this.returnDelayedPromise(n)}},{key:"cancelRequests",value:function(){var e=this;Object.keys(this.pendingRequests).forEach((function(t){e.pendingRequests[t].reject(),delete e.pendingRequests[t]}))}},{key:"returnDelayedPromise",value:function(e){var t={},n=new Promise((function(e,n){t.resolve=e,t.reject=n}));return this.pendingRequests[e]=t,n}},{key:"onRequestCompleted",value:function(e,t,n){this.pendingRequests[n]&&(t?this.pendingRequests[n].resolve(e):this.pendingRequests[n].reject(),delete this.pendingRequests[n])}}])&&cc(t.prototype,n),o}(qu);function fc(e){return fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fc(e)}var yc=function(e,t){var n,r;if(t.model.isPdf(!0))Autodesk.Viewing.PDFUtils.pdfToLeafletWorld(t,e),n=Autodesk.Viewing.PDFUtils.getLeafletLoadOptions(t),r=Autodesk.Viewing.PDFUtils.getLeafletBoundingBox(t);else{var A=t.model.getData();n=A.loadOptions.loadOptions,r=A.bbox}var i=n,o=i.texWidth,a=i.texHeight,s=e,u=new THREE.Vector3(r.min.x,r.max.y,0);return s.sub(u),e.x=s.x*o/r.size().x,e.y=s.y*a/r.size().y,e},gc=function(e,t){var n=yc(new THREE.Vector3,t),r=yc(new THREE.Vector3(e,0,0),t);return n.distanceTo(r)},Ec=function(e,t){return t.createElementNS("http://www.w3.org/2000/svg",e)},Bc=function(e,t,n){var r=t.getDocument(),A=Ec("svg",r);!function(e,t,n){var r=n.createElementNS("http://www.w3.org/2000/svg","metadata"),A=n.createElement("markup_document");r.appendChild(A),A.setAttribute("data-model-version","5"),e.insertBefore(r,e.firstChild)}(A,0,r);var i=Ht(e.markups),a=t.impl.is2d?null:t.getState(),s=t.model.isLeaflet(),c=t.model.isPdf(!0),l=new THREE.Vector3;return i.forEach((function(i){var a=lt.cloneDeep(i.getState());if(t.impl.is2d||ks(t,e.layerData,!0),a.anchors.forEach((function(e){i.applyScaleAndTranslation(e),(s||c)&&e.copy(yc(e,t))})),i.type!==y&&i.type!==x&&!i.isGroupMarkup()){var h;i.type===b?(a.isFrameUsed=a.isFrameUsed?1:0,h=i.getWorldBoundingBoxTextOnly()):h=i.getWorldBoundingBox();var p=h.size(),d=h.getCenter(l);(s||c)&&(d.copy(yc(d,t)),p.x=gc(p.x,t),p.y=gc(p.y,t)),a.size="".concat(p.x," ").concat(p.y),a.position="".concat(d.x," ").concat(d.y),Dt(a.anchors,d.clone().negate())}i.type===x&&((s||c)&&a.translation.copy(yc(a.translation,t).sub(yc(new THREE.Vector3,t))),a.offset="".concat(a.translation.x," ").concat(a.translation.y," ").concat(a.translation.z),a.style[u.FONT_SIZE]*=Ge,a.style[u.THICKNESS]*=Ve),(s||c)&&(a.style[u.THICKNESS]=gc(a.style[u.THICKNESS],t),a.style[u.FONT_SIZE]=gc(a.style[u.FONT_SIZE],t),a.style[u.FONT_SIZE]*=n.getFontToWorldScale()),a.type=i.type,(a.style[u.FILL_COLOR]===o.NO_COLOR||i.options.fillNotAllowed)&&(a.style[u.FILL_OPACITY]=0,a.style[u.FILL_COLOR]=o.NO_COLOR),function(e,t){delete e.scale,delete e.translation,t&&(delete e.style,delete e.position,delete e.size,delete e.rotation)}(a,i.isGroupMarkup()),function(e){var t={};switch(e.type){case g:case B:case E:break;case y:case M:t.tail=e.anchors[0],t.head=e.anchors[1];break;case x:t.firstAnchor=e.anchors[0],t.secondAnchor=e.anchors[1];break;case v:case m:case k:case w:t.locations=e.anchors}e.anchors=t}(a);var f=function(e){var t={};return Object.keys(e).forEach((function(n){"object"!==fc(e[n])||Array.isArray(e[n])?t[n]=e[n]:Object.keys(e[n]).forEach((function(r){t[r]=e[n][r]}))})),t}(a);!function(e){Object.keys(e).forEach((function(t){if(Array.isArray(e[t])){var n=e[t],r=[];n.forEach((function(e){r.push(e.x),r.push(e.y)})),e[t]=r.join(" ")}else if("object"===fc(e[t])){var A=e[t],i=[];i.push(A.x),i.push(A.y),e[t]=i.join(" ")}}))}(f);var C=function(e,t){var n=Ec("g",t);n.setAttribute("cursor","inherit"),n.setAttribute("pointer-events","none");var r=Ec("path",t);return r.setAttribute("id","markup"),e?r.setAttribute("d","M 0 0 z"):r.setAttribute("d","M 0 0"),n.appendChild(r),n}(f.closed,r);!function(e,t,n){var r=n.createElementNS("http://www.w3.org/2000/svg","metadata"),A=n.createElement("markup_element");r.appendChild(A),Object.keys(t).forEach((function(e){A.setAttribute(e,t[e])})),e.insertBefore(r,e.firstChild)}(C,f,r),A.appendChild(C)})),a&&t.restoreState(a,null,!0),function(e){var t="";try{t=(new XMLSerializer).serializeToString(e)}catch(e){console.error("svgNodeToString failed to generate string representation of domNode.")}return t}(A)};function mc(e){return function(e){if(Array.isArray(e))return vc(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return vc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vc(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var kc=At,Cc=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"reset",value:function(e){this.markupsExtension=e,this.markupsManager=e.markupsManager,this.markupsCache=e.markupsCache,this.viewer=e.viewer,this.options=this.markupsExtension.options,this.savingCounter=0;var t=e.options.isMobileApp,n=this.options.serviceClass||ac;this.service=t?new dc(this.markupsExtension,this.options):new n(this.markupsExtension,this.options),this.errorHandler=this.options.errorHandler||function(){},this.onSessionEndedBinded=this.onSessionEnded.bind(this),this.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.onSessionEndedBinded),this.onLayerDeletedBinded=this.onLayerDeleted.bind(this),this.markupsManager.addEventListener(A.LAYER_DELETE,this.onLayerDeletedBinded),this.onDocumentAttachmentCreationStartBinded=this.onDocumentAttachmentCreationStart.bind(this),this.markupsManager.addEventListener(A.DOCUMENT_ATTACHMENT_CREATION_START,this.onDocumentAttachmentCreationStartBinded),this.renameDocumentAttachmentBinded=this.renameDocumentAttachment.bind(this),this.markupsManager.addEventListener(A.DOCUMENT_ATTACHMENT_RENAME,this.renameDocumentAttachmentBinded),this.deleteDocumentAttachmentBinded=this.deleteDocumentAttachment.bind(this),this.markupsManager.addEventListener(A.DOCUMENT_ATTACHMENT_DELETE,this.deleteDocumentAttachmentBinded),this.onPublishLayerBinded=this.onPublishLayer.bind(this),this.markupsManager.addEventListener(A.LAYER_PUBLISH,this.onPublishLayerBinded),this.onArchiveLayerBinded=this.onArchiveLayer.bind(this),this.markupsManager.addEventListener(A.LAYER_ARCHIVE,this.onArchiveLayerBinded)}},{key:"onSessionEnded",value:function(e){var t=e.layer;e.save&&!t.isEmpty()&&this.saveLayer(t)}},{key:"onLayerDeleted",value:function(e){var t=e.layerData;t&&this.deleteLayer(t)}},{key:"onPublishLayer",value:function(e){var t=e.layerData;t&&this.publishLayer(t)}},{key:"onArchiveLayer",value:function(e){var t=e.layerData;t&&this.archiveLayer(t)}},{key:"fetchMarkups",value:function(){var e=this,t=this.options.documentUrn;this.numOfMarkupsLoaded=0;var n=this.getMaxPageLimit(),r=0,A={layersData:[],relatedResources:[]},i=te;(function t(){return e.requestMarkups(A,n,r,i).then((function(e){if(e&&e.nextReq)return r+=n,t()})).catch((function(e){console.warn("requestMarkups failed or canceled.")}))})().then((function(){return e.getMetadata(A,t)})).catch((function(e){return e}))}},{key:"requestMarkups",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:te;return this.service.requestMarkups(t,n,null,r).then((function(t){try{var n,r=JSON.parse(t);(n=e.layersData).push.apply(n,mc(r.data));var A,i=r.included;return i&&Array.isArray(i)&&(A=e.relatedResources).push.apply(A,mc(i)),Promise.resolve({nextReq:r.links.next})}catch(e){return Promise.reject(e)}}),(function(){return Promise.reject()}))}},{key:"getMetadata",value:function(e,t){var n=this,r=e.relatedResources,i=e.layersData;return(i=lt.remove(i,(function(e){return Wt(e.attributes.markup_metadata.sheetName,n.options.sheetName)})).concat(i)).forEach((function(e){var r=e.attributes;if(r.markup_metadata){var i=r.starting_version;if(!(n.options.documentVersion<i)){r.tags=r.tags||{};var o=function(e){return"true"===e||!0===e||1===e}(r.tags.resourceEmbed),a=n.markupsCache.get(e.id),s=a||new Ga;if(!a){s.guid=e.id,s.status=I,s.metadata=r,r.close_version>0&&(s.status=K);var u=r.resource_urns;if(u){var c=n.createEmptyResourceObject($,o,u);c&&s.resources.push(c);var l=n.createEmptyResourceObject(ee,o,u);l&&s.resources.push(l)}n.markupsCache.add(s.guid,s,t)}n.notify({type:A.LAYER_FETCHED,layerData:s}),n.getAttachment(s)}}})),this.fetchedAllMarkups||this.numOfMarkupsLoaded!==this.markupsCache.length()||(this.fetchedAllMarkups=!0,this.notify({type:A.ALL_MARKUPS_LOADED,amount:this.numOfMarkupsLoaded})),this.getUserProfiles(),this.getProjectUsers(),this.getRevisions(),this.getAttachedDocumentData(r),this.notify({type:A.LAYER_METADATA_FETCHED}),Promise.resolve()}},{key:"notify",value:function(e){if(this.markupsManager)try{this.markupsManager.dispatchEvent(e)}catch(e){console.warn(e)}}},{key:"getAttachment",value:function(e){var t=this,n=e.resources.map((function(n){var r=null;if(n.data)return r={layerData:e,resourceType:n.type},t.onGetAttachment(r),Promise.resolve(r);var A=q===Z;return t.service.getAttachment(n.ossPath,A).then((function(A){return A?(n.data=A,r={layerData:e,resourceType:n.type},t.onGetAttachment(r),Promise.resolve(r)):Promise.resolve(null)})).catch((function(e){}))}));return Promise.all(n)}},{key:"onGetAttachment",value:function(e){var t=e.layerData,n=e.resourceType;n===$&&(this.numOfMarkupsLoaded+=1,this.notify({type:A.LAYER_RESOURCE_FETCHED,layerData:t}),this.fetchedAllMarkups||this.numOfMarkupsLoaded!==this.markupsCache.length()||(this.fetchedAllMarkups=!0,this.notify({type:A.ALL_MARKUPS_LOADED,amount:this.numOfMarkupsLoaded}))),n===ee&&this.notify({type:A.LAYER_THUMBNAIL_FETCHED,layerData:t})}},{key:"createEmptyResourceObject",value:function(e,t,n){if(n[e]){var r={type:e,data:null,id:null,ossPath:null};return t?r.data=n[e]:r.ossPath=n[e],r}return null}},{key:"getAttachedDocumentData",value:function(e){var t=this;if(e&&Array.isArray(e)&&0!==e.length&&this.options.getAttachedDocumentCallback){var n=this.markupsCache.getAsList(),r=e.filter((function(e){return n.some((function(t){return e.attributes&&e.type===ne&&t.guid===e.attributes.issue_id}))}));r.length>0&&this.options.getAttachedDocumentCallback(r,(function(e){n.forEach((function(n){var r;e&&((r=n.attachments).push.apply(r,mc(e.filter((function(e){return e.attributes.issue_id===n.guid&&-1===n.attachments.findIndex((function(t){return t.id===e.id}))})))),n.attachments.forEach((function(e){t.notify({type:A.LINK_SYNCED,layerData:n,documentAttachment:e})})))}))}))}}},{key:"getUserProfiles",value:function(){var e=this;this.options.getUserProfileCallback&&Ft(this.markupsCache.getCache(),(function(t){var n=t.metadata.created_by;n&&!t.userName&&e.options.getUserProfileCallback(n,(function(n){n&&n.name&&(t.userName=n.name,e.notify({type:A.LAYER_METADATA_FETCHED}))}))}))}},{key:"getProjectUsers",value:function(){var e=this;this.options.getProjectUsersCallback&&(0,this.options.getProjectUsersCallback)((function(t){e.notify({type:A.PROJECT_USERS_FETCHED,users:t})}))}},{key:"getRevisions",value:function(){var e=this;this.options.getRevisionCallback&&this.options.getRevisionCallback(this.options.documentUrn,(function(t){Ft(e.markupsCache.getCache(),(function(e){if(e&&e.metadata){var n=e.metadata.starting_version;e.metadata.tags.starting_revision=t[n]}})),e.notify({type:A.LAYER_METADATA_FETCHED})}))}},{key:"generateMarkupDescription",value:function(e){var t=[];return e.getAllMarkups().forEach((function(e){e.type!==C&&e.type!==b||t.push(e.state.text)})),t.join(".\n")}},{key:"generateMetadata",value:function(e,t){var n=this,r={};r.target_urn=this.options.documentUrn,r.starting_version=this.options.documentVersion,r.resource_urns={};var A=this.viewer.getState(),i=this.viewer.model?this.viewer.model.getData().globalOffset:null;if(r.markup_metadata=function(e,t,n){var r=JSON.parse(JSON.stringify(e));return t&&vs(r.viewport,t),r.sheetGUID=n.sheetGUID,r.sheetName=n.sheetName,r}(A,i,this.options),r.markup_metadata.links=Ht(t.links).map((function(e){var t=e.state.position&&e.state.position.clone();return t&&n.markupsExtension.viewer.model.isPdf(!0)&&Autodesk.Viewing.PDFUtils.pdfToLeafletWorld(n.markupsExtension.viewer,t),{id:e.guid,type:e.type,position:t}})),r.description=this.generateMarkupDescription(t),r.tags={starting_revision:this.options.documentRevision||this.options.documentVersion},this.options.collectionUrn&&(r.collection_urn=this.options.collectionUrn),this.options.userName&&(r.tags.userName=this.options.userName),r.status=e,this.viewer.model.isLeaflet()){var o=this.viewer.model.getData().loadOptions.loadOptions;r.markup_metadata.originalDocumentResolution=[o.texWidth,o.texHeight]}return r}},{key:"saveLayer",value:function(e){var t,n=this,r=this.options.documentUrn,i=!e.layerData,o="".concat(e.id,"_tmp"),a=i?new Ga:e.layerData,s=this.generateMetadata(i?this.markupsExtension.getCreationStatusType():a.metadata.status,e),u=[{type:$,data:Bc(e,this.markupsExtension.viewer,this.markupsExtension.renderer),id:null,ossPath:null},{type:ee,data:null,id:null,ossPath:null}];a.status=F,a.originalCreationTime=i?(new Date).toISOString():s.created_at,e.layerData=a,i&&((t=lt.cloneDeep(a)).metadata=s,t.resources=u,this.markupsCache.add(o,t,r)),this.notify({type:A.LAYER_SYNCING,layerData:a,layer:e}),this.savingCounter++,this.markupsManager.generateScreenCapture(e).then((function(t){u[1].data=t,i||(a.resources=u),n.notify({type:A.LAYER_SYNCING,layerData:a,layer:e}),n.service.postLayer(s,u,i?void 0:e.getGuid()).then((function(e){var t=e.id;a.guid=t,a.metadata=e.attributes,a.resources=u,a.attachments=a.attachments||[],a.status=L,n.markupsCache.add(t,a,r),a.userName=a.metadata.tags.userName})).catch((function(t){i?e.layerData=null:a.status=Q,n.errorHandler(Autodesk.Viewing.i18n.translate("Failed to save markup"),kc.MARKUP_SAVE_FAILED,t),console.error("Failed to save markup",a,t)})).finally((function(){n.markupsCache.remove(o,r),n.notify({type:A.LAYER_SYNCED,layerData:a,layer:e}),n.savingCounter--}))})).catch((function(){n.savingCounter--}))}},{key:"onDocumentAttachmentCreationStart",value:function(e){var t=this,n=e.documentAttachments,r=e.layerData;if(0!==n.length)if(n.length>1)console.error("Dont save multiple attachments at a time.");else{n.forEach((function(e){e.attributes.issue_id=r.guid,e.attributes.attachment_type=re}));var i=n[0];this.notify({type:A.LINK_SYNCING,documentAttachment:i,layerData:r}),this.service.postDocumentAttachment(i).then((function(e){e&&e.attributes&&e.attributes.issue_id&&(i.attributes=e.attributes,i.id=e.id,r.attachments.splice(0,0,i),t.markupsManager.createLinkMetadata(r)),t.notify({type:A.LINK_SYNCED,documentAttachment:i,layerData:r})})).catch((function(e){t.notify({type:A.LINK_SYNCED,documentAttachment:i,layerData:r}),t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to create markup attachment"),kc.MARKUP_ATTACHMENT_CREATE_FAILED,e),console.error("Failed to create markup attachment",e)}))}}},{key:"deleteDocumentAttachment",value:function(e){var t=this,n=e.documentAttachment,r=e.layerData;n.status=z,this.notify({type:A.LINK_SYNCING,documentAttachment:n,layerData:r}),this.service.deleteDocumentAttachment(n.id).then((function(){var e=r.attachments,i=e.indexOf(n);i>-1&&e.splice(i,1),t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:r})})).catch((function(e){t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to delete markup attachment"),kc.MARKUP_ATTACHMENT_DELETE_FAILED,e),t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:r})}))}},{key:"renameDocumentAttachment",value:function(e){var t=this,n=e.documentAttachment,r=e.newName,i=e.layerData;n.status=J,n.tmpName=r,this.notify({type:A.LINK_SYNCING,documentAttachment:n,layerData:i}),this.service.renameDocumentAttachment(n.id,r).then((function(e){n.attributes=e.attributes,n.status=void 0,n.tmpName=void 0,t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:i})})).catch((function(e){n.status=void 0,n.tmpName=void 0,t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to rename markup attachment"),kc.MARKUP_ATTACHMENT_RENAME_FAILED,e),t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:i})}))}},{key:"updateLinkPosition",value:function(e,t,n){var r=this,A=n.clone();this.markupsExtension.viewer.model.isPdf(!0)&&Autodesk.Viewing.PDFUtils.pdfToLeafletWorld(this.markupsExtension.viewer,A);var i={markup_metadata:{links:[{id:t,position:A}]}};return this.service.updateLayer(e,i).then((function(e){return Promise.resolve(e)}),(function(e){return r.errorHandler(Autodesk.Viewing.i18n.translate("Failed to update markup attachment"),kc.MARKUP_ATTACHMENT_UPDATE_FAILED,e),Promise.reject("Failed to change the link position: "+t)}))}},{key:"deleteLayer",value:function(e){var t=this;e.guid||(e=this.markupsCache.get(e)),e.status=R,this.notify({type:A.LAYER_SYNCING,layerData:e});var n=this.options.documentUrn;return this.service.deleteLayer(e.guid).then((function(r){return t.markupsCache.remove(e.guid,n),e.status=H,t.notify({type:A.LAYER_SYNCED,layerData:e}),Promise.resolve(!0)}),(function(n){return e.status=_,t.notify({type:A.LAYER_SYNCED,layerData:e}),t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to delete markup"),kc.MARKUP_DELETE_FAILED,n),Promise.reject("Failed to delete markup: "+e.guid)}))}},{key:"deleteAllLayers",value:function(){var e=this;this.markupsCache.getAsList().forEach((function(t){e.deleteLayer(t)}))}},{key:"publishLayer",value:function(e){var t=this;e.guid||(e=this.markupsCache.get(e));var n=e.status;e.status=N,this.notify({type:A.LAYER_SYNCING,layerData:e}),this.service.publishLayer(e.guid).then((function(r){return e.status=n,e.metadata=r.attributes,t.notify({type:A.LAYER_SYNCED,layerData:e}),Promise.resolve()})).catch((function(r){e.status=n,t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to publish markup"),kc.MARKUP_PUBLISH_FAILED,r),t.notify({type:A.LAYER_SYNCED,layerData:e})}))}},{key:"archiveLayer",value:function(e){var t=this;e.guid||(e=this.markupsCache.get(e));var n=e.status;e.status=G,this.notify({type:A.LAYER_SYNCING,layerData:e}),this.service.archiveLayer(e.guid,this.options.currentRawDocumentVersion).then((function(r){return e.status=n,e.metadata=r.attributes,t.notify({type:A.LAYER_SYNCED,layerData:e}),Promise.resolve()})).catch((function(r){e.status=n,t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to archive markup"),kc.MARKUP_ARCHIVE_FAILED,r),t.notify({type:A.LAYER_SYNCED,layerData:e})}))}},{key:"cancelRequests",value:function(){this.service.cancelRequests()}},{key:"terminate",value:function(){this.cancelRequests(),this.markupsExtension=null,this.markupsManager=null,this.service=null}},{key:"getMaxPageLimit",value:function(){return this.service.maxPageLimit}}],n&&wc(t.prototype,n),e}();function bc(e){return bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bc(e)}function Sc(e,t,n,r,A,i,o){try{var a=e[i](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,A)}function Tc(e){return function(){var t=this,n=arguments;return new Promise((function(r,A){var i=e.apply(t,n);function o(e){Sc(i,r,A,o,a,"next",e)}function a(e){Sc(i,r,A,o,a,"throw",e)}o(void 0)}))}}function xc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Uc(e,t){return Uc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Uc(e,t)}function Qc(e,t){return!t||"object"!==bc(t)&&"function"!=typeof t?Lc(e):t}function Lc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fc(e){return Fc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Fc(e)}var Rc=AutodeskNamespace("Autodesk.BIM360.Markups"),Hc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Uc(e,t)}(a,Autodesk.Viewing.Extension);var t,n,r,A,i,o=(A=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Fc(A);if(i){var n=Fc(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Qc(this,e)});function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xc(this,a),(t=o.call(this,e,n)).viewer=e,t.options=n,t.onModelLoadedBinded=t.onModelLoaded.bind(Lc(t)),t}return t=a,n=[{key:"onModelLoaded",value:function(e){if(this.viewer.model&&!this.initialized){this.initCache();var t=e.model.getDocumentNode();t?(this.sheetList=t.getRootNode().search({type:"geometry"}),this.options.sheetGUID=t.guid(),this.options.sheetName=t.name(),this.options.fileName=t.findViewableParent().name()):this.sheetList=[],this.markupsManager=new Rs(this),this.filterManager=new Ou(this,this.options),this.permissionManager=new Ku(this.options),this.markupsTool=new Oa(this),this.viewer.toolController.registerTool(this.markupsTool);var n=this.viewer.toolController.setIsLocked(!1);this.viewer.toolController.activateTool(this.markupsTool.getName()),this.viewer.toolController.setIsLocked(n),this.renderer=new Eu(this),this.markupsManager.setDefaultCreationStyleProperties(),this.options.isMobileApp?this.mobileCallbacks=new Wu(this):(this.markupsUI=new Ka(this),this.initMarkupsPanel()),this.initServiceOperator(),this.selectInitialLayer(),this.initialized=!0}}},{key:"initCache",value:function(){Object.prototype.hasOwnProperty.call(this.cache,"markupsCache")||(this.cache.markupsCache=new Ju),this.markupsCache=this.cache.markupsCache,this.markupsCache.currentUrn!==this.options.documentUrn&&(this.cache.layerToSelect=null,this.cache.layerToEdit=null,this.cache.filters=null),this.cache.markupsCache.setCurrentUrn(this.options.documentUrn)}},{key:"initServiceOperator",value:function(){this.serviceOperator||(this.serviceOperator=new Cc),this.serviceOperator.reset(this),this.serviceOperator.fetchMarkups()}},{key:"initMarkupsPanel",value:function(){this.options.panelContainer&&this.options.uiClasses&&this.options.uiClasses.MarkupPanelClass&&(this.cache.markupsPanel||(this.cache.markupsPanel=new this.options.uiClasses.MarkupPanelClass),this.cache.markupsPanel.reset(this))}},{key:"selectInitialLayer",value:function(){var e=this;setTimeout(Tc(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Autodesk.Viewing.EventUtils.waitUntilTransitionEnded(e.viewer);case 2:e.cache.layerToSelect&&(e.selectLayer(e.cache.layerToSelect,!0,!0),e.cache.layerToSelect=null),e.cache.layerToEdit&&(e.editLayer(e.cache.layerToEdit,!0,!0,!0),e.cache.layerToEdit=null);case 4:case"end":return t.stop()}}),t)}))))}},{key:"load",value:(r=Tc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cache=this.getCache(),e.next=3,this.viewer.loadExtension("Autodesk.Snapping");case 3:return this.viewer.model?this.onModelLoaded({model:this.viewer.model}):this.viewer.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelLoadedBinded),e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"unload",value:function(){return this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelLoadedBinded),this.mobileCallbacks&&(this.mobileCallbacks.destroy(),this.mobileCallbacks=null),this.markupsUI&&(this.markupsUI.destroy(),this.markupsUI=null),this.renderer&&(this.renderer.destroy(),this.renderer=null),this.markupsTool&&(this.viewer.toolController.deregisterTool(this.markupsTool),this.markupsTool=null),this.markupsManager&&(this.markupsManager.destroy(),this.markupsManager=null),this.filterManager&&(this.filterManager.destroy(),this.filterManager=null),this.permissionManager&&(this.permissionManager.destroy(),this.permissionManager=null),this.serviceOperator&&(this.serviceOperator.terminate(),this.serviceOperator=null),this.markupsCache=null,this.initialized=!1,!0}},{key:"startMarkupSession",value:function(e,t){this.markupsManager.startMarkupSession(e,t)}},{key:"endMarkupSession",value:function(e){this.markupsManager.endMarkupSession(e)}},{key:"setToolEnabled",value:function(e){this.markupsManager.setToolEnabled(e)}},{key:"isToolEnabled",value:function(){return this.markupsManager.isToolEnabled()}},{key:"editLayer",value:function(e,t,n,r){this.markupsManager.editLayer(e,t,n,r)}},{key:"changeMarkupCreationType",value:function(e,t){(this.markupsManager.isMarkupSessionOpen()||t)&&this.markupsManager.changeMarkupCreationType(e)}},{key:"deleteMarkup",value:function(e){this.markupsManager.deleteMarkup(e)}},{key:"deleteInEditMarkups",value:function(){this.markupsManager.deleteInEditMarkups()}},{key:"undo",value:function(){this.markupsManager.undo()}},{key:"redo",value:function(){this.markupsManager.redo()}},{key:"copy",value:function(){this.markupsManager.copy()}},{key:"paste",value:function(){this.markupsManager.paste()}},{key:"cut",value:function(){this.markupsManager.cut()}},{key:"selectMarkup",value:function(e){this.markupsManager.selectMarkup(e)}},{key:"deselectMarkup",value:function(e){this.markupsManager.deselectMarkup(e)}},{key:"deselectAllMarkups",value:function(e){this.markupsManager.deselectAllMarkups(e)}},{key:"deselectAllLayers",value:function(e){this.markupsManager.deselectAllLayers(e)}},{key:"exitMarkupView",value:function(){this.markupsManager.exitMarkupView()}},{key:"getSelectedMarkups",value:function(){return this.markupsManager.getSelectedMarkups()}},{key:"getSelectedLayer",value:function(){return this.markupsManager.getSelectedLayer()}},{key:"getVisibleMarkups",value:function(){return this.markupsManager.getVisibleMarkups()}},{key:"selectLayer",value:function(e,t,n){this.markupsManager.selectLayer(e,t,n)}},{key:"deselectLayer",value:function(e){this.markupsManager.deselectLayer(e)}},{key:"getStyleProperty",value:function(e){return this.markupsManager.getStyleProperty(e)}},{key:"changeStyleProperty",value:function(e,t,n){this.markupsManager.changeStyleProperty(e,t,n)}},{key:"loadLayers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.markupsCache&&this.markupsCache.getAsList(),t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.markupsManager.loadLayers(e,t,n)}},{key:"removeLayer",value:function(e){this.markupsManager.removeLayer(e)}},{key:"changeCreationStatusType",value:function(e){this.markupsManager.changeCreationStatusType(e)}},{key:"getCreationStatusType",value:function(){return this.markupsManager.getCreationStatusType()}},{key:"updateFilters",value:function(e){this.filterManager.updateFilters(e)}}],n&&Mc(t.prototype,n),a}();Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.BIM360.Markups",Hc),Rc.Constants=Object.assign({},e),Rc.Events=Object.assign({},A),Rc.markupsOverlayRenderer=Vt})(),Autodesk.Extensions.BimMarkups=r})();
//# sourceMappingURL=BimMarkups.min.js.map