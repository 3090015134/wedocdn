/*! For license information please see Section.min.js.LICENSE.txt */
(()=>{var t={32159:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var i=n(87537),o=n.n(i),a=n(23645),r=n.n(a)()(o());r.push([t.id,".sectionPanel{line-height:14px;text-align:left;z-index:10}.section-horizontal-divider{height:1px;border-top:1px solid rgba(200,200,200,0.8)}.section-submenu-select{display:block;position:relative;width:calc(100% - 40px);padding:10px 20px 0px 20px;opacity:0.3}.section-panel:hover .section-submenu-select{opacity:0.8}.section-submenu-selectlabel{position:relative;display:inline-block;padding-right:20px;padding-bottom:4px}.section-restart{margin:10px 20px 15px 20px;padding:6px 10px 6px 10px;width:calc(100% - 55px);cursor:pointer}.docking-panel:hover .section-restart{background-color:rgba(255,255,255,0.12)}.docking-panel .section-restart:hover{background-color:rgba(166,194,255,0.7);-webkit-transition:all 0.2s ease;-moz-transition:all 0.2s ease;-ms-transition:all 0.2s ease;-o-transition:all 0.2s ease;transition:all 0.2s ease}\n","",{version:3,sources:["webpack://./extensions/Section/Section.css"],names:[],mappings:"AAGA,cACI,gBAAiB,CACjB,eAAgB,CAChB,UAAW,CACd,4BAIG,UAAW,CACX,0CAA2C,CAC9C,wBAIG,aAAc,CACd,iBAAkB,CAClB,uBAAwB,CACxB,0BAA2B,CAC3B,WAAY,CACf,6CAGE,WAAY,CACd,6BAIG,iBAAkB,CAClB,oBAAsB,CACtB,kBAAoB,CACpB,kBAAoB,CACvB,iBAGG,0BAA2B,CAC3B,yBAA0B,CAC1B,uBAAwB,CACxB,cAAe,CAClB,sCAGG,uCAAwC,CAC3C,sCAGG,sCAAwC,CACxC,gCAAiC,CACjC,6BAA8B,CAC9B,4BAA6B,CAC7B,2BAA4B,CAC5B,wBAAyB",sourcesContent:["/**\n * Section CSS\n **/\n.sectionPanel {\n    line-height: 14px;\n    text-align: left;\n    z-index: 10;\n}\n\n.section-horizontal-divider\n{\n    height: 1px;\n    border-top: 1px solid rgba(200,200,200,0.8);\n}\n\n.section-submenu-select\n{\n    display: block;\n    position: relative;\n    width: calc(100% - 40px);\n    padding: 10px 20px 0px 20px;\n    opacity: 0.3;\n}\n\n.section-panel:hover .section-submenu-select {\n   opacity: 0.8;\n}\n\n.section-submenu-selectlabel\n{\n    position: relative;\n    display:  inline-block;\n    padding-right:  20px;\n    padding-bottom:  4px;\n}\n\n.section-restart {\n    margin: 10px 20px 15px 20px;\n    padding: 6px 10px 6px 10px;\n    width: calc(100% - 55px);\n    cursor: pointer;\n}\n\n.docking-panel:hover .section-restart {\n    background-color: rgba(255,255,255, .12);\n}\n\n.docking-panel .section-restart:hover {\n    background-color: rgba(166,194,255, 0.7);\n    -webkit-transition: all 0.2s ease;\n    -moz-transition: all 0.2s ease;\n    -ms-transition: all 0.2s ease;\n    -o-transition: all 0.2s ease;\n    transition: all 0.2s ease;\n}\n\n"],sourceRoot:""}]);const s=r},23645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(r[c]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);i&&r[h[0]]||(void 0!==a&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=a),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),e.push(h))}},e}},87537:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),a="/*# ".concat(o," */"),r=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(r).concat([a]).join("\n")}return[e].join("\n")}},62705:(t,e,n)=>{var i=n(55639).Symbol;t.exports=i},44239:(t,e,n)=>{var i=n(62705),o=n(89607),a=n(2333),r=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":r&&r in Object(t)?o(t):a(t)}},27561:(t,e,n)=>{var i=n(67990),o=/^\s+/;t.exports=function(t){return t?t.slice(0,i(t)+1).replace(o,""):t}},31957:(t,e,n)=>{var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=i},89607:(t,e,n)=>{var i=n(62705),o=Object.prototype,a=o.hasOwnProperty,r=o.toString,s=i?i.toStringTag:void 0;t.exports=function(t){var e=a.call(t,s),n=t[s];try{t[s]=void 0;var i=!0}catch(t){}var o=r.call(t);return i&&(e?t[s]=n:delete t[s]),o}},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},55639:(t,e,n)=>{var i=n(31957),o="object"==typeof self&&self&&self.Object===Object&&self,a=i||o||Function("return this")();t.exports=a},67990:t=>{var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},23279:(t,e,n)=>{var i=n(13218),o=n(7771),a=n(14841),r=Math.max,s=Math.min;t.exports=function(t,e,n){var c,l,h,u,p,E,d=0,m=!1,v=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function T(e){var n=c,i=l;return c=l=void 0,d=e,u=t.apply(i,n)}function y(t){return d=t,p=setTimeout(g,e),m?T(t):u}function w(t){var n=t-E;return void 0===E||n>=e||n<0||v&&t-d>=h}function g(){var t=o();if(w(t))return R(t);p=setTimeout(g,function(t){var n=e-(t-E);return v?s(n,h-(t-d)):n}(t))}function R(t){return p=void 0,f&&c?T(t):(c=l=void 0,u)}function H(){var t=o(),n=w(t);if(c=arguments,l=this,E=t,n){if(void 0===p)return y(E);if(v)return clearTimeout(p),p=setTimeout(g,e),T(E)}return void 0===p&&(p=setTimeout(g,e)),u}return e=a(e)||0,i(n)&&(m=!!n.leading,h=(v="maxWait"in n)?r(a(n.maxWait)||0,e):h,f="trailing"in n?!!n.trailing:f),H.cancel=function(){void 0!==p&&clearTimeout(p),d=0,c=E=l=p=void 0},H.flush=function(){return void 0===p?u:R(o())},H}},13218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},37005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},33448:(t,e,n)=>{var i=n(44239),o=n(37005);t.exports=function(t){return"symbol"==typeof t||o(t)&&"[object Symbol]"==i(t)}},7771:(t,e,n)=>{var i=n(55639);t.exports=function(){return i.Date.now()}},14841:(t,e,n)=>{var i=n(27561),o=n(13218),a=n(33448),r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(a(t))return NaN;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=i(t);var n=s.test(t);return n||c.test(t)?l(t.slice(2),n?2:8):r.test(t)?NaN:+t}},93379:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var a={},r=[],s=0;s<t.length;s++){var c=t[s],l=i.base?c[0]+i.base:c[0],h=a[l]||0,u="".concat(l," ").concat(h);a[l]=h+1;var p=n(u),E={css:c[1],media:c[2],sourceMap:c[3]};-1!==p?(e[p].references++,e[p].updater(E)):e.push({identifier:u,updater:o(E,i),references:1}),r.push(u)}return r}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var a=i(t=t||[],o=o||{});return function(t){t=t||[];for(var r=0;r<a.length;r++){var s=n(a[r]);e[s].references--}for(var c=i(t,o),l=0;l<a.length;l++){var h=n(a[l]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}a=c}}},90569:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e),e}},3565:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i=n.css,o=n.media,a=n.sourceMap;o?t.setAttribute("media",o):t.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(i,t)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},44589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{"use strict";n.r(i),n.d(i,{SectionExtension:()=>H});var t=n(23279),e=null,o=Autodesk.Viewing.Private,a=function(n,i){var a,r,s,c=n.impl,l=["section"],h=!1,u=!1,p=!1,E=!0,d=i.tintColor,m=i.tintIntensity,v=isNaN(i.gizmoOffsetRight)?200:i.gizmoOffsetRight,f=isNaN(i.gizmoOffsetLeft)?80:i.gizmoOffsetLeft,T=isNaN(i.gizmoOffsetTop)?80:i.gizmoOffsetTop,y=isNaN(i.gizmoOffsetBottom)?80:i.gizmoOffsetBottom,w=new THREE.Vector3,g=new THREE.Vector3,R=new THREE.Vector3,H=[],x=[],M=[],b="",P="gizmo",S=null,A=!1,C=!0,V=[[0,1],[1,3],[3,2],[2,0]],z=!0,B=t((function(t,e,n){o.analytics.track("viewer.section",{from:t,type:e,action:n})}),2e3);function k(){c.invalidate(!1,!1,!0)}function G(){I(),a&&a.update(),r&&r.update()}function I(){if(a&&a.object){var t=c.worldToClient(a.position),e=c.getCanvasBoundingClientRect();if(w.copy(t),t.x<f?w.x=f:t.x>e.width-v&&(w.x=e.width-v),t.y<T?w.y=T:t.y>e.height-y&&(w.y=e.height-y),w.x!==t.x||w.y!==t.y){var n=THREE.TransformControls.intersectObjects(w.x,w.y,[a.object],c.camera,!1);if(n){var i=H[0].position;g.copy(a.object.position).add(i),R.copy(n.point).sub(g),a.setGizmoOffset(R)}}}}function O(){h&&1===x.length&&(_(!0),G(),X((new THREE.Plane).setComponents(x[0].x,x[0].y,x[0].z,x[0].w)))}(function(){var t=function(t){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var e=function(t){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(t,e,n,i){THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},n=n||1,i=i||0;for(var o=this,a=0,r=t.length;a<r;a+=3)w(new THREE.Vector3(t[a],t[a+1],t[a+2]));var s=this.vertices,c=[],l=(a=0,0);for(r=e.length;a<r;a+=3,l++){var h=s[e[a]],u=s[e[a+1]],p=s[e[a+2]];c[l]=new THREE.Face3(h.index,u.index,p.index,[h.clone(),u.clone(),p.clone()])}var E=new THREE.Vector3;for(a=0,r=c.length;a<r;a++)R(c[a],i);for(a=0,r=this.faceVertexUvs[0].length;a<r;a++){var d=this.faceVertexUvs[0][a],m=d[0].x,v=d[1].x,f=d[2].x,T=Math.max(m,Math.max(v,f)),y=Math.min(m,Math.min(v,f));T>.9&&y<.1&&(m<.2&&(d[0].x+=1),v<.2&&(d[1].x+=1),f<.2&&(d[2].x+=1))}for(a=0,r=this.vertices.length;a<r;a++)this.vertices[a].multiplyScalar(n);function w(t){var e=t.normalize().clone();e.index=o.vertices.push(e)-1;var n=H(t)/2/Math.PI+.5,i=function(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}(t)/Math.PI+.5;return e.uv=new THREE.Vector2(n,1-i),e}function g(t,e,n){var i=new THREE.Face3(t.index,e.index,n.index,[t.clone(),e.clone(),n.clone()]);o.faces.push(i),E.copy(t).add(e).add(n).divideScalar(3);var a=H(E);o.faceVertexUvs[0].push([x(t.uv,t,a),x(e.uv,e,a),x(n.uv,n,a)])}function R(t,e){for(var n=Math.pow(2,e),i=(Math.pow(4,e),w(o.vertices[t.a])),a=w(o.vertices[t.b]),r=w(o.vertices[t.c]),s=[],c=0;c<=n;c++){s[c]=[];for(var l=w(i.clone().lerp(r,c/n)),h=w(a.clone().lerp(r,c/n)),u=n-c,p=0;p<=u;p++)s[c][p]=0==p&&c==n?l:w(l.clone().lerp(h,p/u))}for(c=0;c<n;c++)for(p=0;p<2*(n-c)-1;p++){var E=Math.floor(p/2);p%2==0?g(s[c][E+1],s[c+1][E],s[c][E]):g(s[c][E+1],s[c+1][E+1],s[c+1][E])}}function H(t){return Math.atan2(t.z,-t.x)}function x(t,e,n){return n<0&&1===t.x&&(t=new THREE.Vector2(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new THREE.Vector2(n/2/Math.PI+.5,t.y)),t.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(t,e){this.parameters={radius:t,detail:e},THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(t,e,n,i,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:o},t=t||100,e=e||40,n=n||8,i=i||6,o=o||2*Math.PI;for(var a=new THREE.Vector3,r=[],s=[],c=0;c<=n;c++)for(var l=0;l<=i;l++){var h=l/i*o,u=c/n*Math.PI*2;a.x=t*Math.cos(h),a.y=t*Math.sin(h);var p=new THREE.Vector3;p.x=(t+e*Math.cos(u))*Math.cos(h),p.y=(t+e*Math.cos(u))*Math.sin(h),p.z=e*Math.sin(u),this.vertices.push(p),r.push(new THREE.Vector2(l/i,c/n)),s.push(p.clone().sub(a).normalize())}for(c=1;c<=n;c++)for(l=1;l<=i;l++){var E=(i+1)*c+l-1,d=(i+1)*(c-1)+l-1,m=(i+1)*(c-1)+l,v=(i+1)*c+l,f=new THREE.Face3(E,d,v,[s[E].clone(),s[d].clone(),s[v].clone()]);this.faces.push(f),this.faceVertexUvs[0].push([r[E].clone(),r[d].clone(),r[v].clone()]),f=new THREE.Face3(d,m,v,[s[d].clone(),s[m].clone(),s[v].clone()]),this.faces.push(f),this.faceVertexUvs[0].push([r[d].clone(),r[m].clone(),r[v].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var n,i,o,a=function(t,e,n){var i=new THREE.Geometry;n=n||1;for(var o=0;o<=64*n;++o)"x"==e&&i.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(t)),"y"==e&&i.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(t)),"z"==e&&i.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(t));return i},r=function(t,e,n,i,o,a){var r=new THREE.Geometry,s=new THREE.Mesh(new THREE.CylinderGeometry(t,e,n,i,o,a));return s.position.y=.5,s.updateMatrix(),r.merge(s.geometry,s.matrix),r},s=function(t){var e=new THREE.Geometry;return"X"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===t&&e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),e};THREE.TransformGizmo=function(t){var e=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var t=new THREE.PlaneBufferGeometry(50,50,2,2),e=new THREE.MeshBasicMaterial({wireframe:!0});e.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(t,e),YZ:new THREE.Mesh(t,e),XZ:new THREE.Mesh(t,e),XYZE:new THREE.Mesh(t,e)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse((function(t){if(t instanceof THREE.Mesh){t.updateMatrix();var e=new THREE.Geometry;t.geometry instanceof THREE.BufferGeometry&&(t.geometry=(new THREE.Geometry).fromBufferGeometry(t.geometry)),e.merge(t.geometry,t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}}))},this.hide=function(){this.traverse((function(t){t.visible=!1}))},this.show=function(){this.traverse((function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?e.material.highlight(!0):e.material.highlight(!1))}))},this.setupGizmos=function(){var e=function(t,e){for(var n in t)for(var i=t[n].length;i--;){var o=t[n][i][0],a=t[n][i][1],r=t[n][i][2],s=t[n][i][3];o.name=n,a&&o.position.set(a[0],a[1],a[2]),r&&o.rotation.set(r[0],r[1],r[2]),s&&(o.visble=s),e.add(o)}};if(this.setHandlePickerGizmos(),t)for(var n=Object.keys(this.handleGizmos),i=0;i<n.length;i++){var o=n[i];-1===t.indexOf(o)&&(delete this.handleGizmos[o],delete this.pickerGizmos[o],delete this.hemiPickerGizmos[o])}e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(t,e){var n=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse((function(a){a.name&&(-1!=a.name.search("E")?a.quaternion.setFromRotationMatrix(o.lookAt(e,n,i)):-1==a.name.search("X")&&-1==a.name.search("Y")&&-1==a.name.search("Z")||a.quaternion.setFromEuler(t))}))},THREE.TransformGizmoTranslate=function(n){THREE.TransformGizmo.call(this,n),this.setHandlePickerGizmos=function(){var n=r(0,.05,.2,12,1,!1),i=s("X"),o=s("Y"),a=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new e({color:15805484}))]],Y:[[new THREE.Mesh(n,new t({color:768011})),[0,.5,0]],[new THREE.Line(o,new e({color:768011}))]],Z:[[new THREE.Mesh(n,new t({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new e({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new t({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new t({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new t({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(n){THREE.TransformGizmo.call(this,n),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(a(1,"x",.5),new e({color:16711680}))]],RY:[[new THREE.Line(a(1,"y",.5),new e({color:65280}))]],RZ:[[new THREE.Line(a(1,"z",.5),new e({color:255}))]],RE:[[new THREE.Line(a(1.25,"z",1),new e({color:65535}))]],RXYZE:[[new THREE.Line(a(1,"z",1),new e({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new t({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new t({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(t){"RE"==t&&(this.activePlane=this.planes.XYZE),"RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(t,e){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(a,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(r,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(e){THREE.TransformGizmo.call(this,e);var n=this;this.setHandlePickerGizmos=function(){var e=r(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0)),this.handleGizmos={Z:[[new THREE.Mesh(e,new t({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new t({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new t({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new t({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new t({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new t({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new t({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new t({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new t({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new t({color:255})),null,null,!1]]}},this.setActivePlane=function(t,e,n){if("translate"==this.activeMode){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(t,e){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(a,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(r,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))}},this.show=function(){this.traverse((function(t){(null==n.parent||n.parent.useAllPickers||t.parent!=n.handles)&&(t.visible=!0),t.material&&(t.material.opacity=t.material.oldOpacity),t.parent!=n.pickers&&t.parent!=n.hemiPicker&&t.parent!=n.subPickers||(t.visible=!1),t.parent!=n.planes&&t.parent!=n.highlights||(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?(e.parent!=n.highlights&&e.parent!=n.handles||(e.visible=!0),e.material.highlight(!0)):(e.material.highlight(!1),e.material.opacity=.1))}))},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(n){THREE.TransformGizmo.call(this,n),this.setHandlePickerGizmos=function(){var n=r(.125,.125,.125),i=s("X"),o=s("Y"),a=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new e({color:16711680}))]],Y:[[new THREE.Mesh(n,new t({color:65280})),[0,.5,0]],[new THREE.Line(o,new e({color:65280}))]],Z:[[new THREE.Mesh(n,new t({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new e({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new t({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new t({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(t,e,n,i){switch(THREE.Object3D.call(this),e=void 0!==e?e:document,this.gizmo={},n){case"translate":this.gizmo[n]=new THREE.TransformGizmoTranslate(i);break;case"rotate":this.gizmo[n]=new THREE.TransformGizmoRotate(i);break;case"transrotate":this.gizmo[n]=new THREE.TransformGizmoTranslateRotate(i);break;case"scale":this.gizmo[n]=new THREE.TransformGizmoScale(i)}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===n){(r=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var o=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(r,o);var a,r=new THREE.Geometry;o=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1}),r.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(r,o),r=new THREE.Geometry,o=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1}),r.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(r,o),(a=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=a.minFilter=THREE.NearestFilter,r=new THREE.CircleGeometry(.1,32),o=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:a}),this.centerMark=new THREE.Mesh(r,o),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(a=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=a.minFilter=THREE.NearestFilter,o=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:a}),this.ticks.RX=new THREE.Object3D,r=new THREE.PlaneBufferGeometry(.12,.25);var s=new THREE.Mesh(r,o);s.position.set(0,0,-1.275),s.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(s),(s=s.clone()).position.set(0,-1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),this.ticks.RY=new THREE.Object3D,(s=s.clone()).position.set(0,0,-1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(-1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s)}var c=this,l=!1,h=n,u={type:"change"},p={type:"mouseDown"},E={type:"mouseUp",mode:h},d={type:"objectChange"},m=(new THREE.Raycaster,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),v=new THREE.Vector3,f=new THREE.Vector3,T=new THREE.Vector3,y=1;this.clientScale=1;var w=new THREE.Matrix4,g=new THREE.Vector3,R=new THREE.Matrix4,H=new THREE.Vector3,x=new THREE.Quaternion,M=new THREE.Vector3,b=new THREE.Vector3,P=new THREE.Vector3,S=new THREE.Quaternion,A=new THREE.Quaternion,C=new THREE.Quaternion,V=new THREE.Quaternion,z=new THREE.Quaternion,B=new THREE.Vector3,k=new THREE.Vector3,G=new THREE.Matrix4,I=new THREE.Matrix4,O=new THREE.Vector3,j=new THREE.Vector3,X=new THREE.Euler,Y=new THREE.Matrix4,L=new THREE.Vector3;function Z(e,n){return THREE.TransformControls.intersectObjects(e.canvasX,e.canvasY,n,t,!0)}new THREE.Euler,this.attach=function(t){c.object=t,this.gizmo[h].show(),c.update(),c.updateUnitVectors()},this.detach=function(t){c.object=void 0,this.axis=null,this.gizmo[h].hide()},this.setMode=function(t){"scale"==(h=t||h)&&(c.space="local"),this.gizmo[h].show(),this.update(),c.dispatchEvent(u)},this.getPicker=function(){return c.gizmo[h].hemiPicker.children},this.setPosition=function(t){this.object.position.copy(t),this.update()},this.setNormal=function(t){x.setFromUnitVectors(this.normal,t),this.unitX.applyQuaternion(x),this.unitY.applyQuaternion(x),this.unitZ.applyQuaternion(x),this.normal.copy(t),this.object&&this.object.quaternion.multiply(x),this.update()},this.setRotation=function(t){this.object&&(this.object.quaternion.setFromRotationMatrix(t),this.update(),this.updateUnitVectors())},this.setSnap=function(t,e){c.snap=t,c.snapDelta=e},this.setSize=function(t){c.size=t,this.update(),c.dispatchEvent(u)},this.setSpace=function(t){c.space=t,this.update(),c.dispatchEvent(u)},this.update=function(n){if(void 0!==c.object){var i;if(c.object.updateMatrixWorld(),j.setFromMatrixPosition(c.object.matrixWorld),X.setFromRotationMatrix(R.extractRotation(c.object.matrixWorld)),t.updateMatrixWorld(),L.setFromMatrixPosition(t.matrixWorld),this.position.copy(j),this.quaternion.setFromEuler(X),this.normal.set(0,0,1),this.normal.applyEuler(X),t.isPerspective){var o=j.distanceTo(L);i=2*Math.tan(t.fov*Math.PI/360)*o}else i=t.top-t.bottom;var a=e.getBoundingClientRect();y=100*this.clientScale*i/a.height,this.scale.set(y,y,y),this.gizmoOffset&&this.position.add(this.gizmoOffset),this.updateMatrixWorld(),n&&this.gizmo[h].highlight(c.axis)}},this.setGizmoOffset=function(t){this.gizmoOffset=t||new THREE.Vector3(0,0,0),this.update()},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(X),this.unitY.applyEuler(X),this.unitZ.applyEuler(X)},this.showRotationGizmos=function(t){for(var e=this.gizmo[h].handles.children,n=0;n<e.length;n++){var i=e[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=t)}this.useAllPickers=t},this.highlight=function(){this.gizmo[h].highlight(this.axis||"Z")},this.onPointerHover=function(t){if(void 0===c.object||!0===l)return!1;var e=Z(t,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children),n=null,i="";return e&&(i=-1!=(n=e.object.name).search("R")?"rotate":"translate"),c.axis!==n&&(c.axis=n,c.gizmo[h].activeMode=i,c.update(!0),c.dispatchEvent(u)),null===c.axis&&c.gizmo[h].show(),!!e},this.isDragging=function(){return l},this.onPointerDown=function(e){if(void 0===c.object||!0===l)return!1;var n=e;if("touch"===e.pointerType){var i=null,o="";(a=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))&&(o=-1!=(i=a.object.name).search("R")?"rotate":"translate"),c.axis!==i&&(c.axis=i,c.gizmo[h].activeMode=o)}var a=null;if((0===n.button||-1===n.button||void 0===n.button)&&(a=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))){c.dispatchEvent(p),c.axis=a.object.name,c.update(),g.copy(t.position).sub(j).normalize(),c.gizmo[h].setActivePlane(c.axis,g,"local"===c.space);var r=Z(n,[c.gizmo[h].activePlane]);if(r&&v.copy(r.point),B.copy(c.object.position),k.copy(c.object.scale),G.extractRotation(c.object.matrix),Y.extractRotation(c.object.matrixWorld),c.object.parent?(I.extractRotation(c.object.parent.matrixWorld),O.setFromMatrixScale(R.copy(c.object.parent.matrixWorld).invert())):(I.extractRotation(c.object.matrixWorld),O.setFromMatrixScale(R.copy(c.object.matrixWorld).invert())),"transrotate"===h&&"rotate"===c.gizmo[h].activeMode){c.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(c.matrixWorld),c.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(c.matrixWorld),c.startLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.startLine);var s=c.object.geometry.getAttribute("position"),u=(new THREE.Vector3).fromAttribute(s,0).applyMatrix4(c.object.matrixWorld),E=(new THREE.Vector3).fromAttribute(s,1).applyMatrix4(c.object.matrixWorld),d=(new THREE.Vector3).fromAttribute(s,2).applyMatrix4(c.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(s,3).applyMatrix4(c.object.matrixWorld);if("RX"===c.axis){u.lerp(d,.5),E.lerp(m,.5);var f=u.distanceTo(E);c.centerLine.material.dashSize=f/15,c.centerLine.material.gapSize=f/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(E)}else u.lerp(E,.5),d.lerp(m,.5),f=u.distanceTo(d),c.centerLine.material.dashSize=f/15,c.centerLine.material.gapSize=f/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(d);c.centerLine.geometry.computeLineDistances(),c.centerLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.centerLine),c.ticks[c.axis].position.copy(c.position),c.ticks[c.axis].quaternion.copy(c.quaternion),c.ticks[c.axis].scale.copy(c.scale),c.parent.add(c.ticks[c.axis])}}return l=!0,!!a},this.onPointerMove=function(t){if(void 0===c.object||null===c.axis||!1===l)return!1;var e=Z(t,[c.gizmo[h].activePlane]);e&&m.copy(e.point);var n=c.gizmo[h].activeMode;if("translate"==n)m.sub(v),m.multiply(O),"local"==c.space&&(m.applyMatrix4(R.copy(Y).invert()),-1==c.axis.search("X")&&(m.x=0),-1==c.axis.search("Y")&&(m.y=0),-1==c.axis.search("Z")&&(m.z=0),m.applyMatrix4(G),c.object.position.copy(B),c.object.position.add(m)),"world"!=c.space&&-1==c.axis.search("XYZ")||(M.copy(this.unitX),b.copy(this.unitY),P.copy(this.unitZ),H.set(0,0,0),-1!=c.axis.search("X")&&(M.multiplyScalar(m.dot(this.unitX)),H.add(M)),-1!=c.axis.search("Y")&&(b.multiplyScalar(m.dot(this.unitY)),H.add(b)),-1!=c.axis.search("Z")&&(P.multiplyScalar(m.dot(this.unitZ)),H.add(P)),m.copy(H),m.applyMatrix4(R.copy(I).invert()),c.object.position.copy(B),c.object.position.add(m));else if("scale"==n)m.sub(v),m.multiply(O),"local"==c.space&&("XYZ"==c.axis?(y=1+m.y/50,c.object.scale.x=k.x*y,c.object.scale.y=k.y*y,c.object.scale.z=k.z*y):(m.applyMatrix4(R.copy(Y).invert()),"X"==c.axis&&(c.object.scale.x=k.x*(1+m.x/50)),"Y"==c.axis&&(c.object.scale.y=k.y*(1+m.y/50)),"Z"==c.axis&&(c.object.scale.z=k.z*(1+m.z/50))));else if("rotate"==n){if(m.sub(j),m.multiply(O),H.copy(v).sub(j),H.multiply(O),"RE"==c.axis){R.copy(w).invert(),m.applyMatrix4(R),H.applyMatrix4(R),f.set(Math.atan2(m.z,m.y),Math.atan2(m.x,m.z),Math.atan2(m.y,m.x)),T.set(Math.atan2(H.z,H.y),Math.atan2(H.x,H.z),Math.atan2(H.y,H.x)),x.setFromRotationMatrix(R.copy(I).invert());var i=f.z-T.z;if(null!==c.snap){var o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}z.setFromAxisAngle(g,i),S.setFromRotationMatrix(Y),x.multiplyQuaternions(x,z),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}else if("RXYZE"==c.axis){var a=m.clone().cross(H).normalize();x.setFromRotationMatrix(R.copy(I).invert());var r=-m.clone().angleTo(H);null!==c.snap&&(o=Math.round(r/c.snap)*c.snap,Math.abs(o-r)<c.snapDelta&&(r=o)),A.setFromAxisAngle(a,r),S.setFromRotationMatrix(Y),x.multiplyQuaternions(x,A),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}else if("local"==c.space){R.copy(Y).invert(),m.applyMatrix4(R),H.applyMatrix4(R);var s=m.dot(this.unitX),p=m.dot(this.unitY),E=m.dot(this.unitZ),X=H.dot(this.unitX),L=H.dot(this.unitY),_=H.dot(this.unitZ);f.set(Math.atan2(E,p),Math.atan2(s,E),Math.atan2(p,s)),T.set(Math.atan2(_,L),Math.atan2(X,_),Math.atan2(L,X));var D=f.x-T.x,N=f.y-T.y;i=f.z-T.z,null!==c.snap&&(-1!=c.axis.search("X")&&(o=Math.round(D/c.snap)*c.snap,Math.abs(o-D)<c.snapDelta&&(D=o)),-1!=c.axis.search("Y")&&(o=Math.round(N/c.snap)*c.snap,Math.abs(o-N)<c.snapDelta&&(N=o)),-1!=c.axis.search("Z")&&(o=Math.round(i/c.snap)*c.snap,Math.abs(o-i)<c.snapDelta&&(i=o))),A.setFromAxisAngle(this.unitX,D),C.setFromAxisAngle(this.unitY,N),V.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(G),"RX"==c.axis&&S.multiplyQuaternions(S,A),"RY"==c.axis&&S.multiplyQuaternions(S,C),"RZ"==c.axis&&S.multiplyQuaternions(S,V),c.object.quaternion.copy(S)}else"world"==c.space&&(s=m.dot(this.unitX),p=m.dot(this.unitY),E=m.dot(this.unitZ),X=H.dot(this.unitX),L=H.dot(this.unitY),_=H.dot(this.unitZ),f.set(Math.atan2(E,p),Math.atan2(s,E),Math.atan2(p,s)),T.set(Math.atan2(_,L),Math.atan2(X,_),Math.atan2(L,X)),x.setFromRotationMatrix(R.copy(I).invert()),D=f.x-T.x,N=f.y-T.y,i=f.z-T.z,null!==c.snap&&(-1!=c.axis.search("X")&&(o=Math.round(D/c.snap)*c.snap,Math.abs(o-D)<c.snapDelta&&(D=o)),-1!=c.axis.search("Y")&&(o=Math.round(N/c.snap)*c.snap,Math.abs(o-N)<c.snapDelta&&(N=o)),-1!=c.axis.search("Z")&&(o=Math.round(i/c.snap)*c.snap,Math.abs(o-i)<c.snapDelta&&(i=o))),A.setFromAxisAngle(this.unitX,D),C.setFromAxisAngle(this.unitY,N),V.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(Y),"RX"==c.axis&&x.multiplyQuaternions(x,A),"RY"==c.axis&&x.multiplyQuaternions(x,C),"RZ"==c.axis&&x.multiplyQuaternions(x,V),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x));"transrotate"===h&&(c.add(c.endLine),c.add(c.centerMark))}return c.object.matrixAutoUpdate=!0,c.update(!0),c.dispatchEvent(u),c.dispatchEvent(d),!!e},this.onPointerUp=function(t){return l&&null!==c.axis&&(E.mode=h,c.dispatchEvent(E)),l=!1,this.gizmo[h].show(),this.updateUnitVectors(),"transrotate"===h&&"rotate"===this.gizmo[h].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.intersectObjects=(n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Raycaster,function(t,e,a,r,s){var c=t/r.clientWidth*2-1,l=-e/r.clientHeight*2+1;r.isPerspective?(n.set(c,l,.5),n.unproject(r),o.set(r.position,n.sub(r.position).normalize())):(n.set(c,l,-1),n.unproject(r),i.set(0,0,-1),o.set(n,i.transformDirection(r.matrixWorld)));var h=o.intersectObjects(a,s);return h[0]?h[0]:null}),THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)})(),e||((e=function(t,e,n){THREE.Mesh.call(this,t,e,!1),this.plane=n,this.planeVec=new THREE.Vector4(n.normal.x,n.normal.y,n.normal.z,n.constant),this.connectivity=[],this.outlines=[]}).prototype=Object.create(THREE.Mesh.prototype),e.prototype.constructor=e,e.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var t=this.plane.normal,e=-1*this.getWorldPosition().dot(t);this.planeVec.set(t.x,t.y,t.z,e),this.plane.constant=e});var j=new function(t,e){var n,i,o,a,r,s,l,h=0,u=[],p=[];function E(t){h&&clearTimeout(h),h=0,i=t,u.length=0,p.length=0,a=null,r=-1,s=0,l=0}function d(){h=0;for(var a=performance.now()+t;performance.now()<a;){if(!f())return c.invalidate(!0,!0),void E(null);n(p[l],u[s],o,l+1>=p.length,!i||r>=i.length)}h=setTimeout(d,e)}function m(){if(i&&r<i.length)for(;++r<i.length;)if((a=i[r].getInstanceTree())&&(u.length=0,a.enumNodeChildren(i[r].getRootId(),(function(t){u.push(t)}),!0),u.length>0))return o=i[r];return o=null,!1}function v(){if(s>=u.length)return!1;for(;++s<u.length;){var t=u[s];if(!a.isNodeHidden(t)&&!a.isNodeOff(t)&&(p.length=0,a.enumNodeFragments(t,(function(t){p.push(t)}),!1),p.length>0))return!0}return!1}function f(){if(++l<p.length)return!0;for(l=0;;){if(v())return!0;if(!m())return!1;s=-1}}t=t||15,e=e||0,this.start=function(t,e,i){E(t),n=i,i&&(e>=0?h=setTimeout(d,e):d())}};function X(t){if(z){var e=Autodesk.Viewing.Extensions.CompGeom;c.sceneAfter.skipDepthTarget=!0,ot();var n=new THREE.Object3D;n.name="section3D",c.scene.add(n);var i=new THREE.Object3D;i.name="section2D",c.sceneAfter.add(i);var a=e.makePlaneBasis(t),r=a.clone().invert(),s=c.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0,isScreenSpace:!0},!1,!1),l=c.matman().findMaterial(null,s);l.transparent=!0,l.depthTest=!0,l.polygonOffset=!0,l.polygonOffsetFactor=-1,l.polygonOffsetUnits=.1,l.cutplanes=L;var h,u=new THREE.Box3,p=c.modelQueue().getModels().filter((function(t){return!t.getDoNotCut()})),E=[];j.start(p,50,(function(s,p,v,f){var T=v.getFragmentList();if(T.getWorldBounds(s,u),e.xBoxPlane(t,u)){var y=T.getVizmesh(s);y.geometry&&!y.geometry.is2d&&!y.geometry.isLines&&y.material.cutplanes&&(h=y.material,e.xMeshPlane(t,y,E))}if(f){if(E.length){var w=new THREE.Box3;e.convertToPlaneCoords(a,E,w);var g=new o.VertexBufferBuilder(!1,8*E.length),R=function(t){return t&&t.color||new THREE.Color(16777215)}(h),H=0|.25*R.r*255.5,x=0|.25*R.g*255.5,M=4278190080|(0|.25*R.b*255.5)<<16|x<<8|H,b=new e.EdgeSet(E,w,1e-6*w.getSize(new THREE.Vector3).length());b.snapEdges(),b.sanitizeEdges(),b.stitchContours();var P=b.triangulate();if(P){for(var S=0;S<P.contours.length;S++)for(var A=P.contours[S],C=1;C<A.length;C++){var V=P.pts[A[C-1]],z=P.pts[A[C]];g.addSegment(V.x,V.y,z.x,z.y,0,-2,M,p,0)}var B={mesh:g.toMesh()};o.BufferGeometryUtils.meshToGeometry(B);var k=B.geometry;k.streamingDraw=!0,k.streamingIndex=!0;var G=new THREE.Mesh(k,l);if(G.matrix.copy(r),G.matrixAutoUpdate=!1,G.frustumCulled=!1,G.modelId=v.id,G.dbId=p,i.add(G),!P.triangulationFailed){var I=P.toPolygonMesh(h.packedNormals),O=c.matman().cloneMaterial(h,v);O.packedNormals=h.packedNormals,O.cutplanes=L,O.side=THREE.FrontSide,O.depthTest=!0,O.map=null,O.bumpMap=null,O.normalMap=null,O.alphaMap=null,O.specularMap=null,O.transparent=!1,O.depthWrite=!0,O.hatchPattern=!0,O.needsUpdate=!0;var j=(h.id+2)*Math.PI*.125,X=Math.tan(j);O.hatchParams=new THREE.Vector2(X,10),O.hatchTintColor=d,O.hatchTintIntensity=m,null!=O.prismType&&(O.defines={},O.defines[O.prismType.toUpperCase()]="","PrismWood"==O.prismType&&(O.defines.NO_UVW=""));var Y=new THREE.Mesh(I,O);Y.matrix.copy(r),Y.matrixAutoUpdate=!1,Y.modelId=v.id,Y.dbId=p,Y.fragId=E.fragId,n.add(Y)}}}E.length=0}}))}}var Y="Autodesk.Viewing.Extension.Section.SectionTool";c.setCutPlaneSetFor2DRendering(Y);var L=[];function Z(t,n){var i,o,a=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),t.normal);if(n){var r=t.projectPoint(n.max),s=t.projectPoint(n.min),l=a.clone().inverse();r.applyQuaternion(l),s.applyQuaternion(l),o=(new THREE.Vector3).subVectors(r,s),i=new THREE.PlaneBufferGeometry(o.x,o.y)}else o=2*(n=c.getVisibleBounds()).getBoundingSphere(new THREE.Sphere).radius,i=new THREE.PlaneBufferGeometry(o,o);var h=new THREE.MeshBasicMaterial({opacity:0,color:2653930,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),u=new e(i,h,t),p=t.projectPoint(n.getCenter());u.position.copy(p),u.quaternion.multiply(a);var E=c.currentLightPreset();E=Math.max(0,E);for(var d=Autodesk.Viewing.Private.LightPresets[E].bgColorGradient,m="rgb("+(255-d[0])+","+(255-d[1])+","+(255-d[2])+")",v=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),f=u.geometry.getAttribute("position"),T=0;T<V.length;T++){(i=new THREE.Geometry).vertices.push((new THREE.Vector3).fromArray(f.array,V[T][0]*f.itemSize),(new THREE.Vector3).fromArray(f.array,V[T][1]*f.itemSize));var y=new THREE.Line(i,v);u.add(y),u.outlines.push(y)}return u}function _(t){D((function(n){var i,o,a,r;if(n instanceof e)if(n.connectivity.length>0){var s=n.matrixWorld.clone().invert();for(r=new THREE.Vector3,a=n.geometry.getAttribute("position"),i=0;i<a.length/a.itemSize;i++){var l=n.connectivity[i];null!==nt(n.plane,l[0],l[1],r)&&(r.applyMatrix4(s),a.setXYZ(i,r.x,r.y,r.z))}for(a.needsUpdate=!0,n.geometry.computeBoundingBox(),n.geometry.computeBoundingSphere(),i=0;i<n.outlines.length;i++)(o=n.outlines[i]).geometry.vertices[0].fromArray(a.array,V[i][0]*a.itemSize),o.geometry.vertices[1].fromArray(a.array,V[i][1]*a.itemSize),o.geometry.verticesNeedUpdate=!0}else if(t){var h=c.getVisibleBounds(),u=2*h.getBoundingSphere(new THREE.Sphere).radius;for(r=n.plane.projectPoint(h.getCenter()),n.geometry=new THREE.PlaneBufferGeometry(u,u),n.position.copy(r),a=n.geometry.getAttribute("position"),i=0;i<n.outlines.length;i++)(o=n.outlines[i]).geometry.vertices[0].fromArray(a.array,V[i][0]*a.itemSize),o.geometry.vertices[1].fromArray(a.array,V[i][1]*a.itemSize),o.geometry.verticesNeedUpdate=!0}}))}function D(t){for(var e=0;e<H.length;e++)H[e].traverse(t)}function N(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];D((function(t){t instanceof e&&t.update()})),1===x.length&&X((new THREE.Plane).setComponents(x[0].x,x[0].y,x[0].z,x[0].w)),c.setCutPlaneSet(Y,x,t)}function F(t){for(var e=0;e<H.length;e++)H[e].visible=t;E!==t&&k(),E=t}function W(t){t&&x.length>0&&(1===x.length&&X((new THREE.Plane).setComponents(x[0].x,x[0].y,x[0].z,x[0].w)),c.setCutPlaneSet(Y,x)),F(t)}function U(t,e){t.attach(e),t.setPosition(e.position),t.visible=!0}function Q(t){return c.api.navigation.getEyeVector().dot(t)>0&&t.negate(),t}function q(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=c.getVisibleBounds(),o=i.getCenter(new THREE.Vector3),r=new THREE.Group;e=void 0!==e?e:-1*o.dot(t);var s=new THREE.Plane(t,e),l=Z(s,null);r.add(l),x.push(l.planeVec),H.push(r),c.addOverlay(P,r),a&&(U(a,l),l.material.opacity=0,J(l),a.showRotationGizmos(!0),M=a.getPicker()),N(n),h&&G()}function J(t){if(!a||!t)return!1;var e=function(t){var e=new THREE.Vector3,n=t.geometry;return n.computeBoundingBox(),e.x=(n.boundingBox.max.x+n.boundingBox.min.x)/2,e.y=(n.boundingBox.max.y+n.boundingBox.min.y)/2,e.z=(n.boundingBox.max.z+n.boundingBox.min.z)/2,t.localToWorld(e),e}(t).sub(t.position);return e.sub(s),a.setGizmoOffset(e),!0}var K,$,tt,et,nt=(K=new THREE.Matrix3,$=new THREE.Vector3,tt=new THREE.Vector3,et=new THREE.Vector3,function(t,e,n,i){K.set(t.normal.x,t.normal.y,t.normal.z,e.normal.x,e.normal.y,e.normal.z,n.normal.x,n.normal.y,n.normal.z);var o=K.determinant();return 0===o?null:($.crossVectors(e.normal,n.normal).multiplyScalar(-t.constant),tt.crossVectors(n.normal,t.normal).multiplyScalar(-e.constant),et.crossVectors(t.normal,e.normal).multiplyScalar(-n.constant),(i||new THREE.Vector3).copy($).add(tt).add(et).divideScalar(o))}),it=function(t,e,n){return THREE.TransformControls.intersectObjects(t.canvasX,t.canvasY,e,c.camera,n)};function ot(){var t=c.scene.getObjectByName("section3D");t&&c.scene.remove(t);var e=c.sceneAfter.getObjectByName("section2D");e&&c.sceneAfter.remove(e)}this.isActive=function(){return h},this.getSectionDistance=function(t){var e=c.api.navigation.getEyeVector(),n=c.rayIntersect(new THREE.Ray(c.camera.position,e));return n&&n.intersectPoint&&-1*n.intersectPoint.dot(t)},this.setViewerSection=function(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.clearSection(e);var n=c.getCutPlaneSet("__set_view");if(1===n.length){a.clientScale=1;var i=n[0];t=new THREE.Vector3(i.x,i.y,i.z);var o=i.w;q(t,o,e),b="SET_VIEW_PLANE",c.setCutPlaneSet("__set_view",void 0,e)}},this.setSection=function(t){var e,n;this.clearSection(),s=new THREE.Vector3,a.clientScale=1;var i=c.getCutPlaneSet("__set_view");switch(1===i.length&&"BOX"!==t&&"OBJ_SET_VIEW_PLANE"!==t&&(t="SET_VIEW_PLANE"),t){case"X":e=new THREE.Vector3(1,0,0),n=this.getSectionDistance(e),q(Q(e),n);break;case"Y":e=new THREE.Vector3(0,1,0),n=this.getSectionDistance(e),q(Q(e),n);break;case"Z":e=new THREE.Vector3(0,0,1),n=this.getSectionDistance(e),q(Q(e),n);break;case"OBJ_SET_VIEW_PLANE":case"SET_VIEW_PLANE":var o=i[0];q(e=new THREE.Vector3(o.x,o.y,o.z),o.w);break;case"OBJ_BOX":case"BOX":!function(t){var e=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],n=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],i=new THREE.Group,o=c.getVisibleBounds(),s=o.getCenter(new THREE.Vector3),l=new THREE.Box3(o.min,s),h=!1;t&&6===t.length&&1===t[0].x&&(s=(l=new THREE.Box3(new THREE.Vector3(t[3].w,t[4].w,t[5].w),new THREE.Vector3(t[0].w,t[1].w,t[2].w))).max.clone(),h=!0);var u,p,E,d=[],m=[];for(u=0;u<e.length;u++){if(h)E=new THREE.Plane(e[u],t[u].w),d.push(E);else if(E=new THREE.Plane(e[u],-1*s.dot(e[u])),d.push(E),u>2){var v=E.orthoPoint(l.max),f=E.orthoPoint(l.min),T=(new THREE.Vector3).subVectors(v,f);E.constant-=T.length()}p=Z(E,l),i.add(p),m.push(p),x.push(p.planeVec)}for(u=0;u<m.length;u++){p=m[u];for(var y=n[u],w=0;w<y.length;w++){for(var g=[],R=y[w],b=0;b<R.length;b++)g.push(d[R[b]]);p.connectivity.push(g)}}H.push(i),c.addOverlay(P,i),N(),_(),E=H[0].children[0],U(a,E),E.material.opacity=.25,J(E),U(r,H[0]),a.showRotationGizmos(!1),M=a.getPicker().concat(r.getPicker());var S=H[0].position.clone().sub(s.clone());r.setGizmoOffset(S)}(i),a.clientScale=2,this.recomputePivot()}b=t,c.setCutPlaneSet("__set_view",void 0)},this.setSectionFromPlane=function(t){this.clearSection(),q(new THREE.Vector3(t.x,t.y,t.z),t.w),b="",c.setCutPlaneSet("__set_view",void 0)},this.setActiveMode=function(t){b=t||""},this.setDisplaySectionHatches=function(t){z=t},this.updateCapMeshes=function(t){t&&(q(t.normal,t.constant),X(t))},this.clearSection=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(a&&a.detach(),r&&r.detach();x.length>0;)x.pop();for(;H.length>0;){var e=H.pop();c.removeOverlay(P,e)}j.start(null),ot(),c.setCutPlaneSet(Y,null,t)},this.isPlaneOn=function(){return E},this.showPlane=function(t){F(t)},this.attachControl=function(t){a&&r&&(t?(U(a,H[0].children[0]),a.highlight(),"BOX"===b&&U(r,H[0])):(a.detach(),r.detach()))},this.resetSection=function(){this.setSection(b)},this.getNames=function(){return l},this.getName=function(){return l[0]},this.register=function(){},this.deregister=function(){this.clearSection(),A&&(c.removeOverlay(P,a),a.removeEventListener("change",k),a=null,c.removeOverlay(P,r),r.removeEventListener("change",k),r.removeEventListener("change",I),r=null,c.removeOverlayScene(P),n.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,G),n.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,O),n.removeEventListener(Autodesk.Viewing.HIDE_EVENT,O),n.removeEventListener(Autodesk.Viewing.SHOW_EVENT,O),n.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,O),A=!1)},this.getPriority=function(){return 70},this.activate=function(){!function(){if(A)return c.addOverlay(P,a),void c.addOverlay(P,r);(a=new THREE.TransformControls(c.camera,c.canvas,"transrotate")).addEventListener("change",k),a.setSnap(Math.PI/2,Math.PI/36),(r=new THREE.TransformControls(c.camera,c.canvas,"translate")).addEventListener("change",k),r.addEventListener("change",I),void 0===c.overlayScenes.gizmo&&c.createOverlayScene(P),c.addOverlay(P,a),c.addOverlay(P,r),n.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,G),n.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,O),n.addEventListener(Autodesk.Viewing.HIDE_EVENT,O),n.addEventListener(Autodesk.Viewing.SHOW_EVENT,O),n.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,O),A=!0}(),h=!0,u=!1,C=!0,x=x||[],W(!0)},this.deactivate=function(){if(h=!1,u=!1,this.keepCutPlanesOnDeactivate){c.removeOverlay(P,a),c.removeOverlay(P,r);for(var t=0;t<H.length;t++)c.removeOverlay(P,H[t])}else j.start(null),ot(),W(!1),c.setCutPlaneSet(Y);a.detach(),r.detach()},this.update=function(){return!1},this.handleSingleClick=function(t){var e,n=it(t,null===(e=H[0])||void 0===e?void 0:e.children);if(H[0].children.forEach((function(t){t.material.opacity=0})),n){var i,o=a.object;U(a,n.object),a.highlight(),n.object.material.opacity=x.length>1?.25:0,(null===(i=H[0])||void 0===i?void 0:i.children.length)>1&&o!==n.object&&J(n.object),k(),I()}return!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(t){return this.handleSingleClick(t,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(t){return u=!0,!!r.onPointerDown(t)||a.onPointerDown(t)},this.handleButtonUp=function(t){return u=!1,p&&(p=!1,this.recomputePivot()),!!r.onPointerUp(t)||a.onPointerUp(t)},this.handleMouseMove=function(t){var e=r.object?(new THREE.Vector3).copy(r.object.position):null;if(u){if(r.onPointerMove(t)){p=!0,N(),a.update();var n=(new THREE.Vector3).copy(r.object.position).sub(e);return s.add(n),B("Canvas","Box","translate"),!0}if(a.onPointerMove(t)){if(p=!0,N(),_(),b.includes("BOX"))B("Canvas","Box","transform");else{var i=-1!=a.axis.search("R")?"rotate":"translate";B("Canvas","Plane",i)}return!0}}if(r.visible=void 0!==r.object,"touch"!==t.pointerType){var o,c=t,l=it(c,null===(o=H[0])||void 0===o?void 0:o.children);l&&(C=!1);var h=!!(C||l||it(c,M,!0));a.visible=h,r.visible=r.visible&&h,F(h)}return!!r.onPointerHover(t)||a.onPointerHover(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":return S="drag",this.handleButtonDown(t,0);case"dragmove":return"drag"===S&&this.handleMouseMove(t);case"dragend":return"drag"===S&&(S=null,this.handleButtonUp(t,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!1},this.recomputePivot=function(){var t=this.getSectionBoxValues(!0);if(t){var e=t.sectionBox;c.api.navigation.setPivotPoint(new THREE.Vector3(e[0]+.5*(e[3]-e[0]),e[1]+.5*(e[4]-e[1]),e[2]+.5*(e[5]-e[2])))}},this.getSectionBoxValues=function(t){var e=H[0];if(!e)return null;var n=e.children;if(n.length<6)return null;var i=n[0].position.x,o=n[1].position.y,a=n[2].position.z,r=n[3].position.x,s=n[4].position.y,l=n[5].position.z,h={x:0,y:0,z:0};return t||(h=c.model.getData().globalOffset||h),{sectionBox:[Math.min(r,i)+h.x,Math.min(o,s)+h.y,Math.min(a,l)+h.z,Math.max(r,i)+h.x,Math.max(o,s)+h.y,Math.max(a,l)+h.z],sectionBoxTransform:(new THREE.Matrix4).identity().toArray()}},this.getSectionPlaneValues=function(t){var e=H[0];if(!e)return null;var n=e.children;if(1!==n.length)return null;var i={x:0,y:0,z:0};t||(i=c.model.getData().globalOffset||i);var o=n[0].plane,a=o.constant-THREE.Vector3.prototype.dot.call(i,o.normal);return{sectionPlane:[o.normal.x,o.normal.y,o.normal.z,a]}},this.getSectionPlaneSet=function(){return c.getCutPlaneSet(Y)},this.getSectionPlanes=function(){var t=c.getCutPlaneSet("__set_view");return t.length>0?t:c.getCutPlaneSet(Y)},this.notifyCutplanesChanged=function(){var t=L.length;L.length=0;for(var e=c.getCutPlaneSets(),n=0;n<e.length;n++){var i=e[n];if(i!==Y)for(var o=c.getCutPlaneSet(i),a=0;a<o.length;a++)L.push(o[a])}e.includes("__set_view")&&""!==b&&-1===b.indexOf("OBJ_")&&this.setViewerSection(!1),t!==L.length&&function(){function t(t){t&&t.traverse((function(t){t instanceof THREE.Mesh&&t.material&&(t.material.needsUpdate=!0)}))}t(c.scene.getObjectByName("section3D")),t(c.sceneAfter.getObjectByName("section2D"))}()},this.setSectionBox=function(t){if(!t)return!1;var e="OBJ_BOX",n=Autodesk.Viewing.Private.SceneMath.box2CutPlanes(t,t.transform);return b=e,c.setCutPlaneSet("__set_view",n),this.setSection(e),!0},this.setSectionPlane=function(t,e){var n,i,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||!e)return!1;var r="OBJ_SET_VIEW_PLANE",s=-1*e.dot(t),l=new THREE.Plane(t,s);b=r;var h=[new THREE.Vector4(l.normal.x,l.normal.y,l.normal.z,l.constant)];c.setCutPlaneSet("__set_view",h),this.setSection(r),null===(n=a)||void 0===n||n.showRotationGizmos(o);var u=e.clone().sub(H[0].children[0].position);return null===(i=a)||void 0===i||i.setGizmoOffset(u),!0}},r=n(93379),s=n.n(r),c=n(7795),l=n.n(c),h=n(90569),u=n.n(h),p=n(3565),E=n.n(p),d=n(19216),m=n.n(d),v=n(44589),f=n.n(v),T=n(32159),y={};y.styleTagTransform=f(),y.setAttributes=E(),y.insert=u().bind(null,"head"),y.domAPI=l(),y.insertStyleElement=m(),s()(T.Z,y),T.Z&&T.Z.locals&&T.Z.locals;var w=Autodesk.Viewing.Private,g=Autodesk.Viewing.UI,R=w.analytics,H=function(t,e){Autodesk.Viewing.Extension.call(this,t,e),this.viewer=t,this.name="section",this.modes=["x","y","z","box"],this.buttons={},this.onViewerSetView=this.onViewerSetView.bind(this),this._onCutPlanesChanged=this._onCutPlanesChanged.bind(this),this._onShowAll=this._onShowAll.bind(this)};H.prototype=Object.create(Autodesk.Viewing.Extension.prototype),H.prototype.constructor=H;var x=H.prototype;x.load=function(){var t=this,e=this,n=this.viewer;this.tool=new a(n,{tintColor:{r:1,g:1,b:0},tintIntensity:.2}),n.toolController.registerTool(this.tool,this.setActive.bind(this)),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],this.displaySectionHatches=this.displaySectionHatches.bind(this),this.viewer.prefs.addListeners(w.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),n.addEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),n.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),n.addEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var i=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){if(0===e.viewer.getAggregateSelection().length)return e.deactivate()}}];return n.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,i),this.viewer.registerContextMenuCallback("Autodesk.Section",(function(e,n){!function(t,e,n){var i;if(n.hasSelected){var o=t.viewer,a=o.getAggregateSelection();if(1!==a.length||!a[0].model.is2d()){var r=o.impl.selector.getSelectionBounds(),s={title:"Section",target:[]};s.target.push({title:"Section Box",target:function(){t.setSectionBox(r),R.track("viewer.section",{From:"Contextual",Type:"Box",action:"Enable"})}});var c=a.map((function(t){return t.selection})).flat(),l=a.map((function(t){return t.model.id})),h=o.impl.hitTest(n.canvasX,n.canvasY,!1,c,l);if((null==h||null===(i=h.face)||void 0===i?void 0:i.normal)&&h.model&&-1!==c.indexOf(h.dbId)){var u=o.impl.getRenderProxy(h.model,h.fragId),p=(new THREE.Matrix3).getNormalMatrix(u.matrixWorld),E=h.face.normal.clone().applyMatrix3(p).normalize();s.target.push({title:"Section Plane",target:function(){t.setSectionPlane(E,h.point,!1),R.track("viewer.section",{From:"Contextual",Type:"Plane",action:"Enable"})}})}e.push(s)}}}(t,e,n)})),this.viewer.loadExtension("Autodesk.CompGeom")},x.unload=function(){var t=this.viewer;return t.unregisterContextMenuCallback("Autodesk.Section"),t.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),t.removeEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),t.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),t.removeEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),this.viewer.prefs.removeListeners(w.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),t.toolController.deregisterTool(this.tool),this.tool=null,!0},x.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var t=this.sectionStyle||"X";this.setSectionStyle(t,!0)}return this.isActive()},x.getSectionStyle=function(){return this.sectionStyle},x.setSectionStyle=function(t,e){if(-1===this.supportedStyles.indexOf(t))return!1;var n=this.isActive(),i=this.sectionStyle!==t||!e;return this.sectionStyle=t,n&&i?this.tool.setSection(t):n||(this.enableSectionTool(!0),i?this.tool.setSection(t):this.tool.attachControl(!0)),!0},x.setSectionFromPlane=function(t){if(this.deactivate(),t)this.tool.setSectionFromPlane(t),this.tool.attachControl(!1),this.isActive()||this.tool.showPlane(!1);else{this.tool.clearSection();var e=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(e)}},x.getSectionPlanes=function(){return this.tool.getSectionPlanes()},x.enableSectionTool=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.viewer.toolController,i=this.tool.isActive();if(t&&!i)return n.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!t&&i){var o=this.tool.keepCutPlanesOnDeactivate;return this.tool.keepCutPlanesOnDeactivate=e,n.deactivateTool("section"),this.tool.keepCutPlanesOnDeactivate=o,this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return t&&n.activateToolModality("section"),!1},x.getViewValues=function(t){var e=this.tool.getSectionBoxValues(t);return e||(this.tool.getSectionPlaneValues(t)||null)},x.getState=function(t){if(this.viewer.model&&!this.viewer.model.is2d()){t.cutplanes=t.cutplanes||[];for(var e=this.tool.getSectionPlaneSet(),n=0;n<e.length;n++)t.cutplanes.push(e[n].toArray())}},x.restoreState=function(t){if(t.cutplanes){var e=this.getSectionPlanes();return this.setSectionFromPlane(null),1===e.length&&this.setSectionFromPlane(e[0]),!0}},x._onCutPlanesChanged=function(){this.tool.notifyCutplanesChanged()},x._onShowAll=function(){this.deactivate()},x.setSectionBox=function(t){var e;t&&(this.enableSectionTool(!0),this.tool.setSectionBox(t)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode="box",null===(e=this.buttons[this.mode])||void 0===e||e.setState(g.Button.State.ACTIVE)):this.enableSectionTool(!1))},x.setSectionPlane=function(t,e,n){var i;t&&e&&(this.enableSectionTool(!0),this.tool.setSectionPlane(t,e,n)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode=this.calculateNearestAxis(t),null===(i=this.buttons[this.mode])||void 0===i||i.setState(g.Button.State.ACTIVE)):this.enableSectionTool(!1))},x.calculateNearestAxis=function(t){var e=Math.abs(t.x),n=Math.abs(t.y),i=Math.abs(t.z);return e>=n&&e>=i?"x":n>e&&n>=i?"y":"z"},x.onViewerSetView=function(){this.deactivate()},x.onToolbarCreated=function(t){this.sectionToolButton=new g.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var e=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(e){var n=e.getControl("toolbar-resetTool");n?e.addControl(this.sectionToolButton,{index:e.indexOf(n.getId())}):e.addControl(this.sectionToolButton,{index:0})}},x.createSubmenu=function(t){var e=this,n=this.viewer;function i(t,n){return e.buttons[n]=t,function(){var i=t.getState(),o=function(){t instanceof g.ComboButton==0?e.activate(n):(e.enableSectionTool(!0),e.tool.attachControl(!0))},a=-1!==n.toLowerCase().indexOf("box")?"Box":"Plane";i===g.Button.State.INACTIVE?(t.setState(g.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(o,1):o(),R.track("viewer.section",{From:"Toolbar",Type:a,action:"Enable"})):i===g.Button.State.ACTIVE&&(t.setState(g.Button.State.INACTIVE),e.deactivate(),R.track("viewer.section",{From:"Toolbar",Type:a,action:"Disable"})),e.sectionStyle=n.toUpperCase()}}function o(){var t,i=(t=new THREE.Vector3,function(e,n,i){return t.subVectors(e,n),t.lengthSq()<i}),o=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),s=n.autocam.getWorldRightVector(),c=n.autocam.getWorldUpVector(),l=n.autocam.getWorldFrontVector(),h=1e-4;i(c,o,h)?e.sectionYButton.setIcon("adsk-icon-plane-x"):i(c,r,h)?e.sectionYButton.setIcon("adsk-icon-plane-z"):e.sectionYButton.setIcon("adsk-icon-plane-y"),i(s,a,h)?e.sectionXButton.setIcon("adsk-icon-plane-y"):i(s,r,h)?e.sectionXButton.setIcon("adsk-icon-plane-z"):e.sectionXButton.setIcon("adsk-icon-plane-x"),i(l,o,h)?e.sectionZButton.setIcon("adsk-icon-plane-x"):i(l,a,h)?e.sectionZButton.setIcon("adsk-icon-plane-y"):e.sectionZButton.setIcon("adsk-icon-plane-z")}var a=this.sectionXButton=new g.Button("toolbar-sectionTool-x");a.setToolTip("Add X plane"),a.setIcon("adsk-icon-plane-x"),a.onClick=i(a,"x"),t.addControl(a);var r=this.sectionYButton=new g.Button("toolbar-sectionTool-y");r.setToolTip("Add Y plane"),r.setIcon("adsk-icon-plane-y"),r.onClick=i(r,"y"),t.addControl(r);var s=this.sectionZButton=new g.Button("toolbar-sectionTool-z");s.setToolTip("Add Z plane"),s.setIcon("adsk-icon-plane-z"),s.onClick=i(s,"z"),t.addControl(s);var c=this.sectionBoxButton=new g.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=i(c,"box"),t.addControl(c),n.model?o():n.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,o,{once:!0})},x.destroyUI=function(){this.sectionToolButton&&(this.sectionToolButton.removeFromParent(),this.sectionToolButton=null,this.buttons={})},x.activate=function(t){if(!this.activeStatus||this.mode!==t){switch(this.enableSectionTool(!0),t){default:this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},x.deactivate=function(t){return!!this.activeStatus&&(this.tool.setActiveMode(""),this.enableSectionTool(!1,t),this.activeStatus=!1,!0)},x.displaySectionHatches=function(t){var e=this;if(this.tool.setDisplaySectionHatches(t),this.activeStatus){var n=this.getSectionPlanes();this.tool.clearSection(),n.forEach((function(t){e.tool.updateCapMeshes((new THREE.Plane).setComponents(t.x,t.y,t.z,t.w))}))}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",H)})(),Autodesk.Extensions.Section=i})();
//# sourceMappingURL=Section.min.js.map