/*! For license information please see SceneBuilder.min.js.LICENSE.txt */
(()=>{var e={77424:(e,t,r)=>{e.exports={RBTree:r(62448),BinTree:r(69675)}},69675:(e,t,r)=>{var i=r(5301);function n(e){this.data=e,this.left=null,this.right=null}function a(e){this._root=null,this._comparator=e,this.size=0}n.prototype.get_child=function(e){return e?this.right:this.left},n.prototype.set_child=function(e,t){e?this.right=t:this.left=t},a.prototype=new i,a.prototype.insert=function(e){if(null===this._root)return this._root=new n(e),this.size++,!0;for(var t=0,r=null,i=this._root;;){if(null===i)return i=new n(e),r.set_child(t,i),ret=!0,this.size++,!0;if(0===this._comparator(i.data,e))return!1;t=this._comparator(i.data,e)<0,r=i,i=i.get_child(t)}},a.prototype.remove=function(e){if(null===this._root)return!1;var t=new n(void 0),r=t;r.right=this._root;for(var i=null,a=null,o=1;null!==r.get_child(o);){i=r,r=r.get_child(o);var s=this._comparator(e,r.data);o=s>0,0===s&&(a=r)}return null!==a&&(a.data=r.data,i.set_child(i.right===r,r.get_child(null===r.left)),this._root=t.right,this.size--,!0)},e.exports=a},62448:(e,t,r)=>{var i=r(5301);function n(e){this.data=e,this.left=null,this.right=null,this.red=!0}function a(e){this._root=null,this._comparator=e,this.size=0}function o(e){return null!==e&&e.red}function s(e,t){var r=e.get_child(!t);return e.set_child(!t,r.get_child(t)),r.set_child(t,e),e.red=!0,r.red=!1,r}function l(e,t){return e.set_child(!t,s(e.get_child(!t),!t)),s(e,t)}n.prototype.get_child=function(e){return e?this.right:this.left},n.prototype.set_child=function(e,t){e?this.right=t:this.left=t},a.prototype=new i,a.prototype.insert=function(e){var t=!1;if(null===this._root)this._root=new n(e),t=!0,this.size++;else{var r=new n(void 0),i=0,a=0,d=null,u=r,c=null,h=this._root;for(u.right=this._root;;){if(null===h?(h=new n(e),c.set_child(i,h),t=!0,this.size++):o(h.left)&&o(h.right)&&(h.red=!0,h.left.red=!1,h.right.red=!1),o(h)&&o(c)){var f=u.right===d;h===c.get_child(a)?u.set_child(f,s(d,!a)):u.set_child(f,l(d,!a))}var m=this._comparator(h.data,e);if(0===m)break;a=i,i=m<0,null!==d&&(u=d),d=c,c=h,h=h.get_child(i)}this._root=r.right}return this._root.red=!1,t},a.prototype.remove=function(e){if(null===this._root)return!1;var t=new n(void 0),r=t;r.right=this._root;for(var i=null,a=null,d=null,u=1;null!==r.get_child(u);){var c=u;a=i,i=r,r=r.get_child(u);var h=this._comparator(e,r.data);if(u=h>0,0===h&&(d=r),!o(r)&&!o(r.get_child(u)))if(o(r.get_child(!u))){var f=s(r,u);i.set_child(c,f),i=f}else if(!o(r.get_child(!u))){var m=i.get_child(!c);if(null!==m)if(o(m.get_child(!c))||o(m.get_child(c))){var v=a.right===i;o(m.get_child(c))?a.set_child(v,l(i,c)):o(m.get_child(!c))&&a.set_child(v,s(i,c));var g=a.get_child(v);g.red=!0,r.red=!0,g.left.red=!1,g.right.red=!1}else i.red=!1,m.red=!0,r.red=!0}}return null!==d&&(d.data=r.data,i.set_child(i.right===r,r.get_child(null===r.left)),this.size--),this._root=t.right,null!==this._root&&(this._root.red=!1),null!==d},e.exports=a},5301:e=>{function t(){}function r(e){this._tree=e,this._ancestors=[],this._cursor=null}t.prototype.clear=function(){this._root=null,this.size=0},t.prototype.find=function(e){for(var t=this._root;null!==t;){var r=this._comparator(e,t.data);if(0===r)return t.data;t=t.get_child(r>0)}return null},t.prototype.findIter=function(e){for(var t=this._root,r=this.iterator();null!==t;){var i=this._comparator(e,t.data);if(0===i)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(i>0)}return null},t.prototype.lowerBound=function(e){for(var t=this._root,r=this.iterator(),i=this._comparator;null!==t;){var n=i(e,t.data);if(0===n)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(n>0)}for(var a=r._ancestors.length-1;a>=0;--a)if(i(e,(t=r._ancestors[a]).data)<0)return r._cursor=t,r._ancestors.length=a,r;return r._ancestors.length=0,r},t.prototype.upperBound=function(e){for(var t=this.lowerBound(e),r=this._comparator;null!==t.data()&&0===r(t.data(),e);)t.next();return t},t.prototype.min=function(){var e=this._root;if(null===e)return null;for(;null!==e.left;)e=e.left;return e.data},t.prototype.max=function(){var e=this._root;if(null===e)return null;for(;null!==e.right;)e=e.right;return e.data},t.prototype.iterator=function(){return new r(this)},t.prototype.each=function(e){for(var t,r=this.iterator();null!==(t=r.next());)if(!1===e(t))return},t.prototype.reach=function(e){for(var t,r=this.iterator();null!==(t=r.prev());)if(!1===e(t))return},r.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},r.prototype.next=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._minNode(e)}else{var t;if(null===this._cursor.right)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===t);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},r.prototype.prev=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._maxNode(e)}else{var t;if(null===this._cursor.left)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===t);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},r.prototype._minNode=function(e){for(;null!==e.left;)this._ancestors.push(e),e=e.left;this._cursor=e},r.prototype._maxNode=function(e){for(;null!==e.right;)this._ancestors.push(e),e=e.right;this._cursor=e},e.exports=t},92618:(e,t,r)=>{"use strict";r.r(t);var i=r(77424);function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=[0,1],o=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._lowId=void 0===t?0:0|t,this._highId=void 0===r?4294967295:0|r,this._availableIds=new i.RBTree((function(e,t){return e[0]-t[0]})),this._availableIds.insert([this._lowId+(0|n),this._highId])}var t,r;return t=e,(r=[{key:"reserveId",value:function(){var e=this._availableIds.min();if(null!==e){var t=e[0];return t>=e[1]?this._availableIds.remove(e):++e[0],t}}},{key:"releaseId",value:function(e){if(e<this._lowId||e>this._highId)return!1;a[0]=e;var t=this._availableIds.lowerBound(a),r=t.data();if(null!==r){if(r[0]<=e&&r[1]>=e)return!1;t.prev();var i=t.data();e+1===r[0]?null===i||e-1>i[1]?r[0]=e:(this._availableIds.remove(r),this._availableIds.remove(i),r[0]=i[0],this._availableIds.insert(r)):null===i||e-1>i[1]?this._availableIds.insert([e,e]):i[1]=e}return!0}},{key:"isIdReserved",value:function(e){if(e<this._lowId||e>this._highId)return!1;a[0]=e;var t=this._availableIds.upperBound(a).prev();return!t||e<t[0]||e>t[1]}}])&&n(t.prototype,r),e}();function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}var u=Autodesk.Viewing,c=u.Private,h=new THREE.Matrix4,f=new THREE.Box3,m=new THREE.Vector3,v=new THREE.Vector3,g={svfid:0,boundingBox:new THREE.Box3},_={geometry:null,material:void 0,matrix:h,isLine:!1,isWideLine:!1,isPoint:!1},y=~(c.MeshFlags.MESH_ISLINE|c.MeshFlags.MESH_ISWIDELINE|c.MeshFlags.MESH_ISPOINT),I="__defaultMaterial__",p={type:"removed"},b=-1e9,x=-100,M=function(){function e(){var t,r;s(this,e),this.rootId=b,this.nodeIndices=new o(1),this.dbIdToIndex=(0,(r=b)in(t={})?Object.defineProperty(t,r,{value:0,enumerable:!0,configurable:!0,writable:!0}):t[r]=0,t),this._nodeCount=1,this._maxIndex=0,this._nodeFlags=[0],this._indexToFragId=[],this._rootName=u.i18n.translate("Root")}return d(e,[{key:"getIndex",value:function(e){return this.dbIdToIndex[e]}},{key:"getNumNodes",value:function(){return this._maxIndex+1}},{key:"getParentId",value:function(e){return e===this.rootId?void 0:this.rootId}},{key:"getNodeFlags",value:function(e){var t=this.dbIdToIndex[e];return t>=0?this._nodeFlags[t]:void 0}},{key:"setNodeFlags",value:function(e,t){var r=this.dbIdToIndex[e];void 0!==r&&(this._nodeFlags[r]=t)}},{key:"name",value:function(e,t){return e===this.rootId?t&&this._nodeCount>1?"".concat(this._rootName,"(").concat(this._nodeCount-1,")"):this._rootName:u.i18n.translate("Object %(nodeId)",{nodeId:e})}},{key:"getNodeBox",value:function(e,t){t.setEmpty()}},{key:"getNumChildren",value:function(e){return e==this.rootId?this._nodeCount-1:0}},{key:"getNumFragments",value:function(e){if(e===this.rootId)return 0;var t=this.dbIdToIndex[e];if(void 0===t)return 0;var r=this._indexToFragId[t];return Array.isArray(r)?r.length:1}},{key:"enumNodeFragments",value:function(e,t){if(e!==this.rootId){var r=this.dbIdToIndex[e];if(void 0!==r){var i=this._indexToFragId[r];if(Array.isArray(i))for(var n=0;n<i.length;++n)t(i[n],e,r);else t(i,e,r)}}}},{key:"enumNodeChildren",value:function(e,t){if(e===this.rootId)for(var r=Object.keys(this.dbIdToIndex),i=0;i<r.length;++i){var n=parseInt(r[i]);n!==this.rootId&&t(n,e,0)}}},{key:"addFragment",value:function(e,t){var r=this.dbIdToIndex[e];void 0===r&&(r=this.nodeIndices.reserveId(),this.dbIdToIndex[e]=r,this._nodeFlags[r]=0,++this._nodeCount,r>this._maxIndex&&(this._maxIndex=r));var i=this._indexToFragId[r];void 0===i?this._indexToFragId[r]=t:Array.isArray(i)?i.push(t):this._indexToFragId[r]=[i,t]}},{key:"removeFragment",value:function(e,t){var r=this.dbIdToIndex[e];if(void 0!==r){var i=this._indexToFragId[r];if(Array.isArray(i)){var n=i.indexOf(t);n>=0&&2===i.length?this._indexToFragId[r]=i[1-n]:i.splice(n,1)}else this.nodeIndices.releaseId(),delete this.dbIdToIndex[e],delete this._indexToFragId[r],--this._nodeCount}}}]),e}(),S=function(){function e(t){s(this,e),this.viewer3DImpl=t}return d(e,[{key:"loadFile",value:function(e,t,r,i){i&&i();var n,a=t.conserveMemory?1:0,o={bbox:(new THREE.Box3).set(t.globalOffset,t.globalOffset),fragments:{length:a,fragId2dbId:[0],transforms:a?new Float32Array(12*a):null,boxes:a?new Float32Array(6*a):null},is2d:!1,loadOptions:t||{},isSceneBuilder:!0,loadDone:!0,instanceTree:new c.InstanceTree(new M,0,1),metadata:{}},s=new u.Model(o);t&&t.modelNameOverride?(n=t.modelNameOverride,t.modelNameOverride=void 0):n=u.i18n.translate("Scene Builder %(modelId)",{modelId:s.getModelId()}),o.instanceTree.nodeAccess._rootName=n,o.urn=btoa(n),this.svf=o,s.initialize(),s.loader=this,this.model=s,s.getFragmentList().isFixedSize=!1,r(null,s),this.viewer3DImpl.api.dispatchEvent({type:u.MODEL_ROOT_LOADED_EVENT,svf:o,model:s}),this.viewer3DImpl.onLoadComplete(s)}},{key:"dtor",value:function(){}},{key:"is3d",value:function(){return!0}}]),e}();function O(e){return e instanceof THREE.Mesh?e.fragId:e}function B(e,t,r,i,n,a){var o=O(t),s=e.model,l=e.fragList;g.geometry=(void 0===r?e.fragList.getGeometryId(o):r instanceof THREE.BufferGeometry?r.svfid:r)||0,r=void 0===r?e.fragList.getGeometry(o):e._getGeometry(r);var d=void 0===i?e.fragList.getMaterial(o):e._getMaterial(i),u=!e.conserveMemory&&s.getFragmentList().getVizmesh(o);return u?u.dispatchEvent(p):u=_,u.material=d,o<l.vizflags.length&&(l.vizflags[o]&=~y),u.geometry=r,r?(u.isLine=r.isLines,u.isWideLine=r.isWideLines,u.isPoint=r.isPoints):(u.geometry=g,u.isLine=!1,u.isWideLine=!1,u.isPoint=!1),u.matrix=function(e,t){if(e)if(e instanceof THREE.Matrix4)t.copy(e);else{var r=t.elements;r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[3],r[5]=e[4],r[6]=e[5],r[7]=0,r[8]=e[6],r[9]=e[7],r[10]=e[8],r[11]=0,r[12]=e[9],r[13]=e[10],r[14]=e[11],r[15]=1}else t.identity();return t}(n,u===_?h:u.matrix),_.bbox=a&&(a instanceof THREE.Box3?a:f.set(m.fromArray(a,0),v.fromArray(a,3))),l.fragments.fragId2dbId[o]=x-o,e.instanceTree.nodeAccess.addFragment(x-o,o),s.setFragment(o,u,u!==_),l.useThreeMesh&&!r&&(l.getVizmesh(o).geometry=null),e.sceneUpdated(!0),!0}function E(e,t){return t.makeEmpty(),c.VertexEnumerator.enumMeshVertices(e,(function(e){t.expandByPoint(e)})),t}function N(e,t,r){r instanceof THREE.MeshPhongMaterial||r instanceof THREE.ShaderMaterial&&r.isPrismMaterial?e.addMaterial(t,r,!0):e.addMaterialNonHDR(t,r)}function w(e,t,r,i){var n=0|r[t];e=e||x-t,r[t]=e,e!==n&&(i.nodeAccess.removeFragment(n,t),i.nodeAccess.addFragment(e,t))}var R=function(){function e(t,r){s(this,e),this.model=t,this.geomList=t.getGeometryList(),this.fragList=t.getFragmentList(),this.geomIds=new o(1),this.fragmentIds=new o(Math.max(t.getData().fragments.length,1)),this.conserveMemory=!(!r||!r.conserveMemory),this.instanceTree=t.getData().instanceTree,this.instanceTree.setFragmentList(this.fragList),this.createWireframe=!(!r||!r.createWireframe)}return d(e,[{key:"isConservingMemory",value:function(){return this.conserveMemory}},{key:"addGeometry",value:function(e,t){if(e&&void 0!==e.svfid)return 0;var r=this.geomIds.reserveId();if(void 0===r)return 0;if(e){if(this.createWireframe){if(c.createWireframe(e),!e.attributes.indexlines){var i=new THREE.BufferAttribute(void 0,1);i.bytesPerItem=e.iblines instanceof Uint32Array?4:2,e.setAttribute("indexlines",i),e.iblinesbuffer=void 0}if(!e.index){for(var n=new Uint16Array(e.attributes.position.length/3),a=0;a<n.length;++a)n[a]=a;var o=new THREE.BufferAttribute(n,1);o.bytesPerItem=2,e.setAttribute("index",o)}}var s=e.boundingBox=e.boundingBox||E(e,this.conserveMemory?f:new THREE.Box3);this.geomList.addGeometry(this.packNormals(e),t,r),this.conserveMemory||(e.boundingBox=s)}return r}},{key:"_updateGeometry",value:function(e,t){var r=this.fragList,i=!1;if(this.conserveMemory)for(var n=r.geomids,a=0;a<n.length;++a)e[n[a]]&&(this.changeFragmentGeometry(a,t),i=!0);else for(var o=r.vizmeshes,s=0;s<o.length;++s){var l=o[s];l&&l.geometry&&e[l.geometry.svfid]&&(this.changeFragmentGeometry(s,t),i=!0)}i&&this.sceneUpdated(!0)}},{key:"_validateGeometry",value:function(e){Array.isArray(e)||(e=[e]);for(var t={},r=this.geomList,i=0;i<e.length;++i){var n=e[i];if(n instanceof THREE.BufferGeometry){if(r.getGeometry(n.svfid)!=n)return null;n=n.svfid}if(!this.geomIds.isIdReserved(n))return null;t[n]=!0}return t}},{key:"changeGeometry",value:function(e,t,r){var i=this._validateGeometry(e);if(!i)return!1;var n=parseInt(Object.keys(i)[0]),a=this.geomList;if(!t||t&&void 0!==t.svfid)return!1;var o=a.getGeometry(n);if(a.removeGeometry(n),void 0===r){r=0;var s=this.fragList;if(s.useThreeMesh){if(o)for(var l=s.vizmeshes,d=0;d<l.length;++d)l[d]&&l[d].geometry===o&&++r}else for(var u=s.geomids,c=0;c<u.length;++c)u[c]===n&&++r;r=r||1}var h=t.boundingBox=t.boundingBox||E(t,this.conserveMemory?f:new THREE.Box3);return a.addGeometry(this.packNormals(t),r,n),this.conserveMemory||(t.boundingBox=h),this._updateGeometry(i,n),o&&(o.svfid=void 0),!0}},{key:"findGeometryFragments",value:function(e){var t=this._validateGeometry(e),r=[],i=this.fragList;if(i.useThreeMesh)for(var n=i.vizmeshes,a=0;a<n.length;++a)t[n[a]&&n[a].geometry&&n[a].geometry.svfid]&&r.push(a);else for(var o=i.geomids,s=0;s<o.length;++s)t[o[s]]&&r.push(s);return r}},{key:"removeGeometry",value:function(e){var t=this._validateGeometry(e);if(!t)return!1;var r=this.geomList;this._updateGeometry(t,0);for(var i=Object.keys(t),n=0;n<i.length;++n){var a=parseInt(i[n]),o=r.getGeometry(a);o&&(o.svfid=void 0),r.removeGeometry(a),this.geomIds.releaseId(a)}return!0}},{key:"addMaterial",value:function(e,t){if(!t||t.materialManagerName)return!1;e=e||"!!mtl-"+t.id;var r=this.model.loader.viewer3DImpl.matman(),i=r._getMaterialHash(this.model,e);return e!==I&&!r._materials[i]&&!r._materialsNonHDR[i]&&(t.packedNormals||(t.packedNormals=!0,t.needsUpdate=!0),N(r,i,t),t.materialManagerName=e,!0)}},{key:"_validateMaterials",value:function(e){Array.isArray(e)||(e=[e]);for(var t=this.model.loader.viewer3DImpl.matman(),r=[],i=0;i<e.length;++i){var n=e[i],a=void 0,o=void 0;if(n instanceof THREE.Material){if(a=n,n=n.materialManagerName,o=t._getMaterialHash(this.model,n),a!==(t._materials[o]||t._materialsNonHDR[o]))return null}else if(o=t._getMaterialHash(this.model,n),!t._materials[o]&&!t._materialsNonHDR[o])return null;r.push(o)}return r}},{key:"changeMaterial",value:function(e,t){if(!t||t.materialManagerName)return!1;var r=this._validateMaterials(e);if(!r)return!1;var i=this.model.loader.viewer3DImpl.matman(),n=r[0],a=i._materials[n]||i._materialsNonHDR[n],o=a.materialManagerName;t.packedNormals||(t.packedNormals=!0,t.needsUpdate=!0),N(i,n,t),a.materialManagerName=void 0,t.materialManagerName=o;var s=this.fragList;if(s.useThreeMesh)for(var l=s.vizmeshes,d=0;d<l.length;++d)l[d]&&l[d].material===a&&(l[d].material=t);else{var u=s.materialmap[a.id];void 0!==u&&(s.materialmap[t.id]=u,s.materialIdMap[u]=t)}return!0}},{key:"findMaterial",value:function(e){var t=this.model.loader.viewer3DImpl.matman(),r=t._getMaterialHash(this.model,e);return t._materials[r]||t._materialsNonHDR[r]}},{key:"findMaterialFragments",value:function(e){var t=this._validateMaterials(e);if(!t)return null;for(var r=this.model.loader.viewer3DImpl.matman(),i=this.fragList,n=i.useThreeMesh,a=!1,o={},s=0;s<t.length;++s){var l=r._materials[t[s]]||r._materialsNonHDR[t[s]],d=n?l.id:i.materialmap[l.id];void 0!==d&&(o[d]=!0,a=!0)}var u=[];if(a)if(n)for(var c=i.vizmeshes,h=c.length,f=0;f<h;++f)o[c[f]&&c[f].material&&c[f].material.id]&&u.push(f);else for(var m=i.materialids,v=m.length,g=0;g<v;++g)o[m[g]]&&u.push(g);return u}},{key:"removeMaterial",value:function(e){var t=this._validateMaterials(e);if(!t)return!1;for(var r=this.model.loader.viewer3DImpl.matman(),i=this.fragList,n=i.useThreeMesh,a={},o=!1,s=0;s<t.length;++s){var l=r._materials[t[s]]||r._materialsNonHDR[t[s]];if(delete r._materials[t[s]],delete r._materialsNonHDR[t[s]],n)a[l.id]=!0,o=!0;else{var d=i.materialmap[l.id];void 0!==d&&(delete i.materialmap[l.id],delete i.materialIdMap[d],a[d]=!0,o=!0)}}if(o)if(n)for(var u=i.vizmeshes,c=0;c<u.length;++c)a[u[c]&&u[c].material&&u[c].material.id]&&i.setMaterial(c,this._getDefaultMaterial());else for(var h=i.materialids,f=0;f<h.length;++f)a[h[f]]&&i.setMaterial(f,this._getDefaultMaterial());return!0}},{key:"addMesh",value:function(e){if(!e||this.conserveMemory||void 0!==e.modelId||void 0!==e.fragId)return!1;if(!e.geometry||!e.material)return!1;var t=e.geometry.svfid;if(t){if(this.geomList.getGeometry(t)!==e.geometry)return!1}else if(!this.addGeometry(e.geometry))return!1;var r=e.material.materialManagerName;if(r){if(this.findMaterial(r)!==e.material)return!1}else if(!this.addMaterial(void 0,e.material))return t&&this.removeGeometry(t),!1;var i=this.fragmentIds.reserveId();return e.dbId=e.dbId||x-i,this.model.setFragment(i,e,!0),this.fragList.fragments.fragId2dbId[i]=e.dbId,this.instanceTree.nodeAccess.addFragment(e.dbId,i),this.sceneUpdated(!0),!0}},{key:"removeMesh",value:function(e){return!this.conserveMemory&&this.removeFragment(e)}},{key:"updateMesh",value:function(e,t,r){if(t&&r)return!0;Array.isArray(e)||(e=[e]);for(var i,n=0;!(i=e[n]);)if(++n>=e.length)return!0;do{i&&(t||(this.packNormals(i.geometry),i.dispatchEvent(p)),r||i.matrixWorld.copy(i.matrix)),i=e[++n]}while(n<e.length);return this.sceneUpdated(!(t&&r)),!0}},{key:"sceneUpdated",value:function(e,t){this.model.loader.viewer3DImpl.sceneUpdated(e,t)}},{key:"_validateFragment",value:function(e,t,r){if(e instanceof THREE.Mesh){if(!this.fragList.useThreeMesh||this.fragList.getVizmesh(e.fragId)!==e)return!1}else if(!this.fragmentIds.isIdReserved(e))return!1;if(t)if(t instanceof THREE.BufferGeometry){if(t.svfid&&this.geomList.getGeometry(t.svfid)!==t)return!1}else if(!this.geomIds.isIdReserved(t))return!1;if(r)if(r instanceof THREE.Material){if(r.materialManagerName&&this.findMaterial(r.materialManagerName)!==r)return!1}else if(!this.findMaterial(r))return!1;return!0}},{key:"_getGeometry",value:function(e){return e instanceof THREE.BufferGeometry?(e.svfid||this.addGeometry(e),e):this.geomList.getGeometry(e)}},{key:"_getMaterial",value:function(e){return e instanceof THREE.Material?(e.materialManagerName||this.addMaterial(void 0,e),e):this.findMaterial(e)}},{key:"addFragment",value:function(e,t,r,i){var n=this.fragmentIds,a=n.reserveId();return void 0!==a&&this._validateFragment(a,e,t)?B(this,a,e,t,r,i)?a:(n.releaseId(a),0):0}},{key:"changeFragmentGeometry",value:function(e,t,r,i){if(!this._validateFragment(e,t))return!1;var n=O(e);return!!B(this,e,t,void 0,r=r||(this.fragList.getOriginalWorldMatrix(n,h),h),i)}},{key:"_getDefaultMaterial",value:function(){if(this._defaultMaterial)return this._defaultMaterial;var e=this.model.loader.viewer3DImpl.matman(),t=e.defaultMaterial.clone();return t.packedNormals=!0,t.needsUpdate=!0,e.addMaterial(e._getMaterialHash(this.model,I),t),this._defaultMaterial=t,t.materialManagerName=I,t}},{key:"changeFragmentMaterial",value:function(e,t){if(!this._validateFragment(e,void 0,t))return!1;var r=this._getMaterial(t)||this._getDefaultMaterial();return this.fragList.setMaterial(O(e),r),this.sceneUpdated(!1),!0}},{key:"changeFragmentTransform",value:function(e,t,r){if(!t||!this._validateFragment(e))return!1;var i=O(e);return!!this.changeFragmentGeometry(i,this.fragList.getGeometryId(i),t,r)&&(this.sceneUpdated(!0),!0)}},{key:"changeFragmentsDbId",value:function(e,t){Array.isArray(e)||(e=[e]),t|=0;for(var r=0;r<e.length;++r)if(!this._validateFragment(e[r]))return!1;var i=this.fragList.fragments,n=this.instanceTree,a=i.fragId2dbId;if(this.conserveMemory)for(var o=0;o<e.length;++o)w(t,O(e[o]),a,n);else for(var s=this.fragList.vizmeshes,l=0;l<e.length;++l){var d=O(e[l]);w(t,d,a,n),s[d].dbId=t}return!0}},{key:"removeFragment",value:function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)if(!this._validateFragment(e[t]))return!1;for(var r=this.fragList.fragments,i=this.instanceTree,n=this.conserveMemory?this.fragList.geomids:this.fragList.vizmeshes,a=this.conserveMemory?0:null,o=0;o<e.length;++o){var s=O(e[o]);this.fragmentIds.releaseId(s),i.nodeAccess.removeFragment(r.fragId2dbId[s],s),r.fragId2dbId[s]=0,!this.conserveMemory&&n[s]&&(n[s].dispatchEvent(p),n[s].fragId=n[s].modelId=void 0),n[s]=a}return this.sceneUpdated(!0),!0}},{key:"packNormals",value:function(e){var t=e.attributes,r=t.normal;if(!r||3!==r.itemSize)return e;function i(e,t,r,i,n,a){for(var o=Math.atan2,s=1/Math.PI;t<e.length;t+=r,n+=a){var l=.5*(o(e[t+1],e[t])*s+1),d=.5*(e[t+2]+1);i[n]=65535*l|0,i[n+1]=65535*d|0}}if(r.array){var n=Math.floor(r.length/r.itemSize),a=new Uint16Array(2*n);i(r.array,0,3,a,0,2),r.itemSize=2,r.array=a,r.normalized=!0,r.needsUpdate=!0,r.bytesPerItem=2}else{var o=e.vbstride,s=e.vb,l=Math.floor(s.length/o),d=new Float32Array((o-2)*l),u=r.itemOffset;if(u<=0||u+3>=o)for(var h=u<=0?3:0,f=u<=0?1:0,m=o-3,v=0;v<l;++v,h+=3,f+=1)for(var g=0;g<m;++g)d[f++]=s[h++];else for(var _=0,y=0,I=u,p=o-u-3,b=0;b<l;++b){for(var x=0;x<I;++x)d[y++]=s[_++];_+=3,y+=1;for(var M=0;M<p;++M)d[y++]=s[_++]}i(s,u,o,new Uint16Array(d.buffer),2*u,2*(o-2)),e.vbstride-=2,e.vb=d,e.vbNeedsUpdate=!0,t.normal=c.BufferGeometryUtils.findBufferAttribute("normal",{array:null,bytesPerItem:2,itemSize:2,normalize:!0,isPattern:r.isPattern,divisor:r.divisor,offset:r.itemOffset},e.numInstances);for(var S=Object.keys(t),O=0;O<S.length;++O){var B=t[S[O]];!B.array&&B.itemOffset>u&&(t[S[O]]=c.BufferGeometryUtils.findBufferAttribute(S[O],{array:null,bytesPerItem:B.bytesPerItem,itemSize:B.itemSize,normalized:B.normalized,isPattern:B.isPattern,divisor:B.divisor,offset:B.itemOffset-2},e.numInstances))}}return e}}],[{key:"addNewModel",value:function(t,r){return new Promise((function(i,n){var a=Object.assign({},r);a.fileLoader=S,a.globalOffset=a.globalOffset||{x:0,y:0,z:0},t.viewer.loadModel("Dummy",a,(function(t){i(new e(t,a))}),(function(e){n(e)}))}))}}]),e}(),k={en:JSON.parse('{"@@locale":"en","@@context":"SceneBuilder Extension","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Root","Object %(nodeId)":"Object %(nodeId)"}'),"en-GB":JSON.parse('{"@@locale":"en","@@context":"SceneBuilder Extension","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Root","Object %(nodeId)":"Object %(nodeId)"}'),cs:JSON.parse('{"@@locale":"cs","@@context":"Rozšíření SceneBuilder","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Kořen","Object %(nodeId)":"Object %(nodeId)"}'),de:JSON.parse('{"@@locale":"de","@@context":"SceneBuilder-Erweiterung","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Stammverzeichnis","Object %(nodeId)":"Object %(nodeId)"}'),es:JSON.parse('{"@@locale":"es","@@context":"Extensión SceneBuilder","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Raíz","Object %(nodeId)":"Object %(nodeId)"}'),fr:JSON.parse('{"@@locale":"fr","@@context":"Extension SceneBuilder","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Racine","Object %(nodeId)":"Object %(nodeId)"}'),"fr-CA":JSON.parse('{"@@locale":"fr-CA","@@context":"Extension SceneBuilder (générateur de scène)","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Racine","Object %(nodeId)":"Object %(nodeId)"}'),it:JSON.parse('{"@@locale":"it","@@context":"Estensione SceneBuilder","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Radice","Object %(nodeId)":"Object %(nodeId)"}'),ja:JSON.parse('{"@@locale":"ja","@@context":"SceneBuilder Extension","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"ルート","Object %(nodeId)":"Object %(nodeId)"}'),ko:JSON.parse('{"@@locale":"ko","@@context":"SceneBuilder 확장","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"루트","Object %(nodeId)":"Object %(nodeId)"}'),pl:JSON.parse('{"@@locale":"pl","@@context":"Rozszerzenie SceneBuilder","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Katalog główny","Object %(nodeId)":"Object %(nodeId)"}'),"pt-BR":JSON.parse('{"@@locale":"pt","@@context":"Extensão SceneBuilder","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Raiz","Object %(nodeId)":"Object %(nodeId)"}'),ru:JSON.parse('{"@@locale":"ru","@@context":"Расширение SceneBuilder","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Корневая папка","Object %(nodeId)":"Object %(nodeId)"}'),tr:JSON.parse('{"@@locale":"tr","@@context":"SceneBuilder Uzantısı","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Kök","Object %(nodeId)":"Object %(nodeId)"}'),"zh-HANS":JSON.parse('{"@@locale":"zh-Hans","@@context":"场景生成器扩展","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"根","Object %(nodeId)":"Object %(nodeId)"}'),"zh-HANT":JSON.parse('{"@@locale":"zh-Hant","@@context":"場景建置器延伸","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"根","Object %(nodeId)":"Object %(nodeId)"}'),"zh-HK":JSON.parse('{"@@locale":"zh-hk","@@context":"場景建置器擴充功能","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"根","Object %(nodeId)":"Object %(nodeId)"}'),nl:JSON.parse('{"@@locale":"nl","@@context":"SceneBuilder Extension","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Root","Object %(nodeId)":"Object %(nodeId)"}'),sv:JSON.parse('{"@@locale":"sv","@@context":"SceneBuilder-tillägg","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Rot","Object %(nodeId)":"Object %(nodeId)"}'),da:JSON.parse('{"@@locale":"da","@@context":"SceneBuilder-udvidelse","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Rod","Object %(nodeId)":"Object %(nodeId)"}'),no:JSON.parse('{"@@locale":"no","@@context":"SceneBuilder-utvidelse","Scene Builder %(modelId)":"Scene Builder %(modelId)","Root":"Rot","Object %(nodeId)":"Object %(nodeId)"}')};function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function j(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function F(e,t){return F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},F(e,t)}function L(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}var A=Autodesk.Viewing,H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(o,e);var t,r,i,n,a=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(i);if(n){var r=z(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return L(this,e)});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=a.call(this,e,t))._loaded=!1,r.extendLocalization(k),r}return t=o,(r=[{key:"load",value:function(){return this._loaded=!0,!0}},{key:"unload",value:function(){return this._loaded=!1,!0}},{key:"addNewModel",value:function(e){return this._loaded?R.addNewModel(this,Object.assign({},this.options,e)):Promise.reject(new Error("SceneBuilder extension not loaded"))}}])&&j(t.prototype,r),o}(A.Extension);A.theExtensionManager.registerExtension("Autodesk.Viewing.SceneBuilder",H)}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,r),a.exports}r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i=r(92618);Autodesk.Extensions.SceneBuilder=i})();
//# sourceMappingURL=SceneBuilder.min.js.map