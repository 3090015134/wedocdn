/*! For license information please see Minimap2D.min.js.LICENSE.txt */
(()=>{var e={660:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(87537),a=n.n(i),o=n(23645),s=n.n(o)()(a());s.push([e.id,".minimap-canvas-container{position:relative;margin:15px 5px 10px 5px}.minimap-canvas-base{position:absolute;left:0px;top:0px}.minimap-unavailable{color:#dbdbdb;margin:10px;text-align:center}\n","",{version:3,sources:["webpack://./extensions/Minimap2D/MinimapStyle.css"],names:[],mappings:"AAAA,0BACI,iBAAkB,CAClB,wBAAyB,CAC5B,qBAGG,iBAAkB,CAClB,QAAS,CACT,OAAQ,CACX,qBAWG,aAAc,CACd,WAAY,CACZ,iBAAkB",sourcesContent:[".minimap-canvas-container {\n    position: relative;\n    margin: 15px 5px 10px 5px;\n}\n\n.minimap-canvas-base {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n}\n\n.minimap-canvas-background {\n    /*z-index: 100;*/\n}\n\n.minimap-canvas-highlight {\n    /*z-index: 101;*/\n}\n\n.minimap-unavailable {\n    color: #dbdbdb;\n    margin: 10px;\n    text-align: center;\n}\n"],sourceRoot:""}]);const r=s},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var r=0;r<this.length;r++){var u=this[r][0];null!=u&&(s[u]=!0)}for(var c=0;c<e.length;c++){var l=[].concat(e[c]);i&&s[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),a&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=a):l[4]="".concat(a)),t.push(l))}},t}},87537:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(a," */"),s=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(s).concat([o]).join("\n")}return[t].join("\n")}},93379:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},s=[],r=0;r<e.length;r++){var u=e[r],c=i.base?u[0]+i.base:u[0],l=o[c]||0,h="".concat(c," ").concat(l);o[c]=l+1;var m=n(h),d={css:u[1],media:u[2],sourceMap:u[3]};-1!==m?(t[m].references++,t[m].updater(d)):t.push({identifier:h,updater:a(d,i),references:1}),s.push(h)}return s}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var o=i(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var r=n(o[s]);t[r].references--}for(var u=i(e,a),c=0;c<o.length;c++){var l=n(o[c]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=u}}},90569:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i=n.css,a=n.media,o=n.sourceMap;a?e.setAttribute("media",a):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={id:i,exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";n.r(i),n.d(i,{default:()=>X});var e={small:100,medium:200,large:400},t=n(93379),a=n.n(t),o=n(7795),s=n.n(o),r=n(90569),u=n.n(r),c=n(3565),l=n.n(c),h=n(19216),m=n.n(h),d=n(44589),v=n.n(d),p=n(660),f={};function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function C(e,t){return C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},C(e,t)}function w(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}f.styleTagTransform=v(),f.setAttributes=l(),f.insert=u().bind(null,"head"),f.domAPI=s(),f.insertStyleElement=m(),a()(p.Z,f),p.Z&&p.Z.locals&&p.Z.locals;var M=Autodesk.Viewing,x=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(r,Autodesk.Viewing.EventDispatcher);var n,i,a,o,s=(a=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(a);if(o){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function r(t,n,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"large";y(this,r),(a=s.call(this)).minimapSize=e[o];var u=Math.max(n,i);return a.widthFactor=n/u,a.heightFactor=i/u,a._initBackground(),a._initHighlight(),a._initContainer(),a.backgroundImgs=t,a.backgroundImg=new Image,a}return n=r,(i=[{key:"_initContainer",value:function(){var e=this.getDocument();this.canvasContainer=e.createElement("div"),this.canvasContainer.className="minimap-canvas-container",this.canvasContainer.appendChild(this.backgroundCanvas),this.canvasContainer.appendChild(this.highlightCanvas),this._updateCanvasContainerSize()}},{key:"_updateCanvasContainerSize",value:function(){this.canvasContainer.style.width=this.backgroundCanvas.width+"px",this.canvasContainer.style.height=this.backgroundCanvas.height+"px"}},{key:"_initBackground",value:function(){var e=this.getDocument();this.backgroundCanvas=e.createElement("canvas"),this.backgroundCanvas.className="minimap-canvas-base minimap-canvas-background"}},{key:"_initHighlight",value:function(){var e=this.getDocument();this.highlightCanvas=e.createElement("canvas"),this.highlightCanvas.className="minimap-canvas-base minimap-canvas-highlight"}},{key:"setSize",value:function(t){var n=this;return t="string"==typeof t?e[t]:t,new Promise((function(i,a){n.backgroundCanvas.width=n.highlightCanvas.width=Math.round(t*n.widthFactor),n.backgroundCanvas.height=n.highlightCanvas.height=Math.round(t*n.heightFactor),n._updateCanvasContainerSize();var o=Number.MAX_VALUE,s="large";for(var r in e)t<=e[r]&&e[r]<o&&Object.prototype.hasOwnProperty.call(n.backgroundImgs,r)&&(s=r,o=e[r]);n.setBackground(s).then((function(){n.drawBackground(),i()})),n.minimapSize=t}))}},{key:"setBackground",value:function(e){var t=this;return new Promise((function(n,i){Object.prototype.hasOwnProperty.call(t.backgroundImgs,e)?t.backgroundImg.src!==t.backgroundImgs[e]?(t.backgroundImg.onload=function(){t.setBackgroundSourceSize(e),n()},t.backgroundImg.src=t.backgroundImgs[e]):n():i("thumbnail size not found")}))}},{key:"setBackgroundSourceSize",value:function(t){var n=e[t];this.backgroundWidth=Math.round(n*this.widthFactor),this.backgroundHeight=Math.round(n*this.heightFactor),this.backgroundOffsetX=(n-this.backgroundWidth)/2,this.backgroundOffsetY=(n-this.backgroundHeight)/2}},{key:"drawBackground",value:function(){var e=this.backgroundCanvas.getContext("2d");e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e.drawImage(this.backgroundImg,this.backgroundOffsetX,this.backgroundOffsetY,this.backgroundWidth,this.backgroundHeight,0,0,this.backgroundCanvas.width,this.backgroundCanvas.height)}},{key:"drawHighlight",value:function(e,t){var n={x:Math.round(e.x),y:Math.round(t.y)},i=Math.round(Math.max(t.x-e.x,2)),a=Math.round(Math.max(e.y-t.y,2)),o=this.highlightCanvas.getContext("2d");o.clearRect(0,0,this.highlightCanvas.width,this.highlightCanvas.height),o.beginPath(),o.lineWidth="2",o.strokeStyle="#CC3B3B",o.fillStyle="rgba(204, 59, 59, 0.2)",o.rect(n.x,n.y,i,a),o.fill(),o.stroke()}},{key:"setVisibility",value:function(e){this.backgroundCanvas.style.visibility=e?"visible":"hidden",this.highlightCanvas.style.visibility=e?"visible":"hidden"}},{key:"addListenerToCanvas",value:function(e,t){this.highlightCanvas.addEventListener(e,t)}},{key:"removeListenerFromCanvas",value:function(e,t){this.highlightCanvas.removeEventListener(e,t)}},{key:"getBoundingClientRect",value:function(){return this.highlightCanvas.getBoundingClientRect()}},{key:"unload",value:function(){var e=this.getWindow(),t=e.URL||e.webkitURL;for(var n in this.backgroundImg=null,this.backgroundImgs)t.revokeObjectURL(this.backgroundImgs[n])}},{key:"width",get:function(){return this.highlightCanvas.width}},{key:"height",get:function(){return this.highlightCanvas.height}}])&&b(n.prototype,i),r}();function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e,t,n){return A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}},A(e,t,n||e)}function P(e,t){return P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},P(e,t)}function _(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}M.GlobalManagerMixin.call(x.prototype);var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(s,Autodesk.Viewing.UI.DockingPanel);var t,n,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(i);if(a){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return _(this,e)});function s(e,t,n,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(a=o.call(this,e,"MinimapPanel","Minimap",i)).container.style.left=t+"px",a.container.style.top=n+"px",a.container.classList.add("docking-panel-container-solid-color-b"),a.fadeIn="opacity 0.5s",a.fadeOut="opacity 0.1s",a.container.addEventListener("transitionend",(function(e){"0"===a.container.style.opacity&&(a.container.style.display="none")})),a}return t=s,(n=[{key:"_addNoMinimapElem",value:function(){var e=this.getDocument();this.noMinimapDiv=e.createElement("div"),this.noMinimapDiv.innerHTML=Autodesk.Viewing.i18n.translate("Minimap not available"),this.noMinimapDiv.className="minimap-unavailable",this.container.appendChild(this.noMinimapDiv)}},{key:"_removeNoMinimapElem",value:function(){this.container.contains(this.noMinimapDiv)&&this.container.removeChild(this.noMinimapDiv)}},{key:"initialize",value:function(){A(T(s.prototype),"initialize",this).call(this),this._addNoMinimapElem()}},{key:"appendElement",value:function(e){this._removeNoMinimapElem(),this.container.appendChild(e)}},{key:"addListenerToCloseButton",value:function(e){this.addEventListener(this.closer,"click",e,!1)}},{key:"_triggerReflow",value:function(){return this.container.offsetWidth}},{key:"_isVisible",value:function(){return"block"===this.container.style.display}},{key:"setVisible",value:function(e,t){t?this.setVisibleWithTransition(e):(this.container.style.display=e?"block":"none",this.container.style.opacity=e?"1":"0")}},{key:"setVisibleWithTransition",value:function(e){if(e){var t=this._isVisible();this.container.style.transition=this.fadeIn,this.container.style.display="block",t||(this.container.style.opacity="0",this._triggerReflow()),this.container.style.opacity="1"}else this.container.style.transition=this.fadeOut,this.container.style.opacity="0"}}])&&S(t.prototype,n),s}(),L={isThumbnailValid:function(e){return L.getPredominantColorPercentage(e)<L.MAX_PREDOMINANT_COLOR_PERCENTAGE},getPredominantColorPercentage:function(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height).data,n={},i=0,a=t.length;i<a;i+=4){var o=L.rgba2hex(t[i],t[i+1],t[i+2],t[i+3]);n[o]=Object.prototype.hasOwnProperty.call(n,o)?n[o]+1:1}return Object.keys(n).reduce((function(e,t){return n[t]>e?n[t]:e}),0)/(t.length/4)},rgba2hex:function(e,t,n,i){if(e>255||t>255||n>255||i>255)throw"Invalid color component";return(256+e).toString(16).substr(1)+((1<<24)+(t<<16)|n<<8|i).toString(16).substr(1)},MAX_PREDOMINANT_COLOR_PERCENTAGE:.97};const D=L;function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function R(e,t,n,i,a,o,s){try{var r=e[o](s),u=r.value}catch(e){return void n(e)}r.done?t(u):Promise.resolve(u).then(i,a)}function B(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){R(o,i,a,s,r,"next",e)}function r(e){R(o,i,a,s,r,"throw",e)}s(void 0)}))}}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function N(e,t){return N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},N(e,t)}function z(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?W(e):t}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}var F=AutodeskNamespace("Autodesk.BIM360.Minimap"),H="showMinimap2D",X=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(c,Autodesk.Viewing.Extension);var n,i,a,o,s,r,u=(s=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(s);if(r){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return z(this,e)});function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return V(this,c),(t=u.call(this,e,n))._isEnabled=!1,t.isMobile=Autodesk.Viewing.isMobileDevice(),t.initialSize=t.options.initialSize||null,t.wasInit=!1,t.onMouseDown=t.onMouseDown.bind(W(t)),t.onMouseMove=t.onMouseMove.bind(W(t)),t.onMouseUp=t.onMouseUp.bind(W(t)),t.onMouseLeave=t.onMouseLeave.bind(W(t)),t.onMouseWheel=t.onMouseWheel.bind(W(t)),t.onCameraChange=t.onCameraChange.bind(W(t),!0),t.update=t.update.bind(W(t)),t.onCloseButton=t.onCloseButton.bind(W(t)),t.setEnabled=t.setEnabled.bind(W(t)),t.updateSettingsPanel=t.updateSettingsPanel.bind(W(t)),t}return n=c,i=[{key:"setEnabled",value:(o=B(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}if(this.wasInit){e.next=4;break}return e.next=4,this.init();case 4:this._isEnabled=!0,this.onCameraChange(!1),e.next=10;break;case 8:this._isEnabled=!1,this._setVisibility(!1,!1);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"findAndSetSuitableModel",value:function(){var e=this.viewer.impl.modelQueue().getModels();if(1===e.length&&e[0].is2d()){var t=e[0],n=t.getDocumentNode(),i=n&&n.getDocument();if(i)return this.model=t,this.node=n,this.document=i,!0}return!1}},{key:"createPanel",value:function(){this.panel||(this.panel=new O(this.viewer.container,10,10,{isMobile:this.isMobile,addFooter:!1}),this.panel.setGlobalManager(this.globalManager))}},{key:"createMinimapCanvas",value:function(){this.minimapCanvas?this.minimapCanvas.backgroundImgs=this.backgroundImgs:(this.minimapCanvas=new x(this.backgroundImgs||{},this.modelWidth,this.modelHeight),this.minimapCanvas.setGlobalManager(this.globalManager))}},{key:"setBoundariesFromModel",value:function(){this.modelBBox=this.model.getBoundingBox().clone(),this.modelStartPoint=this.modelBBox.min,this.modelWidth=this.modelBBox.max.x-this.modelBBox.min.x,this.modelHeight=this.modelBBox.max.y-this.modelBBox.min.y,this.epsX=.02*this.modelWidth,this.epsY=.02*this.modelHeight}},{key:"init",value:(a=B(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mouseDown=!1,this.mouseDownPos={x:null,y:null},this.isTransitionInactive=!0,this.model){e.next=5;break}return e.abrupt("return");case 5:return this.createPanel(),this.setBoundariesFromModel(),this.wasInit=!0,t=this.model,e.prev=9,e.next=12,this.prefetchThumbnails(["large"]);case 12:if(t===this.model){e.next=14;break}throw new Error("loadCanceled");case 14:return this.createMinimapCanvas(),e.next=17,this.minimapCanvas.setSize(this.getInitialSize());case 17:if(t===this.model){e.next=19;break}throw new Error("loadCanceled");case 19:n=this.model.getData(),this.model.isLeaflet()||"rvt"===n.loadOptions.fileExt||D.isThumbnailValid(this.minimapCanvas.backgroundCanvas)?this.panel.appendElement(this.minimapCanvas.canvasContainer):console.error("Invalid thumbnail!"),this.addListeners(),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(9),console.info("Minimap error: ",e.t0.message),this.minimapCanvas||"loadCanceled"===e.t0.message||(this.createMinimapCanvas(),this.addListeners());case 29:case"end":return e.stop()}}),e,this,[[9,25]])}))),function(){return a.apply(this,arguments)})},{key:"getInitialSize",value:function(){return null!==this.initialSize?Math.min(Math.max(this.initialSize,100),400):this.isMobile?200:300}},{key:"setSize",value:function(e){this.minimapCanvas?(e=Math.min(Math.max(e,100),400),this.minimapCanvas.setSize(e)):this.initialSize=e}},{key:"prefetchThumbnails",value:function(t){var n=this;this.backgroundImgs={};var i=t.map((function(t){return function(t,n,i,a){return new Promise((function(o,s){var r="string"==typeof i?e[i]:i,u=t.getThumbnailOptions(n.data,r,r);Autodesk.Viewing.Document.requestThumbnailWithSecurity(u,(function(e,t){if(e)s("Error requesting thumbnail");else{var n=window.URL||window.webkitURL;a[i]=n.createObjectURL(t),o()}}))}))}(n.document,n.node,t,n.backgroundImgs)}));return Promise.all(i)}},{key:"_isTouch",value:function(){return Autodesk.Viewing.isTouchDevice()}},{key:"addListeners",value:function(){this._isTouch()&&(this.minimapCanvas.addListenerToCanvas("touchstart",this.onMouseDown),this.minimapCanvas.addListenerToCanvas("touchmove",this.onMouseMove),this.minimapCanvas.addListenerToCanvas("touchend",this.onMouseUp)),this.isMobile||(this.minimapCanvas.addListenerToCanvas("mousedown",this.onMouseDown),this.minimapCanvas.addListenerToCanvas("mousemove",this.onMouseMove),this.minimapCanvas.addListenerToCanvas("mouseup",this.onMouseUp),this.minimapCanvas.addListenerToCanvas("mouseleave",this.onMouseLeave),this.minimapCanvas.addListenerToCanvas("mousewheel",this.onMouseWheel),this.minimapCanvas.addListenerToCanvas("DOMMouseScroll",this.onMouseWheel)),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.panel.addListenerToCloseButton(this.onCloseButton)}},{key:"onCloseButton",value:function(){this.viewer.prefs.set(H,!1),this.setEnabled(!1)}},{key:"getCursorPositionOnCanvas",value:function(e){var t=this.minimapCanvas.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}},{key:"onMouseDown",value:function(e){"touchstart"===e.type&&(e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY),this.mouseDown=!0,this.mouseDownPos.x=e.clientX,this.mouseDownPos.y=e.clientY,this.onMinimapClicked(e,!1),this.isTransitionInactive=!1}},{key:"onMouseMove",value:function(e){this.mouseDown&&("touchmove"===e.type&&(e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY),(this.isTransitionInactive||Math.abs(this.mouseDownPos.x-e.clientX)>5||Math.abs(this.mouseDownPos.y-e.clientY)>5)&&(void 0!==this.viewer.autocam.elapsedTime&&(this.viewer.autocam.elapsedTime=this.viewer.autocam.shotParams.duration,this.isTransitionInactive=!0),this.onMinimapClicked(e,!0)))}},{key:"onMouseWheel",value:function(e){this.viewer.toolController.mousewheel(e)}},{key:"onMouseUp",value:function(){this.resetMove()}},{key:"onMouseLeave",value:function(){this.resetMove()}},{key:"resetMove",value:function(){this.mouseDown=!1,this.mouseDownPos.x=null,this.mouseDownPos.y=null}},{key:"onMinimapClicked",value:function(e,t){var n=this.minimapToModelCoords(this.getCursorPositionOnCanvas(e)),i=this.viewer.navigation.getTarget(),a=this.viewer.navigation.getPosition(),o=i.clone().sub(a),s=new THREE.Vector3(n.x,n.y,a.z),r=s.clone().add(o);t?this.viewer.navigation.setView(s,r):this.viewer.navigation.setRequestTransitionWithUp(!0,s,r,this.viewer.impl.camera.fov,this.viewer.impl.camera.up),this.viewer.navigation.setPivotPoint(r),this.viewer.navigation.setPivotSetFlag(!0)}},{key:"highlightCurrentArea",value:function(e,t){this.minimapCanvas.drawHighlight(e,t)}},{key:"modelToMinimapCoords",value:function(e){return{x:(e.x-this.modelStartPoint.x)*this.minimapCanvas.width/this.modelWidth,y:-(e.y-this.modelStartPoint.y-this.modelHeight)*this.minimapCanvas.height/this.modelHeight}}},{key:"minimapToModelCoords",value:function(e){return{x:e.x*this.modelWidth/this.minimapCanvas.width+this.modelStartPoint.x,y:-e.y*this.modelHeight/this.minimapCanvas.height+this.modelHeight+this.modelStartPoint.y}}},{key:"_setVisibility",value:function(e,t){this.panel&&this.panel.setVisible(this._isEnabled&&e,t)}},{key:"getViewableArea",value:function(){var e=this.modelBBox.clone(),t=this.viewer.impl.camera.left+this.viewer.impl.camera.position.x,n=this.viewer.impl.camera.right+this.viewer.impl.camera.position.x,i=this.viewer.impl.camera.bottom+this.viewer.impl.camera.position.y,a=this.viewer.impl.camera.top+this.viewer.impl.camera.position.y;return t>e.min.x+this.epsX&&(e.min.x=t),n<e.max.x-this.epsX&&(e.max.x=n),i>e.min.y+this.epsY&&(e.min.y=i),a<e.max.y-this.epsY&&(e.max.y=a),e}},{key:"updateSettingsPanel",value:function(){var e=this.viewer.getSettingsPanel&&this.viewer.getSettingsPanel();if(e&&!e.is3dMode&&!e.minimapSettingsCheckboxId){var t=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation;e.minimapSettingsLabel=e.addLabel(t,"Minimap"),e.minimapSettingsCheckboxId=e.addCheckbox(t,"Show minimap","Toggles availability of the Minimap",!0,this.setEnabled,H)}}},{key:"load",value:function(){return this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.update),this.viewer.addEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.update),this.viewer.addEventListener(Autodesk.Viewing.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel),this.viewer.prefs.add(H,!0,"2d"),this.updateSettingsPanel(),this.update(),!0}},{key:"unload",value:function(){return this.minimapCanvas&&(this._isTouch()&&(this.minimapCanvas.removeListenerFromCanvas("touchstart",this.onMouseDown),this.minimapCanvas.removeListenerFromCanvas("touchmove",this.onMouseMove),this.minimapCanvas.removeListenerFromCanvas("touchend",this.onMouseUp)),this.isMobile||(this.minimapCanvas.removeListenerFromCanvas("mousedown",this.onMouseDown),this.minimapCanvas.removeListenerFromCanvas("mousemove",this.onMouseMove),this.minimapCanvas.removeListenerFromCanvas("mouseup",this.onMouseUp),this.minimapCanvas.removeListenerFromCanvas("mouseleave",this.onMouseLeave),this.minimapCanvas.removeListenerFromCanvas("mousewheel",this.onMouseWheel),this.minimapCanvas.removeListenerFromCanvas("DOMMouseScroll",this.onMouseWheel)),this.minimapCanvas.unload(),this.minimapCanvas=null),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.update),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.update),this.viewer.removeEventListener(Autodesk.Viewing.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel),this.destroyUI(),this.model=null,this.document=null,this.node=null,!0}},{key:"update",value:function(){this.wasInit=!1,this.findAndSetSuitableModel()?this.setEnabled(this.viewer.prefs&&this.viewer.prefs.get(H)):this.setEnabled(!1)}},{key:"onCameraChange",value:function(e){var t=this.getViewableArea(),n=!t.equals(this.modelBBox);this._setVisibility(n,e),n&&this.minimapCanvas&&this.highlightCurrentArea(this.modelToMinimapCoords(t.min),this.modelToMinimapCoords(t.max))}},{key:"destroyUI",value:function(){var e=this.viewer.getSettingsPanel&&this.viewer.getSettingsPanel();e&&e.minimapSettingsCheckboxId&&(this.viewer.viewerSettingsPanel.removeCheckbox(e.minimapSettingsCheckboxId),this.viewer.viewerSettingsPanel.removeControl(e.minimapSettingsLabel),e.minimapSettingsLabel=null,e.minimapSettingsCheckboxId=null),this.panel&&(this.panel.uninitialize(),this.panel=null)}}],i&&j(n.prototype,i),c}();F.MinimapExtension=X,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.BIM360.Minimap",X)})(),Autodesk.Extensions.Minimap2D=i})();
//# sourceMappingURL=Minimap2D.min.js.map