/*! For license information please see Crop.min.js.LICENSE.txt */
(()=>{var t={8310:(t,e,o)=>{"use strict";o.d(e,{Z:()=>a});var r=o(87537),n=o.n(r),i=o(23645),s=o.n(i)()(n());s.push([t.id,".adsk-viewing-viewer .crop.edge-gizmo:hover{background-color:#0696d7}.adsk-viewing-viewer .crop.edge-gizmo.selected{background-color:#0696d7}.adsk-viewing-viewer .crop.edge-gizmo{background-color:#505050}\n","",{version:3,sources:["webpack://./extensions/Crop/Crop.css"],names:[],mappings:"AACA,4CAEI,wBAAyB,CAC5B,+CAIG,wBAAyB,CAC5B,sCAGG,wBAAiC",sourcesContent:["\n.adsk-viewing-viewer .crop.edge-gizmo:hover\n{\n    background-color: #0696d7;\n}\n\n.adsk-viewing-viewer .crop.edge-gizmo.selected\n{\n    background-color: #0696d7;\n}\n\n.adsk-viewing-viewer .crop.edge-gizmo {\n    background-color: rgb(80, 80, 80);\n}\n"],sourceRoot:""}]);const a=s},23645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o="",r=void 0!==e[5];return e[4]&&(o+="@supports (".concat(e[4],") {")),e[2]&&(o+="@media ".concat(e[2]," {")),r&&(o+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),o+=t(e),r&&(o+="}"),e[2]&&(o+="}"),e[4]&&(o+="}"),o})).join("")},e.i=function(t,o,r,n,i){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var l=0;l<t.length;l++){var u=[].concat(t[l]);r&&s[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),o&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=o):u[2]=o),n&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=n):u[4]="".concat(n)),e.push(u))}},e}},87537:t=>{"use strict";t.exports=function(t){var e=t[1],o=t[3];if(!o)return e;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),i="/*# ".concat(n," */"),s=o.sources.map((function(t){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(t," */")}));return[e].concat(s).concat([i]).join("\n")}return[e].join("\n")}},93379:t=>{"use strict";var e=[];function o(t){for(var o=-1,r=0;r<e.length;r++)if(e[r].identifier===t){o=r;break}return o}function r(t,r){for(var i={},s=[],a=0;a<t.length;a++){var c=t[a],l=r.base?c[0]+r.base:c[0],u=i[l]||0,d="".concat(l," ").concat(u);i[l]=u+1;var h=o(d),p={css:c[1],media:c[2],sourceMap:c[3]};-1!==h?(e[h].references++,e[h].updater(p)):e.push({identifier:d,updater:n(p,r),references:1}),s.push(d)}return s}function n(t,e){var o=e.domAPI(e);return o.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o.update(t=e)}else o.remove()}}t.exports=function(t,n){var i=r(t=t||[],n=n||{});return function(t){t=t||[];for(var s=0;s<i.length;s++){var a=o(i[s]);e[a].references--}for(var c=r(t,n),l=0;l<i.length;l++){var u=o(i[l]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}i=c}}},90569:t=>{"use strict";var e={};t.exports=function(t,o){var r=function(t){if(void 0===e[t]){var o=document.querySelector(t);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(t){o=null}e[t]=o}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(o)}},19216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e),e}},3565:(t,e,o)=>{"use strict";t.exports=function(t){var e=o.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(o){!function(t,e,o){var r=o.css,n=o.media,i=o.sourceMap;n?t.setAttribute("media",n):t.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(r,t)}(e,t,o)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},44589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function o(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={id:r,exports:{}};return t[r](i,i.exports,o),i.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";o.r(r);var t=o(93379),e=o.n(t),n=o(7795),i=o.n(n),s=o(90569),a=o.n(s),c=o(3565),l=o.n(c),u=o(19216),d=o.n(u),h=o(44589),p=o.n(h),v=o(8310),f={};function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function y(t,e,o,r,n,i,s){try{var a=t[i](s),c=a.value}catch(t){return void o(t)}a.done?e(c):Promise.resolve(c).then(r,n)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function T(t,e,o){return e&&C(t.prototype,e),o&&C(t,o),t}function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}function b(t,e){return!e||"object"!==g(e)&&"function"!=typeof e?x(t):e}function x(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},E(t)}f.styleTagTransform=p(),f.setAttributes=l(),f.insert=a().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=d(),e()(v.Z,f),v.Z&&v.Z.locals&&v.Z.locals;var k=Autodesk.Viewing,A="crop-context",M={CROP_MODIFIED:"cropModified"},S=AutodeskNamespace("Autodesk.Crop"),B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(s,t);var e,o,r,n,i=(r=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=E(r);if(n){var o=E(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return b(this,t)});function s(t,e){var o;return m(this,s),o=i.call(this,t,e),Autodesk.Viewing.EventDispatcher.prototype.apply(x(o)),o}return T(s,[{key:"load",value:(e=regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.viewer.loadExtension("Autodesk.Edit2D");case 2:return this.edit2dExtension=t.sent,e=new Autodesk.Edit2D.Style({fillAlpha:0,lineColor:"rgb(0, 0, 0)",lineStyle:10,lineWidth:1}),this.cropStyle=this.options.cropStyle||e,this.tmpBox=new THREE.Box3,this.updateContextMatrix=this.updateContextMatrix.bind(this),this.updateCropBounds=this.updateCropBounds.bind(this),this.viewer.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.updateContextMatrix),t.abrupt("return",!0);case 10:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,o=arguments;return new Promise((function(r,n){var i=e.apply(t,o);function s(t){y(i,r,n,s,a,"next",t)}function a(t){y(i,r,n,s,a,"throw",t)}s(void 0)}))},function(){return o.apply(this,arguments)})},{key:"unload",value:function(){return this.clearCropEditBox(),this.clearCropBounds(),this.destroyUI(),this.rectangleTool&&(this.viewer.toolController.deregisterTool(this.rectangleTool),this.rectangleTool=null),this.edgeMoveTool&&(this.viewer.toolController.deregisterTool(this.edgeMoveTool),this.edgeMoveTool=null),this.moveTool&&(this.viewer.toolController.deregisterTool(this.moveTool),this.moveTool=null),this.ctx&&(this.edit2dExtension.unregisterTools(A),this.ctx=null),this.edit2dExtension=null,this.targetModel=null,this.tmpBox=null,this.viewer.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.updateContextMatrix),!0}},{key:"getEdit2DContext",value:function(){return this.ctx||(this.ctx=this.edit2dExtension.registerTools(A),this.ctx.layer.removeStyleModifier(this.ctx.selection.modifier),this.ctx.layer.setCutPlanesEnabled(!1),this.ctx.gizmoLayer.setCutPlanesEnabled(!1),this.edgeMoveTool=new Autodesk.Edit2D.EdgeMoveTool(this.ctx,{edgeHighlightStyle:this.cropStyle,gizmoClassName:"crop"}),this.viewer.toolController.registerTool(this.edgeMoveTool),this.options.disableMoveTool||(this.moveTool=new Autodesk.Edit2D.MoveTool(this.ctx),this.viewer.toolController.registerTool(this.moveTool)),this.rectangleTool=new Autodesk.Edit2D.RectangleTool(this.ctx,this.cropStyle),this.rectangleTool.getCursor=function(){return"crosshair"},this.viewer.toolController.registerTool(this.rectangleTool)),this.ctx}},{key:"setModel",value:function(t){t!==this.targetModel&&(this.clearCropBounds(),this.targetModel=t,this.updateContextMatrix())}},{key:"updateContextMatrix",value:function(){if(this.targetModel){var t=this.targetModel.getModelToViewerTransform()||new THREE.Matrix4;this.getEdit2DContext().setMatrix(t)}this.updateCropBounds()}},{key:"updateCropBounds",value:function(){if(this.cropRect&&this.targetModel){this.cropRect.computeBBox();var t=this.cropRect.bbox;this.viewer.impl.setViewportBounds(this.targetModel,t)}else this.clearCropBounds()}},{key:"setCropRect",value:function(t){var e=this;this.cropRect=t,this.cropRect&&this.cropRect.addEventListener(Autodesk.Edit2D.Shape.Events.MODIFIED,(function(){e.updateCropBounds(),e.fireEvent({type:M.CROP_MODIFIED,cropRegion:e.getCurrentCropRegion()})})),this.updateCropBounds()}},{key:"getCurrentCropRegion",value:function(){return this.targetModel&&this.cropRect?(this.cropRect.computeBBox(),new R(this.cropRect.bbox,this.targetModel.getUnitString())):null}},{key:"activate",value:function(){var t,e=this,o=this.getCurrentCropRegion();o?this.loadCropRegion(o,!0):(this.getEdit2DContext().gizmoLayer.addEventListener(Autodesk.Edit2D.EditLayer.SHAPE_ADDED,(function(t){var o=t.shape;e.setCropRect(o)}),{once:!0}),this.viewer.toolController.activateTool(this.rectangleTool.getName()),this.rectangleTool.undoStack.addEventListener(Autodesk.Edit2D.UndoStack.AFTER_ACTION,(function(){e.startCropEditing()}),{once:!0}),null===(t=this.cropButton)||void 0===t||t.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),this.activeStatus=!0)}},{key:"startCropEditing",value:function(){var t;if(this.cropRect){null===(t=this.cropButton)||void 0===t||t.setState(Autodesk.Viewing.UI.Button.State.ACTIVE);var e=this.getEdit2DContext();e.layer.hasShape(this.cropRect)||e.layer.addShape(this.cropRect),this.viewer.toolController.isToolActivated(this.rectangleTool.getName())&&this.viewer.toolController.deactivateTool(this.rectangleTool.getName()),this.moveTool&&this.viewer.toolController.activateTool(this.moveTool.getName()),this.viewer.toolController.activateTool(this.edgeMoveTool.getName()),e.selection.selectOnly(this.cropRect)}}},{key:"deactivate",value:function(){var t;this.rectangleTool&&this.viewer.toolController.isToolActivated(this.rectangleTool.getName())&&this.viewer.toolController.deactivateTool(this.rectangleTool.getName()),this.edgeMoveTool&&this.viewer.toolController.isToolActivated(this.edgeMoveTool.getName())&&this.viewer.toolController.deactivateTool(this.edgeMoveTool.getName()),this.moveTool&&this.viewer.toolController.isToolActivated(this.moveTool.getName())&&this.viewer.toolController.deactivateTool(this.moveTool.getName()),this.clearCropEditBox(),null===(t=this.cropButton)||void 0===t||t.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),this.activeStatus=!1}},{key:"clearCropEditBox",value:function(){var t;null===(t=this.ctx)||void 0===t||t.clearLayer(!1)}},{key:"clearCropBounds",value:function(){this.targetModel&&this.viewer.impl.setViewportBounds(this.targetModel,null)}},{key:"loadCropRegion",value:function(t,e){this.deactivate(),t.getCropInUnits||(t=new R(t.bbox,t.units,t));var o=t.getCropInUnits(this.targetModel.getUnitString()),r=new Autodesk.Edit2D.Polygon(void 0,this.cropStyle).fromBox2(o);this.setCropRect(r),e&&this.startCropEditing()}},{key:"reset",value:function(){this.setCropRect(null),this.deactivate()}},{key:"cropToModelBounds",value:function(t){var e=this.targetModel.getBoundingBox(!0,!0),o=new R(e,this.targetModel.getUnitString());this.loadCropRegion(o,t)}},{key:"onToolbarCreated",value:function(){this.options.createButton&&this.createUI()}},{key:"createUI",value:function(){var t=this,e=this.viewer.getToolbar&&this.viewer.getToolbar();if(e&&!this.cropButton){var o=Autodesk.Viewing.TOOLBAR.SETTINGSTOOLSID,r=e.getControl(o);r&&(this.cropButton=new Autodesk.Viewing.UI.Button("toolbar-crop-button"),this.cropButton.setToolTip(Autodesk.Viewing.i18n.translate("Crop")),this.cropButton.setIcon("adsk-icon-box"),this.cropButton.onClick=function(){t.cropButton.getState()===Autodesk.Viewing.UI.Button.State.INACTIVE?t.activate():t.deactivate()},r.addControl(this.cropButton))}}},{key:"destroyUI",value:function(){this.cropButton&&this.viewer.getToolbar&&this.viewer.getToolbar()&&(this.cropButton.removeFromParent(),this.cropButton=null)}}]),s}(k.Extension),R=function(){function t(e,o){m(this,t),this.bbox=e,this.units=o}return T(t,[{key:"getCropInUnits",value:function(t){if(!t||!this.units)return this.bbox;var e=Autodesk.Viewing.Private.convertUnits(this.units,t,1,1),o=this.bbox.clone();return o.min.multiplyScalar(e),o.max.multiplyScalar(e),o}}]),t}();k.theExtensionManager.registerExtension("Autodesk.Crop",B),S.Events=M})(),Autodesk.Extensions.Crop=r})();
//# sourceMappingURL=Crop.min.js.map