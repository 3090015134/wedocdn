/*! For license information please see CrossFadeEffects.min.js.LICENSE.txt */
(()=>{var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{default:()=>c});var r={DECAL:0,CROSSFADE:1};function n(e){var t=[],n=[!0,!0],i=e,a=new THREE.Color,o=[],s=r.DECAL,d=!0;this.setModelTargetIndex=function(e,t){o[e]=t},this.setSaoHeuristicEnabled=function(e){d=e},this.getRenderSao=function(e){if(!d)return!0;var t=e.modelId&&o[e.modelId];if(void 0===t)return!0;for(var r=t,n=this.getCrossFadeOpacity(t),i=0;i<2;i++){var a=this.getCrossFadeOpacity(i);a>n&&(r=i,n=a)}return r==t},this.setCrossFadeOpacity=function(e,t){var r="crossFadeOpacity"+e;i.uniforms[r].value=t},this.getCrossFadeOpacity=function(e){var t="crossFadeOpacity"+e;return i.uniforms[t].value},this.updateBlendPass=function(e){void 0===e&&(e=t.length);var r="NUM_CROSSFADE_TARGETS",n=e||void 0;i.material.defines[r]!==n&&(e?i.material.defines[r]=n:delete i.material.defines[r],i.material.needsUpdate=!0);for(var a=0;a<e;a++){var o="tCrossFadeTex"+a;i.uniforms[o].value=t[a]}var d="TARGET_FADE_MODE";i.material.defines[d]!==s&&(i.material.defines[d]=s,i.material.needsUpdate=!0)},this.setFadeMode=function(e){e===r.DECAL||e===r.CROSSFADE?(s=e,this.updateBlendPass()):console.error("Unexpected fade mode enum")},this.clearTarget=function(e){e.setClearColor(a,0);for(var r=0;r<t.length;r++)n[r]&&e.clearTarget(t[r],!0,!0)},this.setClearEnabled=function(e,t){n[e]=t},this.disposeTargets=function(){for(var e=0;e<t.length;e++){var r=t[e];r&&r.dispose(),t[e]=null}},this.dtor=function(){this.disposeTargets(),this.updateBlendPass(),this.setCrossFadeOpacity(0,0),this.setCrossFadeOpacity(1,0)},this.chooseColorTarget=function(e,r){var n=e.modelId&&o[e.modelId];return void 0===n?r:t[n]},this.updateTargets=function(e,r,n,i){for(var a=0;a<2;a++){var o=t[a];!n&&o&&o.width===e&&o.height===r||(o&&o.dispose(),(o=new THREE.WebGLRenderTarget(e,r,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:i?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1})).texture.generateMipmaps=!1,t[a]=o)}},this.beginRenderToFadeTarget=function(e,r){this.updateBlendPass(0);var n=t[e];r.setOffscreenTarget(n),this.setClearEnabled(e,!1)},this.endRenderFadeTarget=function(e){e.setOffscreenTarget(null),this.updateBlendPass()}}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}n.FadeMode=r;var l=Autodesk.Viewing,u=l.Private,c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(f,e);var t,r,i,l,c=(i=f,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(i);if(l){var r=d(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return s(this,e)});function f(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(r=c.call(this,e,t)).crossFade=null,r.clientId=null,r.onClientChanged=null,r}return t=f,(r=[{key:"load",value:function(){return this.setCrossFadeEnabled(!0),!0}},{key:"unload",value:function(){this.setCrossFadeEnabled(!1)}},{key:"acquireControl",value:function(e,t){this.clientId=e,this.onClientChanged&&this.onClientChanged(),this.onClientChanged=t}},{key:"setModelTargetIndex",value:function(e,t){this.crossFade.setModelTargetIndex(e,t),this.viewer.impl.invalidate(!0)}},{key:"setModelTargetIndexForAll",value:function(e){for(var t=this.viewer.getVisibleModels(),r=0;r<t.length;r++){var n=t[r];this.setModelTargetIndex(n.id,e)}}},{key:"setCrossFadeOpacity",value:function(e,t){this.crossFade.setCrossFadeOpacity(e,t),this.viewer.impl.invalidate(!0)}},{key:"getCrossFadeOpacity",value:function(e){return this.crossFade.getCrossFadeOpacity(e)}},{key:"setCrossFadeEnabled",value:function(e){if(e!==Boolean(this.crossFade)){var t=this.viewer.impl.renderer();if(e){var r=t.getBlendPass();this.crossFade=new n(r),t.setCrossFade(this.crossFade)}else this.crossFade.dtor(),t.setCrossFade(null);var i=t.getColorTarget();if(i){var a=this.viewer.impl.glrenderer().getPixelRatio();t.setSize(i.width/a,i.height/a)}}}},{key:"renderFadingImage",value:function(e,t){var r=performance.now();this.viewer.impl.tick(r);var n=this.viewer.impl.renderer();this.crossFade.beginRenderToFadeTarget(e,n),this.viewer.impl.invalidate(!0,!0,!0);var i=this.viewer.impl.targetFrameBudget;t&&(this.viewer.impl.targetFrameBudget=t),r=performance.now(),this.viewer.impl.tick(r),this.targetFrameBudget=i,this.crossFade.endRenderFadeTarget(n)}},{key:"releaseFadingImage",value:function(e){this.setClearEnabled(e,!0)}},{key:"setClearEnabled",value:function(e,t){this.crossFade.setClearEnabled(e,t)}},{key:"fadeTarget",value:function(e,t,r,n,i){var a=this;return u.fadeValue(t,r,n,(function(t){a.setCrossFadeOpacity(e,t)}),i)}},{key:"fadeImage",value:function(e,t,r,i){for(var a=this,o=this.viewer.impl.modelQueue(),s=o.getModels().slice(),d=0;d<s.length;d++){var l=s[d];o.hideModel(l.id)}return this.crossFade.setFadeMode(n.FadeMode.CROSSFADE),u.fadeValue(e,t,r,(function(e){a.setCrossFadeOpacity(0,1-e),a.setCrossFadeOpacity(1,e),a.viewer.impl.renderer().presentBuffer()}),(function(){a.crossFade.setFadeMode(n.FadeMode.CROSSFADE);for(var e=0;e<s.length;e++){var t=s[e];o.showModel(t.id)}i&&i()}))}},{key:"fadeToViewerState",value:function(e,t){var r=this;this.renderFadingImage(0,300),e(),this.renderFadingImage(1,300);var n=this.viewer.impl.renderer(),i=n.getAOEnabled();n.setAOEnabled(!1),this.fadeImage(0,1,t,(function(){r.releaseFadingImage(0),r.releaseFadingImage(1),n.setAOEnabled(i)}))}}])&&a(t.prototype,r),f}(l.Extension);Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CrossFadeEffects",c)})(),Autodesk.Extensions.CrossFadeEffects=t})();
//# sourceMappingURL=CrossFadeEffects.min.js.map