/*! For license information please see OMV.min.js.LICENSE.txt */
(()=>{var e={d:(i,t)=>{for(var n in t)e.o(t,n)&&!e.o(i,n)&&Object.defineProperty(i,n,{enumerable:!0,get:t[n]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},i={};((e,i,t)=>{"use strict";t.r(i),t.d(i,{OMV:()=>d});var n="Surface Inspection Point",o=function(e){var i=this;function t(e){var t=i.viewer.model.getFragmentList().getGeometry(e).vb,n=o(e),r=new THREE.Vector3(t[3],t[4],t[5]),a=2*n.distanceTo(r);return parseFloat(a.toFixed(1))}function o(e){var t=i.viewer.model.getFragmentList().getGeometry(e).vb;return new THREE.Vector3(t[0],t[1],t[2])}function r(e,n){var r=i.viewer,a=r.impl.getFragmentProxy(r.model,e);a.getAnimTransform();var s=n/t(e),c=new THREE.Matrix4;a.getOriginalWorldMatrix(c),c.invert();var l=o(e);a.scale=new THREE.Vector3(s,s,s),a.position.x=c.elements[12]*(s-1)-l.x*(s-1),a.position.y=c.elements[13]*(s-1)-l.y*(s-1),a.position.z=c.elements[14]*(s-1)-l.z*(s-1),a.updateAnimTransform()}this.viewer=e,this.diameter=null,this.resizeConfetti=function(e){if(e!==this.diameter){var i=this.viewer,t=i.model.getData().instanceTree;this.diameter=e,this.findMeasuredPoints((function(n){for(var o=0;o<n.length;o++)t.enumNodeFragments(n[o],(function(t){r(t,e),o===n.length-1&&i.impl.sceneUpdated(!0)}),!1)}))}},this.getDiameterFromGeom=function(e){var i=this.viewer.model.getData().instanceTree;this.findMeasuredPoints((function(n){i.enumNodeFragments(n[0],(function(i){var n=t(i);e(n)}),!1)}))},this.findMeasuredPoints=function(e){var i=this.viewer;this.findInspectionPoints((function(t){var o={propFilter:[n],ignoreHidden:!1};i.model.getBulkProperties(t,o,(function(i){var t=i.filter((function(e){return"projected"===function(e,i){for(var t=0;t<e.length;++t){var n=e[t];if("Surface Inspection Point"===n.displayName)return n.displayValue}return null}(e.properties)}));e(t)}))}))},this.findInspectionPoints=function(e){this.viewer.model.findProperty(n).then((function(i){e(i)}))}};function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var a="configTab",s=function(e,i,t){var n="adsk_omv_panel_"+e.id;Autodesk.Viewing.UI.SettingsPanel.call(this,e.container,n,t,{heightAdjustment:90}),this.setGlobalManager(e.globalManager),this.container.classList.add("viewer-settings-panel"),this.viewer=e,this.confettiController=i,this._onSetConfettiDiameter=this._onSetConfettiDiameter.bind(this),this.addTab(a,"Probing",{className:"config"}),this.selectTab(a),this.inspectionSettingsLabel=this.addLabel(a,"Inspection Points"),this.sliderId=this.addSlider(a,"Confetti diameter",.5,40,1,this._onSetConfettiDiameter),this.confettiSizeSlider=this.getControl(this.sliderId),this.confettiSizeSlider.sliderElement.step=this.confettiSizeSlider.stepperElement.step=.1,this.createFooter()};(s.prototype=Object.create(Autodesk.Viewing.UI.SettingsPanel.prototype)).constructor=s,s.prototype.syncUI=function(){this.confettiSizeSlider.setValue(this.confettiController.diameter)},s.prototype._onSetConfettiDiameter=function(e){var i=null,t=r(e);"object"===t&&e.detail&&e.detail.value?i=parseFloat(e.detail.value):"number"===t&&(i=e),i&&this.confettiController.resizeConfetti(i)};var c={en:JSON.parse('{"@@locale":"en","@@context":"On-Machine Verification extension","On-Machine Verification":"On-Machine Verification","Probing":"Probing","Inspection Points":"Inspection Points","Confetti diameter":"Confetti diameter"}'),"en-GB":JSON.parse('{"@@locale":"en","@@context":"On-Machine Verification extension","On-Machine Verification":"On-Machine Verification","Probing":"Probing","Inspection Points":"Inspection Points","Confetti diameter":"Confetti diameter"}'),cs:JSON.parse('{"@@locale":"cs","@@context":"Rozšíření ověření na stroji","On-Machine Verification":"Ověření na stroji","Probing":"Sondování","Inspection Points":"Kontrolní body","Confetti diameter":"Průměr konfety"}'),de:JSON.parse('{"@@locale":"de","@@context":"Prüfungen an der Maschine selbst Extension","On-Machine Verification":"Prüfungen an der Maschine","Probing":"Antasten","Inspection Points":"Inspektionspunkte","Confetti diameter":"Durchmesser Konfetti"}'),es:JSON.parse('{"@@locale":"es","@@context":"Ampliación de la verificación en la máquina","On-Machine Verification":"Verificación en la máquina","Probing":"Sondeo","Inspection Points":"Puntos de inspección","Confetti diameter":"Diámetro de confeti"}'),fr:JSON.parse('{"@@locale":"fr","@@context":"Extension de vérification sur la machine","On-Machine Verification":"Vérification sur la machine","Probing":"Palpage","Inspection Points":"Points d\'inspection","Confetti diameter":"Diamètre des confettis"}'),"fr-CA":JSON.parse('{"@@locale":"fr-CA","@@context":"Extension de vérification sur la machine","On-Machine Verification":"Vérification sur la machine","Probing":"Palpage","Inspection Points":"Points d\'inspection","Confetti diameter":"Diamètre des confettis"}'),it:JSON.parse('{"@@locale":"it","@@context":"Estensione verifica sulla macchina","On-Machine Verification":"Verifica sulla macchina","Probing":"Sonda","Inspection Points":"Punti di ispezione","Confetti diameter":"Diametro ravvicinati"}'),ja:JSON.parse('{"@@locale":"ja","@@context":"機上検証エクステンション","On-Machine Verification":"機上検証","Probing":"検出中","Inspection Points":"検査点","Confetti diameter":"紙吹雪の直径"}'),ko:JSON.parse('{"@@locale":"ko","@@context":"켜기-기계 검증 확장","On-Machine Verification":"켜기-기계 검증","Probing":"프로브","Inspection Points":"검사 점","Confetti diameter":"색종이 지름"}'),pl:JSON.parse('{"@@locale":"pl","@@context":"Rozszerzenie On-Machine Verification","On-Machine Verification":"On-Machine Verification","Probing":"Sondowanie","Inspection Points":"Punkty kontrolne","Confetti diameter":"Średnica confetti"}'),"pt-BR":JSON.parse('{"@@locale":"pt","@@context":"Extensão Verificação na máquina","On-Machine Verification":"Verificação na máquina","Probing":"Sondagem","Inspection Points":"Pontos de inspeção","Confetti diameter":"Diâmetro do confete"}'),ru:JSON.parse('{"@@locale":"ru","@@context":"Расширение «Контроль на станке»","On-Machine Verification":"Контроль на станке","Probing":"Измерение щупом","Inspection Points":"Контрольные точки","Confetti diameter":"Диаметр конфетти"}'),tr:JSON.parse('{"@@locale":"tr","@@context":"Makine Üzerinde Doğrulama uzantısı","On-Machine Verification":"Makine Üzerinde Doğrulama","Probing":"Problama","Inspection Points":"Denetim Noktaları","Confetti diameter":"Konfeti çapı"}'),"zh-HANS":JSON.parse('{"@@locale":"zh-Hans","@@context":"计算机验证扩展","On-Machine Verification":"计算机验证","Probing":"正在探测","Inspection Points":"检验点","Confetti diameter":"彩色纸屑直径"}'),"zh-HANT":JSON.parse('{"@@locale":"zh-Hant","@@context":"在機驗證延伸","On-Machine Verification":"在機驗證","Probing":"正在探測","Inspection Points":"檢測點","Confetti diameter":"五色點直徑"}'),"zh-HK":JSON.parse('{"@@locale":"zh-hk","@@context":"在機驗證擴充功能","On-Machine Verification":"在機驗證","Probing":"探測","Inspection Points":"檢查點","Confetti diameter":"彩色點直徑"}'),nl:JSON.parse('{"@@locale":"nl","@@context":"Extensie voor verificatie op machine","On-Machine Verification":"Verificatie op machine","Probing":"Zoeken","Inspection Points":"Inspectiepunten","Confetti diameter":"Confettidiameter"}'),sv:JSON.parse('{"@@locale":"sv","@@context":"On-Machine Verification-tillägg","On-Machine Verification":"On-Machine Verification","Probing":"Sondering","Inspection Points":"Inspektionspunkter","Confetti diameter":"Konfettidiameter"}'),da:JSON.parse('{"@@locale":"da","@@context":"Udvidelse af verificering på maskine","On-Machine Verification":"Verificering på maskine","Probing":"Tester","Inspection Points":"Inspektionpunkter","Confetti diameter":"Confetti-diameter"}'),no:JSON.parse('{"@@locale":"no","@@context":"Utvidelse av maskinbasert bekreftelse","On-Machine Verification":"Maskinbasert bekreftelse","Probing":"Undersøkelse","Inspection Points":"Inspeksjonspunkter","Confetti diameter":"Konfettidiameter"}')},l="On-Machine Verification",f=Autodesk.Viewing;function d(e,i){Autodesk.Viewing.Extension.call(this,e,i),this._configButtonId=null,this._default_geom_diameter=void 0,this._panel=null,this.confettiController=null,this.hasUI=Autodesk.Viewing.GuiViewer3D&&e instanceof Autodesk.Viewing.GuiViewer3D,this.openPanel=this.openPanel.bind(this),this._initialiseConfetti=this._initialiseConfetti.bind(this),this._initButtonConfig=this._initButtonConfig.bind(this)}d.prototype=Object.create(Autodesk.Viewing.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){return!!this.hasUI&&(this.extendLocalization(c),this.viewer.model&&this.viewer.model.isLoadDone()?this._initialiseConfetti():this.viewer.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,this._initialiseConfetti,{once:!0}),!0)},d.prototype.unload=function(){return this.viewer.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,this._initialiseConfetti),null!==this._configButtonId&&(this.viewer.viewerSettingsPanel.removeConfigButton(this._configButtonId),this._configButtonId=null),this._panel&&(this._panel.uninitialize(),this._panel=null),this.confettiController=null,!0},d.prototype._initialiseConfetti=function(){var e=this;this.confettiController=new o(this.viewer),this.confettiController.getDiameterFromGeom((function(i){e.viewer&&(e._default_geom_diameter=i,e.setConfettiDiameter(i),e._initButtonConfig())}))},d.prototype.setConfettiDiameter=function(e){return void 0===e&&(e=this._default_geom_diameter),void 0!==e&&(this.confettiController.resizeConfetti(e),this._panel&&this._panel.syncUI(),!0)},d.prototype.openPanel=function(){this._panel||(this._panel=new s(this.viewer,this.confettiController,l)),this._panel.setVisible(!0)},d.prototype._initButtonConfig=function(){var e=this.viewer.getSettingsPanel();e?this._configButtonId=e.addConfigButton(l,this.openPanel):this.addEventListener(f.SETTINGS_PANEL_CREATED_EVENT,this._initButtonConfig,{once:!0})},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.OMV",d)})(0,i,e),Autodesk.Extensions.OMV=i})();
//# sourceMappingURL=OMV.min.js.map