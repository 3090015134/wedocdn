/*! For license information please see DataVisualization.min.js.LICENSE.txt */
(()=>{var t={84213:t=>{t.exports={MOUSE_HOVERING:"DATAVIZ_OBJECT_HOVERING",MOUSE_CLICK:"DATAVIZ_OBJECT_CLICK",MOUSE_CLICK_OUT:"DATAVIZ_CLICK_OUT"}},79895:(t,e,i)=>{function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=i(98662),o=65535,a=function(){"use strict";function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.meshCallback=e,this.dbIds=[],this.reset()}var e,i;return e=t,(i=[{key:"addPoint",value:function(t,e){this.vcount+1>o&&(this.flushBuffer(),this.reset());var i=this.vcount;if(this.ib[i]=i,this.vb[3*i]=t.position.x,this.vb[3*i+1]=t.position.y,this.vb[3*i+2]=t.position.z,this.idb[3*i]=255&t.dbId,this.idb[3*i+1]=t.dbId>>8&255,this.idb[3*i+2]=t.dbId>>16&255,this.colorb[3*i]=255*t.color.r,this.colorb[3*i+1]=255*t.color.g,this.colorb[3*i+2]=255*t.color.b,e){var n=e.spriteUV(t.style.url);n&&(this.uv[4*i]=n.x,this.uv[4*i+1]=n.y,this.uv[4*i+2]=n.w,this.uv[4*i+3]=n.h)}this.scale[i]=1,this.dbIds.push(t.dbId),this.vcount++}},{key:"reset",value:function(){this.vcount=0,this.ib=new Uint16Array(o),this.idb=new Uint8Array(196605),this.vb=new Float32Array(196605),this.colorb=new Uint8Array(196605),this.scale=new Float32Array(o),this.uv=new Float32Array(262140)}},{key:"flushBuffer",value:function(){var t=new r.BufferGeometry,e=new r.BufferAttribute(new Uint8Array(this.idb.slice(0,3*this.vcount)),3);e.bytesPerItem=1,e.normalized=!0;var i=new r.BufferAttribute(new Float32Array(this.vb.slice(0,3*this.vcount)),3);i.bytesPerItem=4;var n=new r.BufferAttribute(new Uint8Array(this.colorb.slice(0,3*this.vcount)),3);n.bytesPerItem=1,n.normalized=!0;var o=new r.BufferAttribute(new Uint16Array(this.ib.slice(0,this.vcount)),1),a=new r.BufferAttribute(new Float32Array(this.uv.slice(0,4*this.vcount)),4),s=new r.BufferAttribute(new Float32Array(this.scale.slice(0,this.vcount)),1);t.setAttribute("id",e),t.setIndex(o),t.setAttribute("position",i),t.setAttribute("color",n),t.setAttribute("uvp",a),t.setAttribute("pointScale",s),t.isPoints=!0,t.dbIds=this.dbIds.slice(0),this.dbIds.length=0,this.meshCallback&&this.meshCallback(t),this.vcount=0}}])&&n(e.prototype,i),t}();t.exports={SpriteMeshBuilder:a}},41550:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,e){return i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(t,e)}function n(t,i){return!i||"object"!==e(i)&&"function"!=typeof i?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):i}function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}var u=function(){"use strict";function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};o(this,t),this.id=e,this.position=i,this.types=n,this.name=r,this.contextData=a,this.dbId=null}return s(t,[{key:"positionFromDBId",value:function(t,e){var i=t.getData().instanceTree,n=new THREE.Box3,r=new THREE.Box3,o=t.getFragmentList();this.dbId=e,i.enumNodeFragments(e,(function(t){o.getWorldBounds(t,r),n.union(r)}),!0),this.position=n.getCenter(new THREE.Vector3)||this.position}}]),t}(),h=function(){"use strict";function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;o(this,t),"number"==typeof i&&(i=[i]),this.dbIds=i,this.shadingPoints=n||[],this.isLeaf=!0,this.fragIds=[],this.id=e,this.name=r,this.bounds=new THREE.Box3}return s(t,[{key:"addPoint",value:function(t){this.shadingPoints.push(t)}},{key:"update",value:function(t){var e=this,i=t.getData().instanceTree,n=new Set(this.fragIds),r=new THREE.Box3,o=t.getFragmentList();this.dbIds.forEach((function(t){i.enumNodeFragments(t,(function(t){n.has(t)||(e.fragIds.push(t),o.getWorldBounds(t,r),e.bounds.union(r))}),!0)}))}}]),t}(),c=function(){"use strict";function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;o(this,t),this.id=e,this._children=[],this.isGroup=!0,this.name=i}return s(t,[{key:"addChild",value:function(t){this.children.push(t)}},{key:"update",value:function(t){this.children.forEach((function(e){return e.update(t)}))}},{key:"getLeafsById",value:function(t,e){e=e||[];for(var i=0;i<this.children.length;i++){var n=this.children[i];n.id===t?n.isLeaf?e.push(n):n.isGroup&&n.getChildLeafs(e):n.isGroup&&n.getLeafsById(t,e)}return e}},{key:"getNodeById",value:function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.id===t)return i;if(i.isGroup){var n=i.getNodeById(t);if(n)return n}}}},{key:"getChildLeafs",value:function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.isLeaf?t.push(i):i.isGroup&&i.getChildLeafs(t)}}},{key:"children",get:function(){return this._children}}]),t}(),l=function(t){"use strict";!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(h,t);var e,a,u=(e=h,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,i=r(e);if(a){var o=r(this).constructor;t=Reflect.construct(i,arguments,o)}else t=i.apply(this,arguments);return n(this,t)});function h(){return o(this,h),u.apply(this,arguments)}return s(h,[{key:"initialize",value:function(t){this.update(t)}}]),h}(c);t.exports={SurfaceShadingData:l,SurfaceShadingGroup:c,SurfaceShadingNode:h,SurfaceShadingPoint:u,filterShadingPointsByType:function(t,e){return(t=t||[]).filter((function(t){return t.types&&t.types.includes(e)}))}}},43908:function(t,e,i){var n,r,o;o=function(){var t,e={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},i=function(){var t=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},i=e.defaultRadius;return t.prototype={_organiseData:function(t,e){var n=t[this._xField],r=t[this._yField],o=this._radi,a=this._data,s=this._max,u=this._min,h=t[this._valueField]||1,c=t.radius||this._cfgRadius||i;a[n]||(a[n]=[],o[n]=[]),a[n][r]?a[n][r]+=h:(a[n][r]=h,o[n][r]=c);var l=a[n][r];return l>s?(e?this.setDataMax(l):this._max=l,!1):l<u?(e?this.setDataMin(l):this._min=l,!1):{x:n,y:r,value:h,radius:c,min:u,max:s}},_unOrganizeData:function(){var t=[],e=this._data,i=this._radi;for(var n in e)for(var r in e[n])t.push({x:n,y:r,radius:i[n][r],value:e[n][r]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var i=this._organiseData(arguments[0],!0);i&&(0===this._data.length&&(this._min=this._max=i.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[i]}))}return this},setData:function(t){var e=t.data,i=e.length;this._data=[],this._radi=[];for(var n=0;n<i;n++)this._organiseData(e[n],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},t}(),n=function(){var t=function(t){var e=t.gradient||t.defaultGradient,i=document.createElement("canvas"),n=i.getContext("2d");i.width=256,i.height=1;var r=n.createLinearGradient(0,0,256,1);for(var o in e)r.addColorStop(o,e[o]);return n.fillStyle=r,n.fillRect(0,0,256,1),n.getImageData(0,0,256,1).data},e=function(t,e){var i=document.createElement("canvas"),n=i.getContext("2d"),r=t,o=t;if(i.width=i.height=2*t,1==e)n.beginPath(),n.arc(r,o,t,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill();else{var a=n.createRadialGradient(r,o,t*e,r,o,t);a.addColorStop(0,"rgba(0,0,0,1)"),a.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=a,n.fillRect(0,0,2*t,2*t)}return i};function i(e){var i=e.container,n=this.shadowCanvas=document.createElement("canvas"),r=this.canvas=e.canvas||document.createElement("canvas"),o=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(e.container)||{});r.className="heatmap-canvas",this._width=r.width=n.width=e.width||+o.width.replace(/px/,""),this._height=r.height=n.height=e.height||+o.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=r.getContext("2d"),r.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",i.style.position="relative",i.appendChild(r),this._palette=t(e),this._templates={},this._setStyles(e)}return i.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(function(t){for(var e=[],i=t.min,n=t.max,r=t.radi,o=(t=t.data,Object.keys(t)),a=o.length;a--;)for(var s=o[a],u=Object.keys(t[s]),h=u.length;h--;){var c=u[h],l=t[s][c],d=r[s][c];e.push({x:s,y:c,value:l,radius:d})}return{min:i,max:n,data:e}}(t)),this._colorize())},_updateGradient:function(e){this._palette=t(e)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){for(var i=this._min=t.min,n=this._max=t.max,r=(t=t.data||[]).length,o=1-this._blur;r--;){var a,s=t[r],u=s.x,h=s.y,c=s.radius,l=Math.min(s.value,n),d=u-c,f=h-c,p=this.shadowCtx;this._templates[c]?a=this._templates[c]:this._templates[c]=a=e(c,o);var v=(l-i)/(n-i);p.globalAlpha=v<.01?.01:v,p.drawImage(a,d,f),d<this._renderBoundaries[0]&&(this._renderBoundaries[0]=d),f<this._renderBoundaries[1]&&(this._renderBoundaries[1]=f),d+2*c>this._renderBoundaries[2]&&(this._renderBoundaries[2]=d+2*c),f+2*c>this._renderBoundaries[3]&&(this._renderBoundaries[3]=f+2*c)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],i=this._renderBoundaries[2]-t,n=this._renderBoundaries[3]-e,r=this._width,o=this._height,a=this._opacity,s=this._maxOpacity,u=this._minOpacity,h=this._useGradientOpacity;t<0&&(t=0),e<0&&(e=0),t+i>r&&(i=r-t),e+n>o&&(n=o-e);for(var c=this.shadowCtx.getImageData(t,e,i,n),l=c.data,d=l.length,f=this._palette,p=3;p<d;p+=4){var v,y=l[p],g=4*y;g&&(v=a>0?a:y<s?y<u?u:y:s,l[p-3]=f[g],l[p-2]=f[g+1],l[p-1]=f[g+2],l[p]=h?f[g+3]:v)}c.data=l,this.ctx.putImageData(c,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],i=this._max,n=this._min;return Math.abs(i-n)*(e/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},i}(),r=(t=!1,"canvas2d"===e.defaultRenderer&&(t=n),t),o=function(){for(var t={},e=arguments.length,i=0;i<e;i++){var n=arguments[i];for(var r in n)t[r]=n[r]}return t},a=function(){var t=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,i){var n=this.cStore;n[t]||(n[t]=[]),n[t].push((function(t){return e.call(i,t)}))},emit:function(t,e){var i=this.cStore;if(i[t])for(var n=i[t].length,r=0;r<n;r++)(0,i[t][r])(e)}},t}(),n=function(t){var e=t._renderer,i=t._coordinator,n=t._store;i.on("renderpartial",e.renderPartial,e),i.on("renderall",e.renderAll,e),i.on("extremachange",(function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config.gradient||t._config.defaultGradient})})),n.setCoordinator(i)};function a(){var a=this._config=o(e,arguments[0]||{});if(this._coordinator=new t,a.plugin){var s=a.plugin;if(!e.plugins[s])throw new Error("Plugin '"+s+"' not found. Maybe it was not registered.");var u=e.plugins[s];this._renderer=new u.renderer(a),this._store=new u.store(a)}else this._renderer=new r(a),this._store=new i(a);n(this)}return a.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=o(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},a}();return{create:function(t){return new a(t)},register:function(t,i){e.plugins[t]=i}}},t.exports?t.exports=o():void 0===(r="function"==typeof(n=o)?n.call(e,i,e,t):n)||(t.exports=r)},99726:(t,e,i)=>{var n,r;function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}t=i.nmd(t),function(a){"use strict";"function"==typeof bootstrap?bootstrap("promise",a):"object"===o(e)&&"object"===o(t)?t.exports=a():void 0===(r="function"==typeof(n=a)?n.call(e,i,e,t):n)||(t.exports=r)}((function(){"use strict";var t=!1;try{throw new Error}catch(e){t=!!e.stack}var e,i=x(),n=function(){},r=function(){var t={task:void 0,next:null},e=t,i=!1,n=void 0,a=!1,s=[];function u(){for(var e,n;t.next;)e=(t=t.next).task,t.task=void 0,(n=t.domain)&&(t.domain=void 0,n.enter()),h(e,n);for(;s.length;)h(e=s.pop());i=!1}function h(t,e){try{t()}catch(t){if(a)throw e&&e.exit(),setTimeout(u,0),e&&e.enter(),t;setTimeout((function(){throw t}),0)}e&&e.exit()}if(r=function(t){e=e.next={task:t,domain:a&&process.domain,next:null},i||(i=!0,n())},"object"===("undefined"==typeof process?"undefined":o(process))&&"[object process]"===process.toString()&&process.nextTick)a=!0,n=function(){process.nextTick(u)};else if("function"==typeof setImmediate)n="undefined"!=typeof window?setImmediate.bind(window,u):function(){setImmediate(u)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=function(){n=l,c.port1.onmessage=u,u()};var l=function(){c.port2.postMessage(0)};n=function(){setTimeout(u,0),l()}}else n=function(){setTimeout(u,0)};return r.runAfter=function(t){s.push(t),i||(i=!0,n())},r}(),a=Function.call;function s(t){return function(){return a.apply(t,arguments)}}var u,h=s(Array.prototype.slice),c=s(Array.prototype.reduce||function(t,e){var i=0,n=this.length;if(1===arguments.length)for(;;){if(i in this){e=this[i++];break}if(++i>=n)throw new TypeError}for(;i<n;i++)i in this&&(e=t(e,this[i],i));return e}),l=s(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),d=s(Array.prototype.map||function(t,e){var i=this,n=[];return c(i,(function(r,o,a){n.push(t.call(e,o,a,i))}),void 0),n}),f=Object.create||function(t){function e(){}return e.prototype=t,new e},p=Object.defineProperty||function(t,e,i){return t[e]=i.value,t},v=s(Object.prototype.hasOwnProperty),y=Object.keys||function(t){var e=[];for(var i in t)v(t,i)&&e.push(i);return e},g=s(Object.prototype.toString);function m(t){return"[object StopIteration]"===g(t)||t instanceof u}function w(e,i){if(t&&i.stack&&"object"===o(e)&&null!==e&&e.stack){for(var n=[],r=i;r;r=r.source)r.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>r.stackCounter)&&(p(e,"__minimumStackCounter__",{value:r.stackCounter,configurable:!0}),n.unshift(r.stack));n.unshift(e.stack);var a=function(t){for(var e=t.split("\n"),i=[],n=0;n<e.length;++n){var r=e[n];_(r)||(-1!==(o=r).indexOf("(module.js:")||-1!==o.indexOf("(node.js:"))||!r||i.push(r)}var o;return i.join("\n")}(n.join("\nFrom previous event:\n"));p(e,"stack",{value:a,configurable:!0})}}function b(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var i=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(i)return[i[1],Number(i[2])];var n=/.*@(.+):(\d+)$/.exec(t);return n?[n[1],Number(n[2])]:void 0}function _(t){var n=b(t);if(!n)return!1;var r=n[0],o=n[1];return r===e&&o>=i&&o<=q}function x(){if(t)try{throw new Error}catch(t){var i=t.stack.split("\n"),n=b(i[0].indexOf("@")>0?i[1]:i[2]);if(!n)return;return e=n[0],n[1]}}function E(t){return t instanceof M?t:A(t)?function(t){var e=T();return E.nextTick((function(){try{t.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}})),e.promise}(t):L(t)}u="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t},E.resolve=E,E.nextTick=r,E.longStackSupport=!1;var R=1;function T(){var e,i=[],n=[],r=f(T.prototype),o=f(M.prototype);if(o.promiseDispatch=function(t,r,o){var a=h(arguments);i?(i.push(a),"when"===r&&o[1]&&n.push(o[1])):E.nextTick((function(){e.promiseDispatch.apply(e,a)}))},o.valueOf=function(){if(i)return o;var t=C(e);return O(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},E.longStackSupport&&t)try{throw new Error}catch(t){o.stack=t.stack.substring(t.stack.indexOf("\n")+1),o.stackCounter=R++}function a(r){e=r,E.longStackSupport&&t&&(o.source=r),c(i,(function(t,e){E.nextTick((function(){r.promiseDispatch.apply(r,e)}))}),void 0),i=void 0,n=void 0}return r.promise=o,r.resolve=function(t){e||a(E(t))},r.fulfill=function(t){e||a(L(t))},r.reject=function(t){e||a(F(t))},r.notify=function(t){e||c(n,(function(e,i){E.nextTick((function(){i(t)}))}),void 0)},r}function S(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=T();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function k(t){return S((function(e,i){for(var n=0,r=t.length;n<r;n++)E(t[n]).then(e,i)}))}function M(t,e,i){void 0===e&&(e=function(t){return F(new Error("Promise does not support operation: "+t))}),void 0===i&&(i=function(){return{state:"unknown"}});var n=f(M.prototype);if(n.promiseDispatch=function(i,r,o){var a;try{a=t[r]?t[r].apply(n,o):e.call(n,r,o)}catch(t){a=F(t)}i&&i(a)},n.inspect=i,i){var r=i();"rejected"===r.state&&(n.exception=r.reason),n.valueOf=function(){var t=i();return"pending"===t.state||"rejected"===t.state?n:t.value}}return n}function P(t,e,i,n){return E(t).then(e,i,n)}function C(t){if(O(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function O(t){return t instanceof M}function A(t){return(e=t)===Object(e)&&"function"==typeof t.then;var e}"object"===("undefined"==typeof process?"undefined":o(process))&&process&&process.env&&process.env.Q_DEBUG&&(E.longStackSupport=!0),E.defer=T,T.prototype.makeNodeResolver=function(){var t=this;return function(e,i){e?t.reject(e):arguments.length>2?t.resolve(h(arguments,1)):t.resolve(i)}},E.Promise=S,E.promise=S,S.race=k,S.all=G,S.reject=F,S.resolve=E,E.passByCopy=function(t){return t},M.prototype.passByCopy=function(){return this},E.join=function(t,e){return E(t).join(e)},M.prototype.join=function(t){return E([this,t]).spread((function(t,e){if(t===e)return t;throw new Error("Q can't join: not the same: "+t+" "+e)}))},E.race=k,M.prototype.race=function(){return this.then(E.race)},E.makePromise=M,M.prototype.toString=function(){return"[object Promise]"},M.prototype.then=function(t,e,i){var n=this,r=T(),o=!1;return E.nextTick((function(){n.promiseDispatch((function(e){o||(o=!0,r.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(t){return F(t)}}(e)))}),"when",[function(t){o||(o=!0,r.resolve(function(t){if("function"==typeof e){w(t,n);try{return e(t)}catch(t){return F(t)}}return F(t)}(t)))}])})),n.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=function(t){return"function"==typeof i?i(t):t}(t)}catch(t){if(n=!0,!E.onerror)throw t;E.onerror(t)}n||r.notify(e)}]),r.promise},E.tap=function(t,e){return E(t).tap(e)},M.prototype.tap=function(t){return t=E(t),this.then((function(e){return t.fcall(e).thenResolve(e)}))},E.when=P,M.prototype.thenResolve=function(t){return this.then((function(){return t}))},E.thenResolve=function(t,e){return E(t).thenResolve(e)},M.prototype.thenReject=function(t){return this.then((function(){throw t}))},E.thenReject=function(t,e){return E(t).thenReject(e)},E.nearer=C,E.isPromise=O,E.isPromiseAlike=A,E.isPending=function(t){return O(t)&&"pending"===t.inspect().state},M.prototype.isPending=function(){return"pending"===this.inspect().state},E.isFulfilled=function(t){return!O(t)||"fulfilled"===t.inspect().state},M.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},E.isRejected=function(t){return O(t)&&"rejected"===t.inspect().state},M.prototype.isRejected=function(){return"rejected"===this.inspect().state};var D,I,j=[],V=[],H=[],B=!0;function U(){j.length=0,V.length=0,B||(B=!0)}function F(t){var e=M({when:function(e){return e&&function(t){if(B){var e=l(V,t);-1!==e&&("object"===("undefined"==typeof process?"undefined":o(process))&&"function"==typeof process.emit&&E.nextTick.runAfter((function(){var i=l(H,t);-1!==i&&(process.emit("rejectionHandled",j[e],t),H.splice(i,1))})),V.splice(e,1),j.splice(e,1))}}(this),e?e(t):this}},(function(){return this}),(function(){return{state:"rejected",reason:t}}));return function(t,e){B&&("object"===("undefined"==typeof process?"undefined":o(process))&&"function"==typeof process.emit&&E.nextTick.runAfter((function(){-1!==l(V,t)&&(process.emit("unhandledRejection",e,t),H.push(t))})),V.push(t),e&&void 0!==e.stack?j.push(e.stack):j.push("(no stack) "+e))}(e,t),e}function L(t){return M({when:function(){return t},get:function(e){return t[e]},set:function(e,i){t[e]=i},delete:function(e){delete t[e]},post:function(e,i){return null==e?t.apply(void 0,i):t[e].apply(t,i)},apply:function(e,i){return t.apply(e,i)},keys:function(){return y(t)}},void 0,(function(){return{state:"fulfilled",value:t}}))}function z(t,e,i){return E(t).spread(e,i)}function N(t,e,i){return E(t).dispatch(e,i)}function G(t){return P(t,(function(t){var e=0,i=T();return c(t,(function(n,r,o){var a;O(r)&&"fulfilled"===(a=r.inspect()).state?t[o]=a.value:(++e,P(r,(function(n){t[o]=n,0==--e&&i.resolve(t)}),i.reject,(function(t){i.notify({index:o,value:t})})))}),void 0),0===e&&i.resolve(t),i.promise}))}function W(t){if(0===t.length)return E.resolve();var e=E.defer(),i=0;return c(t,(function(n,r,o){var a=t[o];i++,P(a,(function(t){e.resolve(t)}),(function(t){if(0==--i){var n=t||new Error(""+t);n.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+n.message,e.reject(n)}}),(function(t){e.notify({index:o,value:t})}))}),void 0),e.promise}function X(t){return P(t,(function(t){return t=d(t,E),P(G(d(t,(function(t){return P(t,n,n)}))),(function(){return t}))}))}E.resetUnhandledRejections=U,E.getUnhandledReasons=function(){return j.slice()},E.stopUnhandledRejectionTracking=function(){U(),B=!1},U(),E.reject=F,E.fulfill=L,E.master=function(t){return M({isDef:function(){}},(function(e,i){return N(t,e,i)}),(function(){return E(t).inspect()}))},E.spread=z,M.prototype.spread=function(t,e){return this.all().then((function(e){return t.apply(void 0,e)}),e)},E.async=function(t){return function(){function e(t,e){var o;if("undefined"==typeof StopIteration){try{o=i[t](e)}catch(t){return F(t)}return o.done?E(o.value):P(o.value,n,r)}try{o=i[t](e)}catch(t){return m(t)?E(t.value):F(t)}return P(o,n,r)}var i=t.apply(this,arguments),n=e.bind(e,"next"),r=e.bind(e,"throw");return n()}},E.spawn=function(t){E.done(E.async(t)())},E.return=function(t){throw new u(t)},E.promised=function(t){return function(){return z([this,G(arguments)],(function(e,i){return t.apply(e,i)}))}},E.dispatch=N,M.prototype.dispatch=function(t,e){var i=this,n=T();return E.nextTick((function(){i.promiseDispatch(n.resolve,t,e)})),n.promise},E.get=function(t,e){return E(t).dispatch("get",[e])},M.prototype.get=function(t){return this.dispatch("get",[t])},E.set=function(t,e,i){return E(t).dispatch("set",[e,i])},M.prototype.set=function(t,e){return this.dispatch("set",[t,e])},E.del=E.delete=function(t,e){return E(t).dispatch("delete",[e])},M.prototype.del=M.prototype.delete=function(t){return this.dispatch("delete",[t])},E.mapply=E.post=function(t,e,i){return E(t).dispatch("post",[e,i])},M.prototype.mapply=M.prototype.post=function(t,e){return this.dispatch("post",[t,e])},E.send=E.mcall=E.invoke=function(t,e){return E(t).dispatch("post",[e,h(arguments,2)])},M.prototype.send=M.prototype.mcall=M.prototype.invoke=function(t){return this.dispatch("post",[t,h(arguments,1)])},E.fapply=function(t,e){return E(t).dispatch("apply",[void 0,e])},M.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},E.try=E.fcall=function(t){return E(t).dispatch("apply",[void 0,h(arguments,1)])},M.prototype.fcall=function(){return this.dispatch("apply",[void 0,h(arguments)])},E.fbind=function(t){var e=E(t),i=h(arguments,1);return function(){return e.dispatch("apply",[this,i.concat(h(arguments))])}},M.prototype.fbind=function(){var t=this,e=h(arguments);return function(){return t.dispatch("apply",[this,e.concat(h(arguments))])}},E.keys=function(t){return E(t).dispatch("keys",[])},M.prototype.keys=function(){return this.dispatch("keys",[])},E.all=G,M.prototype.all=function(){return G(this)},E.any=W,M.prototype.any=function(){return W(this)},E.allResolved=(D=X,I="allResolved","allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(I+" is deprecated, use "+"allSettled instead.",new Error("").stack),D.apply(D,arguments)}),M.prototype.allResolved=function(){return X(this)},E.allSettled=function(t){return E(t).allSettled()},M.prototype.allSettled=function(){return this.then((function(t){return G(d(t,(function(t){function e(){return t.inspect()}return(t=E(t)).then(e,e)})))}))},E.fail=E.catch=function(t,e){return E(t).then(void 0,e)},M.prototype.fail=M.prototype.catch=function(t){return this.then(void 0,t)},E.progress=function(t,e){return E(t).then(void 0,void 0,e)},M.prototype.progress=function(t){return this.then(void 0,void 0,t)},E.fin=E.finally=function(t,e){return E(t).finally(e)},M.prototype.fin=M.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw new Error("Q can't apply finally callback");return t=E(t),this.then((function(e){return t.fcall().then((function(){return e}))}),(function(e){return t.fcall().then((function(){throw e}))}))},E.done=function(t,e,i,n){return E(t).done(e,i,n)},M.prototype.done=function(t,e,i){var n=function(t){E.nextTick((function(){if(w(t,r),!E.onerror)throw t;E.onerror(t)}))},r=t||e||i?this.then(t,e,i):this;"object"===("undefined"==typeof process?"undefined":o(process))&&process&&process.domain&&(n=process.domain.bind(n)),r.then(void 0,n)},E.timeout=function(t,e,i){return E(t).timeout(e,i)},M.prototype.timeout=function(t,e){var i=T(),n=setTimeout((function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),i.reject(e)}),t);return this.then((function(t){clearTimeout(n),i.resolve(t)}),(function(t){clearTimeout(n),i.reject(t)}),i.notify),i.promise},E.delay=function(t,e){return void 0===e&&(e=t,t=void 0),E(t).delay(e)},M.prototype.delay=function(t){return this.then((function(e){var i=T();return setTimeout((function(){i.resolve(e)}),t),i.promise}))},E.nfapply=function(t,e){return E(t).nfapply(e)},M.prototype.nfapply=function(t){var e=T(),i=h(t);return i.push(e.makeNodeResolver()),this.fapply(i).fail(e.reject),e.promise},E.nfcall=function(t){var e=h(arguments,1);return E(t).nfapply(e)},M.prototype.nfcall=function(){var t=h(arguments),e=T();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},E.nfbind=E.denodeify=function(t){if(void 0===t)throw new Error("Q can't wrap an undefined function");var e=h(arguments,1);return function(){var i=e.concat(h(arguments)),n=T();return i.push(n.makeNodeResolver()),E(t).fapply(i).fail(n.reject),n.promise}},M.prototype.nfbind=M.prototype.denodeify=function(){var t=h(arguments);return t.unshift(this),E.denodeify.apply(void 0,t)},E.nbind=function(t,e){var i=h(arguments,2);return function(){var n=i.concat(h(arguments)),r=T();function o(){return t.apply(e,arguments)}return n.push(r.makeNodeResolver()),E(o).fapply(n).fail(r.reject),r.promise}},M.prototype.nbind=function(){var t=h(arguments,0);return t.unshift(this),E.nbind.apply(void 0,t)},E.nmapply=E.npost=function(t,e,i){return E(t).npost(e,i)},M.prototype.nmapply=M.prototype.npost=function(t,e){var i=h(e||[]),n=T();return i.push(n.makeNodeResolver()),this.dispatch("post",[t,i]).fail(n.reject),n.promise},E.nsend=E.nmcall=E.ninvoke=function(t,e){var i=h(arguments,2),n=T();return i.push(n.makeNodeResolver()),E(t).dispatch("post",[e,i]).fail(n.reject),n.promise},M.prototype.nsend=M.prototype.nmcall=M.prototype.ninvoke=function(t){var e=h(arguments,1),i=T();return e.push(i.makeNodeResolver()),this.dispatch("post",[t,e]).fail(i.reject),i.promise},E.nodeify=function(t,e){return E(t).nodeify(e)},M.prototype.nodeify=function(t){if(!t)return this;this.then((function(e){E.nextTick((function(){t(null,e)}))}),(function(e){E.nextTick((function(){t(e)}))}))},E.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var q=x();return E}))},98662:t=>{"use strict";t.exports=THREE}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var n={};(()=>{"use strict";i.r(n);var t={};i.r(t),i.d(t,{CustomViewable:()=>L,SpriteViewable:()=>z,ViewableData:()=>N,ViewableStyle:()=>F,ViewableType:()=>U});var e=i(84213),r=i.n(e);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function h(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}var l=Autodesk.Viewing,d=l.GlobalManagerMixin,f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(d,t);var i,n,r,o,l=(r=d,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(r);if(o){var i=c(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return h(this,t)});function d(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,d),(e=l.call(this)).names=["HyperionTool"],e.options=i,e.setGlobalManager(t.globalManager),e.viewer=t,e.delegate=i.delegate,e.init(),e.hoveringDbId=0,e.selectedDbId=0,e}return i=d,(n=[{key:"init",value:function(){var t=this,i=this.viewer.impl;this.activate=function(e){t.active=!0},this.deactivate=function(e){t.clearMarkedObject(),t.active=!1},this.handleSingleClick=function(n,r){var o=!1;if(0===r){var a=i.clientToViewport(n.canvasX,n.canvasY),s=i.renderer(),u=s.getOverlayIdTarget();if(!u)return!1;var h=s.idAtPixel(a.x,a.y,[],[u]);if(t.selectedDbId!=h||0==t.selectedDbId){if(t.selectedDbId){var c={type:e.MOUSE_CLICK_OUT,dbId:t.selectedDbId,originalEvent:n};t.viewer.dispatchEvent(c),c.hasStopped||(t.clearMarkedObject(),t.viewer.impl.invalidate(!1,!1,!0))}t.selectedDbId=h;var l=i.hitTestViewport(a.clone(),!1),d={type:e.MOUSE_CLICK,dbId:h,clickInfo:l,originalEvent:n};t.viewer.dispatchEvent(d),d.hasStopped||(t.markObject([h]),t.viewer.impl.invalidate(!1,!1,!0)),t.selectedDbId&&(o=!0)}}return o},this.handleSingleTap=function(e){return t.handleSingleClick(e,0)},this.handleDoubleClick=function(t,e){return!1},this.handleButtonDown=function(e){return t.buttonDown=!0,!1},this.handleButtonUp=function(e){return t.buttonDown=!1,!1},this.handleMouseMove=function(n){if(!t.buttonDown){var r=i.clientToViewport(n.canvasX,n.canvasY),o=i.renderer().getOverlayIdTarget();if(!o)return!1;var a=i.renderer().idAtPixel(r.x,r.y,[],[o]);if(t.hoveringDbId!=a){var s=0!=a?a:t.hoveringDbId;t.hoveringDbId=a;var u=0!=a;return t.viewer.dispatchEvent({type:e.MOUSE_HOVERING,dbId:s,hovering:u,originalEvent:n}),!0}}},this.markObject=function(e){if(e instanceof Array||(e=[e]),t.delegate.hasViewables){var i=t.delegate.mapDbIdsToGeometries(e),n=new Set(e);i.map((function(e){if(e&&e.attributes.id&&e.attributes.pointScale){for(var i=e.attributes.pointScale.array,r=e.attributes.uvp.array,o=e.attributes.color.array,a=e.attributes.id.array,s=0;s<a.length;s+=3){var u=a[s]+(a[s+1]<<8)+(a[s+2]<<16),h=s/3,c=n.has(u);i[h]=c?1.5:1;var l=t.delegate.viewableData.getViewableUV(u,c);l&&(r[4*h]=l.x,r[4*h+1]=l.y,r[4*h+2]=l.w,r[4*h+3]=l.h);var d=t.delegate.viewableData.getViewableColor(u,c);d&&(o[3*h]=255*d.r,o[3*h+1]=255*d.g,o[3*h+2]=255*d.b)}e.attributes.pointScale.needsUpdate=!0,e.attributes.uvp.needsUpdate=!0,e.attributes.color.needsUpdate=!0}})),t.markedFragments=i}},this.clearMarkedObject=function(){if(t.delegate.hasViewables){var e=t.markedFragments||[];t.markedFragments=[],e&&(e.map((function(e){if(e&&e.attributes.pointScale){for(var i=e.attributes.pointScale.array,n=e.attributes.uvp.array,r=e.attributes.color.array,o=e.attributes.id.array,a=0;a<o.length;a+=3){var s=o[a]+(o[a+1]<<8)+(o[a+2]<<16),u=a/3;i[u]=1;var h=t.delegate.viewableData.getViewableUV(s,!1);h&&(n[4*u]=h.x,n[4*u+1]=h.y,n[4*u+2]=h.w,n[4*u+3]=h.h);var c=t.delegate.viewableData.getViewableColor(s,!1);c&&(r[3*u]=255*c.r,r[3*u+1]=255*c.g,r[3*u+2]=255*c.b)}e.attributes.pointScale.needsUpdate=!0,e.attributes.uvp.needsUpdate=!0,e.attributes.color.needsUpdate=!0}})),t.viewer.impl.invalidate(!1,!1,!0))}else t.markedFragments=[]},this.invalidateViewablesDirect=function(e,i,n,r){if(!e||!i||!r)throw new Error("Parameters of 'invalidateViewables' are mandatory");e instanceof Array||(e=[e]);var o=new Set(e),a=new Map;n.viewables.forEach((function(t){return a.set(t.dbId,t)}));for(var s=!1,u=i[0].geometry,h=u.attributes.id.array,c=0;c<h.length;c+=3){var l=h[c]+(h[c+1]<<8)+(h[c+2]<<16);if(o.has(l)){var d=r(a.get(l));if(d){var f=c/3;if(d.position){var p=u.attributes.position.array;u.attributes.position.needsUpdate=!0,p[3*f+0]=d.position.x,p[3*f+1]=d.position.y,p[3*f+2]=d.position.z,s=!0}if(d.url){var v=n.getSpriteUV(d.url);if(v){var y=u.attributes.uvp.array;u.attributes.uvp.needsUpdate=!0,y[4*f+0]=v.x,y[4*f+1]=v.y,y[4*f+2]=v.w,y[4*f+3]=v.h,s=!0}}if(d.color){var g=u.attributes.color.array;u.attributes.color.needsUpdate=!0,g[3*f+0]=255*d.color.r,g[3*f+1]=255*d.color.g,g[3*f+2]=255*d.color.b,s=!0}if(void 0!==d.scale){if(d.scale>2||d.scale<0){var m="invalidateViewables: 'scale' of '".concat(d.scale,"' out of range [0, 2]");console.warn(m)}var w=u.attributes.pointScale.array;u.attributes.pointScale.needsUpdate=!0,w[f]=d.scale,s=!0}}}}s&&t.viewer.impl.invalidate(!1,!1,!0)}}}])&&s(i.prototype,n),d}(l.ToolInterface);d.call(f.prototype);var p=i(79895);class v{constructor(t=0,e=0,i=0,n=0,r=!1,o){this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=t,this._height=e,this._x=i,this._y=n,this._data={},this._rot=r,this._allowRotation=o}static Collide(t,e){return t.collide(e)}static Contain(t,e){return t.contain(e)}area(){return this.width*this.height}collide(t){return t.x<this.x+this.width&&t.x+t.width>this.x&&t.y<this.y+this.height&&t.y+t.height>this.y}contain(t){return t.x>=this.x&&t.y>=this.y&&t.x+t.width<=this.x+this.width&&t.y+t.height<=this.y+this.height}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._dirty++)}get height(){return this._height}set height(t){t!==this._height&&(this._height=t,this._dirty++)}get x(){return this._x}set x(t){t!==this._x&&(this._x=t,this._dirty++)}get y(){return this._y}set y(t){t!==this._y&&(this._y=t,this._dirty++)}get rot(){return this._rot}set rot(t){if(!1!==this._allowRotation&&this._rot!==t){const e=this.width;this.width=this.height,this.height=e,this._rot=t,this._dirty++}}get allowRotation(){return this._allowRotation}set allowRotation(t){this._allowRotation!==t&&(this._allowRotation=t,this._dirty++)}get data(){return this._data}set data(t){null!==t&&t!==this._data&&(this._data=t,"object"==typeof t&&t.hasOwnProperty("allowRotation")&&(this._allowRotation=t.allowRotation),this._dirty++)}get dirty(){return this._dirty>0}setDirty(t=!0){this._dirty=t?this._dirty+1:0}}class y{constructor(){this._dirty=0}get dirty(){return this._dirty>0||this.rects.some((t=>t.dirty))}setDirty(t=!0){if(this._dirty=t?this._dirty+1:0,!t)for(let t of this.rects)t.setDirty&&t.setDirty(!1)}}class g extends y{constructor(t=w,e=w,i=0,n={}){super(),this.maxWidth=t,this.maxHeight=e,this.padding=i,this.freeRects=[],this.rects=[],this.verticalExpand=!1,this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:b.MAX_EDGE},this.options=Object.assign(Object.assign({},this.options),n),this.width=this.options.smart?0:t,this.height=this.options.smart?0:e,this.border=this.options.border?this.options.border:0,this.freeRects.push(new v(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new v(this.width,this.height)}add(...t){let e,i;if(1===t.length){if("object"!=typeof t[0])throw new Error("MacrectsBin.add(): Wrong parameters");i=t[0];let e=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(this.options.tag&&this.options.exclusiveTag&&this.tag!==e)return}else{if(e=t.length>2?t[2]:null,this.options.tag&&this.options.exclusiveTag){if(e&&this.tag!==e.tag)return;if(!e&&this.tag)return}i=new v(t[0],t[1]),i.data=e,i.setDirty(!1)}const n=this.place(i);return n&&this.rects.push(n),n}repack(){let t=[];this.reset(),this.rects.sort(((t,e)=>{const i=Math.max(e.width,e.height)-Math.max(t.width,t.height);return 0===i&&t.hash&&e.hash?t.hash>e.hash?-1:1:i}));for(let e of this.rects)this.place(e)||t.push(e);for(let e of t)this.rects.splice(this.rects.indexOf(e),1);return t.length>0?t:void 0}reset(t=!1,e=!1){t&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],e&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new v(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new v(this.width,this.height),this._dirty=0}clone(){let t=new g(this.maxWidth,this.maxHeight,this.padding,this.options);for(let e of this.rects)t.add(e);return t}place(t){let e,i,n=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;if(!this.options.tag||!this.options.exclusiveTag||this.tag===n){if(i=t.hasOwnProperty("_allowRotation")&&void 0!==t.allowRotation?t.allowRotation:this.options.allowRotation,e=this.findNode(t.width+this.padding,t.height+this.padding,i),e){this.updateBinSize(e);let i=this.freeRects.length,n=0;for(;n<i;)this.splitNode(this.freeRects[n],e)&&(this.freeRects.splice(n,1),i--,n--),n++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,t.x=e.x,t.y=e.y,void 0===t.rot&&(t.rot=!1),t.rot=e.rot?!t.rot:t.rot,this._dirty++,t}if(this.verticalExpand){if(this.updateBinSize(new v(t.width+this.padding,t.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new v(t.width+this.padding,t.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(t)}else if(this.updateBinSize(new v(t.width+this.padding,t.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new v(t.width+this.padding,t.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(t)}}findNode(t,e,i){let n,r,o,a=Number.MAX_VALUE;for(let s in this.freeRects)r=this.freeRects[s],r.width>=t&&r.height>=e&&(n=this.options.logic===b.MAX_AREA?r.width*r.height-t*e:Math.min(r.width-t,r.height-e),n<a&&(o=new v(t,e,r.x,r.y),a=n)),i&&r.width>=e&&r.height>=t&&(n=this.options.logic===b.MAX_AREA?r.width*r.height-e*t:Math.min(r.height-t,r.width-e),n<a&&(o=new v(e,t,r.x,r.y,!0),a=n));return o}splitNode(t,e){if(!t.collide(e))return!1;if(e.x<t.x+t.width&&e.x+e.width>t.x){if(e.y>t.y&&e.y<t.y+t.height){let i=new v(t.width,e.y-t.y,t.x,t.y);this.freeRects.push(i)}if(e.y+e.height<t.y+t.height){let i=new v(t.width,t.y+t.height-(e.y+e.height),t.x,e.y+e.height);this.freeRects.push(i)}}if(e.y<t.y+t.height&&e.y+e.height>t.y){if(e.x>t.x&&e.x<t.x+t.width){let i=new v(e.x-t.x,t.height,t.x,t.y);this.freeRects.push(i)}if(e.x+e.width<t.x+t.width){let i=new v(t.x+t.width-(e.x+e.width),t.height,e.x+e.width,t.y);this.freeRects.push(i)}}return!0}pruneFreeList(){let t=0,e=0,i=this.freeRects.length;for(;t<i;){e=t+1;let n=this.freeRects[t];for(;e<i;){let r=this.freeRects[e];if(r.contain(n)){this.freeRects.splice(t,1),t--,i--;break}n.contain(r)&&(this.freeRects.splice(e,1),e--,i--),e++}t++}}updateBinSize(t){if(!this.options.smart)return!1;if(this.stage.contain(t))return!1;let e=Math.max(this.width,t.x+t.width-this.padding+this.border),i=Math.max(this.height,t.y+t.height-this.padding+this.border);if(this.options.allowRotation){const n=Math.max(this.width,t.x+t.height-this.padding+this.border),r=Math.max(this.height,t.y+t.width-this.padding+this.border);n*r<e*i&&(e=n,i=r)}return this.options.pot&&(e=Math.pow(2,Math.ceil(Math.log(e)*Math.LOG2E)),i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E))),this.options.square&&(e=i=Math.max(e,i)),!(e>this.maxWidth+this.padding||i>this.maxHeight+this.padding||(this.expandFreeRects(e+this.padding,i+this.padding),this.width=this.stage.width=e,this.height=this.stage.height=i,0))}expandFreeRects(t,e){this.freeRects.forEach(((i,n)=>{i.x+i.width>=Math.min(this.width+this.padding-this.border,t)&&(i.width=t-i.x-this.border),i.y+i.height>=Math.min(this.height+this.padding-this.border,e)&&(i.height=e-i.y-this.border)}),this),this.freeRects.push(new v(t-this.width-this.padding,e-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new v(t-2*this.border,e-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter((t=>!(t.width<=0||t.height<=0||t.x<this.border||t.y<this.border))),this.pruneFreeList()}}class m extends y{constructor(...t){if(super(),this.rects=[],1===t.length){if("object"!=typeof t[0])throw new Error("OversizedElementBin: Wrong parameters");const e=t[0];this.rects=[e],this.width=e.width,this.height=e.height,this.data=e.data,e.oversized=!0}else{this.width=t[0],this.height=t[1],this.data=t.length>2?t[2]:null;const e=new v(this.width,this.height);e.oversized=!0,e.data=this.data,this.rects.push(e)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(t=!1){}repack(){}clone(){return new m(this.rects[0])}}const w=4096;var b;!function(t){t[t.MAX_AREA=0]="MAX_AREA",t[t.MAX_EDGE=1]="MAX_EDGE"}(b||(b={}));class _{constructor(t=w,e=w,i=0,n={}){this.width=t,this.height=e,this.padding=i,this.options={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:b.MAX_EDGE},this._currentBinIndex=0,this.bins=[],this.options=Object.assign(Object.assign({},this.options),n)}add(...t){if(1===t.length){if("object"!=typeof t[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const e=t[0];if(e.width>this.width||e.height>this.height)this.bins.push(new m(e));else if(!this.bins.slice(this._currentBinIndex).find((t=>void 0!==t.add(e)))){let t=new g(this.width,this.height,this.padding,this.options),i=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;this.options.tag&&i&&(t.tag=i),t.add(e),this.bins.push(t)}return e}{const e=new v(t[0],t[1]);if(t.length>2&&(e.data=t[2]),e.width>this.width||e.height>this.height)this.bins.push(new m(e));else if(!this.bins.slice(this._currentBinIndex).find((t=>void 0!==t.add(e)))){let t=new g(this.width,this.height,this.padding,this.options);this.options.tag&&e.data.tag&&(t.tag=e.data.tag),t.add(e),this.bins.push(t)}return e}}addArray(t){if(!this.options.tag||this.options.exclusiveTag)this.sort(t,this.options.logic).forEach((t=>this.add(t)));else{if(0===t.length)return;let e;t.sort(((t,e)=>{const i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0,n=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;return void 0===n?-1:void 0===i?1:n>i?-1:1}));let i=0;if(!this.bins.slice(this._currentBinIndex).find((n=>{let r=n.clone();for(let o=i;o<t.length;o++){const a=t[o],s=a.data&&a.data.tag?a.data.tag:a.tag?a.tag:void 0;if(0===o&&(e=s),s!==e)return e=s,this.sort(t.slice(i,o),this.options.logic).forEach((t=>n.add(t))),i=o,this.addArray(t.slice(o)),!0;if(void 0===s)return this.sort(t.slice(o),this.options.logic).forEach((t=>this.add(t))),i=t.length,!0;if(void 0===r.add(a))return!1}return this.sort(t.slice(i),this.options.logic).forEach((t=>n.add(t))),!0}))){const e=t[i],n=new g(this.width,this.height,this.padding,this.options),r=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;this.options.tag&&this.options.exclusiveTag&&r&&(n.tag=r),this.bins.push(n),this.addArray(t.slice(i))}}}reset(){this.bins=[],this._currentBinIndex=0}repack(t=!0){if(t){let t=[];for(let e of this.bins)if(e.dirty){let i=e.repack();i&&t.push(...i)}return void this.addArray(t)}if(!this.dirty)return;const e=this.rects;this.reset(),this.addArray(e)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(t){t.forEach(((t,e)=>{if(t.maxWidth>this.width||t.maxHeight>this.height)this.bins.push(new m(t.width,t.height,{}));else{let i=new g(this.width,this.height,this.padding,t.options);i.freeRects.splice(0),t.freeRects.forEach(((t,e)=>{i.freeRects.push(new v(t.width,t.height,t.x,t.y))})),i.width=t.width,i.height=t.height,t.tag&&(i.tag=t.tag),this.bins[e]=i}}),this)}save(){let t=[];return this.bins.forEach((e=>{let i={width:e.width,height:e.height,maxWidth:e.maxWidth,maxHeight:e.maxHeight,freeRects:[],rects:[],options:e.options};e.tag&&(i=Object.assign(Object.assign({},i),{tag:e.tag})),e.freeRects.forEach((t=>{i.freeRects.push({x:t.x,y:t.y,width:t.width,height:t.height})})),t.push(i)})),t}sort(t,e=b.MAX_EDGE){return t.slice().sort(((t,i)=>{const n=e===b.MAX_EDGE?Math.max(i.width,i.height)-Math.max(t.width,t.height):i.width*i.height-t.width*t.height;return 0===n&&t.hash&&i.hash?t.hash>i.hash?-1:1:n}))}get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some((t=>t.dirty))}get rects(){let t=[];for(let e of this.bins)t.push(...e.rects);return t}}var x=i(99726),E=i.n(x);function R(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var k=Autodesk.Viewing.Private,M=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1920,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1080,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;T(this,t),this.width=e,this.height=i,this.padding=n,this.spritesMap={},this.pending=[],this.images=[],this.logger=k.logger,this.packer=new _(this.width,this.height,this.padding,{smart:!0,pot:!1,square:!1,allowRotation:!1,tag:!1,border:0}),this.canvas=document.createElement("canvas"),this.hasContent=!1}var e,i,n,r;return e=t,i=[{key:"addSprite",value:function(t){var e=this;if(null==this.spritesMap[t]){var i=E().defer(),n=new Image;n.crossOrigin="anonymous",n.onload=function(){e.images.push({url:t,image:n,width:n.width,height:n.height}),i.resolve()},n.onerror=function(t){e.logger.error(t),i.resolve()},n.src=t,this.spritesMap[t]=1,this.pending.push(i.promise)}}},{key:"finish",value:(n=regeneratorRuntime.mark((function t(){var e,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E().all(this.pending);case 2:e=this.canvas,this.packer.addArray(this.images),this.images.length=0,this.packer.bins.forEach((function(t){e.width=t.width,e.height=t.height;var n=e.getContext("2d");t.rects.forEach((function(t){t.image&&(n.drawImage(t.image,t.x,t.y),t.image=void 0,i.spritesMap[t.url]=t,t.url=void 0)}))}));case 6:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,e=arguments;return new Promise((function(i,r){var o=n.apply(t,e);function a(t){R(o,i,r,a,s,"next",t)}function s(t){R(o,i,r,a,s,"throw",t)}a(void 0)}))},function(){return r.apply(this,arguments)})},{key:"spriteUV",value:function(t){var e=this.spritesMap[t];return e?{x:e.x/this.canvasWidth,y:e.y/this.canvasHeight,w:(e.x+e.width)/this.canvasWidth,h:(e.y+e.height)/this.canvasHeight}:{x:0,y:0,w:1,h:1}}},{key:"canvasWidth",get:function(){return this.canvas.width}},{key:"canvasHeight",get:function(){return this.canvas.height}}],i&&S(e.prototype,i),t}();function P(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function O(t,e){return O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},O(t,e)}function A(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}function I(t){return function(t){if(Array.isArray(t))return j(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return j(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?j(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function H(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function B(t,e,i){return e&&H(t.prototype,e),i&&H(t,i),t}var U={SPRITE:1,GEOMETRY:2},F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.SPRITE,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new THREE.Color(16777215),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Color(16777215),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];V(this,t),this.type=e,this.color=i,this.url=n,this.highlightedColor=r,this.highlightedUrl=o,this.spriteUrls=new Set(a)}return B(t,[{key:"preloadSprite",value:function(t){this.spriteUrls.add(t)}},{key:"preloadedSprites",get:function(){return I(this.spriteUrls.values())}}]),t}(),L=function(){function t(e,i,n){V(this,t),this._style=i,this._position=e,this._dbId=n}return B(t,[{key:"style",get:function(){return this._style}},{key:"position",get:function(){return this._position}},{key:"dbId",get:function(){return this._dbId}}]),t}(),z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(r,t);var e,i,n=(e=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=D(e);if(i){var r=D(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return A(this,t)});function r(t,e,i){return V(this,r),console.assert(e.type==U.SPRITE),n.call(this,t,e,i)}return B(r,[{key:"type",get:function(){return U.SPRITE}},{key:"color",get:function(){return this.style.color}},{key:"highlightedColor",get:function(){return this.style.highlightedColor}}]),r}(L),N=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V(this,t),this._styleMap=new Map,this._viewablesMap=new Map,this._spriteAtlas=new M(e.atlasWidth||1920,e.atlasHeight||1080,2)}var e,i;return B(t,[{key:"addViewable",value:function(t){var e=this;if(t.type==U.SPRITE){var i=new Set;i.add(t.style.url),t.style.highlightedUrl&&i.add(t.style.highlightedUrl),t.style.preloadedSprites.forEach((function(t){return i.add(t)})),i.forEach((function(t){return e.spriteAtlas.addSprite(t)}))}this._viewablesMap.set(t.dbId,t)}},{key:"getSpriteUV",value:function(t){return this._spriteAtlas.spriteUV(t)}},{key:"getViewableUV",value:function(t,e){var i=this._viewablesMap.get(t).style;return e&&i.highlightedUrl?this._spriteAtlas.spriteUV(i.highlightedUrl):this._spriteAtlas.spriteUV(i.url)}},{key:"getViewableColor",value:function(t,e){var i=this._viewablesMap.get(t).style;return e?i.highlightedColor:i.color}},{key:"finish",value:(e=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._spriteAtlas.finish();case 2:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,i=arguments;return new Promise((function(n,r){var o=e.apply(t,i);function a(t){P(o,n,r,a,s,"next",t)}function s(t){P(o,n,r,a,s,"throw",t)}a(void 0)}))},function(){return i.apply(this,arguments)})},{key:"viewables",get:function(){return I(this._viewablesMap.values())}},{key:"spriteAtlas",get:function(){return this._spriteAtlas}}]),t}(),G=i(41550);function W(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function X(t){return function(){var e=this,i=arguments;return new Promise((function(n,r){var o=t.apply(e,i);function a(t){W(o,n,r,a,s,"next",t)}function s(t){W(o,n,r,a,s,"throw",t)}a(void 0)}))}}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Y(t,e,i){return e&&Q(t.prototype,e),i&&Q(t,i),t}var K=function(){function t(e,i,n){q(this,t),this._id=e,this._name=i,this._bounds=n,this._devices=[]}return Y(t,[{key:"addDevice",value:function(t){this._devices.push(t)}},{key:"info",set:function(t){this._info=t},get:function(){return this._info}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"bounds",get:function(){return this._bounds}},{key:"devices",get:function(){return this._devices}}]),t}(),$=function(){function t(){q(this,t)}return Y(t,[{key:"addRoomToLevel",value:function(t,e){this[t]||(this[t]=[]),this[t].push(e)}},{key:"getRoomsOnLevel",value:function(t,e){var i=this[t]||[];return e?i.filter((function(t){return t.devices.length>0})):i}}]),t}(),J=function(){function t(e){q(this,t),this.model=e,this.rooms=null}var e,i,n,r;return Y(t,[{key:"getImmediateChildNodesByName",value:function(t,e){var i=this.model.getInstanceTree(),n=[];return i&&(e=null==e?i.getRootId():e,i.enumNodeChildren(e,(function(e){var r=i.getNodeName(e,!0);r&&r.indexOf&&r.indexOf(t)>=0&&n.push(e)}),!1)),n}},{key:"getLevelRoomsMap",value:(r=X(regeneratorRuntime.mark((function t(){var e,i,n,r=this,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.length>0&&void 0!==o[0]&&o[0],i=o.length>1?o[1]:void 0,this.levelRoomsMap){t.next=9;break}return n=new $,t.next=6,this.getRoomList(i);case 6:t.sent.forEach((function(t){var i=r.getLevel(t);e||(t.info=void 0),null!=i&&n.addRoomToLevel(i,t)})),this.levelRoomsMap=n;case 9:return t.abrupt("return",this.levelRoomsMap);case 10:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"getLevel",value:function(t){if(t&&t.info&&t.info.properties){var e=t.info.properties.find((function(t){return 20==t.type&&"Level"==t.attributeName}));return e?e.displayValue:void 0}}},{key:"getRoomList",value:(n=X(regeneratorRuntime.mark((function t(e){var i,n,r,o,a,s,u=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.rooms){t.next=10;break}return e=e||"Rooms",i=this.getImmediateChildNodesByName(e),n=this.model,r=[],i&&i.length>0&&(o=i[0],(a=n.getInstanceTree())&&a.enumNodeChildren(o,(function(t){var e=a.getNodeName(t,!0),i=u.getRoomBounds(t);r.push(new K(t,e,i))}),!1)),s=r.map((function(t){return new Promise((function(e,i){n.getProperties2(t.id,(function(i){t.info=i,e(t)}),(function(i){e(t)}))}))})),t.next=9,Promise.all(s);case 9:this.rooms=r;case 10:return t.abrupt("return",this.rooms);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"getRoomBounds",value:function(t){var e=new THREE.Box3,i=new THREE.Box3,n=this.model.getInstanceTree(),r=this.model.getFragmentList();return n&&n.enumNodeFragments(t,(function(t){r.getWorldBounds(t,i),e.union(i)}),!0),e}},{key:"mapDevicesInRoom",value:(i=X(regeneratorRuntime.mark((function t(){var e,i,n,r,o,a,s,u,h=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.length>0&&void 0!==h[0]?h[0]:[],i=h.length>1?h[1]:void 0,t.next=4,this.getRoomList(i);case 4:for(n=t.sent,e=e.slice(0),r=0;e.length>0&&r<n.length;r++)for(o=n[r],a=0;a<e.length;a++)s=e[a],this.roomGeomContainsPoint(o,s.position)&&(s.roomId=o.id,o.addDevice(s),e.splice(a,1),a--);e.length>0&&(u=e.map((function(t){return"".concat(t.id," (").concat(t.name,")")})),console.warn("Some devices did not map to a room: ".concat(u.join(", "))));case 8:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"generateSurfaceShadingData",value:(e=X(regeneratorRuntime.mark((function t(){var e,i,n,r,o,a,s=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:[],i=s.length>1?s[1]:void 0,n=s.length>2?s[2]:void 0,i){t.next=9;break}return t.next=6,this.getLevelRoomsMap(!1,n);case 6:return i=t.sent,t.next=9,this.mapDevicesInRoom(e,n);case 9:for(a in r=new G.SurfaceShadingData,o=function(t){var e=i[t],n=new G.SurfaceShadingGroup(t);e.forEach((function(t){var e=new G.SurfaceShadingNode(t.name,t.id);t.devices.forEach((function(t){var i=t.deviceModel?t.deviceModel.id:t.type;e.addPoint(new G.SurfaceShadingPoint(t.id,t.position,t.sensorTypes,t.name,{styleId:i}))})),n.addChild(e)})),r.addChild(n)},i)o(a);return r.initialize(this.model),t.abrupt("return",r);case 14:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"roomGeomContainsPoint",value:function(t,e){return t.bounds&&t.bounds.containsPoint(e)}}]),t}();function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function it(t,e){return it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},it(t,e)}function nt(t,e){return!e||"object"!==Z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function rt(t){return rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},rt(t)}var ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(a,THREE.ShaderMaterial);var e,i,n,r,o=(n=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=rt(n);if(r){var i=rt(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return nt(this,t)});function a(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(tt(this,a),e.length<2||e.length!=i.length)throw new Error("Heatmap requires at least two colors to work");if(n<0)throw new Error("Heatmap 'confidence' must be a positive number");if(r<0)throw new Error("Heatmap 'powerParameter' must be a positive number");if(s<0||s>1)throw new Error("Heatmap 'alpha' must range between 0.0 and 1.0");var u={uPower:{type:"f",value:r},uAlpha:{type:"f",value:s},uConfidence:{type:"f",value:n},uSensors:{type:"v4v",value:t.map((function(t){return t}))},uStops:{type:"fv1",value:i},uColors:{type:"v3v",value:e}},h=e.length,c=t.length,l="\n            varying vec4 worldCoord;\n\n            void main()\n            {\n                vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                worldCoord = modelMatrix * vec4(position, 1.0);\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        ",d="\n            varying vec4 worldCoord;\n            uniform float uPower;\n            uniform float uAlpha;\n            uniform float uConfidence;\n            uniform vec4 uSensors [".concat(c,"];\n            uniform float uStops[").concat(h,"];\n            uniform vec3 uColors[").concat(h,"];\n\n            const float dotSize = 6.0;\n            const float h_var1 = 0.4;\n            const float h_var2 = 0.25;\n            const float two_pi = 2.0 * 3.1415927;\n            \n            float lmap(float value, float inMin, float inMax, float outMin, float outMax)\n            {\n                return clamp(outMin + ((outMax - outMin) * (value - inMin)) / (inMax - inMin), outMin, outMax);\n            }\n\n            // Gradient with multiple colors in non-equal intervals\n            vec3 colormap(float x)\n            {\n                for (int i = 1; i < ").concat(h,"; i++) {\n                    if (x <= uStops[i]) {\n                        float stopPct = lmap(x, uStops[i-1], uStops[i], 0.0, 1.0);\n                        return mix(uColors[i-1], uColors[i], stopPct);\n                    }\n                }\n            \n                // In case 'x' goes beyond upper bound.\n                return uColors[").concat(h," - 1];\n            }\n\n            vec2 get_pix(float angle) {\n                float rad = radians(angle);\n                float c = cos(rad);\n                float s = sin(rad);\n                mat2 R = mat2(vec2(c, -s), vec2(s, c));\n                return R * gl_FragCoord.xy;\n            }\n\n            vec3 halftone(float tone, vec3 dotColor, vec3 backgroundColor) {\n                vec2 u = get_pix(-45.0) / (dotSize);\n                float h = (h_var1 + h_var2 * cos(u.x*two_pi));\n                const float e = 0.05;\n                float gradient = smoothstep(-e, e, h - tone);\n                return mix(dotColor, backgroundColor, gradient);\n            }\n\n            void main(void) {\n                vec3 fragPos = vec3(worldCoord.x, worldCoord.y, worldCoord.z);\n                float result = 0.0;\n                float sum = 0.0;\n                float wsum = 0.000001;\n                float minDist = 999999999.0;\n                bool found = false; // at exact location of the sensor\n                int validSensors = 0;\n\n                for (int i=0; i < ").concat(c,"; i++) {\n                    float mydist = distance(fragPos, vec3(uSensors[i][0], uSensors[i][1], uSensors[i][2]));\n                    if (uSensors[i][3] >= 0.0) {\n                        if (mydist < 0.00001) {\n                            result = uSensors[i][3];\n                            found = true;\n                        } else {\n                            float w = (1.0 / (pow(mydist, uPower)));\n                            sum += (uSensors[i][3] * w);\n                            wsum += w;\n                        }\n                        validSensors += 1;\n                        if (mydist < minDist) {\n                            minDist = mydist;\n                        }\n                    }\n                }\n\n                if (validSensors == 0) {\n                    result = -1.0;\n                } else if (!found) {\n                    result = sum / wsum;\n                }\n\n                // Defaults without influence from any sensor\n                float confidence = 0.0;\n                vec3 sensorColor = vec3(0.5, 0.5, 0.5);\n\n                if (result >= 0.0) {\n                    result = clamp(result, 0.0, 1.0);\n                    confidence = 1.0 - clamp(minDist / uConfidence, 0.0, 1.0);\n                    sensorColor = colormap(result);\n                }\n\n                vec3 confidenceColor = halftone(clamp(confidence, 0.3, 0.9), vec3(0.7, 0.7, 0.7), vec3(1.0, 1.0, 1.0));\n                gl_FragColor = vec4(mix(confidenceColor, sensorColor, clamp(confidence, 0.0, 1.0)), uAlpha);\n            }\n        ");return o.call(this,{uniforms:u,vertexShader:l,fragmentShader:d,side:THREE.DoubleSide,depthTest:!0,depthWrite:!1})}return e=a,(i=[{key:"update",value:function(t,e,i,n){isNaN(e)||null===e||(this.uniforms.uConfidence.value=e),isNaN(i)||null===i||(this.uniforms.uPower.value=i),isNaN(n)||null===n||(this.uniforms.uAlpha.value=n),this.uniforms.uSensors.value=t}}])&&et(e.prototype,i),a}();function at(t){for(var e=[],i=1/(t-1),n=0;n<t;n++)e.push(i*n);return e}function st(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return ut(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ut(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function ht(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ct="DataVizSurfaceShading",lt=9999999.9,dt=Autodesk.Viewing.Private,ft=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.model=i,this.shadingData=n,this.activeShadingPoints=[],this.settings={},this.registerSensorColors("hatchPattern",[16777215,16777215],.7),this.registerSensorColors("__defaultSensor__",[255,65280,16776960,16711680],.7)}var e,i;return e=t,i=[{key:"removeShading",value:function(){this.viewer.impl.removeOverlayScene(ct),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"cleanUp",value:function(){this.removeShading(),this._clearActiveShadingPoints(),this.hatchMaterial&&(this.hatchMaterial.dispose(),delete this.hatchMaterial)}},{key:"_clearActiveShadingPoints",value:function(){this.activeShadingPoints.forEach((function(t){return t.heatmapMaterial.dispose()})),this.activeShadingPoints=[]}},{key:"_createHatchMaterial",value:function(){var t=this.settings.hatchPattern;return new ot([new THREE.Vector4(lt,lt,lt,-1)],t.colors,t.stops,60,2,t.alpha)}},{key:"registerSensorColors",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;this.settings[t]={stops:at(e.length),colors:e.map((function(t){return new THREE.Color(t)})).map((function(t){return new THREE.Vector3(t.r,t.g,t.b)})),alpha:i}}},{key:"getSetting",value:function(t){return this.settings[t]?this.settings[t]:this.settings.__defaultSensor__}},{key:"render",value:function(t,e,i,n){var r=this,o=n?n.confidence:0;o=isNaN(o)?0:Math.abs(o);var a=2;n&&"number"==typeof n.powerParameter&&(a=n.powerParameter);var s=[];t instanceof Array?t.forEach((function(t){return r.shadingData.getLeafsById(t,s)})):s=this.shadingData.getLeafsById(t);var u=this.model.getInstanceTree();this._clearActiveShadingPoints();var h=this.viewer.impl,c=this.activeShadingPoints;h.createOverlayScene(ct),this.hatchMaterial||(this.hatchMaterial=this._createHatchMaterial());for(var l=this.getSetting(e),d=function(t){var n=s[t],d=(0,G.filterShadingPointsByType)(n.shadingPoints,e),f=r.hatchMaterial;if(d.length>0){var p=o;if(n.bounds&&!o){var v=n.bounds.max,y=n.bounds.min;p=v.x-y.x+(v.y-y.y)+(v.z-y.z)}p=p||160;var g=[];d.forEach((function(t){var n=t.position,r=i(t,e),o=new THREE.Vector4(n.x,n.y,n.z,r);g.push(o)})),f=new ot(g,l.colors,l.stops,p,a,l.alpha),c.push({shadingPoints:d,sensorType:e,heatmapMaterial:f})}n.fragIds.forEach((function(t){return function(t,e){var i=u.fragList.getGeometry(t);if(i){var n=new THREE.Mesh(i,e),r=new THREE.Matrix4;u.fragList.getWorldMatrix(t,r),n.matrix.copy(r),n.matrixWorldNeedsUpdate=!0,n.matrixAutoUpdate=!1,n.frustumCulled=!1,h.addOverlay(ct,n)}else dt.logger.error("Geometry for the fragment is empty, FragId:",t)}(t,f)}))},f=0;s&&f<s.length;f++)d(f)}},{key:"updateShading",value:function(t,e){var i,n,r;e&&(i=e.confidence,n=e.powerParameter,r=e.alpha);for(var o=0;o<this.activeShadingPoints.length;o++){var a,s=this.activeShadingPoints[o],u=s.shadingPoints,h=s.sensorType,c=s.heatmapMaterial,l=[],d=st(u);try{for(d.s();!(a=d.n()).done;){var f=a.value,p=f.position,v=t(f,h);l.push(new THREE.Vector4(p.x,p.y,p.z,v))}}catch(t){d.e(t)}finally{d.f()}c.update(l,i,n,r)}this.viewer.impl.invalidate(!1,!1,!0)}}],i&&ht(e.prototype,i),t}(),pt=i(43908),vt=i.n(pt);function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function gt(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return mt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?mt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _t="DataVizPlanarHeatmap",xt=function(){function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};wt(this,t);var o=r=this._handleLegacyOptions(r),a=o.width,s=o.height,u=o.minOpacity,h=o.maxOpacity;this.options=r;var c=document.createElement("canvas");c.width=a,c.height=s,this.config={canvas:c,width:a,height:s,minOpacity:u,maxOpacity:h,radius:20},this.model=i,this.viewer=e,this.shadingData=n;var l=new THREE.Texture(c,THREE.UVMapping);l.minFilter=THREE.LinearFilter,l.flipY=!1,this.material=new THREE.MeshBasicMaterial({map:l,depthTest:!0,depthWrite:!1,transparent:!0,side:THREE.DoubleSide}),this.gradientMap={}}var e,i;return e=t,i=[{key:"_handleLegacyOptions",value:function(t){function e(t,e){return null==t||"number"!=typeof t?e:t<0?0:t>1?1:t}return"string"==typeof(t=Object.assign({width:1024,height:1024,slicingEnabled:!0},t)).position&&(t.slicingPosition={min:0,middle:.5,max:1}[t.position]),"string"==typeof t.placePosition&&(t.placementPosition={min:0,max:1}[t.placePosition]),delete t.position,delete t.placePosition,t.slicingPosition=e(t.slicingPosition,.5),t.placementPosition=e(t.placementPosition,0),t}},{key:"_setup",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,n=this.model,r=this.shadingData,o=new THREE.Box3,a=n.getInstanceTree(),s=[],u={},h=[],c={};function l(t){return!(null==t.shadingPoints||t.shadingPoints&&0==t.shadingPoints.length||null==t.shadingPoints.find((function(t){return t.types.find((function(t){return t==e}))})))}this.gradientMap[e]&&(this.config.gradient=this.gradientMap[e]),this.config.radius=i,t.forEach((function(t){return r.getLeafsById(t,s)}));for(var d=0;d<s.length;d++)l(s[d])&&s[d].dbIds.forEach((function(t){if(a.getNodeBox(t,h),h[0]!=1/0){var e=new THREE.Box3(new THREE.Vector3(h[0],h[1],h[2]),new THREE.Vector3(h[3],h[4],h[5]));o.union(e),u[t]=e}}));var f=o.min.x,p=o.min.y,v=o.max.x-f,y=o.max.y-p,g=this.options,m=g.slicingEnabled,w=g.width,b=g.height;if(v>y?b=w/v*y:w=b/y*v,this.config.canvas.width=w,this.config.canvas.height=b,this.config.width=w,this.config.height=b,this.heatmapInstance)this.heatmapInstance.configure(this.config);else{var _=document.createElement("div");_.width=w,_.height=b,this.config.container=_,this.heatmapInstance=vt().create(this.config),_.removeChild(this.config.canvas),delete this.config.container}for(var x=[],E=[],R=[],T=Autodesk.Viewing.Extensions.CompGeom,S=this.options.slicingPosition,k=this.options.placementPosition,M=n.getFragmentList(),P=0;P<s.length;P++){var C=s[P],O=(0,G.filterShadingPointsByType)(C.shadingPoints,e);if(!(O.length<=0)){var A;m?function(){var t=new THREE.Vector3(0,0,1);A=[],C.dbIds.forEach((function(e){var i=u[e],n=i.min,r=i.max,o=n.z+(r.z-n.z)*S,s=n.z+(r.z-n.z)*k,h=new THREE.Plane(t,-o),c=T.makePlaneBasis(h);a.enumNodeFragments(e,(function(t){var e=M.getVizmesh(t);e.geometry&&!e.geometry.is2d&&!e.geometry.isLines&&e.material.cutplanes&&T.xMeshPlane(h,e,A)}),!0);var l=new THREE.Box3;T.convertToPlaneCoords(c,A,l);var d=new T.EdgeSet(A,l,1e-6*l.getSize(new THREE.Vector3).length());d.snapEdges(),d.sanitizeEdges(),d.stitchContours();var g=d.triangulate();if(g&&!g.triangulationFailed){for(var m=g.toPolygonMesh(),w=x.length/3,b=m.attributes.position.array,_=0,P=b.length;_<P;_+=3)x.push(b[_],b[_+1],s),E.push((b[_]-f)/v,(b[_+1]-p)/y);for(var C=m.index.array,O=0,D=C.length;O<D;O++)R.push(C[O]+w)}}))}():C.dbIds.forEach((function(t){var e=u[t];if(!e.isEmpty()){var i=e.min,n=e.max,r=i.z+(n.z-i.z)*k,o=x.length/3;R.push(o,o+2,o+1,o,o+3,o+2),x.push(i.x,i.y,r,i.x,n.y,r,n.x,n.y,r,n.x,i.y,r),E.push((i.x-f)/v,(i.y-p)/y,(i.x-f)/v,(n.y-p)/y,(n.x-f)/v,(n.y-p)/y,(n.x-f)/v,(i.y-p)/y)}}));var D,I=gt(O);try{for(I.s();!(D=I.n()).done;){var j=D.value,V={x:Math.round((j.position.x-f)/v*w),y:Math.round((j.position.y-p)/y*b),value:0};c[j.id]={data:V,shadingPoint:j}}}catch(t){I.e(t)}finally{I.f()}}}x=new Float32Array(x),E=new Float32Array(E),R=new Uint16Array(R);var H=new THREE.BufferGeometry,B=new THREE.BufferAttribute(x,3);B.bytesPerItem=4;var U=new THREE.BufferAttribute(E,2);U.bytesPerItem=4;var F=new THREE.BufferAttribute(R,1);H.setIndex(F),H.setAttribute("position",B),H.setAttribute("uv",U),this.geometry=H;var L=this.viewer.impl;L.createOverlayScene(_t);var z=new THREE.Mesh(H,this.material);L.addOverlay(_t,z),this.totalBounds=o,this.pointDataMap=c,this.currentSensorType=e}},{key:"render",value:function(t,e,i,n){var r=200;"number"==typeof n?r=Math.abs(n):"object"===yt(n)&&n.confidence&&(r=n.confidence),this.geometry&&(this.geometry.dispose(),this.geometry=null),t=t instanceof Array?t:[t],this._setup(t,e,r),this.updateShading(i)}},{key:"updateShading",value:function(t){var e=[];for(var i in this.pointDataMap){var n=this.pointDataMap[i],r=t(n.shadingPoint,this.currentSensorType,n.data);n.data.value=0===r?1e-4:r,isNaN(n.data.value)||e.push(n.data)}this.heatmapInstance.setData({data:e,min:0,max:1}),this.material.map.needsUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"cleanUp",value:function(){this.removeShading(),this.geometry&&(this.geometry.dispose(),this.geometry=null),this.material&&(this.material.dispose(),this.material=null)}},{key:"removeShading",value:function(){this.viewer.impl.removeOverlayScene(_t),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"registerSensorColors",value:function(t,e){for(var i,n,r,o={},a=e.length-1,s=0;s<e.length;s++)o[(s/a).toFixed(3)]=(void 0,void 0,n=255&(i=e[s]),r=i>>8&255,"rgb(".concat(i>>16&255,", ").concat(r,", ").concat(n,")"));this.gradientMap[t]=o}}],i&&bt(e.prototype,i),t}();function Et(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Rt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this._textures={},this._colors={},this._excluded=["__defaultMaterial__","__fadeMaterial__","__highlightMaterial__","__dataVizSpriteMaterial__"]}var e,i;return e=t,(i=[{key:"show",value:function(){return this.hideTextures(),this.regen(),!0}},{key:"hide",value:function(){return this.showTextures(),this.regen(),!0}},{key:"regen",value:function(){this.viewer.refresh(!0)}},{key:"hideTextures",value:function(){var t=0===Object.keys(this._textures).length,e=new THREE.Color(1,1,1),i=this.viewer.impl.matman()._materials;for(var n in i)if(-1===this._excluded.indexOf(n)){var r=i[n];t&&(this._textures[n]=r.map,this._colors[n]=r.color),r.map=null,r.color=e,r.needsUpdate=!0}this.regen()}},{key:"showTextures",value:function(){if(Object.keys(this._textures).length>0){var t=this.viewer.impl.matman()._materials;for(var e in t)if(-1===this._excluded.indexOf(e)){var i=t[e],n=this._textures[e];n&&(i.map=n);var r=this._colors[e];r&&(i.color=r),i.needsUpdate=!0}}this.regen()}}])&&Et(e.prototype,i),t}();function Tt(t){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(t)}function St(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t,e,i){return e&&kt(t.prototype,e),i&&kt(t,i),t}function Pt(t,e){return Pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Pt(t,e)}function Ct(t,e){return!e||"object"!==Tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}var At=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pt(t,e)}(r,THREE.ShaderMaterial);var e,i,n=(e=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=Ot(e);if(i){var r=Ot(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return Ct(this,t)});function r(t,e,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;St(this,r);var s={dataTexture:{type:"t",value:null},vertexTexture:{type:"t",value:null},uPower:{type:"f",value:a=parseFloat(a).toFixed(3)},uDataCount:{type:"i",value:i},uDataTextureWidth:{type:"i",value:1}},u="\n            varying vec2 vUV;\n\n            void main()\n            {\n                vUV = uv;\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        ",h="\n            varying vec2 vUV;\n\n            uniform float uPower;\n            uniform int uDataCount;\n            uniform int uDataTextureWidth;\n            \n            uniform sampler2D dataTexture;\n            uniform sampler2D vertexTexture;\n            \n            void main(void) {\n                // The position of the vertex whose value is to be determined.\n                vec4 vertex = texture2D(vertexTexture, vUV);\n            \n                if (vertex.w < 0.) {\n                    // This is an invalid vertex, mark as transparent.\n                    gl_FragColor = vec4(0., 0., 0., 1.);\n                    return;\n                }\n            \n                float sum = 0.;\n                float wsum = 0.;\n                float factor = 1. / float(uDataTextureWidth);\n                float textureWidth = float(uDataTextureWidth);\n            \n                // Compute weighted influence from all the data points.\n                for (int index = 0; index < uDataCount; index++)\n                {\n                    float i = float(index);\n                    float y = floor(i / textureWidth);\n                    float x = mod(i, textureWidth);\n            \n                    vec2 dUV = vec2((x + 0.5) * factor, (y + 0.5) * factor);\n                    vec4 dataPoint = texture2D(dataTexture, dUV);\n            \n                    float dist = distance(vertex.xyz, dataPoint.xyz);\n            \n                    if (dist < 0.0001) {\n                        gl_FragColor = vec4(dataPoint.w, 0., 0., 1.);\n                        return;\n                    }\n            \n                    float w = 1. / dist;\n                    w = pow(w, uPower);\n            \n                    sum += dataPoint.w * w;\n                    wsum += w;\n                }\n            \n                gl_FragColor = vec4(sum/wsum , 0., 0., 1.);\n            }\n        ";return(o=n.call(this,{uniforms:s,vertexShader:u,fragmentShader:h,side:THREE.DoubleSide,depthTest:!0,depthWrite:!0})).vertexTexture=t,o.dataTexture=e,o}return Mt(r,[{key:"vertexTexture",set:function(t){t&&(this.uniforms.vertexTexture.value=t)}},{key:"dataTexture",set:function(t){t&&(this.uniforms.dataTexture.value=t,this.uniforms.uDataTextureWidth.value=t.image.width)}}]),r}(),Dt=function(){function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};St(this,t),this.viewer=e,this.min=r.min,this.max=r.max;var o=r.colors;o?this.setColors(o):this.setColors([255,65535,65280,16776960,16711680]),this.setVertices(i),this.setDataPoints(n),this.initializeRender()}return Mt(t,[{key:"setVertices",value:function(t){this.vertexTexture&&(this.vertexTexture.dispose(),this.vertexTexture=null);var e=Math.ceil(Math.sqrt(t.length/3)),i=new Float32Array(e*e*4);i.fill(-1);for(var n=0,r=t.length/3;n<r;n++)i[4*n]=t[3*n],i[4*n+1]=t[3*n+1],i[4*n+2]=t[3*n+2],i[4*n+3]=1;var o=new THREE.DataTexture(i,e,e,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);o.generateMipmaps=!1,o.needsUpdate=!0,this.vertexTexture=o,this.verticesLength=t.length,this.vertexValues=new Uint8Array(e*e*4)}},{key:"setDataPoints",value:function(t){this.dataTexture&&(this.dataTexture.dispose(),this.dataTexture=null);var e=Math.ceil(Math.sqrt(t.length/4)),i=new Float32Array(e*e*4),n=this.min,r=this.max;if(null==n||null==r){n=1/0,r=-1/0;for(var o=0;o<t.length;o+=4)n=Math.min(n,t[o+3]),r=Math.max(r,t[o+3])}for(var a=r-n||1,s=0;s<t.length;s+=4)i[s]=t[s],i[s+1]=t[s+1],i[s+2]=t[s+2],i[s+3]=(t[s+3]-n)/a;var u=new THREE.DataTexture(i,e,e,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);u.generateMipmaps=!1,u.needsUpdate=!0,this.dataTexture=u,this.dataCount=t.length/4}},{key:"initializeRender",value:function(){var t=new At(this.vertexTexture,this.dataTexture,this.dataCount),e=new THREE.PlaneBufferGeometry(2,2,1,1),i=new THREE.OrthographicCamera(-1,1,-1,1,0,1),n=this.vertexTexture.image.width,r=new THREE.WebGLRenderTarget(n,n,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),o=new THREE.Mesh(e,t);o.frustumCulled=!1,this.scene=new THREE.Scene,this.scene.add(o),this.material=t,this.renderTarget=r,this.planeGeometry=e,this.camera=i}},{key:"setColors",value:function(t){if(t){this.colors=t.map((function(t){return new THREE.Color(t)})),this.stops=this._createColorStops(t.length),this.colorMapData=[];for(var e=0;e<256;e++)this.colorMapData.push(this._mapValueToColor(e/255))}}},{key:"_createColorStops",value:function(t){for(var e=[],i=1/(t-1),n=0;n<t;n++)e.push(i*n);return e}},{key:"_mapValueToColor",value:function(t){var e=this.colors,i=this.stops;function n(t,e,i){return t*(1-i)+e*i}function r(t,e,i){var r=new THREE.Color;return r.r=n(t.r,e.r,i),r.g=n(t.g,e.g,i),r.b=n(t.b,e.b,i),r}for(var o=e[i.length-1],a=1;a<i.length;a++)if(t<=i[a]){var s=(t-i[a-1])/(i[a]-i[a-1]);o=r(e[a-1],e[a],s);break}return{r:Math.round(255*o.r),g:Math.round(255*o.g),b:Math.round(255*o.b)}}},{key:"process",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.colors,i=t.power,n=t.outputTarget;e&&this.setColors(e),null==i&&(i=1),this.material.uniforms.uPower.value=i;var r=this.vertexTexture.image.width;this.renderTarget.width!=r&&this.renderTarget.setSize(r,r);var o=this.viewer.impl.glrenderer();return o.render(this.scene,this.camera,this.renderTarget,!0),o.readRenderTargetPixels(this.renderTarget,0,0,r,r,this.vertexValues),this._getColorValues(n)}},{key:"_getColorValues",value:function(t){var e;e=t&&t.length==this.verticesLength?t:new Uint8Array(this.verticesLength);for(var i=this.vertexValues,n=0,r=this.verticesLength/3;n<r;n++){var o=4*n;if(!(i[o+3]<128)){var a=i[o],s=this.colorMapData[a];e[3*n]=s.r,e[3*n+1]=s.g,e[3*n+2]=s.b}}return e}},{key:"cleanUp",value:function(){var t=this;setTimeout((function(){t.vertexTexture&&(t.vertexTexture.dispose(),t.vertexTexture=null),t.dataTexture&&(t.dataTexture.dispose(),t.dataTexture=null),t.renderTarget&&(t.renderTarget.dispose(),t.renderTarget=null),t.material&&(t.material.dispose(),t.material=null),t.planeGeometry&&(t.planeGeometry.dispose(),t.planeGeometry=null)}),32)}}]),t}();function It(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function jt(t,e,i,n,r){if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,r&&e+r):t.slice(e,r&&e+r):t,i.set)i.set(t,n);else for(var o=0;o<t.length;o++)i[o+n]=t[o];return i}var Vt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._position=[],this._prev=[],this._next=[],this._side=[],this._width=[],this._index=[],this._widthCallback=null,this._geometry=null}var e,i;return e=t,(i=[{key:"dispose",value:function(){this._geometry&&(this._geometry.dispose(),this._geometry=null)}},{key:"setPoints",value:function(t,e){if(!(t instanceof Float32Array)||0===t.length)throw new Error("Input points must be of Float32Array type");this._widthCallback=e,this._position=[];for(var i=0;i<t.length;i+=3)this._position.push(t[i],t[i+1],t[i+2]),this._position.push(t[i],t[i+1],t[i+2]);this.process()}},{key:"compareV3",value:function(t,e){var i=6*t,n=6*e;return this._position[i]===this._position[n]&&this._position[i+1]===this._position[n+1]&&this._position[i+2]===this._position[n+2]}},{key:"copyV3",value:function(t){var e=6*t;return{x:this._position[e],y:this._position[e+1],z:this._position[e+2]}}},{key:"updateAttribute",value:function(t,e){t.set(e),t.needsUpdate=!0}},{key:"process",value:function(){var t=this._position.length/6;this._prev=[],this._next=[],this._side=[],this._width=[],this._index=[];var e=this.compareV3(0,t-1),i=e?t-2:0,n=this.copyV3(i),r=n.x,o=n.y,a=n.z;this._prev.push(r,o,a),this._prev.push(r,o,a);for(var s=0;s<t;s++){this._side.push(1),this._side.push(-1);var u=1;if(this._widthCallback&&(u=this._widthCallback(s/(t-1))),this._width.push(u),this._width.push(u),s<t-1){var h=this.copyV3(s),c=h.x,l=h.y,d=h.z;this._prev.push(c,l,d),this._prev.push(c,l,d);var f=2*s;this._index.push(f,f+1,f+2),this._index.push(f+2,f+1,f+3)}if(s>0){var p=this.copyV3(s),v=p.x,y=p.y,g=p.z;this._next.push(v,y,g),this._next.push(v,y,g)}}var m=e?1:t-1,w=this.copyV3(m),b=w.x,_=w.y,x=w.z;this._next.push(b,_,x),this._next.push(b,_,x);var E=new Float32Array(this._position),R=new Float32Array(this._prev),T=new Float32Array(this._next),S=new Float32Array(this._side),k=new Float32Array(this._width),M=new Uint16Array(this._index);this._attributes&&this._attributes.position.length===this._position.length?(this.updateAttribute(this._attributes.position,E),this.updateAttribute(this._attributes.prev,R),this.updateAttribute(this._attributes.next,T),this.updateAttribute(this._attributes.side,S),this.updateAttribute(this._attributes.width,k),this.updateAttribute(this._attributes.index,M)):this._attributes={position:new THREE.BufferAttribute(E,3),prev:new THREE.BufferAttribute(R,3),next:new THREE.BufferAttribute(T,3),side:new THREE.BufferAttribute(S,1),width:new THREE.BufferAttribute(k,1),index:new THREE.BufferAttribute(M,1)},this._geometry||(this._geometry=new THREE.BufferGeometry),this._geometry.setAttribute("position",this._attributes.position),this._geometry.setAttribute("prev",this._attributes.prev),this._geometry.setAttribute("next",this._attributes.next),this._geometry.setAttribute("side",this._attributes.side),this._geometry.setAttribute("width",this._attributes.width),this._geometry.setIndex(this._attributes.index),this._geometry.computeBoundingSphere(),this._geometry.computeBoundingBox(),this._geometry.visible=!0}},{key:"advance",value:function(t){var e=this._attributes.position.array,i=this._attributes.prev.array,n=this._attributes.next.array,r=e.length;jt(e,0,i,0,r),jt(e,6,e,0,r-6),e[r-6]=t.x,e[r-5]=t.y,e[r-4]=t.z,e[r-3]=t.x,e[r-2]=t.y,e[r-1]=t.z,jt(e,6,n,0,r-6),n[r-6]=t.x,n[r-5]=t.y,n[r-4]=t.z,n[r-3]=t.x,n[r-2]=t.y,n[r-1]=t.z,this._attributes.position.needsUpdate=!0,this._attributes.prev.needsUpdate=!0,this._attributes.next.needsUpdate=!0}},{key:"geometry",get:function(){return this._geometry}}])&&It(e.prototype,i),t}();function Ht(t){function e(t,e){return void 0===t?e:t}THREE.Material.call(this),t=t||{},t=Object.assign(t,{side:THREE.DoubleSide,depthTest:!0,depthWrite:!1}),this.lineColor=e(t.lineColor,new THREE.Color(16777215)),this.opacity=e(t.opacity,1),this.lineWidth=e(t.lineWidth,6),delete t.lineColor,delete t.opacity,delete t.lineWidth;var i=new THREE.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},color:{type:"c",value:this.lineColor},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:new THREE.Vector2(1920,1080)},sizeAttenuation:{type:"f",value:0}},attributes:{position:{type:"v3",value:new THREE.Vector3},prev:{type:"v3",value:new THREE.Vector3},next:{type:"v3",value:new THREE.Vector3},side:{type:"f",value:0},width:{type:"f",value:0}},vertexShader:"\n    attribute vec3 position;\n    attribute vec3 prev;\n    attribute vec3 next;\n    attribute float side;\n    attribute float width;\n\n    uniform mat4 projectionMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform vec2 resolution;\n    uniform float lineWidth;\n    uniform vec3 color;\n    uniform float opacity;\n    uniform float sizeAttenuation;\n\n    varying vec4 vColor;\n\n    vec2 fix( vec4 i, float aspect ) {\n\n        vec2 res = i.xy / i.w;\n        res.x *= aspect;\n        return res;\n    }\n\n    void main() {\n        float aspect = resolution.x / resolution.y;\n\n        vColor = vec4( color, opacity );\n\n        mat4 m = projectionMatrix * modelViewMatrix;\n        vec4 finalPosition = m * vec4( position, 1.0 );\n        vec4 prevPos = m * vec4( prev, 1.0 );\n        vec4 nextPos = m * vec4( next, 1.0 );\n\n        vec2 currP = fix( finalPosition, aspect );\n        vec2 prevP = fix( prevPos, aspect );\n        vec2 nextP = fix( nextPos, aspect );\n\n        float w = lineWidth * width;\n\n        vec2 dir;\n        if ( nextP == currP ) {\n            dir = normalize( currP - prevP );\n        }\n        else if( prevP == currP ) {\n            dir = normalize( nextP - currP );\n        }\n        else {\n            vec2 dir1 = normalize( currP - prevP );\n            vec2 dir2 = normalize( nextP - currP );\n            dir = normalize( dir1 + dir2 );\n\n            vec2 perp = vec2( -dir1.y, dir1.x );\n            vec2 miter = vec2( -dir.y, dir.x );\n            w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );\n        }\n\n        vec4 normal = vec4( -dir.y, dir.x, 0., 1. );\n        normal.xy *= .5 * w;\n        normal *= projectionMatrix;\n\n        if ( sizeAttenuation == 0. ) {\n            normal.xy *= finalPosition.w;\n            normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\n        }\n\n        finalPosition.xy += normal.xy * side;\n        gl_Position = finalPosition;\n    }\n",fragmentShader:"\n    varying vec4 vColor;\n\n    void main() {\n        gl_FragColor = vColor;\n    }\n"});return i.type="StreamLineMaterial",i.setValues(t),i}function Bt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Ht.prototype=Object.create(THREE.Material.prototype),Ht.prototype.constructor=Ht,Ht.prototype.copy=function(t){return THREE.Material.prototype.copy.call(this,t),this},Ht.prototype.id=function(){return Ht.generateId(this.lineColor,this.opacity,this.lineWidth)},Ht.generateId=function(t,e,i){var n=t.getHexString(),r=e.toFixed(4),o=i.toFixed(4);return"".concat(n,"-").concat(r,"-").concat(o)};var Ut="StreamLineOverlay",Ft=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._viewer=e,this._overlayCreated=!1,this._streamLines=[],this._cachedMaterials={}}var e,i;return e=t,(i=[{key:"dispose",value:function(){var t=this;this._streamLines.forEach((function(e){var i=e.streamLine,n=e.mesh;t._removeMeshFromScene(n),i.dispose()})),this._streamLines=[],Object.values(this._cachedMaterials).forEach((function(t){return t.dispose()})),this._cachedMaterials={},this._overlayCreated&&(this._overlayCreated=!1,this._viewer.impl.removeOverlayScene(Ut))}},{key:"createStreamLine",value:function(t){var e=new Vt;e.setPoints(new Float32Array(t.lineData.points));var i=this._getOrCreateMaterial(t),n=new THREE.Mesh(e.geometry,i);return this._addMeshToScene(n),this._streamLines.push({streamLine:e,mesh:n}),e}},{key:"destroyStreamLine",value:function(t){var e=this._streamLines.findIndex((function(e){return e.streamLine===t}));if(e>=0){var i=this._streamLines.splice(e,1);this._removeMeshFromScene(i[0].mesh),i[0].streamLine.dispose()}}},{key:"_addMeshToScene",value:function(t){this._overlayCreated||(this._overlayCreated=!0,this._viewer.impl.createOverlayScene(Ut)),this._viewer.impl.addOverlay(Ut,t)}},{key:"_removeMeshFromScene",value:function(t){this._overlayCreated&&this._viewer.impl.removeOverlay(Ut,t)}},{key:"_getOrCreateMaterial",value:function(t){var e=t.lineColor,i=t.opacity,n=t.lineWidth,r=Ht.generateId(e,i,n),o=this._cachedMaterials[r];return o||(o=new Ht({lineColor:e,opacity:i,lineWidth:n}),this._cachedMaterials[r]=o),o}}])&&Bt(e.prototype,i),t}();function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function zt(t,e,i,n,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function Nt(t){return function(){var e=this,i=arguments;return new Promise((function(n,r){var o=t.apply(e,i);function a(t){zt(o,n,r,a,s,"next",t)}function s(t){zt(o,n,r,a,s,"throw",t)}a(void 0)}))}}function Gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xt(t,e){return Xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xt(t,e)}function qt(t,e){return!e||"object"!==Lt(e)&&"function"!=typeof e?Qt(t):e}function Qt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yt(t){return Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Yt(t)}var Kt=AutodeskNamespace("Autodesk.DataVisualization.Core");Kt=Object.assign(Kt,t),Kt=Object.assign(Kt,r()),(Kt=Object.assign(Kt,G)).Room=K,Kt.LevelRoomsMap=$,Kt.ModelStructureInfo=J,Kt.SurfaceShading=ft,Kt.PlanarHeatmap=xt,Kt.IDWDataProcessor=Dt,Kt.IDWProcessMaterial=At;var $t=Autodesk.Viewing,Jt=$t.Private,Zt="DataVizDots",te=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xt(t,e)}(h,t);var e,i,n,r,o,a,s,u=(a=h,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yt(a);if(s){var i=Yt(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return qt(this,t)});function h(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Gt(this,h),(e=u.call(this,t,i)).textureUtility=new Rt(t),e.pointMeshes=[],e._streamLineBuilder=null,e._onInstanceTreeReady=e._onInstanceTreeReady.bind(Qt(e)),e}return e=h,i=[{key:"load",value:(o=Nt(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.tool=new f(this.viewer,{delegate:this}),this.viewer.toolController.registerTool(this.tool),this.activate(),this.instanceTreeReadyPromise=new Promise((function(t,i){e.instanceTreeReadyPromiseResolve=t,e.instanceTreeReadyPromiseReject=i})),this.datavizDotOverlay=this.viewer.impl.createOverlayScene(Zt,null,null,null,!0,!0),this.viewer.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,this._onInstanceTreeReady),this.deviceDepthOcclusion=!1,t.abrupt("return",!0);case 8:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"unload",value:function(){return this.viewer.toolController.deregisterTool(this.tool),this.viewer.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,this._onInstanceTreeReady),this.removeSurfaceShading(),this.surfaceShading=null,this.deactivate(),!0}},{key:"activate",value:function(){return this.viewer.toolController.activateTool(this.tool.getName()),!0}},{key:"deactivate",value:function(){return this._streamLineBuilder&&(this._streamLineBuilder.dispose(),this._streamLineBuilder=null),this.viewer.toolController.deactivateTool(this.tool.getName()),this.removeSurfaceShading(),this.showTextures(),this.removeAllViewables(),!0}},{key:"_onInstanceTreeReady",value:function(t){this.instanceTreeReadyPromiseResolve&&this.instanceTreeReadyPromiseResolve()}},{key:"waitForInstanceTree",value:(r=Nt(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.getInstanceTree()){t.next=4;break}this.instanceTreeReadyPromiseResolve(),t.next=6;break;case 4:return t.next=6,this.instanceTreeReadyPromise;case 6:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"mapDbIdsToGeometries",value:function(t){var e=this.dbId2Geometry||{},i=new Set;return t.map((function(t){var n=e[t];n&&i.add(n)})),Array.from(i)}},{key:"addViewables",value:function(t){var e=this,i=THREE.ImageUtils.loadTexture(t.spriteAtlas.canvas.toDataURL());i.minFilter=THREE.LinearFilter,i.maxFilter=THREE.LinearFilter,i.flipY=!1;var n=new THREE.PointCloudMaterial({size:t.spriteSize*this.getWindow().devicePixelRatio,map:i,vertexColors:THREE.VertexColors,alphaTest:.5,transparent:!0,occlusion:1,depthTest:!0,depthWrite:!0});function r(t,e){var i=t.impl.renderer().getDepthTarget();if(i){var n=new THREE.Vector2(1/i.width,1/i.height);e.uniforms=Object.assign(e.uniforms||{},{tDepthTest:{type:"t",value:i},tDepthResolution:{type:"v2",value:n}})}}n.skipMrtNormals=!0,r(this.viewer,n),n.defines=Object.assign(n.defines||{},{PARTICLE_FRAGMENT:1,USE_VERTEX_ID:1,DEPTH_OCCLUSION:this.deviceDepthOcclusion?1:0,PARTICLE_UV:1,PARTICLE_FLAGS:""});var o=this.viewer.impl;o.matman().addMaterial("__dataVizSpriteMaterial__",n,!0),this.pointMaterial=n,this.viewableData=t,this.dbId2Geometry={},this.viewer.addEventListener($t.VIEWER_RESIZE_EVENT,(function(){r(e.viewer,n)}));var a=this,s=new p.SpriteMeshBuilder((function(t){t.dbIds.forEach((function(e){a.dbId2Geometry[e]=t}));var e=new THREE.Mesh(t,n);o.addOverlay(Zt,e),a.pointMeshes.push(e),setTimeout((function(){o.invalidate(!1,!1,!0)}),16)}));t.viewables.map((function(e){e.position&&s.addPoint(e,t.spriteAtlas)})),s.flushBuffer()}},{key:"removeAllViewables",value:function(){if(this.pointMeshes&&this.pointMeshes.length>0){var t=this.viewer.impl;this.pointMeshes.forEach((function(e){t.removeOverlay(Zt,e),e.geometry.dispose(),e.material.dispose()})),t.invalidate(!1,!1,!0)}this.pointMeshes=[],delete this.dbId2Geometry,delete this.viewableData}},{key:"changeOcclusion",value:function(t){if(this.deviceDepthOcclusion!=t){this.deviceDepthOcclusion=t;var e=t?1:0;this.pointMaterial&&this.pointMaterial.program&&(this.pointMaterial.defines.DEPTH_OCCLUSION=e,this.pointMaterial.needsUpdate=!0),this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"showHideViewables",value:function(t,e){this.changeOcclusion(e),this.pointMaterial&&(this.pointMaterial.visible=t,this.pointMaterial.needsUpdate=!0),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"highlightViewables",value:function(t){this.tool&&this.tool.markObject(t)}},{key:"clearHighlightedViewables",value:function(){this.tool&&this.tool.clearMarkedObject()}},{key:"invalidateViewables",value:function(t,e){!t||t.length<=0?console.warn("All parameters of 'invalidateViewables' are mandatory"):!this.pointMeshes||this.pointMeshes.length<=0||!this.viewableData?console.warn("'addViewables' must be called before 'invalidateViewables'"):this.tool&&this.tool.invalidateViewablesDirect(t,this.pointMeshes,this.viewableData,e)}},{key:"showTextures",value:function(){this.textureUtility.showTextures()}},{key:"hideTextures",value:function(){this.textureUtility.hideTextures()}},{key:"setupSurfaceShading",value:(n=Nt(regeneratorRuntime.mark((function t(e,i){var n,r,o=this,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:{},r=function(){var t=Nt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.surfaceShading&&o.surfaceShading.cleanUp(),"PlanarHeatmap"!=n.type){t.next=7;break}return t.next=4,o.viewer.loadExtension("Autodesk.CompGeom");case 4:o.surfaceShading=new xt(o.viewer,e,i,n),t.next=8;break;case 7:o.surfaceShading=new ft(o.viewer,e,i);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=4,this.waitForInstanceTree(e);case 4:return t.abrupt("return",r());case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"renderSurfaceShading",value:function(t,e,i,n){null==n?n={confidence:160}:"number"==typeof n&&(n={confidence:Math.abs(n)}),this.surfaceShading?this.surfaceShading.render(t,e,i,n):Jt.logger.error("Please call setupSurfaceShading first")}},{key:"updateSurfaceShading",value:function(t,e){this.surfaceShading?this.surfaceShading.updateShading(t,e):Jt.logger.error("Please call setupSurfaceShading first")}},{key:"registerSurfaceShadingColors",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;this.surfaceShading?this.surfaceShading.registerSensorColors(t,e,i):Jt.logger.error("Please call setupSurfaceShading first")}},{key:"removeSurfaceShading",value:function(){this.surfaceShading&&this.surfaceShading.removeShading()}},{key:"hasViewables",get:function(){return this.pointMeshes&&this.pointMeshes.length>0&&this.viewableData}},{key:"streamLineBuilder",get:function(){return this._streamLineBuilder||(this._streamLineBuilder=new Ft(this.viewer)),this._streamLineBuilder}}],i&&Wt(e.prototype,i),h}($t.Extension);$t.theExtensionManager.registerExtension("Autodesk.DataVisualization",te)})(),Autodesk.Extensions.DataVisualization=n})();
//# sourceMappingURL=DataVisualization.min.js.map