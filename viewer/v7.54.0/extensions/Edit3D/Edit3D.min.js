/*! For license information please see Edit3D.min.js.LICENSE.txt */
(()=>{var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.r(t),e.d(t,{default:()=>ee});var r=1,s=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n(this,e),this.viewer=t,this.pixelSize=i,this.scene=new THREE.Scene,this.shape=null,this.onCameraChange=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.scene.matrixAutoUpdate=!0,this.overlayName=s,this.overlayOwned=!s,this.overlayOwned&&(this.overlayName="Gizmo3D_Overlay_".concat(this.id),this.viewer.impl.createOverlayScene(this.overlayName)),this.visible=!1,this.id=r++,o&&this.setPosition(o)}var t,s;return t=e,s=[{key:"setPosition",value:function(e,t,n){return"object"===i(e)?this.scene.position.copy(e):this.scene.position.set(e,t,n),this.scene.matrixWorldNeedsUpdate,this.update(),this}},{key:"dtor",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.overlayOwned&&this.viewer.impl.removeOverlayScene(this.overlayName)}},{key:"clearShape",value:function(){this.shape&&(this.scene.remove(this.shape),this.shape=null)}},{key:"setShape",value:function(e){return this.clearShape(),this.shape=e,this.scene.add(e),this}},{key:"makeSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,t=.5,i=22,n=16,o=new THREE.SphereGeometry(t,i,n),r=new THREE.MeshPhongMaterial({color:e}),s=new THREE.Mesh(o,r);return this.setShape(s)}},{key:"makeCube",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,t=new THREE.BoxGeometry(1,1,1),i=new THREE.MeshPhongMaterial({color:e}),n=new THREE.Mesh(t,i);return this.setShape(n)}},{key:"setVisible",value:function(e){if(this.visible!=e)return e?this.viewer.impl.addOverlay(this.overlayName,this.scene):this.viewer.impl.removeOverlay(this.overlayName,this.scene),this.visible=e,this.viewer.impl.invalidate(!1,!1,!0),this}},{key:"update",value:function(){var e=this.viewer.impl.camera.position.distanceTo(this.scene.position),t=this.viewer.impl.camera.pixelsPerUnitAtDistance(e),i=this.pixelSize/t;this.scene.scale.set(i,i,i),this.scene.matrixWorldNeedsUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"onCameraChange",value:function(){this.update()}}],s&&o(t.prototype,s),e}();function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function h(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var v=Autodesk.Viewing,d=Autodesk.Viewing.Private,y={DRAG_START:"dragStart",DRAG_END:"dragEnd"},b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(s,Autodesk.Viewing.EventDispatcher);var t,i,n,o,r=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(n);if(o){var i=f(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return h(this,e)});function s(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new THREE.Vector3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"<Empty>";l(this,s),(t=r.call(this)).viewer=e,t.pos3D=i,t.pos2D=new THREE.Vector3,t.draggable=!1,t.setGlobalManager(e.globalManager),t.cameraChangeCb=t.update.bind(p(t)),t.viewer.addEventListener(v.CAMERA_CHANGE_EVENT,t.cameraChangeCb),t.viewer.addEventListener(v.VIEWER_RESIZE_EVENT,t.cameraChangeCb);var o=e.canvasWrap.ownerDocument;t.container=o.createElement("div"),e.canvasWrap.appendChild(t.container);var a=function(e){t.container.style.opacity=e};return t.opacityParam=new d.AnimatedParam(0,a,.5),t.opacityParam.fadeTo(1),t.container.style.left="0px",t.container.style.top="0px",t.container.style.position="absolute",t.container.style.pointerEvents="none",t.textDiv=null,n&&t.setText(n),t.worldBox=null,t.minPixels=0,t.setVisible(!0),t.onMouseDown=t.onMouseDown.bind(p(t)),t}return t=s,(i=[{key:"shouldBeHidden",value:function(){return!!this.worldBox&&(e=this.viewer,t=this.worldBox.min,i=this.worldBox.max,n=e.impl.worldToClient(t),r=(o=e.impl.worldToClient(i)).x-n.x,s=o.y-n.y,Math.sqrt(r*r+s*s)<this.minPixels);var e,t,i,n,o,r,s}},{key:"setWorldBox",value:function(e,t){this.worldBox=e,this.minPixels=t,this.update()}},{key:"initTextLabel",value:function(){var e=this.viewer.container.ownerDocument;this.textDiv=e.createElement("div"),this.container.appendChild(this.textDiv),this.container.classList.add("measure-length"),this.container.classList.add("visible"),this.textDiv.classList.add("measure-length-text")}},{key:"setText",value:function(e){this.textDiv||this.initTextLabel(),this.textDiv.textContent=Autodesk.Viewing.i18n.translate(e)}},{key:"dtor",value:function(){this.container.remove(),this.viewer.removeEventListener(v.CAMERA_CHANGE_EVENT,this.cameraChangeCb),this.viewer.removeEventListener(v.VIEWER_RESIZE_EVENT,this.cameraChangeCb)}},{key:"update",value:function(){var e=this,t=this.viewer.impl.worldToClient(this.pos3D),i=t.x,n=t.y;this.container.style.transform="translate(calc(".concat(i,"px - 50%), calc(").concat(n,"px - 50%))");var o=!this.visible||this.shouldBeHidden();o||this.changeContainerVisibility(!o),this.opacityParam.fadeTo(o?0:1,(function(){e.changeContainerVisibility(!o)}))}},{key:"changeContainerVisibility",value:function(e){e||this.styleHidden?e&&this.styleHidden&&(this.styleHidden=!1,this.container.style.display="block"):(this.styleHidden=!0,this.container.style.display="none")}},{key:"setPosition",value:function(e){this.pos3D.copy(e),this.update()}},{key:"setVisible",value:function(e){this.visible=e,this.update()}},{key:"dispose",value:function(){var e=this;this.setVisible(!1),window.setTimeout((function(){return e.dtor()}),1e3*this.opacityParam.animTime)}},{key:"setVerticalOffset",value:function(e){this.container.style.top=e+"px"}},{key:"onMouseDown",value:function(e){var t=this;this.container.style.cursor="grabbing",this.viewer.toolController.__clientToCanvasCoords(e),this.fireEvent({type:y.DRAG_START,event:e}),this.addDocumentEventListener("mouseup",(function e(i){t.onMouseUp(i),t.removeDocumentEventListener("mouseup",e)}))}},{key:"onMouseUp",value:function(e){this.container.style.cursor="grab",this.viewer.toolController.__clientToCanvasCoords(e),this.fireEvent({type:y.DRAG_END,event:e})}},{key:"setDraggable",value:function(e){e&&!this.draggable?(this.container.addEventListener("mousedown",this.onMouseDown),this.container.style.cursor="grab",this.container.style.pointerEvents="auto"):!e&&this.draggable&&(this.container.removeEventListener("mousedown",this.onMouseDown),this.container.style.cursor="",this.container.style.pointerEvents="none"),this.draggable=e}}])&&c(t.prototype,i),s}();function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t,i){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}},w(e,t,i||e)}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function P(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}v.GlobalManagerMixin.call(b.prototype),b.Events=y;var T=function(e){return['<svg width="50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<g stroke-width="2" stroke="currentColor" fill="none">',e,"</g>","</svg>"].join("")},C={Cross:'<path d="M0 25 L50 25 M25 0 L25 50"/>',Circle:'<circle r="5" cx="25" cy="27.5" fill="currentColor" stroke-width="0" />',Empty:""},S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(s,e);var t,i,n,o,r=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O(n);if(o){var i=O(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return P(this,e)});function s(e,t,i){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.Cross;return E(this,s),(n=r.call(this,e,t,null)).container.innerHTML=T(o),i&&(n.label=new b(e,t,i),n.label.setVerticalOffset(-45)),n.labelVisible=!0,n}return t=s,(i=[{key:"setColor",value:function(e){this.container.style.color=e}},{key:"setPosition",value:function(e){w(O(s.prototype),"setPosition",this).call(this,e),this.label&&this.label.setPosition(e)}},{key:"setVisible",value:function(e){w(O(s.prototype),"setVisible",this).call(this,e),this.label&&this.label.setVisible(this.labelVisible&&e)}},{key:"setLabelVisible",value:function(e){this.label&&this.label.setVisible(this.visible&&e)}}])&&m(t.prototype,i),s}(b);function D(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function _(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?D(Object(i),!0).forEach((function(t){M(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function M(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function x(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}S.Events=b.Events,S.Icons=C;var A="ModelAlignment.CoordPicker",R={POINT_CLICKED:"pointClicked",POINT_HOVERED:"pointHovered",ESCAPE:"escape"},V=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.snapper=i,this.onCameraChanged=this.onCameraChanged.bind(this),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.selectionPlane=null,this.enableSnapper=!0,this.snapperActive=!1,this.isDragging=!1,this.keyMap={SnapKey:Autodesk.Viewing.KeyCode.SHIFT},this.canvasPos=new THREE.Vector2,this.tmpPoint=new THREE.Vector3,this.tmpMatrix3=new THREE.Matrix3,this.lastHit=null,this.consumeClickEvents=!0,this.snapFilter=null,this.setCursor()}var t,i;return t=e,(i=[{key:"setSelectionPlane",value:function(e){this.selectionPlane=e}},{key:"getName",value:function(){return A}},{key:"getNames",value:function(){return[A]}},{key:"setCursor",value:function(e){this.cursor=e||"crosshair"}},{key:"getCursor",value:function(){return this.isDragging?"grabbing":this.active&&this.lastHit?this.cursor:null}},{key:"snapperOn",value:function(){this.snapperActive||(this.viewer.toolController.activateTool(this.snapper.getName()),this.snapperActive=!0)}},{key:"snapperOff",value:function(){this.snapperActive&&(this.viewer.toolController.deactivateTool(this.snapper.getName()),this.snapperActive=!1)}},{key:"setSnapperEnabled",value:function(e){this.enableSnapper=e,e?this.snapperOn():this.snapperOff()}},{key:"setSnapFilter",value:function(e){this.snapFilter=e,this.snapper.setSnapFilter(e)}},{key:"activate",value:function(){this.active=!0,this.enableSnapper&&this.snapperOn(),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.viewer.impl.pauseHighlight(!0)}},{key:"deactivate",value:function(){this.active=!1,this.isDragging=!1,this.lastHit=null,this.snapperOff(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.viewer.impl.pauseHighlight(!1)}},{key:"register",value:function(){}},{key:"trackMousePos",value:function(e){this.canvasPos.set(e.canvasX,e.canvasY)}},{key:"handleMouseMove",value:function(e){this.trackMousePos(e),this.snapper.onMouseMove({x:e.canvasX,y:e.canvasY}),this.snapper.indicator&&this.snapper.indicator.render();var t=this.getHitResultUnderMouse(e);return this.fireEvent(_({type:R.POINT_HOVERED},t)),this.isDragging}},{key:"getHitResultUnderMouse",value:function(e){var t=null,i=null,n=null,o=null;if(this.snapperActive&&this.snapper.isSnapped()){var r=this.snapper.getSnapResult();t=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(r,this.viewer),i=null==r?void 0:r.faceNormal,n=null==r?void 0:r.modelId,o=null==r?void 0:r.snapNode}else{var s,a,l=this.viewer.impl.hitTest(e.canvasX,e.canvasY);if(t=null==l?void 0:l.point,null==l||null===(s=l.face)||void 0===s?void 0:s.normal){var c=this.viewer.impl.getRenderProxy(l.model,l.fragId),u=this.tmpMatrix3.getNormalMatrix(c.matrixWorld);i=l.face.normal.clone().applyMatrix3(u).normalize()}n=null==l||null===(a=l.model)||void 0===a?void 0:a.id,o=null==l?void 0:l.dbId}this.snapFilter&&!this.snapFilter({modelId:n})&&(t=null,i=null,n=null,o=null),t&&this.selectionPlane&&(t=this.selectionPlane.projectPoint(t,this.tmpPoint));var h={point:t,normal:i,modelId:n,dbId:o};return this.lastHit=t?h:null,h}},{key:"setConsumeClickEvents",value:function(e){this.consumeClickEvents=e}},{key:"handleSingleClick",value:function(e,t){if(this.trackMousePos(e),0!==t)return!1;var i=this.getHitResultUnderMouse(e);return this.fireEvent(_({type:R.POINT_CLICKED},i)),this.consumeClickEvents}},{key:"handleDoubleClick",value:function(e){this.trackMousePos(e)}},{key:"handleButtonDown",value:function(e){return this.trackMousePos(e),this.isDragging&&this.snapperOn(),this.handleMouseMove(e)}},{key:"handleButtonUp",value:function(e){return this.trackMousePos(e),this.isDragging}},{key:"onSnappingToggled",value:function(){this.handleMouseMove({canvasX:this.canvasPos.x,canvasY:this.canvasPos.y})}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return this.fireEvent({type:R.ESCAPE}),!0;case this.keyMap.SnapKey:return!!this.snapperActive&&(this.snapperOff(),this.onSnappingToggled(),!0)}return!1}},{key:"handleKeyUp",value:function(e,t){return!(t!==this.keyMap.SnapKey||this.snapperActive||!this.enableSnapper||(this.snapperOn(),this.onSnappingToggled(),0))}},{key:"onCameraChanged",value:function(){this.snapper.indicator&&this.snapper.indicator.render()}},{key:"setDragging",value:function(e){this.isDragging=e}},{key:"getDragging",value:function(){return this.isDragging}}])&&x(t.prototype,i),e}();function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}V.Events=R,V.Name=A;var L={POINT_SELECTED:"pointSelected",POINT_HOVERED:"pointHovered",POINT_SELECTION_STARTED:"pointSelectionStarted",CLEAR:"clear"},H={Blue:"rgb(6, 150, 215)",Red:"rgb(236, 74, 65)",Black:"rgb(0,0,0)",White:"rgb(255,255,255)"},j={Line:"line",Arrow:"arrow"},G=function(){function e(t,i,n,o){var r=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};N(this,e),this.viewer=t,this.options=s,this.coordPicker=i,this.N=o,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.selectingIndex=-1,this.lastSelectedPoint=-1,this.coordPicker.addEventListener(V.Events.POINT_CLICKED,(function(e){return r.onPointClicked(e)})),this.coordPicker.addEventListener(V.Events.POINT_HOVERED,(function(e){return r.onPointHovered(e)})),this.coordPicker.addEventListener(V.Events.ESCAPE,(function(){r.coordPicker.isDragging&&r.cancelPointSelection()})),this.points=[],this.pointValid=[],this.markers=[],this.showMarkers=this.options.showMarkers||new Array(this.N).fill(!0);for(var a=function(e){r.points.push(new THREE.Vector3),r.pointValid.push(!1);var t=s.colors?s.colors[e]:H.Blue,i=s.labels?s.labels[e]:void 0,n=s.icons?s.icons[e]:void 0,o=new S(r.viewer,void 0,i,n);r.markers.push(o),r.options.draggable&&(o.addEventListener(S.Events.DRAG_START,(function(){return r.startSelectPoint(e,!0)})),o.addEventListener(S.Events.DRAG_END,(function(e){return r.onDragEnded(e)}))),o.setVisible(!1),o.setColor(t),s.labelStyles&&s.labelStyles[e]&&Object.keys(s.labelStyles[e]).forEach((function(t){o.label.container.style[t]=s.labelStyles[e][t]}))},l=0;l<this.N;l++)a(l);this.screenOverlay=n;var c=this.options.connections||[];this.connectors=[];for(var u=function(e){var t=c[e],i=new Autodesk.Edit2D.Style({lineStyle:10,lineWidth:1.5,lineColor:t.color||H.Blue}),o=void 0,s=void 0,a=void 0,l=void 0;if(t.type===j.Line)(o=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo).line2D.style.copy(i),s=o.line2D,a=o.a.copy.bind(o.a),l=o.b.copy.bind(o.b);else{if(t.type!==j.Arrow)return console.warn("Invalid connector type."),"continue";(o=new Autodesk.Edit2D.ScreenOverlay.Arrow3DGizmo).arrow.line.style.copy(i),o.arrow.head.style.fillColor=i.lineColor,o.arrow.setHeadLength(18),o.arrow.setHeadAngle(40),s=o.arrow.line,a=o.setFrom.bind(o),l=o.setTo.bind(o)}var u=void 0;t.getEdgeLabelText&&((u=new Autodesk.Edit2D.EdgeLabel(n.layer)).attachToEdge(s,0,0),t.labelStyle&&Object.keys(t.labelStyle).forEach((function(e){u.container.style[e]=t.labelStyle[e]}))),r.connectors.push({fromIndex:t.fromIndex,toIndex:t.toIndex,getEdgeLabelText:t.getEdgeLabelText,gizmo:o,label:u,setFrom:a,setTo:l})},h=0;h<c.length;h++)u(h);this.visible=!0,this.stops=this.options.stops||[],this.onModelTransformChanged=this.onModelTransformChanged.bind(this),this.modelsToPointsMap={}}var t,i;return t=e,i=[{key:"dtor",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)}},{key:"startSelectPoint",value:function(e,t){this.pointBackup=this.pointValid[e]?this.points[e].clone():null,this.viewer.toolController.isToolActivated(this.coordPicker.getName())||this.viewer.toolController.activateTool(this.coordPicker.getName()),this.selectingIndex=e,this.options.draggable&&(this.coordPicker.setDragging(t),this.setMarkersDraggable(!1)),this.fireEvent({type:L.POINT_SELECTION_STARTED,index:this.selectingIndex})}},{key:"onDragEnded",value:function(e){var t=e.event;this.coordPicker.getDragging()&&(this.coordPicker.handleSingleClick(t,0),this.coordPicker.setDragging(!1))}},{key:"startSelect",value:function(){this.isActive=!0,this.continuePointSelectionIfNeeded()}},{key:"setPoint",value:function(e,t){this.pointValid[e]=!!t,this.pointValid[e]&&(this.points[e].copy(t),this.markers[e].setPosition(t)),this.updateGizmos()}},{key:"updateGizmoVisibility",value:function(e,t,i){t||i?this.screenOverlay.setGizmoVisible(e,t):this.screenOverlay.fadeOutGizmo(e)}},{key:"updateGizmos",value:function(e){for(var t=0;t<this.N;t++){var i=this.showMarkers[t]&&this.visible&&this.pointValid[t];this.markers[t].setVisible(i)}for(var n=0;n<this.connectors.length;n++){var o=this.connectors[n],r=this.visible&&this.pointValid[o.fromIndex]&&this.pointValid[o.toIndex];if(this.updateGizmoVisibility(o.gizmo,r,e),r&&(o.setFrom(this.points[o.fromIndex]),o.setTo(this.points[o.toIndex])),o.label&&(o.label.setOpacity(r?1:0,!0),r)){var s=o.getEdgeLabelText(n);o.label.setText(s)}}this.screenOverlay.update()}},{key:"clearPoint",value:function(e){this.pointValid[e]=!1,this.markers[e].setVisible(!1),this.updateGizmos()}},{key:"clear",value:function(){this.cancelPointSelection();for(var e=0;e<this.N;e++)this.pointValid[e]=!1,this.markers[e].setVisible(!1);this.selectingIndex=-1,this.lastSelectedPoint=-1,this.updateGizmos(),this.isActive=!1,this.fireEvent({type:L.CLEAR})}},{key:"onPointHovered",value:function(e){-1!==this.selectingIndex&&(this.setPoint(this.selectingIndex,e.point),this.fireEvent({type:L.POINT_HOVERED,point:e.point,index:this.selectingIndex}))}},{key:"onPointClicked",value:function(e){var t=e.point,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1!==this.selectingIndex){t=t||this.pointBackup,this.pointBackup=null,this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName()),t&&(this.viewer.impl.camera.pivot.copy(t),this.viewer.impl.camera.dirty=!0),this.setPoint(this.selectingIndex,t),this.setMarkersDraggable(!0);var n=this.selectingIndex;this.selectingIndex=-1,t&&(this.lastSelectedPoint=Math.max(n,this.lastSelectedPoint),this.fireEvent({type:L.POINT_SELECTED,point:t,index:n})),!i||t&&this.stops.includes(this.lastSelectedPoint)||this.continuePointSelectionIfNeeded()}}},{key:"setMarkersDraggable",value:function(e){if(this.options.draggable)for(var t=0;t<this.N;t++){var i=e&&this.visible&&this.pointValid[t]&&this.showMarkers[t];this.markers[t].setDraggable(i)}}},{key:"cancelPointSelection",value:function(){this.onPointClicked({},!1)}},{key:"continuePointSelectionIfNeeded",value:function(){if(this.isPickerActive()){this.setVisible(!0);for(var e=0;e<this.N;e++)if(!this.pointValid[e]){this.startSelectPoint(e,!1);break}}}},{key:"setVisible",value:function(e,t){e!==this.visible&&(this.visible=e,this.updateGizmos(t))}},{key:"forceHide",value:function(){this.setVisible(!1,!0)}},{key:"areAllPointsSet",value:function(){if(-1!==this.selectingIndex)return!1;for(var e=0;e<this.N;e++)if(!this.pointValid[e])return!1;return!0}},{key:"isPickerActive",value:function(){return this.isActive}},{key:"attachPointsToModel",value:function(e,t){var i,n,o;this.setModelsToPointsMap(Object.assign({},this.modelsToPointsMap,(i={},o=t,(n=e.id)in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i)))}},{key:"setModelsToPointsMap",value:function(e){var t=this;this.modelsToPointsMap=e;var i=Object.keys(this.modelsToPointsMap);i.length>0?(i.forEach((function(e){var i,n=null===(i=t.viewer.impl.findModel(Number(e),!0).getModelTransform())||void 0===i?void 0:i.clone();t.modelsToPointsMap[e].matrix=n||new Autodesk.Viewing.Private.LmvMatrix4(!0)})),this.viewer.hasEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)||this.viewer.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)):this.viewer.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)}},{key:"onModelTransformChanged",value:function(e){var t=e.model,i=e.matrix;if(this.modelsToPointsMap){var n=this.modelsToPointsMap[t.id];if(n){var o=this.modelsToPointsMap[t.id].matrix.invert();o.multiplyMatrices(i,o),this.modelsToPointsMap[t.id].matrix=i.clone();for(var r=0;r<this.N;r++)if(n.includes(r)&&this.pointValid[r]){var s=this.points[r];s.applyMatrix4(o),this.setPoint(r,s)}}}}}],i&&I(t.prototype,i),e}();function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function F(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function z(e,t){return z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},z(e,t)}function K(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}G.Events=L,G.Colors=H,G.ConnectorTypes=j;var W=Object.assign({},G.Events,{FROM_POINT_SELECTED:"fromPointSelected",TO_POINT_SELECTED:"toPointSelected",FROM_POINT_HOVERED:"fromPointHovered",TO_POINT_HOVERED:"toPointHovered"}),X=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(s,e);var t,i,n,o,r=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(n);if(o){var i=U(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return K(this,e)});function s(e,t,i,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(o=r.call(this,e,t,i,2,n)).addEventListener(G.Events.POINT_SELECTED,(function(e){var t=e.point;0===e.index?o.fireEvent({type:W.FROM_POINT_SELECTED,point:t}):o.fireEvent({type:W.TO_POINT_SELECTED,point:t})})),o.addEventListener(G.Events.POINT_HOVERED,(function(e){var t=e.point;0===e.index?o.fireEvent({type:W.FROM_POINT_HOVERED,point:t}):o.fireEvent({type:W.TO_POINT_HOVERED,point:t})})),o}return t=s,(i=[{key:"setOffset",value:function(e){this.offset.copy(e)}},{key:"startSelectFrom",value:function(){this.startSelectPoint(0)}},{key:"startSelectTo",value:function(){this.startSelectPoint(1)}}])&&F(t.prototype,i),s}(G);function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function Z(e,t){return Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Z(e,t)}function q(e,t){return!t||"object"!==Y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function J(e){return J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},J(e)}X.Events=W;var Q=Autodesk.Viewing,$=AutodeskNamespace("Autodesk.Edit3D"),ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(o,e);var t,i,n=(t=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=J(t);if(i){var o=J(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return q(this,e)});function o(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n.call(this,e,t)}return o}(Q.Extension);$.Gizmo3D=s,$.Label3D=b,$.PointMarker=S,$.CoordPicker=V,$.TwoPointPicker=X,$.NPointPicker=G,Q.theExtensionManager.registerExtension("Autodesk.Edit3D",ee)})(),Autodesk.Extensions.Edit3D=t})();
//# sourceMappingURL=Edit3D.min.js.map