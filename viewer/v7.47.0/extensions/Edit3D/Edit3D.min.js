/*!
 * LMV v7.47.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Edit3D=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=603)}({603:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,"default",(function(){return re}));var s=1,a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;o(this,e),this.viewer=t,this.pixelSize=n,this.scene=new THREE.Scene,this.shape=null,this.onCameraChange=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.scene.matrixAutoUpdate=!0,this.overlayName=r,this.overlayOwned=!r,this.overlayOwned&&(this.overlayName="Gizmo3D_Overlay_".concat(this.id),this.viewer.impl.createOverlayScene(this.overlayName)),this.visible=!1,this.id=s++,i&&this.setPosition(i)}var t,n,a;return t=e,(n=[{key:"setPosition",value:function(e,t,n){return"object"===i(e)?this.scene.position.copy(e):this.scene.position.set(e,t,n),this.scene.matrixWorldNeedsUpdate,this.update(),this}},{key:"dtor",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.overlayOwned&&this.viewer.impl.removeOverlayScene(this.overlayName)}},{key:"clearShape",value:function(){this.shape&&(this.scene.remove(this.shape),this.shape=null)}},{key:"setShape",value:function(e){return this.clearShape(),this.shape=e,this.scene.add(e),this}},{key:"makeSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,t=.5,n=22,i=16,o=new THREE.SphereGeometry(t,n,i),r=new THREE.MeshPhongMaterial({color:e}),s=new THREE.Mesh(o,r);return this.setShape(s)}},{key:"makeCube",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,t=new THREE.BoxGeometry(1,1,1),n=new THREE.MeshPhongMaterial({color:e}),i=new THREE.Mesh(t,n);return this.setShape(i)}},{key:"setVisible",value:function(e){if(this.visible!=e)return e?this.viewer.impl.addOverlay(this.overlayName,this.scene):this.viewer.impl.removeOverlay(this.overlayName,this.scene),this.visible=e,this.viewer.impl.invalidate(!1,!1,!0),this}},{key:"update",value:function(){var e=this.viewer.impl.camera.position.distanceTo(this.scene.position),t=this.viewer.impl.camera.pixelsPerUnitAtDistance(e),n=this.pixelSize/t;this.scene.scale.set(n,n,n),this.scene.matrixWorldNeedsUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"onCameraChange",value:function(){this.update()}}])&&r(t.prototype,n),a&&r(t,a),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d(e);if(t){var o=d(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=Autodesk.Viewing,b=Autodesk.Viewing.Private,g={DRAG_START:"dragStart",DRAG_END:"dragEnd"},E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(r,Autodesk.Viewing.EventDispatcher);var t,n,i,o=f(r);function r(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new THREE.Vector3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"<Empty>";c(this,r),(t=o.call(this)).viewer=e,t.pos3D=n,t.pos2D=new THREE.Vector3,t.draggable=!1,t.setGlobalManager(e.globalManager),t.cameraChangeCb=t.update.bind(v(t)),t.viewer.addEventListener(y.CAMERA_CHANGE_EVENT,t.cameraChangeCb),t.viewer.addEventListener(y.VIEWER_RESIZE_EVENT,t.cameraChangeCb);var s=e.canvasWrap.ownerDocument;t.container=s.createElement("div"),e.canvasWrap.appendChild(t.container);var a=function(e){t.container.style.opacity=e};return t.opacityParam=new b.AnimatedParam(0,a,.5),t.opacityParam.fadeTo(1),t.container.style.left="0px",t.container.style.top="0px",t.container.style.position="absolute",t.container.style.pointerEvents="none",t.textDiv=null,i&&t.setText(i),t.worldBox=null,t.minPixels=0,t.setVisible(!0),t.onMouseDown=t.onMouseDown.bind(v(t)),t}return t=r,(n=[{key:"shouldBeHidden",value:function(){return!!this.worldBox&&(e=this.viewer,t=this.worldBox.min,n=this.worldBox.max,i=e.impl.worldToClient(t),o=e.impl.worldToClient(n),r=o.x-i.x,s=o.y-i.y,Math.sqrt(r*r+s*s)<this.minPixels);var e,t,n,i,o,r,s}},{key:"setWorldBox",value:function(e,t){this.worldBox=e,this.minPixels=t,this.update()}},{key:"initTextLabel",value:function(){var e=this.viewer.container.ownerDocument;this.textDiv=e.createElement("div"),this.container.appendChild(this.textDiv),this.container.classList.add("measure-length"),this.container.classList.add("visible"),this.textDiv.classList.add("measure-length-text")}},{key:"setText",value:function(e){this.textDiv||this.initTextLabel(),this.textDiv.textContent=Autodesk.Viewing.i18n.translate(e)}},{key:"dtor",value:function(){this.container.remove(),this.viewer.removeEventListener(y.CAMERA_CHANGE_EVENT,this.cameraChangeCb),this.viewer.removeEventListener(y.VIEWER_RESIZE_EVENT,this.cameraChangeCb)}},{key:"update",value:function(){var e=this,t=this.viewer.impl.worldToClient(this.pos3D),n=t.x,i=t.y;this.container.style.transform="translate(calc(".concat(n,"px - 50%), calc(").concat(i,"px - 50%))");var o=!this.visible||this.shouldBeHidden();o||this.changeContainerVisibility(!o),this.opacityParam.fadeTo(o?0:1,(function(){e.changeContainerVisibility(!o)}))}},{key:"changeContainerVisibility",value:function(e){e||this.styleHidden?e&&this.styleHidden&&(this.styleHidden=!1,this.container.style.display="block"):(this.styleHidden=!0,this.container.style.display="none")}},{key:"setPosition",value:function(e){this.pos3D.copy(e),this.update()}},{key:"setVisible",value:function(e){this.visible=e,this.update()}},{key:"dispose",value:function(){var e=this;this.setVisible(!1),window.setTimeout((function(){return e.dtor()}),1e3*this.opacityParam.animTime)}},{key:"setVerticalOffset",value:function(e){this.container.style.top=e+"px"}},{key:"onMouseDown",value:function(e){var t=this;this.container.style.cursor="grabbing",this.viewer.toolController.__clientToCanvasCoords(e),this.fireEvent({type:g.DRAG_START,event:e}),this.addDocumentEventListener("mouseup",(function e(n){t.onMouseUp(n),t.removeDocumentEventListener("mouseup",e)}))}},{key:"onMouseUp",value:function(e){this.container.style.cursor="grab",this.viewer.toolController.__clientToCanvasCoords(e),this.fireEvent({type:g.DRAG_END,event:e})}},{key:"setDraggable",value:function(e){e&&!this.draggable?(this.container.addEventListener("mousedown",this.onMouseDown),this.container.style.cursor="grab",this.container.style.pointerEvents="auto"):!e&&this.draggable&&(this.container.removeEventListener("mousedown",this.onMouseDown),this.container.style.cursor="",this.container.style.pointerEvents="none"),this.draggable=e}}])&&u(t.prototype,n),i&&u(t,i),r}();function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,n){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var o=S(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return C(this,n)}}function C(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}y.GlobalManagerMixin.call(E.prototype),E.Events=g;var D=function(e){return['<svg width="50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<g stroke-width="2" stroke="currentColor" fill="none">',e,"</g>","</svg>"].join("")},_={Cross:'<path d="M0 25 L50 25 M25 0 L25 50"/>',Circle:'<circle r="5" cx="25" cy="27.5" fill="currentColor" stroke-width="0" />',Empty:""},x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(r,e);var t,n,i,o=T(r);function r(e,t,n){var i,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.Cross;return w(this,r),(i=o.call(this,e,t,null)).container.innerHTML=D(s),n&&(i.label=new E(e,t,n),i.label.setVerticalOffset(-45)),i.labelVisible=!0,i}return t=r,(n=[{key:"setColor",value:function(e){this.container.style.color=e}},{key:"setPosition",value:function(e){P(S(r.prototype),"setPosition",this).call(this,e),this.label&&this.label.setPosition(e)}},{key:"setVisible",value:function(e){P(S(r.prototype),"setVisible",this).call(this,e),this.label&&this.label.setVisible(this.labelVisible&&e)}},{key:"setLabelVisible",value:function(e){this.label&&this.label.setVisible(this.visible&&e)}}])&&k(t.prototype,n),i&&k(t,i),r}(E);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}x.Events=E.Events,x.Icons=_;var N="ModelAlignment.CoordPicker",I={POINT_CLICKED:"pointClicked",POINT_HOVERED:"pointHovered",ESCAPE:"escape"},L=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.snapper=n,this.onCameraChanged=this.onCameraChanged.bind(this),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.selectionPlane=null,this.enableSnapper=!0,this.snapperActive=!1,this.isDragging=!1,this.keyMap={SnapKey:Autodesk.Viewing.KeyCode.SHIFT},this.canvasPos=new THREE.Vector2,this.tmpPoint=new THREE.Vector3,this.tmpMatrix3=new THREE.Matrix3,this.lastHit=null,this.setCursor()}var t,n,i;return t=e,(n=[{key:"setSelectionPlane",value:function(e){this.selectionPlane=e}},{key:"getName",value:function(){return N}},{key:"getNames",value:function(){return[N]}},{key:"setCursor",value:function(e){this.cursor=e||"crosshair"}},{key:"getCursor",value:function(){return this.isDragging?"grabbing":this.active&&this.lastHit?this.cursor:null}},{key:"snapperOn",value:function(){this.snapperActive||(this.viewer.toolController.activateTool(this.snapper.getName()),this.snapperActive=!0)}},{key:"snapperOff",value:function(){this.snapperActive&&(this.viewer.toolController.deactivateTool(this.snapper.getName()),this.snapperActive=!1)}},{key:"setSnapperEnabled",value:function(e){this.enableSnapper=e,e?this.snapperOn():this.snapperOff()}},{key:"activate",value:function(){this.active=!0,this.enableSnapper&&this.snapperOn(),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.viewer.impl.pauseHighlight(!0)}},{key:"deactivate",value:function(){this.active=!1,this.isDragging=!1,this.lastHit=null,this.snapperOff(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.viewer.impl.pauseHighlight(!1)}},{key:"register",value:function(){}},{key:"trackMousePos",value:function(e){this.canvasPos.set(e.canvasX,e.canvasY)}},{key:"handleMouseMove",value:function(e){this.trackMousePos(e),this.snapper.onMouseMove({x:e.canvasX,y:e.canvasY}),this.snapper.indicator&&this.snapper.indicator.render();var t=this.getHitResultUnderMouse(e);return this.fireEvent(A({type:I.POINT_HOVERED},t)),this.isDragging}},{key:"getHitResultUnderMouse",value:function(e){var t=null,n=null,i=null,o=null;if(this.snapperActive&&this.snapper.isSnapped()){var r=this.snapper.getSnapResult();t=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(r,this.viewer),n=null==r?void 0:r.faceNormal,i=null==r?void 0:r.modelId,o=null==r?void 0:r.snapNode}else{var s,a,l=this.viewer.impl.hitTest(e.canvasX,e.canvasY);if(t=null==l?void 0:l.point,null==l||null===(s=l.face)||void 0===s?void 0:s.normal){var c=this.viewer.impl.getRenderProxy(l.model,l.fragId),u=this.tmpMatrix3.getNormalMatrix(c.matrixWorld);n=l.face.normal.clone().applyMatrix3(u).normalize()}i=null==l||null===(a=l.model)||void 0===a?void 0:a.id,o=null==l?void 0:l.dbId}t&&this.selectionPlane&&(t=this.selectionPlane.projectPoint(t,this.tmpPoint));var h={point:t,normal:n,modelId:i,dbId:o};return this.lastHit=t?h:null,h}},{key:"handleSingleClick",value:function(e,t){if(this.trackMousePos(e),0!=t)return!1;var n=this.getHitResultUnderMouse(e);return this.fireEvent(A({type:I.POINT_CLICKED},n)),!0}},{key:"handleDoubleClick",value:function(e){this.trackMousePos(e)}},{key:"handleButtonDown",value:function(e){return this.trackMousePos(e),this.isDragging&&this.snapperOn(),this.handleMouseMove(e)}},{key:"handleButtonUp",value:function(e){return this.trackMousePos(e),this.isDragging}},{key:"onSnappingToggled",value:function(){this.handleMouseMove({canvasX:this.canvasPos.x,canvasY:this.canvasPos.y})}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return this.fireEvent({type:I.ESCAPE}),!0;case this.keyMap.SnapKey:return!!this.snapperActive&&(this.snapperOff(),this.onSnappingToggled(),!0)}return!1}},{key:"handleKeyUp",value:function(e,t){switch(t){case this.keyMap.SnapKey:return!(this.snapperActive||!this.enableSnapper||(this.snapperOn(),this.onSnappingToggled(),0))}return!1}},{key:"onCameraChanged",value:function(){this.snapper.indicator&&this.snapper.indicator.render()}},{key:"setDragging",value:function(e){this.isDragging=e}},{key:"getDragging",value:function(){return this.isDragging}}])&&V(t.prototype,n),i&&V(t,i),e}();function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}L.Events=I,L.Name=N;var G={POINT_SELECTED:"pointSelected",POINT_HOVERED:"pointHovered",POINT_SELECTION_STARTED:"pointSelectionStarted",CLEAR:"clear"},B={Blue:"rgb(6, 150, 215)",Red:"rgb(236, 74, 65)",Black:"rgb(0,0,0)",White:"rgb(255,255,255)"},z={Line:"line",Arrow:"arrow"},F=function(){function e(t,n,i,o){var r=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};j(this,e),this.viewer=t,this.options=s,this.coordPicker=n,this.N=o,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.selectingIndex=-1,this.lastSelectedPoint=-1,this.coordPicker.addEventListener(L.Events.POINT_CLICKED,(function(e){return r.onPointClicked(e)})),this.coordPicker.addEventListener(L.Events.POINT_HOVERED,(function(e){return r.onPointHovered(e)})),this.coordPicker.addEventListener(L.Events.ESCAPE,(function(){r.coordPicker.isDragging&&r.cancelPointSelection()})),this.points=[],this.pointValid=[],this.markers=[],this.showMarkers=this.options.showMarkers||new Array(this.N).fill(!0);for(var a=function(e){r.points.push(new THREE.Vector3),r.pointValid.push(!1);var t=s.colors?s.colors[e]:B.Blue,n=s.labels?s.labels[e]:void 0,i=s.icons?s.icons[e]:void 0,o=new x(r.viewer,void 0,n,i);r.markers.push(o),r.options.draggable&&(o.addEventListener(x.Events.DRAG_START,(function(){return r.startSelectPoint(e,!0)})),o.addEventListener(x.Events.DRAG_END,(function(e){return r.onDragEnded(e)}))),o.setVisible(!1),o.setColor(t),s.labelStyles&&s.labelStyles[e]&&Object.keys(s.labelStyles[e]).forEach((function(t){o.label.container.style[t]=s.labelStyles[e][t]}))},l=0;l<this.N;l++)a(l);this.screenOverlay=i;var c=this.options.connections||[];this.connectors=[];for(var u=function(e){var t=c[e],n=new Autodesk.Edit2D.Style({lineStyle:10,lineWidth:1.5,lineColor:t.color||B.Blue}),o=void 0,s=void 0,a=void 0,l=void 0;if(t.type===z.Line)(o=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo).line2D.style.copy(n),s=o.line2D,a=o.a.copy.bind(o.a),l=o.b.copy.bind(o.b);else{if(t.type!==z.Arrow)return console.warn("Invalid connector type."),"continue";(o=new Autodesk.Edit2D.ScreenOverlay.Arrow3DGizmo).arrow.line.style.copy(n),o.arrow.head.style.fillColor=n.lineColor,o.arrow.setHeadLength(18),o.arrow.setHeadAngle(40),s=o.arrow.line,a=o.setFrom.bind(o),l=o.setTo.bind(o)}var u=void 0;t.getEdgeLabelText&&((u=new Autodesk.Edit2D.EdgeLabel(i.layer)).attachToEdge(s,0,0),t.labelStyle&&Object.keys(t.labelStyle).forEach((function(e){u.container.style[e]=t.labelStyle[e]}))),r.connectors.push({fromIndex:t.fromIndex,toIndex:t.toIndex,getEdgeLabelText:t.getEdgeLabelText,gizmo:o,label:u,setFrom:a,setTo:l})},h=0;h<c.length;h++)u(h);this.visible=!0,this.stops=this.options.stops||[],this.onModelTransformChanged=this.onModelTransformChanged.bind(this),this.modelsToPointsMap={}}var t,n,i;return t=e,(n=[{key:"dtor",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)}},{key:"startSelectPoint",value:function(e,t){this.pointBackup=this.pointValid[e]?this.points[e].clone():null,this.viewer.toolController.activateTool(this.coordPicker.getName()),this.selectingIndex=e,this.options.draggable&&(this.coordPicker.setDragging(t),this.setMarkersDraggable(!1)),this.fireEvent({type:G.POINT_SELECTION_STARTED,index:this.selectingIndex})}},{key:"onDragEnded",value:function(e){var t=e.event;this.coordPicker.getDragging()&&(this.coordPicker.handleSingleClick(t,0),this.coordPicker.setDragging(!1))}},{key:"startSelect",value:function(){this.isActive=!0,this.continuePointSelectionIfNeeded()}},{key:"setPoint",value:function(e,t){this.pointValid[e]=!!t,this.pointValid[e]&&(this.points[e].copy(t),this.markers[e].setPosition(t)),this.updateGizmos()}},{key:"updateGizmoVisibility",value:function(e,t,n){t||n?this.screenOverlay.setGizmoVisible(e,t):this.screenOverlay.fadeOutGizmo(e)}},{key:"updateGizmos",value:function(e){for(var t=0;t<this.N;t++){var n=this.showMarkers[t]&&this.visible&&this.pointValid[t];this.markers[t].setVisible(n)}for(var i=0;i<this.connectors.length;i++){var o=this.connectors[i],r=this.visible&&this.pointValid[o.fromIndex]&&this.pointValid[o.toIndex];if(this.updateGizmoVisibility(o.gizmo,r,e),r&&(o.setFrom(this.points[o.fromIndex]),o.setTo(this.points[o.toIndex])),o.label&&(o.label.setOpacity(r?1:0,!0),r)){var s=o.getEdgeLabelText(i);o.label.setText(s)}}this.screenOverlay.update()}},{key:"clear",value:function(){this.cancelPointSelection();for(var e=0;e<this.N;e++)this.pointValid[e]=!1,this.markers[e].setVisible(!1);this.selectingIndex=-1,this.lastSelectedPoint=-1,this.updateGizmos(),this.isActive=!1,this.fireEvent({type:G.CLEAR})}},{key:"onPointHovered",value:function(e){-1!==this.selectingIndex&&(this.setPoint(this.selectingIndex,e.point),this.fireEvent({type:G.POINT_HOVERED,point:e.point,index:this.selectingIndex}))}},{key:"onPointClicked",value:function(e){var t=e.point,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1!==this.selectingIndex){t=t||this.pointBackup,this.pointBackup=null,this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName()),t&&(this.viewer.impl.camera.pivot.copy(t),this.viewer.impl.camera.dirty=!0),this.setPoint(this.selectingIndex,t),this.setMarkersDraggable(!0);var i=this.selectingIndex;this.selectingIndex=-1,t&&(this.lastSelectedPoint=Math.max(i,this.lastSelectedPoint),this.fireEvent({type:G.POINT_SELECTED,point:t,index:i})),!n||t&&this.stops.includes(this.lastSelectedPoint)||this.continuePointSelectionIfNeeded()}}},{key:"setMarkersDraggable",value:function(e){if(this.options.draggable)for(var t=0;t<this.N;t++){var n=e&&this.visible&&this.pointValid[t]&&this.showMarkers[t];this.markers[t].setDraggable(n)}}},{key:"cancelPointSelection",value:function(){this.onPointClicked({},!1)}},{key:"continuePointSelectionIfNeeded",value:function(){if(this.isPickerActive()){this.setVisible(!0);for(var e=0;e<this.N;e++)if(!this.pointValid[e]){this.startSelectPoint(e,!1);break}}}},{key:"setVisible",value:function(e,t){e!==this.visible&&(this.visible=e,this.updateGizmos(t))}},{key:"forceHide",value:function(){this.setVisible(!1,!0)}},{key:"areAllPointsSet",value:function(){if(-1!==this.selectingIndex)return!1;for(var e=0;e<this.N;e++)if(!this.pointValid[e])return!1;return!0}},{key:"isPickerActive",value:function(){return this.isActive}},{key:"attachPointsToModel",value:function(e,t){var n,i,o;this.setModelsToPointsMap(Object.assign({},this.modelsToPointsMap,(n={},i=e.id,o=t,i in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,n)))}},{key:"setModelsToPointsMap",value:function(e){var t=this;this.modelsToPointsMap=e;var n=Object.keys(this.modelsToPointsMap);n.length>0?(n.forEach((function(e){var n,i=null===(n=t.viewer.impl.findModel(Number(e),!0).getModelTransform())||void 0===n?void 0:n.clone();t.modelsToPointsMap[e].matrix=i||new Autodesk.Viewing.Private.LmvMatrix4(!0)})),this.viewer.hasEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)||this.viewer.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)):this.viewer.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)}},{key:"onModelTransformChanged",value:function(e){var t=e.model,n=e.matrix;if(this.modelsToPointsMap){var i=this.modelsToPointsMap[t.id];if(i){var o=this.modelsToPointsMap[t.id].matrix,r=o.getInverse(o);r.multiplyMatrices(n,r),this.modelsToPointsMap[t.id].matrix=n.clone();for(var s=0;s<this.N;s++)if(i.includes(s)&&this.pointValid[s]){var a=this.points[s];a.applyMatrix4(r),this.setPoint(s,a)}}}}}])&&H(t.prototype,n),i&&H(t,i),e}();function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Z(e);if(t){var o=Z(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Y(this,n)}}function Y(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}F.Events=G,F.Colors=B,F.ConnectorTypes=z;var q=Object.assign({},F.Events,{FROM_POINT_SELECTED:"fromPointSelected",TO_POINT_SELECTED:"toPointSelected",FROM_POINT_HOVERED:"fromPointHovered",TO_POINT_HOVERED:"toPointHovered"}),J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(r,e);var t,n,i,o=X(r);function r(e,t,n,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(s=o.call(this,e,t,n,2,i)).addEventListener(F.Events.POINT_SELECTED,(function(e){var t=e.point;0===e.index?s.fireEvent({type:q.FROM_POINT_SELECTED,point:t}):s.fireEvent({type:q.TO_POINT_SELECTED,point:t})})),s.addEventListener(F.Events.POINT_HOVERED,(function(e){var t=e.point;0===e.index?s.fireEvent({type:q.FROM_POINT_HOVERED,point:t}):s.fireEvent({type:q.TO_POINT_HOVERED,point:t})})),s}return t=r,(n=[{key:"setOffset",value:function(e){this.offset.copy(e)}},{key:"startSelectFrom",value:function(){this.startSelectPoint(0)}},{key:"startSelectTo",value:function(){this.startSelectPoint(1)}}])&&U(t.prototype,n),i&&U(t,i),r}(F);function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ne(e);if(t){var o=ne(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return te(this,n)}}function te(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}J.Events=q;var ie=Autodesk.Viewing,oe=AutodeskNamespace("Autodesk.Edit3D"),re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(n,e);var t=ee(n);function n(e,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,e,i)}return n}(ie.Extension);oe.Gizmo3D=a,oe.Label3D=E,oe.PointMarker=x,oe.CoordPicker=L,oe.TwoPointPicker=J,oe.NPointPicker=F,ie.theExtensionManager.registerExtension("Autodesk.Edit3D",re)}});
//# sourceMappingURL=Edit3D.min.js.map