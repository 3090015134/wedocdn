/*!
 * LMV v7.47.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.DataVisualization=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=600)}({0:function(t,e){t.exports=THREE},11:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},17:function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=a(t);if(e){var r=a(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return o(this,n)}}function o(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}var h=function(){"use strict";function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};s(this,t),this.id=e,this.position=n,this.types=i,this.name=r,this.contextData=o,this.dbId=null}return c(t,[{key:"positionFromDBId",value:function(t,e){var n=t.getData().instanceTree,i=new THREE.Box3,r=new THREE.Box3,o=t.getFragmentList();this.dbId=e,n.enumNodeFragments(e,(function(t){o.getWorldBounds(t,r),i.union(r)}),!0),this.position=i.center()||this.position}}]),t}(),l=function(){"use strict";function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;s(this,t),"number"==typeof n&&(n=[n]),this.dbIds=n,this.shadingPoints=i||[],this.isLeaf=!0,this.fragIds=[],this.id=e,this.name=r,this.bounds=new THREE.Box3}return c(t,[{key:"addPoint",value:function(t){this.shadingPoints.push(t)}},{key:"update",value:function(t){var e=this,n=t.getData().instanceTree,i=new Set(this.fragIds),r=new THREE.Box3,o=t.getFragmentList();this.dbIds.forEach((function(t){n.enumNodeFragments(t,(function(t){i.has(t)||(e.fragIds.push(t),o.getWorldBounds(t,r),e.bounds.union(r))}),!0)}))}}]),t}(),f=function(){"use strict";function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;s(this,t),this.id=e,this._children=[],this.isGroup=!0,this.name=n}return c(t,[{key:"addChild",value:function(t){this.children.push(t)}},{key:"update",value:function(t){this.children.forEach((function(e){return e.update(t)}))}},{key:"getLeafsById",value:function(t,e){e=e||[];for(var n=0;n<this.children.length;n++){var i=this.children[n];i.id===t?i.isLeaf?e.push(i):i.isGroup&&i.getChildLeafs(e):i.isGroup&&i.getLeafsById(t,e)}return e}},{key:"getNodeById",value:function(t){for(var e=0;e<this.children.length;e++){var n=this.children[e];if(n.id===t)return n;if(n.isGroup){var i=n.getNodeById(t);if(i)return i}}}},{key:"getChildLeafs",value:function(t){for(var e=0;e<this.children.length;e++){var n=this.children[e];n.isLeaf?t.push(n):n.isGroup&&n.getChildLeafs(t)}}},{key:"children",get:function(){return this._children}}]),t}(),d=function(t){"use strict";!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(n,t);var e=r(n);function n(){return s(this,n),e.apply(this,arguments)}return c(n,[{key:"initialize",value:function(t){this.update(t)}}]),n}(f);t.exports={SurfaceShadingData:d,SurfaceShadingGroup:f,SurfaceShadingNode:l,SurfaceShadingPoint:h,filterShadingPointsByType:function(t,e){return(t=t||[]).filter((function(t){return t.types&&t.types.includes(e)}))}}},31:function(t,e){t.exports={MOUSE_HOVERING:"DATAVIZ_OBJECT_HOVERING",MOUSE_CLICK:"DATAVIZ_OBJECT_CLICK",MOUSE_CLICK_OUT:"DATAVIZ_CLICK_OUT"}},346:function(t,e,n){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var r=n(0),o=function(){"use strict";function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.meshCallback=e,this.dbIds=[],this.reset()}var e,n,o;return e=t,(n=[{key:"addPoint",value:function(t,e){this.vcount+1>65535&&(this.flushBuffer(),this.reset());var n=this.vcount;if(this.ib[n]=n,this.vb[3*n]=t.position.x,this.vb[3*n+1]=t.position.y,this.vb[3*n+2]=t.position.z,this.idb[3*n]=255&t.dbId,this.idb[3*n+1]=t.dbId>>8&255,this.idb[3*n+2]=t.dbId>>16&255,this.colorb[3*n]=255*t.color.r,this.colorb[3*n+1]=255*t.color.g,this.colorb[3*n+2]=255*t.color.b,e){var i=e.spriteUV(t.style.url);i&&(this.uv[4*n]=i.x,this.uv[4*n+1]=i.y,this.uv[4*n+2]=i.w,this.uv[4*n+3]=i.h)}this.scale[n]=1,this.dbIds.push(t.dbId),this.vcount++}},{key:"reset",value:function(){this.vcount=0,this.ib=new Uint16Array(65535),this.idb=new Uint8Array(196605),this.vb=new Float32Array(196605),this.colorb=new Uint8Array(196605),this.scale=new Float32Array(65535),this.uv=new Float32Array(262140)}},{key:"flushBuffer",value:function(){var t=new r.BufferGeometry,e=new r.BufferAttribute(new Uint8Array(this.idb.slice(0,3*this.vcount)),3);e.bytesPerItem=1,e.normalize=!0;var n=new r.BufferAttribute(new Float32Array(this.vb.slice(0,3*this.vcount)),3);n.bytesPerItem=4;var i=new r.BufferAttribute(new Uint8Array(this.colorb.slice(0,3*this.vcount)),3);i.bytesPerItem=1,i.normalize=!0;var o=new r.BufferAttribute(new Uint16Array(this.ib.slice(0,this.vcount)),1),a=new r.BufferAttribute(new Float32Array(this.uv.slice(0,4*this.vcount)),4),s=new r.BufferAttribute(new Float32Array(this.scale.slice(0,this.vcount)),1);t.addAttribute("id",e),t.addAttribute("index",o),t.addAttribute("position",n),t.addAttribute("color",i),t.addAttribute("uvp",a),t.addAttribute("pointScale",s),t.isPoints=!0,t.dbIds=this.dbIds.slice(0),this.dbIds.length=0,this.meshCallback&&this.meshCallback(t),this.vcount=0}}])&&i(e.prototype,n),o&&i(e,o),t}();t.exports={SpriteMeshBuilder:o}},347:function(t,e,n){"use strict";function i(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=u(t);if(e){var r=u(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return s(this,n)}}function s(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=h(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function h(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function v(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),t}Object.defineProperty(e,"__esModule",{value:!0});var y,g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;d(this,t),this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=e,this._height=n,this._x=i,this._y=r,this._data={},this._rot=o,this._allowRotation=a}return v(t,[{key:"area",value:function(){return this.width*this.height}},{key:"collide",value:function(t){return t.x<this.x+this.width&&t.x+t.width>this.x&&t.y<this.y+this.height&&t.y+t.height>this.y}},{key:"contain",value:function(t){return t.x>=this.x&&t.y>=this.y&&t.x+t.width<=this.x+this.width&&t.y+t.height<=this.y+this.height}},{key:"setDirty",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._dirty=t?this._dirty+1:0}},{key:"width",get:function(){return this._width},set:function(t){t!==this._width&&(this._width=t,this._dirty++)}},{key:"height",get:function(){return this._height},set:function(t){t!==this._height&&(this._height=t,this._dirty++)}},{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._x=t,this._dirty++)}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._y=t,this._dirty++)}},{key:"rot",get:function(){return this._rot},set:function(t){if(!1!==this._allowRotation&&this._rot!==t){var e=this.width;this.width=this.height,this.height=e,this._rot=t,this._dirty++}}},{key:"allowRotation",get:function(){return this._allowRotation},set:function(t){this._allowRotation!==t&&(this._allowRotation=t,this._dirty++)}},{key:"data",get:function(){return this._data},set:function(t){null!==t&&t!==this._data&&(this._data=t,"object"==f(t)&&t.hasOwnProperty("allowRotation")&&(this._allowRotation=t.allowRotation),this._dirty++)}},{key:"dirty",get:function(){return this._dirty>0}}],[{key:"Collide",value:function(t,e){return t.collide(e)}},{key:"Contain",value:function(t,e){return t.contain(e)}}]),t}(),m=function(){function t(){d(this,t),this._dirty=0}return v(t,[{key:"setDirty",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._dirty=t?this._dirty+1:0,!t){var e,n=c(this.rects);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.setDirty&&i.setDirty(!1)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"dirty",get:function(){return this._dirty>0||this.rects.some((function(t){return t.dirty}))}}]),t}(),w=function(t){r(i,t);var n=a(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0,logic:e.PACKING_LOGIC.MAX_EDGE};return d(this,i),(t=n.call(this)).maxWidth=r,t.maxHeight=o,t.padding=a,t.options=s,t.freeRects=[],t.rects=[],t.verticalExpand=!1,t.width=t.options.smart?0:r,t.height=t.options.smart?0:o,t.border=t.options.border?t.options.border:0,t.freeRects.push(new g(t.maxWidth+t.padding-2*t.border,t.maxHeight+t.padding-2*t.border,t.border,t.border)),t.stage=new g(t.width,t.height),t}return v(i,[{key:"add",value:function(){var t,e;if(1===arguments.length){if("object"!=f(arguments.length<=0?void 0:arguments[0]))throw new Error("MacrectsBin.add(): Wrong parameters");var n=(e=arguments.length<=0?void 0:arguments[0]).data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;if(this.options.tag&&this.tag!==n)return}else{if(t=arguments.length>2?arguments.length<=2?void 0:arguments[2]:null,this.options.tag){if(t&&this.tag!==t.tag)return;if(!t&&this.tag)return}(e=new g(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])).data=t,e.setDirty(!1)}var i=this.place(e);return i&&this.rects.push(i),i}},{key:"repack",value:function(){var t=[];this.reset(),this.rects.sort((function(t,e){var n=Math.max(e.width,e.height)-Math.max(t.width,t.height);return 0===n&&t.hash&&e.hash?t.hash>e.hash?-1:1:n}));var e,n=c(this.rects);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.place(i)||t.push(i)}}catch(t){n.e(t)}finally{n.f()}for(var r=0,o=t;r<o.length;r++){var a=o[r];this.rects.splice(this.rects.indexOf(a),1)}return t.length>0?t:void 0}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],e&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new g(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new g(this.width,this.height),this._dirty=0}},{key:"place",value:function(t){var e=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;if(!this.options.tag||this.tag===e){var n,i;if(i=t.hasOwnProperty("_allowRotation")&&void 0!==t.allowRotation?t.allowRotation:this.options.allowRotation,n=this.findNode(t.width+this.padding,t.height+this.padding,i)){this.updateBinSize(n);for(var r=this.freeRects.length,o=0;o<r;)this.splitNode(this.freeRects[o],n)&&(this.freeRects.splice(o,1),r--,o--),o++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,t.x=n.x,t.y=n.y,void 0===t.rot&&(t.rot=!1),t.rot=n.rot?!t.rot:t.rot,this._dirty++,t}if(this.verticalExpand){if(this.updateBinSize(new g(t.width+this.padding,t.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new g(t.width+this.padding,t.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(t)}else if(this.updateBinSize(new g(t.width+this.padding,t.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new g(t.width+this.padding,t.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(t)}}},{key:"findNode",value:function(t,n,i){var r,o,a,s=Number.MAX_VALUE;for(var u in this.freeRects)(o=this.freeRects[u]).width>=t&&o.height>=n&&(r=this.options.logic===e.PACKING_LOGIC.MAX_AREA?o.width*o.height-t*n:Math.min(o.width-t,o.height-n))<s&&(a=new g(t,n,o.x,o.y),s=r),i&&o.width>=n&&o.height>=t&&(r=this.options.logic===e.PACKING_LOGIC.MAX_AREA?o.width*o.height-n*t:Math.min(o.height-t,o.width-n))<s&&(a=new g(n,t,o.x,o.y,!0),s=r);return a}},{key:"splitNode",value:function(t,e){if(!t.collide(e))return!1;if(e.x<t.x+t.width&&e.x+e.width>t.x){if(e.y>t.y&&e.y<t.y+t.height){var n=new g(t.width,e.y-t.y,t.x,t.y);this.freeRects.push(n)}if(e.y+e.height<t.y+t.height){var i=new g(t.width,t.y+t.height-(e.y+e.height),t.x,e.y+e.height);this.freeRects.push(i)}}if(e.y<t.y+t.height&&e.y+e.height>t.y){if(e.x>t.x&&e.x<t.x+t.width){var r=new g(e.x-t.x,t.height,t.x,t.y);this.freeRects.push(r)}if(e.x+e.width<t.x+t.width){var o=new g(t.x+t.width-(e.x+e.width),t.height,e.x+e.width,t.y);this.freeRects.push(o)}}return!0}},{key:"pruneFreeList",value:function(){for(var t=0,e=0,n=this.freeRects.length;t<n;){e=t+1;for(var i=this.freeRects[t];e<n;){var r=this.freeRects[e];if(r.contain(i)){this.freeRects.splice(t,1),t--,n--;break}i.contain(r)&&(this.freeRects.splice(e,1),e--,n--),e++}t++}}},{key:"updateBinSize",value:function(t){if(!this.options.smart)return!1;if(this.stage.contain(t))return!1;var e=Math.max(this.width,t.x+t.width-this.padding+this.border),n=Math.max(this.height,t.y+t.height-this.padding+this.border);if(this.options.allowRotation){var i=Math.max(this.width,t.x+t.height-this.padding+this.border),r=Math.max(this.height,t.y+t.width-this.padding+this.border);i*r<e*n&&(e=i,n=r)}return this.options.pot&&(e=Math.pow(2,Math.ceil(Math.log(e)*Math.LOG2E)),n=Math.pow(2,Math.ceil(Math.log(n)*Math.LOG2E))),this.options.square&&(e=n=Math.max(e,n)),!(e>this.maxWidth+this.padding||n>this.maxHeight+this.padding||(this.expandFreeRects(e+this.padding,n+this.padding),this.width=this.stage.width=e,this.height=this.stage.height=n,0))}},{key:"expandFreeRects",value:function(t,e){var n=this;this.freeRects.forEach((function(i,r){i.x+i.width>=Math.min(n.width+n.padding-n.border,t)&&(i.width=t-i.x-n.border),i.y+i.height>=Math.min(n.height+n.padding-n.border,e)&&(i.height=e-i.y-n.border)}),this),this.freeRects.push(new g(t-this.width-this.padding,e-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new g(t-2*this.border,e-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter((function(t){return!(t.width<=0||t.height<=0||t.x<n.border||t.y<n.border)})),this.pruneFreeList()}}]),i}(m),b=function(t){r(n,t);var e=a(n);function n(){var t;if(d(this,n),(t=e.call(this)).rects=[],1===arguments.length){if("object"!=f(arguments.length<=0?void 0:arguments[0]))throw new Error("OversizedElementBin: Wrong parameters");var i=arguments.length<=0?void 0:arguments[0];t.rects=[i],t.width=i.width,t.height=i.height,t.data=i.data,i.oversized=!0}else{t.width=arguments.length<=0?void 0:arguments[0],t.height=arguments.length<=1?void 0:arguments[1],t.data=arguments.length>2?arguments.length<=2?void 0:arguments[2]:null;var r=new g(t.width,t.height);r.oversized=!0,r.data=t.data,t.rects.push(r)}return t.freeRects=[],t.maxWidth=t.width,t.maxHeight=t.height,t.options={smart:!1,pot:!1,square:!1},s(t)}return v(n,[{key:"add",value:function(){}},{key:"reset",value:function(){}},{key:"repack",value:function(){}}]),n}(m),x=4096;(y=e.PACKING_LOGIC||(e.PACKING_LOGIC={}))[y.MAX_AREA=0]="MAX_AREA",y[y.MAX_EDGE=1]="MAX_EDGE";var _=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,border:0,logic:e.PACKING_LOGIC.MAX_EDGE};d(this,t),this.width=n,this.height=i,this.padding=r,this.options=o,this._currentBinIndex=0,this.bins=[]}return v(t,[{key:"add",value:function(){if(1===arguments.length){if("object"!=f(arguments.length<=0?void 0:arguments[0]))throw new Error("MacrectsPacker.add(): Wrong parameters");var t=arguments.length<=0?void 0:arguments[0];if(t.width>this.width||t.height>this.height)this.bins.push(new b(t));else{var e=this.bins.slice(this._currentBinIndex).find((function(e){return void 0!==e.add(t)}));if(!e){var n=new w(this.width,this.height,this.padding,this.options),i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&i&&(n.tag=i),n.add(t),this.bins.push(n)}}return t}var r=new g(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]);if(arguments.length>2&&(r.data=arguments.length<=2?void 0:arguments[2]),r.width>this.width||r.height>this.height)this.bins.push(new b(r));else{var o=this.bins.slice(this._currentBinIndex).find((function(t){return void 0!==t.add(r)}));if(!o){var a=new w(this.width,this.height,this.padding,this.options);this.options.tag&&r.data.tag&&(a.tag=r.data.tag),a.add(r),this.bins.push(a)}}return r}},{key:"addArray",value:function(t){var e=this;this.sort(t,this.options.logic).forEach((function(t){return e.add(t)}))}},{key:"reset",value:function(){this.bins=[],this._currentBinIndex=0}},{key:"repack",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t){var e,n=[],r=c(this.bins);try{for(r.s();!(e=r.n()).done;){var o=e.value;if(o.dirty){var a=o.repack();a&&n.push.apply(n,i(a))}}}catch(t){r.e(t)}finally{r.f()}this.addArray(n)}else if(this.dirty){var s=this.rects;this.reset(),this.addArray(s)}}},{key:"next",value:function(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}},{key:"load",value:function(t){var e=this;t.forEach((function(t,n){if(t.maxWidth>e.width||t.maxHeight>e.height)e.bins.push(new b(t.width,t.height,{}));else{var i=new w(e.width,e.height,e.padding,t.options);i.freeRects.splice(0),t.freeRects.forEach((function(t,e){i.freeRects.push(new g(t.width,t.height,t.x,t.y))})),i.width=t.width,i.height=t.height,t.tag&&(i.tag=t.tag),e.bins[n]=i}}),this)}},{key:"save",value:function(){var t=[];return this.bins.forEach((function(e){var n={width:e.width,height:e.height,maxWidth:e.maxWidth,maxHeight:e.maxHeight,freeRects:[],rects:[],options:e.options};e.tag&&(n=Object.assign(Object.assign({},n),{tag:e.tag})),e.freeRects.forEach((function(t){n.freeRects.push({x:t.x,y:t.y,width:t.width,height:t.height})})),t.push(n)})),t}},{key:"sort",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.PACKING_LOGIC.MAX_EDGE;return t.slice().sort((function(t,i){var r=n===e.PACKING_LOGIC.MAX_EDGE?Math.max(i.width,i.height)-Math.max(t.width,t.height):i.width*i.height-t.width*t.height;return 0===r&&t.hash&&i.hash?t.hash>i.hash?-1:1:r}))}},{key:"currentBinIndex",get:function(){return this._currentBinIndex}},{key:"dirty",get:function(){return this.bins.some((function(t){return t.dirty}))}},{key:"rects",get:function(){var t,e=[],n=c(this.bins);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.push.apply(e,i(r.rects))}}catch(t){n.e(t)}finally{n.f()}return e}}]),t}();e.Bin=m,e.MaxRectsBin=w,e.MaxRectsPacker=_,e.OversizedElementBin=b,e.Rectangle=g},348:function(t,e,n){var i,r,o;o=function(){var t,e={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},n=function(){var t=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},n=e.defaultRadius;return t.prototype={_organiseData:function(t,e){var i=t[this._xField],r=t[this._yField],o=this._radi,a=this._data,s=this._max,u=this._min,c=t[this._valueField]||1,h=t.radius||this._cfgRadius||n;a[i]||(a[i]=[],o[i]=[]),a[i][r]?a[i][r]+=c:(a[i][r]=c,o[i][r]=h);var l=a[i][r];return l>s?(e?this.setDataMax(l):this._max=l,!1):l<u?(e?this.setDataMin(l):this._min=l,!1):{x:i,y:r,value:c,radius:h,min:u,max:s}},_unOrganizeData:function(){var t=[],e=this._data,n=this._radi;for(var i in e)for(var r in e[i])t.push({x:i,y:r,radius:n[i][r],value:e[i][r]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var n=this._organiseData(arguments[0],!0);n&&(0===this._data.length&&(this._min=this._max=n.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[n]}))}return this},setData:function(t){var e=t.data,n=e.length;this._data=[],this._radi=[];for(var i=0;i<n;i++)this._organiseData(e[i],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},t}(),i=function(){var t=function(t){var e=t.gradient||t.defaultGradient,n=document.createElement("canvas"),i=n.getContext("2d");n.width=256,n.height=1;var r=i.createLinearGradient(0,0,256,1);for(var o in e)r.addColorStop(o,e[o]);return i.fillStyle=r,i.fillRect(0,0,256,1),i.getImageData(0,0,256,1).data},e=function(t,e){var n=document.createElement("canvas"),i=n.getContext("2d"),r=t,o=t;if(n.width=n.height=2*t,1==e)i.beginPath(),i.arc(r,o,t,0,2*Math.PI,!1),i.fillStyle="rgba(0,0,0,1)",i.fill();else{var a=i.createRadialGradient(r,o,t*e,r,o,t);a.addColorStop(0,"rgba(0,0,0,1)"),a.addColorStop(1,"rgba(0,0,0,0)"),i.fillStyle=a,i.fillRect(0,0,2*t,2*t)}return n};function n(e){e.container;var n=this.shadowCanvas=document.createElement("canvas"),i=this.canvas=e.canvas||document.createElement("canvas"),r=(this._renderBoundaries=[1e4,1e4,0,0],{});i.className="heatmap-canvas",this._width=i.width=n.width=e.width||+r.width.replace(/px/,""),this._height=i.height=n.height=e.height||+r.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=i.getContext("2d"),i.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",this._palette=t(e),this._templates={},this._setStyles(e)}return n.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(function(t){for(var e=[],n=t.min,i=t.max,r=t.radi,o=(t=t.data,Object.keys(t)),a=o.length;a--;)for(var s=o[a],u=Object.keys(t[s]),c=u.length;c--;){var h=u[c],l=t[s][h],f=r[s][h];e.push({x:s,y:h,value:l,radius:f})}return{min:n,max:i,data:e}}(t)),this._colorize())},_updateGradient:function(e){this._palette=t(e)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){for(var n=this._min=t.min,i=this._max=t.max,r=(t=t.data||[]).length,o=1-this._blur;r--;){var a,s=t[r],u=s.x,c=s.y,h=s.radius,l=Math.min(s.value,i),f=u-h,d=c-h,p=this.shadowCtx;this._templates[h]?a=this._templates[h]:this._templates[h]=a=e(h,o);var v=(l-n)/(i-n);p.globalAlpha=v<.01?.01:v,p.drawImage(a,f,d),f<this._renderBoundaries[0]&&(this._renderBoundaries[0]=f),d<this._renderBoundaries[1]&&(this._renderBoundaries[1]=d),f+2*h>this._renderBoundaries[2]&&(this._renderBoundaries[2]=f+2*h),d+2*h>this._renderBoundaries[3]&&(this._renderBoundaries[3]=d+2*h)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],n=this._renderBoundaries[2]-t,i=this._renderBoundaries[3]-e,r=this._width,o=this._height,a=this._opacity,s=this._maxOpacity,u=this._minOpacity,c=this._useGradientOpacity;t<0&&(t=0),e<0&&(e=0),t+n>r&&(n=r-t),e+i>o&&(i=o-e);for(var h=this.shadowCtx.getImageData(t,e,n,i),l=h.data,f=l.length,d=this._palette,p=3;p<f;p+=4){var v,y=l[p],g=4*y;g&&(v=a>0?a:y<s?y<u?u:y:s,l[p-3]=d[g],l[p-2]=d[g+1],l[p-1]=d[g+2],l[p]=c?d[g+3]:v)}h.data=l,this.ctx.putImageData(h,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],n=this._max,i=this._min;return Math.abs(n-i)*(e/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},n}(),r=(t=!1,"canvas2d"===e.defaultRenderer&&(t=i),t),o=function(){for(var t={},e=arguments.length,n=0;n<e;n++){var i=arguments[n];for(var r in i)t[r]=i[r]}return t},a=function(){var t=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,n){var i=this.cStore;i[t]||(i[t]=[]),i[t].push((function(t){return e.call(n,t)}))},emit:function(t,e){var n=this.cStore;if(n[t])for(var i=n[t].length,r=0;r<i;r++)(0,n[t][r])(e)}},t}(),i=function(t){var e=t._renderer,n=t._coordinator,i=t._store;n.on("renderpartial",e.renderPartial,e),n.on("renderall",e.renderAll,e),n.on("extremachange",(function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config.gradient||t._config.defaultGradient})})),i.setCoordinator(n)};function a(){var a=this._config=o(e,arguments[0]||{});if(this._coordinator=new t,a.plugin){var s=a.plugin;if(!e.plugins[s])throw new Error("Plugin '"+s+"' not found. Maybe it was not registered.");var u=e.plugins[s];this._renderer=new u.renderer(a),this._store=new u.store(a)}else this._renderer=new r(a),this._store=new n(a);i(this)}return a.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=o(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},a}();return{create:function(t){return new a(t)},register:function(t,n){e.plugins[t]=n}}},t.exports?t.exports=o():void 0===(r="function"==typeof(i=o)?i.call(e,n,e,t):i)||(t.exports=r)},44:function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var u,c=[],h=!1,l=-1;function f(){h&&u&&(h=!1,u.length?c=u.concat(c):l=-1,c.length&&d())}function d(){if(!h){var t=s(f);h=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,h=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||h||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=v,r.addListener=v,r.once=v,r.off=v,r.removeListener=v,r.removeAllListeners=v,r.emit=v,r.prependListener=v,r.prependOnceListener=v,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},57:function(t,e,n){(function(e,n){
/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(e){"use strict";"function"==typeof bootstrap?bootstrap("promise",e):t.exports=e()}((function(){"use strict";var t=!1;try{throw new Error}catch(e){t=!!e.stack}var i,r=_(),o=function(){},a=function(){var t={task:void 0,next:null},i=t,r=!1,o=void 0,s=!1,u=[];function c(){for(var e,n;t.next;)e=(t=t.next).task,t.task=void 0,(n=t.domain)&&(t.domain=void 0,n.enter()),h(e,n);for(;u.length;)h(e=u.pop());r=!1}function h(t,e){try{t()}catch(t){if(s)throw e&&e.exit(),setTimeout(c,0),e&&e.enter(),t;setTimeout((function(){throw t}),0)}e&&e.exit()}if(a=function(t){i=i.next={task:t,domain:s&&e.domain,next:null},r||(r=!0,o())},"object"==typeof e&&"[object process]"===e.toString()&&e.nextTick)s=!0,o=function(){e.nextTick(c)};else if("function"==typeof n)o="undefined"!=typeof window?n.bind(window,c):function(){n(c)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=function(){o=f,l.port1.onmessage=c,c()};var f=function(){l.port2.postMessage(0)};o=function(){setTimeout(c,0),f()}}else o=function(){setTimeout(c,0)};return a.runAfter=function(t){u.push(t),r||(r=!0,o())},a}(),s=Function.call;function u(t){return function(){return s.apply(t,arguments)}}var c,h=u(Array.prototype.slice),l=u(Array.prototype.reduce||function(t,e){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(e=t(e,this[n],n));return e}),f=u(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),d=u(Array.prototype.map||function(t,e){var n=this,i=[];return l(n,(function(r,o,a){i.push(t.call(e,o,a,n))}),void 0),i}),p=Object.create||function(t){function e(){}return e.prototype=t,new e},v=u(Object.prototype.hasOwnProperty),y=Object.keys||function(t){var e=[];for(var n in t)v(t,n)&&e.push(n);return e},g=u(Object.prototype.toString);function m(t){return"[object StopIteration]"===g(t)||t instanceof c}c="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};function w(e,n){if(t&&n.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf("From previous event:")){for(var i=[],r=n;r;r=r.source)r.stack&&i.unshift(r.stack);i.unshift(e.stack);var o=i.join("\nFrom previous event:\n");e.stack=function(t){for(var e=t.split("\n"),n=[],i=0;i<e.length;++i){var r=e[i];!x(r)&&(-1===(o=r).indexOf("(module.js:")&&-1===o.indexOf("(node.js:"))&&r&&n.push(r)}var o;return n.join("\n")}(o)}}function b(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(t);return i?[i[1],Number(i[2])]:void 0}function x(t){var e=b(t);if(!e)return!1;var n=e[0],o=e[1];return n===i&&o>=r&&o<=K}function _(){if(t)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=b(e[0].indexOf("@")>0?e[1]:e[2]);if(!n)return;return i=n[0],n[1]}}function E(t){return t instanceof k?t:C(t)?function(t){var e=T();return E.nextTick((function(){try{t.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}})),e.promise}(t):L(t)}function T(){var e,n=[],i=[],r=p(T.prototype),o=p(k.prototype);if(o.promiseDispatch=function(t,r,o){var a=h(arguments);n?(n.push(a),"when"===r&&o[1]&&i.push(o[1])):E.nextTick((function(){e.promiseDispatch.apply(e,a)}))},o.valueOf=function(){if(n)return o;var t=P(e);return M(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},E.longStackSupport&&t)try{throw new Error}catch(t){o.stack=t.stack.substring(t.stack.indexOf("\n")+1)}function a(t){e=t,o.source=t,l(n,(function(e,n){E.nextTick((function(){t.promiseDispatch.apply(t,n)}))}),void 0),n=void 0,i=void 0}return r.promise=o,r.resolve=function(t){e||a(E(t))},r.fulfill=function(t){e||a(L(t))},r.reject=function(t){e||a(F(t))},r.notify=function(t){e||l(i,(function(e,n){E.nextTick((function(){n(t)}))}),void 0)},r}function S(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=T();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function R(t){return S((function(e,n){for(var i=0,r=t.length;i<r;i++)E(t[i]).then(e,n)}))}function k(t,e,n){void 0===e&&(e=function(t){return F(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=p(k.prototype);if(i.promiseDispatch=function(n,r,o){var a;try{a=t[r]?t[r].apply(i,o):e.call(i,r,o)}catch(t){a=F(t)}n&&n(a)},i.inspect=n,n){var r=n();"rejected"===r.state&&(i.exception=r.reason),i.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?i:t.value}}return i}function O(t,e,n,i){return E(t).then(e,n,i)}function P(t){if(M(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function M(t){return t instanceof k}function C(t){return(e=t)===Object(e)&&"function"==typeof t.then;var e}E.resolve=E,E.nextTick=a,E.longStackSupport=!1,"object"==typeof e&&e&&e.env&&e.env.Q_DEBUG&&(E.longStackSupport=!0),E.defer=T,T.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(h(arguments,1)):t.resolve(n)}},E.Promise=S,E.promise=S,S.race=R,S.all=z,S.reject=F,S.resolve=E,E.passByCopy=function(t){return t},k.prototype.passByCopy=function(){return this},E.join=function(t,e){return E(t).join(e)},k.prototype.join=function(t){return E([this,t]).spread((function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)}))},E.race=R,k.prototype.race=function(){return this.then(E.race)},E.makePromise=k,k.prototype.toString=function(){return"[object Promise]"},k.prototype.then=function(t,e,n){var i=this,r=T(),o=!1;return E.nextTick((function(){i.promiseDispatch((function(e){o||(o=!0,r.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(t){return F(t)}}(e)))}),"when",[function(t){o||(o=!0,r.resolve(function(t){if("function"==typeof e){w(t,i);try{return e(t)}catch(t){return F(t)}}return F(t)}(t)))}])})),i.promiseDispatch(void 0,"when",[void 0,function(t){var e,i=!1;try{e=function(t){return"function"==typeof n?n(t):t}(t)}catch(t){if(i=!0,!E.onerror)throw t;E.onerror(t)}i||r.notify(e)}]),r.promise},E.tap=function(t,e){return E(t).tap(e)},k.prototype.tap=function(t){return t=E(t),this.then((function(e){return t.fcall(e).thenResolve(e)}))},E.when=O,k.prototype.thenResolve=function(t){return this.then((function(){return t}))},E.thenResolve=function(t,e){return E(t).thenResolve(e)},k.prototype.thenReject=function(t){return this.then((function(){throw t}))},E.thenReject=function(t,e){return E(t).thenReject(e)},E.nearer=P,E.isPromise=M,E.isPromiseAlike=C,E.isPending=function(t){return M(t)&&"pending"===t.inspect().state},k.prototype.isPending=function(){return"pending"===this.inspect().state},E.isFulfilled=function(t){return!M(t)||"fulfilled"===t.inspect().state},k.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},E.isRejected=function(t){return M(t)&&"rejected"===t.inspect().state},k.prototype.isRejected=function(){return"rejected"===this.inspect().state};var I,D,A,j=[],V=[],H=[],B=!0;function U(){j.length=0,V.length=0,B||(B=!0)}function F(t){var n=k({when:function(n){return n&&function(t){if(B){var n=f(V,t);-1!==n&&("object"==typeof e&&"function"==typeof e.emit&&E.nextTick.runAfter((function(){var i=f(H,t);-1!==i&&(e.emit("rejectionHandled",j[n],t),H.splice(i,1))})),V.splice(n,1),j.splice(n,1))}}(this),n?n(t):this}},(function(){return this}),(function(){return{state:"rejected",reason:t}}));return function(t,n){B&&("object"==typeof e&&"function"==typeof e.emit&&E.nextTick.runAfter((function(){-1!==f(V,t)&&(e.emit("unhandledRejection",n,t),H.push(t))})),V.push(t),n&&void 0!==n.stack?j.push(n.stack):j.push("(no stack) "+n))}(n,t),n}function L(t){return k({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},delete:function(e){delete t[e]},post:function(e,n){return null==e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return y(t)}},void 0,(function(){return{state:"fulfilled",value:t}}))}function N(t,e,n){return E(t).spread(e,n)}function G(t,e,n){return E(t).dispatch(e,n)}function z(t){return O(t,(function(t){var e=0,n=T();return l(t,(function(i,r,o){var a;M(r)&&"fulfilled"===(a=r.inspect()).state?t[o]=a.value:(++e,O(r,(function(i){t[o]=i,0==--e&&n.resolve(t)}),n.reject,(function(t){n.notify({index:o,value:t})})))}),void 0),0===e&&n.resolve(t),n.promise}))}function W(t){if(0===t.length)return E.resolve();var e=E.defer(),n=0;return l(t,(function(i,r,o){var a=t[o];n++,O(a,(function(t){e.resolve(t)}),(function(){0===--n&&e.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}),(function(t){e.notify({index:o,value:t})}))}),void 0),e.promise}function X(t){return O(t,(function(t){return t=d(t,E),O(z(d(t,(function(t){return O(t,o,o)}))),(function(){return t}))}))}E.resetUnhandledRejections=U,E.getUnhandledReasons=function(){return j.slice()},E.stopUnhandledRejectionTracking=function(){U(),B=!1},U(),E.reject=F,E.fulfill=L,E.master=function(t){return k({isDef:function(){}},(function(e,n){return G(t,e,n)}),(function(){return E(t).inspect()}))},E.spread=N,k.prototype.spread=function(t,e){return this.all().then((function(e){return t.apply(void 0,e)}),e)},E.async=function(t){return function(){function e(t,e){var o;if("undefined"==typeof StopIteration){try{o=n[t](e)}catch(t){return F(t)}return o.done?E(o.value):O(o.value,i,r)}try{o=n[t](e)}catch(t){return m(t)?E(t.value):F(t)}return O(o,i,r)}var n=t.apply(this,arguments),i=e.bind(e,"next"),r=e.bind(e,"throw");return i()}},E.spawn=function(t){E.done(E.async(t)())},E.return=function(t){throw new c(t)},E.promised=function(t){return function(){return N([this,z(arguments)],(function(e,n){return t.apply(e,n)}))}},E.dispatch=G,k.prototype.dispatch=function(t,e){var n=this,i=T();return E.nextTick((function(){n.promiseDispatch(i.resolve,t,e)})),i.promise},E.get=function(t,e){return E(t).dispatch("get",[e])},k.prototype.get=function(t){return this.dispatch("get",[t])},E.set=function(t,e,n){return E(t).dispatch("set",[e,n])},k.prototype.set=function(t,e){return this.dispatch("set",[t,e])},E.del=E.delete=function(t,e){return E(t).dispatch("delete",[e])},k.prototype.del=k.prototype.delete=function(t){return this.dispatch("delete",[t])},E.mapply=E.post=function(t,e,n){return E(t).dispatch("post",[e,n])},k.prototype.mapply=k.prototype.post=function(t,e){return this.dispatch("post",[t,e])},E.send=E.mcall=E.invoke=function(t,e){return E(t).dispatch("post",[e,h(arguments,2)])},k.prototype.send=k.prototype.mcall=k.prototype.invoke=function(t){return this.dispatch("post",[t,h(arguments,1)])},E.fapply=function(t,e){return E(t).dispatch("apply",[void 0,e])},k.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},E.try=E.fcall=function(t){return E(t).dispatch("apply",[void 0,h(arguments,1)])},k.prototype.fcall=function(){return this.dispatch("apply",[void 0,h(arguments)])},E.fbind=function(t){var e=E(t),n=h(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(h(arguments))])}},k.prototype.fbind=function(){var t=this,e=h(arguments);return function(){return t.dispatch("apply",[this,e.concat(h(arguments))])}},E.keys=function(t){return E(t).dispatch("keys",[])},k.prototype.keys=function(){return this.dispatch("keys",[])},E.all=z,k.prototype.all=function(){return z(this)},E.any=W,k.prototype.any=function(){return W(this)},E.allResolved=(I=X,D="allResolved",A="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(D+" is deprecated, use "+A+" instead.",new Error("").stack),I.apply(I,arguments)}),k.prototype.allResolved=function(){return X(this)},E.allSettled=function(t){return E(t).allSettled()},k.prototype.allSettled=function(){return this.then((function(t){return z(d(t,(function(t){function e(){return t.inspect()}return(t=E(t)).then(e,e)})))}))},E.fail=E.catch=function(t,e){return E(t).then(void 0,e)},k.prototype.fail=k.prototype.catch=function(t){return this.then(void 0,t)},E.progress=function(t,e){return E(t).then(void 0,void 0,e)},k.prototype.progress=function(t){return this.then(void 0,void 0,t)},E.fin=E.finally=function(t,e){return E(t).finally(e)},k.prototype.fin=k.prototype.finally=function(t){return t=E(t),this.then((function(e){return t.fcall().then((function(){return e}))}),(function(e){return t.fcall().then((function(){throw e}))}))},E.done=function(t,e,n,i){return E(t).done(e,n,i)},k.prototype.done=function(t,n,i){var r=function(t){E.nextTick((function(){if(w(t,o),!E.onerror)throw t;E.onerror(t)}))},o=t||n||i?this.then(t,n,i):this;"object"==typeof e&&e&&e.domain&&(r=e.domain.bind(r)),o.then(void 0,r)},E.timeout=function(t,e,n){return E(t).timeout(e,n)},k.prototype.timeout=function(t,e){var n=T(),i=setTimeout((function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),n.reject(e)}),t);return this.then((function(t){clearTimeout(i),n.resolve(t)}),(function(t){clearTimeout(i),n.reject(t)}),n.notify),n.promise},E.delay=function(t,e){return void 0===e&&(e=t,t=void 0),E(t).delay(e)},k.prototype.delay=function(t){return this.then((function(e){var n=T();return setTimeout((function(){n.resolve(e)}),t),n.promise}))},E.nfapply=function(t,e){return E(t).nfapply(e)},k.prototype.nfapply=function(t){var e=T(),n=h(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},E.nfcall=function(t){var e=h(arguments,1);return E(t).nfapply(e)},k.prototype.nfcall=function(){var t=h(arguments),e=T();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},E.nfbind=E.denodeify=function(t){var e=h(arguments,1);return function(){var n=e.concat(h(arguments)),i=T();return n.push(i.makeNodeResolver()),E(t).fapply(n).fail(i.reject),i.promise}},k.prototype.nfbind=k.prototype.denodeify=function(){var t=h(arguments);return t.unshift(this),E.denodeify.apply(void 0,t)},E.nbind=function(t,e){var n=h(arguments,2);return function(){var i=n.concat(h(arguments)),r=T();function o(){return t.apply(e,arguments)}return i.push(r.makeNodeResolver()),E(o).fapply(i).fail(r.reject),r.promise}},k.prototype.nbind=function(){var t=h(arguments,0);return t.unshift(this),E.nbind.apply(void 0,t)},E.nmapply=E.npost=function(t,e,n){return E(t).npost(e,n)},k.prototype.nmapply=k.prototype.npost=function(t,e){var n=h(e||[]),i=T();return n.push(i.makeNodeResolver()),this.dispatch("post",[t,n]).fail(i.reject),i.promise},E.nsend=E.nmcall=E.ninvoke=function(t,e){var n=h(arguments,2),i=T();return n.push(i.makeNodeResolver()),E(t).dispatch("post",[e,n]).fail(i.reject),i.promise},k.prototype.nsend=k.prototype.nmcall=k.prototype.ninvoke=function(t){var e=h(arguments,1),n=T();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},E.nodeify=function(t,e){return E(t).nodeify(e)},k.prototype.nodeify=function(t){if(!t)return this;this.then((function(e){E.nextTick((function(){t(null,e)}))}),(function(e){E.nextTick((function(){t(e)}))}))},E.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var K=_();return E}))}).call(this,n(44),n(578).setImmediate)},578:function(t,e,n){(function(t){var i=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(579),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(11))},579:function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var i,r,o,a,s,u=1,c={},h=!1,l=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?i=function(t){e.nextTick((function(){p(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},i=function(t){o.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(r=l.documentElement,i=function(t){var e=l.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):i=function(t){setTimeout(p,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&p(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),i=function(e){t.postMessage(a+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var r={callback:t,args:e};return c[u]=r,i(u),u++},f.clearImmediate=d}function d(t){delete c[t]}function p(t){if(h)setTimeout(p,0,t);else{var e=c[t];if(e){h=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{d(t),h=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(11),n(44))},600:function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"ViewableStyle",(function(){return H})),n.d(i,"SpriteViewable",(function(){return U})),n.d(i,"CustomViewable",(function(){return B})),n.d(i,"ViewableData",(function(){return F})),n.d(i,"ViewableType",(function(){return V}));var r=n(31),o=n.n(r);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=f(t);if(e){var r=f(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function l(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=Autodesk.Viewing,p=d.GlobalManagerMixin,v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(a,t);var e,n,i,o=h(a);function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(this,a),(e=o.call(this)).names=["HyperionTool"],e.options=n,e.setGlobalManager(t.globalManager),e.viewer=t,e.delegate=n.delegate,e.init(),e.hoveringDbId=0,e.selectedDbId=0,e}return e=a,(n=[{key:"init",value:function(){var t=this,e=this.viewer.impl;this.activate=function(e){t.active=!0},this.deactivate=function(e){t.clearMarkedObject(),t.active=!1},this.handleSingleClick=function(n,i){var o=!1;if(0===i){var a=e.clientToViewport(n.canvasX,n.canvasY),s=e.renderer(),u=s.getOverlayIdTarget();if(!u)return!1;var c=s.idAtPixel(a.x,a.y,[],[u]);if(t.selectedDbId!=c||0==t.selectedDbId){if(t.selectedDbId){var h={type:r.MOUSE_CLICK_OUT,dbId:t.selectedDbId,originalEvent:n};t.viewer.dispatchEvent(h),h.hasStopped||(t.clearMarkedObject(),t.viewer.impl.invalidate(!1,!1,!0))}t.selectedDbId=c;var l=e.hitTestViewport(a.clone(),!1),f={type:r.MOUSE_CLICK,dbId:c,clickInfo:l,originalEvent:n};t.viewer.dispatchEvent(f),f.hasStopped||(t.markObject([c]),t.viewer.impl.invalidate(!1,!1,!0)),t.selectedDbId&&(o=!0)}}return o},this.handleSingleTap=function(e){return t.handleSingleClick(e,0)},this.handleDoubleClick=function(t,e){return!1},this.handleButtonDown=function(e){return t.buttonDown=!0,!1},this.handleButtonUp=function(e){return t.buttonDown=!1,!1},this.handleMouseMove=function(n){if(!t.buttonDown){var i=e.clientToViewport(n.canvasX,n.canvasY),o=e.renderer().getOverlayIdTarget();if(!o)return!1;var a=e.renderer().idAtPixel(i.x,i.y,[],[o]);if(t.hoveringDbId!=a){var s=0!=a?a:t.hoveringDbId;t.hoveringDbId=a;var u=0!=a;return t.viewer.dispatchEvent({type:r.MOUSE_HOVERING,dbId:s,hovering:u,originalEvent:n}),!0}}},this.markObject=function(e){if(e instanceof Array||(e=[e]),t.delegate.hasViewables){var n=t.delegate.mapDbIdsToGeometries(e),i=new Set(e);n.map((function(e){if(e&&e.attributes.id&&e.attributes.pointScale){for(var n=e.attributes.pointScale.array,r=e.attributes.uvp.array,o=e.attributes.color.array,a=e.attributes.id.array,s=0;s<a.length;s+=3){var u=a[s]+(a[s+1]<<8)+(a[s+2]<<16),c=s/3,h=i.has(u);n[c]=h?1.5:1;var l=t.delegate.viewableData.getViewableUV(u,h);l&&(r[4*c]=l.x,r[4*c+1]=l.y,r[4*c+2]=l.w,r[4*c+3]=l.h);var f=t.delegate.viewableData.getViewableColor(u,h);f&&(o[3*c]=255*f.r,o[3*c+1]=255*f.g,o[3*c+2]=255*f.b)}e.attributes.pointScale.needsUpdate=!0,e.attributes.uvp.needsUpdate=!0,e.attributes.color.needsUpdate=!0}})),t.markedFragments=n}},this.clearMarkedObject=function(){if(t.delegate.hasViewables){var e=t.markedFragments||[];t.markedFragments=[],e&&(e.map((function(e){if(e&&e.attributes.pointScale){for(var n=e.attributes.pointScale.array,i=e.attributes.uvp.array,r=e.attributes.color.array,o=e.attributes.id.array,a=0;a<o.length;a+=3){var s=o[a]+(o[a+1]<<8)+(o[a+2]<<16),u=a/3;n[u]=1;var c=t.delegate.viewableData.getViewableUV(s,!1);c&&(i[4*u]=c.x,i[4*u+1]=c.y,i[4*u+2]=c.w,i[4*u+3]=c.h);var h=t.delegate.viewableData.getViewableColor(s,!1);h&&(r[3*u]=255*h.r,r[3*u+1]=255*h.g,r[3*u+2]=255*h.b)}e.attributes.pointScale.needsUpdate=!0,e.attributes.uvp.needsUpdate=!0,e.attributes.color.needsUpdate=!0}})),t.viewer.impl.invalidate(!1,!1,!0))}else t.markedFragments=[]},this.invalidateViewablesDirect=function(e,n,i,r){if(!e||!n||!r)throw new Error("Parameters of 'invalidateViewables' are mandatory");e instanceof Array||(e=[e]);var o=new Set(e),a=new Map;i.viewables.forEach((function(t){return a.set(t.dbId,t)}));for(var s=!1,u=n[0].geometry,c=u.attributes.id.array,h=0;h<c.length;h+=3){var l=c[h]+(c[h+1]<<8)+(c[h+2]<<16);if(o.has(l)){var f=r(a.get(l));if(f){var d=h/3;if(f.position){var p=u.attributes.position.array;u.attributes.position.needsUpdate=!0,p[3*d+0]=f.position.x,p[3*d+1]=f.position.y,p[3*d+2]=f.position.z,s=!0}if(f.url){var v=i.getSpriteUV(f.url);if(v){var y=u.attributes.uvp.array;u.attributes.uvp.needsUpdate=!0,y[4*d+0]=v.x,y[4*d+1]=v.y,y[4*d+2]=v.w,y[4*d+3]=v.h,s=!0}}if(f.color){var g=u.attributes.color.array;u.attributes.color.needsUpdate=!0,g[3*d+0]=255*f.color.r,g[3*d+1]=255*f.color.g,g[3*d+2]=255*f.color.b,s=!0}if(void 0!==f.scale){if(f.scale>2||f.scale<0){var m="invalidateViewables: 'scale' of '".concat(f.scale,"' out of range [0, 2]");console.warn(m)}var w=u.attributes.pointScale.array;u.attributes.pointScale.needsUpdate=!0,w[d]=f.scale,s=!0}}}}s&&t.viewer.impl.invalidate(!1,!1,!0)}}}])&&u(e.prototype,n),i&&u(e,i),a}(d.ToolInterface);p.call(v.prototype);var y=n(346),g=n(347),m=n(57),w=n.n(m);function b(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var E=Autodesk.Viewing.Private,T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1920,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1080,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;x(this,t),this.width=e,this.height=n,this.padding=i,this.spritesMap={},this.pending=[],this.images=[],this.logger=E.logger,this.packer=new g.MaxRectsPacker(this.width,this.height,this.padding,{smart:!0,pot:!1,square:!1,allowRotation:!1,tag:!1,border:0}),this.canvas=document.createElement("canvas"),this.hasContent=!1}var e,n,i,r,o;return e=t,(n=[{key:"addSprite",value:function(t){var e=this;if(null==this.spritesMap[t]){var n=w.a.defer(),i=new Image;i.crossOrigin="anonymous",i.onload=function(){e.images.push({url:t,image:i,width:i.width,height:i.height}),n.resolve()},i.onerror=function(t){e.logger.error(t),n.resolve()},i.src=t,this.spritesMap[t]=1,this.pending.push(n.promise)}}},{key:"finish",value:(r=regeneratorRuntime.mark((function t(){var e,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.a.all(this.pending);case 2:e=this.canvas,this.packer.addArray(this.images),this.images.length=0,this.packer.bins.forEach((function(t){e.width=t.width,e.height=t.height;var i=e.getContext("2d");t.rects.forEach((function(t){t.image&&(i.drawImage(t.image,t.x,t.y),t.image=void 0,n.spritesMap[t.url]=t,t.url=void 0)}))}));case 6:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(n,i){var o=r.apply(t,e);function a(t){b(o,n,i,a,s,"next",t)}function s(t){b(o,n,i,a,s,"throw",t)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"spriteUV",value:function(t){var e=this.spritesMap[t];return e?{x:e.x/this.canvasWidth,y:e.y/this.canvasHeight,w:(e.x+e.width)/this.canvasWidth,h:(e.y+e.height)/this.canvasHeight}:{x:0,y:0,w:1,h:1}}},{key:"canvasWidth",get:function(){return this.canvas.width}},{key:"canvasHeight",get:function(){return this.canvas.height}}])&&_(e.prototype,n),i&&_(e,i),t}();function S(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=M(t);if(e){var r=M(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return P(this,n)}}function P(t,e){return!e||"object"!==R(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return I(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function j(t,e,n){return e&&A(t.prototype,e),n&&A(t,n),t}var V={SPRITE:1,GEOMETRY:2},H=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.SPRITE,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new THREE.Color(16777215),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Color(16777215),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];D(this,t),this.type=e,this.color=n,this.url=i,this.highlightedColor=r,this.highlightedUrl=o,this.spriteUrls=new Set(a)}return j(t,[{key:"preloadSprite",value:function(t){this.spriteUrls.add(t)}},{key:"preloadedSprites",get:function(){return C(this.spriteUrls.values())}}]),t}(),B=function(){function t(e,n,i){D(this,t),this._style=n,this._position=e,this._dbId=i}return j(t,[{key:"style",get:function(){return this._style}},{key:"position",get:function(){return this._position}},{key:"dbId",get:function(){return this._dbId}}]),t}(),U=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(n,t);var e=O(n);function n(t,i,r){return D(this,n),console.assert(i.type==V.SPRITE),e.call(this,t,i,r)}return j(n,[{key:"type",get:function(){return V.SPRITE}},{key:"color",get:function(){return this.style.color}},{key:"highlightedColor",get:function(){return this.style.highlightedColor}}]),n}(B),F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D(this,t),this._styleMap=new Map,this._viewablesMap=new Map,this._spriteAtlas=new T(e.atlasWidth||1920,e.atlasHeight||1080,2)}var e,n;return j(t,[{key:"addViewable",value:function(t){var e=this;if(t.type==V.SPRITE){var n=new Set;n.add(t.style.url),t.style.highlightedUrl&&n.add(t.style.highlightedUrl),t.style.preloadedSprites.forEach((function(t){return n.add(t)})),n.forEach((function(t){return e.spriteAtlas.addSprite(t)}))}this._viewablesMap.set(t.dbId,t)}},{key:"getSpriteUV",value:function(t){return this._spriteAtlas.spriteUV(t)}},{key:"getViewableUV",value:function(t,e){var n=this._viewablesMap.get(t).style;return e&&n.highlightedUrl?this._spriteAtlas.spriteUV(n.highlightedUrl):this._spriteAtlas.spriteUV(n.url)}},{key:"getViewableColor",value:function(t,e){var n=this._viewablesMap.get(t).style;return e?n.highlightedColor:n.color}},{key:"finish",value:(e=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._spriteAtlas.finish();case 2:case"end":return t.stop()}}),t,this)})),n=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(t){S(o,i,r,a,s,"next",t)}function s(t){S(o,i,r,a,s,"throw",t)}a(void 0)}))},function(){return n.apply(this,arguments)})},{key:"viewables",get:function(){return C(this._viewablesMap.values())}},{key:"spriteAtlas",get:function(){return this._spriteAtlas}}]),t}(),L=n(17);function N(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function G(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(t){N(o,i,r,a,s,"next",t)}function s(t){N(o,i,r,a,s,"throw",t)}a(void 0)}))}}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function X(t,e,n){return e&&W(t.prototype,e),n&&W(t,n),t}var K=function(){function t(e,n,i){z(this,t),this._id=e,this._name=n,this._bounds=i,this._devices=[]}return X(t,[{key:"addDevice",value:function(t){this._devices.push(t)}},{key:"info",set:function(t){this._info=t},get:function(){return this._info}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"bounds",get:function(){return this._bounds}},{key:"devices",get:function(){return this._devices}}]),t}(),q=function(){function t(){z(this,t)}return X(t,[{key:"addRoomToLevel",value:function(t,e){this[t]||(this[t]=[]),this[t].push(e)}},{key:"getRoomsOnLevel",value:function(t,e){var n=this[t]||[];return e?n.filter((function(t){return t.devices.length>0})):n}}]),t}(),$=function(){function t(e){z(this,t),this.model=e,this.rooms=null}var e,n,i,r;return X(t,[{key:"getImmediateChildNodesByName",value:function(t,e){var n=this.model.getInstanceTree(),i=[];return n&&(e=null==e?n.getRootId():e,n.enumNodeChildren(e,(function(e){var r=n.getNodeName(e,!0);r&&r.indexOf&&r.indexOf(t)>=0&&i.push(e)}),!1)),i}},{key:"getLevelRoomsMap",value:(r=G(regeneratorRuntime.mark((function t(){var e,n,i,r=this,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.length>0&&void 0!==o[0]&&o[0],n=o.length>1?o[1]:void 0,this.levelRoomsMap){t.next=9;break}return i=new q,t.next=6,this.getRoomList(n);case 6:t.sent.forEach((function(t){var n=r.getLevel(t);e||(t.info=void 0),null!=n&&i.addRoomToLevel(n,t)})),this.levelRoomsMap=i;case 9:return t.abrupt("return",this.levelRoomsMap);case 10:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"getLevel",value:function(t){if(t&&t.info&&t.info.properties){var e=t.info.properties.find((function(t){return 20==t.type&&"Level"==t.attributeName}));return e?e.displayValue:void 0}}},{key:"getRoomList",value:(i=G(regeneratorRuntime.mark((function t(e){var n,i,r,o,a,s,u=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.rooms){t.next=10;break}return e=e||"Rooms",n=this.getImmediateChildNodesByName(e),i=this.model,r=[],n&&n.length>0&&(o=n[0],(a=i.getInstanceTree())&&a.enumNodeChildren(o,(function(t){var e=a.getNodeName(t,!0),n=u.getRoomBounds(t);r.push(new K(t,e,n))}),!1)),s=r.map((function(t){return new Promise((function(e,n){i.getProperties2(t.id,(function(n){t.info=n,e(t)}),(function(n){e(t)}))}))})),t.next=9,Promise.all(s);case 9:this.rooms=r;case 10:return t.abrupt("return",this.rooms);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"getRoomBounds",value:function(t){var e=new THREE.Box3,n=new THREE.Box3,i=this.model.getInstanceTree(),r=this.model.getFragmentList();return i&&i.enumNodeFragments(t,(function(t){r.getWorldBounds(t,n),e.union(n)}),!0),e}},{key:"mapDevicesInRoom",value:(n=G(regeneratorRuntime.mark((function t(){var e,n,i,r,o,a,s,u,c=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:[],n=c.length>1?c[1]:void 0,t.next=4,this.getRoomList(n);case 4:for(i=t.sent,e=e.slice(0),r=0;e.length>0&&r<i.length;r++)for(o=i[r],a=0;a<e.length;a++)s=e[a],this.roomGeomContainsPoint(o,s.position)&&(s.roomId=o.id,o.addDevice(s),e.splice(a,1),a--);e.length>0&&(u=e.map((function(t){return"".concat(t.id," (").concat(t.name,")")})),console.warn("Some devices did not map to a room: ".concat(u.join(", "))));case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"generateSurfaceShadingData",value:(e=G(regeneratorRuntime.mark((function t(){var e,n,i,r,o,a,s=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:[],n=s.length>1?s[1]:void 0,i=s.length>2?s[2]:void 0,n){t.next=9;break}return t.next=6,this.getLevelRoomsMap(!1,i);case 6:return n=t.sent,t.next=9,this.mapDevicesInRoom(e,i);case 9:for(a in r=new L.SurfaceShadingData,o=function(t){var e=n[t],i=new L.SurfaceShadingGroup(t);e.forEach((function(t){var e=new L.SurfaceShadingNode(t.name,t.id);t.devices.forEach((function(t){var n=t.deviceModel?t.deviceModel.id:t.type;e.addPoint(new L.SurfaceShadingPoint(t.id,t.position,t.sensorTypes,t.name,{styleId:n}))})),i.addChild(e)})),r.addChild(i)},n)o(a);return r.initialize(this.model),t.abrupt("return",r);case 14:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"roomGeomContainsPoint",value:function(t,e){return t.bounds&&t.bounds.containsPoint(e)}}]),t}();function Y(t){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=nt(t);if(e){var r=nt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return et(this,n)}}function et(t,e){return!e||"object"!==Y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var it=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(o,THREE.ShaderMaterial);var e,n,i,r=tt(o);function o(t,e,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(J(this,o),e.length<2||e.length!=n.length)throw new Error("Heatmap requires at least two colors to work");if(i<0)throw new Error("Heatmap 'confidence' must be a positive number");if(a<0)throw new Error("Heatmap 'powerParameter' must be a positive number");if(s<0||s>1)throw new Error("Heatmap 'alpha' must range between 0.0 and 1.0");var u={uPower:{type:"f",value:a},uAlpha:{type:"f",value:s},uConfidence:{type:"f",value:i},uSensors:{type:"v4v",value:t.map((function(t){return t}))},uStops:{type:"fv1",value:n},uColors:{type:"v3v",value:e}},c=e.length,h=t.length,l="\n            varying vec4 worldCoord;\n\n            void main()\n            {\n                vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                worldCoord = modelMatrix * vec4(position, 1.0);\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        ",f="\n            varying vec4 worldCoord;\n            uniform float uPower;\n            uniform float uAlpha;\n            uniform float uConfidence;\n            uniform vec4 uSensors [".concat(h,"];\n            uniform float uStops[").concat(c,"];\n            uniform vec3 uColors[").concat(c,"];\n\n            const float dotSize = 6.0;\n            const float h_var1 = 0.4;\n            const float h_var2 = 0.25;\n            const float two_pi = 2.0 * 3.1415927;\n            \n            float lmap(float value, float inMin, float inMax, float outMin, float outMax)\n            {\n                return clamp(outMin + ((outMax - outMin) * (value - inMin)) / (inMax - inMin), outMin, outMax);\n            }\n\n            // Gradient with multiple colors in non-equal intervals\n            vec3 colormap(float x)\n            {\n                for (int i = 1; i < ").concat(c,"; i++) {\n                    if (x <= uStops[i]) {\n                        float stopPct = lmap(x, uStops[i-1], uStops[i], 0.0, 1.0);\n                        return mix(uColors[i-1], uColors[i], stopPct);\n                    }\n                }\n            \n                // In case 'x' goes beyond upper bound.\n                return uColors[").concat(c," - 1];\n            }\n\n            vec2 get_pix(float angle) {\n                float rad = radians(angle);\n                float c = cos(rad);\n                float s = sin(rad);\n                mat2 R = mat2(vec2(c, -s), vec2(s, c));\n                return R * gl_FragCoord.xy;\n            }\n\n            vec3 halftone(float tone, vec3 dotColor, vec3 backgroundColor) {\n                vec2 u = get_pix(-45.0) / (dotSize);\n                float h = (h_var1 + h_var2 * cos(u.x*two_pi));\n                const float e = 0.05;\n                float gradient = smoothstep(-e, e, h - tone);\n                return mix(dotColor, backgroundColor, gradient);\n            }\n\n            void main(void) {\n                vec3 fragPos = vec3(worldCoord.x, worldCoord.y, worldCoord.z);\n                float result = 0.0;\n                float sum = 0.0;\n                float wsum = 0.000001;\n                float minDist = 999999999.0;\n                bool found = false; // at exact location of the sensor\n                int validSensors = 0;\n\n                for (int i=0; i < ").concat(h,"; i++) {\n                    float mydist = distance(fragPos, vec3(uSensors[i][0], uSensors[i][1], uSensors[i][2]));\n                    if (uSensors[i][3] >= 0.0) {\n                        if (mydist < 0.00001) {\n                            result = uSensors[i][3];\n                            found = true;\n                        } else {\n                            float w = (1.0 / (pow(mydist, uPower)));\n                            sum += (uSensors[i][3] * w);\n                            wsum += w;\n                        }\n                        validSensors += 1;\n                        if (mydist < minDist) {\n                            minDist = mydist;\n                        }\n                    }\n                }\n\n                if (validSensors == 0) {\n                    result = -1.0;\n                } else if (!found) {\n                    result = sum / wsum;\n                }\n\n                // Defaults without influence from any sensor\n                float confidence = 0.0;\n                vec3 sensorColor = vec3(0.5, 0.5, 0.5);\n\n                if (result >= 0.0) {\n                    result = clamp(result, 0.0, 1.0);\n                    confidence = 1.0 - clamp(minDist / uConfidence, 0.0, 1.0);\n                    sensorColor = colormap(result);\n                }\n\n                vec3 confidenceColor = halftone(clamp(confidence, 0.3, 0.9), vec3(0.7, 0.7, 0.7), vec3(1.0, 1.0, 1.0));\n                gl_FragColor = vec4(mix(confidenceColor, sensorColor, clamp(confidence, 0.0, 1.0)), uAlpha);\n            }\n        ");return r.call(this,{uniforms:u,vertexShader:l,fragmentShader:f,side:THREE.DoubleSide,depthTest:!0,depthWrite:!1})}return e=o,(n=[{key:"update",value:function(t,e,n,i){isNaN(e)||null===e||(this.uniforms.uConfidence.value=e),isNaN(n)||null===n||(this.uniforms.uPower.value=n),isNaN(i)||null===i||(this.uniforms.uAlpha.value=i),this.uniforms.uSensors.value=t}}])&&Z(e.prototype,n),i&&Z(e,i),o}();function rt(t){for(var e=[],n=1/(t-1),i=0;i<t;i++)e.push(n*i);return e}function ot(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return at(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return at(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function st(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ut=Autodesk.Viewing.Private,ct=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.model=n,this.shadingData=i,this.activeShadingPoints=[],this.settings={},this.registerSensorColors("hatchPattern",[16777215,16777215],.7),this.registerSensorColors("__defaultSensor__",[255,65280,16776960,16711680],.7)}var e,n,i;return e=t,(n=[{key:"removeShading",value:function(){this.viewer.impl.removeOverlayScene("DataVizSurfaceShading"),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"cleanUp",value:function(){this.removeShading(),this._clearActiveShadingPoints(),this.hatchMaterial&&(this.hatchMaterial.dispose(),delete this.hatchMaterial)}},{key:"_clearActiveShadingPoints",value:function(){this.activeShadingPoints.forEach((function(t){return t.heatmapMaterial.dispose()})),this.activeShadingPoints=[]}},{key:"_createHatchMaterial",value:function(){var t=this.settings.hatchPattern;return new it([new THREE.Vector4(9999999.9,9999999.9,9999999.9,-1)],t.colors,t.stops,60,2,t.alpha)}},{key:"registerSensorColors",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;this.settings[t]={stops:rt(e.length),colors:e.map((function(t){return new THREE.Color(t)})).map((function(t){return new THREE.Vector3(t.r,t.g,t.b)})),alpha:n}}},{key:"getSetting",value:function(t){return this.settings[t]?this.settings[t]:this.settings.__defaultSensor__}},{key:"render",value:function(t,e,n,i){var r=this,o=i?i.confidence:0;o=isNaN(o)?0:Math.abs(o);var a=2;i&&"number"==typeof i.powerParameter&&(a=i.powerParameter);var s=[];t instanceof Array?t.forEach((function(t){return r.shadingData.getLeafsById(t,s)})):s=this.shadingData.getLeafsById(t);var u=this.model.getInstanceTree();this._clearActiveShadingPoints();var c=this.viewer.impl,h=this.activeShadingPoints;c.createOverlayScene("DataVizSurfaceShading"),this.hatchMaterial||(this.hatchMaterial=this._createHatchMaterial());for(var l=this.getSetting(e),f=function(t){var i=s[t],f=Object(L.filterShadingPointsByType)(i.shadingPoints,e),d=r.hatchMaterial;if(f.length>0){var p=o;if(i.bounds&&!o){var v=i.bounds.max,y=i.bounds.min;p=v.x-y.x+(v.y-y.y)+(v.z-y.z)}p=p||160;var g=[];f.forEach((function(t){var i=t.position,r=n(t,e),o=new THREE.Vector4(i.x,i.y,i.z,r);g.push(o)})),d=new it(g,l.colors,l.stops,p,a,l.alpha),h.push({shadingPoints:f,sensorType:e,heatmapMaterial:d})}i.fragIds.forEach((function(t){return function(t,e){var n=u.fragList.getGeometry(t);if(n){var i=new THREE.Mesh(n,e),r=new THREE.Matrix4;u.fragList.getWorldMatrix(t,r),i.matrix.copy(r),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.frustumCulled=!1,c.addOverlay("DataVizSurfaceShading",i)}else ut.logger.error("Geometry for the fragment is empty, FragId:",t)}(t,d)}))},d=0;s&&d<s.length;d++)f(d)}},{key:"updateShading",value:function(t,e){var n,i,r;e&&(n=e.confidence,i=e.powerParameter,r=e.alpha);for(var o=0;o<this.activeShadingPoints.length;o++){var a,s=this.activeShadingPoints[o],u=s.shadingPoints,c=s.sensorType,h=s.heatmapMaterial,l=[],f=ot(u);try{for(f.s();!(a=f.n()).done;){var d=a.value,p=d.position,v=t(d,c);l.push(new THREE.Vector4(p.x,p.y,p.z,v))}}catch(t){f.e(t)}finally{f.f()}h.update(l,n,i,r)}this.viewer.impl.invalidate(!1,!1,!0)}}])&&st(e.prototype,n),i&&st(e,i),t}(),ht=n(348),lt=n.n(ht);function ft(t){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dt(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return pt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var gt=Autodesk.Viewing.Private,mt=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};vt(this,t);var o=r=this._handleLegacyOptions(r),a=o.width,s=o.height,u=o.minOpacity,c=o.maxOpacity;this.options=r;var h=document.createElement("canvas");h.width=a,h.height=s,this.config={canvas:h,width:a,height:s,minOpacity:u,maxOpacity:c,radius:20},this.model=n,this.viewer=e,this.shadingData=i;var l=new THREE.Texture(h,THREE.UVMapping);l.minFilter=THREE.LinearFilter,l.flipY=!1,this.material=new THREE.MeshBasicMaterial({map:l,depthTest:!0,depthWrite:!1,transparent:!0,side:THREE.DoubleSide}),this.gradientMap={}}var e,n,i;return e=t,(n=[{key:"_handleLegacyOptions",value:function(t){function e(t,e){return null==t||"number"!=typeof t?e:t<0?0:t>1?1:t}return"string"==typeof(t=Object.assign({width:1024,height:1024,slicingEnabled:!0},t)).position&&(t.slicingPosition={min:0,middle:.5,max:1}[t.position]),"string"==typeof t.placePosition&&(t.placementPosition={min:0,max:1}[t.placePosition]),delete t.position,delete t.placePosition,t.slicingPosition=e(t.slicingPosition,.5),t.placementPosition=e(t.placementPosition,0),t}},{key:"_setup",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,i=this.model,r=this.shadingData,o=new THREE.Box3,a=i.getInstanceTree(),s=[],u={},c=[],h={};function l(t){return!(null==t.shadingPoints||t.shadingPoints&&0==t.shadingPoints.length||null==t.shadingPoints.find((function(t){return t.types.find((function(t){return t==e}))})))}this.gradientMap[e]&&(this.config.gradient=this.gradientMap[e]),this.config.radius=n,t.forEach((function(t){return r.getLeafsById(t,s)}));for(var f=0;f<s.length;f++)l(s[f])&&s[f].dbIds.forEach((function(t){if(a.getNodeBox(t,c),c[0]!=1/0){var e=new THREE.Box3(new THREE.Vector3(c[0],c[1],c[2]),new THREE.Vector3(c[3],c[4],c[5]));o.union(e),u[t]=e}}));var d=o.min.x,p=o.min.y,v=o.max.x-d,y=o.max.y-p,g=this.options,m=g.slicingEnabled,w=g.width,b=g.height;v>y?b=w/v*y:w=b/y*v,this.config.canvas.width=w,this.config.canvas.height=b,this.config.width=w,this.config.height=b,this.heatmapInstance?this.heatmapInstance.configure(this.config):this.heatmapInstance=lt.a.create(this.config);for(var x=[],_=[],E=[],T=Autodesk.Viewing.Extensions.CompGeom,S=this.options.slicingPosition,R=this.options.placementPosition,k=i.getFragmentList(),O=0;O<s.length;O++){var P=s[O],M=Object(L.filterShadingPointsByType)(P.shadingPoints,e);if(!(M.length<=0)){var C;m?function(){var t=new THREE.Vector3(0,0,1);new gt.VertexBufferBuilder(!1),C=[],P.dbIds.forEach((function(e){var n=u[e],i=n.min,r=n.max,o=i.z+(r.z-i.z)*S,s=i.z+(r.z-i.z)*R,c=new THREE.Plane(t,-o),h=T.makePlaneBasis(c);a.enumNodeFragments(e,(function(t){var e=k.getVizmesh(t);e.geometry&&!e.geometry.is2d&&!e.geometry.isLines&&e.material.cutplanes&&T.xMeshPlane(c,e,C)}),!0);var l=new THREE.Box3;T.convertToPlaneCoords(h,C,l);var f=new T.EdgeSet(C,l,1e-6*l.size().length());f.snapEdges(),f.sanitizeEdges(),f.stitchContours();var g=f.triangulate();if(g&&!g.triangulationFailed){for(var m=g.toPolygonMesh(),w=x.length/3,b=m.attributes.position.array,O=0,P=b.length;O<P;O+=3)x.push(b[O],b[O+1],s),_.push((b[O]-d)/v,(b[O+1]-p)/y);for(var M=m.attributes.index.array,I=0,D=M.length;I<D;I++)E.push(M[I]+w)}}))}():P.dbIds.forEach((function(t){var e=u[t];if(!e.empty()){var n=e.min,i=e.max,r=n.z+(i.z-n.z)*R,o=x.length/3;E.push(o,o+2,o+1,o,o+3,o+2),x.push(n.x,n.y,r,n.x,i.y,r,i.x,i.y,r,i.x,n.y,r),_.push((n.x-d)/v,(n.y-p)/y,(n.x-d)/v,(i.y-p)/y,(i.x-d)/v,(i.y-p)/y,(i.x-d)/v,(n.y-p)/y)}}));var I,D=dt(M);try{for(D.s();!(I=D.n()).done;){var A=I.value,j={x:Math.round((A.position.x-d)/v*w),y:Math.round((A.position.y-p)/y*b),value:0};h[A.id]={data:j,shadingPoint:A}}}catch(t){D.e(t)}finally{D.f()}}}x=new Float32Array(x),_=new Float32Array(_),E=new Uint16Array(E);var V=new THREE.BufferGeometry,H=new THREE.BufferAttribute(x,3);H.bytesPerItem=4;var B=new THREE.BufferAttribute(_,2);B.bytesPerItem=4;var U=new THREE.BufferAttribute(E,1);V.addAttribute("index",U),V.addAttribute("position",H),V.addAttribute("uv",B),this.geometry=V;var F=this.viewer.impl;F.createOverlayScene("DataVizPlanarHeatmap");var N=new THREE.Mesh(V,this.material);F.addOverlay("DataVizPlanarHeatmap",N),this.totalBounds=o,this.pointDataMap=h,this.currentSensorType=e}},{key:"render",value:function(t,e,n,i){var r=200;"number"==typeof i?r=Math.abs(i):"object"===ft(i)&&i.confidence&&(r=i.confidence),this.geometry&&(this.geometry.dispose(),this.geometry=null),t=t instanceof Array?t:[t],this._setup(t,e,r),this.updateShading(n)}},{key:"updateShading",value:function(t){var e=[];for(var n in this.pointDataMap){var i=this.pointDataMap[n],r=t(i.shadingPoint,this.currentSensorType,i.data);i.data.value=0===r?1e-4:r,isNaN(i.data.value)||e.push(i.data)}this.heatmapInstance.setData({data:e,min:0,max:1}),this.material.map.needsUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"cleanUp",value:function(){this.removeShading(),this.geometry&&(this.geometry.dispose(),this.geometry=null),this.material&&(this.material.dispose(),this.material=null)}},{key:"removeShading",value:function(){this.viewer.impl.removeOverlayScene("DataVizPlanarHeatmap"),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"registerSensorColors",value:function(t,e){for(var n,i,r,o={},a=e.length-1,s=0;s<e.length;s++)o[(s/a).toFixed(3)]=(n=e[s],i=void 0,r=void 0,i=255&n,r=n>>8&255,"rgb(".concat(n>>16&255,", ").concat(r,", ").concat(i,")"));this.gradientMap[t]=o}}])&&yt(e.prototype,n),i&&yt(e,i),t}();function wt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var bt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this._textures={},this._colors={},this._excluded=["__defaultMaterial__","__fadeMaterial__","__highlightMaterial__","__dataVizSpriteMaterial__"]}var e,n,i;return e=t,(n=[{key:"show",value:function(){return this.hideTextures(),this.regen(),!0}},{key:"hide",value:function(){return this.showTextures(),this.regen(),!0}},{key:"regen",value:function(){this.viewer.refresh(!0)}},{key:"hideTextures",value:function(){var t=0===Object.keys(this._textures).length,e=new THREE.Color(1,1,1),n=this.viewer.impl.matman()._materials;for(var i in n)if(-1===this._excluded.indexOf(i)){var r=n[i];t&&(this._textures[i]=r.map,this._colors[i]=r.color),r.map=null,r.color=e,r.needsUpdate=!0}this.regen()}},{key:"showTextures",value:function(){if(Object.keys(this._textures).length>0){var t=this.viewer.impl.matman()._materials;for(var e in t)if(-1===this._excluded.indexOf(e)){var n=t[e],i=this._textures[e];i&&(n.map=i);var r=this._colors[e];r&&(n.color=r),n.needsUpdate=!0}}this.regen()}}])&&wt(e.prototype,n),i&&wt(e,i),t}();function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Tt(t,e,n){return e&&Et(t.prototype,e),n&&Et(t,n),t}function St(t,e){return(St=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Ot(t);if(e){var r=Ot(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return kt(this,n)}}function kt(t,e){return!e||"object"!==xt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ot(t){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&St(t,e)}(n,THREE.ShaderMaterial);var e=Rt(n);function n(t,i,r){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;_t(this,n);var s={dataTexture:{type:"t",value:null},vertexTexture:{type:"t",value:null},uPower:{type:"f",value:a=parseFloat(a).toFixed(3)},uDataCount:{type:"i",value:r},uDataTextureWidth:{type:"i",value:1}},u="\n            varying vec2 vUV;\n\n            void main()\n            {\n                vUV = uv;\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        ",c="\n            varying vec2 vUV;\n\n            uniform float uPower;\n            uniform int uDataCount;\n            uniform int uDataTextureWidth;\n            \n            uniform sampler2D dataTexture;\n            uniform sampler2D vertexTexture;\n            \n            void main(void) {\n                // The position of the vertex whose value is to be determined.\n                vec4 vertex = texture2D(vertexTexture, vUV);\n            \n                if (vertex.w < 0.) {\n                    // This is an invalid vertex, mark as transparent.\n                    gl_FragColor = vec4(0., 0., 0., 1.);\n                    return;\n                }\n            \n                float sum = 0.;\n                float wsum = 0.;\n                float factor = 1. / float(uDataTextureWidth);\n                float textureWidth = float(uDataTextureWidth);\n            \n                // Compute weighted influence from all the data points.\n                for (int index = 0; index < uDataCount; index++)\n                {\n                    float i = float(index);\n                    float y = floor(i / textureWidth);\n                    float x = mod(i, textureWidth);\n            \n                    vec2 dUV = vec2((x + 0.5) * factor, (y + 0.5) * factor);\n                    vec4 dataPoint = texture2D(dataTexture, dUV);\n            \n                    float dist = distance(vertex.xyz, dataPoint.xyz);\n            \n                    if (dist < 0.0001) {\n                        gl_FragColor = vec4(dataPoint.w, 0., 0., 1.);\n                        return;\n                    }\n            \n                    float w = 1. / dist;\n                    w = pow(w, uPower);\n            \n                    sum += dataPoint.w * w;\n                    wsum += w;\n                }\n            \n                gl_FragColor = vec4(sum/wsum , 0., 0., 1.);\n            }\n        ";return(o=e.call(this,{uniforms:s,vertexShader:u,fragmentShader:c,side:THREE.DoubleSide,depthTest:!0,depthWrite:!0})).vertexTexture=t,o.dataTexture=i,o}return Tt(n,[{key:"vertexTexture",set:function(t){t&&(this.uniforms.vertexTexture.value=t)}},{key:"dataTexture",set:function(t){t&&(this.uniforms.dataTexture.value=t,this.uniforms.uDataTextureWidth.value=t.image.width)}}]),n}(),Mt=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_t(this,t),this.viewer=e,this.min=r.min,this.max=r.max;var o=r.colors;o?this.setColors(o):this.setColors([255,65535,65280,16776960,16711680]),this.setVertices(n),this.setDataPoints(i),this.initializeRender()}return Tt(t,[{key:"setVertices",value:function(t){this.vertexTexture&&(this.vertexTexture.dispose(),this.vertexTexture=null);var e=Math.ceil(Math.sqrt(t.length/3)),n=new Float32Array(e*e*4);n.fill(-1);for(var i=0,r=t.length/3;i<r;i++)n[4*i]=t[3*i],n[4*i+1]=t[3*i+1],n[4*i+2]=t[3*i+2],n[4*i+3]=1;var o=new THREE.DataTexture(n,e,e,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);o.needsUpdate=!0,this.vertexTexture=o,this.verticesLength=t.length,this.vertexValues=new Uint8Array(e*e*4)}},{key:"setDataPoints",value:function(t){this.dataTexture&&(this.dataTexture.dispose(),this.dataTexture=null);var e=Math.ceil(Math.sqrt(t.length/4)),n=new Float32Array(e*e*4),i=this.min,r=this.max;if(null==i||null==r){i=1/0,r=-1/0;for(var o=0;o<t.length;o+=4)i=Math.min(i,t[o+3]),r=Math.max(r,t[o+3])}for(var a=r-i||1,s=0;s<t.length;s+=4)n[s]=t[s],n[s+1]=t[s+1],n[s+2]=t[s+2],n[s+3]=(t[s+3]-i)/a;var u=new THREE.DataTexture(n,e,e,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);u.needsUpdate=!0,this.dataTexture=u,this.dataCount=t.length/4}},{key:"initializeRender",value:function(){var t=new Pt(this.vertexTexture,this.dataTexture,this.dataCount),e=new THREE.PlaneBufferGeometry(2,2,1,1),n=new THREE.OrthographicCamera(-1,1,-1,1,0,1),i=this.vertexTexture.image.width,r=new THREE.WebGLRenderTarget(i,i,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),o=new THREE.Mesh(e,t);o.frustumCulled=!1,this.scene=new THREE.Scene,this.scene.add(o),this.material=t,this.renderTarget=r,this.planeGeometry=e,this.camera=n}},{key:"setColors",value:function(t){if(t){this.colors=t.map((function(t){return new THREE.Color(t)})),this.stops=this._createColorStops(t.length),this.colorMapData=[];for(var e=0;e<256;e++)this.colorMapData.push(this._mapValueToColor(e/255))}}},{key:"_createColorStops",value:function(t){for(var e=[],n=1/(t-1),i=0;i<t;i++)e.push(n*i);return e}},{key:"_mapValueToColor",value:function(t){var e=this.colors,n=this.stops;function i(t,e,n){return t*(1-n)+e*n}function r(t,e,n){var r=new THREE.Color;return r.r=i(t.r,e.r,n),r.g=i(t.g,e.g,n),r.b=i(t.b,e.b,n),r}for(var o=e[n.length-1],a=1;a<n.length;a++)if(t<=n[a]){var s=(t-n[a-1])/(n[a]-n[a-1]);o=r(e[a-1],e[a],s);break}return{r:Math.round(255*o.r),g:Math.round(255*o.g),b:Math.round(255*o.b)}}},{key:"process",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.colors,n=t.power,i=t.outputTarget;e&&this.setColors(e),null==n&&(n=1),this.material.uniforms.uPower.value=n;var r=this.vertexTexture.image.width;this.renderTarget.width!=r&&this.renderTarget.setSize(r,r);var o=this.viewer.impl.glrenderer();return o.render(this.scene,this.camera,this.renderTarget,!0),o.readRenderTargetPixels(this.renderTarget,0,0,r,r,this.vertexValues),this._getColorValues(i)}},{key:"_getColorValues",value:function(t){var e;e=t&&t.length==this.verticesLength?t:new Uint8Array(this.verticesLength);for(var n=this.vertexValues,i=0,r=this.verticesLength/3;i<r;i++){var o=4*i;if(!(n[o+3]<128)){var a=n[o],s=this.colorMapData[a];e[3*i]=s.r,e[3*i+1]=s.g,e[3*i+2]=s.b}}return e}},{key:"cleanUp",value:function(){var t=this;setTimeout((function(){t.vertexTexture&&(t.vertexTexture.dispose(),t.vertexTexture=null),t.dataTexture&&(t.dataTexture.dispose(),t.dataTexture=null),t.renderTarget&&(t.renderTarget.dispose(),t.renderTarget=null),t.material&&(t.material.dispose(),t.material=null),t.planeGeometry&&(t.planeGeometry.dispose(),t.planeGeometry=null)}),32)}}]),t}();function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function It(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function Dt(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(t){It(o,i,r,a,s,"next",t)}function s(t){It(o,i,r,a,s,"throw",t)}a(void 0)}))}}function At(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Vt(t,e){return(Vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Ft(t);if(e){var r=Ft(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Bt(this,n)}}function Bt(t,e){return!e||"object"!==Ct(e)&&"function"!=typeof e?Ut(t):e}function Ut(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ft(t){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Lt="Autodesk.DataVisualization",Nt=AutodeskNamespace("Autodesk.DataVisualization.Core");Nt=Object.assign(Nt,i),Nt=Object.assign(Nt,o.a),(Nt=Object.assign(Nt,L)).Room=K,Nt.LevelRoomsMap=q,Nt.ModelStructureInfo=$,Nt.SurfaceShading=ct,Nt.PlanarHeatmap=mt,Nt.IDWDataProcessor=Mt,Nt.IDWProcessMaterial=Pt;var Gt=Autodesk.Viewing,zt=Gt.Private,Wt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vt(t,e)}(u,t);var e,n,i,r,o,a,s=Ht(u);function u(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return At(this,u),(e=s.call(this,t,n)).textureUtility=new bt(t),e.pointMeshes=[],e._onInstanceTreeReady=e._onInstanceTreeReady.bind(Ut(e)),e}return e=u,(n=[{key:"load",value:(a=Dt(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.tool=new v(this.viewer,{delegate:this}),this.viewer.toolController.registerTool(this.tool),this.activate(),this.instanceTreeReadyPromise=new Promise((function(t,n){e.instanceTreeReadyPromiseResolve=t,e.instanceTreeReadyPromiseReject=n})),this.datavizDotOverlay=this.viewer.impl.createOverlayScene("DataVizDots",null,null,null,!0,!0),this.viewer.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,this._onInstanceTreeReady),this.deviceDepthOcclusion=!1,t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"unload",value:function(){return this.viewer.toolController.deregisterTool(this.tool),this.viewer.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,this._onInstanceTreeReady),this.removeSurfaceShading(),this.surfaceShading=null,this.deactivate(),!0}},{key:"activate",value:function(){return this.viewer.toolController.activateTool(this.tool.getName()),!0}},{key:"deactivate",value:function(){return this.viewer.toolController.deactivateTool(this.tool.getName()),this.removeSurfaceShading(),this.showTextures(),this.removeAllViewables(),!0}},{key:"_onInstanceTreeReady",value:function(t){this.instanceTreeReadyPromiseResolve&&this.instanceTreeReadyPromiseResolve()}},{key:"waitForInstanceTree",value:(o=Dt(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.getInstanceTree()){t.next=4;break}this.instanceTreeReadyPromiseResolve(),t.next=6;break;case 4:return t.next=6,this.instanceTreeReadyPromise;case 6:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"mapDbIdsToGeometries",value:function(t){var e=this.dbId2Geometry||{},n=new Set;return t.map((function(t){var i=e[t];i&&n.add(i)})),Array.from(n)}},{key:"addViewables",value:function(t){var e=this,n=THREE.ImageUtils.loadTexture(t.spriteAtlas.canvas.toDataURL());n.minFilter=THREE.LinearFilter,n.maxFilter=THREE.LinearFilter,n.flipY=!1;var i=new THREE.PointCloudMaterial({size:t.spriteSize*this.getWindow().devicePixelRatio,map:n,vertexColors:THREE.VertexColors,alphaTest:.5,transparent:!0,occlusion:1,depthTest:!0,depthWrite:!0});function r(t,e){var n=t.impl.renderer().getDepthTarget();if(n){var i=new THREE.Vector2(1/n.width,1/n.height);e.uniforms=Object.assign(e.uniforms||{},{tDepthTest:{type:"t",value:n},tDepthResolution:{type:"v2",value:i}})}}i.skipMrtNormals=!0,r(this.viewer,i),i.defines=Object.assign(i.defines||{},{PARTICLE_FRAGMENT:1,USE_VERTEX_ID:1,DEPTH_OCCLUSION:this.deviceDepthOcclusion?1:0,PARTICLE_UV:1,PARTICLE_FLAGS:""});var o=this.viewer.impl;o.matman().addMaterial("__dataVizSpriteMaterial__",i,!0),this.pointMaterial=i,this.viewableData=t,this.dbId2Geometry={},this.viewer.addEventListener(Gt.VIEWER_RESIZE_EVENT,(function(){r(e.viewer,i)}));var a=this,s=new y.SpriteMeshBuilder((function(t){t.dbIds.forEach((function(e){a.dbId2Geometry[e]=t}));var e=new THREE.Mesh(t,i);o.addOverlay("DataVizDots",e),a.pointMeshes.push(e),setTimeout((function(){o.invalidate(!1,!1,!0)}),16)}));t.viewables.map((function(e){e.position&&s.addPoint(e,t.spriteAtlas)})),s.flushBuffer()}},{key:"removeAllViewables",value:function(){if(this.pointMeshes&&this.pointMeshes.length>0){var t=this.viewer.impl;this.pointMeshes.forEach((function(e){t.removeOverlay("DataVizDots",e),e.geometry.dispose(),e.material.dispose()})),t.invalidate(!1,!1,!0)}this.pointMeshes=[],delete this.dbId2Geometry,delete this.viewableData}},{key:"changeOcclusion",value:function(t){if(this.deviceDepthOcclusion!=t){this.deviceDepthOcclusion=t;var e=t?1:0;this.pointMaterial&&this.pointMaterial.program&&(this.pointMaterial.defines.DEPTH_OCCLUSION=e,this.pointMaterial.needsUpdate=!0),this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"showHideViewables",value:function(t,e){this.changeOcclusion(e),this.pointMaterial&&(this.pointMaterial.visible=t,this.pointMaterial.needsUpdate=!0),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"highlightViewables",value:function(t){this.tool&&this.tool.markObject(t)}},{key:"clearHighlightedViewables",value:function(){this.tool&&this.tool.clearMarkedObject()}},{key:"invalidateViewables",value:function(t,e){!t||t.length<=0?console.warn("All parameters of 'invalidateViewables' are mandatory"):!this.pointMeshes||this.pointMeshes.length<=0||!this.viewableData?console.warn("'addViewables' must be called before 'invalidateViewables'"):this.tool&&this.tool.invalidateViewablesDirect(t,this.pointMeshes,this.viewableData,e)}},{key:"showTextures",value:function(){this.textureUtility.showTextures()}},{key:"hideTextures",value:function(){this.textureUtility.hideTextures()}},{key:"setupSurfaceShading",value:(r=Dt(regeneratorRuntime.mark((function t(e,n){var i,r,o=this,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:{},r=function(){var t=Dt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.surfaceShading&&o.surfaceShading.cleanUp(),"PlanarHeatmap"!=i.type){t.next=7;break}return t.next=4,o.viewer.loadExtension("Autodesk.CompGeom");case 4:o.surfaceShading=new mt(o.viewer,e,n,i),t.next=8;break;case 7:o.surfaceShading=new ct(o.viewer,e,n);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=4,this.waitForInstanceTree(e);case 4:return t.abrupt("return",r());case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"renderSurfaceShading",value:function(t,e,n,i){null==i?i={confidence:160}:"number"==typeof i&&(i={confidence:Math.abs(i)}),this.surfaceShading?this.surfaceShading.render(t,e,n,i):zt.logger.error("Please call setupSurfaceShading first")}},{key:"updateSurfaceShading",value:function(t,e){this.surfaceShading?this.surfaceShading.updateShading(t,e):zt.logger.error("Please call setupSurfaceShading first")}},{key:"registerSurfaceShadingColors",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;this.surfaceShading?this.surfaceShading.registerSensorColors(t,e,n):zt.logger.error("Please call setupSurfaceShading first")}},{key:"removeSurfaceShading",value:function(){this.surfaceShading&&this.surfaceShading.removeShading()}},{key:"hasViewables",get:function(){return this.pointMeshes&&this.pointMeshes.length>0&&this.viewableData}}])&&jt(e.prototype,n),i&&jt(e,i),u}(Gt.Extension);Gt.theExtensionManager.registerExtension(Lt,Wt)}});
//# sourceMappingURL=DataVisualization.min.js.map