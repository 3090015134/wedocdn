/*!
 * LMV v7.47.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.CrossFadeEffects=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=634)}({634:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return h}));var n={DECAL:0,CROSSFADE:1};function i(e){var t=[],r=[!0,!0],i=e,a=new THREE.Color,o=[],s=n.DECAL,d=!0;this.setModelTargetIndex=function(e,t){o[e]=t},this.setSaoHeuristicEnabled=function(e){d=e},this.getRenderSao=function(e){if(!d)return!0;var t=e.modelId&&o[e.modelId];if(void 0===t)return!0;for(var r=t,n=this.getCrossFadeOpacity(t),i=0;i<2;i++){var a=this.getCrossFadeOpacity(i);a>n&&(r=i,n=a)}return r==t},this.setCrossFadeOpacity=function(e,t){var r="crossFadeOpacity"+e;i.uniforms[r].value=t},this.getCrossFadeOpacity=function(e){var t="crossFadeOpacity"+e;return i.uniforms[t].value},this.updateBlendPass=function(e){void 0===e&&(e=t.length);var r="NUM_CROSSFADE_TARGETS",n=e||void 0;i.material.defines[r]!==n&&(e?i.material.defines[r]=n:delete i.material.defines[r],i.material.needsUpdate=!0);for(var a=0;a<e;a++){var o="tCrossFadeTex"+a;i.uniforms[o].value=t[a]}i.material.defines.TARGET_FADE_MODE!==s&&(i.material.defines.TARGET_FADE_MODE=s,i.material.needsUpdate=!0)},this.setFadeMode=function(e){e===n.DECAL||e===n.CROSSFADE?(s=e,this.updateBlendPass()):console.error("Unexpected fade mode enum")},this.clearTarget=function(e){e.setClearColor(a,0);for(var n=0;n<t.length;n++)r[n]&&e.clearTarget(t[n],!0,!0)},this.setClearEnabled=function(e,t){r[e]=t},this.disposeTargets=function(){for(var e=0;e<t.length;e++){var r=t[e];r&&r.dispose(),t[e]=null}},this.dtor=function(){this.disposeTargets(),this.updateBlendPass(),this.setCrossFadeOpacity(0,0),this.setCrossFadeOpacity(1,0)},this.chooseColorTarget=function(e,r){var n=e.modelId&&o[e.modelId];return void 0===n?r:t[n]},this.updateTargets=function(e,r,n,i){for(var a=0;a<2;a++){var o=t[a];!n&&o&&o.width===e&&o.height===r||(o&&o.dispose(),(o=new THREE.WebGLRenderTarget(e,r,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:i?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1})).generateMipmaps=!1,t[a]=o)}},this.beginRenderToFadeTarget=function(e,r){this.updateBlendPass(0);var n=t[e];r.setOffscreenTarget(n),this.setClearEnabled(e,!1)},this.endRenderFadeTarget=function(e){e.setOffscreenTarget(null),this.updateBlendPass()}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return l(this,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i.FadeMode=n;var c=Autodesk.Viewing,f=c.Private,h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(l,e);var t,r,n,a=d(l);function l(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(r=a.call(this,e,t)).crossFade=null,r.clientId=null,r.onClientChanged=null,r}return t=l,(r=[{key:"load",value:function(){return this.setCrossFadeEnabled(!0),!0}},{key:"unload",value:function(){this.setCrossFadeEnabled(!1)}},{key:"acquireControl",value:function(e,t){this.clientId=e,this.onClientChanged&&this.onClientChanged(),this.onClientChanged=t}},{key:"setModelTargetIndex",value:function(e,t){this.crossFade.setModelTargetIndex(e,t),this.viewer.impl.invalidate(!0)}},{key:"setModelTargetIndexForAll",value:function(e){for(var t=this.viewer.getVisibleModels(),r=0;r<t.length;r++){var n=t[r];this.setModelTargetIndex(n.id,e)}}},{key:"setCrossFadeOpacity",value:function(e,t){this.crossFade.setCrossFadeOpacity(e,t),this.viewer.impl.invalidate(!0)}},{key:"getCrossFadeOpacity",value:function(e){return this.crossFade.getCrossFadeOpacity(e)}},{key:"setCrossFadeEnabled",value:function(e){if(e!==Boolean(this.crossFade)){var t=this.viewer.impl.renderer();if(e){var r=t.getBlendPass();this.crossFade=new i(r),t.setCrossFade(this.crossFade)}else this.crossFade.dtor(),t.setCrossFade(null);var n=t.getColorTarget();if(n){var a=this.viewer.impl.glrenderer().getPixelRatio();t.setSize(n.width/a,n.height/a)}}}},{key:"renderFadingImage",value:function(e,t){var r=performance.now();this.viewer.impl.tick(r);var n=this.viewer.impl.renderer();this.crossFade.beginRenderToFadeTarget(e,n),this.viewer.impl.invalidate(!0,!0,!0);var i=this.viewer.impl.targetFrameBudget;t&&(this.viewer.impl.targetFrameBudget=t),r=performance.now(),this.viewer.impl.tick(r),this.targetFrameBudget=i,this.crossFade.endRenderFadeTarget(n)}},{key:"releaseFadingImage",value:function(e){this.setClearEnabled(e,!0)}},{key:"setClearEnabled",value:function(e,t){this.crossFade.setClearEnabled(e,t)}},{key:"fadeTarget",value:function(e,t,r,n,i){var a=this;return f.fadeValue(t,r,n,(function(t){a.setCrossFadeOpacity(e,t)}),i)}},{key:"fadeImage",value:function(e,t,r,n){for(var a=this,o=this.viewer.impl.modelQueue(),s=o.getModels().slice(),d=0;d<s.length;d++){var l=s[d];o.hideModel(l.id)}return this.crossFade.setFadeMode(i.FadeMode.CROSSFADE),f.fadeValue(e,t,r,(function(e){a.setCrossFadeOpacity(0,1-e),a.setCrossFadeOpacity(1,e),a.viewer.impl.renderer().presentBuffer()}),(function(){a.crossFade.setFadeMode(i.FadeMode.CROSSFADE);for(var e=0;e<s.length;e++){var t=s[e];o.showModel(t.id)}n&&n()}))}},{key:"fadeToViewerState",value:function(e,t){var r=this;this.renderFadingImage(0,300),e(),this.renderFadingImage(1,300);var n=this.viewer.impl.renderer(),i=n.getAOEnabled();n.setAOEnabled(!1),this.fadeImage(0,1,t,(function(){r.releaseFadingImage(0),r.releaseFadingImage(1),n.setAOEnabled(i)}))}}])&&o(t.prototype,r),n&&o(t,n),l}(c.Extension);Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CrossFadeEffects",h)}});
//# sourceMappingURL=CrossFadeEffects.min.js.map