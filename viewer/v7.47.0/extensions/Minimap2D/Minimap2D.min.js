/*!
 * LMV v7.47.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Minimap2D=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=612)}({2:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),a=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(a).concat([o]).join("\n")}var r;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var a=this[o][0];"number"==typeof a&&(i[a]=!0)}for(o=0;o<e.length;o++){var r=e[o];"number"==typeof r[0]&&i[r[0]]||(n&&!r[2]?r[2]=n:n&&(r[2]="("+r[2]+") and ("+n+")"),t.push(r))}},t}},3:function(e,t,n){var i,o,a={},r=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=i.apply(this,arguments)),o}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},u=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=s.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),c=null,l=0,h=[],d=n(5);function f(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=a[i.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](i.parts[r]);for(;r<i.parts.length;r++)o.parts.push(b(i.parts[r],t))}else{var s=[];for(r=0;r<i.parts.length;r++)s.push(b(i.parts[r],t));a[i.id]={id:i.id,refs:1,parts:s}}}}function m(e,t){for(var n=[],i={},o=0;o<e.length;o++){var a=e[o],r=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};i[r]?i[r].parts.push(s):n.push(i[r]={id:r,parts:[s]})}return n}function p(e,t){var n=u(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=h[h.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),h.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=u(e.insertAt.before,n);n.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return y(t,e.attrs),p(e,t),t}function y(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function b(e,t){var n,i,o,a;if(t.transform&&e.css){if(!(a="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=a}if(t.singleton){var r=l++;n=c||(c=g(t)),i=k.bind(null,n,r,!1),o=k.bind(null,n,r,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",y(t,e.attrs),p(e,t),t}(t),i=x.bind(null,n,t),o=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=g(t),i=M.bind(null,n),o=function(){v(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=r()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=m(e,t);return f(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var r=n[o];(s=a[r.id]).refs--,i.push(s)}e&&f(m(e,t),t);for(o=0;o<i.length;o++){var s;if(0===(s=i[o]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete a[s.id]}}}};var w,C=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function k(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=C(t,o);else{var a=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(a,r[t]):e.appendChild(a)}}function M(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function x(e,t,n){var i=n.css,o=n.sourceMap,a=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||a)&&(i=d(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var r=new Blob([i],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(r),s&&URL.revokeObjectURL(s)}},5:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,a=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(o=0===a.indexOf("//")?a:0===a.indexOf("/")?n+a:i+a.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},527:function(e,t,n){var i=n(528);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(3)(i,o);i.locals&&(e.exports=i.locals)},528:function(e,t,n){(e.exports=n(2)(!1)).push([e.i,".minimap-canvas-container{position:relative;margin:15px 5px 10px 5px}.minimap-canvas-base{position:absolute;left:0px;top:0px}.minimap-unavailable{color:#dbdbdb;margin:10px;text-align:center}\n",""])},612:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return B}));var i={small:100,medium:200,large:400},o=200,a=300;n(527);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d(e);if(t){var o=d(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=Autodesk.Viewing,m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,Autodesk.Viewing.EventDispatcher);var t,n,o,a=l(r);function r(e,t,n){var o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"large";s(this,r),(o=a.call(this)).minimapSize=i[u];var c=Math.max(t,n);return o.widthFactor=t/c,o.heightFactor=n/c,o._initBackground(),o._initHighlight(),o._initContainer(),o.backgroundImgs=e,o.backgroundImg=new Image,o}return t=r,(n=[{key:"_initContainer",value:function(){var e=this.getDocument();this.canvasContainer=e.createElement("div"),this.canvasContainer.className="minimap-canvas-container",this.canvasContainer.appendChild(this.backgroundCanvas),this.canvasContainer.appendChild(this.highlightCanvas),this._updateCanvasContainerSize()}},{key:"_updateCanvasContainerSize",value:function(){this.canvasContainer.style.width=this.backgroundCanvas.width+"px",this.canvasContainer.style.height=this.backgroundCanvas.height+"px"}},{key:"_initBackground",value:function(){var e=this.getDocument();this.backgroundCanvas=e.createElement("canvas"),this.backgroundCanvas.className="minimap-canvas-base minimap-canvas-background"}},{key:"_initHighlight",value:function(){var e=this.getDocument();this.highlightCanvas=e.createElement("canvas"),this.highlightCanvas.className="minimap-canvas-base minimap-canvas-highlight"}},{key:"setSize",value:function(e){var t=this;return e="string"==typeof e?i[e]:e,new Promise((function(n,o){t.backgroundCanvas.width=t.highlightCanvas.width=Math.round(e*t.widthFactor),t.backgroundCanvas.height=t.highlightCanvas.height=Math.round(e*t.heightFactor),t._updateCanvasContainerSize();var a=Number.MAX_VALUE,r="large";for(var s in i)e<=i[s]&&i[s]<a&&t.backgroundImgs.hasOwnProperty(s)&&(r=s,a=i[s]);t.setBackground(r).then((function(){t.drawBackground(),n()})),t.minimapSize=e}))}},{key:"setBackground",value:function(e){var t=this;return new Promise((function(n,i){t.backgroundImgs.hasOwnProperty(e)?t.backgroundImg.src!==t.backgroundImgs[e]?(t.backgroundImg.onload=function(){t.setBackgroundSourceSize(e),n()},t.backgroundImg.src=t.backgroundImgs[e]):n():i("thumbnail size not found")}))}},{key:"setBackgroundSourceSize",value:function(e){var t=i[e];this.backgroundWidth=Math.round(t*this.widthFactor),this.backgroundHeight=Math.round(t*this.heightFactor),this.backgroundOffsetX=(t-this.backgroundWidth)/2,this.backgroundOffsetY=(t-this.backgroundHeight)/2}},{key:"drawBackground",value:function(){var e=this.backgroundCanvas.getContext("2d");e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e.drawImage(this.backgroundImg,this.backgroundOffsetX,this.backgroundOffsetY,this.backgroundWidth,this.backgroundHeight,0,0,this.backgroundCanvas.width,this.backgroundCanvas.height)}},{key:"drawHighlight",value:function(e,t){var n={x:Math.round(e.x),y:Math.round(t.y)},i=Math.round(Math.max(t.x-e.x,2)),o=Math.round(Math.max(e.y-t.y,2)),a=this.highlightCanvas.getContext("2d");a.clearRect(0,0,this.highlightCanvas.width,this.highlightCanvas.height),a.beginPath(),a.lineWidth="2",a.strokeStyle="#CC3B3B",a.fillStyle="rgba(204, 59, 59, 0.2)",a.rect(n.x,n.y,i,o),a.fill(),a.stroke()}},{key:"setVisibility",value:function(e){this.backgroundCanvas.style.visibility=e?"visible":"hidden",this.highlightCanvas.style.visibility=e?"visible":"hidden"}},{key:"addListenerToCanvas",value:function(e,t){this.highlightCanvas.addEventListener(e,t)}},{key:"removeListenerFromCanvas",value:function(e,t){this.highlightCanvas.removeEventListener(e,t)}},{key:"getBoundingClientRect",value:function(){return this.highlightCanvas.getBoundingClientRect()}},{key:"unload",value:function(){var e=this.getWindow(),t=e.URL||e.webkitURL;for(var n in this.backgroundImg=null,this.backgroundImgs)t.revokeObjectURL(this.backgroundImgs[n])}},{key:"width",get:function(){return this.highlightCanvas.width}},{key:"height",get:function(){return this.highlightCanvas.height}}])&&u(t.prototype,n),o&&u(t,o),r}();function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g(e,t,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=C(e);if(t){var o=C(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return w(this,n)}}function w(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}f.GlobalManagerMixin.call(m.prototype);var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,Autodesk.Viewing.UI.DockingPanel);var t,n,i,o=b(a);function a(e,t,n,i){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e,"MinimapPanel","Minimap",i)).container.style.left=t+"px",r.container.style.top=n+"px",r.container.classList.add("docking-panel-container-solid-color-b"),r.fadeIn="opacity 0.5s",r.fadeOut="opacity 0.1s",r.container.addEventListener("transitionend",(function(e){"0"===r.container.style.opacity&&(r.container.style.display="none")})),r}return t=a,(n=[{key:"_addNoMinimapElem",value:function(){var e=this.getDocument();this.noMinimapDiv=e.createElement("div"),this.noMinimapDiv.innerHTML=Autodesk.Viewing.i18n.translate("Minimap not available"),this.noMinimapDiv.className="minimap-unavailable",this.container.appendChild(this.noMinimapDiv)}},{key:"_removeNoMinimapElem",value:function(){this.container.contains(this.noMinimapDiv)&&this.container.removeChild(this.noMinimapDiv)}},{key:"initialize",value:function(){g(C(a.prototype),"initialize",this).call(this),this._addNoMinimapElem()}},{key:"appendElement",value:function(e){this._removeNoMinimapElem(),this.container.appendChild(e)}},{key:"addListenerToCloseButton",value:function(e){this.addEventListener(this.closer,"click",e,!1)}},{key:"_triggerReflow",value:function(){return this.container.offsetWidth}},{key:"_isVisible",value:function(){return"block"===this.container.style.display}},{key:"setVisible",value:function(e,t){t?this.setVisibleWithTransition(e):(this.container.style.display=e?"block":"none",this.container.style.opacity=e?"1":"0")}},{key:"setVisibleWithTransition",value:function(e){if(e){var t=this._isVisible();this.container.style.transition=this.fadeIn,this.container.style.display="block",t||(this.container.style.opacity="0",this._triggerReflow()),this.container.style.opacity="1"}else this.container.style.transition=this.fadeOut,this.container.style.opacity="0"}}])&&v(t.prototype,n),i&&v(t,i),a}(),M={isThumbnailValid:function(e){return M.getPredominantColorPercentage(e)<M.MAX_PREDOMINANT_COLOR_PERCENTAGE},getPredominantColorPercentage:function(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height).data,n={},i=0,o=t.length;i<o;i+=4){var a=M.rgba2hex(t[i],t[i+1],t[i+2],t[i+3]);n[a]=n.hasOwnProperty(a)?n[a]+1:1}return Object.keys(n).reduce((function(e,t){return n[t]>e?n[t]:e}),0)/(t.length/4)},rgba2hex:function(e,t,n,i){if(e>255||t>255||n>255||i>255)throw"Invalid color component";return(256+e).toString(16).substr(1)+((1<<24)+(t<<16)|n<<8|i).toString(16).substr(1)},MAX_PREDOMINANT_COLOR_PERCENTAGE:.97},x=M;function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t,n,i,o,a,r){try{var s=e[a](r),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,o)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function r(e){S(a,i,o,r,s,"next",e)}function s(e){S(a,i,o,r,s,"throw",e)}r(void 0)}))}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=I(e);if(t){var o=I(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return D(this,n)}}function D(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?R(e):t}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=AutodeskNamespace("Autodesk.BIM360.Minimap"),B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(l,Autodesk.Viewing.Extension);var t,n,r,s,u,c=T(l);function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _(this,l),(t=c.call(this,e,n))._isEnabled=!1,t.isMobile=Autodesk.Viewing.isMobileDevice(),t.initialSize=t.options.initialSize||null,t.wasInit=!1,t.onMouseDown=t.onMouseDown.bind(R(t)),t.onMouseMove=t.onMouseMove.bind(R(t)),t.onMouseUp=t.onMouseUp.bind(R(t)),t.onMouseLeave=t.onMouseLeave.bind(R(t)),t.onMouseWheel=t.onMouseWheel.bind(R(t)),t.onCameraChange=t.onCameraChange.bind(R(t),!0),t.update=t.update.bind(R(t)),t.onCloseButton=t.onCloseButton.bind(R(t)),t.setEnabled=t.setEnabled.bind(R(t)),t.updateSettingsPanel=t.updateSettingsPanel.bind(R(t)),t}return t=l,(n=[{key:"setEnabled",value:(u=O(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}if(this.wasInit){e.next=4;break}return e.next=4,this.init();case 4:this._isEnabled=!0,this.onCameraChange(!1),e.next=10;break;case 8:this._isEnabled=!1,this._setVisibility(!1,!1);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"findAndSetSuitableModel",value:function(){var e=this.viewer.impl.modelQueue().getModels();if(1===e.length&&e[0].is2d()){var t=e[0],n=t.getDocumentNode(),i=n&&n.getDocument();if(i)return this.model=t,this.node=n,this.document=i,!0}return!1}},{key:"createPanel",value:function(){this.panel||(this.panel=new k(this.viewer.container,10,10,{isMobile:this.isMobile,addFooter:!1}),this.panel.setGlobalManager(this.globalManager))}},{key:"createMinimapCanvas",value:function(){this.minimapCanvas?this.minimapCanvas.backgroundImgs=this.backgroundImgs:(this.minimapCanvas=new m(this.backgroundImgs||{},this.modelWidth,this.modelHeight),this.minimapCanvas.setGlobalManager(this.globalManager))}},{key:"setBoundariesFromModel",value:function(){this.modelBBox=this.model.getBoundingBox().clone(),this.modelStartPoint=this.modelBBox.min,this.modelWidth=this.modelBBox.max.x-this.modelBBox.min.x,this.modelHeight=this.modelBBox.max.y-this.modelBBox.min.y,this.epsX=.02*this.modelWidth,this.epsY=.02*this.modelHeight}},{key:"init",value:(s=O(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mouseDown=!1,this.mouseDownPos={x:null,y:null},this.isTransitionInactive=!0,this.model){e.next=5;break}return e.abrupt("return");case 5:return this.createPanel(),this.setBoundariesFromModel(),this.wasInit=!0,t=this.model,e.prev=9,e.next=12,this.prefetchThumbnails(["large"]);case 12:if(t===this.model){e.next=14;break}throw new Error("loadCanceled");case 14:return this.createMinimapCanvas(),e.next=17,this.minimapCanvas.setSize(this.getInitialSize());case 17:if(t===this.model){e.next=19;break}throw new Error("loadCanceled");case 19:n=this.model.getData(),this.model.isLeaflet()||"rvt"===n.loadOptions.fileExt||x.isThumbnailValid(this.minimapCanvas.backgroundCanvas)?this.panel.appendElement(this.minimapCanvas.canvasContainer):console.error("Invalid thumbnail!"),this.addListeners(),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(9),console.info("Minimap error: ",e.t0.message),this.minimapCanvas||"loadCanceled"===e.t0.message||(this.createMinimapCanvas(),this.addListeners());case 29:case"end":return e.stop()}}),e,this,[[9,25]])}))),function(){return s.apply(this,arguments)})},{key:"getInitialSize",value:function(){return null!==this.initialSize?Math.min(Math.max(this.initialSize,100),400):this.isMobile?o:a}},{key:"setSize",value:function(e){this.minimapCanvas?(e=Math.min(Math.max(e,100),400),this.minimapCanvas.setSize(e)):this.initialSize=e}},{key:"prefetchThumbnails",value:function(e){var t=this;this.backgroundImgs={};var n=e.map((function(e){return function(e,t,n,o){return new Promise((function(a,r){var s="string"==typeof n?i[n]:n,u=e.getThumbnailOptions(t.data,s,s);Autodesk.Viewing.Document.requestThumbnailWithSecurity(u,(function(e,t){if(e)r("Error requesting thumbnail");else{var i=window.URL||window.webkitURL;o[n]=i.createObjectURL(t),a()}}))}))}(t.document,t.node,e,t.backgroundImgs)}));return Promise.all(n)}},{key:"_isTouch",value:function(){return Autodesk.Viewing.isTouchDevice()}},{key:"addListeners",value:function(){this._isTouch()&&(this.minimapCanvas.addListenerToCanvas("touchstart",this.onMouseDown),this.minimapCanvas.addListenerToCanvas("touchmove",this.onMouseMove),this.minimapCanvas.addListenerToCanvas("touchend",this.onMouseUp)),this.isMobile||(this.minimapCanvas.addListenerToCanvas("mousedown",this.onMouseDown),this.minimapCanvas.addListenerToCanvas("mousemove",this.onMouseMove),this.minimapCanvas.addListenerToCanvas("mouseup",this.onMouseUp),this.minimapCanvas.addListenerToCanvas("mouseleave",this.onMouseLeave),this.minimapCanvas.addListenerToCanvas("mousewheel",this.onMouseWheel),this.minimapCanvas.addListenerToCanvas("DOMMouseScroll",this.onMouseWheel)),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.panel.addListenerToCloseButton(this.onCloseButton)}},{key:"onCloseButton",value:function(){this.viewer.prefs.set("showMinimap2D",!1),this.setEnabled(!1)}},{key:"getCursorPositionOnCanvas",value:function(e){var t=this.minimapCanvas.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}},{key:"onMouseDown",value:function(e){"touchstart"===e.type&&(e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY),this.mouseDown=!0,this.mouseDownPos.x=e.clientX,this.mouseDownPos.y=e.clientY,this.onMinimapClicked(e,!1),this.isTransitionInactive=!1}},{key:"onMouseMove",value:function(e){this.mouseDown&&("touchmove"===e.type&&(e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY),(this.isTransitionInactive||Math.abs(this.mouseDownPos.x-e.clientX)>5||Math.abs(this.mouseDownPos.y-e.clientY)>5)&&(void 0!==this.viewer.autocam.elapsedTime&&(this.viewer.autocam.elapsedTime=this.viewer.autocam.shotParams.duration,this.isTransitionInactive=!0),this.onMinimapClicked(e,!0)))}},{key:"onMouseWheel",value:function(e){this.viewer.toolController.mousewheel(e)}},{key:"onMouseUp",value:function(){this.resetMove()}},{key:"onMouseLeave",value:function(){this.resetMove()}},{key:"resetMove",value:function(){this.mouseDown=!1,this.mouseDownPos.x=null,this.mouseDownPos.y=null}},{key:"onMinimapClicked",value:function(e,t){var n=this.minimapToModelCoords(this.getCursorPositionOnCanvas(e)),i=this.viewer.navigation.getTarget(),o=this.viewer.navigation.getPosition(),a=i.clone().sub(o),r=new THREE.Vector3(n.x,n.y,o.z),s=r.clone().add(a);t?this.viewer.navigation.setView(r,s):this.viewer.navigation.setRequestTransitionWithUp(!0,r,s,this.viewer.impl.camera.fov,this.viewer.impl.camera.up),this.viewer.navigation.setPivotPoint(s),this.viewer.navigation.setPivotSetFlag(!0)}},{key:"highlightCurrentArea",value:function(e,t){this.minimapCanvas.drawHighlight(e,t)}},{key:"modelToMinimapCoords",value:function(e){return{x:(e.x-this.modelStartPoint.x)*this.minimapCanvas.width/this.modelWidth,y:-(e.y-this.modelStartPoint.y-this.modelHeight)*this.minimapCanvas.height/this.modelHeight}}},{key:"minimapToModelCoords",value:function(e){return{x:e.x*this.modelWidth/this.minimapCanvas.width+this.modelStartPoint.x,y:-e.y*this.modelHeight/this.minimapCanvas.height+this.modelHeight+this.modelStartPoint.y}}},{key:"_setVisibility",value:function(e,t){this.panel&&this.panel.setVisible(this._isEnabled&&e,t)}},{key:"getViewableArea",value:function(){var e=this.modelBBox.clone(),t=this.viewer.impl.camera.left+this.viewer.impl.camera.position.x,n=this.viewer.impl.camera.right+this.viewer.impl.camera.position.x,i=this.viewer.impl.camera.bottom+this.viewer.impl.camera.position.y,o=this.viewer.impl.camera.top+this.viewer.impl.camera.position.y;return t>e.min.x+this.epsX&&(e.min.x=t),n<e.max.x-this.epsX&&(e.max.x=n),i>e.min.y+this.epsY&&(e.min.y=i),o<e.max.y-this.epsY&&(e.max.y=o),e}},{key:"updateSettingsPanel",value:function(){var e=this.viewer.getSettingsPanel&&this.viewer.getSettingsPanel();if(e&&!e.is3dMode&&!e.minimapSettingsCheckboxId){var t=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation;e.minimapSettingsLabel=e.addLabel(t,"Minimap"),e.minimapSettingsCheckboxId=e.addCheckbox(t,"Show minimap","Toggles availability of the Minimap",!0,this.setEnabled,"showMinimap2D")}}},{key:"load",value:function(){return this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.update),this.viewer.addEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.update),this.viewer.addEventListener(Autodesk.Viewing.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel),this.viewer.prefs.add("showMinimap2D",!0,"2d"),this.updateSettingsPanel(),this.update(),!0}},{key:"unload",value:function(){return this.minimapCanvas&&(this._isTouch()&&(this.minimapCanvas.removeListenerFromCanvas("touchstart",this.onMouseDown),this.minimapCanvas.removeListenerFromCanvas("touchmove",this.onMouseMove),this.minimapCanvas.removeListenerFromCanvas("touchend",this.onMouseUp)),this.isMobile||(this.minimapCanvas.removeListenerFromCanvas("mousedown",this.onMouseDown),this.minimapCanvas.removeListenerFromCanvas("mousemove",this.onMouseMove),this.minimapCanvas.removeListenerFromCanvas("mouseup",this.onMouseUp),this.minimapCanvas.removeListenerFromCanvas("mouseleave",this.onMouseLeave),this.minimapCanvas.removeListenerFromCanvas("mousewheel",this.onMouseWheel),this.minimapCanvas.removeListenerFromCanvas("DOMMouseScroll",this.onMouseWheel)),this.minimapCanvas.unload(),this.minimapCanvas=null),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.update),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.update),this.viewer.removeEventListener(Autodesk.Viewing.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel),this.destroyUI(),this.model=null,this.document=null,this.node=null,!0}},{key:"update",value:function(){this.wasInit=!1,this.findAndSetSuitableModel()?this.setEnabled(this.viewer.prefs&&this.viewer.prefs.get("showMinimap2D")):this.setEnabled(!1)}},{key:"onCameraChange",value:function(e){var t=this.getViewableArea(),n=!t.equals(this.modelBBox);this._setVisibility(n,e),n&&this.minimapCanvas&&this.highlightCurrentArea(this.modelToMinimapCoords(t.min),this.modelToMinimapCoords(t.max))}},{key:"destroyUI",value:function(){var e=this.viewer.getSettingsPanel&&this.viewer.getSettingsPanel();e&&e.minimapSettingsCheckboxId&&(this.viewer.viewerSettingsPanel.removeCheckbox(e.minimapSettingsCheckboxId),this.viewer.viewerSettingsPanel.removeControl(e.minimapSettingsLabel),e.minimapSettingsLabel=null,e.minimapSettingsCheckboxId=null),this.panel&&(this.panel.uninitialize(),this.panel=null)}}])&&L(t.prototype,n),r&&L(t,r),l}();A.MinimapExtension=B,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.BIM360.Minimap",B)}});
//# sourceMappingURL=Minimap2D.min.js.map