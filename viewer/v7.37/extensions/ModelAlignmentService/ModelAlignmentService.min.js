/*!
 * LMV v7.37.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.ModelAlignmentService=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=663)}({12:function(e,t,n){var r=n(41),o=n(42),i=o;i.v1=r,i.v4=o,e.exports=i},23:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},24:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},41:function(e,t,n){var r,o,i=n(23),a=n(24),u=0,s=0;e.exports=function(e,t,n){var c=t&&n||0,f=t||[],l=(e=e||{}).node||r,p=void 0!==e.clockseq?e.clockseq:o;if(null==l||null==p){var v=i();null==l&&(l=r=[1|v[0],v[1],v[2],v[3],v[4],v[5]]),null==p&&(p=o=16383&(v[6]<<8|v[7]))}var h=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:s+1,d=h-u+(m-s)/1e4;if(d<0&&void 0===e.clockseq&&(p=p+1&16383),(d<0||h>u)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=h,s=m,o=p;var g=(1e4*(268435455&(h+=122192928e5))+m)%4294967296;f[c++]=g>>>24&255,f[c++]=g>>>16&255,f[c++]=g>>>8&255,f[c++]=255&g;var y=h/4294967296*1e4&268435455;f[c++]=y>>>8&255,f[c++]=255&y,f[c++]=y>>>24&15|16,f[c++]=y>>>16&255,f[c++]=p>>>8|128,f[c++]=255&p;for(var w=0;w<6;++w)f[c+w]=l[w];return t||a(f)}},42:function(e,t,n){var r=n(23),o=n(24);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var u=0;u<16;++u)t[i+u]=a[u];return t||o(a)}},663:function(e,t,n){"use strict";function r(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function u(e){r(a,o,i,u,s,"next",e)}function s(e){r(a,o,i,u,s,"throw",e)}u(void 0)}))}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"default",(function(){return Oe}));var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r,a,u,s,c,f,l,p,v,h,m,d;return t=e,(n=[{key:"isWorking",value:function(){return!0}},{key:"clearCache",value:function(){}},{key:"fetchItems",value:(d=o(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"loadTransform",value:(m=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"getTransform",value:function(e,t){return null}},{key:"getIsLocked",value:function(e,t){return!1}},{key:"saveTransform",value:(h=o(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t,n){return h.apply(this,arguments)})},{key:"lockAlignment",value:(v=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return v.apply(this,arguments)})},{key:"unlockAlignment",value:(p=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return p.apply(this,arguments)})},{key:"isAlignmentLocked",value:(l=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return l.apply(this,arguments)})},{key:"saveViewport",value:(f=o(regeneratorRuntime.mark((function e(t,n,r,o,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t,n,r,o){return f.apply(this,arguments)})},{key:"loadViewport",value:(c=o(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"loadViewports",value:(s=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"saveRelationship",value:(u=o(regeneratorRuntime.mark((function e(t,n,r,o,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t,n,r,o){return u.apply(this,arguments)})},{key:"getRelationships",value:(a=o(regeneratorRuntime.mark((function e(t,n,r,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return a.apply(this,arguments)})}])&&i(t.prototype,n),r&&i(t,r),e}(),u=n(12);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){c(i,r,o,a,u,"next",e)}function u(e){c(i,r,o,a,u,"throw",e)}a(void 0)}))}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g(e);if(t){var o=g(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=Autodesk.Viewing.Private,w="Autodesk.Viewing.ModelAlignment",b="transform",k="relationship",x="viewpart3d",R="viewpartregion2d",I=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"".concat(w).concat("__").concat(e).concat("__").concat(t).concat(n.length?"".concat("__").concat(n):"")},P=function(e){return{transform:e?e.elements:null,isLocked:!1}},A=function(e,t,n){return"lineageUrn=".concat(e,"&viewablePart=").concat(t).concat(n?"&region=".concat(n):"")},O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(g,e);var t,n,r,o,i,a,s,c,p,d=m(g);function g(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.LocalStorage;return l(this,g),(e=d.call(this)).localStorage=t,e}return v(g,[{key:"getTransform",value:function(e,t){var n=this.loadItem(b,e,t);return(null==n?void 0:n.transform)||null}},{key:"getIsLocked",value:function(e,t){var n=this.loadItem(b,e,t);return Boolean(null==n?void 0:n.isLocked)}},{key:"loadTransform",value:(p=f(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.loadItem(b,t,n),e.abrupt("return",null==r?void 0:r.transform);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"saveTransform",value:(c=f(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o=this.loadItem(b,t,n)||P()).transform=r,this.saveItem(b,t,n,o);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"lockAlignment",value:(s=f(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=this.loadItem(b,t,n)||P()).isLocked=!0,this.saveItem(b,t,n,r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"isAlignmentLocked",value:(a=f(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getIsLocked(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"saveViewport",value:(i=f(regeneratorRuntime.mark((function e(t,n,r,o,i){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=this.loadItem(b,t,n)||P()).regions||(a.regions=[]),-1===(u=a.regions.findIndex((function(e){return e.regionId===r})))&&(u=a.regions.length),a.regions[u]={regionId:r,boundingBox:o,transform:i},this.saveItem(b,t,n,a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return i.apply(this,arguments)})},{key:"loadViewport",value:(o=f(regeneratorRuntime.mark((function e(t,n,r){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.loadViewports(t,n),i=o.find((function(e){return e.regionId===r}))){e.next=4;break}return e.abrupt("return",null);case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"loadViewports",value:(r=f(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.loadItem(b,t,n),o=null==r?void 0:r.regions,e.abrupt("return",o||[]);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"saveRelationship",value:(n=f(regeneratorRuntime.mark((function e(t,n,r,o,i){var a,s,c,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=A(r,o,i),s=A(t,n),c=Object(u.v4)(),f={id:c,entities:[{domain:"autodesk-construction-alignment",type:R,id:a},{domain:"autodesk-construction-alignment",type:x,id:s}]},this.saveItem(k,c,void 0,f);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r,o,i){return n.apply(this,arguments)})},{key:"getRelationships",value:(t=f(regeneratorRuntime.mark((function e(t,n,r,o){var i,a,u,s,c,f,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],a=A(n,r,o),u=y.LocalStorage.getAllKeys(),s=0;s<u.length;s++)-1!==(c=u[s]).indexOf(k)&&(l=y.LocalStorage.getItem(c),(null==(p=l&&JSON.parse(l))||null===(f=p.entities)||void 0===f?void 0:f.some((function(e){return e.id===a&&e.type===t})))&&i.push(p));return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),function(e,n,r,o){return t.apply(this,arguments)})},{key:"loadItem",value:function(e,t,n){var r=I(e,t,n),o=this.localStorage.getItem(r),i=o&&JSON.parse(o);return(null==i?void 0:i.transform)&&(i.transform=new y.LmvMatrix4(!0).fromArray(i.transform)),(null==i?void 0:i.regions)&&(i.regions=i.regions.map((function(e){return e.transform&&(e.transform=new y.LmvMatrix4(!0).fromArray(e.transform)),e.boundingBox=(new THREE.Box2).set({x:e.boundingBox[0],y:e.boundingBox[1]},{x:e.boundingBox[2],y:e.boundingBox[3]}),e}))),i}},{key:"saveItem",value:function(e,t,n,r){var o,i;(null===(o=r)||void 0===o?void 0:o.transform)&&((r=Object.assign({},r)).transform=Array.from(r.transform.elements)),(null===(i=r)||void 0===i?void 0:i.regions)&&((r=Object.assign({},r)).regions=r.regions.map((function(e){var t=Object.assign({},e);return t.transform&&(t.transform=Array.from(t.transform.elements)),t.boundingBox=[t.boundingBox.min.x,t.boundingBox.min.y,t.boundingBox.max.x,t.boundingBox.max.y],t})));var a=I(e,t,n),u=JSON.stringify(r);this.localStorage.setItem(a,u)}}]),g}(a),S=function(){function e(){l(this,e),this.data={}}return v(e,[{key:"setItem",value:function(e,t){this.data[e]=t}},{key:"getItem",value:function(e){return this.data[e]}}]),e}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}a.ObjectLocalStorage=S;var E=Autodesk.Viewing.Private,j=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t)}var t,n,r;return t=e,(n=[{key:"init",value:function(e){this.checksum=void 0,this.transform=null,this.isLocked=!1,this.updatedAt=void 0,this.updatedBy=void 0,this.versionUrn=null==e?void 0:e.versionUrn,this.viewablePartId=null==e?void 0:e.viewablePartId,this.regions=void 0}},{key:"isDefaultState",value:function(){return!this.transform&&!this.isLocked&&!this.regions}},{key:"resetToDefaultState",value:function(){this.transform=null,this.isLocked=!1,this.regions=null}},{key:"createNew",value:function(e,t){return this.init(),this.versionUrn=e.versionUrn,this.viewablePartId=e.viewablePartId,this.transform=t,this}},{key:"load",value:function(e){return this.versionUrn=E.toUrlSafeBase64(e.versionUrn),this.viewablePartId=e.viewablePartId,e.regions&&(this.regions=e.regions.map((function(e){return e.transform&&(e.transform=new E.LmvMatrix4(!0).fromArray(e.transform)),e.boundingBox=(new THREE.Box2).set({x:e.boundingBox[0],y:e.boundingBox[1]},{x:e.boundingBox[2],y:e.boundingBox[3]}),e}))),this.checksum=e.checksum,this.isLocked=e.isLocked||!1,this.updatedAt=e.updatedAt,this.updatedBy=e.updatedBy,this.transform=Array.isArray(null==e?void 0:e.transform)?new E.LmvMatrix4(!0).fromArray(null==e?void 0:e.transform):null,this}},{key:"existsOnServer",value:function(){return Boolean(this.checksum)}},{key:"toObject",value:function(){return{checksum:this.checksum,isLocked:this.isLocked,transform:this.transform&&Array.from(this.transform.elements),regions:this.regions?this.regions.map((function(e){var t=Object.assign({},e);return t.transform&&(t.transform=Array.from(t.transform.elements)),t.boundingBox=[t.boundingBox.min.x,t.boundingBox.min.y,t.boundingBox.max.x,t.boundingBox.max.y],t})):void 0,versionUrn:E.fromUrlSafeBase64(this.versionUrn),viewablePartId:this.viewablePartId}}}])&&T(t.prototype,n),r&&T(t,r),e}();function _(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function B(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){_(i,r,o,a,u,"next",e)}function u(e){_(i,r,o,a,u,"throw",e)}a(void 0)}))}}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._fetchItems=t,this.cache={},this.urnToRequestIndex={},this.pendingRequests=[null]}var t,n,r,o,i;return t=e,(n=[{key:"clear",value:function(){this.cache={}}},{key:"fetchItems",value:(i=B(regeneratorRuntime.mark((function e(t){var n,r,o,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){return!a.cache[e.toString()]},(t=t.filter(n)).length){e.next=4;break}return e.abrupt("return");case 4:for(r=1;this.pendingRequests[r];)r++;return t.forEach((function(e){return a.urnToRequestIndex[e.toString()]=r})),o=this._fetchItems(t),this.pendingRequests[r]=o,e.next=11,o;case 11:i=e.sent,this.pendingRequests[r]=null,i&&t.forEach((function(e){var t=e.toString();a.cache[t]=i[t]})),t.forEach((function(e){delete a.urnToRequestIndex[e.toString()]}));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getCachedItem",value:function(e){var t=e.toString();return this.cache[t]}},{key:"getItem",value:(o=B(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.getCachedItem(t))){e.next=3;break}return e.abrupt("return",n);case 3:if(r=t.toString(),!(o=this.urnToRequestIndex[r])){e.next=10;break}return e.next=8,this.pendingRequests[o];case 8:e.next=12;break;case 10:return e.next=12,this.fetchItems([t]);case 12:return e.abrupt("return",this.getCachedItem(t));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"setItem",value:function(e,t){var n=e.toString();this.cache[n]=t}}])&&L(t.prototype,n),r&&L(t,r),e}();function C(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function q(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){C(i,r,o,a,u,"next",e)}function u(e){C(i,r,o,a,u,"throw",e)}a(void 0)}))}}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.maxAttempts=10,this.startDelay=100,this.growFactor=1.1}var t,n,r;return t=e,(n=[{key:"getWaitingTime",value:function(e){return e?this.startDelay*Math.pow(this.growFactor,e-1):0}},{key:"run",value:function(e,t){var n=this;return new Promise((function(r){var o=0,i=function(){var a=q(regeneratorRuntime.mark((function a(){var u,s;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e();case 2:if(u=a.sent,!t(u)){a.next=5;break}return a.abrupt("return",r(u));case 5:if(!(++o>=n.maxAttempts)){a.next=8;break}return a.abrupt("return",r(u));case 8:s=n.getWaitingTime(o),window.setTimeout(i,s);case 10:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();i()}))}}])&&V(t.prototype,n),r&&V(t,r),e}(),D=function(){var e=q(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.length>3&&void 0!==u[3]?u[3]:null,i={success:!1,data:null},e.next=4,t();case 4:return a=e.sent,e.next=7,new Promise((function(e){var t=new XMLHttpRequest;t.open(r,n,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("accept","application/json"),t.setRequestHeader("Access-Control-Allow-Origin","*"),t.setRequestHeader("Authorization","Bearer "+a);var u=function(){e(i)};t.onload=function(){if(t.status<200||t.status>=300)u();else try{i.data=t.response?JSON.parse(t.response):null,i.success=!0,e(i)}catch(e){u()}},t.onerror=u,t.ontimeout=u,t.onabort=u,t.send(o&&JSON.stringify(o))}));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),N=function(){var e=q(regeneratorRuntime.mark((function e(t,n,r,o){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(){return D(t,n,r,o)},a=function(e){return e.success},e.next=4,(new M).run(i,a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}();function H(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){H(i,r,o,a,u,"next",e)}function u(e){H(i,r,o,a,u,"throw",e)}a(void 0)}))}}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n){return t&&F(e.prototype,t),n&&F(e,n),e}var G=Autodesk.Viewing,K=G.Private,Q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;W(this,e),this.versionUrn=t,this.viewablePartId=n}return z(e,[{key:"toObject",value:function(){return{versionUrn:K.fromUrlSafeBase64(this.versionUrn),viewablePartId:this.viewablePartId||void 0}}},{key:"toString",value:function(){return"".concat(this.versionUrn).concat(this.viewablePartId?"__".concat(this.viewablePartId):"")}}],[{key:"fromUrns",value:function(t){return t&&t.map((function(t){return new e(t)}))}}]),e}(),X=function(e){var t=G.EnvironmentConfigurations[G.getEnv()];return(t.UPSTREAM||t.ROOT)+"/construction/alignment"+("QA"===e?"-dev":"")},Y=function(){return G.token.accessToken},Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.projectId,r=t.getAccessToken,o=void 0===r?Y:r,i=t.docsEnv,a=void 0===i?"":i,u=t.serviceBaseUrl,s=void 0===u?X(a):u,c=t.serviceVersion,f=void 0===c?"v1":c,l=t.onError,p=void 0===l?null:l;W(this,e),this.projectId=n,this.getAccessToken=o,this.onError=p,this.serviceUrl="".concat(s,"/").concat(f),this.itemsEndPoint="/projects/".concat(n,"/spaces/").concat("default","/items"),this.url=this.serviceUrl+this.itemsEndPoint}var t,n,r,o;return z(e,[{key:"fetchItems",value:(o=J(regeneratorRuntime.mark((function e(t){var n,r,o,i,a,u,s,c,f,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},t.length){e.next=3;break}return e.abrupt("return",n);case 3:for(r={},o=0;o<t.length;o++)r[o]=t[o].toObject();return e.next=8,N(this.getAccessToken,this.url+":getBatch","POST",r);case 8:if((i=e.sent).success){e.next=12;break}return this.onError(),e.abrupt("return");case 12:if(a=i.data){e.next=16;break}return console.warn("Unepxected request response: items:getBatch should get an empty response"),e.abrupt("return");case 16:for(u=a.results,s=0;s<t.length;s++)c=new Q(t[s].versionUrn,t[s].viewablePartId),f=c.toString(),l=u&&u[s],n[f]=l?(new j).load(l):new j(c);return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"saveItem",value:(r=J(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.toObject(),r=t.existsOnServer()?"PATCH":"POST",e.next=4,N(this.getAccessToken,this.url,r,n);case 4:if((o=e.sent).success){e.next=8;break}return this.onError(),e.abrupt("return");case 8:o.data?t.load(o.data):(t.checksum=void 0,"DELETE"==r||console.warn("Unexpected request result: POST or PATCH should always respond an update item state"));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"deleteItem",value:(n=J(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.toObject(),e.next=3,N(this.getAccessToken,this.url,"DELETE",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setItemLocked",value:(t=J(regeneratorRuntime.mark((function e(t,n){var r,o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.toObject(),o={versionUrn:r.versionUrn,viewablePartId:r.viewablePartId},i=n?":lock":":unlock",e.next=5,N(this.getAccessToken,this.url+i,"PATCH",o);case 5:if((a=e.sent).success){e.next=9;break}return this.onError(),e.abrupt("return");case 9:t.load(a.data);case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();function $(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function ee(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){$(i,r,o,a,u,"next",e)}function u(e){$(i,r,o,a,u,"throw",e)}a(void 0)}))}}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var re=Autodesk.Viewing,oe=(re.Private,function(){var e=re.EnvironmentConfigurations[re.getEnv()];return(e.UPSTREAM||e.ROOT)+"/bim360/relationship"}),ie=function(){return re.token.accessToken},ae=function(e,t,n){return"lineageUrn=".concat(e,"&viewablePart=").concat(t).concat(n?"&region=".concat(n):"")},ue="autodesk-construction-alignment",se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.projectId,r=t.getAccessToken,o=void 0===r?ie:r,i=t.serviceBaseUrl,a=void 0===i?oe():i,u=t.serviceVersion,s=void 0===u?"v2":u,c=t.onError,f=void 0===c?null:c;te(this,e),this.projectId=n,this.getAccessToken=o,this.onError=f,this.serviceUrl="".concat(a,"/").concat(s),this.itemsEndPoint="/containers/".concat(n,"/relationships"),this.url=this.serviceUrl+this.itemsEndPoint}var t,n,r,o,i;return t=e,(n=[{key:"loadItem",value:(i=ee(regeneratorRuntime.mark((function e(t,n,r,o){var i,a,u,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=ae(n,r,o),a=":search?domain=".concat(ue,"&type=").concat(t,"&id=").concat(i),e.next=4,N(this.getAccessToken,this.url+a,"GET");case 4:if((u=e.sent).success){e.next=8;break}return this.onError(),e.abrupt("return");case 8:if(s=u.data){e.next=12;break}return console.warn("Unepxected request response: relationships:search should get an empty response"),e.abrupt("return");case 12:return c=s.results,e.abrupt("return",c);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"saveItem",value:(o=ee(regeneratorRuntime.mark((function e(t,n,r,o,i){var a,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=ae(r,o,i),u=ae(t,n),s=[{entities:[{domain:ue,type:"viewpartregion2d",id:a},{domain:ue,type:"viewpart3d",id:u}]}],e.next=6,N(this.getAccessToken,this.url,"PUT",s);case 6:if(e.sent.success){e.next=10;break}return this.onError(),e.abrupt("return");case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return o.apply(this,arguments)})}])&&ne(t.prototype,n),r&&ne(t,r),e}();function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function le(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){fe(i,r,o,a,u,"next",e)}function u(e){fe(i,r,o,a,u,"throw",e)}a(void 0)}))}}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ye(e);if(t){var o=ye(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return de(this,n)}}function de(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?ge(e):t}function ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}(d,e);var t,n,r,o,i,a,u,s,c,f,l,p,v,h,m=me(d);function d(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};pe(this,d);var n=(e=m.call(this)).onError.bind(ge(e));t.onError=n,e.alignmentApi=new Z(t),e.relationshipApi=new se(t);var r=function(){var t=le(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.alignmentApi.fetchItems(n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return e.cache=new U(r),e}return t=d,(n=[{key:"fetchItems",value:(h=le(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Q.fromUrns(t),e.next=3,this.cache.fetchItems(n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getTransform",value:function(e,t){var n=new Q(e,t),r=this.cache.getCachedItem(n);return r&&(r.transform||null)}},{key:"getIsLocked",value:function(e,t){var n=new Q(e,t),r=this.cache.getCachedItem(n);return r?Boolean(r.isLocked):void 0}},{key:"loadTransform",value:(v=le(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Q(t,n),e.next=3,this.cache.getItem(r);case 3:return o=e.sent,e.abrupt("return",null==o?void 0:o.transform);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"saveTransform",value:(p=le(regeneratorRuntime.mark((function e(t,n,r){var o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Q(t,n),e.next=3,this.cache.getItem(i);case 3:if(a=e.sent,u=null===(o=a)||void 0===o?void 0:o.transform,s=r,!(!u&&!s||u&&s&&s.equals(u))){e.next=6;break}return e.abrupt("return");case 6:return a?a.transform=r:(a=(new j).createNew(i,r),this.cache.setItem(i,a)),e.next=9,this.alignmentApi.saveItem(a);case 9:case"end":return e.stop()}var u,s}),e,this)}))),function(e,t,n){return p.apply(this,arguments)})},{key:"lockAlignment",value:(l=le(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Q(t,n),e.next=3,this.cache.getItem(r);case 3:if(!(o=e.sent).isLocked){e.next=6;break}return e.abrupt("return");case 6:if(o.existsOnServer()){e.next=10;break}return e.next=10,this.alignmentApi.saveItem(o);case 10:return e.next=12,this.alignmentApi.setItemLocked(o,!0);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"unlockAlignment",value:(f=le(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Q(t,n),e.next=3,this.cache.getItem(r);case 3:if((o=e.sent)&&o.isLocked){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this.alignmentApi.setItemLocked(o,!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"isAlignmentLocked",value:(c=le(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Q(t,n),e.next=3,this.cache.getItem(r);case 3:return o=e.sent,e.abrupt("return",Boolean(null==o?void 0:o.isLocked));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"saveViewport",value:(s=le(regeneratorRuntime.mark((function e(t,n,r,o,i){var a,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Q(t,n),e.next=3,this.cache.getItem(a);case 3:(u=e.sent)||(u=(new j).createNew(a,i),this.cache.setItem(a,u)),u.regions||(u.regions=[]),-1===(s=u.regions.findIndex((function(e){return e.regionId===r})))&&(s=u.regions.length),u.regions[s]={regionId:r,boundingBox:o,transform:i},this.alignmentApi.saveItem(u);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return s.apply(this,arguments)})},{key:"loadViewports",value:(u=le(regeneratorRuntime.mark((function e(t,n){var r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Q(t,n),e.next=3,this.cache.getItem(r);case 3:return o=e.sent,i=null==o?void 0:o.regions,e.abrupt("return",i||[]);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"getRelationships",value:(a=le(regeneratorRuntime.mark((function e(t,n,r,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relationshipApi.loadItem(t,n,r,o);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"saveRelationship",value:(i=le(regeneratorRuntime.mark((function e(t,n,r,o,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.relationshipApi.saveItem(t,n,r,o,i);case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return i.apply(this,arguments)})},{key:"onError",value:function(){this.error=!0}},{key:"isWorking",value:function(){return!this.error}},{key:"clearCache",value:function(){this.cache.clear()}},{key:"deleteItem",value:(o=le(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Q(t,n),e.next=3,this.cache.getItem(r);case 3:if((o=e.sent).existsOnServer()){e.next=6;break}return e.abrupt("return");case 6:if(!o.isLocked){e.next=9;break}return e.next=9,this.unlockAlignment(t,n);case 9:return this.cache.setItem(r,null),e.next=12,this.alignmentApi.deleteItem(r);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})}])&&ve(t.prototype,n),r&&ve(t,r),d}(a);function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ie(e);if(t){var o=Ie(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Re(this,n)}}function Re(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ie(e){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pe=Autodesk.Viewing,Ae=AutodeskNamespace("Autodesk.ModelAlignmentService"),Oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(n,e);var t=xe(n);function n(e,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,e,r)}return n}(Pe.Extension);Pe.theExtensionManager.registerExtension("Autodesk.ModelAlignmentService",Oe),Ae.AlignmentService=a,Ae.AlignmentServiceLS=O,Ae.NucleusAlignmentAPI=Z,Ae.AlignmentServiceNucleus=we,Ae.AlignedItem=void 0}});
//# sourceMappingURL=ModelAlignmentService.min.js.map