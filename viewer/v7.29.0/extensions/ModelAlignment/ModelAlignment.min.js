/*!
 * LMV v7.29.0
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.ModelAlignment=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=592)}({321:function(e){e.exports=JSON.parse('{"@@locale":"en","@@context":"ModelAlignment Extension","Pivot":"Pivot","From":"From","To":"To"}')},322:function(e){e.exports=JSON.parse('{"@@locale":"en","@@context":"SheetAlignment Extension","Add drawing":"Add drawing"}')},4:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(s=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(r).concat([o]).join("\n")}var s;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&i[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},5:function(e,t,n){var i,o,r={},s=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=i.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=a.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),c=null,u=0,d=[],h=n(6);function f(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=r[i.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](i.parts[s]);for(;s<i.parts.length;s++)o.parts.push(y(i.parts[s],t))}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(y(i.parts[s],t));r[i.id]={id:i.id,refs:1,parts:a}}}}function p(e,t){for(var n=[],i={},o=0;o<e.length;o++){var r=e[o],s=t.base?r[0]+t.base:r[0],a={css:r[1],media:r[2],sourceMap:r[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function v(e,t){var n=l(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=d[d.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,n);n.insertBefore(t,o)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function E(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return m(t,e.attrs),v(e,t),t}function m(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function y(e,t){var n,i,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var s=u++;n=c||(c=E(t)),i=A.bind(null,n,s,!1),o=A.bind(null,n,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),v(e,t),t}(t),i=k.bind(null,n,t),o=function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=E(t),i=b.bind(null,n),o=function(){g(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return f(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var s=n[o];(a=r[s.id]).refs--,i.push(a)}e&&f(p(e,t),t);for(o=0;o<i.length;o++){var a;if(0===(a=i[o]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete r[a.id]}}}};var T,P=(T=[],function(e,t){return T[e]=t,T.filter(Boolean).join("\n")});function A(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=P(t,o);else{var r=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function b(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function k(e,t,n){var i=n.css,o=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(i=h(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([i],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},581:function(e,t,n){var i=n(582);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(5)(i,o);i.locals&&(e.exports=i.locals)},582:function(e,t,n){(e.exports=n(4)(!1)).push([e.i,".model-alignment-panel .tab-header{border-bottom-color:transparent;font-size:12px;font-weight:bold;border-bottom-style:solid;border-bottom-width:3px;padding-bottom:2px}.model-alignment-panel .tab-header.selected{color:#1dc6f2;border-bottom-color:#1dc6f2}.model-alignment-panel .tab-header:hover{color:#1dc6f2}.model-alignment-panel .model-select-combo{width:calc(100% - 20px);margin:15px 10px 15px 10px;font-size:15px}\n",""])},592:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,"ModelAlignment",(function(){return Oe})),n.d(t,"SheetAlignment",(function(){return lt}));var o="Autodesk.ModelAlignment_Gizmo",r={MODEL_MOVED_EVENT:"modelMoved"},s=Autodesk.Viewing,a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.EventDispatcher.prototype.apply(this),this.viewer=t,this.id=n,this.anchor=new THREE.Vector3,this.startPos=new THREE.Vector3,this.viewer.impl.createOverlayScene(o),this.gizmo=new THREE.TransformControls(this.viewer.impl.camera,this.viewer.canvas,"translate"),this.target=new THREE.Object3D,this.gizmo.attach(this.target),this.active=!1,this.tmpMatrix=new THREE.Matrix4,this.onCameraChange=this.onCameraChange.bind(this)}var t,n,a;return t=e,(n=[{key:"dtor",value:function(){this.deactivate(),this.viewer.impl.removeOverlayScene(o)}},{key:"setModel",value:function(e,t){this.model=e,e?(t=t||this.model.getFuzzyBox({ignoreTransforms:!0}),this.anchor.copy(t.min),this.initGizmo(),this.setGizmoVisible(!0)):this.setGizmoVisible(!1)}},{key:"setGizmoVisible",value:function(e){this.gizmo.visible=e,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"initGizmo",value:function(){if(this.model){this.startPos.copy(this.anchor);var e=this.model.getModelToViewerTransform();e&&this.startPos.applyMatrix4(e),this.target.position.copy(this.startPos),this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"ModelTransformTool_".concat(this.id)}},{key:"activate",value:function(){this.active||(this.viewer.impl.addOverlay(o,this.gizmo),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!0)}},{key:"deactivate",value:function(){this.active&&(this.viewer.impl.removeOverlay(o,this.gizmo),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!1)}},{key:"onCameraChange",value:function(){this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"handleMouseMove",value:function(e){var t=this.gizmo.onPointerMove(e),n=this.gizmo.onPointerHover(e);if(this.viewer.impl.invalidate(t,t,!0),t){var i=this.target.position.clone().sub(this.startPos),o=this.model.getPlacementTransform(),s=o.elements;s[12]+=i.x,s[13]+=i.y,s[14]+=i.z,this.viewer.impl.setPlacementTransform(this.model,o),this.fireEvent({type:r.MODEL_MOVED_EVENT})}return(n||t)&&this.viewer.impl.clearHighlight(),n||t}},{key:"handleButtonDown",value:function(e){return 0===e.button&&this.gizmo.onPointerDown(e)}},{key:"handleButtonUp",value:function(e){return 0===e.button&&this.gizmo.onPointerUp(e)}},{key:"getPriority",value:function(){return 1}}])&&i(t.prototype,n),a&&i(t,a),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=g(e);if(t){var o=g(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}a.Events=r;var E=Autodesk.Viewing,m=0,y=AutodeskNamespace("Autodesk.ModelAlignment"),T={ALIGNMENT_MODIFIED:"alignmentModified",MODEL_SELECTED:"modelSelected"},P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(l,e);var t,n,i,o,r,s=f(l);function l(e,t){var n;return u(this,l),(n=s.call(this,e,t)).name="ModelAlignmentBase",Autodesk.Viewing.EventDispatcher.prototype.apply(v(n)),n}return t=l,(n=[{key:"load",value:(o=regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.Section");case 2:return e.next=4,this.viewer.loadExtension("Autodesk.Snapping");case 4:return e.next=6,this.viewer.loadExtension("Autodesk.Edit2D");case 6:return e.next=8,this.viewer.loadExtension("Autodesk.Edit3D");case 8:this.modelTransformTool=new a(this.viewer,this.name),this.viewer.toolController.registerTool(this.modelTransformTool),this.modelTransformTool.addEventListener(a.Events.MODEL_MOVED_EVENT,(function(){t.modified()})),this.viewer.addEventListener(E.MODEL_TRANSFORM_CHANGED_EVENT,(function(e){t.modelTransformTool.initGizmo()})),this.snapper=this.viewer.toolController.getTool("Snapper_ModelAlignment"),this.snapper||(this.snapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer,{renderSnappedTopology:!0,toolName:"Snapper_ModelAlignment"}),this.viewer.toolController.registerTool(this.snapper)),this.coordPicker=this.viewer.toolController.getTool(Autodesk.Edit3D.CoordPicker.Name),this.coordPicker||(this.coordPicker=new Autodesk.Edit3D.CoordPicker(this.viewer,this.snapper),this.viewer.toolController.registerTool(this.coordPicker)),this.screenOverlay=new Autodesk.Edit2D.ScreenOverlay(this.viewer,"Autodesk.ModelAlignment.ScreenOverlay_".concat(m++)),this.model=null,this.pendingChanges={};case 19:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,t=arguments;return new Promise((function(n,i){var r=o.apply(e,t);function s(e){c(r,n,i,s,a,"next",e)}function a(e){c(r,n,i,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"unload",value:function(){var e;this.viewer.toolController.deactivateTool(a.Name),null===(e=this.modelTransformTool)||void 0===e||e.dtor(),this.modelTransformTool=null,this.model=null,this.pendingChanges={}}},{key:"setModel",value:function(e){var t;this.model!==e&&(this.model=e,null===(t=this.modelTransformTool)||void 0===t||t.setModel(e),this.fireEvent({type:T.MODEL_SELECTED}))}},{key:"onSaveButton",value:function(){this.options.onSaveButton&&this.options.onSaveButton()}},{key:"saveChanges",value:function(e){var t=new THREE.Matrix4;for(var n in this.pendingChanges){var i=this.pendingChanges[n];if(i){var o=i.model,r=i.resetPlacement?null:o.getPlacementTransform(),s=o.getDocumentNode(),a=s.getRootNode().urn(),l=o.is2d()?s.guid():void 0,c=i.model.myData.scalingFactor;if(r&&c){var u=1/c;t.makeScale(u,u,u),r=t.multiply(r)}e.saveTransform(a,l,r)}}this.pendingChanges={}}},{key:"getAlignmentItemKey",value:function(e){var t=e.myData.urn,n=e.getDocumentNode();return t+(e.is2d()&&n?n.guid():"")}},{key:"modified",value:function(){if(this.model){var e=this.getAlignmentItemKey(this.model);this.pendingChanges[e]=new A(this.model,!1),this.fireEvent({type:T.ALIGNMENT_MODIFIED})}}},{key:"hasPendingChanges",value:function(){return Object.keys(this.pendingChanges).length}}])&&d(t.prototype,n),i&&d(t,i),l}(E.Extension),A=function e(t,n){u(this,e),this.model=t,this.resetPlacement=n};y.Events=T;n(581);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=O(e);if(t){var o=O(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return _(this,n)}}function _(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?w(e):t}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function N(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),e}var M=Autodesk.Viewing,x=Autodesk.Viewing.Private,V={MODEL_TRANSFORM_EDITED:"transformEdited",SELECT_MODEL_PRESSED:"selectModelPressed",EDIT_POSITION_PRESSED:"editPositionPressed",TAB_CHANGED:"tabChanged",VECTOR_INPUT_VALUE_CHANGED:"vectorInputValueChanged",MODEL_SELECTED:"modelSelected",SAVE_BUTTON_PRESSED:"saveButtonPressed",FIT_TO_VIEW_BUTTON_PRESSED:"fitToViewButtonPressed",FROM_POINT_BUTTON_PRESSED:"fromPointButtonPressed",TO_POINT_BUTTON_PRESSED:"toPointButtonPressed",APPLY_PTP_PRESSED:"applyPointToPointPressed",FROM_POINT_CHANGED:"fromPointChanged",TO_POINT_CHANGED:"toPointChanged",OFFSET_CHANGED:"offsetChanged",CENTER_BUTTON_PRESSED:"centerButtonPressed",FROM_ANGLE_BUTTON_PRESSED:"fromAngleButtonPressed",TO_ANGLE_BUTTON_PRESSED:"toAngleButtonPressed",APPLY_ATA_PRESSED:"applyAngleToAnglePressed",CENTER_CHANGED:"centerChanged",OFFSET_ANGLE_CHANGED:"offsetAngleChanged",FROM_ANGLE_CHANGED:"fromAngleChanged",TO_ANGLE_CHANGED:"toAngleChanged",FROM_EDGE_BUTTON_PRESSED:"fromEdgeButtonPressed",TO_EDGE_BUTTON_PRESSED:"toEdgeButtonPressed"},L=function(e){var t=document.createElement("div");return e.appendChild(t),t.style.height="55px",t.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.style.display="flex",t.style.flexDirection="row",t.style.padding="10px",t.style.width="100%",t.style.boxSizing="border-box",t.style.alignItems="center",t.style.marginTop="15px",t},H=function(e,t,n,i,o){var r=L(e);i&&(r.id=i);var s=document.createElement("div");if(s.textContent=t,s.style.flexGrow="90",s.style.fontWeight="bold",r.appendChild(s),!n)return r;var a=function(e){var t=e.container.style;t.backgroundColor="rgb(80,80,80)",t.flexGrow="10",t.height="15px",t.width="auto",t.textAlign="center",t.fontSize="12px"};return a(n),r.appendChild(n.container),o?(a(o),r.appendChild(o.container),r):r},I=function(e,t){var n=document.createElement("div");e.appendChild(n);var i=document.createElement("div");i.textContent=t,i.fontSize="10px",n.appendChild(i);var o=document.createElement("input");return o.type="text",n.appendChild(o),o.style.width="80px",o},B=function(e){return!!e.match(/^-?\d*\.?\d*$/)},F=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;D(this,e),M.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.input=document.createElement("input"),this.input.type="text",this.input.style.width="100px",this.container.appendChild(this.input),this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.input.addEventListener("input",this.handleInput)),this.input.addEventListener("blur",this.onBlur.bind(this)),this.digits=o}return N(e,[{key:"validate",value:function(e){return e.toFixed(this.digits)}},{key:"setValue",value:function(e){if(null!=e&&null!==e){var t=parseFloat(e).toFixed(this.digits);isNaN(t)||(this.updateInput&&(this.input.value=t),this.fireEvent({type:V.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){B(e)&&(this.input.value=e)}},{key:"getValue",value:function(){return this.valid()?parseFloat(this.input.value):void 0}},{key:"onBlur",value:function(){this.setValue(this.input.value)}},{key:"clear",value:function(){this.input.value="",this.fireEvent({type:V.VECTOR_INPUT_VALUE_CHANGED})}},{key:"valid",value:function(){return isFinite(parseFloat(this.input.value))}}]),e}(),G=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;D(this,e),M.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.x=I(this.container,"X"),this.y=I(this.container,"Y"),this.z=I(this.container,"Z"),this.digits=o,this._value=new THREE.Vector3,this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.x.addEventListener("input",this.handleInput),this.y.addEventListener("input",this.handleInput),this.z.addEventListener("input",this.handleInput)),this.x.addEventListener("blur",this.onBlur.bind(this)),this.y.addEventListener("blur",this.onBlur.bind(this)),this.z.addEventListener("blur",this.onBlur.bind(this)),this.enableEmpty=!1}return N(e,[{key:"validate",value:function(e){return e.toFixed(this.digits)}},{key:"parseValue",value:function(e){return this.enableEmpty&&!e.length?0:parseFloat(e)}},{key:"valid",value:function(){return this.enableEmpty||this.x.value.length&&this.y.value.length&&this.z.value.length}},{key:"getValue",value:function(){var e=this.parseValue(this.x.value),t=this.parseValue(this.y.value),n=this.parseValue(this.z.value);return this._value.set(e,t,n),this._value}},{key:"isZero",value:function(){var e=this.getValue();return 0==e.x&&0==e.y&&0==e.z}},{key:"setValue",value:function(e){if(e){var t=this.validate(e.x),n=this.validate(e.y),i=this.validate(e.z);isNaN(t)||isNaN(n)||isNaN(i)||(this._value.copy(e),this.updateInput&&(this.x.value=t,this.y.value=n,this.z.value=i),this.fireEvent({type:V.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){B(e.x)&&B(e.y)&&B(e.z)&&(this.x.value=e.x,this.y.value=e.y,this.z.value=e.z)}},{key:"onBlur",value:function(){this.setValue(this._value)}},{key:"clear",value:function(){this.x.value="",this.y.value="",this.z.value="",this.fireEvent({type:V.VECTOR_INPUT_VALUE_CHANGED})}}]),e}(),z=function(e,t,n){var i=new Autodesk.Viewing.UI.Button(t);return e.appendChild(i.container),i.container.textContent=n,i.container.style.textAlign="center",i.container.style.left="50%",i.container.style.transform="translateX(-50%)",i.container.style.width="auto",i.container.style.height="auto",i.container.style.backgroundColor="rgb(80,80,80)",i},j=function(e,t){e.container.style.boxShadow=t?"0px 0px 10px":"initial",e.highlight=t},U={Transform:"Transform",PointToPoint:"Point-to-Point",AngleToAngle:"Angle-to-Angle"},Y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(n,Autodesk.Viewing.UI.DockingPanel);var t=C(n);function n(e,i,o,r){var s;return D(this,n),(s=t.call(this,e.container,i,o,r)).viewer=e,M.EventDispatcher.prototype.apply(w(s)),s.pages=[],s.selectedTabId=null,s.title.style.borderBottomColor="rgb(74, 85, 91)",s.container.classList.add("model-alignment-panel"),s.container.style.width="300px",s.container.style.height="815px",s.container.style.top="6px",s.container.style.left="6px",s.body=document.createElement("div"),s.body.style.backgroundColor="rgba(34, 34, 34, 0.9)",s.body.style.height="100%",s.body.style.padding="10px",s.container.appendChild(s.body),s.addModelSection(s.body),s.addTabHeaderSection(s.body),s.positionTab=s.addTab(U.Transform,"Position"),s.pointToPointTab=s.addTab(U.PointToPoint,"Move"),s.angleToAngleTab=s.addTab(U.AngleToAngle,"Rotate"),s.initPositionTab(),s.initPointToPointTab(),s.initAngleToAngleTab(),s.selectTab(U.Transform),s.digits=2,s}return N(n,[{key:"filterValue",value:function(e){return e.toFixed(this.digits)}},{key:"addModelSection",value:function(e){var t=this,n=document.createElement("div");n.id="ModelSection",this.selectModelButton=new Autodesk.Viewing.UI.Button("SelectModel"),this.selectModelButton.container.textContent="Select",this.selectModelButton.onClick=function(){t.fireEvent({type:V.SELECT_MODEL_PRESSED}),j(t.selectModelButton,!0)},H(n,"Model",this.selectModelButton),this.modelCombo=document.createElement("select"),this.modelCombo.classList.add("model-select-combo"),n.appendChild(this.modelCombo),this.updateModelCombo(),this.updateModelCombo=this.updateModelCombo.bind(this),this.viewer.addEventListener(M.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.addEventListener(M.MODEL_REMOVED_EVENT,this.updateModelCombo),this.modelCombo.addEventListener("change",(function(){var e=t.modelCombo.selectedIndex,n=t.modelCombo.items[e];t.setModel(n.model)})),e.appendChild(n)}},{key:"updateModelCombo",value:function(){var e=this;this.modelCombo.length=0;var t=[];t.push({name:"Please select",model:null});var n={};this.viewer.getVisibleModels().forEach((function(e){var i=e.myData.urn;if(!n[i]){n[i]=!0;var o=e.getDocumentNode().getModelName();t.push({name:o,model:e})}}));var i=function(t){t?e.viewer.impl.renderer().rollOverModelId(t.id):e.viewer.impl.clearHighlight(),e.viewer.impl.invalidate(!1,!1,!0)};t.forEach((function(t,n){var o=document.createElement("option");o.value=n,o.textContent=t.name,o.addEventListener("mouseenter",(function(){return i(t.model)})),o.addEventListener("mouseleave",(function(){return i(null)})),e.modelCombo.add(o)})),this.modelCombo.items=t}},{key:"initPositionTab",value:function(){var e=this;this.positionTab.padding="10px",this.editPositionButton=this.createEventButton("EditPositionButton","Edit",V.EDIT_POSITION_PRESSED),this.fitToViewButton=this.createEventButton("FitToViewButton","Fit to View",V.FIT_TO_VIEW_BUTTON_PRESSED,null,!1),H(this.positionTab,"Position",this.editPositionButton,"PositionHeader",this.fitToViewButton),this.position=new G(this.positionTab,(function(){return e.onTransformChanged()})),H(this.positionTab,"Rotation"),this.rotation=new F(this.positionTab,(function(){return e.onTransformChanged()})),this.saveButton=this.createEventButton("SaveButton","Save Transforms",V.SAVE_BUTTON_PRESSED),H(this.body,"",this.saveButton)}},{key:"initPointToPointTab",value:function(){var e=this;this.selectFromButton=this.createEventButton("SelectFromButton","Select",V.FROM_POINT_BUTTON_PRESSED),this.selectToButton=this.createEventButton("SelectToButton","Select",V.TO_POINT_BUTTON_PRESSED),H(this.pointToPointTab,"From point",this.selectFromButton,"FromPointHeader"),this.fromPoint=new G(this.pointToPointTab,(function(){return e.onFromPointChanged(!0)})),H(this.pointToPointTab,"To point",this.selectToButton,"ToPointHeader"),this.toPoint=new G(this.pointToPointTab,(function(){return e.onToPointChanged(!0)})),H(this.pointToPointTab,"Offset",null,"OffsetHeader"),this.offset=new G(this.pointToPointTab,(function(){return e.onOffsetChanged(!0)})),this.offset.enableEmpty=!0;var t=L(this.pointToPointTab);this.applyPointToPointButton=z(t,"ApplyP2P","Apply"),this.applyPointToPointButton.onClick=function(){e.clearPointToPoint(),e.fireEvent({type:V.APPLY_PTP_PRESSED})}}},{key:"initAngleToAngleTab",value:function(){var e=this;this.selectCenterButton=this.createEventButton("SelectCenterButton","Select",V.CENTER_BUTTON_PRESSED,(function(){return e.onSelectCenterButton()})),this.selectFromAngleButton=this.createEventButton("SelectFromAngleButton","Direction",V.FROM_ANGLE_BUTTON_PRESSED),this.selectToAngleButton=this.createEventButton("SelectToAngleButton","Direction",V.TO_ANGLE_BUTTON_PRESSED),this.selectFromEdgeButton=this.createEventButton("SelectFromEdgeButton","Edge",V.FROM_EDGE_BUTTON_PRESSED),this.selectToEdgeButton=this.createEventButton("SelectToEdgeButton","Edge",V.TO_EDGE_BUTTON_PRESSED),H(this.angleToAngleTab,"Center",this.selectCenterButton,"CenterHeader"),this.center=new G(this.angleToAngleTab,(function(){return e.onCenterChanged(!0)})),H(this.angleToAngleTab,"From angle",this.selectFromEdgeButton,"FromAngleHeader",this.selectFromAngleButton),this.fromAngle=new F(this.angleToAngleTab,(function(){return e.onFromAngleChanged(!0)})),H(this.angleToAngleTab,"To angle",this.selectToEdgeButton,"ToPointHeader",this.selectToAngleButton),this.toAngle=new F(this.angleToAngleTab,(function(){return e.onToAngleChanged(!0)})),H(this.angleToAngleTab,"Offset angle",null,"OffsetHeader"),this.offsetAngle=new F(this.angleToAngleTab,(function(){return e.onOffsetAngleChanged(!0)})),this.offset.enableEmpty=!0;var t=L(this.angleToAngleTab);this.applyAngleToAngleButton=z(t,"ApplyA2A","Apply"),this.applyAngleToAngleButton.onClick=function(){e.clearAngleToAngle(),e.fireEvent({type:V.APPLY_ATA_PRESSED})}}},{key:"setModel",value:function(e){this.model=e;var t=this.modelCombo.items;this.modelCombo.selectedIndex=t.findIndex((function(t){return t.model===e})),this.updateMatrix(),j(this.selectModelButton,!1),this.blockEvents||(this.blockEvents=!0,this.fireEvent({type:V.MODEL_SELECTED}),this.blockEvents=!1)}},{key:"updateMatrix",value:function(){if(this.model){var e=this.model.getPlacementTransform();this.setMatrix(e)}}},{key:"setPosition",value:function(e){this.position.setValue(e)}},{key:"setRotation",value:function(e){this.rotation.setValue(e)}},{key:"setFromPoint",value:function(e){this.fromPoint.setValue(e),this.onFromPointChanged()}},{key:"setToPoint",value:function(e){this.toPoint.setValue(e),this.onToPointChanged()}},{key:"setOffset",value:function(e){this.offset.setValue(e),this.onOffsetChanged()}},{key:"setCenter",value:function(e){this.center.setValue(e)}},{key:"setFromAngle",value:function(e){this.fromAngle.setValue(e),this.onFromAngleChanged()}},{key:"setToAngle",value:function(e){this.toAngle.setValue(e),this.onToAngleChanged()}},{key:"fromPointValid",value:function(){return this.fromPoint.valid()}},{key:"toPointValid",value:function(){return this.toPoint.valid()}},{key:"offsetValid",value:function(){return this.offset.valid()}},{key:"clearPointToPoint",value:function(){this.fromPoint.clear(),this.toPoint.clear(),this.offset.clear()}},{key:"clearAngleToAngle",value:function(){this.center.clear(),this.fromAngle.clear(),this.toAngle.clear(),this.offsetAngle.clear()}},{key:"getPosition",value:function(){return this.position.valid()&&this.position.getValue()}},{key:"getRotation",value:function(){return this.rotation.valid()&&this.rotation.getValue()}},{key:"getFromPoint",value:function(){return this.fromPoint.valid()&&this.fromPoint.getValue()}},{key:"getToPoint",value:function(){return this.toPoint.valid()&&this.toPoint.getValue()}},{key:"getOffset",value:function(){return!this.offset.isZero()&&this.offset.getValue()}},{key:"getCenter",value:function(){return this.center.valid()&&this.center.getValue()}},{key:"extractModelScale",value:function(){var e=new THREE.Vector3(1,1,1),t=this.model.myData.placementTransform;return t?e.setFromMatrixScale(t):e}},{key:"onTransformChanged",value:function(){if(this.model){var e=this.getPosition(),t=new THREE.Vector3(0,0,1),n=THREE.Math.degToRad(this.getRotation()),i=(new THREE.Quaternion).setFromAxisAngle(t,n),o=this.extractModelScale();if(e&&i){var r=new x.LmvMatrix4(!0).compose(e,i,o);this.viewer.impl.setPlacementTransform(this.model,r),this.fireEvent({type:V.MODEL_TRANSFORM_EDITED})}}}},{key:"onFromPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?this.offset.setValue(n.sub(t)):t&&i&&(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:V.TO_POINT_CHANGED,toPoint:this.getToPoint()})),e&&this.fireEvent({type:V.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})}},{key:"onToPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?(this.offset.setValue(n.sub(t)),e&&this.fireEvent({type:V.OFFSET_CHANGED,offset:this.getOffset()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:V.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:V.TO_POINT_CHANGED,toPoint:this.getToPoint()})}},{key:"onOffsetChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&i?(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:V.TO_POINT_CHANGED,toPoint:this.getToPoint()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:V.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:V.OFFSET_CHANGED,offset:this.getOffset()})}},{key:"updateFromAngle",value:function(e){var t=this.toAngle.getValue()-this.offsetAngle.getValue();this.fromAngle.setValue(t),e&&this.fireEvent({type:V.FROM_ANGLE_CHANGED,angle:t})}},{key:"updateToAngle",value:function(e){var t=this.fromAngle.getValue()+this.offsetAngle.getValue();this.toAngle.setValue(t),e&&this.fireEvent({type:V.TO_ANGLE_CHANGED,angle:t})}},{key:"updateOffsetAngle",value:function(e){var t=this.toAngle.getValue()-this.fromAngle.getValue();this.offsetAngle.setValue(t),e&&this.fireEvent({type:V.OFFSET_ANGLE_CHANGED,angle:t})}},{key:"onCenterChanged",value:function(e){e&&this.fireEvent({type:V.CENTER_CHANGED,center:this.getCenter()})}},{key:"onFromAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):t&&i&&this.updateToAngle(e),e&&this.fireEvent({type:V.FROM_ANGLE_CHANGED,angle:this.fromAngle.getValue()})}},{key:"onToAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):n&&i&&this.updateFromAngle(e),e&&this.fireEvent({type:V.TO_ANGLE_CHANGED,angle:this.toAngle.getValue()})}},{key:"onOffsetAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&i?this.updateToAngle(e):n&&i?this.updateFromAngle(e):!i||t||n||(this.fromAngle.setValue(0),this.toAngle.setValue(this.offsetAngle.getValue()),this.updateFromAngle(e),this.updateToAngle(e)),e&&this.fireEvent({type:V.OFFSET_ANGLE_CHANGED,angle:this.offsetAngle.getValue()})}},{key:"setMatrix",value:function(e){e=e||(new THREE.Matrix4).identity();var t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;THREE.Matrix4.prototype.decompose.call(e,t,n,i),this.setPosition(t);var o=(new THREE.Euler).setFromQuaternion(n),r=THREE.Math.radToDeg(o._z);this.setRotation(r)}},{key:"addTabHeaderSection",value:function(e){this.tabHeaders=document.createElement("div"),this.tabHeaders.id="TabHeaders",this.tabHeaders.style.paddingTop="15px",this.tabHeaders.style.paddingLeft="10px",this.tabHeaders.style.backgroundColor="rgb(34, 34, 34, 0.94)",this.tabHeaders.style.display="flex",this.tabHeaders.style.flexDirection="row",this.tabHeaders.style.borderBottomStyle="solid",this.tabHeaders.style.borderBottomWidth="3px",this.tabHeaders.style.borderColor="rgb(34, 34, 34, 0.94)",e.appendChild(this.tabHeaders)}},{key:"addTabHeader",value:function(e,t){var n=this,i=document.createElement("div");i.style.paddingRight="10px";var o=document.createElement("span");o.textContent=t,o.classList.add("tab-header"),i.appendChild(o),i.tabId=e,i.text=o,this.tabHeaders.appendChild(i);i.addEventListener("click",(function(){return n.selectTab(e)}))}},{key:"addTab",value:function(e,t){this.addTabHeader(e,t);var n=document.createElement("div");return n.tabId=e,this.pages.push(n),this.body.append(n),n}},{key:"selectTab",value:function(e){for(var t=0;t<this.tabHeaders.children.length;t++){var n=this.tabHeaders.children[t];n.tabId==e?n.text.classList.add("selected"):n.text.classList.remove("selected")}for(var i=0;i<this.pages.length;i++){var o=this.pages[i],r=o.tabId===e;o.style.display=r?"block":"none"}this.selectedTabId=e,this.fireEvent({type:V.TAB_CHANGED,tabId:e})}},{key:"onFromSelected",value:function(e){this.setFromPoint(e),j(this.selectFromButton,!1),this.fromPoint.valid()&&!this.toPoint.valid()&&(j(this.selectToButton,!0),this.fireEvent({type:V.TO_POINT_BUTTON_PRESSED}))}},{key:"onToSelected",value:function(e){this.setToPoint(e),j(this.selectToButton,!1)}},{key:"onFromHovered",value:function(e){this.setFromPoint(e)}},{key:"onToHovered",value:function(e){this.setToPoint(e)}},{key:"createEventButton",value:function(e,t,n,i){var o=this,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=new Autodesk.Viewing.UI.Button(e);return s.container.textContent=t,s.onClick=function(){i&&i(),o.fireEvent({type:n}),r&&j(s,!0)},s}},{key:"onCenterHovered",value:function(e){this.setCenter(e)}},{key:"onCenterSelected",value:function(e){this.setCenter(e),j(this.selectCenterButton,!1),this.center.valid()&&!this.fromAngle.valid()&&j(this.selectFromAngleButton,!0)}},{key:"onFromAngleHovered",value:function(e){this.setFromAngle(e)}},{key:"onFromAngleSelected",value:function(e){this.setFromAngle(e),j(this.selectFromAngleButton,!1),j(this.selectFromEdgeButton,!1),this.center.valid()&&this.fromAngle.valid()&&!this.toAngle.valid()&&j(this.selectToAngleButton,!0)}},{key:"onToAngleHovered",value:function(e){this.setToAngle(e)}},{key:"onToAngleSelected",value:function(e){this.setToAngle(e),j(this.selectToAngleButton,!1),j(this.selectToEdgeButton,!1)}},{key:"onSelectCenterButton",value:function(){this.clearAngleToAngle()}},{key:"uninitialize",value:function(){k(O(n.prototype),"uninitialize",this).call(this),this.viewer.removeEventListener(M.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.removeEventListener(M.MODEL_REMOVED_EVENT,this.updateModelCombo)}}]),n}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function X(e,t,n){return(X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Z(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Z(e);if(t){var o=Z(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return $(this,n)}}function $(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?q(e):t}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Y.Events=V,Y.TabIds=U;var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(r,Autodesk.Edit3D.TwoPointPicker);var t,n,i,o=J(r);function r(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s={draggable:!0,labels:["From","To"],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Black,getEdgeLabelText:function(){var e=i.points[0].distanceTo(i.points[1]);return i.unitHandler.lengthToString(e)}}]};return(i=o.call(this,e,t,n,s)).unitHandler=new Autodesk.Edit2D.DefaultUnitHandler(i.viewer),i.updateGizmos=i.updateGizmos.bind(q(i)),i.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,i.updateGizmos),i}return t=r,(n=[{key:"dtor",value:function(){X(Z(r.prototype),"dtor",this).call(this),this.viewer.removeEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.updateGizmos)}},{key:"apply",value:function(e){var t=this,n=e.getPlacementTransform(),i=this.pointValid[0]&&this.pointValid[1]?this.points[1].clone().sub(this.points[0]):this.offset,o=(new THREE.Vector3).setFromMatrixPosition(n),r=o.clone().add(i),s=new THREE.Vector3,a=new THREE.Vector3;this.screenOverlay.fadeOutGizmo(this.connectors[0].gizmo),this.connectors[0].label.setOpacity(0,!0),this.markers[0].setLabelVisible(!1),this.markers[1].setLabelVisible(!1),this.anim=Autodesk.Viewing.Private.fadeValue(0,1,1,(function(i){i=THREE.Math.smootherstep(i,0,1),s.lerpVectors(o,r,i),a.lerpVectors(t.points[0],t.points[1],i),t.markers[0].setPosition(a),n.setPosition(s),t.viewer.impl.setPlacementTransform(e,n)}),(function(e){t.clear(),t.anim=null}))}},{key:"fitModelToView",value:function(e){var t=e.getBoundingBox(),n=this.viewer.impl.camera,i=Autodesk.Viewing.UnifiedCamera.getViewParamsFromBox(t,!1,n.aspect,n.up,n.fov),o=t.center(),r=i.position.distanceTo(i.target),s=n.getWorldDirection().clone().multiplyScalar(r),a=n.position.clone().add(s),l=o.distanceTo(a),c=2*t.size().length();if(l>c){var u=Math.max(l-c,0),d=a.clone().sub(o).normalize().multiplyScalar(u),h=e.getPlacementTransform(),f=(new THREE.Vector3).setFromMatrixPosition(h);f.add(d),h.setPosition(f),this.viewer.impl.setPlacementTransform(e,h),o.add(d)}this.setFrom(o),this.setTo(a),this.apply(e)}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}}])&&Q(t.prototype,n),i&&Q(t,i),r}();function te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ne={CENTER_SELECTED:"centerSelected",CENTER_HOVERED:"centerHovered",FROM_ANGLE_SELECTED:"startAngleSelected",FROM_ANGLE_HOVERED:"startAngleHovered",TO_ANGLE_SELECTED:"endAngleSelected",TO_ANGLE_HOVERED:"endAngleHovered"},ie={NotSelecting:0,SelectingCenter:1,SelectingStartAngle:2,SelectingEndAngle:3,SelectingStartAngleEdge:4,SelectingEndAngleEdge:5},oe={SinglePoint:0,Edge:1},re=new THREE.Matrix4,se=new THREE.Matrix4,ae=new THREE.Matrix4,le=new THREE.Quaternion,ce=new THREE.Vector3,ue=function(){function e(t,n,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=Autodesk.Edit3D.CoordPicker,s=Autodesk.Edit3D.PointMarker,a=Autodesk.Edit3D.TwoPointPicker;this.viewer=t,this.coordPicker=n,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.mode=ie.NotSelecting,this.defaultPickingMode=oe.Edge,this.center=new THREE.Vector3,this.fromPoint=new THREE.Vector3,this.toPoint=new THREE.Vector3,this.centerValid=!1,this.fromValid=!1,this.toValid=!1,this.fromPointOnPlane=new THREE.Vector3,this.toPointOnPlane=new THREE.Vector3,this.centerMarker=new s(this.viewer,void 0,"Pivot",s.Icons.Cross),this.fromMarker=new s(this.viewer,void 0,"From",s.Icons.Empty),this.toMarker=new s(this.viewer,void 0,"To",s.Icons.Empty),this.centerMarker.addEventListener(s.Events.DRAG_START,(function(){o.startSelectCenter(!0)})),this.centerMarker.addEventListener(s.Events.DRAG_END,(function(e){return o.onDragCenterEnd(e)})),this.centerMarker.setColor("rgb(0, 0, 0)"),this.angleGizmo=new Autodesk.Edit2D.AngleGizmo3d(this.viewer,{startColor:Autodesk.Edit3D.NPointPicker.Colors.Blue,endColor:Autodesk.Edit3D.NPointPicker.Colors.Red}),this.angleGizmo.setVisible(!0),this.axis=new THREE.Vector3(0,0,1),this.selectionPlane=new THREE.Plane,this.screenOverlay=i,this.fromConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo,this.toConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo;var l=this.fromConnector.line2D.style;l.lineStyle=10,l.lineWidth=1.5,l.lineColor="rgb(255, 0, 0)",l.lineOpacity=.7,this.toConnector.line2D.style.copy(l),this.animTime=1.5,this.fadeOutAngleGizmoAfter=.7,this.visible=!0,this.onDragEdgeEnd=this.onDragEdgeEnd.bind(this);var c={draggable:!0,icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Blue],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Blue,getEdgeLabelText:function(){return o.fromValid?o.pointToAngle(o.fromPoint,!0).toFixed(1)+"°":""}}]};this.fromEdgePicker=new a(t,n,i,c),this.fromEdgePicker.addEventListener(a.Events.TO_POINT_SELECTED,(function(){return o.onEdgeSelected(o.fromEdgePicker)})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=ie.SelectingStartAngleEdge})),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=ie.SelectingStartAngleEdge})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.fromEdgePicker.getEdgeLabelText=function(){return o.fromValid?o.pointToAngle(o.fromPoint,!0).toFixed(1)+"°":""},c={draggable:!0,icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Red,getEdgeLabelText:function(){return o.toValid?o.pointToAngle(o.toPoint,!0).toFixed(1)+"°":""}}]},this.toEdgePicker=new a(t,n,i,c),this.toEdgePicker.addEventListener(a.Events.TO_POINT_SELECTED,(function(){return o.onEdgeSelected(o.toEdgePicker)})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=ie.SelectingEndAngleEdge})),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=ie.SelectingEndAngleEdge})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.onPointClicked=this.onPointClicked.bind(this),this.onPointHovered=this.onPointHovered.bind(this),this.coordPicker.addEventListener(r.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.addEventListener(r.Events.POINT_HOVERED,this.onPointHovered),this.coordPicker.addEventListener(r.Events.ESCAPE,(function(){return o.cancelPointSelection()})),this.updateGizmos()}var t,n,i;return t=e,(n=[{key:"dtor",value:function(){this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_HOVERED,this.onPointHovered)}},{key:"startSelectCenter",value:function(e){this.clear(),this.isActive=!0,this.pointBackup=this.centerValid?this.center.clone():null,this.viewer.toolController.activateTool(this.coordPicker.getName()),this.mode=ie.SelectingCenter,e&&this.coordPicker.setDragging(!0),this.centerMarker.setDraggable(e)}},{key:"startCoordPicker",value:function(e){this.viewer.toolController.activateTool(this.coordPicker.getName())}},{key:"endCoordPicker",value:function(){this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName())}},{key:"onDragCenterEnd",value:function(e){var t=e.event;this.coordPicker.getDragging()&&(this.coordPicker.handleSingleClick(t,0),this.coordPicker.setDragging(!1))}},{key:"onDragEdgeEnd",value:function(){this.mode=ie.NotSelecting,this.continuePointSelectionIfNeeded()}},{key:"startSelectFromAngle",value:function(e){this.startCoordPicker(!0),this.mode=ie.SelectingStartAngle,this.pointBackup=this.fromValid?this.fromPoint.clone():null}},{key:"startSelectToAngle",value:function(e){this.startCoordPicker(!0),this.mode=ie.SelectingEndAngle,this.pointBackup=this.toValid?this.toPoint.clone():null}},{key:"setCenter",value:function(e){e?(this.center.copy(e),this.centerValid=!0,this.selectionPlane.setFromNormalAndCoplanarPoint(this.axis,this.center)):this.centerValid=!1,this.updateGizmos()}},{key:"setFromPoint",value:function(e){this.fromValid=!!e,this.fromValid&&this.fromPoint.copy(e),this.updateGizmos()}},{key:"setToPoint",value:function(e){this.toValid=!!e,this.toValid&&this.toPoint.copy(e),this.updateGizmos()}},{key:"pointToAngle",value:function(e,t){var n=e.x-this.center.x,i=e.y-this.center.y,o=Math.atan2(i,n);return t?THREE.Math.radToDeg(o):o}},{key:"onPointHovered",value:function(e){if(this.mode!==ie.NotSelecting&&e.point){var t=this.pointToAngle(e.point,!0);switch(this.mode){case ie.SelectingCenter:this.setCenter(e.point),this.fireEvent({type:ne.CENTER_HOVERED,point:e.point}),this.fromValid&&this.fireEvent({type:ne.FROM_ANGLE_HOVERED,angle:this.pointToAngle(this.fromPoint,!0)}),this.toValid&&this.fireEvent({type:ne.TO_ANGLE_HOVERED,angle:this.pointToAngle(this.toPoint,!0)});break;case ie.SelectingStartAngle:this.setFromPoint(e.point),this.fireEvent({type:ne.FROM_ANGLE_HOVERED,angle:t});break;case ie.SelectingEndAngle:this.setToPoint(e.point),this.fireEvent({type:ne.TO_ANGLE_HOVERED,angle:t});case ie.SelectingStartAngleEdge:(1===this.fromEdgePicker.selectingIndex||this.fromValid)&&(this.fromValid||this.setFromPoint(this.fromEdgePicker.points[1]),this.setPointFromEdge(this.fromPoint,this.fromEdgePicker.points[0],this.fromEdgePicker.points[1]),this.updateGizmos(),this.fireEvent({type:ne.FROM_ANGLE_HOVERED,angle:this.pointToAngle(this.fromPoint)}));break;case ie.SelectingEndAngleEdge:(1===this.toEdgePicker.selectingIndex||this.toValid)&&(this.toValid||this.setToPoint(this.toEdgePicker.points[1]),this.setPointFromEdge(this.toPoint,this.toEdgePicker.points[0],this.toEdgePicker.points[1]),this.updateGizmos(),this.fireEvent({type:ne.TO_ANGLE_HOVERED,angle:this.pointToAngle(this.toPoint)}))}}}},{key:"updateGizmos",value:function(){this.fromPointOnPlane=this.selectionPlane.projectPoint(this.fromPoint,this.fromPointOnPlane),this.toPointOnPlane=this.selectionPlane.projectPoint(this.toPoint,this.toPointOnPlane),this.centerMarker.setPosition(this.center),this.centerMarker.setVisible(this.visible&&this.centerValid),this.fromValid&&this.fromMarker.setPosition(this.fromPointOnPlane),this.fromMarker.setVisible(this.visible&&this.fromValid),this.toValid&&this.toMarker.setPosition(this.toPointOnPlane),this.toMarker.setVisible(this.visible&&this.toValid),this.fromEdgePicker.setVisible(this.visible&&this.fromValid),this.toEdgePicker.setVisible(this.visible&&this.toValid),this.visible&&(this.fromValid||this.toValid)?(this.angleGizmo.fadeTo(1),this.angleGizmo.setLabelEnabled(!0),this.mode!==ie.NotSelecting&&this.angleGizmo.skipFade(),this.angleGizmo.setCenter3d(this.centerValid&&this.center),this.angleGizmo.setStart3d(this.fromValid&&this.fromPoint),this.angleGizmo.setEnd3d(this.toValid&&this.toPoint),this.angleGizmo.update()):(this.angleGizmo.fadeTo(0),this.angleGizmo.setLabelEnabled(!1),this.angleGizmo.update()),this.fromConnector.setLine(this.fromPoint,this.fromPointOnPlane),this.toConnector.setLine(this.toPoint,this.toPointOnPlane),this.screenOverlay.setGizmoVisible(this.fromConnector,this.visible&&this.mode===ie.SelectingStartAngle),this.screenOverlay.setGizmoVisible(this.toConnector,this.visible&&this.mode===ie.SelectingEndAngle),this.screenOverlay.update()}},{key:"onPointClicked",value:function(e){var t=e.point,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.mode!==ie.NotSelecting&&this.mode!==ie.SelectingStartAngleEdge&&this.mode!=ie.SelectingEndAngleEdge){t=t||this.pointBackup,this.pointBackup=null;var i=this.mode;this.mode=ie.NotSelecting,this.endCoordPicker(),t&&(this.viewer.impl.camera.pivot.copy(t),this.viewer.impl.camera.dirty=!0);var o=t?this.pointToAngle(t,!0):null;switch(i){case ie.SelectingCenter:this.setCenter(t),this.centerMarker.setDraggable(!!t),this.fireEvent({type:ne.CENTER_SELECTED,point:t});break;case ie.SelectingStartAngle:this.setFromPoint(t),this.fireEvent({type:ne.FROM_ANGLE_SELECTED,angle:o});break;case ie.SelectingEndAngle:this.setToPoint(t),this.fireEvent({type:ne.TO_ANGLE_SELECTED,angle:o});break;case ie.SelectingStartAngleEdge:case ie.SelectingEndAngleEdge:break;default:console.error("Unexpeced mode")}n&&this.continuePointSelectionIfNeeded()}}},{key:"cancelPointSelection",value:function(){this.onPointClicked({},!1),this.fromEdgePicker.cancelPointSelection(),this.toEdgePicker.cancelPointSelection()}},{key:"startSelect",value:function(){this.isActive=!0,this.continuePointSelectionIfNeeded()}},{key:"continuePointSelectionIfNeeded",value:function(){var e=this;this.isPickerActive()&&(this.setVisible(!0),setTimeout((function(){e.centerValid?e.fromValid?e.toValid||(e.defaultPickingMode===oe.Edge?e.startSelectToAngleEdge():e.defaultPickingMode===oe.SinglePoint&&e.startSelectToAngle()):e.defaultPickingMode===oe.Edge?e.startSelectFromAngleEdge():e.defaultPickingMode===oe.SinglePoint&&e.startSelectFromAngle():e.startSelectCenter()}),1))}},{key:"getOffsetAngle",value:function(){if(this.fromValid&&this.toValid){var e=this.pointToAngle(this.fromPoint);return this.pointToAngle(this.toPoint)-e}return this.offset}},{key:"createRotation",value:function(e,t,n){var i=re.makeTranslation(-n.x,-n.y,-n.z),o=se.makeTranslation(n.x,n.y,n.z),r=le.setFromAxisAngle(this.axis,e),s=ae.makeRotationFromQuaternion(r);return t.copy(o).multiply(s).multiply(i)}},{key:"clear",value:function(){this.fromValid=!1,this.toValid=!1,this.centerValid=!1,this.fromEdgePicker.clear(),this.toEdgePicker.clear(),this.isActive=!1,this.updateGizmos()}},{key:"apply",value:function(e){var t=this,n=this.getOffsetAngle(),i=e.getPlacementTransform().clone(),o=new Autodesk.Viewing.Private.LmvMatrix4(!0),r=new THREE.Vector3,s=e.getGlobalOffset(),a=s?this.center.clone().add(s):this.center;this.fromMarker.setVisible(!1),this.toMarker.setVisible(!1),this.centerMarker.setDraggable(!1),this.fromMarker.setDraggable(!1),this.toMarker.setDraggable(!1),this.fromEdgePicker.markers[0].setDraggable(!1),this.fromEdgePicker.markers[1].setDraggable(!1),this.toEdgePicker.markers[0].setDraggable(!1),this.toEdgePicker.markers[1].setDraggable(!1),this.angleGizmo.setLabelEnabled(!1),this.anim=Autodesk.Viewing.Private.fadeValue(0,1,this.animTime,(function(s){var l=THREE.Math.smootherstep(s,0,1)*n;o=t.createRotation(l,o,t.center),t.angleGizmo.setStart3d(r.copy(t.fromPointOnPlane).applyMatrix4(o)),t.angleGizmo.update(),s>t.fadeOutAngleGizmoAfter&&t.angleGizmo.fadeTo(0),o=t.createRotation(l,o,a).multiply(i),t.viewer.impl.setPlacementTransform(e,o)}),(function(e){t.clear(),t.anim=null}))}},{key:"setVisible",value:function(e){e!==this.visible&&(this.visible=e,this.updateGizmos())}},{key:"setPointFromAngle",value:function(e,t,n){e.set(1,0,0),Autodesk.Edit2D.Math2D.rotateAround(e,t),e.multiplyScalar(n).add(this.center)}},{key:"changeFromAngle",value:function(e){if(this.fromValid){if(void 0!==e){var t=this.fromPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.fromPoint,e,t)}else this.fromValid=!1;this.updateGizmos()}}},{key:"changeToAngle",value:function(e){if(this.toValid){if(void 0!==e){var t=this.toPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.toPoint,e,t)}else this.toValid=!1;this.updateGizmos()}}},{key:"changeOffset",value:function(e){this.centerValid&&(this.cancelPointSelection(),this.fromValid||(this.startSelectFromAngle(),this.fromValid=!0,this.changeFromAngle(0),this.onPointClicked({point:this.fromPoint})),this.toValid||(this.startSelectToAngle(),this.toValid=!0,this.changeToAngle(this.pointToAngle(this.fromPoint)+e),this.onPointClicked({point:this.toPoint})),this.continuePointSelectionIfNeeded())}},{key:"startSelectFromAngleEdge",value:function(){this.mode=ie.SelectingStartAngleEdge,this.fromEdgePicker.startSelect()}},{key:"startSelectToAngleEdge",value:function(){this.mode=ie.SelectingEndAngleEdge,this.toEdgePicker.startSelect()}},{key:"setPointFromEdge",value:function(e,t,n){if(!(t.distanceTo(n)<1e-5)){var i=e.distanceTo(this.center);e.copy(n).sub(t).normalize().multiplyScalar(i).add(this.center),this.selectionPlane.projectPoint(e,ce)}}},{key:"onEdgeSelected",value:function(e){var t=this.mode===ie.SelectingStartAngleEdge,n=this.mode===ie.SelectingEndAngleEdge;if(t||n){var i=e.points[0],o=e.points[1];if(t?this.setPointFromEdge(this.fromPoint,i,o):this.setPointFromEdge(this.toPoint,i,o),this.mode=ie.NotSelecting,this.updateGizmos(),t){var r=this.pointToAngle(this.fromPoint,!0);this.fireEvent({type:ne.FROM_ANGLE_SELECTED,angle:r}),this.continuePointSelectionIfNeeded()}else{var s=this.pointToAngle(this.toPoint,!0);this.fireEvent({type:ne.TO_ANGLE_SELECTED,angle:s}),this.continuePointSelectionIfNeeded()}}}},{key:"isPickerActive",value:function(){return this.isActive}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}}])&&te(t.prototype,n),i&&te(t,i),e}();function de(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ue.Events=ne,ue.Modes=ie,ue.PickingModes=oe;var he={MODEL_SELECTED:"modelSelected"},fe="ModelAlignment.ModelSelector",pe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.hoverColor=new THREE.Color(.5,.5,.1)}var t,n,i;return t=e,(n=[{key:"getName",value:function(){return fe}},{key:"getNames",value:function(){return[fe]}},{key:"activate",value:function(){this.active=!0,this.viewer.impl.renderer().setRollOverHighlightColor(this.hoverColor)}},{key:"deactivate",value:function(){this.active=!1,this.viewer.impl.clearHighlight(),this.viewer.impl.renderer().setRollOverHighlightColor()}},{key:"register",value:function(){}},{key:"modelIdAtPixel",value:function(e,t){var n=[],i=this.viewer.impl.clientToViewport(e,t),o=this.viewer.impl.renderer().idAtPixel(i.x,i.y,n),r=this.viewer.getVisibleModels();return o&&1===r.length?r[0].id:n[1]?n[1]:0}},{key:"handleMouseMove",value:function(e){if(0!==e.buttons)return this.viewer.impl.clearHighlight(),!1;var t=this.modelIdAtPixel(e.canvasX,e.canvasY);return t>=1?this.viewer.impl.renderer().rollOverModelId(t):this.viewer.impl.clearHighlight(),this.viewer.impl.invalidate(!1,!1,!0),!0}},{key:"handleSingleClick",value:function(e,t){if(0==t){var n=this.modelIdAtPixel(e.canvasX,e.canvasY),i=n&&this.viewer.impl.findModel(n);return this.fireEvent({type:he.MODEL_SELECTED,model:i}),!0}}}])&&de(t.prototype,n),i&&de(t,i),e}();pe.Events=he;var ve={en:n(321)};function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ye(e,t,n){return(ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ke(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ke(e);if(t){var o=ke(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Ae(this,n)}}function Ae(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?be(e):t}function be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e){return(ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Se=Autodesk.Viewing,Ce=AutodeskNamespace("Autodesk.ModelAlignment"),_e=function(e,t){if(e.isLeaflet())e.setThemingColor(null,t);else for(var n=e.myData.fragments.fragId2dbId,i=0;i<n.length;i++){var o=n[i];if(Array.isArray(o))for(var r=0;r<o.length;r++)e.setThemingColor(o[r],t);else e.setThemingColor(o,t)}},we=function(e){return void 0!==e?THREE.Math.degToRad(e):void 0},Oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(a,e);var t,n,i,o,r,s=Pe(a);function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).name="Autodesk.ModelAlignment",n.onPlacementChanged=n.onPlacementChanged.bind(be(n)),n.onSaveButton=n.onSaveButton.bind(be(n)),n}return t=a,(n=[{key:"load",value:(o=regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(ve),e.next=3,ye(ke(a.prototype),"load",this).call(this);case 3:this.panel=new Y(this.viewer,"ModelAlignmentPanel","Model Alignment"),this.viewer.addPanel&&this.viewer.addPanel(this.panel),this.viewer.addEventListener(Se.MODEL_PLACEMENT_CHANGED_EVENT,this.onPlacementChanged),this.onModelPanelSelect=this.onModelPanelSelect.bind(this),this.onTabChanged=this.onTabChanged.bind(this),this.pointToPoint=new ee(this.viewer,this.coordPicker,this.screenOverlay),this.angleToAngle=new ue(this.viewer,this.coordPicker,this.screenOverlay),this.modelSelector=new pe(this.viewer),this.viewer.toolController.registerTool(this.modelSelector),this.connectModelsPanel(),this.connectPointToPoint(),this.connectAngleToAngle(),this.connectModelSelector(),this.connectModelMoveTool(),this.panel.addEventListener(Y.Events.SAVE_BUTTON_PRESSED,this.onSaveButton),this.panel.addEventListener(Y.Events.MODEL_TRANSFORM_EDITED,(function(){return t.modified()})),this.panel.addEventListener(Y.Events.TAB_CHANGED,this.onTabChanged),this.selectionColor=new THREE.Vector4(1,1,0,.25);case 21:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,t=arguments;return new Promise((function(n,i){var r=o.apply(e,t);function s(e){Ee(r,n,i,s,a,"next",e)}function a(e){Ee(r,n,i,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"unload",value:function(){ye(ke(a.prototype),"unload",this).call(this),this.viewer.removePanel&&this.viewer.removePanel(this.panel),this.panel.uninitialize(),this.panel=null,this.viewer.removeEventListener(Se.PLACEMENT_TRANSFORM_CHANGED_EVENT,this.onPlacementChanged),this.onExtensionLoaded&&this.viewer.removeEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded),this.pointToPoint&&(this.pointToPoint.dtor(),this.pointToPoint=null),this.angleToAngle&&(this.angleToAngle=null),this.disconnectModelsPanel()}},{key:"onTabChanged",value:function(){var e=this.panel.selectedTabId,t=this.modelTransformTool.getName();e===Y.TabIds.Transform&&this.model?this.viewer.toolController.isToolActivated(t)||this.viewer.toolController.activateTool(t):this.viewer.toolController.deactivateTool(t),e===Y.TabIds.PointToPoint?this.pointToPoint.startSelect():(this.pointToPoint.cancelPointSelection(),this.pointToPoint.setVisible(!1)),e===Y.TabIds.AngleToAngle?this.angleToAngle.startSelect():(this.angleToAngle.cancelPointSelection(),this.angleToAngle.setVisible(!1))}},{key:"connectModelsPanel",value:function(){var e=this,t=this.viewer.getExtension("Autodesk.ModelsPanel");if(!t)return this.onExtensionLoaded=function(t){return"Autodesk.ModelsPanel"===t.extensionId&&e.connectModelsPanel()},void this.viewer.addEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded);this.modelsPanel=t.panel,this.modelsPanel.addEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!0)}},{key:"disconnectModelsPanel",value:function(){this.modelsPanel&&(this.modelsPanel.removeEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!1))}},{key:"onModelPanelSelect",value:function(e){this.setModel(e.item.model)}},{key:"connectPointToPoint",value:function(){var e=this;this.panel.addEventListener(Y.Events.FROM_POINT_CHANGED,(function(t){return e.pointToPoint.setFrom(t.fromPoint)})),this.panel.addEventListener(Y.Events.TO_POINT_CHANGED,(function(t){return e.pointToPoint.setTo(t.toPoint)})),this.panel.addEventListener(Y.Events.OFFSET_CHANGED,(function(t){return e.pointToPoint.setOffset(t.offset)})),this.panel.addEventListener(Y.Events.FROM_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectFrom()})),this.panel.addEventListener(Y.Events.TO_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectTo()})),this.panel.addEventListener(Y.Events.APPLY_PTP_PRESSED,(function(){e.pointToPoint.apply(e.panel.model),e.modified()})),this.panel.addEventListener(Y.Events.FIT_TO_VIEW_BUTTON_PRESSED,(function(){e.pointToPoint.fitModelToView(e.panel.model),e.modified()})),this.pointToPoint.addEventListener(ee.Events.FROM_POINT_SELECTED,(function(t){return e.panel.onFromSelected(t.point)})),this.pointToPoint.addEventListener(ee.Events.FROM_POINT_HOVERED,(function(t){return e.panel.onFromHovered(t.point)})),this.pointToPoint.addEventListener(ee.Events.TO_POINT_HOVERED,(function(t){return e.panel.onToHovered(t.point)})),this.pointToPoint.addEventListener(ee.Events.TO_POINT_SELECTED,(function(t){return e.panel.onToSelected(t.point)}))}},{key:"connectAngleToAngle",value:function(){var e=this;this.panel.addEventListener(Y.Events.MODEL_SELECTED,(function(){return e.setModel(e.panel.model)})),this.panel.addEventListener(Y.Events.CENTER_CHANGED,(function(t){return e.angleToAngle.setCenter(t.center)})),this.panel.addEventListener(Y.Events.FROM_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeFromAngle(we(t.angle))})),this.panel.addEventListener(Y.Events.TO_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeToAngle(we(t.angle))})),this.panel.addEventListener(Y.Events.OFFSET_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeOffset(we(t.angle))})),this.panel.addEventListener(Y.Events.CENTER_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectCenter()})),this.panel.addEventListener(Y.Events.FROM_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngle()})),this.panel.addEventListener(Y.Events.TO_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngle()})),this.panel.addEventListener(Y.Events.FROM_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngleEdge()})),this.panel.addEventListener(Y.Events.TO_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngleEdge()})),this.panel.addEventListener(Y.Events.APPLY_ATA_PRESSED,(function(){e.angleToAngle.apply(e.panel.model),e.modified()})),this.angleToAngle.addEventListener(ue.Events.CENTER_HOVERED,(function(t){return e.panel.onCenterHovered(t.point)})),this.angleToAngle.addEventListener(ue.Events.CENTER_SELECTED,(function(t){return e.panel.onCenterSelected(t.point)})),this.angleToAngle.addEventListener(ue.Events.FROM_ANGLE_HOVERED,(function(t){return e.panel.onFromAngleHovered(t.angle)})),this.angleToAngle.addEventListener(ue.Events.FROM_ANGLE_SELECTED,(function(t){return e.panel.onFromAngleSelected(t.angle)})),this.angleToAngle.addEventListener(ue.Events.TO_ANGLE_HOVERED,(function(t){return e.panel.onToAngleHovered(t.angle)})),this.angleToAngle.addEventListener(ue.Events.TO_ANGLE_SELECTED,(function(t){return e.panel.onToAngleSelected(t.angle)}))}},{key:"connectModelMoveTool",value:function(){var e=this;this.panel.addEventListener(Y.Events.EDIT_POSITION_PRESSED,(function(){return e.viewer.toolController.activateTool(e.modelTransformTool.getName())}))}},{key:"connectModelSelector",value:function(){var e=this;this.panel.addEventListener(Y.Events.SELECT_MODEL_PRESSED,(function(t){e.viewer.toolController.isToolActivated(e.modelSelector.getName())||e.viewer.toolController.activateTool(e.modelSelector.getName())})),this.modelSelector.addEventListener(pe.Events.MODEL_SELECTED,(function(t){e.viewer.toolController.setIsLocked(!1),e.viewer.toolController.deactivateTool(e.modelSelector.getName()),e.setModel(t.model)}))}},{key:"setModel",value:function(e){ye(ke(a.prototype),"setModel",this).call(this,e),this.panel.setModel(e),this.updateColorTheming(),this.onTabChanged()}},{key:"updateColorTheming",value:function(){for(var e=this.model&&this.model.myData.urn,t=function(t){return e&&t.myData.urn===e},n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i];o.isLeaflet()||(t(o)?_e(o,this.selectionColor):this.viewer.clearThemingColors(o))}this.viewer.impl.invalidate(!0)}},{key:"onSaveButton",value:function(){this.pointToPoint.skipAnim(),this.angleToAngle.skipAnim(),ye(ke(a.prototype),"onSaveButton",this).call(this)}},{key:"onPlacementChanged",value:function(e){e.model===this.model&&(this.panel.updateMatrix(),this.syncAlignments())}},{key:"syncAlignments",value:function(){if(this.model&&!this.model.is2d())for(var e=this.model.myData.urn,t=this.model.getPlacementTransform(),n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i],r=o.myData.urn==e&&o!==this.model;o.is3d()&&r&&this.viewer.impl.setPlacementTransform(o,t)}}}])&&me(t.prototype,n),i&&me(t,i),a}(P);Ce.ModelAlignment=Oe,Ce.ModelAlignmentPanel=Y,Ce.AngleToAngle=ue,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.ModelAlignment",Oe);var De,Re,Ne,Me,xe,Ve,Le,He,Ie,Be,Fe=(De=new THREE.Quaternion,Re=new THREE.Quaternion,Ne=new THREE.Quaternion,Me=new THREE.Matrix4,xe=new THREE.Matrix4,Ve=new THREE.Matrix4,Le=new THREE.Vector3,He=new THREE.Vector3,Ie=new THREE.Matrix4,Be=new THREE.Matrix4,function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=o.onChange,s=o.onEnd,a=o.applyTranslation,l=void 0===a||a,c=o.applyRotation,u=void 0===c||c,d=o.applyScale,h=void 0===d||d,f=o.duration,p=void 0===f?1:f,v=o.originalMatrix?o.originalMatrix.clone():void 0,g=n.clone().sub(e),E=e.distanceTo(t),m=n.distanceTo(i),y=m/E,T=t.clone().sub(e).normalize(),P=i.clone().sub(n).normalize();De.setFromUnitVectors(T,P),Ie.identity().setPosition(e),Be.identity().setPosition(e.clone().multiplyScalar(-1));var A=function(e){if(e=THREE.Math.smootherstep(e,0,1),xe.identity(),l&&(Le.lerpVectors(He,g,e),xe.makeTranslation(Le.x,Le.y,Le.z)),xe.multiply(Ie),u&&(THREE.Quaternion.slerp(Re,De,Ne,e),Ve.makeRotationFromQuaternion(Ne),xe.multiply(Ve)),h){var t=Autodesk.Viewing.Private.lerp(1,y,e);Me.makeScale(t,t,t),xe.multiply(Me)}xe.multiply(Be),v&&xe.multiply(v),r&&r(xe)},b=Autodesk.Viewing.Private.fadeValue(0,1,p,A,s);return b});function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function je(e,t){return(je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=We(e);if(t){var o=We(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Ye(this,n)}}function Ye(e,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Qe={SOURCE_POINT_SELECTION_STARTED:"sourcePointSelectionStarted",DEST_POINT_SELECTION_STARTED:"destPointSelectionStarted"},Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&je(e,t)}(r,Autodesk.Edit3D.NPointPicker);var t,n,i,o=Ue(r);function r(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s={draggable:!0,colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:2,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Black},{fromIndex:1,toIndex:3,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Black}]};return(i=o.call(this,e,t,n,4,s)).tmpVec=new THREE.Vector3,i.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTION_STARTED,(function(e){var t=e.index;0!==t||i.pointValid[0]?2!==t||i.pointValid[2]||i.fireEvent({type:Qe.DEST_POINT_SELECTION_STARTED}):i.fireEvent({type:Qe.SOURCE_POINT_SELECTION_STARTED})})),i}return t=r,(n=[{key:"apply",value:function(e){var t=this,n=e.getPlacementTransform().clone(),i=this.points[0].clone(),o=this.points[1].clone(),r=this.points[2].clone(),s=this.points[3].clone();this.anim=Fe(i,o,r,s,{onChange:function(r){t.setPoint(0,t.tmpVec.copy(i).applyMatrix4(r)),t.setPoint(1,t.tmpVec.copy(o).applyMatrix4(r)),t.viewer.impl.setPlacementTransform(e,r.multiply(n))},onEnd:function(){t.clear(),t.anim=null}})}},{key:"skipAnim",value:function(){var e;null===(e=this.anim)||void 0===e||e.skip()}},{key:"isSelectingSourcePointsDone",value:function(){return 0!==this.selectingIndex&&1!==this.selectingIndex&&this.pointValid[0]&&this.pointValid[1]}}])&&ze(t.prototype,n),i&&ze(t,i),r}();Xe.Events=Qe;var Ke={en:n(322)};function Je(e){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function qe(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){$e(r,i,o,s,a,"next",e)}function a(e){$e(r,i,o,s,a,"throw",e)}s(void 0)}))}}function Ze(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function et(e,t,n){return(et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=rt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=rt(e);if(t){var o=rt(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return it(this,n)}}function it(e,t){return!t||"object"!==Je(t)&&"function"!=typeof t?ot(e):t}function ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var st=AutodeskNamespace("Autodesk.SheetAlignment"),at={ADD_DRAWING_CLICKED:"addDrawingClicked"},lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(a,e);var t,n,i,o,r,s=nt(a);function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).name="Autodesk.SheetAlignment",n.model=null,n.target3DModel=null,n.tmpBox=new THREE.Box3,n.onCropChanged=n.onCropChanged.bind(ot(n)),n}return t=a,(n=[{key:"load",value:(r=qe(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(Ke),e.next=3,et(rt(a.prototype),"load",this).call(this);case 3:return e.next=5,this.viewer.loadExtension("Autodesk.Crop",{disableMoveTool:!0});case 5:this.cropExtension=e.sent,this.cropExtension.addEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),this.fourPointsAlignment=new Xe(this.viewer,this.coordPicker,this.screenOverlay),this.fitCameraToTargetModel=this.fitCameraToTargetModel.bind(this),this.fourPointsAlignment.addEventListener(Xe.Events.DEST_POINT_SELECTION_STARTED,this.fitCameraToTargetModel),this.onContextMenu=this.onContextMenu.bind(this),this.viewer.registerContextMenuCallback("Autodesk.SheetAlignment",this.onContextMenu),this.targetPos=null,this.targetNormal=null;case 14:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"unload",value:function(){et(rt(a.prototype),"unload",this).call(this),this.fourPointsAlignment&&(this.fourPointsAlignment.dtor(),this.fourPointsAlignment=null),this.cropExtension.removeEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),this.target3DModel=null,this.viewer.unregisterContextMenuCallback("Autodesk.SheetAlignment")}},{key:"getRightVector",value:function(e){var t=this.viewer.navigation.getWorldUpVector(),n=new THREE.Vector3;return n.crossVectors(e,t),n.lengthSq()<1e-4&&(Math.abs(e.z)>=Math.abs(e.y)?t.set(0,1,0):t.set(0,0,1),n.crossVectors(e,t)),n.normalize()}},{key:"applyInitialSheetTransform",value:function(){if(this.targetPos&&this.targetNormal){var e=this.model.getBoundingBox(!0,!0).center();this.targetNormal.negate();var t=this.targetPos.sub(e).sub(this.targetNormal.clone().multiplyScalar(1e-4)),n=this.getRightVector(this.targetNormal).cross(this.targetNormal).normalize(),i=new THREE.Matrix4;i.lookAt(new THREE.Vector3,this.targetNormal,n);var o=(new THREE.Matrix4).makeTranslation(-e.x,-e.y,-e.z),r=(new THREE.Matrix4).makeTranslation(e.x,e.y,e.z),s=(new THREE.Matrix4).makeTranslation(t.x,t.y,t.z).multiply(r).multiply(i).multiply(o);this.viewer.impl.setPlacementTransform(this.model,s),this.modified(),this.targetPos=null,this.targetNormal=null}}},{key:"setModel",value:function(e){this.model!==e&&(this.cropExtension.setModel(e),this.cropExtension.cropToModelBounds(!0),et(rt(a.prototype),"setModel",this).call(this,e),this.fourPointsAlignment.clear(),this.modelTransformTool.setModel(e,this.getMinCroppedBox()),this.applyInitialSheetTransform())}},{key:"setTarget3DModel",value:function(e){this.target3DModel=e}},{key:"onSaveButton",value:function(){this.fourPointsAlignment.skipAnim(),et(rt(a.prototype),"onSaveButton",this).call(this)}},{key:"startPointToPointSelection",value:function(){this.fourPointsAlignment.startSelect()}},{key:"applyPointsToPoints",value:function(){this.fourPointsAlignment.apply(this.model),this.modified()}},{key:"areAllPointsSet",value:function(){return this.fourPointsAlignment.areAllPointsSet()}},{key:"fitCameraToSheet",value:function(){if(this.model){this.viewer.navigation.toOrthographic();var e=this.getMinCroppedBox(),t=this.model.getModelToViewerTransform()||new THREE.Matrix4,n=e.center(),i=n.clone().applyMatrix4(t),o=n;o.z-=e.size().y,o.applyMatrix4(t);var r=new THREE.Matrix4;r.extractRotation(t);var s={position:i,target:o,up:new THREE.Vector3(0,1,0).applyMatrix4(r).normalize()};Autodesk.Viewing.Private.flyToView(this.viewer,s,.5,void 0,!1)}}},{key:"fitCameraToTargetModel",value:function(){if(this.target3DModel){var e=(new THREE.Box3).copy(this.target3DModel.getBoundingBox());this.viewer.navigation.fitBounds(!1,e,!1)}}},{key:"show",value:function(){this.model&&!this.active&&(this.active=!0,this.fourPointsAlignment.setVisible(!0),this.fourPointsAlignment.continuePointSelectionIfNeeded(),this.cropExtension.activate(),this.viewer.toolController.isToolActivated(this.modelTransformTool.getName())||this.viewer.toolController.activateTool(this.modelTransformTool.getName()))}},{key:"hide",value:function(){this.active&&(this.active=!1,this.fourPointsAlignment.cancelPointSelection(),this.fourPointsAlignment.setVisible(!1),this.cropExtension.deactivate(),this.viewer.toolController.deactivateTool(this.modelTransformTool.getName()))}},{key:"getMinCroppedBox",value:function(){var e;if(!this.model)return null;var t=this.tmpBox.copy(this.model.getBoundingBox(!0)),n=null===(e=this.cropExtension.getCurrentCropRegion())||void 0===e?void 0:e.bbox;return n&&t.intersect(n),t}},{key:"onCropChanged",value:function(){var e=this.getMinCroppedBox();this.modelTransformTool.setModel(this.model,e);var t=this.cropExtension.getCurrentCropRegion();this.modified(t)}},{key:"onContextMenu",value:function(e,t){var n,i,o=this,r=this.viewer.impl.hitTest(t.canvasX,t.canvasY,!1);if((null==r||null===(n=r.model)||void 0===n?void 0:n.is3d())&&(null==r||null===(i=r.face)||void 0===i?void 0:i.normal)){var s=r.point,a=this.viewer.impl.getRenderProxy(r.model,r.fragId),l=(new THREE.Matrix3).getNormalMatrix(a.matrixWorld),c=r.face.normal.clone().applyMatrix3(l).normalize(),u=function(e){o.setModel(e),o.fitCameraToSheet(),o.startPointToPointSelection()},d={title:"Add drawing",target:function(){o.viewer.clearSelection(),o.targetPos=s,o.targetNormal=c,o.setTarget3DModel(r.model),o.fireEvent({type:at.ADD_DRAWING_CLICKED,onSheetLoaded:u})}};e.push(d)}}},{key:"saveChanges",value:(o=qe(regeneratorRuntime.mark((function e(t){var n,i,o,r,s,a,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.model&&this.target3DModel){e.next=2;break}return e.abrupt("return");case 2:if(n=this.model.getPlacementTransform(),i=this.model.getDocumentNode(),o=i.getRootNode().urn(),r=i.guid(),s=this.target3DModel.getDocumentNode(),a=s.getRootNode().urn(),l=s.guid(),c=this.cropExtension.getCurrentCropRegion(),e.t0=this.model.alignmentRelationshipId,e.t0){e.next=15;break}return e.next=14,t.saveRelationship(o,r,a,l);case 14:e.t0=e.sent;case 15:return this.model.alignmentRelationshipId=e.t0,e.next=18,t.saveViewport(o,r,this.model.alignmentRelationshipId,c.bbox,c.units);case 18:return e.next=20,t.saveTransform(o,r,this.model.alignmentRelationshipId,n);case 20:this.pendingChanges=[];case 21:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}])&&Ze(t.prototype,n),i&&Ze(t,i),a}(P);st.SheetAlignment=lt,st.Events=at,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.SheetAlignment",lt)},6:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}}});
//# sourceMappingURL=ModelAlignment.min.js.map